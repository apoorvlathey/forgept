,title,text,n_tokens
0,arithmeticError.md,"arithmeticError.md. ## `arithmeticError` ### Signature ```solidity stdError.arithmeticError ``` ### Description The internal Solidity error when an arithmetic operation fails, e.g. underflow and overflow. ### Example Assume we have a basic vault contract that can store some token (`wmdToken`): ```solidity contract BasicVault {  IERC20 public immutable wmdToken;  mapping(address => uint) public balances;  event Deposited(address indexed from, uint amount);  event Withdrawal(address indexed from, uint amount);  constructor(IERC20 wmdToken_){   wmdToken = wmdToken_;  }  function deposit(uint amount) external {    balances[msg.sender] += amount;   bool success = wmdToken.transferFrom(msg.sender, address(this), amount);   require(success, ""Deposit failed!"");   emit Deposited(msg.sender, amount);  }  function withdraw(uint amount) external {    balances[msg.sender] -= amount;   bool success = wmdToken.transfer(msg.sender, amount);   require(success, ""Withdrawal failed!"");   emit Withdrawal(msg.sender, amount);  } } ``` We have a test function to ensure that a user is unable to withdraw tokens in excess of his deposit, like so: ```solidity function testUserCannotWithdrawExcessOfDeposit() public {  vm.prank(user);  vm.expectRevert(stdError.arithmeticError);  vault.withdraw(userTokens + 100*10**18); } ``` 1. User has tokens of amount `userTokens` deposited in a Vault contract. 2. User attempts to withdraw tokens of amount in excess of his deposits. 3. This leads to an underflow error, resulting from: `balances[msg.sender] -= amount;` as it would evaluate into a negative value. To catch the error ""Arithmetic over/underflow"", we insert `vm.expectRevert(stdError.arithmeticError)` just before the function call that is expected to result in an underflow. ",414
1,transaction-options.md,"transaction-options.md. #### Transaction Options `--gas-limit` *gas_limit* &nbsp;&nbsp;&nbsp;&nbsp;Gas limit for the transaction. `--gas-price` *price* &nbsp;&nbsp;&nbsp;&nbsp;Gas price for the transaction, or max fee per gas for EIP1559 transactions. `--priority-gas-price` *price* &nbsp;&nbsp;&nbsp;&nbsp;Max priority fee per gas for EIP1559 transactions. {{#include ../common/tx-value-option.md}} `--nonce` *nonce* &nbsp;&nbsp;&nbsp;&nbsp;Nonce for the transaction. `--legacy` &nbsp;&nbsp;&nbsp;&nbsp;Send a legacy transaction instead of an [EIP1559][eip1559] transaction. &nbsp;&nbsp;&nbsp;&nbsp;This is automatically enabled for common networks without EIP1559. [eip1559]: https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1559.md ",210
2,cast-lookup-address.md,"cast-lookup-address.md. ## cast lookup-address ### NAME cast-lookup-address - Perform an ENS reverse lookup. ### SYNOPSIS ``cast lookup-address`` [*options*] *who* ### DESCRIPTION Perform an ENS reverse lookup. If `--verify` is passed, then a normal lookup is performed after the reverse lookup to verify that the address is correct. ### OPTIONS #### Lookup Options `-v` `--verify` &nbsp;&nbsp;&nbsp;&nbsp;Perform a normal lookup to verify that the address is correct. #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the ENS name for an address.  ```sh  cast lookup-address $ADDRESS  ``` 2. Perform both a reverse and a normal lookup:  ```sh  cast lookup-address --verify $ADDRESS  ``` ### SEE ALSO [cast](./cast.md), [cast resolve-name](./cast-resolve-name.md) ",202
3,std-errors.md,std-errors.md. ## Std Errors - [`assertionError`](./assertionError.md) - [`arithmeticError`](./arithmeticError.md) - [`divisionError`](./divisionError.md) - [`enumConversionError`](./enumConversionError.md) - [`encodeStorageError`](./encodeStorageError.md) - [`popError`](./popError.md) - [`indexOOBError`](./indexOOBError.md) - [`memOverflowError`](./memOverflowError.md) - [`zeroVarError`](./zeroVarError.md),113
4,coinbase.md,coinbase.md. ## `coinbase` ### Signature ```solidity function coinbase(address) external; ``` ### Description Sets `block.coinbase`. ### Examples ```solidity emit log_address(block.coinbase); // 0x0000000000000000000000000000000000000000 vm.coinbase(0xEA674fdDe714fd979de3EdF0F56AA9716B898ec8); emit log_address(block.coinbase); // 0xea674fdde714fd979de3edf0f56aa9716b898ec8 ```,119
5,project-options.md,"project-options.md. #### Project Options `--build-info` &nbsp;&nbsp;&nbsp;&nbsp;Generate build info files. `--build-info-path` *path* &nbsp;&nbsp;&nbsp;&nbsp;Output path to directory that build info files will be written to. `--root` *path* &nbsp;&nbsp;&nbsp;&nbsp;The project's root path. By default, this is the root directory of the current git repository, or the current working directory. `-C` *path* `--contracts` *path* &nbsp;&nbsp;&nbsp;&nbsp;The contracts source directory. &nbsp;&nbsp;&nbsp;&nbsp;Environment: `DAPP_SRC` `--lib-paths` *path* &nbsp;&nbsp;&nbsp;&nbsp;The path to the library folder. `-R` *remappings* `--remappings` *remappings* &nbsp;&nbsp;&nbsp;&nbsp;The project's remappings. &nbsp;&nbsp;&nbsp;&nbsp;The parameter is a comma-separated list of remappings in the format `<source>=<dest>`. `--cache-path` *path* &nbsp;&nbsp;&nbsp;&nbsp;The path to the compiler cache. `--config-path` *file* &nbsp;&nbsp;&nbsp;&nbsp;Path to the config file. `--hh` `--hardhat` &nbsp;&nbsp;&nbsp;&nbsp;This is a convenience flag, and is the same as passing `--contracts contracts --lib-paths node-modules`. ",316
6,std-math.md,std-math.md. ## Std Math - [`abs`](./abs.md) - [`delta`](./delta.md) - [`percentDelta`](./percentDelta.md),34
7,parse-address.md,"parse-address.md. ## `parseAddress` ### Signature ```solidity function parseAddress(string calldata stringifiedValue) external pure returns (address parsedValue); ``` ### Description Parses the value of `string` into `address` ### Examples ```solidity string memory addressAsString = ""0x0000000000000000000000000000000000000000""; address stringToAddress = vm.parseAddress(addressAsString); // 0x0000000000000000000000000000000000000000 ``` ",105
8,cast-chain.md,"cast-chain.md. ## cast chain ### NAME cast-chain - Get the symbolic name of the current chain. ### SYNOPSIS ``cast chain`` [*options*] ### DESCRIPTION Get the symbolic chain name from the RPC endpoint we are connected to. ### OPTIONS #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the chain name when talking to `$RPC`:  ```sh  cast chain --rpc-url $RPC  ``` 2. Get the chain name when `$ETH_RPC_URL` is set:  ```sh  cast chain  ``` ### SEE ALSO [cast](./cast.md), [cast chain-id](./cast-chain-id.md) ",146
9,env-bytes.md,"env-bytes.md. ## `envBytes` ### Signature ```solidity function envBytes(bytes calldata key) external returns (bytes value); ``` ```solidity function envBytes(bytes calldata key, bytes calldata delimiter) external returns (bytes[] memory values); ``` ### Description Read an environment variable as `bytes` or `bytes[]`. ### Tips - For arrays, you can specify the delimiter used to seperate the values with the `delimiter` parameter. ### Examples #### Single Value With environment variable `BYTES_VALUE=0x7109709ECfa91a80626fF3989D68f67F5b1DD12D`; ```solidity bytes memory key = ""BYTES_VALUE""; bytes expected = hex""7109709ECfa91a80626fF3989D68f67F5b1DD12D""; bytes output = cheats.envBytes(key); assertEq(output, expected); ``` #### Array With environment variable `BYTES_VALUE=0x7109709ECfa91a80626fF3989D68f67F5b1DD12D,0x00`; ```solidity bytes memory key = ""BYTES_VALUES""; bytes memory delimiter = "",""; bytes[] memory expected = new bytes[](2); expected[0] = hex""7109709ECfa91a80626fF3989D68f67F5b1DD12D""; expected[1] = hex""00""; bytes[] memory output = cheats.envBytes(key, delimiter); for (uint i = 0; i < expected.length; ++i) {  assert(keccak256(abi.encodePacked((output[i]))) == keccak256(abi.encodePacked((expected[i])))); } ``` ",357
10,forge-init.md,"forge-init.md. ## forge init ### NAME forge-init - Create a new Forge project. ### SYNOPSIS ``forge init`` [*options*] [*root*] ### DESCRIPTION Create a new Forge project in the directory *root* (by default the current working directory). The default template creates the following project layout: ```ignore {{#include ../../output/hello_foundry/tree-with-files:output}} ``` However, it is possible to create a project from another using `--template`. By default, `forge init` will also initialize a new git repository, install some submodules and create an initial commit message. If you do not want this behavior, pass `--no-git`. ### OPTIONS #### Init Options `--force` &nbsp;&nbsp;&nbsp;&nbsp;Create the project even if the specified root directory is not empty. `-t` *template* `--template` *template* &nbsp;&nbsp;&nbsp;&nbsp;The template to start from. `--vscode` &nbsp;&nbsp;&nbsp;&nbsp;Create a `.vscode/settings.json` file with Solidity settings, and generate a `remappings.txt` file. `--offline` &nbsp;&nbsp;&nbsp;&nbsp;Do not install dependencies from the network. #### VCS Options `--no-commit` &nbsp;&nbsp;&nbsp;&nbsp;Do not create an initial commit. `--no-git` &nbsp;&nbsp;&nbsp;&nbsp;Do not create a git repository. #### Display Options `-q` `--quiet` &nbsp;&nbsp;&nbsp;&nbsp;Do not print any messages. {{#include common-options.md}} ### EXAMPLES 1. Create a new project:  ```sh  forge init hello_foundry  ``` 2. Create a new project, but do not create a git repository:  ```sh  forge init --no-git hello_foundry  ``` 3. Forcibly create a new project in a non-empty directory:  ```sh  forge init --force  ``` ### SEE ALSO [forge](./forge.md) ",422
11,cast--to-hexdata.md,"cast--to-hexdata.md. ## cast --to-hexdata ### NAME cast---to-hexdata - Normalize the input to lowercase, 0x-prefixed hex. ### SYNOPSIS ``cast --to-hexdata`` [*options*] *input* ### DESCRIPTION Normalize the input to lowercase, 0x-prefixed hex. The input data (*input*) can either be: - Mixed case hex with or without the 0x prefix. - 0x prefixed hex that should be concatenated, separated by `:`. - An absolute path to a file containing hex. - A `@tag`, where the tag is defined in an environment variable. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Add 0x prefix:  ```sh  cast --to-hexdata deadbeef  ``` 2. Concatenate hex values:  ```sh  cast --to-hexdata ""deadbeef:0xbeef""  ``` 3. Normalize hex value in `MY_VAR`:  ```sh  cast --to-hexdata ""@MY_VAR""  ``` ### SEE ALSO [cast](./cast.md) ",240
12,cast--from-utf8.md,"cast--from-utf8.md. ## cast --from-utf8 ### NAME cast---from-utf8 - Convert UTF8 text to hex. ### SYNOPSIS ``cast --from-utf8`` [*options*] *text* ### DESCRIPTION Convert UTF8 text to hex. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Convert UTF8 text to hex:  ```sh  cast --from-utf8 ""hello""  ``` ### SEE ALSO [cast](./cast.md) ",106
13,store.md,"store.md. ## `store` ### Signature ```solidity function store(address account, bytes32 slot, bytes32 value) external; ``` ### Description Stores the value `value` in storage slot `slot` on account `account`. ### Examples ```solidity /// contract LeetContract { ///  uint256 private leet = 1337; // slot 0 /// } vm.store(address(leetContract), bytes32(uint256(0)), bytes32(uint256(31337))); bytes32 leet = vm.load(address(leetContract), bytes32(uint256(0))); emit log_uint(uint256(leet)); // 31337 ``` ### SEE ALSO Forge Standard Library [Std Storage](../reference/forge-std/std-storage.md)",150
14,env-int.md,"env-int.md. ## `envInt` ### Signature ```solidity function envInt(string calldata key) external returns (int256 value); ``` ```solidity function envInt(string calldata key, string calldata delimiter) external returns (int256[] memory values); ``` ### Description Read an environment variable as `int256` or `int256[]`. ### Tips - If the value starts with `0x`, `-0x` or `+0x`, it will be interpreted as a hex value, otherwise, it will be treated as a decimal number. - For arrays, you can specify the delimiter used to seperate the values with the `delimiter` parameter. ### Examples #### Single Value With environment variable `INT_VALUE=-57896044618658097711785492504343953926634992332820282019728792003956564819968`, ```solidity string memory key = ""INT_VALUE""; int256 expected = type(int256).min; int256 output = cheats.envInt(key); assert(output == expected); ``` #### Array With environment variable `INT_VALUES=-0x8000000000000000000000000000000000000000000000000000000000000000,+0x7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF`, ```solidity string memory key = ""INT_VALUES""; string memory delimiter = "",""; int256[2] memory expected = [type(int256).min, type(int256).max]; int256[] memory output = cheats.envInt(key, delimiter); assert(keccak256(abi.encodePacked((output))) == keccak256(abi.encodePacked((expected)))); ``` ",337
15,executor-options.md,executor-options.md. #### Executor Options `--base-fee <FEE>` `--block-base-fee-per-gas <FEE>` &nbsp;&nbsp;&nbsp;&nbsp;The base fee in a block (in wei). `--block-coinbase` *address* &nbsp;&nbsp;&nbsp;&nbsp;The coinbase of the block. `--block-difficulty` *difficulty* &nbsp;&nbsp;&nbsp;&nbsp;The block difficulty. `--block-gas-limit` *gas_limit* &nbsp;&nbsp;&nbsp;&nbsp;The block gas limit. `--block-number` *block* &nbsp;&nbsp;&nbsp;&nbsp;The block number. `--block-timestamp` *timestamp* &nbsp;&nbsp;&nbsp;&nbsp;The timestamp of the block (in seconds). `--chain-id` *chain_id* &nbsp;&nbsp;&nbsp;&nbsp;The chain ID. `--gas-limit` *gas_limit* &nbsp;&nbsp;&nbsp;&nbsp;The block gas limit. `--gas-price` *gas_price* &nbsp;&nbsp;&nbsp;&nbsp;The gas price (in wei). `--tx-origin` *address* &nbsp;&nbsp;&nbsp;&nbsp;The transaction origin. ,262
16,forge-verify-contract.md,"forge-verify-contract.md. ## forge verify-contract ### NAME forge-verify-contract - Verify smart contracts on a chosen verification provider. ### SYNOPSIS ``forge verify-contract`` [*options*] *address* *contract* ### DESCRIPTION Verifies a smart contract on a chosen verification provider. You must provide: - The contract address - The contract name or the path to the contract (read below) In case of Etherscan verification, you must also provide: - Your Etherscan API key, either by passing it as an argument or setting `ETHERSCAN_API_KEY` To find the exact compiler version, run `~/.svm/x.y.z/solc-x.y.z --version` and search for the 8 hex digits in the version string [here](https://etherscan.io/solcversions). The path to the contract is in the format `<path>:<contract>`, e.g. `src/Contract.sol:Contract`. By default, smart contracts are verified in a multi-file fashion. If you want to flatten the contract before verifying, pass `--flatten`. This command will try to compile the source code of the flattened contract if `--flatten` is passed before verifying. If you do not want that, pass `--force`. You can specify **ABI-encoded** constructor arguments with `--constructor-args`. Alternatively, you can specify a file containing **space-separated** constructor arguments with `--constructor-args-path`. (Note that [cache](../config/project.html#cache) must be enabled in the config for the latter to work.) ### OPTIONS #### Verify Contract Options {{#include ../common/verifier-options.md}} `--compiler-version` *version* &nbsp;&nbsp;&nbsp;&nbsp;The compiler version used to build the smart contract. &nbsp;&nbsp;&nbsp;&nbsp;To find the exact compiler version, run `~/.svm/x.y.z/solc-x.y.z --version` where `x` and `y` are major and minor version numbers respectively, then search for the 8 hex digits in the version string [here](https://etherscan.io/solcversions). `--num-of-optimizations` *num* `--optimizer-runs` *num*  &nbsp;&nbsp;&nbsp;&nbsp;The number of optimization runs used to build the smart contract.",483
17,forge-verify-contract.md,"`--constructor-args` *args* &nbsp;&nbsp;&nbsp;&nbsp;The ABI-encoded constructor arguments. Conflicts with `--constructor-args-path`. `--constructor-args-path` *file* &nbsp;&nbsp;&nbsp;&nbsp;The path to a file containing the constructor arguments. Conflicts with `--constructor-args`. `--chain-id` *chain* `--chain` *chain* &nbsp;&nbsp;&nbsp;&nbsp;The ID or name of the chain the contract is deployed to. &nbsp;&nbsp;&nbsp;&nbsp;Default: mainnet `--flatten` &nbsp;&nbsp;&nbsp;&nbsp;Flag indicating whether to flatten the source code before verifying. &nbsp;&nbsp;&nbsp;&nbsp;If this flag is not provided, the JSON standard input will be used instead. `-f` `--force` &nbsp;&nbsp;&nbsp;&nbsp;Do not compile the flattened smart contract before verifying. {{#include ../common/retry-options.md}} `--watch` &nbsp;&nbsp;&nbsp;&nbsp;Wait for verification result after submission. &nbsp;&nbsp;&nbsp;&nbsp;Automatically runs `forge verify-check` until the verification either fails or succeeds. {{#include project-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Verify a contract with JSON standard input on Etherscan  ```sh  forge verify-contract <address> SomeContract --watch 2. Verify a contract on a custom Sourcify instance  ```sh  forge verify-contract --verifier sourcify \  --verifier-url http://localhost:5000 <address> SomeContract  ``` 3. Verify a flattened contract built with solc v0.8.11+commit.d7f03943:  ```sh  forge verify-contract --flatten --watch --compiler-version ""v0.8.11+commit.d7f03943"" \  --constructor-args $(cast abi-encode ""constructor(string,string,uint256,uint256)"" ""ForgeUSD"" ""FUSD"" 18 1000000000000000000000) \  <address> MyToken  ``` 4.",451
18,expect-emit.md,"expect-emit.md. ## `expectEmit` ### Signature ```solidity function expectEmit(  bool checkTopic1,  bool checkTopic2,  bool checkTopic3,  bool checkData ) external; ``` ```solidity function expectEmit(  bool checkTopic1,  bool checkTopic2,  bool checkTopic3,  bool checkData,  address emitter ) external; ``` ### Description Assert a specific log is emitted during the next call. 1. Call the cheat code, specifying whether we should check the first, second or third topic, and the log data. Topic 0 is always checked. 2. Emit the event we are supposed to see during the next call. 3. Perform the call. You can perform steps 1 and 2 multiple times to match a _sequence_ of events in the next call. If the event is not available in the current scope (e.g. if we are using an interface, or an external smart contract), we can define the event ourselves with an identical event signature. There are 2 signatures: - **Without checking the emitter address**: Asserts the topics match **without** checking the emitting address. - **With `address`**: Asserts the topics match and that the emitting address matches. > ℹ️ **Matching sequences** > > In functions that emit a lot of events, it's possible to ""skip"" events and only match a specific sequence, > but this sequence must always be in order. As an example, let's say a > function emits events: `A, B, C, D, E, F, F, G`. > > `expectEmit` will be able to match ranges with and without skipping events in between: > - `[A, B, C]` is valid. > - `[B, D, F]` is valid. > - `[G]` or any other single event combination is valid. > - `[B, A]` or similar out-of-order combinations are **invalid** (events must be in order). > - `[C, F, F]` is valid. > - `[F, F, C]` is **invalid** (out of order). ### Examples This does not check the emitting address.",466
19,expect-emit.md,"```solidity event Transfer(address indexed from, address indexed to, uint256 amount); function testERC20EmitsTransfer() public {  // Only `from` and `to` are indexed in ERC20's `Transfer` event,  // so we specifically check topics 1 and 2 (topic 0 is always checked by default),  // as well as the data (`amount`).  vm.expectEmit(true, true, false, true);  // We emit the event we expect to see.  emit MyToken.Transfer(address(this), address(1), 10);  // We perform the call.  myToken.transfer(address(1), 10); } ``` This does check the emitting address. ```solidity event Transfer(address indexed from, address indexed to, uint256 amount); function testERC20EmitsTransfer() public {  // We check that the token is the event emitter by passing the address as the fifth argument.  vm.expectEmit(true, true, false, true, address(myToken));  emit MyToken.Transfer(address(this), address(1), 10);  // We perform the call.  myToken.transfer(address(1), 10); } ``` We can also assert that multiple events are emitted in a single call. ```solidity function testERC20EmitsBatchTransfer() public {  // We declare multiple expected transfer events  for (uint256 i = 0; i < users.length; i++) {   vm.expectEmit(true, true, true, true);   emit Transfer(address(this), users[i], 10);  }  // We also expect a custom `BatchTransfer(uint256 numberOfTransfers)` event.  vm.expectEmit(false, false, false, true);  emit BatchTransfer(users.length);  // We perform the call.  myToken.batchTransfer(users, 10); } ``` This example fails, as the expected event is not emitted on the next call. ```solidity event Transfer(address indexed from, address indexed to, uint256 amount); function testERC20EmitsTransfer() public {  // We check that the token is the event emitter by passing the address as the fifth argument.",446
20,fail.md,"fail.md. ## `fail` ### Signature ```solidity function fail(string memory err) internal virtual; ``` ### Description Fail a test with a message if a certain branch or execution point is hit. ### Examples ```solidity function test() external {  for(uint256 place; place < 10; ++i){   if(game.leaderboard(place) == address(this)) return;  }  fail(""Not in the top 10.""); } ```",92
21,cast-block.md,"cast-block.md. ## cast block ### NAME cast-block - Get information about a block. ### SYNOPSIS ``cast block`` [*options*] [*block*] ### DESCRIPTION Get information about a block. The specified *block* can be a block number, or any of the tags: `earliest`, `finalized`, `safe`, `latest` or `pending`. Default to `latest`. ### OPTIONS `-f` *field* `--field` *field* &nbsp;&nbsp;&nbsp;&nbsp; If specified, only get the given field of the block. {{#include ../common/display-options.md}} #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the latest block:  ```sh  cast block  ``` 2. Get the `finalized` block:  ```sh  cast block finalized  ``` 3. Get the hash of the latest block:  ```sh  cast block latest -f hash  ``` ### SEE ALSO [cast](./cast.md), [cast basefee](./cast-basefee.md), [cast age](./cast-age.md) ",240
22,create-select-fork.md,"create-select-fork.md. ## `createSelectFork` ### Signature ```solidity function createSelectFork(string calldata urlOrAlias) external returns (uint256); ``` ```solidity function createSelectFork(string calldata urlOrAlias, uint256 block) external returns (uint256); ``` ```solidity function createSelectFork(string calldata urlOrAlias, bytes32 transaction) external returns (uint256); ``` ### Description Creates _and_ selects a new fork from the given endpoint and returns the identifier of the fork. If a block number is passed as an argument, the fork will begin on that block, otherwise it will begin on the _latest_ block. If a transaction hash is provided, it will roll the fork to the block the transaction was mined in and replays all previously executed transactions. ### Examples Create and select a new mainnet fork with the latest block number: ```solidity uint256 forkId = vm.createSelectFork(MAINNET_RPC_URL); assertEq(block.number, 15_171_037); // as of time of writing, 2022-07-19 04:55:27 UTC ``` Create and select a new mainnet fork with a given block number: ```solidity uint256 forkId = vm.createSelectFork(MAINNET_RPC_URL, 1_337_000); assertEq(block.number, 1_337_000); ``` ### SEE ALSO - [createFork](./create-fork.md) - [selectFork](./select-fork.md) ",318
23,fee.md,fee.md. ## `fee` ### Signature ```solidity function fee(uint256) external; ``` ### Description Sets `block.basefee`. ### Examples ```solidity vm.fee(25 gwei); emit log_uint(block.basefee); // 25000000000 ``` ,56
24,is-persistent.md,is-persistent.md. ## `isPersistent` ### Signature ```solidity function isPersistent(address) external returns (bool); ``` ### Description Returns whether an account is marked as persistent ([`makePersistent`](./make-persistent.md)). ### Examples Check default status of `msg.sender` and the current test account ```solidity // By default the `sender` and the test contract itself are persistent assert(cheats.isPersistent(msg.sender)); assert(cheats.isPersistent(address(this))); ``` ### SEE ALSO - [makePersistent](./make-persistent.md) - [revokePersistent](./revoke-persistent.md) ,126
25,debugger.md,"debugger.md. ## Debugger Forge ships with an interactive debugger. The debugger is accessible on [`forge debug`](../reference/forge/forge-debug.md) and on [`forge test`](../reference/forge/forge-test.md). Using `forge test`: ```sh $ forge test --debug $FUNC ``` Where `$FUNC` is the signature of the function you want to debug. For example: ```sh $ forge test --debug ""testSomething()"" ``` If you have multiple contracts with the same function name, you need to limit the matching functions down to only one case using `--match-path` and `--match-contract`. If the matching test is a fuzz test, the debugger will open the first failing fuzz scenario, or the last successful one, whichever comes first. Using `forge debug`: ```sh $ forge debug --debug $FILE --sig $FUNC ``` Where `$FILE` is the path to the contract you want to debug, and `$FUNC` is the signature of the function you want to debug. For example: ```sh $ forge debug --debug src/SomeContract.sol --sig ""myFunc(uint256,string)"" 123 ""hello"" ``` You can also specify raw calldata using `--sig` instead of a function signature. If your source file contains more than one contract, specify the contract you want to debug using the `--target-contract` flag. ### Debugger layout ![An image of the debugger UI](../images/debugger.png) When the debugger is run, you are presented with a terminal divided into four quadrants: - **Quadrant 1**: The opcodes in the debugging session, with the current opcode highlighted. Additionally, the address of the current account, the program counter and the accumulated gas usage is also displayed - **Quadrant 2**: The current stack, as well as the size of the stack - **Quadrant 3**: The source view - **Quadrant 4**: The current memory of the EVM As you step through your code, you will notice that the words in the stack and memory sometimes change color. For the memory: - **Red words** are about to be written to by the current opcode - **Green words** were written to by the previous opcode - **Cyan words** are being read by the current opcode For the stack, **cyan words** are either being read or popped by the current opcode.",488
26,debugger.md,"### Navigating ### General - <kbd>q</kbd>: Quit the debugger - <kbd>h</kbd>: Show help ### Navigating calls - <kbd>0-9</kbd> + <kbd>k</kbd>: Step a number of times backwards (alternatively scroll up with your mouse) - <kbd>0-9</kbd> + <kbd>j</kbd>: Step a number of times forwards (alternatively scroll down with your mouse) - <kbd>g</kbd>: Move to the beginning of the transaction - <kbd>G</kbd>: Move to the end of the transaction - <kbd>c</kbd>: Move to the previous call-type instruction (i.e. [`CALL`][op-call], [`STATICCALL`][op-staticcall], [`DELEGATECALL`][op-delegatecall], and [`CALLCODE`][op-callcode]).",181
27,write-json.md,"write-json.md. ## `writeJson` ### Signature ```solidity function writeJson(string calldata json, string calldata path) external; function writeJson(string calldata json, string calldata path, string calldata valueKey) external; ``` ### Description Writes a serialized JSON object to a file. The argument `json` must be a JSON object in stringified form. For example: ```text { ""boolean"": true, ""number"": 342, ""object"": { ""title"": ""finally json serialization"" } } ``` This is usually built through [serializeJson](./serialize-json.md). The argument `path` is the path of the JSON file to write to. If no `valueKey` is provided, then the JSON object will be written to a new file. If the file already exists, it will be overwritten. If a `valueKey` is provided, then the file must already exist and be a valid JSON file. The object in that file will be updated by replacing the value at the *JSON path* `valueKey` with the JSON object `json`. This is useful to replace some values in a JSON file without having to first parse and then reserialize it. Note that the JSON path must indicate an existing key, so it's not possible to add new keys this way. **Remember:** The file path `path` needs to be in the allowed paths. Read more in [File cheatcodes](./fs.md). #### JSON Paths Let's consider the following JSON object: ```json { ""boolean"": true, ""number"": 342, ""obj1"": {  ""aNumber"": 123,  ""obj2"": {  ""aNumber"": 123,  ""obj3"": {   ""veryDeep"": 13371337  }  } } } ``` The root object is always assumed, so we can refer to one of its children by starting the path with a dot (`.`). For instance, `.boolean`, `.number`, and `.obj1`. We can go as deep as we want: `.obj1.aNumber`, or `.obj1.obj2.aNumber`. We can even search for a key in a subtree: `.obj1..veryDeep`, or just `..veryDeep` since there's no ambiguity. See the examples to see this in action.",474
28,write-json.md,"### Examples #### A simple example ```solidity string memory jsonObj = '{ ""boolean"": true, ""number"": 342, ""myObject"": { ""title"": ""finally json serialization"" } }'; vm.writeJson(jsonObj, ""./output/example.json""); // replaces the value of `myObject` with a new object string memory newJsonObj = '{ ""aNumber"": 123, ""aString"": ""asd"" }'; vm.writeJson(newJsonObj, ""./output/example.json"", "".myObject""); // replaces the value of `aString` in the new object vm.writeJson(""my new string"", ""./output/example.json"", "".myObject.aString""); // Here's example.json: // // { // ""boolean"": true, // ""number"": 342, // ""myObject"": { //  ""aNumber"": 123, //  ""aString"": ""my new string"" // } // } ``` #### A more complex example ```solidity string memory jsonObj = '{ ""boolean"": true, ""number"": 342, ""obj1"": { ""foo"": ""bar"" } }'; vm.writeJson(jsonObj, ""./output/example2.json""); string memory jsonObj2 = '{ ""aNumber"": 123, ""obj2"": {} }'; vm.writeJson(jsonObj2, ""./output/example2.json"", "".obj1""); string memory jsonObj3 = '{ ""aNumber"": 123, ""obj3"": { ""veryDeep"": 3 } }'; vm.writeJson(jsonObj3, ""./output/example2.json"", "".obj1.obj2""); // Here's example2.json so far: // // { // ""boolean"": true, // ""number"": 342, // ""obj1"": { //  ""aNumber"": 123, //  ""obj2"": { //  ""aNumber"": 123, //  ""obj3"": { //   ""veryDeep"": 3 //  } //  } // } // } // Note that the JSON object is just the value 13371337 in this case.",421
29,cast-code.md,"cast-code.md. ## cast code ### NAME cast-code - Get the bytecode of a contract. ### SYNOPSIS ``cast code`` [*options*] *address* ### DESCRIPTION Get the bytecode of a contract. The contract (*address*) can be an ENS name or an address. ### OPTIONS #### Query Options `-B` *block* `--block` *block* &nbsp;&nbsp;&nbsp;&nbsp;The block height you want to query at. &nbsp;&nbsp;&nbsp;&nbsp;Can be a block number, or any of the tags: `earliest`, `finalized`, `safe`, `latest` or `pending`. #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the bytecode of the WETH contract.  ```sh  cast code 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2  ``` ### SEE ALSO [cast](./cast.md), [cast proof](./cast-proof.md) ",225
30,start-broadcast.md,"start-broadcast.md. ## `startBroadcast` ### Signature ```solidity function startBroadcast() external; ``` ```solidity function startBroadcast(address who) external; ``` ```solidity function startBroadcast(uint256 privateKey) external; ``` ### Description Using the address that calls the test contract or the address / private key provided as the sender, has all subsequent calls (at this call depth only and excluding cheatcode calls) create transactions that can later be signed and sent onchain. ### Examples ```solidity function t(uint256 a) public returns (uint256) {  uint256 b = 0;  emit log_string(""here"");  return b; } function deployOther() public {  vm.startBroadcast(ACCOUNT_A);  Test test = new Test();   // will trigger a transaction  test.t(1);   vm.stopBroadcast();  // broadcast again, this time using a private key from your environment variables  vm.startBroadcast(vm.envUint(""PRIVATE_KEY""));  test.t(3);  vm.stopBroadcast(); } ``` ### SEE ALSO - [broadcast](./broadcast.md) - [stopBroadcast](./stop-broadcast.md) ",234
31,cast-sig.md,"cast-sig.md. ## cast sig ### NAME cast-sig - Get the selector for a function. ### SYNOPSIS ``cast sig`` [*options*] *sig* ### DESCRIPTION Get the selector for a function. The signature (*sig*) is a fragment in the form `<function name>(<types...>)`. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Get the selector for the function `transfer(address,uint256)`:  ```sh  cast sig ""transfer(address,uint256)""  ``` 2. Get the selector for a function that expects a `struct`:  ```solidity  contract Test {   struct MyStruct {    address addr;    uint256 amount;   }   function myfunction(MyStruct memory t) public pure {}  }  ```  Structs are encoded as tuples (see [struct encoding](../../misc/struct-encoding.md)).  ```sh  cast sig ""myfunction((address,uint256))""  ``` ### SEE ALSO [cast](./cast.md), [struct encoding](../../misc/struct-encoding.md) ",222
32,roll.md,roll.md. ## `roll` ### Signature ```solidity function roll(uint256) external; ``` ### Description Sets `block.number`. ### Examples ```solidity vm.roll(100); emit log_uint(block.number); // 100 ``` ### SEE ALSO - [rollFork](./roll-fork.md) ,63
33,forge-inspect.md,"forge-inspect.md. ## forge inspect ### NAME forge-inspect - Get specialized information about a smart contract ### SYNOPSIS ``forge inspect`` [*options*] *contract_name* *field* ### DESCRIPTION Get specialized information about a smart contract. The field to inspect (*field*) can be any of: - `abi` - `b`/`bytes`/`bytecode` - `deployedBytecode`/`deployed_bytecode`/`deployed-bytecode`/`deployedbytecode`/`deployed` - `assembly`/`asm` - `asmOptimized`/`assemblyOptimized`/`assemblyoptimized`/`assembly_optimized`/`asmopt`/`assembly-optimized`/`asmo`/`asm-optimized`/`asmoptimized`/`asm_optimized` - `methods`/`methodidentifiers`/`methodIdentifiers`/`method_identifiers`/`method-identifiers`/`mi` - `gasEstimates`/`gas`/`gas_estimates`/`gas-estimates`/`gasestimates` - `storageLayout`/`storage_layout`/`storage-layout`/`storagelayout`/`storage` - `devdoc`/`dev-doc`/`devDoc` - `ir` - `ir-optimized`/`irOptimized`/`iroptimized`/`iro`/`iropt` - `metadata`/`meta` - `userdoc`/`userDoc`/`user-doc` - `ewasm`/`e-wasm` ### OPTIONS `--pretty` &nbsp;&nbsp;&nbsp;&nbsp;Pretty print the selected field, if supported. {{#include core-build-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Inspect the bytecode of a contract:  ```sh  forge inspect MyContract bytecode  ``` 2. Inspect the storage layout of a contract:  ```sh  forge inspect MyContract storage  ``` ### SEE ALSO [forge](./forge.md), [forge build](./forge-build.md) ",450
34,script-utils.md,script-utils.md. ## Script Utils - [`computeCreateAddress`](./compute-create-address.md) - [`deriveRememberKey`](./derive-remember-key.md) ,33
35,testing.md,"testing.md. ## Testing Configuration related to the behavior of `forge test`. **Sections** - [General](#general) - [Fuzz](#fuzz) - [Invariant](#invariant) ### General ##### `verbosity` - Type: integer - Default: 0 - Environment: `FOUNDRY_VERBOSITY` or `DAPP_VERBOSITY` The verbosity level to use during tests. - **Level 2 (`-vv`)**: Logs emitted during tests are also displayed. - **Level 3 (`-vvv`)**: Stack traces for failing tests are also displayed. - **Level 4 (`-vvvv`)**: Stack traces for all tests are displayed, and setup traces for failing tests are displayed. - **Level 5 (`-vvvvv`)**: Stack traces and setup traces are always displayed. ##### `ffi` - Type: boolean - Default: false - Environment: `FOUNDRY_FFI` or `DAPP_FFI` Whether or not to enable the `ffi` cheatcode. **Warning:** Enabling this cheatcode has security implications for your project, as it allows tests to execute arbitrary programs on your computer. ##### `sender` - Type: string (address) - Default: 0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38 - Environment: `FOUNDRY_SENDER` or `DAPP_SENDER` The value of `msg.sender` in tests. ##### `tx_origin` - Type: string (address) - Default: 0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38 - Environment: `FOUNDRY_TX_ORIGIN` or `DAPP_TX_ORIGIN` The value of `tx.origin` in tests. ##### `initial_balance` - Type: string (hexadecimal) - Default: 0xffffffffffffffffffffffff - Environment: `FOUNDRY_INITIAL_BALANCE` or `DAPP_INITIAL_BALANCE` The initial balance of the test contracts in wei, written in hexadecimal. ##### `block_number` - Type: integer - Default: 1 - Environment: `FOUNDRY_BLOCK_NUMBER` or `DAPP_BLOCK_NUMBER` The value of `block.number` in tests.",487
36,testing.md,"##### `chain_id` - Type: integer - Default: 31337 - Environment: `FOUNDRY_CHAIN_ID` or `DAPP_CHAIN_ID` The value of the `chainid` opcode in tests. ##### `gas_limit` - Type: integer or string - Default: 9223372036854775807 - Environment: `FOUNDRY_GAS_LIMIT` or `DAPP_GAS_LIMIT` The gas limit for each test case. > ℹ️ **Note** > > Due to a limitation in a dependency of Forge, you **cannot raise the gas limit** beyond the default without changing the value to a string. > > In order to use higher gas limits use a string: ```toml gas_limit = ""18446744073709551615"" # u64::MAX ``` ##### `gas_price` - Type: integer - Default: 0 - Environment: `FOUNDRY_GAS_PRICE` or `DAPP_GAS_PRICE` The price of gas (in wei) in tests. ##### `block_base_fee_per_gas` - Type: integer - Default: 0 - Environment: `FOUNDRY_BLOCK_BASE_FEE_PER_GAS` or `DAPP_BLOCK_BASE_FEE_PER_GAS` The base fee per gas (in wei) in tests. ##### `block_coinbase` - Type: string (address) - Default: 0x0000000000000000000000000000000000000000 - Environment: `FOUNDRY_BLOCK_COINBASE` or `DAPP_BLOCK_COINBASE` The value of `block.coinbase` in tests. ##### `block_timestamp` - Type: integer - Default: 1 - Environment: `FOUNDRY_BLOCK_TIMESTAMP` or `DAPP_BLOCK_TIMESTAMP` The value of `block.timestamp` in tests. ##### `block_difficulty` - Type: integer - Default: 0 - Environment: `FOUNDRY_BLOCK_DIFFICULTY` or `DAPP_BLOCK_DIFFICULTY` The value of `block.difficulty` in tests. ##### `gas_reports` - Type: array of strings (contract names) - Default: [""*""] - Environment: `FOUNDRY_GAS_REPORTS` or `DAPP_GAS_REPORTS` The contracts to print gas reports for.",478
37,testing.md,"##### `no_storage_caching` - Type: boolean - Default: false - Environment: `FOUNDRY_NO_STORAGE_CACHING` or `DAPP_NO_STORAGE_CACHING` If set to `true`, then block data from RPC endpoints in tests will not be cached. Otherwise, the data is cached to `$HOME/.foundry/cache/<chain id>/<block number>`. ##### `[rpc_storage_caching]` The `[rpc_storage_caching]` block determines what RPC endpoints are cached. ###### `rpc_storage_caching.chains` - Type: string or array of strings (chain names) - Default: all - Environment: N/A Determines what chains are cached. By default, all chains are cached. Valid values are: - ""all"" - A list of chain names, e.g. `[""optimism"", ""mainnet""]` ###### `rpc_storage_caching.endpoints` - Type: string or array of regex patterns (to match URLs) - Default: remote - Environment: N/A Determines what RPC endpoints are cached. By default, only remote endpoints are cached. Valid values are: - all - remote (default) - A list of regex patterns, e.g. `[""localhost""]` ##### `eth_rpc_url` - Type: string - Default: none - Environment: `FOUNDRY_ETH_RPC_URL` or `DAPP_ETH_RPC_URL` The url of the rpc server that should be used for any rpc calls. ##### `etherscan_api_key` - Type: string - Default: none - Environment: `FOUNDRY_ETHERSCAN_API_KEY` or `DAPP_ETHERSCAN_API_KEY` The etherscan API key for RPC calls. ##### `match-test` - Type: regex - Default: none - Environment: `FOUNDRY_MATCH_TEST` or `DAPP_MATCH_TEST` Only run test methods matching regex. Equivalent to `forge test --match-test <TEST_PATTERN>` ##### `no-match-test` - Type: regex - Default: none - Environment: `FOUNDRY_NO_MATCH_TEST` or `DAPP_NO_MATCH_TEST` Only run test methods not matching regex. Equivalent to `forge test --no-match-test <TEST_PATTERN_INVERSE>` ##### `match-contract` - Type: regex - Default: none - Environment: `FOUNDRY_MATCH_CONTRACT` or `DAPP_MATCH_CONTRACT` Only run test methods in contracts matching regex.",499
38,testing.md,"Equivalent to `forge test --match-contract <CONTRACT_PATTERN>` ##### `no-match-contract` - Type: regex - Default: none - Environment: `FOUNDRY_NO_MATCH_CONTRACT` or `DAPP_NO_MATCH_CONTRACT` Only run test methods in contracts not matching regex. Equivalent to `forge test --no-match-contract <CONTRACT_PATTERN_INVERSE>` ##### `match-path` - Type: regex - Default: none - Environment: `FOUNDRY_MATCH_PATH` or `DAPP_MATCH_PATH` Only runs test methods on files matching the path. Equivalent to `forge test --match-path <PATH_PATTERN>` ##### `no-match-path` - Type: regex - Default: none - Environment: `FOUNDRY_NO_MATCH_PATH` or `DAPP_NO_MATCH_PATH` Only runs test methods on files not matching the path. Equivalent to `forge test --no-match-path <PATH_PATTERN_INVERSE>` ##### `block_gas_limit` - Type: integer - Default: none - Environment: `FOUNDRY_BLOCK_GAS_LIMIT` or `DAPP_BLOCK_GAS_LIMIT` The block.gaslimit value during EVM execution. ##### `memory_limit` - Type: integer - Default: 33554432 - Environment: `FOUNDRY_MEMORY_LIMIT` or `DAPP_MEMORY_LIMIT` The memory limit of the EVM in bytes. ##### `names` - Type: boolean - Default: false - Environment: `FOUNDRY_NAMES` or `DAPP_NAMES` Print compiled contract names. ##### `sizes` - Type: boolean - Default: false - Environment: `FOUNDRY_SIZES` or `DAPP_SIZES` Print compiled contract sizes. ##### `rpc_endpoints` - Type: table of RPC endpoints - Default: none - Environment: none This section lives outside of profiles and defines a table of RPC endpoints, where the key specifies the RPC endpoints's name and the value is the RPC endpoint itself. The value can either be a valid RPC endpoint or a reference to an environment variable (wrapped with in `${}`). These RPC endpoints can be used in tests and Solidity scripts (see [`vm.rpc`](../../cheatcodes/rpc.md)).",451
39,testing.md,"The following example defines an endpoint named `optimism` and an endpoint named `mainnet` that references an environment variable `RPC_MAINNET`: ```toml [rpc_endpoints] optimism = ""https://optimism.alchemyapi.io/v2/..."" mainnet = ""${RPC_MAINNET}"" ``` ### Fuzz Configuration values for `[fuzz]` section. ##### `runs` - Type: integer - Default: 256 - Environment: `FOUNDRY_FUZZ_RUNS` or `DAPP_FUZZ_RUNS` The amount of fuzz runs to perform for each fuzz test case. Higher values gives more confidence in results at the cost of testing speed. ##### `max_test_rejects` - Type: integer - Default: 65536 - Environment: `FOUNDRY_FUZZ_MAX_TEST_REJECTS` The maximum number of combined inputs that may be rejected before the test as a whole aborts. ""Global"" filters apply to the whole test case. If the test case is rejected, the whole thing is regenerated. ##### `seed` - Type: string (hexadecimal) - Default: none - Environment: `FOUNDRY_FUZZ_SEED` Optional seed for the fuzzing RNG algorithm. ##### `dictionary_weight` - Type: integer (between 0 and 100) - Default: 40 - Environment: `FOUNDRY_FUZZ_DICTIONARY_WEIGHT` The weight of the dictionary. ##### `include_storage` - Type: boolean - Default: true - Environment: `FOUNDRY_FUZZ_INCLUDE_STORAGE` The flag indicating whether to include values from storage. ##### `include_push_bytes` - Type: boolean - Default: true - Environment: `FOUNDRY_FUZZ_INCLUDE_PUSH_BYTES` The flag indicating whether to include push bytes values. ### Invariant Configuration values for `[invariant]` section. > ℹ️ **Note** > > Configuration for `[invariant]` section has the fallback logic > for common config entries (`runs`, `seed`, `dictionary_weight` etc). > > * If the entries are not set in either section, then the defaults will be used. > * If the entries are set in the `[fuzz]` section, but are not set in the `[invariant]` > section, these values will automatically be set to the values specified in > the `[fuzz]` section.",496
40,cast--to-wei.md,"cast--to-wei.md. ## cast --to-wei ### NAME cast---to-wei - Convert an eth amount to wei. ### SYNOPSIS ``cast --to-wei`` [*options*] *value* [*unit*] ### DESCRIPTION Convert an eth amount to wei. Consider using [`cast --to-unit`](./cast--to-unit.md). ### OPTIONS {{#include common-options.md}} ### SEE ALSO [cast](./cast.md), [cast calldata](./cast--to-unit.md) ",105
41,noGasMetering.md,"noGasMetering.md. ## `noGasMetering` ### Signature ```solidity modifier noGasMetering(); ``` ### Description A function modifier that turns off gas metering for the life of the function. Note, there is some gas associated with calling the cheatcode, so you will see some gas usage (albeit small) when using this modifier. ### Examples ```solidity function addInLoop() internal returns (uint256) {  uint256 b;  for (uint256 i; i < 10000; i++) {   b + i;  }  return b; } function addInLoopNoGas() internal noGasMetering returns (uint256) {  return addInLoop(); } function testFunc() external { uint256 gas_start = gasleft(); addInLoop(); uint256 gas_used = gas_start - gasleft(); uint256 gas_start_no_metering = gasleft(); addInLoopNoGas(); uint256 gas_used_no_metering = gas_start_no_metering - gasleft(); emit log_named_uint(""Gas Metering"", gas_used); emit log_named_uint(""No Gas Metering"", gas_used_no_metering); } ``` ```ignore [PASS] testFunc() (gas: 1887191) Logs: Gas Metering: 1880082 No Gas Metering: 3024 ``` ",277
42,cast-access-list.md,"cast-access-list.md. ## cast access-list ### NAME cast-access-list - Create an access list for a transaction. ### SYNOPSIS ``cast access-list`` [*options*] *to* *sig* [*args...*] ### DESCRIPTION Create an access list for a transaction. The destination (*to*) can be an ENS name or an address. {{#include sig-description.md}} ### OPTIONS #### Query Options `-B` *block* `--block` *block* &nbsp;&nbsp;&nbsp;&nbsp;The block height you want to query at. &nbsp;&nbsp;&nbsp;&nbsp;Can be a block number, or any of the tags: `earliest`, `finalized`, `safe`, `latest` or `pending`. {{#include ../common/wallet-options.md}} {{#include ../common/rpc-options.md}} {{#include ../common/etherscan-options.md}} {{#include common-options.md}} ### SEE ALSO [cast](./cast.md), [cast send](./cast-send.md), [cast publish](./cast-publish.md), [cast call](./cast-call.md) ",230
43,struct-encoding.md,"struct-encoding.md. ## Struct Encoding Structs are user defined types that can group several variables: ```solidity struct MyStruct {  address addr;  uint256 amount; } ``` Only the new [ABI coder v2](https://docs.soliditylang.org/en/latest/layout-of-source-files.html#abi-coder-pragma) can encode and decode arbitrarily nested arrays and structs. Since Solidity 0.8.0 it is activated by default, prior to that it needs to be activated via `pragma experimental ABIEncoderV2`. Solidity structs map to the ABI type ""tuple"". For more information on how Solidity types map to ABI types see [Mapping Solidity to ABI types](https://docs.soliditylang.org/en/latest/abi-spec.html#mapping-solidity-to-abi-types) in the Solidity documentation. Structs are therefore encoded and decoded as tuples. So the struct we defined above, `MyStruct`, maps to the tuple `(address,uint256)` in terms of the ABI. Let's see how this works in a contract: ```solidity pragma solidity =0.8.15; contract Test {  struct MyStruct {   address addr;   uint256 amount;  }  function f(MyStruct memory t) public pure {} } ``` The ABI of the `f` function in this contract is: ```json { 	""inputs"": [ 		{ 			""components"": [ 				{ 					""internalType"": ""address"", 					""name"": ""addr"", 					""type"": ""address"" 				}, 				{ 					""internalType"": ""uint256"", 					""name"": ""amount"", 					""type"": ""uint256"" 				} 			], 			""internalType"": ""struct Test.MyStruct"", 			""name"": ""t"", 			""type"": ""tuple"" 		} 	], 	""name"": ""f"", 	""outputs"": [], 	""stateMutability"": ""pure"", 	""type"": ""function"" } ``` which reads: The function `f` takes 1 input of type `tuple` with two components of type `address` and `uint256`. ",452
44,project-root.md,project-root.md. ## `projectRoot` ### Signature ```solidity function projectRoot() external returns (string memory); ``` ### Description Returns the root directory of the current Foundry project. ,39
45,cast--from-fix.md,cast--from-fix.md. ## cast --from-fix ### NAME cast---from-fix - Convert a fixed point number into an integer. ### SYNOPSIS ``cast --from-fix`` [*options*] *decimals* *value* ### DESCRIPTION Convert a fixed point number into an integer. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Convert 10.55 to an integer:  ```sh  cast --from-fix 2 10.55  ``` ### SEE ALSO [cast](./cast.md) ,109
46,cast--max-int.md,"cast--max-int.md. ## cast --max-int ### NAME cast---max-int - Get the maximum i256 value. ### SYNOPSIS ``cast --max-int`` ### DESCRIPTION Get the maximum i256 value. ### OPTIONS {{#include common-options.md}} ### SEE ALSO [cast](./cast.md), [cast --min-int](./cast--min-int.md), [cast --max-uint](./cast--max-uint.md) ",91
47,derive-remember-key.md,"derive-remember-key.md. ## `deriveRememberKey` ### Signature ```solidity function deriveRememberKey(string memory mnemonic, uint32 index) internal returns (address who, uint256 privateKey) ``` ### Description Derive a private key from a mnemonic and also store it in forge's local wallet. Returns the address and private key. ### Example Get a private key and address from the test mnemonic at path `m/44'/60'/0'/0/0`. Use them to sign some data and start broadcasting transactions: ```solidity string memory mnemonic = ""test test test test test test test test test test test junk""; (address deployer, uint256 privateKey) = deriveRememberKey(mnemonic, 0); bytes32 hash = keccak256(""Signed by deployer""); (uint8 v, bytes32 r, bytes32 s) = vm.sign(privateKey, hash); vm.startBroadcast(deployer); ... vm.stopBroadcast(); ``` Get an address from the test mnemonic at path `m/44'/60'/0'/0/0` to start broadcasting transactions: ```solidity string memory mnemonic = ""test test test test test test test test test test test junk""; (address deployer, ) = deriveRememberKey(mnemonic, 0); vm.startBroadcast(deployer); ... vm.stopBroadcast(); ``` ### SEE ALSO Cheatcodes: - [deriveKey](../../cheatcodes/derive-key.md) - [rememberKey](../../cheatcodes/remember-key.md) ",304
48,deploy-commands.md,deploy-commands.md. ## Deploy Commands - [forge create](./forge-create.md) - [forge verify-contract](./forge-verify-contract.md) - [forge verify-check](./forge-verify-check.md) - [forge flatten](./forge-flatten.md) ,58
49,set-env.md,"set-env.md. ## `setEnv` ### Signature ```solidity function setEnv(string calldata key, string calldata value) external; ``` ### Description Set an environment variable `key=value`. > ℹ️ **Note** > > Environment variables set by a process are only accessible by itself and its child > processes. Thus, calling `setEnv` will only modify environment variables of the currently running > `forge` process, and won't affect the shell (`forge`'s parent process), i.e., the they won't persist > after the `forge` process exit. ### Tips - The environment variable key can't be empty. - The environment variable key can't contain the equal sign `=` or the NUL character `\0`. - The environment variable value can't contain the NUL character `\0`. ### Examples ```solidity string memory key = ""hello""; string memory val = ""world""; cheats.setEnv(key, val); ``` ",195
50,cheatcodes_README.md,"cheatcodes_README.md. ## Cheatcodes Reference Cheatcodes give you powerful assertions, the ability to alter the state of the EVM, mock data, and more. Cheatcodes are made available through use of the cheatcode address (`0x7109709ECfa91a80626fF3989D68f67F5b1DD12D`). > ℹ️ **Note** > > If you encounter errors for this address when using fuzzed addresses in your tests, you may wish to > exclude it from your fuzz tests by using the following line: > > ```solidity > vm.assume(address_ != 0x7109709ECfa91a80626fF3989D68f67F5b1DD12D); > ``` You can also access cheatcodes easily via `vm` available in Forge Standard Library's [`Test`](../reference/forge-std/#forge-stds-test) contract. ### Forge Standard Library Cheatcodes Forge Std implements wrappers around cheatcodes, which combine multiple standard cheatcodes to improve development experience. These are not technically cheatcodes, but rather compositions of Forge's cheatcodes. You can view the list of Forge Standard Library's cheatcode wrappers [in the references section](../reference/forge-std/std-cheats.md). You can reference the [Forge Std source code](https://github.com/foundry-rs/forge-std/blob/master/src/Test.sol) to learn more about how the wrappers work under the hood. ### Cheatcode Types Below are some subsections for the different Forge cheatcodes. - [Environment](./environment.md): Cheatcodes that alter the state of the EVM. - [Assertions](./assertions.md): Cheatcodes that are powerful assertions - [Fuzzer](./fuzzer.md): Cheatcodes that configure the fuzzer - [External](./external.md): Cheatcodes that interact with external state (files, commands, ...) - [Utilities](./utilities.md): Smaller utility cheatcodes - [Forking](./forking.md): Forking mode cheatcodes - [Snapshots](./snapshots.md): Snapshot cheatcodes - [RPC](./rpc.md): RPC related cheatcodes - [File](./fs.md): Cheatcodes for working with files ### Add a new cheatcode If you need a new feature, consider [contributing to the Foundry's codebase](../contributing.md) to add the cheatcode.",498
51,cheatcodes_README.md,"### Cheatcodes Interface This is a Solidity interface for all of the cheatcodes present in Forge. ```solidity interface CheatCodes {  // This allows us to getRecordedLogs()  struct Log {   bytes32[] topics;   bytes data;  }  // Set block.timestamp  function warp(uint256) external;  // Set block.number  function roll(uint256) external;  // Set block.basefee  function fee(uint256) external;  // Set block.difficulty  // Does not work from the Paris hard fork and onwards, and will revert instead.  function difficulty(uint256) external;   // Set block.prevrandao  // Does not work before the Paris hard fork, and will revert instead.  function prevrandao(bytes32) external;  // Set block.chainid  function chainId(uint256) external;  // Loads a storage slot from an address  function load(address account, bytes32 slot) external returns (bytes32);  // Stores a value to an address' storage slot  function store(address account, bytes32 slot, bytes32 value) external;  // Signs data  function sign(uint256 privateKey, bytes32 digest)   external   returns (uint8 v, bytes32 r, bytes32 s);  // Computes address for a given private key  function addr(uint256 privateKey) external returns (address);  // Derive a private key from a provided mnemonic string,  // or mnemonic file path, at the derivation path m/44'/60'/0'/0/{index}.",315
52,cheatcodes_README.md," //  // Call this function, then emit an event, then call a function.  // Internally after the call, we check if logs were emitted in the expected order  // with the expected topics and data (as specified by the booleans)  //  // The second form also checks supplied address against emitting contract.  function expectEmit(bool, bool, bool, bool) external;  function expectEmit(bool, bool, bool, bool, address) external;  // Mocks a call to an address, returning specified data.  //  // Calldata can either be strict or a partial match, e.g. if you only  // pass a Solidity selector to the expected calldata, then the entire Solidity  // function will be mocked.  function mockCall(address, bytes calldata, bytes calldata) external;  // Reverts a call to an address, returning the specified error  //  // Calldata can either be strict or a partial match, e.g. if you only  // pass a Solidity selector to the expected calldata, then the entire Solidity  // function will be mocked.  function mockCallRevert(address where, bytes calldata data, bytes calldata retdata) external;  // Clears all mocked and reverted mocked calls  function clearMockedCalls() external;  // Expect a call to an address with the specified calldata.  // Calldata can either be strict or a partial match  function expectCall(address, bytes calldata) external;  // Expect a call to an address with the specified  // calldata and message value.  // Calldata can either be strict or a partial match  function expectCall(address, uint256, bytes calldata) external;  // Gets the _creation_ bytecode from an artifact file. Takes in the relative path to the json file  function getCode(string calldata) external returns (bytes memory);  // Gets the _deployed_ bytecode from an artifact file.",407
53,cheatcodes_README.md,"Takes in the relative path to the json file  function getDeployedCode(string calldata) external returns (bytes memory);  // Label an address in test traces  function label(address addr, string calldata label) external;   // Retrieve the label of an address  function getLabel(address addr) external returns (string memory);  // When fuzzing, generate new inputs if conditional not met  function assume(bool) external;  // Set block.coinbase (who)  function coinbase(address) external;  // Using the address that calls the test contract or the address provided  // as the sender, has the next call (at this call depth only) create a  // transaction that can later be signed and sent onchain  function broadcast() external;  function broadcast(address) external;  // Using the address that calls the test contract or the address provided  // as the sender, has all subsequent calls (at this call depth only) create  // transactions that can later be signed and sent onchain  function startBroadcast() external;  function startBroadcast(address) external;  // Stops collecting onchain transactions  function stopBroadcast() external;  // Reads the entire content of file to string, (path) => (data)  function readFile(string calldata) external returns (string memory);  // Get the path of the current project root  function projectRoot() external returns (string memory);  // Reads next line of file to string, (path) => (line)  function readLine(string calldata) external returns (string memory);  // Writes data to file, creating a file if it does not exist, and entirely replacing its contents if it does.  // (path, data) => ()  function writeFile(string calldata, string calldata) external;  // Writes line to file, creating a file if it does not exist.  // (path, data) => ()  function writeLine(string calldata, string calldata) external;  // Closes file for reading, resetting the offset and allowing to read it from beginning with readLine.  // (path) => ()  function closeFile(string calldata) external;  // Removes file. This cheatcode will revert in the following situations, but is not limited to just these cases:  // - Path points to a directory.  // - The file doesn't exist.  // - The user lacks permissions to remove the file.",498
54,cheatcodes_README.md," // (path) => ()  function removeFile(string calldata) external;   // Return the value(s) that correspond to 'key'  function parseJson(string memory json, string memory key) external returns (bytes memory);  // Return the entire json file  function parseJson(string memory json) external returns (bytes memory);  // Snapshot the current state of the evm.  // Returns the id of the snapshot that was created.  // To revert a snapshot use `revertTo`  function snapshot() external returns (uint256);  // Revert the state of the evm to a previous snapshot  // Takes the snapshot id to revert to.  // This deletes the snapshot and all snapshots taken after the given snapshot id.  function revertTo(uint256) external returns (bool);  // Creates a new fork with the given endpoint and block,  // and returns the identifier of the fork  function createFork(string calldata, uint256) external returns (uint256);  // Creates a new fork with the given endpoint and the _latest_ block,  // and returns the identifier of the fork  function createFork(string calldata) external returns (uint256);  // Creates _and_ also selects a new fork with the given endpoint and block,  // and returns the identifier of the fork  function createSelectFork(string calldata, uint256)   external   returns (uint256);  // Creates _and_ also selects a new fork with the given endpoint and the  // latest block and returns the identifier of the fork  function createSelectFork(string calldata) external returns (uint256);  // Takes a fork identifier created by `createFork` and  // sets the corresponding forked state as active.",363
55,parse-bytes32.md,"parse-bytes32.md. ## `parseBytes32` ### Signature ```solidity function parseBytes32(string calldata stringifiedValue) external pure returns (bytes32 parsedValue); ``` ### Description Parses the value of `string` into `bytes32` ### Examples ```solidity string memory bytes32AsString = ""0x0000000000000000000000000000000000000000000000000000000000000000""; bytes32 stringToBytes32 = vm.parseBytes32(bytes32AsString); // 0x0000000000000000000000000000000000000000000000000000000000000000 ``` ",132
56,cast-4byte-decode.md,"cast-4byte-decode.md. ## cast 4byte-decode ### NAME cast-4byte-decode - Decode ABI-encoded calldata using <https://sig.eth.samczsun.com>. ### SYNOPSIS ``cast 4byte-decode`` [*options*] *calldata* ### DESCRIPTION Decode ABI-encoded calldata using <https://sig.eth.samczsun.com>. ### OPTIONS #### 4byte Options `--id` *id* &nbsp;&nbsp;&nbsp;&nbsp;The index of the resolved signature to use. &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<https://sig.eth.samczsun.com> can have multiple possible signatures for a given selector. &nbsp;&nbsp;&nbsp;&nbsp;The index can be an integer, or the tags ""earliest"" and ""latest"". {{#include common-options.md}} ### EXAMPLES 1. Decode calldata for a `transfer` call:  ```sh  cast 4byte-decode 0xa9059cbb000000000000000000000000e78388b4ce79068e89bf8aa7f218ef6b9ab0e9d00000000000000000000000000000000000000000000000000174b37380cea000  ``` ### SEE ALSO [cast](./cast.md), [cast 4byte](./cast-4byte.md), [cast 4byte-event](./cast-4byte-event.md) ",310
57,cast-compute-address.md,"cast-compute-address.md. ## cast compute-address ### NAME cast-compute-address - Compute the contract address from a given nonce and deployer address. ### SYNOPSIS ``cast compute-address`` [*options*] *address* ### DESCRIPTION Compute the contract address from a given nonce and deployer address. ### OPTIONS #### Compute Options `--nonce` *nonce* &nbsp;&nbsp;&nbsp;&nbsp;The nonce of the account. Defaults to the latest nonce, fetched from the RPC. #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### SEE ALSO [cast](./cast.md), [cast proof](./cast-proof.md), [cast create2](./cast-create2.md) ",150
58,revoke-persistent.md,"revoke-persistent.md. ## `revokePersistent` ### Signature ```solidity function revokePersistent(address) external; function revokePersistent(address[] calldata) external; ``` ### Description The counterpart of [`makePersistent`](./make-persistent.md), that makes the given contract not persistent across fork swaps ### Examples Revoke a persistent status of a contract ```solidity contract SimpleStorageContract {  string public value;  function set(uint256 _value) public {   value = _value;  } } function testRevokePersistent() public {  // select a specific fork  cheats.selectFork(mainnetFork);   // create a new contract that's stored in the `mainnetFork` storage  SimpleStorageContract simple = new SimpleStorageContract();   // `simple` is not marked as persistent  assert(!cheats.isPersistent(address(simple)));    // make it persistent  cheats.makePersistent(address(simple));   // ensure it is persistent  assert(cheats.isPersistent(address(simple)));   // revoke it  cheats.revokePersistent(address(simple));   // contract no longer persistent  assert(!cheats.isPersistent(address(simple))); } ``` ### SEE ALSO - [isPersistent](./is-persistent.md) - [revokePersistent](./revoke-persistent.md) - [createFork](./create-fork.md) - [selectFork](./select-fork.md) ",290
59,divisionError.md,"divisionError.md. ## `divisionError` ### Signature ```solidity stdError.divisionError ``` ### Description The internal Solidity error when a division fails, e.g. division by zero.",39
60,forge-bind.md,"forge-bind.md. ## forge bind ### NAME forge-bind - Generate Rust bindings for smart contracts. ### SYNOPSIS ``forge bind`` [*options*] ### DESCRIPTION Generates Rust bindings for smart contracts using [ethers-rs](https://github.com/gakonst/ethers-rs). The bindings are generated from the project's artifacts, which by default is `./out/`. If you want to generate bindings for artifacts in a different directory, pass `--bindings-path <PATH>`. There are three output options: - Generate bindings in a crate (default) - Generate bindings in a module by passing `--module` - Generate bindings in a single file by passing `--single-file` By default, the command will check that existing bindings are correct and exit accordingly. You can overwrite the existing bindings by passing `--overwrite`. ### OPTIONS #### Project Options `-b` *path* `--bindings-path` *path* &nbsp;&nbsp;&nbsp;&nbsp;The project's root path. By default, this is the root directory of the current git repository, or the current working directory. `--crate-name` *name* &nbsp;&nbsp;&nbsp;&nbsp;The name of the Rust crate to generate, if you are generating a crate (default). &nbsp;&nbsp;&nbsp;&nbsp;This should be a valid crates.io crate name. &nbsp;&nbsp;&nbsp;&nbsp;Default: foundry-contracts `--crate-version` *semver* &nbsp;&nbsp;&nbsp;&nbsp;The version of the Rust crate to generate, if you are generating a crate (default). &nbsp;&nbsp;&nbsp;&nbsp;This should be a standard semver version string. &nbsp;&nbsp;&nbsp;&nbsp;Default: 0.0.1 `--module` &nbsp;&nbsp;&nbsp;&nbsp;Generate the bindings as a module instead of a crate. `--single-file` &nbsp;&nbsp;&nbsp;&nbsp;Generate bindings as a single file. `--overwrite` &nbsp;&nbsp;&nbsp;&nbsp;Overwrite existing generated bindings. By default, the command will check that the bindings are correct, and then exit. &nbsp;&nbsp;&nbsp;&nbsp;If `--overwrite` is passed, it will instead delete and overwrite the bindings. `--root` *path* &nbsp;&nbsp;&nbsp;&nbsp;The project's root path.",493
61,forge-clean.md,forge-clean.md. ## forge clean ### NAME forge-clean - Remove the build artifacts and cache directories. ### SYNOPSIS ``forge clean`` [*options*] ### DESCRIPTION Remove the build artifacts and cache directories. ### OPTIONS #### Clean Options `--root` *path* &nbsp;&nbsp;&nbsp;&nbsp;The project's root path. Defaults to the current working directory. {{#include common-options.md}} ### EXAMPLES 1. Clean artifacts and cache in a project:  ```sh  forge clean  ``` ### SEE ALSO [forge](./forge.md) ,115
62,forge-script.md,"forge-script.md. ## forge script ### NAME forge-script - Run a smart contract as a script, building transactions that can be sent onchain. ### SYNOPSIS ``forge script`` [*options*] *path* [*args...*] ### DESCRIPTION Run a smart contract as a script, building transactions that can be sent onchain. Scripts can be used to apply state transitions on live contracts, or deploy and initialize a complex set of smart contracts using Solidity. ### OPTIONS `--broadcast` &nbsp;&nbsp;&nbsp;&nbsp;Broadcasts the transactions. `--debug` &nbsp;&nbsp;&nbsp;&nbsp;Open the script in the [debugger][debugger]. Takes precedence over broadcast. `-g` `--gas-estimate-multiplier` *multiplier* &nbsp;&nbsp;&nbsp;&nbsp;Relative percentage by which to multiply all gas estimates. (i.e. set to 200 to double them) &nbsp;&nbsp;&nbsp;&nbsp;Default: 130 `--json` &nbsp;&nbsp;&nbsp;&nbsp;Output results in JSON format. &nbsp;&nbsp;&nbsp;&nbsp;Note: The output is under development and prone to change. `--legacy` &nbsp;&nbsp;&nbsp;&nbsp;Use legacy transactions instead of EIP1559 ones. This is auto-enabled for common networks without EIP1559. `--resume` &nbsp;&nbsp;&nbsp;&nbsp;Resumes submitting transactions that failed or timed-out previously. `-s` `--sig` *signature* &nbsp;&nbsp;&nbsp;&nbsp;The signature of the function you want to call in the contract, or raw calldata. &nbsp;&nbsp;&nbsp;&nbsp;Default: `run()` `--skip-simulation` &nbsp;&nbsp;&nbsp;&nbsp;Skips on-chain simulation. `--slow` &nbsp;&nbsp;&nbsp;&nbsp;Makes sure a transaction is sent, only after its previous one has been confirmed and succeeded. `--target-contract` *contract_name* &nbsp;&nbsp;&nbsp;&nbsp;The name of the contract you want to run. `--with-gas-price` *price* &nbsp;&nbsp;&nbsp;&nbsp;Sets the gas price for **broadcasted** legacy transactions, or the max fee for broadcasted EIP1559 transactions.",479
63,general-commands.md,general-commands.md. ## General Commands - [cast](./cast.md) - [cast help](./cast-help.md) - [cast completions](./cast-completions.md) ,40
64,fs.md,"fs.md. ## File cheat codes ### Signature ```solidity // Reads the entire content of file to string, (path) => (data) function readFile(string calldata) external returns (string memory); // Reads next line of file to string, (path) => (line) function readLine(string calldata) external returns (string memory); // Writes data to file, creating a file if it does not exist, and entirely replacing its contents if it does. // (path, data) => () function writeFile(string calldata, string calldata) external; // Writes line to file, creating a file if it does not exist. // (path, data) => () function writeLine(string calldata, string calldata) external; // Closes file for reading, resetting the offset and allowing to read it from beginning with readLine. // (path) => () function closeFile(string calldata) external; // Removes file. This cheatcode will revert in the following situations, but is not limited to just these cases: // - Path points to a directory. // - The file doesn't exist. // - The user lacks permissions to remove the file. // (path) => () function removeFile(string calldata) external; ``` ### Description These cheatcodes provided by [forge-std](https://github.com/foundry-rs/forge-std) can be used for filesystem manipulation operations. By default, filesystem access is disallowed and requires the `fs_permission` setting in `foundry.toml`: ```toml # Configures permissions for cheatcodes that touch the filesystem like `vm.writeFile` # `access` restricts how the `path` can be accessed via cheatcodes # `read-write` | `true` => `read` + `write` access allowed (`vm.readFile` + `vm.writeFile`) # `none`| `false` => no access # `read` => only read access (`vm.readFile`) # `write` => only write access (`vm.writeFile`) # The `allowed_paths` further lists the paths that are considered, e.g.",425
65,compiler-options.md,"compiler-options.md. #### Compiler Options `--optimize` &nbsp;&nbsp;&nbsp;&nbsp;Activate the Solidity optimizer. `--optimizer-runs` *runs* &nbsp;&nbsp;&nbsp;&nbsp;The number of optimizer runs. `--via-ir` &nbsp;&nbsp;&nbsp;&nbsp;Use the Yul intermediate representation compilation pipeline. `--revert-strings` &nbsp;&nbsp;&nbsp;&nbsp;How to treat revert and require reason strings. `--use` *solc_version* &nbsp;&nbsp;&nbsp;&nbsp;Specify the solc version, or a path to a local solc, to build with. &nbsp;&nbsp;&nbsp;&nbsp;Valid values are in the format `x.y.z`, `solc:x.y.z` or `path/to/solc`. `--offline` &nbsp;&nbsp;&nbsp;&nbsp;Do not access the network. Missing solc versions will not be installed. `--no-auto-detect` &nbsp;&nbsp;&nbsp;&nbsp;Do not auto-detect solc. `--ignored-error-codes` *error_codes* &nbsp;&nbsp;&nbsp;&nbsp;Ignore solc warnings by error code. The parameter is a comma-separated list of error codes. `--extra-output` *selector* &nbsp;&nbsp;&nbsp;&nbsp;Extra output to include in the contract's artifact. &nbsp;&nbsp;&nbsp;&nbsp;Example keys: `abi`, `storageLayout`, `evm.assembly`, `ewasm`, `ir`, `ir-optimized`, `metadata`. &nbsp;&nbsp;&nbsp;&nbsp;For a full description, see the [Solidity docs][output-desc]. `--extra-output-files` *selector* &nbsp;&nbsp;&nbsp;&nbsp;Extra output to write to separate files. &nbsp;&nbsp;&nbsp;&nbsp;Example keys: `abi`, `storageLayout`, `evm.assembly`, `ewasm`, `ir`, `ir-optimized`, `metadata`. &nbsp;&nbsp;&nbsp;&nbsp;For a full description, see the [Solidity docs][output-desc]. `--evm-version` *version* &nbsp;&nbsp;&nbsp;&nbsp;The target EVM version. [output-desc]: https://docs.soliditylang.org/en/latest/using-the-compiler.html#compiler-api ",491
66,multi-wallet-options.md,multi-wallet-options.md. {{#include multi-wallet-options-raw.md}} {{#include multi-wallet-options-keystore.md}} {{#include multi-wallet-options-hardware.md}} {{#include multi-wallet-options-remote.md}},51
67,fork-testing.md,"fork-testing.md. ## Fork Testing Forge supports testing in a forked environment with two different approaches: - [**Forking Mode**](#forking-mode) — use a single fork for all your tests via the `forge test --fork-url` flag - [**Forking Cheatcodes**](#forking-cheatcodes) — create, select, and manage multiple forks directly in Solidity test code via [forking cheatcodes](../cheatcodes/forking.md) Which approach to use? Forking mode affords running an entire test suite against a specific forked environment, while forking cheatcodes provide more flexibility and expressiveness to work with multiple forks in your tests. Your particular use case and testing strategy will help inform which approach to use. ### Forking Mode To run all tests in a forked environment, such as a forked Ethereum mainnet, pass an RPC URL via the `--fork-url` flag: ```bash forge test --fork-url <your_rpc_url> ``` The following values are changed to reflect those of the chain at the moment of forking: - [`block_number`](../reference/config/testing.md#block_number) - [`chain_id`](../reference/config/testing.md#chain_id) - [`gas_limit`](../reference/config/testing.md#gas_limit) - [`gas_price`](../reference/config/testing.md#gas_price) - [`block_base_fee_per_gas`](../reference/config/testing.md#block_base_fee_per_gas) - [`block_coinbase`](../reference/config/testing.md#block_coinbase) - [`block_timestamp`](../reference/config/testing.md#block_timestamp) - [`block_difficulty`](../reference/config/testing.md#block_difficulty) It is possible to specify a block from which to fork with `--fork-block-number`: ```bash forge test --fork-url <your_rpc_url> --fork-block-number 1 ``` Forking is especially useful when you need to interact with existing contracts. You may choose to do integration testing this way, as if you were on an actual network. #### Caching If both `--fork-url` and `--fork-block-number` are specified, then data for that block is cached for future test runs. The data is cached in `~/.foundry/cache/rpc/<chain name>/<block number>`.",471
68,fork-testing.md,"To clear the cache, simply remove the directory or run [`forge clean`](../reference/forge/forge-clean.md) (removes all build artifacts and cache directories). It is also possible to ignore the cache entirely by passing `--no-storage-caching`, or with `foundry.toml` by configuring [`no_storage_caching`](../reference/config/testing.md#no_storage_caching) and [`rpc_storage_caching`](../reference/config/testing.md#rpc_storage_caching). #### Improved traces Forge supports identifying contracts in a forked environment with Etherscan. To use this feature, pass the Etherscan API key via the `--etherscan-api-key` flag: ```bash forge test --fork-url <your_rpc_url> --etherscan-api-key <your_etherscan_api_key> ``` Alternatively, you can set the `ETHERSCAN_API_KEY` environment variable. ### Forking Cheatcodes Forking cheatcodes allow you to enter forking mode programatically in your Solidity test code. Instead of configuring forking mode via `forge` CLI arguments, these cheatcodes allow you to use forking mode on a test-by-test basis and work with multiple forks in your tests. Each fork is identified via its own unique `uint256` identifier. #### Usage Important to keep in mind that _all_ test functions are isolated, meaning each test function is executed with a _copy_ of the state _after_ `setUp` and is executed in its own stand-alone EVM. Therefore forks created during `setUp` are available in tests. The code example below uses [`createFork`](../cheatcodes/create-fork.md) to create two forks, but does _not_ select one initially. Each fork is identified with a unique identifier (`uint256 forkId`), which is assigned when it is first created. Enabling a specific fork is done via passing that `forkId` to [`selectFork`](../cheatcodes/select-fork.md). [`createSelectFork`](../cheatcodes/create-select-fork.md) is a one-liner for `createFork` plus `selectFork`. There can only be one fork active at a time, and the identifier for the currently active fork can be retrieved via [`activeFork`](../cheatcodes/active-fork.md).",473
69,fork-testing.md,"Similar to [`roll`](../cheatcodes/roll.md), you can set `block.number` of a fork with [`rollFork`](../cheatcodes/roll-fork.md). To understand what happens when a fork is selected, it is important to know how the forking mode works in general: Each fork is a standalone EVM, i.e. all forks use completely independent storage. The only exception is the state of the `msg.sender` and the test contract itself, which are persistent across fork swaps. In other words all changes that are made while fork `A` is active (`selectFork(A)`) are only recorded in fork `A`'s storage and are not available if another fork is selected. However, changes recorded in the test contract itself (variables) are still available because the test contract is a _persistent_ account. The `selectFork` cheatcode sets the _remote_ section with the fork's data source, however the _local_ memory remains persistent across fork swaps. This also means `selectFork` can be called at all times with any fork, to set the _remote_ data source. However, it is important to keep in mind the above rules for `read/write` access always apply, meaning _writes_ are persistent across fork swaps.",266
70,fork-testing.md,"Only the accounts of `msg.sender` and the test contract (`ForkTest`) are persistent when forks are selected. But any account can be turned into a persistent account: [`makePersistent`](../cheatcodes/make-persistent.md). An account that is _persistent_ is unique, i.e.",62
71,transact.md,"transact.md. ## `transact` ### Signature ```solidity // Fetches the given transaction from the active fork and executes it on the current state function transact(bytes32 txHash) external; // Fetches the given transaction from the given fork and executes it on the current state function transact(uint256 forkId, bytes32 txHash) external; ``` ### Description In forking mode, fetches the Transaction from the provider and executes it on the current state ### Examples Enter forking mode and execute a transaction: ```solidity // Enter forking mode at block: https://etherscan.io/block/15596646 uint256 fork = vm.createFork(MAINNET_RPC_URL, 15596646); vm.selectFork(fork); // a random transfer transaction in the block: https://etherscan.io/tx/0xaba74f25a17cf0d95d1c6d0085d6c83fb8c5e773ffd2573b99a953256f989c89 bytes32 tx = 0xaba74f25a17cf0d95d1c6d0085d6c83fb8c5e773ffd2573b99a953256f989c89; address sender = address(0xa98218cdc4f63aCe91ddDdd24F7A580FD383865b); address recipient = address(0x0C124046Fa7202f98E4e251B50488e34416Fc306); assertEq(sender.balance, 5764124000000000); assertEq(recipient.balance, 3936000000000000); // transfer amount: 0.003936 Ether uint256 transferAmount = 3936000000000000; // expected balance changes once the transaction is executed uint256 expectedRecipientBalance = recipient.balance + transferAmount; uint256 expectedSenderBalance = sender.balance - transferAmount; // execute the transaction vm.transact(tx); // recipient received transfer assertEq(recipient.balance, expectedRecipientBalance); // sender's balance decreased by transferAmount and gas assert(sender.balance < expectedSenderBalance); ``` ### SEE ALSO - [roll](./roll.md) - [createFork](./create-fork.md) - [selectFork](./select-fork.md) - [activeFork](./active-fork.md) ",491
72,cast--from-rlp.md,cast--from-rlp.md. ## cast --from-rlp ### NAME cast---from-rlp - Decodes RLP-encoded data. ### SYNOPSIS ``cast --from-rlp`` *data* ### DESCRIPTION Decodes RLP-encoded data. The *data* is a hexadecimal string with optional 0x prefix. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Decode RLP data:  ```sh  cast --from-rlp 0xc481f181f2  cast --from-rlp c481f181f2  ``` ,123
73,forge-cache-ls.md,"forge-cache-ls.md. ## `forge cache ls` ### NAME forge-cache-ls - Shows cached data from ``~/.foundry``. ### SYNOPSIS `forge cache ls` [*chains..*] ### DESCRIPTION Lists what is in the `~/.foundry/cache` folder currently. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Show the entire cache (also, ``forge cache ls`` is an alias for this)  ```sh  forge cache ls all  ``` 2. Show cache data for a specific chain, by name  ```sh  forge cache ls rinkeby  ```  3. Specify multiple chains  ```sh  forge cache ls rinkeby mainnet  ``` ### SEE ALSO [forge](./forge.md), [forge cache](./forge-cache.md)",168
74,sig-description.md,"sig-description.md. The signature (*sig*) can be: - A fragment: `someFunction(uint256,bytes32)` - A selector and encoded calldata: `0xcdba2fd40000000000000000000000000000000000000000000000000000000000007a69` - Only the function name: in this case Cast will try to fetch the function signature from Etherscan ",85
75,enumConversionError.md,"enumConversionError.md. ## `enumConversionError` ### Signature ```solidity stdError.enumConversionError ``` ### Description The internal Solidity error when trying to convert a number to a variant of an enum, if the number is larger than the number of variants in the enum (counting from 0).",62
76,hardhat.md,"hardhat.md. ## Integrating with Hardhat It's possible to have your Foundry project work alongside [Hardhat](https://hardhat.org/). This assumes that you have a working Foundry project and want to add Hardhat. It also assumes familiarity with Hardhat. ### Why does this not work out of the box? Hardhat by default expects libraries to be installed in `node_modules`, the default folder for all NodeJS dependencies. Foundry expects them to be in `lib`. Of course [we can configure Foundry](../reference/config/overview.md) but not easily to the directory structure of `node_modules`. For this reason, the recommended setup is to use [hardhat-preprocessor](https://www.npmjs.com/package/hardhat-preprocessor). Hardhat-preprocessor is, as the name suggests, a Hardhat plugin which allows us to preprocess our contracts before they are run through the Solidity compiler. We use this to modify the import directives in our Solidity files to resolve absolute paths to the libraries based on the Foundry `remappings.txt` file before Hardhat attempts to compile them. This of course just happens in memory so your actual Solidity files are never changed. Now, Hardhat is happy to comply and compiles using the libraries you installed with Foundry. ### Just show me the example repo! [Enjoy!](https://github.com/foundry-rs/hardhat-foundry-template) If you want to adapt this to a Foundry project you already have or learn how it works, read below: ### Instructions Inside your Foundry project working directory: 1. `npm init` - Setup your project details as usual. 2. `npm install --save-dev hardhat` - Install Hardhat. 3. `npx hardhat` - Setup your Hardhat project as you see fit in the same directory. 4. `forge remappings > remappings.txt` - You will need to re-run this every time you modify libraries in Foundry. Now you need to make the following changes to your Hardhat project. The following assumes a TypeScript setup: 1. `npm install --save-dev hardhat-preprocessor` - [Details on hardhat-preprocessor](https://www.npmjs.com/package/hardhat-preprocessor) 2. Add `import ""hardhat-preprocessor"";` to your `hardhat.config.ts` file. 3.",497
77,hardhat.md,"Ensure the following function is present (you can add it to your `hardhat.config.ts` file or somewhere else and import it - also ensure `import fs from ""fs"";` is present in the file it is added): ```typescript function getRemappings() { return fs  .readFileSync(""remappings.txt"", ""utf8"")  .split(""\n"")  .filter(Boolean) // remove empty lines  .map((line) => line.trim().split(""="")); } ``` *Thanks to [@DrakeEvansV1](https://twitter.com/drakeevansv1) and [@colinnielsen](https://github.com/colinnielsen) for this snippet* 4. Add the following to your exported `HardhatUserConfig` object: ```typescript ... preprocess: { eachLine: (hre) => ({  transform: (line: string) => {  if (line.match(/^\s*import /i)) {   for (const [from, to] of getRemappings()) {   if (line.includes(from)) {    line = line.replace(from, to);    break;   }   }  }  return line;  }, }), }, paths: { sources: ""./src"", cache: ""./cache_hardhat"", }, ... ``` Now, Hardhat should work well with Foundry. You can run Foundry tests or Hardhat tests / scripts and have access to your contracts. ### Use Foundry in an existing Hardhat project Suppose that you already have a Hardhat project with some dependencies such as `@OpenZeppelin/contracts` in directory `node_modules/`. You can use Foundry test in this project in 4 steps. Before we start, let's take a look at the directories: - Contracts are in `contracts` - Hardhat unit test is in `test`, and we will put Foundry test files in `test/foundry` - Hardhat puts its cache in `cache`, and we will put Foundry cache in `forge-cache` ### 4 steps to add Foundry test 1. Copy `lib/forge-std` from a newly-created empty Foundry project to this Hardhat project directory. A note: you can also run `forge init --force` to init a Foundry project in this non-empty directory and remove unneeded directories created by Foundry init. 2.",487
78,make-addr-and-key.md,"make-addr-and-key.md. ## `makeAddrAndKey` ### Signature ```solidity function makeAddrAndKey(string memory name) internal returns(address addr, uint256 privateKey); ``` ### Description Creates an address and private key derived from the provided `name`. A [`label`](../../cheatcodes/label.md) is created for the derived address with the provided `name` used as the label value. ### Examples ```solidity (address alice, uint256 key) = makeAddrAndKey(""alice""); emit log_address(alice); // 0x328809bc894f92807417d2dad6b7c998c1afdac6 emit log_uint(key); // 70564938991660933374592024341600875602376452319261984317470407481576058979585 ``` ",170
79,startHoax.md,"startHoax.md. ## `startHoax` ### Signature ```solidity function startHoax(address who) public; ``` ```solidity function startHoax(address who, uint256 give) public; ``` ```solidity function startHoax(address who, address origin) public; ``` ```solidity function startHoax(address who, address origin, uint256 give) public; ``` ### Description Start a [perpetual `prank`](../../cheatcodes/start-prank.md) from an address that has some ether. If the balance is not specified, it will be set to 2^128 wei.",126
80,account-commands.md,account-commands.md. ## Account Commands - [cast balance](./cast-balance.md) - [cast storage](./cast-storage.md) - [cast proof](./cast-proof.md) - [cast nonce](./cast-nonce.md) - [cast code](./cast-code.md) ,61
81,resume-gas-metering.md,resume-gas-metering.md. ## `resumeGasMetering` ### Signature ```solidity function resumeGasMetering() external; ``` ### Description Resumes gas metering (i.e. `gasleft()` will decrease as operations are executed). Gas usage will resume at the same amount at which it was paused.,64
82,etch.md,"etch.md. ## `etch` ### Signature ```solidity function etch(address who, bytes calldata code) external; ``` ### Description Sets the bytecode of an address `who` to `code`. ### Examples ```solidity bytes memory code = address(awesomeContract).code; address targetAddr = address(1); vm.etch(targetAddr, code); log_bytes(address(targetAddr).code); // 0x6080604052348015610010... ``` ### SEE ALSO Forge Standard Library [`deployCode`](../reference/forge-std/deployCode.md)",116
83,anvil_README.md,"anvil_README.md. ## Overview of Anvil Anvil is a local testnet node shipped with Foundry. You can use it for testing your contracts from frontends or for interacting over RPC. Anvil is part of the Foundry suite and is installed alongside `forge`, `cast`, and `chisel`. If you haven't installed Foundry yet, see [Foundry installation](../getting-started/installation.md). > Note: If you have an older version of Foundry installed, you'll need to re-install `foundryup` in order for Anvil to be downloaded. ### How to use Anvil To use Anvil, simply type `anvil`. You should see a list of accounts and private keys available for use, as well as the address and port that the node is listening on. Anvil is highly configurable. You can run `anvil -h` to see all the configuration options. Some basic options are: ```bash # Number of dev accounts to generate and configure. [default: 10] anvil -a, --accounts <ACCOUNTS> # The EVM hardfork to use. [default: latest] anvil --hardfork <HARDFORK> # Port number to listen on. [default: 8545] anvil -p, --port <PORT> ``` > 📚 **Reference** > > See the [`anvil` Reference](../reference/anvil/) for in depth information on Anvil and its capabilities. ",307
84,ref_chisel_README.md,"ref_chisel_README.md. ## chisel ### NAME `chisel` - Test and receive verbose feedback on Solidity inputs within a REPL environment. ### SYNOPSIS `chisel` [*options*] #### Subcommands (bin) 1. `chisel list`  * Displays all cached sessions stored in `~/.foundry/cache/chisel`. 1. `chisel load <id>`  * If a cached session with `id = <id>` exists, launches the REPL and loads the corresponding session. 1. `chisel view <id>`  * If a cached session with `id = <id>` exists, displays the source code of the session's REPL contract. 1. `chisel clear-cache`  * Deletes all cache files within the `~/.foundry/cache/chisel` directory. These sessions are unrecoverable, so use this command with care. #### Flags See `man chisel` or `chisel --help` for all available environment configuration flags. ### DESCRIPTION Chisel is a Solidity REPL (short for ""read-eval-print loop"") that allows developers to write and test Solidity code snippets. It provides an interactive environment for writing and executing Solidity code, as well as a set of built-in commands for working with and debugging your code. This makes it a useful tool for quickly testing and experimenting with Solidity code without having to spin up a sandbox foundry test suite. ### Usage To open chisel, simply execute the `chisel` binary. From there, input valid Solidity code. There are two kinds of inputs to the chisel prompt apart from commands: 1. Expressions  * Expressions are statements that return a value or otherwise can be evaluated on their own. For example,  `1 << 8` is an expression that will evaluate to a `uint256` with the value `256`. Expressions will be  evaluated up front, and will not persist in the session state past their evaluation.  * Examples:   * `address(0).balance`   * `abi.encode(256, bytes32(0), ""Chisel!"")`   * `myViewFunc(128)`   * ... 1. Statements  * Statements are snippets of code that are meant to persist in the session's state.",473
85,ref_chisel_README.md,"Statements include  variable definitions, calls to non-state-mutating functions that return a value, and contract, function,  event, error, mapping, or struct definitions. If you would like an expression to be evaluated as a statement,  a semi-colon (`;`) can be appended to the end.  * Examples:   * `uint256 a = 0xa57b`   * `myStateMutatingFunc(128)` || `myViewFunc(128);` <- Notice the `;`   * ```solidity   function hash64(    bytes32 _a,    bytes32 _b   ) internal pure returns (bytes32 _hash) {    assembly {     // Store the 64 bytes we want to hash in scratch space     mstore(0x00, _a)     mstore(0x20, _b)     // Hash the memory in scratch space     // and assign the result to `_hash`     _hash := keccak256(0x00, 0x40)    }   }   ```   * `event ItHappened(bytes32 indexed hash)`   * `struct Complex256 { uint256 re; uint256 im; }`   * ... #### Available Commands ```text ⚒️ Chisel help ============= General   !help | !h - Display all commands   !quit | !q - Quit Chisel   !exec <command> [args] | !e <command> [args] - Execute a shell command and print the output Session   !clear | !c - Clear current session source   !source | !so - Display the source code of the current session   !save [id] | !s [id] - Save the current session to cache   !load <id> | !l <id> - Load a previous session ID from cache   !list | !ls - List all cached sessions   !clearcache | !cc - Clear the chisel cache of all stored sessions   !export | !ex - Export the current session source to a script file   !fetch <addr> <name> | !fe <addr> <name> - Fetch the interface of a verified contract on Etherscan   !edit - Open the current session in an editor Environment   !fork <url> | !f <url> - Fork an RPC for the current session.",487
86,ref_chisel_README.md,"Supply 0 arguments to return to a local network   !traces | !t - Enable / disable traces for the current session Debug   !memdump | !md - Dump the raw memory of the current state   !stackdump | !sd - Dump the raw stack of the current state   !rawstack <var> | !rs <var> - Display the raw value of a variable's stack allocation. For variables that are > 32 bytes in length, this will display their memory pointer. ``` **General** `!help` | `!h` Display all commands. `!quit` | `!q` Quit Chisel. `!exec <command> [args]` | `!e <command> [args]` Execute a shell command and print the output. Example: ```sh ➜ !e ls CHANGELOG.md LICENSE README.md TESTS.md artifacts cache contracts crytic-export deploy deploy-config deployments dist echidna.yaml forge-artifacts foundry.toml hardhat.config.ts layout-lock.json node_modules package.json scripts slither.config.json slither.db.json src tasks test-case-generator tsconfig.build.json tsconfig.build.tsbuildinfo tsconfig.json ``` **Session** `!clear` | `!c` Clear current session source. Under the hood, each Chisel session has an underlying contract that is altered as you input statements. This command clears this contract and resets your session to the default state. `!source` | `!so` Display the source code of the current session. As mentioned above, each Chisel session has an underlying contract. This command will display the source code of this contract. `!save [id]` | `!s [id]` Save the current session to cache. Chisel allows for caching sessions, which can be very useful if you are testing more complex logic in Chisel or if you want to return to a session at a later time. All cached Chisel sessions are stored in `~/.foundry/cache/chisel`. If an `id` argument is not supplied, Chisel will automatically assign a numerical ID to the session you are saving. `!load <id>` | `!l <id>` Load a previous session ID from cache. This command will load a previously cached session from the cache. Along with the session's source, all environment settings will also be loaded.",482
87,ref_chisel_README.md,"The `id` argument must correspond with an existing cached session in the `~/.foundry/cache/chisel` directory. `!list` | `!ls` List all cached sessions. This command will display all cached chisel sessions within the `~/.foundry/cache/chisel` directory. `!clearcache` | `!cc` Clear the chisel cache of all stored sessions. Deletes all cache files within the `~/.foundry/cache/chisel` directory. These sessions are unrecoverable, so use this command with care. `!export` | `!ex` Export the current session source to a script file. If `chisel` was executed from the root directory of a foundry project, it is possible to export your current session to a foundry script in the `scripts` dir of your project. `!fetch <addr> <name>` | `!fe <addr> <name>` Fetch the interface of a verified contract on Etherscan. This command will attempt to parse the interface of a verified contract @ `<addr>` from the Etherscan API. If successful, the interface will be inserted into the session source with the name `<name>`. At the moment, only interfaces of verified contracts on Ethereum mainnet can be fetched. In the future, Chisel will support fetching interfaces from multiple Etherscan-supported chains. `!edit` Open the current session's `run()` function in an editor. chisel will use the editor defined in the `$EDITOR` environment variable. **Environment** `!fork <url>` | `!f <url>` Fork an RPC for the current session. Supply 0 arguments to return to a local network. Attempts to fork the state of the provided RPC. If no URL is provided, returns to using a blank, local devnet state. `!traces` | `!t` Enable / disable traces for the current session. When tracing is enabled, foundry-style call tracing and logs will be printed after each statement is inserted. **Debug** `!memdump` | `!md` Dump the raw memory of the current state. Attempts to dump the raw memory of the machine state after the last instruction of the REPL contract's `run` function has finished executing. `!stackdump` | `!sd` Dump the raw stack of the current state.",481
88,parse-uint.md,"parse-uint.md. ## `parseUint` ### Signature ```solidity function parseUint(string calldata stringifiedValue) external pure returns (uint256 parsedValue); ``` ### Description Parses the value of `string` into `uint256` ### Examples ```solidity string memory uintAsString = ""12345""; uint256 stringToUint = vm.parseUint(uintAsString); // 12345 ``` ",81
89,ref_forge-std_README.md,"ref_forge-std_README.md. ## Forge Standard Library Reference Forge Standard Library (Forge Std for short) is a collection of helpful contracts that make writing tests easier, faster, and more user-friendly. Using Forge Std is the preferred way of writing tests with Foundry. What's included: - `Vm.sol`: Up-to-date [cheatcodes interface](../../cheatcodes/#cheatcodes-interface)  ```solidity  import ""forge-std/Vm.sol"";  ``` - [`console.sol`](./console-log.md) and `console2.sol`: Hardhat-style logging functionality  ```solidity  import ""forge-std/console.sol"";  ```  **Note:** `console2.sol` contains patches to `console.sol` that allow Forge to decode traces for calls to the console, but it is not compatible with Hardhat.  ```solidity  import ""forge-std/console2.sol"";  ``` - `Script.sol`: Basic utilities for [Solidity scripting](../../tutorials/solidity-scripting.md)  ```solidity  import ""forge-std/Script.sol"";  ``` - `Test.sol`: The complete Forge Std experience (more details [below](#forge-stds-test))  ```solidity  import ""forge-std/Test.sol"";  ``` ### Forge Std's `Test` The `Test` contract in `Test.sol` provides all the essential functionality you need to get started writing tests. Simply import `Test.sol` and inherit from `Test` in your test contract: ```solidity import ""forge-std/Test.sol""; contract ContractTest is Test { ... ``` What's included: - Std Libraries - [Std Logs](./std-logs.md): Expand upon the logging events from the DSTest library. - [Std Assertions](./std-assertions.md): Expand upon the assertion functions from the DSTest library. - [Std Cheats](./std-cheats.md): Wrappers around Forge cheatcodes for improved safety and DX. - [Std Errors](./std-errors.md): Wrappers around common internal Solidity errors and reverts. - [Std Storage](./std-storage.md): Utilities for storage manipulation. - [Std Math](./std-math.md): Useful mathematical functions. - [Script Utils](./script-utils.md): Utility functions which can be accessed in tests and scripts. - [Console Logging](./console-log.md): Console logging functions.",495
90,cast--to-unit.md,"cast--to-unit.md. ## cast --to-unit ### NAME cast---to-unit - Convert an eth amount to another unit. ### SYNOPSIS ``cast --to-unit`` [*options*] *value* [*unit*] ### DESCRIPTION Convert an eth amount to another unit. The value to convert (*value*) can be a quantity of eth (in wei), or a number with a unit attached to it. Valid units are: - `ether` - `gwei` - `wei` ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Convert 1000 wei to gwei  ```sh  cast --to-unit 1000 gwei  ``` 2. Convert 1 eth to gwei  ```sh  cast --to-unit 1ether gwei  ``` ### SEE ALSO [cast](./cast.md) ",174
91,continous-integration.md,"continous-integration.md. ## Continuous Integration ### GitHub Actions To test your project using GitHub Actions, here is a sample workflow: ```yml on: [push] name: test jobs: check:  name: Foundry project  runs-on: ubuntu-latest  steps:  - uses: actions/checkout@v3   with:   submodules: recursive  - name: Install Foundry   uses: foundry-rs/foundry-toolchain@v1   with:   version: nightly  - name: Run tests   run: forge test -vvv ``` ### Travis CI To test your project using Travis CI, here is a sample workflow: ```yml language: rust cache: cargo: true directories:  - $HOME/.foundry install: - curl -L https://foundry.paradigm.xyz | bash - export PATH=$PATH:$HOME/.foundry/bin - foundryup -b master script: - forge test -vvv ``` ## GitLab CI To test your project using GitLab CI, here is a sample workflow: Note: check out [Policy](https://docs.gitlab.com/runner/executors/docker.html#how-pull-policies-work) to fetch the remote image ```yml variables: GIT_SUBMODULE_STRATEGY: recursive jobs: image: ghcr.io/foundry-rs/foundry script:  - forge install  - forge test -vvv ``` ",292
92,cast-keccak.md,cast-keccak.md. ## cast keccak ### NAME cast-keccak - Hash arbitrary data using keccak-256. ### SYNOPSIS ``cast keccak`` [*options*] *data* ### DESCRIPTION Hash arbitrary data using keccak-256. ### OPTIONS {{#include common-options.md}} ### SEE ALSO [cast](./cast.md) ,72
93,README.md,"README.md. <img src=""images/foundry-banner.png"" style=""border-radius: 20px""> Foundry is a smart contract development toolchain. Foundry manages your dependencies, compiles your project, runs tests, deploys, and lets you interact with the chain from the command-line and via Solidity scripts. > 📖 **Contributing** > > You can contribute to this book on [GitHub](https://github.com/foundry-rs/book). ### Sections **[Getting Started](getting-started/installation.md)** To get started with Foundry, install Foundry and set up your first project. **[Projects](projects/creating-a-new-project.md)** This section will give you an overview of how to create and work with existing projects. **[Forge Overview](forge)** The overview will give you all you need to know about how to use `forge` to develop, test, and deploy smart contracts. **[Cast Overview](cast)** Learn how to use `cast` to interact with smart contracts, send transactions, and get chain data from the command-line. **[Anvil Overview](anvil)** Learn about `anvil`, Foundry's local node. **[Chisel Overview](chisel)** Learn how to use `chisel`, Foundry's integrated Solidity REPL. **Configuration** Guides on configuring Foundry. - [Configuring with `foundry.toml`](./config/) - [Continuous Integration](./config/continous-integration.md) - [Integrating with VSCode](./config/vscode.md) - [Shell Autocompletion](./config/shell-autocompletion.md) - [Static Analyzers](./config/static-analyzers.md) - [Integrating with Hardhat](./config/hardhat.md) **Tutorials** Tutorials on building smart contracts with Foundry.",383
94,cast--parse-bytes32-string.md,"cast--parse-bytes32-string.md. ## cast --parse-bytes32-string ### NAME cast---parse-bytes32-string - Parses a string from bytes32 encoding. ### SYNOPSIS ``cast --parse-bytes32-string`` [*options*] *bytes* ### DESCRIPTION Parses a [Solidity string literal](https://docs.soliditylang.org/en/v0.8.16/types.html#string-literals-and-types) from its bytes32 encoding representation mostly by interpreting bytes as ASCII characters. This command undos the encoding in [--format-bytes32-string](./cast--format-bytes32-string.md). ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Parse bytes32 string encoding of ""hello"" back to the string representation:  ```sh  cast --parse-bytes32-string ""0x68656c6c6f000000000000000000000000000000000000000000000000000000""  ``` ### SEE ALSO [cast](./cast.md) ",209
95,rpc.md,"rpc.md. ## RPC related cheatcodes ### Signature ```solidity // Returns the URL for a configured alias function rpcUrl(string calldata alias) external returns(string memory); // Returns all configured (alias, URL) pairs function rpcUrls() external returns(string[2][] memory); ``` ### Description Provides cheatcodes to access all RPC endpoints configured in the `rpc_endpoints` object of the `foundry.toml` ### Examples The following `rpc_endpoints` in `foundry.toml` registers two RPC aliases: - `optimism` references the URL directly - `mainnet` references the `RPC_MAINNET` environment value that is expected to contain the actual URL *Env variables need to be wrapped in `${}`* ```toml # --snip-- [rpc_endpoints] optimism = ""https://optimism.alchemyapi.io/v2/..."" mainnet = ""${RPC_MAINNET}"" ``` ```solidity string memory url = vm.rpcUrl(""optimism""); assertEq(url, ""https://optimism.alchemyapi.io/v2/...""); ``` If a ENV var is missing, `rpcUrl()` will revert: ```solidity vm.expectRevert(""Failed to resolve env var `${RPC_MAINNET}` in `RPC_MAINNET`: environment variable not found""); string memory url = vm.rpcUrl(""mainnet""); ``` Retrieve all available alias -> URL pairs ```solidity string[2][] memory allUrls = vm.rpcUrls(); assertEq(allUrls.length, 2); string[2] memory val = allUrls[0]; assertEq(val[0], ""optimism""); string[2] memory env = allUrls[1]; assertEq(env[0], ""mainnet""); ``` ### SEE ALSO Forge Config [Config Reference](../reference/config/testing.md#rpc_endpoints) ",368
96,transaction-commands.md,transaction-commands.md. ## Transaction Commands - [cast publish](./cast-publish.md) - [cast receipt](./cast-receipt.md) - [cast send](./cast-send.md) - [cast call](./cast-call.md) - [cast rpc](./cast-rpc.md) - [cast tx](./cast-tx.md) - [cast run](./cast-run.md) - [cast estimate](./cast-estimate.md) - [cast access-list](./cast-access-list.md) ,105
97,project.md,"project.md. ## Project Configuration related to the project in general. ##### `src` - Type: string - Default: src - Environment: `FOUNDRY_SRC` or `DAPP_SRC` The path to the contract sources relative to the root of the project. ##### `test` - Type: string - Default: test - Environment: `FOUNDRY_TEST` or `DAPP_TEST` The path to the test contract sources relative to the root of the project. ##### `out` - Type: string - Default: out - Environment: `FOUNDRY_OUT` or `DAPP_OUT` The path to put contract artifacts in, relative to the root of the project. ##### `libs` - Type: array of strings (paths) - Default: lib - Environment: `FOUNDRY_LIBS` or `DAPP_LIBS` An array of paths that contain libraries, relative to the root of the project. ##### `cache` - Type: boolean - Default: true - Environment: `FOUNDRY_CACHE` or `DAPP_CACHE` Whether or not to enable caching. If enabled, the result of compiling sources, tests, and dependencies, are cached in `cache`. ##### `cache_path` - Type: string - Default: cache - Environment: `FOUNDRY_CACHE_PATH` or `DAPP_CACHE_PATH` The path to the cache, relative to the root of the project. ##### `broadcast` - Type: string - Default: broadcast The path to the broadcast transaction logs, relative to the root of the project. ##### `force` - Type: boolean - Default: false - Environment: `FOUNDRY_FORCE` or `DAPP_FORCE` Whether or not to perform a clean build, discarding the cache. ",364
98,cast-nonce.md,"cast-nonce.md. ## cast nonce ### NAME cast-nonce - Get the nonce for an account. ### SYNOPSIS ``cast nonce`` [*options*] *who* ### DESCRIPTION Get the nonce of an account. The argument *who* can be an ENS name or an address. ### OPTIONS #### Query Options `-B` *block* `--block` *block* &nbsp;&nbsp;&nbsp;&nbsp;The block height you want to query at. &nbsp;&nbsp;&nbsp;&nbsp;Can be a block number, or any of the tags: `earliest`, `finalized`, `safe`, `latest` or `pending`. #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the nonce of beer.eth  ```sh  cast nonce beer.eth  ``` ### SEE ALSO [cast](./cast.md), [cast balance](./cast-balance.md) ",198
99,solidity-compiler.md,"solidity-compiler.md. ## Solidity compiler Configuration related to the behavior of the Solidity compiler. **Sections** - [General](#general) - [Optimizer](#optimizer) - [Model Checker](#model-checker) ### General Configuration related to the behavior of the Solidity compiler. ##### `remappings` - Type: array of strings (remappings) - Default: none - Environment: `FOUNDRY_REMAPPINGS` or `DAPP_REMAPPINGS` An array of remappings in the following format: `<name>=<target>`. A remapping _remaps_ Solidity imports to different directories. For example, the following remapping ```ignore @openzeppelin/=node_modules/@openzeppelin/openzeppelin-contracts/ ``` with an import like ```solidity import ""@openzeppelin/contracts/utils/Context.sol""; ``` becomes ```solidity import ""node_modules/@openzeppelin/openzeppelin-contracts/contracts/utils/Context.sol""; ``` ##### `auto_detect_remappings` - Type: boolean - Default: true - Environment: `FOUNDRY_AUTO_DETECT_REMAPPINGS` or `DAPP_AUTO_DETECT_REMAPPINGS` If enabled, Foundry will automatically try auto-detect remappings by scanning the `libs` folder(s). If set to `false`, only the remappings in `foundry.toml` and `remappings.txt` are used. ##### `allow_paths` - Type: array of strings (paths) - Default: none - Environment: `FOUNDRY_ALLOW_PATHS` or `DAPP_ALLOW_PATHS` Tells solc to allow reading source files from additional directories. This is mainly relevant for complex workspaces managed by `pnmp` or similar. See also [solc allowed-paths](https://docs.soliditylang.org/en/latest/path-resolution.html#allowed-paths) ##### `include_paths` - Type: array of strings (paths) - Default: none - Environment: `FOUNDRY_INCLUDE_PATHS` or `DAPP_INCLUDE_PATHS` Make an additional source directory available to the default import callback. Use this option if you want to import contracts whose location is not fixed in relation to your main source tree, e.g. third-party libraries installed using a package manager. Can be used multiple times. Can only be used if base path has a non-empty value.",491
100,solidity-compiler.md,"See also [solc path resolution](https://docs.soliditylang.org/en/latest/path-resolution.html) ##### `libraries` - Type: array of strings (libraries) - Default: none - Environment: `FOUNDRY_LIBRARIES` or `DAPP_LIBRARIES` An array of libraries to link against in the following format: `<file>:<lib>:<address>`, for example: `src/MyLibrary.sol:MyLibrary:0xfD88CeE74f7D78697775aBDAE53f9Da1559728E4`. ##### `solc_version` - Type: string (semver) - Default: none - Environment: `FOUNDRY_SOLC_VERSION` or `DAPP_SOLC_VERSION` If specified, overrides the auto-detection system (more below) and uses a single Solidity compiler version for the project. Only strict versions are supported (i.e. `0.8.11` is valid, but `^0.8.0` is not). ##### `auto_detect_solc` - Type: boolean - Default: true - Environment: `FOUNDRY_AUTO_DETECT_SOLC` or `DAPP_AUTO_DETECT_SOLC` If enabled, Foundry will automatically try to resolve appropriate Solidity compiler versions to compile your project. This key is ignored if `solc_version` is set. ##### `offline` - Type: boolean - Default: false - Environment: `FOUNDRY_OFFLINE` or `DAPP_OFFLINE` If enabled, Foundry will not attempt to download any missing solc versions. If both `offline` and `auto-detect-solc` are set to `true`, the required version(s) of solc will be auto detected but any missing versions will _not_ be installed. ##### `ignored_error_codes` - Type: array of integers/strings - Default: none for source, SPDX license identifiers and contract size for tests - Environment: `FOUNDRY_IGNORED_ERROR_CODES` or `DAPP_IGNORED_ERROR_CODES` An array of Solidity compiler error codes to ignore during build, such as warnings.",442
101,solidity-compiler.md,"Valid values are: - `license`: 1878 - `code-size`: 5574 - `func-mutability`: 2018 - `unused-var`: 2072 - `unused-param`: 5667 - `unused-return`: 9302 - `virtual-interfaces`: 5815 - `missing-receive-ether`: 3628 - `shadowing`: 2519 - `same-varname`: 8760 - `unnamed-return`: 6321 - `unreachable`: 5740 - `pragma-solidity`: 3420 ##### `deny_warnings` - Type: boolean - Default: false - Environment: `FOUNDRY_DENY_WARNINGS` or `DAPP_DENY_WARNINGS` If enabled, Foundry will treat Solidity compiler warnings as errors, stopping artifacts from being written to disk. ##### `evm_version` - Type: string - Default: london - Environment: `FOUNDRY_EVM_VERSION` or `DAPP_EVM_VERSION` The EVM version to use during tests. The value **must** be an EVM hardfork name, such as `london`, `byzantium`, etc. ##### `revert_strings` - Type: string - Default: default - Environment: `FOUNDRY_REVERT_STRINGS` or `DAPP_REVERT_STRINGS` Possible values are: - `default` does not inject compiler-generated revert strings and keeps user-supplied ones. - `strip` removes all revert strings (if possible, i.e. if literals are used) keeping side-effects. - `debug` injects strings for compiler-generated internal reverts, implemented for ABI encoders V1 and V2 for now. - `verboseDebug` even appends further information to user-supplied revert strings (not yet implemented). ##### `extra_output_files` - Type: array of strings - Default: none - Environment: N/A Extra output from the Solidity compiler that should be written to files in the artifacts directory.",409
102,solidity-compiler.md,"Valid values are: - `metadata`: Written as a `metadata.json` file in the artifacts directory - `ir`: Written as a `.ir` file in the artifacts directory - `irOptimized`: Written as a `.iropt` file in the artifacts directory - `ewasm`: Written as a `.ewasm` file in the artifacts directory - `evm.assembly`: Written as a `.asm` file in the artifacts directory ##### `extra_output` - Type: array of strings - Default: see below - Environment: N/A Extra output to include in the contract's artifact. The following values are always set, since they're required by Forge: ```toml extra_output = [ ""abi"", ""evm.bytecode"", ""evm.deployedBytecode"", ""evm.methodIdentifiers"", ] ``` For a list of valid values, see the [Solidity docs][output-desc]. ##### `bytecode_hash` - Type: string - Default: ipfs - Environment: `FOUNDRY_BYTECODE_HASH` or `DAPP_BYTECODE_HASH` Determines the hash method for the metadata hash that is appended to the bytecode. Valid values are: - ipfs (default) - bzzr1 - none ##### `sparse_mode` - Type: boolean - Default: false - Environment: `FOUNDRY_SPARSE_MODE` or `DAPP_SPARSE_MODE` Enables [sparse mode](./forge/forge-build.md#sparse-mode-experimental) for builds. ### Optimizer Configuration related to the Solidity optimizer. ##### `optimizer` - Type: boolean - Default: true - Environment: `FOUNDRY_OPTIMIZER` or `DAPP_OPTIMIZER` Whether or not to enable the Solidity optimizer. ##### `optimizer_runs` - Type: integer - Default: 200 - Environment: `FOUNDRY_OPTIMIZER_RUNS` or `DAPP_OPTIMIZER_RUNS` The amount of optimizer runs to perform. ##### `via_ir` - Type: boolean - Default: false - Environment: `FOUNDRY_VIA_IR` or `DAPP_VIA_IR` If set to true, changes compilation pipeline to go through the new IR optimizer. ##### `[optimizer_details]` The optimizer details section is used to tweak how the Solidity optimizer behaves.",472
103,solidity-compiler.md,"There are several configurable values in this section (each of them are booleans): - `peephole` - `inliner` - `jumpdest_remover` - `order_literals` - `deduplicate` - `cse` - `constant_optimizer` - `yul` Refer to the Solidity [compiler input description](https://docs.soliditylang.org/en/latest/using-the-compiler.html#compiler-input-and-output-json-description) for the default values. ##### `[optimizer_details.yul_details]` The Yul details subsection of the optimizer details section is used to tweak how the new IR optimizer behaves. There are two configuration values: - `stack_allocation`: Tries to improve the allocation of stack slots by freeing them up earlier. - `optimizer_steps`: Selects the optimizer steps to be applied. Refer to the Solidity [compiler input description](https://docs.soliditylang.org/en/latest/using-the-compiler.html#compiler-input-and-output-json-description) for the default values. > ℹ️ **Note** > If you encounter compiler errors when using `via_ir`, explicitly enable the legacy `optimizer` and leave `optimizer_steps` as an empty string ### Model checker The Solidity model checker is a built-in opt-in module that is available in Solidity compilers for OSX and Linux. Learn more about the model checker in the [Solidity compiler documentation](https://docs.soliditylang.org/en/latest/smtchecker.html#tutorial) > ℹ️ **Note** > The model checker requires `z3` version 4.8.8 or 4.8.14 on Linux. The model checker settings are configured in the `[model_checker]` section of the configuration. The model checker will run when `forge build` is invoked, and any findings will show up as warnings. These are the recommended settings when using the model checker: ```toml [profile.default.model_checker] contracts = {'/path/to/project/src/Contract.sol' = ['Contract']} engine = 'chc' timeout = 10000 targets = ['assert'] ``` Setting which contract should be verified is extremely important, otherwise all available contracts will be verified which may take a long time. The recommended engine is `chc`, but `bmc` and `all` (which runs both) are also accepted.",477
104,solidity-compiler.md,"It is also important to set a proper timeout (given in milliseconds), since the default time given to the underlying solver may not be enough. If no verification targets are given, only assertions will be checked. ##### `[model_checker]` The following keys are available in the model checker section. ###### `model_checker.contracts` - Type: table - Default: all - Environment: N/A Specifies what contracts the model checker will analyze. The key of the table is the path to a source file, and the value is an array of contract names to check. For example: ```toml [profile.default.model_checker] contracts = { ""src/MyContracts.sol"" = [""ContractA"", ""ContractB""] } ``` ###### `model_checker.div_mod_with_slacks` - Type: boolean - Default: false - Environment: N/A Sets how division and modulo operations should be encoded. Refer to the [Solidity documentation](https://docs.soliditylang.org/en/latest/smtchecker.html#division-and-modulo-with-slack-variables) for more information. ###### `model_checker.engine` - Type: string (see below) - Default: all - Environment: N/A Specifies the model checker engine to run. Valid values are: - `chc`: The constrained horn clauses engine - `bmc`: The bounded model checker engine - `all`: Runs both engines Refer to the [Solidity documentation](https://docs.soliditylang.org/en/latest/smtchecker.html#model-checking-engines) for more information on the engines. ###### `model_checker.invariants` - Type: array of strings - Default: N/A - Environment: N/A Sets the model checker invariants. Valid values are: - `contract`: Contract Invariants - `reentrancy`: Reentrancy Properties Refer to the [Solidity documentation](https://docs.soliditylang.org/en/latest/smtchecker.html#reported-inferred-inductive-invariants) for more information on the invariants. ###### `model_checker.show_unproved` - Type: boolean - Default: false - Environment: N/A Whether or not to output all unproved targets. Refer to the [Solidity documentation](https://docs.soliditylang.org/en/latest/smtchecker.html#unproved-targets) for more information.",471
105,cast--from-bin.md,cast--from-bin.md. ## cast --from-bin ### NAME cast---from-bin - Convert binary data into hex data. ### SYNOPSIS ``cast --from-bin`` [*options*] ### DESCRIPTION Convert binary data into hex data. The input is taken from stdin. ### OPTIONS {{#include common-options.md}} ### SEE ALSO [cast](./cast.md) ,74
106,difficulty.md,"difficulty.md. ## `difficulty` ### Signature ```solidity function difficulty(uint256) external; ``` ### Description Sets `block.difficulty`. If used with a post-merge EVM version (Paris and onwards), it will revert. In that case, use [`vm.prevrandao`][prevrandao] instead. ### Examples ```solidity vm.difficulty(25); emit log_uint(block.difficulty); // 25 ``` [prevrandao]: ./prevrandao.md",97
107,display-options.md,display-options.md. #### Display Options `-j` `--json` &nbsp;&nbsp;&nbsp;&nbsp; Print the deployment information as JSON. ,31
108,doc-generator.md,"doc-generator.md. ## Documentation Generator Configuration related to the behavior of the Forge documentation generator. These keys are set in `[doc]` section. ##### `out` - Type: string - Default: `docs` - Environment: `FOUNDRY_DOC_OUT` An output path for generated documentation. ##### `title` - Type: string - Environment: `FOUNDRY_DOC_TITLE` Title for the generated documentation. ##### `book` - Type: string - Default: `./book.toml` - Environment: `FOUNDRY_DOC_BOOK` Path to user provided `book.toml`. It will be merged with default settings during doc generation. ##### `repository` - Type: string - Environment: `FOUNDRY_DOC_REPOSITORY` The git repository URL. Used to provide links to git source files. If missing, `forge` will attempt to look up the current origin url and use its value. ##### `ignore` - Type: array of strings (patterns) - Default: `[]` - Environment: `FOUNDRY_DOC_IGNORE` List of files to ignore when generating documentation. This is a comma separated list of glob patterns.",237
109,static-analyzers.md,"static-analyzers.md. ## Static Analyzers ### Slither To test your project using [slither](https://github.com/crytic/slither), here is a sample `slither.config.json`: ```json { ""filter_paths"": ""lib"" } ``` To run Slither on the entire project, you can use this command: ```sh slither . ``` You do not need to provide remappings via the `solc_remaps` option as Slither will automatically detect remappings in a Foundry project. Slither will invoke `forge` to perform the build. However, if you want to analyze a specific `.sol` file, then you do need to provide remappings: ```json { ""solc_remaps"": [  ""ds-test/=lib/ds-test/src/"",  ""forge-std/=lib/forge-std/src/"" ] } ``` And you also need to update the `solc` compiler used by Slither to the same version used by Forge with `solc-select`: ```sh pip3 install slither-analyzer pip3 install solc-select solc-select install 0.8.13 solc-select use 0.8.13 slither . ``` See the [Slither wiki](https://github.com/crytic/slither/wiki/Usage) for more information. In order to use a custom configuration, such as the sample `slither.config.json` mentioned above, the following command is used as mentioned in the [slither-wiki](https://github.com/crytic/slither/wiki/Usage#configuration-file). By default slither looks for the `slither.config.json` but you can define the path and any other `json` file of your choice: ```sh slither --config-file <path>/file.config.json . ``` Example output (Raw): ```bash Pragma version^0.8.13 (Counter.sol#2) necessitates a version too recent to be trusted.",399
110,static-analyzers.md,"Consider deploying with 0.6.12/0.7.6/0.8.7 solc-0.8.13 is not recommended for deployment Reference: https://github.com/crytic/slither/wiki/Detector-Documentation#incorrect-versions-of-solidity setNumber(uint256) should be declared external:   - Counter.setNumber(uint256) (Counter.sol#7-9) increment() should be declared external:   - Counter.increment() (Counter.sol#11-13) Reference: https://github.com/crytic/slither/wiki/Detector-Documentation#public-function-that-could-be-declared-external Counter.sol analyzed (1 contracts with 78 detectors), 4 result(s) found ``` Slither also has a [GitHub Action](https://github.com/marketplace/actions/slither-action) for CI/CD. ### Mythril To test your project using [mythril](https://github.com/ConsenSys/mythril), here is a sample `mythril.config.json`: ```json { ""remappings"": [  ""ds-test/=lib/ds-test/src/"",  ""forge-std/=lib/forge-std/src/"" ], ""optimizer"": {  ""enabled"": true,  ""runs"": 200 } } ``` Note, you need switch `rustc` to nightly to install `mythril`: ```ignore rustup default nightly pip3 install mythril myth analyze src/Contract.sol --solc-json mythril.config.json ``` See the [mythril docs](https://mythril-classic.readthedocs.io/en/develop/) for more information. You can pass custom Solc compiler output to Mythril using the `--solc-json` flag. For example: ```bash $ myth analyze src/Counter.sol --solc-json mythril.config.json . . mythril.laser.plugin.loader [INFO]: Loading laser plugin: coverage mythril.laser.plugin.loader [INFO]: Loading laser plugin: mutation-pruner . .",410
111,utility-commands.md,utility-commands.md. ## Utility Commands - [cast sig](./cast-sig.md) - [cast sig-event](./cast-sig-event.md) - [cast keccak](./cast-keccak.md) - [cast compute-address](./cast-compute-address.md) - [cast interface](./cast-interface.md) - [cast index](./cast-index.md) - [cast --concat-hex](./cast--concat-hex.md) - [cast --max-int](./cast--max-int.md) - [cast --min-int](./cast--min-int.md) - [cast --max-uint](./cast--max-uint.md) - [cast --to-checksum-address](./cast--to-checksum-address.md) ,157
112,build-commands.md,build-commands.md. ## Build Commands - [forge build](./forge-build.md) - [forge clean](./forge-clean.md) - [forge inspect](./forge-inspect.md) ,40
113,warp.md,"warp.md. ## `warp` ### Signature ```solidity function warp(uint256) external; ``` ### Description Sets `block.timestamp`. ### Examples ```solidity vm.warp(1641070800); emit log_uint(block.timestamp); // 1641070800 ``` ### SEE ALSO Forge Standard Library [`skip`](../reference/forge-std/skip.md), [`rewind`](../reference/forge-std/rewind.md)",90
114,forge-std.md,"forge-std.md. ## Forge Standard Library Overview Forge Standard Library (Forge Std for short) is a collection of helpful contracts that make writing tests easier, faster, and more user-friendly. Using Forge Std is the preferred way of writing tests with Foundry. It provides all the essential functionality you need to get started writing tests: - `Vm.sol`: Up-to-date cheatcodes interface - `console.sol` and `console2.sol`: Hardhat-style logging functionality - `Script.sol`: Basic utilities for [Solidity scripting](../tutorials/solidity-scripting.md) - `Test.sol`: A superset of DSTest containing standard libraries, a cheatcodes instance (`vm`), and Hardhat console Simply import `Test.sol` and inherit from `Test` in your test contract: ```solidity import ""forge-std/Test.sol""; contract ContractTest is Test { ... ``` Now, you can: ```solidity // Access Hevm via the `vm` instance vm.startPrank(alice); // Assert and log using Dappsys Test assertEq(dai.balanceOf(alice), 10000e18); // Log with the Hardhat `console` (`console2`) console.log(alice.balance); // Use anything from the Forge Std std-libraries deal(address(dai), alice, 10000e18); ``` To import the `Vm` interface or the `console` library individually: ```solidity import ""forge-std/Vm.sol""; ``` ```solidity import ""forge-std/console.sol""; ``` **Note:** `console2.sol` contains patches to `console.sol` that allows Forge to decode traces for calls to the console, but it is not compatible with Hardhat. ```solidity import ""forge-std/console2.sol""; ``` ### Standard libraries Forge Std currently consists of six standard libraries. #### Std Logs Std Logs expand upon the logging events from the [`DSTest`](../reference/ds-test.md#logging) library. #### Std Assertions Std Assertions expand upon the assertion functions from the [`DSTest`](../reference/ds-test.md#asserting) library. #### Std Cheats Std Cheats are wrappers around Forge cheatcodes that make them safer to use and improve the DX.",453
115,forge-build.md,"forge-build.md. ## forge build ### NAME forge-build - Build the project's smart contracts. ### SYNOPSIS ``forge build`` or ``forge b`` [*options*] ### DESCRIPTION Build the project's smart contracts. The command will try to detect the latest version that can compile your project by looking at the version requirements of all your contracts and dependencies. You can override this behaviour by passing `--no-auto-detect`. Alternatively, you can pass `--use <SOLC_VERSION>`. If the command detects that the Solidity compiler version it is using to build is not installed, it will download it and install it in `~/.svm`. You can disable this behavior by passing `--offline`. The build is incremental, and the build cache is saved in `cache/` in the project root by default. If you want to clear the cache, pass `--force`, and if you want to change the cache directory, pass `--cache-path <PATH>`. #### Build Modes There are three build modes: - Just compilation (default): Builds the project and saves the contract artifacts in `out/` (or the path specified by `--out <PATH>`). - Size mode (`--sizes`): Builds the project, displays the size of non-test contracts and exits with code 1 if any of them are above the size limit. - Name mode (`--names`): Builds the project, displays the names of the contracts and exits. #### The Optimizer You can enable the optimizer by passing `--optimize`, and you can adjust the number of optimizer runs by passing `--optimizer-runs <RUNS>`. You can also opt-in to the Solidity IR compilation pipeline by passing `--via-ir`. Read more about the IR pipeline in the [Solidity docs][ir-pipeline]. By default, the optimizer is enabled and runs for 200 cycles. ##### Conditional Optimizer Usage Many projects use the solc optimizer, either through the standard compilation pipeline or the IR pipeline. But in some cases, the optimizer can significantly slow down compilation speeds.",420
116,forge-build.md,"A config file for a project using the optimizer may look like this for regular compilation: ```toml [profile.default] solc-version = ""0.8.17"" optimizer = true optimizer-runs = 10_000_000 ``` Or like this for `via-ir`: ```toml [profile.default] solc-version = ""0.8.17"" via_ir = true ``` To reduce compilation speeds during development and testing, one approach is to have a `lite` profile that has the optimizer off and use this for development/testing cycle. The updated config file for regular compilation may look like this: ```toml [profile.default] solc-version = ""0.8.17"" optimizer = true optimizer-runs = 10_000_000 [profile.lite] optimizer = false ``` Or like this for `via-ir`: ```toml [profile.default] solc-version = ""0.8.17"" via_ir = true [profile.lite.optimizer_details.yulDetails] optimizerSteps = '' ``` When setup like this, `forge build` (or `forge test` / `forge script`) still uses the standard profile, so by default a `forge script` invocation will deploy your contracts with the production setting. Running `FOUNDRY_PROFILE=lite forge build` (and again, same for the test and script commands) will use the lite profile to reduce compilation times. > There are additional optimizer details you can configure, see the [Additional Optimizer Settings](#additional-optimizer-settings) section below for more info. #### Artifacts You can add extra output from the Solidity compiler to your artifacts by passing `--extra-output <SELECTOR>`. The selector is a path in the Solidity compiler output, which you can read more about in the [Solidity docs][output-desc]. You can also write some of the compiler output to separate files by passing `--extra-output-files <SELECTOR>`.",398
117,forge-build.md,"Valid selectors for `--extra-output-files` are: - `metadata`: Written as a `metadata.json` file in the artifacts directory - `ir`: Written as a `.ir` file in the artifacts directory - `irOptimized`: Written as a `.iropt` file in the artifacts directory - `ewasm`: Written as a `.ewasm` file in the artifacts directory - `evm.assembly`: Written as a `.asm` file in the artifacts directory #### Watch Mode The command can be run in watch mode by passing `--watch [PATH...]`, which will rebuild every time a watched file or directory is changed. The source directory is watched by default. #### Sparse Mode (experimental) Sparse mode only compiles files that match certain criteria. By default, this filter applies to files that have not been changed since the last build, but for commands that take file filters (e.g. [forge test](./forge-test.md)), sparse mode will only recompile files that match the filter. Sparse mode is opt-in until the feature is stabilized. To opt-in to sparse mode and try it out, set [`sparse_mode`][sparse-mode] in your configuration file. #### Additional Optimizer Settings The optimizer can be fine-tuned with additional settings. Simply set the `optimizer_details` table in your configuration file. For example: ```toml [profile.default.optimizer_details] constantOptimizer = true yul = true [profile.default.optimizer_details.yulDetails] stackAllocation = true optimizerSteps = 'dhfoDgvulfnTUtnIf' ``` See the [compiler input description documentation](https://docs.soliditylang.org/en/latest/using-the-compiler.html#compiler-input-and-output-json-description) for more information on available settings (specifically `settings.optimizer.details`). #### Revert Strings You can control how revert strings are generated by the compiler. By default, only user supplied revert strings are included in the bytecode, but there are other options: - `strip`: Removes all revert strings (if possible, i.e. if literals are used) keeping side-effects. - `debug`: Injects strings for compiler-generated internal reverts, implemented for ABI encoders V1 and V2 for now. - `verboseDebug`: Appends further information to user-supplied revert strings (not yet implemented).",469
118,forge-build.md,"#### Additional Model Checker settings [Solidity's built-in model checker](https://docs.soliditylang.org/en/latest/smtchecker.html#tutorial) is an opt-in module that can be enabled via the `ModelChecker` object. See [Compiler Input Description `settings.modelChecker`](https://docs.soliditylang.org/en/latest/using-the-compiler.html#compiler-input-and-output-json-description) and [the model checker's options](https://docs.soliditylang.org/en/latest/smtchecker.html#smtchecker-options-and-tuning). The module is available in `solc` release binaries for OSX and Linux. The latter requires the z3 library version [4.8.8, 4.8.14] to be installed in the system (SO version 4.8). Similarly to the optimizer settings above, the `model_checker` settings must be prefixed with the profile they correspond to: `[profile.default.model_checker]` belongs to the `[profile.default]`. ```toml ## foundry.toml [profile.default.model_checker] contracts = { '/path/to/project/src/Contract.sol' = [ 'Contract' ] } engine = 'chc' timeout = 10000 targets = [ 'assert' ] ``` The fields above are recommended when using the model checker. Setting which contract should be verified is extremely important, otherwise all available contracts will be verified which can consume a lot of time. The recommended engine is `chc`, but `bmc` and `all` (runs both) are also accepted. It is also important to set a proper timeout (given in milliseconds), since the default time given to the underlying solvers may not be enough. If no verification targets are given, only assertions will be checked. The model checker will run when `forge build` is invoked, and will show findings as warnings if any. ### OPTIONS #### Build Options `--names` &nbsp;&nbsp;&nbsp;&nbsp;Print compiled contract names. `--sizes` &nbsp;&nbsp;&nbsp;&nbsp;Print compiled non-test contract sizes, exiting with code 1 if any of them are above the size limit. `--skip` &nbsp;&nbsp;&nbsp;&nbsp;Skip compilation of non-essential contract directories like test or script (usage `--skip test`).",470
119,parse-bytes.md,"parse-bytes.md. ## `parseBytes` ### Signature ```solidity function parseBytes(string calldata stringifiedValue) external pure returns (bytes memory parsedValue); ``` ### Description Parses the value of `string` into `bytes` ### Examples ```solidity string memory bytesAsString = ""0x00000000000000000000000000000000""; bytes memory stringToBytes = vm.parseBytes(bytesAsString); // 0x00000000000000000000000000000000 ``` ",102
120,cast-upload-signature.md,"cast-upload-signature.md. ## cast upload-signature ### NAME cast-upload-signature ### SYNOPSIS `cast upload-signature` [*signatures...*] ### DESCRIPTION Upload the given signatures to [https://sig.eth.samczsun.com](https://sig.eth.samczsun.com). ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Upload signatures  ```sh  cast upload-signature 'function approve(address,uint256)' \ 'transfer(uint256)' 'event Transfer(uint256,address)'  ```",105
121,cast--to-bytes32.md,"cast--to-bytes32.md. ## cast --to-bytes32 ### NAME cast---to-bytes32 - Right-pads hex data to 32 bytes. ### SYNOPSIS ``cast --to-bytes32`` [*options*] *bytes* ### DESCRIPTION Right-pads hex data to 32 bytes. Note that this command is for padding a byte string only. If you're looking to format a [Solidity string literal](https://docs.soliditylang.org/en/v0.8.16/types.html#string-literals-and-types) into `bytes32`, use [--format-bytes32-string](./cast--format-bytes32-string.md) instead. ### OPTIONS {{#include common-options.md}} ### SEE ALSO [cast](./cast.md) ",158
122,prank.md,"prank.md. ## `prank` ### Signature ```solidity function prank(address) external; ``` ```solidity function prank(address sender, address origin) external; ``` ### Description Sets `msg.sender` to the specified address **for the next call**. ""The next call"" includes static calls as well, but not calls to the cheat code address. If the alternative signature of `prank` is used, then `tx.origin` is set as well for the next call. ### Examples ```solidity /// function withdraw() public { ///  require(msg.sender == owner); vm.prank(owner); myContract.withdraw(); // [PASS] ``` ### SEE ALSO Forge Standard Library [`hoax`](../reference/forge-std/hoax.md)",154
123,formatter.md,"formatter.md. ## Formatter Configuration related to the behavior of the Forge formatter. Each of these keys live under the `[fmt]` section. ##### `line_length` - Type: number - Default: 120 - Environment: `FOUNDRY_FMT_LINE_LENGTH` or `DAPP_FMT_LINE_LENGTH` Maximum line length where formatter will try to wrap the line. ##### `tab_width` - Type: number - Default: 4 - Environment: `FOUNDRY_FMT_TAB_WIDTH` or `DAPP_FMT_TAB_WIDTH` Number of spaces per indentation level. ##### `bracket_spacing` - Type: bool - Default: false - Environment: `FOUNDRY_FMT_BRACKET_SPACING` or `DAPP_FMT_BRACKET_SPACING` Whether or not to print spaces between brackets. ##### `int_types` - Type: string - Default: `long` - Environment: `FOUNDRY_FMT_INT_TYPES` or `DAPP_FMT_INT_TYPES` Style of uint/int256 types. Valid values are: - `long` (default): Use the explicit `uint256` or `int256` - `short`: Use the implicit `uint` or `int` - `preserve`: Use the type defined in the source code ##### `multiline_func_header` - Type: string - Default: `attributes_first` - Environment: `FOUNDRY_FMT_MULTILINE_FUNC_HEADER` or `DAPP_FMT_MULTILINE_FUNC_HEADER` Style of multiline function header in case it doesn't fit in one line. Valid values are: - `attributes_first` (default): Write function attributes multiline first - `params_first`: Write function parameters multiline first - `all`: If function parameters or attributes are multiline, multiline everything ##### `quote_style` - Type: string - Default: `double` - Environment: `FOUNDRY_FMT_QUOTE_STYLE` or `DAPP_FMT_QUOTE_STYLE` Defines the quotation mark style. Valid values are: - `double` (default): Use double quotes where possible (`""`) - `single`: Use single quotes where possible (`'`) - `preserve`: Use quotation mark defined in the source code ##### `number_underscore` - Type: string - Default: `preserve` - Environment: `FOUNDRY_FMT_NUMBER_UNDERSCORE` or `DAPP_FMT_NUMBER_UNDERSCORE` Style of underscores in number literals.",481
124,find.md,"find.md. ## `find` ### Signature ```solidity function find(StdStorage storage self) internal returns (uint256); ``` ### Description Finds an arbitrary storage slot given [`target`](../forge-std/target.md), [`sig`](../forge-std/sig.md), [`with_key`](../forge-std/with_key.md)(s), and [`depth`](../forge-std/depth.md). Reverts with a message if unsuccessful. ",92
125,writing-tests.md,"writing-tests.md. ## Writing Tests Tests are written in Solidity. If the test function reverts, the test fails, otherwise it passes. Let's go over the most common way of writing tests, using the [Forge Standard Library](https://github.com/foundry-rs/forge-std)'s `Test` contract, which is the preferred way of writing tests with Forge. In this section, we'll go over the basics using the functions from the Forge Std's `Test` contract, which is itself a superset of [DSTest](https://github.com/dapphub/ds-test). You will learn how to use more advanced stuff from the Forge Standard Library [soon](./forge-std.md). DSTest provides basic logging and assertion functionality. To get access to the functions, import `forge-std/Test.sol` and inherit from `Test` in your test contract: ```solidity {{#include ../../projects/writing_tests/test/Basic.t.sol:import}} ``` Let's examine a basic test: ```solidity {{#include ../../projects/writing_tests/test/Basic.t.sol:all}} ``` Forge uses the following keywords in tests: - `setUp`: An optional function invoked before each test case is run.  ```solidity {{#include ../../projects/writing_tests/test/Basic.t.sol:setUp}}  ``` - `test`: Functions prefixed with `test` are run as a test case.  ```solidity {{#include ../../projects/writing_tests/test/Basic.t.sol:testNumberIs42}}  ``` - `testFail`: The inverse of the `test` prefix - if the function does not revert, the test fails.  ```solidity {{#include ../../projects/writing_tests/test/Basic.t.sol:testFailSubtract43}}  ```  A good practice is to use the pattern `test_Revert[If|When]_Condition` in combination with the [`expectRevert`](../cheatcodes/expect-revert.md) cheatcode (cheatcodes are explained in greater detail in the following [section](./cheatcodes.md)). Also, other testing practices can be found in the [Tutorials section](../tutorials/best-practices.md).",453
126,tx-gas-price.md,tx-gas-price.md. ## `txGasPrice` ### Signature ```solidity function txGasPrice(uint256) external; ``` ```solidity function txGasPrice(uint256 newGasPrice) external; ``` ### Description Sets `tx.gasprice` **for the rest of the transaction**. ### Examples We can use this to get accurate gas usage for a transaction. ```solidity function testCalculateGas() public {  vm.txGasPrice(2);  uint256 gasStart = gasleft();  myContract.doStuff();  uint256 gasEnd = gasleft();  uint256 gasUsed = (gasStart - gasEnd) * tx.gasprice; // tx.gasprice is now 2 } ```,148
127,std-cheats.md,std-cheats.md. ## Std Cheats - [`skip`](./skip.md) - [`rewind`](./rewind.md) - [`hoax`](./hoax.md) - [`startHoax`](./startHoax.md) - [`deal`](./deal.md) - [`deployCode`](./deployCode.md) - [`bound`](./bound.md) - [`changePrank`](./change-prank.md) - [`makeAddr`](./make-addr.md) - [`makeAddrAndKey`](./make-addr-and-key.md) - [`noGasMetering`](./noGasMetering.md) ,128
128,wallet-options.md,wallet-options.md. {{#include wallet-options-raw.md}} {{#include wallet-options-keystore.md}} {{#include wallet-options-hardware.md}} {{#include wallet-options-remote.md}} ,42
129,cast-block-number.md,"cast-block-number.md. ## cast block-number ### NAME cast-block-number - Get the latest block number. ### SYNOPSIS ``cast block-number`` [*options*] ### DESCRIPTION Get the latest block number. ### OPTIONS #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the latest block number:  ```sh  cast block-number  ``` ### SEE ALSO [cast](./cast.md), [cast block](./cast-block.md) ",105
130,env-bool.md,"env-bool.md. ## `envBool` ### Signature ```solidity function envBool(string calldata key) external returns (bool value); ``` ```solidity function envBool(string calldata key, string calldata delimiter) external returns (bool[] memory values); ``` ### Description Read an environment variable as `bool` or `bool[]`. ### Tips - For `true`, use either ""true"" or ""True"" for the environment variable value. - For `false`, use either ""false"" or ""False"" for the environment variable value. - For arrays, you can specify the delimiter used to seperate the values with the `delimiter` parameter. ### Examples #### Single Value With environment variable `BOOL_VALUE=true`, ```solidity string memory key = ""BOOL_VALUE""; bool expected = true; bool output = cheats.envBool(key); assert(output == expected); ``` #### Array With environment variable `BOOL_VALUES=true,false,True,False`, ```solidity string memory key = ""BOOL_VALUES""; string memory delimiter = "",""; bool[4] memory expected = [true, false, true, false]; bool[] memory output = cheats.envBool(key, delimiter); assert(keccak256(abi.encodePacked((output))) == keccak256(abi.encodePacked((expected)))); ``` ",262
131,wallet-options-remote.md,wallet-options-remote.md. #### Wallet Options - Remote `-f` *address* `--from` *address* &nbsp;&nbsp;&nbsp;&nbsp;Sign the transaction with the specified account on the RPC. &nbsp;&nbsp;&nbsp;&nbsp;Environment: `ETH_FROM` ,60
132,make-addr.md,"make-addr.md. ## `makeAddr` ### Signature ```solidity function makeAddr(string memory name) internal returns(address addr); ``` ### Description Creates an address derived from the provided `name`. A [`label`](../../cheatcodes/label.md) is created for the derived address with the provided `name` used as the label value. ### Examples ```solidity address alice = makeAddr(""alice""); emit log_address(alice); // 0x328809bc894f92807417d2dad6b7c998c1afdac6 ``` ",116
133,cast-pretty-calldata.md,"cast-pretty-calldata.md. ## cast pretty-calldata ### NAME cast-pretty-calldata - Pretty print calldata. ### SYNOPSIS ``cast pretty-calldata`` [*options*] *calldata* ### DESCRIPTION Pretty print calldata. Tries to decode the calldata using <https://sig.eth.samczsun.com> unless `--offline` is passed. ### OPTIONS #### 4byte Options `-o` `--offline` &nbsp;&nbsp;&nbsp;&nbsp;Skip the <https://sig.eth.samczsun.com> lookup. {{#include common-options.md}} ### EXAMPLES 1. Decode calldata for a `transfer` call:  ```sh  cast pretty-calldata 0xa9059cbb000000000000000000000000e78388b4ce79068e89bf8aa7f218ef6b9ab0e9d00000000000000000000000000000000000000000000000000174b37380cea000  ``` ### SEE ALSO [cast](./cast.md), [cast 4byte-decode](./cast-4byte-decode.md) ",236
134,read.md,"read.md. ## `read` ### Signature ```solidity function read_bytes32(StdStorage storage self) internal returns (bytes32); ``` ```solidity function read_bool(StdStorage storage self) internal returns (bool); ``` ```solidity function read_address(StdStorage storage self) internal returns (address); ``` ```solidity function read_uint(StdStorage storage self) internal returns (uint256); ``` ```solidity function read_int(StdStorage storage self) internal returns (int256); ``` ### Description Reads the value from the storage slot as `bytes32`, `bool`, `address`, `uint256`, or `int256`. Reverts with a message if unsuccessful. ",141
135,external.md,external.md. ## External - [`ffi`](./ffi.md) - [`projectRoot`](./project-root.md) - [`getCode`](./get-code.md) - [`getDeployedCode`](./get-deployed-code.md) - [`setEnv`](./set-env.md) - [`envOr`](./env-or.md) - [`envBool`](./env-bool.md) - [`envUint`](./env-uint.md) - [`envInt`](./env-int.md) - [`envAddress`](./env-address.md) - [`envBytes32`](./env-bytes32.md) - [`envString`](./env-string.md) - [`envBytes`](./env-bytes.md) - [`parseJson`](./parse-json.md) - [Files](./fs.md) ,162
136,pause-gas-metering.md,"pause-gas-metering.md. ## `pauseGasMetering` ### Signature ```solidity function pauseGasMetering() external; ``` ### Description Pauses gas metering (i.e. `gasleft()` does not decrease as operations are executed). This can be useful for getting a better sense of gas costs, by turning off gas metering for unnecessary code, as well as long-running scripts that would otherwise run out of gas. > ℹ️ **Note** > > `pauseGasMetering` *turns off DoS protections* that come from metering gas usage. > > Exposing a service that assumes a particular instance of the EVM will complete due to gas usage no longer is true, and a timeout should be enabled in that case. ",156
137,remember-key.md,"remember-key.md. ## `rememberKey` ### Signature ```solidity function rememberKey(uint256 privateKey) external returns (address); ``` ### Description Stores a private key in forge's local wallet and returns the corresponding address which can later be used for [broadcasting](./broadcast.md). ### Examples Derive the private key from the test mnemonic at path `m/44'/60'/0'/0/0`, remember it in forge's wallet and use it to start broadcasting transactions: ```solidity string memory mnemonic = ""test test test test test test test test test test test junk""; uint256 privateKey = vm.deriveKey(mnemonic, 0); address deployer = vm.rememberKey(privateKey); vm.startBroadcast(deployer); ... vm.stopBroadcast(); ``` Load a private key from the `PRIVATE_KEY` environment variable and use it to start broadcasting transactions: ```solidity address deployer = vm.rememberKey(vm.envUint(""PRIVATE_KEY"")); vm.startBroadcast(deployer); ... vm.stopBroadcast(); ``` ### SEE ALSO - [deriveKey](./derive-key.md) Forge Standard Library: - [deriveRememberKey](../reference/forge-std/derive-remember-key.md) ",244
138,cast-receipt.md,"cast-receipt.md. ## cast receipt ### NAME cast-receipt - Get the transaction receipt for a transaction. ### SYNOPSIS ``cast receipt`` [*options*] *tx_hash* [*field*] ### DESCRIPTION Get the transaction receipt for a transaction. If *field* is specified, then only the given field of the receipt is displayed. ### OPTIONS #### Receipt Options `--async` `--cast-async` &nbsp;&nbsp;&nbsp;&nbsp;Do not wait for the transaction receipt if it does not exist yet. &nbsp;&nbsp;&nbsp;&nbsp;Environment: `CAST_ASYNC` `-c` *confirmations* `--confirmations` *confirmations* &nbsp;&nbsp;&nbsp;&nbsp;Wait a number of confirmations before exiting. Default: `1`. #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include ../common/display-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Get a transaction receipt:  ```sh  cast receipt $TX_HASH  ``` 2. Get the block number the transaction was included in:  ```sh  cast receipt $TX_HASH blockNumber  ``` ### SEE ALSO [cast](./cast.md), [cast call](./cast-call.md), [cast send](./cast-send.md), [cast publish](./cast-publish.md) ",277
139,ffi.md,"ffi.md. ## `ffi` ### Signature ```solidity function ffi(string[] calldata) external returns (bytes memory); ``` ### Description Calls an arbitrary command if [`ffi`](../reference/config/testing.md#ffi) is enabled. It is generally advised to use this cheat code as a last resort, and to not enable it by default, as anyone who can change the tests of a project will be able to execute arbitrary commands on devices that run the tests. ### Tips - By default the `ffi` cheatcode assumes the output of the command is a hex encoded value (e.g. a hex string of an ABI encoded value). If hex decoding fails, it will return the output as UTF8 bytes that you can cast to a string. - Make sure that the output does not include a `\n` newline character. (e.g in Rust use `print!` vs `println!`) - Remember that the script will be executed from the top-level directory of your project, not inside `test` - Make sure that the inputs array does not have empty elements. They will be handled as inputs by the script, instead of space - Use the cheatcode `toString` to easily convert arbitrary data to strings, so that you can pass them as command-line arguments ### Examples ABI encoded output ```solidity string[] memory inputs = new string[](3); inputs[0] = ""echo""; inputs[1] = ""-n""; // ABI encoded ""gm"", as a hex string inputs[2] = ""0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002676d000000000000000000000000000000000000000000000000000000000000""; bytes memory res = vm.ffi(inputs); string memory output = abi.decode(res, (string)); assertEq(output, ""gm""); ``` UTF8 string output ```solidity string[] memory inputs = new string[](3); inputs[0] = ""echo""; inputs[1] = ""-n""; inputs[2] = ""gm""; bytes memory res = vm.ffi(inputs); assertEq(string(res), ""gm""); ``` ",461
140,assertApproxEqRel.md,"assertApproxEqRel.md. ## `assertApproxEqRel` ### Signature ```solidity function assertApproxEqRel(uint256 a, uint256 b, uint256 maxPercentDelta) internal virtual; ``` ```solidity function assertApproxEqRel(uint256 a, uint256 b, uint256 maxPercentDelta, string memory err) internal virtual; ``` ### Description Asserts `a` is approximately equal to `b` with delta in percentage, where `1e18` is 100%. ### Examples ```solidity function testFail () external {  uint256 a = 100;  uint256 b = 200;  assertApproxEqRel(a, b, 0.4e18); } ``` ```ignore [PASS] testFail() (gas: 23884) Logs: Error: a ~= b not satisfied [uint]  Expected: 200   Actual: 100 Max % Delta: 0.400000000000000000  % Delta: 0.500000000000000000 ``` ",215
141,hoax.md,"hoax.md. ## `hoax` ### Signature ```solidity function hoax(address who) public; ``` ```solidity function hoax(address who, uint256 give) public; ``` ```solidity function hoax(address who, address origin) public; ``` ```solidity function hoax(address who, address origin, uint256 give) public; ``` ### Description Sets up a [`prank`](../../cheatcodes/prank.md) from an address that has some ether. If the balance is not specified, it will be set to 2^128 wei.",112
142,chain-commands.md,chain-commands.md. ## Chain Commands - [cast chain-id](./cast-chain-id.md) - [cast chain](./cast-chain.md) - [cast client](./cast-client.md) ,41
143,dependencies.md,"dependencies.md. ## Dependencies Forge manages dependencies using [git submodules](https://git-scm.com/book/en/v2/Git-Tools-Submodules) by default, which means that it works with any GitHub repository that contains smart contracts. ### Adding a dependency To add a dependency, run [`forge install`](../reference/forge/forge-install.md): ```sh {{#include ../output/deps/forge-install:all}} ``` This pulls the `solmate` library, stages the `.gitmodules` file in git and makes a commit with the message ""Installed solmate"". If we now check the `lib` folder: ```sh {{#include ../output/deps/tree:all}} ``` We can see that Forge installed `solmate`! By default, `forge install` installs the latest master branch version. If you want to install a specific tag or commit, you can do it like so: ```sh $ forge install transmissions11/solmate@v7 ``` ### Remapping dependencies Forge can remap dependencies to make them easier to import. Forge will automatically try to deduce some remappings for you: ```sh {{#include ../output/deps/forge-remappings:all}} ``` These remappings mean: - To import from `forge-std` we would write: `import ""forge-std/Contract.sol"";` - To import from `ds-test` we would write: `import ""ds-test/Contract.sol"";` - To import from `solmate` we would write: `import ""solmate/Contract.sol"";` - To import from `weird-erc20` we would write: `import ""weird-erc20/Contract.sol"";` You can customize these remappings by creating a `remappings.txt` file in the root of your project. Let's create a remapping called `solmate-utils` that points to the `utils` folder in the solmate repository! ```sh solmate-utils/=lib/solmate/src/utils/ ``` Now we can import any of the contracts in `src/utils` of the solmate repository like so: ```solidity import ""solmate-utils/Contract.sol""; ``` ### Updating dependencies You can update a specific dependency to the latest commit on the version you have specified using [`forge update <dep>`](../reference/forge/forge-update.md).",479
144,record-logs.md,"record-logs.md. ## `recordLogs` ### Signature ```solidity function recordLogs() external; ``` ### Description Tells the VM to start recording all the emitted events. To access them, use [`getRecordedLogs`](./get-recorded-logs.md). ### Examples ```solidity /// event LogCompleted( /// uint256 indexed topic1, /// bytes data /// ); vm.recordLogs(); emit LogCompleted(10, ""operation completed""); Vm.Log[] memory entries = vm.getRecordedLogs(); assertEq(entries.length, 1); assertEq(entries[0].topics[0], keccak256(""LogCompleted(uint256,bytes)"")); assertEq(entries[0].topics[1], bytes32(uint256(10))); assertEq(abi.decode(entries[0].data, (string)), ""operation completed""); ``` ",170
145,foundry-docker.md,"foundry-docker.md. ## Dockerizing a Foundry project This tutorial shows you how to build, test, and deploy a smart contract using Foundry's Docker image. It adapts code from the [solmate nft](./solmate-nft.md) tutorial. If you haven't completed that tutorial yet, and are new to solidity, you may want to start with it first. Alternatively, if you have some familiarity with Docker and Solidity, you can use your own existing project and adjust accordingly. The full source code for both the NFT and the Docker stuff is available [here](https://github.com/dmfxyz/foundry-docker-tutorial). > This tutorial is for illustrative purposes only and provided on an as-is basis. The tutorial is not audited nor fully tested. No code in this tutorial should be used in a production environment. ### Installation and Setup The only installation required to run this tutorial is Docker, and optionally, an IDE of your choice. Follow the [Docker installation instructions](/getting-started/installation.html#using-with-docker). To keep future commands succinct, let's re-tag the image: `docker tag ghcr.io/foundry-rs/foundry:latest foundry:latest` Having Foundry installed locally is not strictly required, but it may be helpful for debugging. You can install it using [foundryup](/getting-started/installation.html#using-foundryup). Finally, to use any of the `cast` or `forge create` portions of this tutorial, you will need access to an Ethereum node. If you don't have your own node running (likely), you can use a 3rd party node service. We won't recommend a specific provider in this tutorial. A good place to start learning about Nodes-as-a-Service is [Ethereum's article](https://ethereum.org/en/developers/docs/nodes-and-clients/nodes-as-a-service/) on the subject. **For the rest of this tutorial, it is assumed that the RPC endpoint of your ethereum node is set like this**: `export RPC_URL=<YOUR_RPC_URL>` ### A tour around the Foundry docker image The docker image can be used in two primary ways: 1. As an interface directly to forge and cast 2.",470
146,foundry-docker.md,"As a base image for building your own containerized test, build, and deployment tooling We will cover both, but let's start by taking a look at interfacing with foundry using docker. This is also a good test that your local installation worked! We can run any of the `cast` [commands](/reference/cast/) against our docker image.",74
147,foundry-docker.md,"For example: ```sh $ docker run -v $PWD:/app foundry ""forge test --root /app --watch"" {{#include ../output/nft_tutorial/forge-test:output}} ``` You can see our code was compiled and tested entirely within the container. Also, since we passed the `--watch` option, the container will recompile the code whenever a change is detected. > Note: The Foundry docker image is built on alpine and designed to be as slim as possible. For this reason, it does not currently include development resources like `git`. If you are planning to manage your entire development lifecycle within the container, you should build a custom development image on top of Foundry's image. ### Creating a ""build and test"" image Let's use the Foundry docker image as a base for using our own Docker image. We'll use the image to: 1. Build our solidity code 2. Run our solidity tests A simple `Dockerfile` can accomplish these two goals: ```docker # Use the latest foundry image FROM ghcr.io/foundry-rs/foundry # Copy our source code into the container WORKDIR /app # Build and test the source code COPY . . RUN forge build RUN forge test ``` You can build this docker image and watch forge build/run the tests within the container: ```sh $ docker build --no-cache --progress=plain . ``` Now, what happens if one of our tests fails? Modify `src/test/NFT.t.sol` as you please to make one of the tests fails. Try to build image again. ```sh $ docker build --no-cache --progress=plain . <...> #9 0.522 Failed tests: #9 0.522 [FAIL.",360
148,foundry-docker.md,"Reason: Ownable: caller is not the owner] testWithdrawalFailsAsNotOwner() (gas: 193917) #9 0.522 #9 0.522 Encountered a total of 1 failing tests, 9 tests succeeded ------ error: failed to solve: executor failed running [/bin/sh -c forge test]: exit code: 1 ``` Our image failed to build because our tests failed! This is actually a nice property, because it means if we have a Docker image that successfully built (and therefore is available for use), we know the code inside the image passed the tests.* > *Of course, chain of custody of your docker images is very important. Docker layer hashes can be very useful for verification. In a production environment, consider [signing your docker images](https://docs.docker.com/engine/security/trust/#:~:text=To%20sign%20a%20Docker%20Image,the%20local%20Docker%20trust%20repository). ### Creating a deployer image Now, we'll move on to a bit more of an advanced Dockerfile. Let's add an entrypoint that allows us to deploy our code by using the built (and tested!) image. We can target the Rinkeby testnet first. ```docker # Use the latest foundry image FROM ghcr.io/foundry-rs/foundry # Copy our source code into the container WORKDIR /app # Build and test the source code COPY . . RUN forge build RUN forge test # Set the entrypoint to the forge deployment command ENTRYPOINT [""forge"", ""create""] ``` Let's build the image, this time giving it a name: ```sh $ docker build --no-cache --progress=plain -t nft-deployer .",366
149,foundry-docker.md,"``` Here's how we can use our docker image to deploy: ```sh $ docker run nft-deployer --rpc-url $RPC_URL --constructor-args ""ForgeNFT"" ""FNFT"" ""https://ethereum.org"" --private-key $PRIVATE_KEY ./src/NFT.sol:NFT No files changed, compilation skipped Deployer: 0x496e09fcb240c33b8fda3b4b74d81697c03b6b3d Deployed to: 0x23d465eaa80ad2e5cdb1a2345e4b54edd12560d3 Transaction hash: 0xf88c68c4a03a86b0e7ecb05cae8dea36f2896cd342a6af978cab11101c6224a9 ``` We've just built, tested, and deployed our contract entirely within a docker container! This tutorial was intended for testnet, but you can run the exact same Docker image targeting mainnet and be confident that the same code is being deployed by the same tooling. ### Why is this useful? Docker is about portability, reproducibility, and environment invariance. This means you can be less concerned about unexpected changes when you switch between environments, networks, developers, etc. Here are a few basic examples of why **I** like to use Docker images for smart contract deployment: * Reduces overhead of ensuring system level dependencies match between deployment environments (e.g. does your production runner always have the same version of `forge` as your dev runner?) * Increases confidence that code has been tested prior to deployment and has not been altered (e.g. if, in the above image, your code re-compiles on deployment, that's a major red flag). * Eases pain points around segregation of duties: people with your mainnet credentials do not need to ensure they have the latest compiler, codebase, etc. It's easy to ensure that the docker deploy image someone ran in testnet is identical to the one targeting mainnet. * At the risk of sounding web2, Docker is an accepted standard on virtually all public cloud providers. It makes it easy to schedule jobs, tasks, etc that need to interact with the blockchain. ### Troubleshooting As noted above, the Foundry image does not include `git` by default. This can cause certain commands to fail without a clear cause.",499
150,shell-autocompletion.md,"shell-autocompletion.md. ## Shell Autocompletion You can generate autocompletion shell scripts for `bash`, `elvish`, `fish`, `powershell`, and `zsh`. ### zsh First, ensure that the following is present somewhere in your `~/.zshrc` file (if not, add it): ```sh autoload -U compinit compinit -i ``` Then run: ```sh forge completions zsh > /usr/local/share/zsh/site-functions/_forge cast completions zsh > /usr/local/share/zsh/site-functions/_cast anvil completions zsh > /usr/local/share/zsh/site-functions/_anvil ``` For ARM-based systems: ```sh forge completions zsh > /opt/homebrew/completions/zsh/_forge cast completions zsh > /opt/homebrew/completions/zsh/_cast anvil completions zsh > /opt/homebrew/completions/zsh/_anvil ``` ### fish ```sh mkdir -p $HOME/.config/fish/completions forge completions fish > $HOME/.config/fish/completions/forge.fish cast completions fish > $HOME/.config/fish/completions/cast.fish anvil completions fish > $HOME/.config/fish/completions/anvil.fish source $HOME/.config/fish/config.fish ``` ### bash ```sh mkdir -p $HOME/.local/share/bash-completion/completions forge completions bash > $HOME/.local/share/bash-completion/completions/forge cast completions bash > $HOME/.local/share/bash-completion/completions/cast anvil completions bash > $HOME/.local/share/bash-completion/completions/anvil exec bash ``` ",357
151,verifier-options.md,"verifier-options.md. `--verifier` *name* &nbsp;&nbsp;&nbsp;&nbsp;The verification provider. Available options: `etherscan`, `sourcify` & `blockscout`. Default: `etherscan`. `--verifier-url` *url* &nbsp;&nbsp;&nbsp;&nbsp;The optional verifier url for submitting the verification request. &nbsp;&nbsp;&nbsp;&nbsp;Environment: `VERIFIER_URL` ",98
152,assertEq.md,"assertEq.md. ## `assertEq` ### Signature ```solidity function assertEq(bool a, bool b) internal; ``` ```solidity function assertEq(bool a, bool b, string memory err) internal; ``` ```solidity function assertEq(bytes memory a, bytes memory b) internal; ``` ```solidity function assertEq(bytes memory a, bytes memory b, string memory err) internal; ``` ```solidity function assertEq(uint256[] memory a, uint256[] memory b) internal; ``` ```solidity function assertEq(int256[] memory a, int256[] memory b) internal; ``` ```solidity function assertEq(uint256[] memory a, uint256[] memory b, string memory err) internal; ``` ```solidity function assertEq(int256[] memory a, int256[] memory b, string memory err) internal; ``` ```solidity // legacy helper for asserting two uints shorter than 256 bits: `assertEqUint(uint8(1), uint128(1));` function assertEqUint(uint256 a, uint256 b) internal; ``` ### Description Asserts `a` is equal to `b`. Works with `bool`, `bytes`, and `int256` and `uint256` arrays. ",256
153,rewind.md,"rewind.md. ## `rewind` ### Signature ```solidity function rewind(uint256 time) public; ``` ### Description Rewinds `block.timestamp` by the specified number of seconds. ### Examples ```solidity assertEq(block.timestamp, 3600); rewind(3600); assertEq(block.timestamp, 0); ``` ",67
154,get-recorded-logs.md,"get-recorded-logs.md. ## `getRecordedLogs` ### Signature ```solidity struct Log { bytes32[] topics; bytes data; address emitter; } function getRecordedLogs() external returns ( Log[] memory ); ``` ### Description Gets the emitted events recorded by [`recordLogs`](./record-logs.md). This function will consume the recorded logs when called. ### Examples ```solidity /// event LogTopic1( /// uint256 indexed topic1, /// bytes data /// ); /// event LogTopic12( /// uint256 indexed topic1, /// uint256 indexed topic2, /// bytes data /// ); /// bytes memory testData0 = ""Some data""; /// bytes memory testData1 = ""Other data""; // Start the recorder vm.recordLogs(); emit LogTopic1(10, testData0); emit LogTopic12(20, 30, testData1); // Notice that your entries are <Interface>.Log[] // as opposed to <instance>.Log[] Vm.Log[] memory entries = vm.getRecordedLogs(); assertEq(entries.length, 2); // Recall that topics[0] is the event signature assertEq(entries[0].topics.length, 2); assertEq(entries[0].topics[0], keccak256(""LogTopic1(uint256,bytes)"")); assertEq(entries[0].topics[1], bytes32(uint256(10))); // assertEq won't compare bytes variables. Try with strings instead.",293
155,cast--abi-decode.md,"cast--abi-decode.md. ## cast --abi-decode ### NAME cast---abi-decode - Decode ABI-encoded input or output data. ### SYNOPSIS ``cast --abi-decode`` [*options*] *sig* *calldata* ### DESCRIPTION Decode ABI-encoded input or output data. By default, the command will decode output data. To decode input data, pass `--input` or use [`cast --calldata-decode`](./cast--calldata-decode.md). The signature (*sig*) is a fragment in the form `<function name>(<types...>)(<types...>)`. ### OPTIONS #### Decoder Options `-i` `--input` &nbsp;&nbsp;&nbsp;&nbsp;Decode input data. {{#include common-options.md}} ### EXAMPLES 1. Decode output data for a `balanceOf` call:  ```sh  cast --abi-decode ""balanceOf(address)(uint256)"" \  0x000000000000000000000000000000000000000000000000000000000000000a  ``` 2. Decode input data for a `transfer` call:  ```sh  cast --abi-decode --input ""transfer(address,uint256)"" \  0xa9059cbb000000000000000000000000e78388b4ce79068e89bf8aa7f218ef6b9ab0e9d0000000000000000000000000000000000000000000000000008a8e4b1a3d8000  ``` ### SEE ALSO [cast](./cast.md), [cast --calldata-decode](./cast--calldata-decode.md) ",350
156,forge-create.md,"forge-create.md. ## forge create ### NAME forge-create - Deploy a smart contract. ### SYNOPSIS ``forge create`` [*options*] *contract* ### DESCRIPTION Deploy a smart contract. The path to the contract is in the format `<path>:<contract>`, e.g. `src/Contract.sol:Contract`. You can specify constructor arguments with `--constructor-args`. Alternatively, you can specify a file containing space-separated constructor arguments with `--constructor-args-path`. Dynamic linking is not supported: you should predeploy your libraries and manually specify their addresses (see `--libraries`). > ℹ️ **Note** > > The `--constructor-args` flag must be positioned last in the command, since it takes multiple values. ### OPTIONS #### Build Options `--constructor-args` *args...* &nbsp;&nbsp;&nbsp;&nbsp;The constructor arguments. `--constructor-args-path` *file* &nbsp;&nbsp;&nbsp;&nbsp;The path to a file containing the constructor arguments. `--verify` &nbsp;&nbsp;&nbsp;&nbsp;Verify contract after creation. Runs `forge verify-contract` with the appropriate parameters. {{#include ../common/verifier-options.md}} `--unlocked` &nbsp;&nbsp;&nbsp;&nbsp;Send via `eth_sendTransaction` using the `--from` argument or `$ETH_FROM` as sender. {{#include ../common/transaction-options.md}} {{#include ../common/wallet-options.md}} {{#include ../common/rpc-options.md}} {{#include ../common/etherscan-options.md}} {{#include core-build-options.md}} {{#include ../common/display-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Deploy a contract with no constructor arguments:  ```sh  forge create src/Contract.sol:ContractWithNoConstructor  ``` 2. Deploy a contract with two constructor arguments:  ```sh  forge create src/Contract.sol:MyToken --constructor-args ""My Token"" ""MT""  ``` ### SEE ALSO [forge](./forge.md), [forge build](./forge-build.md), [forge verify-contract](./forge-verify-contract.md) [eip1559]: https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1559.md ",478
157,sig.md,"sig.md. ## `sig` ### Signature ```solidity function sig(StdStorage storage self, bytes4 _sig) internal returns (StdStorage storage); ``` ```solidity function sig(StdStorage storage self, string memory _sig) internal returns (StdStorage storage); ``` ### Description Sets the 4-byte selector of the function to static call. Default value: `hex""00000000""` ### Examples ```solidity uint256 slot = stdstore  .target(addr)  .sig(addr.fun.selector)  .with_key(1)  .find(); ``` ```solidity uint256 slot = stdstore  .target(addr)  .sig(""fun(uint256)"")  .with_key(1)  .find(); ```",151
158,config_README.md,"config_README.md. ## Configuring with `foundry.toml` Forge can be configured using a configuration file called `foundry.toml`, which is placed in the root of your project. Configuration can be namespaced by profiles. The default profile is named `default`, from which all other profiles inherit. You are free to customize the `default` profile, and add as many new profiles as you need. Additionally, you can create a global `foundry.toml` in your home directory. Let's take a look at a configuration file that contains two profiles: the default profile, which always enables the optimizer, as well as a CI profile, that always displays traces: ```toml [profile.default] optimizer = true optimizer_runs = 20_000 [profile.ci] verbosity = 4 ``` When running `forge`, you can specify the profile to use using the `FOUNDRY_PROFILE` environment variable. ### Standalone sections Besides the profile sections, the configuration file can also contain standalone sections (`[fmt]`, `[fuzz]`, `[invariant]` etc). By default, each standalone section belongs to the `default` profile. i.e. `[fmt]` is equivalent to `[profile.default.fmt]`. To configure the standalone section for different profiles other than `default`, use syntax `[profile.<profile name>.<standalone>]`. i.e. `[profile.ci.fuzz]`. <br> > 📚 **Reference** > > See the [`foundry.toml` Reference](../reference/config/) for a complete overview of what you can configure. ",326
159,cast--to-base.md,"cast--to-base.md. ## cast --to-base ### NAME cast---to-base - Convert a number of one base to another. ### SYNOPSIS ``cast --to-base`` [*options*] *value* *base* ### DESCRIPTION Convert a number of one base to another. ### OPTIONS #### Base Options `--base-in` *base* &nbsp;&nbsp;&nbsp;&nbsp;The base of the input number. Available options: &nbsp;&nbsp;&nbsp;&nbsp;10, d, dec, decimal &nbsp;&nbsp;&nbsp;&nbsp;16, h, hex, hexadecimal {{#include common-options.md}} ### EXAMPLES 1. Convert the decimal number 64 to hexadecimal  ```sh  cast --to-base 64 hex  ``` 2. Convert the hexadecimal number 100 to binary  ```sh  cast --to-base 0x100 2  ``` > Note: The --base-in parameter is not enforced but will be needed if the input is ambiguous. ### SEE ALSO [cast](./cast.md) ",214
160,testing-eip712.md,"testing-eip712.md. ## Testing EIP-712 Signatures ### Intro [EIP-712](https://eips.ethereum.org/EIPS/eip-712) introduced the ability to sign transactions off-chain which other users can later execute on-chain. A common example is [EIP-2612](https://eips.ethereum.org/EIPS/eip-2612) gasless token approvals. Traditionally, setting a user or contract allowance to transfer ERC-20 tokens from an owner's balance required the owner to submit an approval on-chain. As this proved to be poor UX, DAI introduced ERC-20 `permit` (later standardized as EIP-2612) allowing the owner to sign the approval _off-chain_ which the spender (or anyone else!) can submit on-chain prior to the `transferFrom`. This guide will cover testing this pattern in Solidity using Foundry. ### Diving In First we'll cover a basic token transfer: - Owner signs approval off-chain - Spender calls `permit` and `transferFrom` on-chain We'll use [Solmate's ERC-20](https://github.com/transmissions11/solmate/blob/main/src/tokens/ERC20.sol), as EIP-712 and EIP-2612 batteries come included. Take a glance over the full contract if you haven't already - here is `permit` implemented: ```solidity  /*//////////////////////////////////////////////////////////////        EIP-2612 LOGIC  //////////////////////////////////////////////////////////////*/  function permit(   address owner,   address spender,   uint256 value,   uint256 deadline,   uint8 v,   bytes32 r,   bytes32 s  ) public virtual {   require(deadline >= block.timestamp, ""PERMIT_DEADLINE_EXPIRED"");   // Unchecked because the only math done is incrementing   // the owner's nonce which cannot realistically overflow.",383
161,testing-eip712.md,"  unchecked {    address recoveredAddress = ecrecover(     keccak256(      abi.encodePacked(       ""\x19\x01"",       DOMAIN_SEPARATOR(),       keccak256(        abi.encode(         keccak256(          ""Permit(address owner,address spender,uint256 value,uint256 nonce,uint256 deadline)""         ),         owner,         spender,         value,         nonces[owner]++,         deadline        )       )      )     ),     v,     r,     s    );    require(recoveredAddress != address(0) && recoveredAddress == owner, ""INVALID_SIGNER"");    allowance[recoveredAddress][spender] = value;   }   emit Approval(owner, spender, value);  } ``` We'll also be using a custom `SigUtils` contract to help create, hash, and sign the approvals off-chain.",176
162,testing-eip712.md,"```solidity // SPDX-License-Identifier: UNLICENSED pragma solidity 0.8.13; contract SigUtils {  bytes32 internal DOMAIN_SEPARATOR;  constructor(bytes32 _DOMAIN_SEPARATOR) {   DOMAIN_SEPARATOR = _DOMAIN_SEPARATOR;  }  // keccak256(""Permit(address owner,address spender,uint256 value,uint256 nonce,uint256 deadline)"");  bytes32 public constant PERMIT_TYPEHASH =   0x6e71edae12b1b97f4d1f60370fef10105fa2faae0126114a169c64845d6126c9;  struct Permit {   address owner;   address spender;   uint256 value;   uint256 nonce;   uint256 deadline;  }  // computes the hash of a permit  function getStructHash(Permit memory _permit)   internal   pure   returns (bytes32)  {   return    keccak256(     abi.encode(      PERMIT_TYPEHASH,      _permit.owner,      _permit.spender,      _permit.value,      _permit.nonce,      _permit.deadline     )    );  }  // computes the hash of the fully encoded EIP-712 message for the domain, which can be used to recover the signer  function getTypedDataHash(Permit memory _permit)   public   view   returns (bytes32)  {   return    keccak256(     abi.encodePacked(      ""\x19\x01"",      DOMAIN_SEPARATOR,      getStructHash(_permit)     )    );  } } ``` ### Handling Dynamic Values While the Permit struct passed in the getStructHash() function above doesn't contain any dynamic value types, if you're using them it's important to remember that 'bytes' and 'string' types must be encoded as a 'keccak256' hash of their contents. More on this aspect of the [EIP 712 Spec here](https://github.com/ethereum/EIPs/blob/8061f8e2243eaae829d1fa91f7a763c889aca371/EIPS/eip-712.md?plain=1#L135).",448
163,testing-eip712.md,"Note how `deposit` requires a preliminary `approve` or `permit` tx in order to transfer tokens, while `depositWithPermit` sets the allowance _and_ transfers the tokens in a single tx.",43
164,get-nonce.md,get-nonce.md. ## `getNonce` ### Signature ```solidity function getNonce(address account) external returns (uint64); ``` ### Description Gets the nonce of the given account. ### Examples ```solidity uint256 nonce = vm.getNonce(address(100)); emit log_uint(nonce); // 0 ``` ,65
165,env-address.md,"env-address.md. ## `envAddress` ### Signature ```solidity function envAddress(string calldata key) external returns (address value); ``` ```solidity function envAddress(string calldata key, string calldata delimiter) external returns (address[] memory values); ``` ### Description Read an environment variable as `address` or `address[]`. ### Tips - For arrays, you can specify the delimiter used to seperate the values with the `delimiter` parameter. ### Examples #### Single Value With environment variable `ADDRESS_VALUE=0x7109709ECfa91a80626fF3989D68f67F5b1DD12D`, ```solidity string memory key = ""ADDRESS_VALUE""; address expected = 0x7109709ECfa91a80626fF3989D68f67F5b1DD12D; address output = cheats.envAddress(key); assert(output == expected); ``` #### Array With environment variable `ADDRESS_VALUES=0x7109709ECfa91a80626fF3989D68f67F5b1DD12D,0x0000000000000000000000000000000000000000`, ```solidity string memory key = ""ADDRESS_VALUES""; string memory delimiter = "",""; address[2] memory expected = [  0x7109709ECfa91a80626fF3989D68f67F5b1DD12D,  0x0000000000000000000000000000000000000000 ]; address[] memory output = cheats.envAddress(key, delimiter); assert(keccak256(abi.encodePacked((output))) == keccak256(abi.encodePacked((expected)))); ``` ",353
166,forge-flatten.md,"forge-flatten.md. ## forge flatten ### NAME forge-flatten - Flatten a source file and all of its imports into one file. ### SYNOPSIS ``forge flatten`` [*options*] *file* ### DESCRIPTION Flatten a source file and all of its imports into one file. If `--output <FILE>` is not set, then the flattened contract will be output to stdout. ### OPTIONS #### Flatten Options `-o` *file* `--output` *file* &nbsp;&nbsp;&nbsp;&nbsp;The path to output the flattened contract. If not specified, the flattened contract will be output to stdout. {{#include project-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Flatten `src/Contract.sol`:  ```sh  forge flatten src/Contract.sol  ``` 2. Flatten `src/Contract.sol` and write the result to `src/Contract.flattened.sol`:  ```sh  forge flatten --output src/Contract.flattened.sol src/Contract.sol  ``` ### SEE ALSO [forge](./forge.md), [forge verify-contract](./forge-verify-contract.md) ",234
167,best-practices.md,"best-practices.md. # Best Practices This guide documents the suggested best practices when developing with Foundry. In general, it's recommended to handle as much as possible with [`forge fmt`](../reference/config/formatter.md), and anything this doesn't handle is below. - [General Contract Guidance](#general-contract-guidance) - [Tests](#tests) - [General Test Guidance](#general-test-guidance) - [Fork Tests](#fork-tests) - [Test Harnesses](#test-harnesses)  - [Internal Functions](#internal-functions)  - [Private Functions](#private-functions)  - [Workaround Functions](#workaround-functions) - [Best practices](#best-practices) - [Taint Analysis](#taint-analysis) - [Scripts](#scripts) - [Comments](#comments) - [Resources](#resources) ## General Contract Guidance 1. Always use named import syntax, don't import full files. This restricts what is being imported to just the named items, not everything in the file. Importing full files can result in solc complaining about duplicate definitions and slither erroring, especially as repos grow and have more dependencies with overlapping names.  - Good: `import {MyContract} from ""src/MyContract.sol""` to only import `MyContract`. - Bad: `import ""src/MyContract.sol""` imports everything in `MyContract.sol`. (Importing `forge-std/Test` or `Script` can be an exception here, so you get the console library, etc). 1. Sort imports by `forge-std/` first, then dependencies, `test/`, `script/`, and finally `src/`. Within each, sort alphabetically by path (not by the explicit named items being imported). _(Note: This may be removed once [foundry-rs/foundry#3396](https://github.com/foundry-rs/foundry/issues/3396) is merged)._ 1. Similarly, sort named imports.",422
168,best-practices.md,"_(Note: This may be removed once [foundry-rs/foundry#3396](https://github.com/foundry-rs/foundry/issues/3396) is resolved)._  - Good: `import {bar, foo} from ""src/MyContract.sol""` - Bad: `import {foo, bar} from ""src/MyContract.sol""` 1. Note the tradeoffs between absolute and relative paths for imports (where absolute paths are relative to the repo root, e.g. `""src/interfaces/IERC20.sol""`), and choose the best approach for your project:  - Absolute paths make it easier to see where files are from and reduce churn when moving files around. - Relative paths make it more likely your editor can provide features like linting and autocomplete, since editors/extensions may not understand your remappings. 1. If copying a library from a dependency (instead of importing it), use the `ignore = []` option in the config file to avoid formatting that file. This makes diffing it against the original simpler for reviewers and auditors. 1. Similarly, feel free to use the `// forgefmt: disable-*` comment directives to ignore lines/sections of code that look better with manual formatting. Supported values for `*` are:  - `disable-line` - `disable-next-line` - `disable-next-item` - `disable-start` - `disable-end` Additional best practices from [samsczun](https://twitter.com/samczsun)'s [How Do You Even Write Secure Code Anyways](https://www.youtube.com/watch?v=Wm3t8Fuiy1E) talk: - Use descriptive variable names. - Limit the number of active variables. - No redundant logic. - Early exit as much as possible to reduce mental load when seeing the code. - Related code should be placed near each other. - Delete unused code. ## Tests ### General Test Guidance 1. For testing `MyContract.sol`, the test file should be `MyContract.t.sol`. For testing `MyScript.s.sol`, the test file should be `MyScript.t.sol`.  - If the contract is big and you want to split it over multiple files, group them logically like `MyContract.owner.t.sol`, `MyContract.deposits.t.sol`, etc. 1.",481
169,best-practices.md,"Never make assertions in the `setUp` function, instead use a dedicated test like `test_SetUpState()` if you need to ensure your `setUp` function does what you expected. More info on why in [foundry-rs/foundry#1291](https://github.com/foundry-rs/foundry/issues/1291) 1. For unit tests, there are two major ways to organize the tests:  1. Treat contracts as describe blocks:  - `contract Add` holds all unit tests for the `add` method of `MyContract`.  - `contract Supply` holds all tests for the `supply` method.  - `contract Constructor` hold all tests for the constructor.  - A benefit of this approach is that smaller contracts should compile faster than large ones, so this approach of many small contracts should save time as test suites get large.  2. Have a Test contract per contract-under-test, with as many utilities and fixtures as you want:  - `contract MyContractTest` holds all unit tests for `MyContract`.  - `function test_add_AddsTwoNumbers()` lives within `MyContractTest` to test the `add` method.  - `function test_supply_UsersCanSupplyTokens()` also lives within `MyContractTest` to test the `supply` method.  - A benefit of this approach is that test output is grouped by contract-under-test, which makes it easier to quickly see where failures are. 1. Some general guidance for all tests:  - Test contracts/functions should be written in the same order as the original functions in the contract-under-test. - All unit tests that test the same function should live serially in the test file. - Test contracts can inherit from any helper contracts you want. For example `contract MyContractTest` tests `MyContract`, but may inherit from forge-std's `Test`, as well as e.g. your own `TestUtilities` helper contract. 1. Integration tests should live in the same `test` directory, with a clear naming convention. These may be in dedicated files, or they may live next to related unit tests in existing test files. 1. Be consistent with test naming, as it's helpful for filtering tests (e.g. for gas reports you might want to filter out revert tests). When combining naming conventions, keep them alphabetical. Below is a sample of valid names.",497
170,best-practices.md,"A comprehensive list of valid and invalid examples can be found [here](https://github.com/ScopeLift/scopelint/blob/1857e3940bfe92ac5a136827374f4b27ff083971/src/check/validators/test_names.rs#L106-L143).  - `test_Description` for standard tests. - `testFuzz_Description` for fuzz tests. - `test_Revert[If|When]_Condition` for tests expecting a revert. - `testFork_Description` for tests that fork from a network. - `testForkFuzz_Revert[If|When]_Condition` for a fuzz test that forks and expects a revert. 1. Name your constants and immutables using `ALL_CAPS_WITH_UNDERSCORES`, to make it easier to distinguish them from variables and functions. 1. When using assertions like `assertEq`, consider leveraging the last string param to make it easier to identify failures. These can be kept brief, or even just be numbers&mdash;they basically serve as a replacement for showing line numbers of the revert, e.g. `assertEq(x, y, ""1"")` or `assertEq(x, y, ""sum1"")`. _(Note: [foundry-rs/foundry#2328](https://github.com/foundry-rs/foundry/issues/2328) tracks integrating this natively)._ 1. When testing events, prefer setting all `expectEmit` arguments to `true`, i.e. `vm.expectEmit(true, true, true, true)`. Benefits:  - This ensures you test everything in your event. - If you add a topic (i.e. a new indexed parameter), it's now tested by default. - Even if you only have 1 topic, the extra `true` arguments don't hurt. 1. Remember to write invariant tests! For the assertion string, use a verbose english description of the invariant: `assertEq(x + y, z, ""Invariant violated: the sum of x and y must always equal z"")`. For more info on this, check out the [Invariant Testing](../forge/invariant-testing) tutorial. ### Fork Tests 1.",463
171,best-practices.md,"Don't feel like you need to give forks tests special treatment, and use them liberally:  - Mocks are _required_ in closed-source web2 development—you have to mock API responses because the code for that API isn't open source so you cannot just run it locally. But for blockchains that's not true: any code you're interacting with that's already deployed can be locally executed and even modified for free. So why introduce the risk of a wrong mock if you don't need to? - A common reason to avoid fork tests and prefer mocks is that fork tests are slow. But this is not always true. By pinning to a block number, forge caches RPC responses so only the first run is slower, and subsequent runs are significantly faster. See [this benchmark](https://github.com/mds1/convex-shutdown-simulation/), where it took forge 7 minutes for the first run with a remote RPC, but only half a second once data was cached. Alchemy and Infura both offer free archive data, so pinning to a block shouldn't be problematic. - Note that the [foundry-toolchain](https://github.com/foundry-rs/foundry-toolchain) GitHub Action will cache RPC responses in CI by default, and it will also update the cache when you update your fork tests.. 1. Be careful with fuzz tests on a fork to avoid burning through RPC requests with non-deterministic fuzzing. If the input to your fork fuzz test is some parameter which is used in an RPC call to fetch data (e.g. querying the token balance of an address), each run of a fuzz test uses at least 1 RPC request, so you'll quickly hit rate limits or usage limits. Solutions to consider:  - Replace multiple RPC calls with a single [multicall](https://github.com/mds1/multicall). - Specify a fuzz/invariant [seed](/src/reference/config/testing.md#seed): this makes sure each `forge test` invocation uses the same fuzz inputs. RPC results are cached locally, so you'll only query the node the first time. - Structure your tests so the data you are fuzzing over is computed locally by your contract, and not data that is used in an RPC call (may or may not be feasible based on what you're doing). - Lastly, you can of course always run a local node or bump your RPC plan.",497
172,best-practices.md,"1. When writing fork tests, do not use the `--fork-url` flag. Instead, prefer the following approach for its improved flexibility:  - Define `[rpc_endpoints]` in the `foundry.toml` config file and use the [forking cheatcodes](../forge/fork-testing.md#forking-cheatcodes). - Access the RPC URL endpoint in your test with forge-std's `stdChains.ChainName.rpcUrl`. See the list of supported chains and expected config file aliases [here](https://github.com/foundry-rs/forge-std/blob/ff4bf7db008d096ea5a657f2c20516182252a3ed/src/StdCheats.sol#L255-L271). - Always pin to a block so tests are deterministic and RPC responses are cached. - More info on this fork test approach can be found [here](https://twitter.com/msolomon44/status/1564742781129502722) (this predates `StdChains` so that aspect is a bit out of date). ### Test Harnesses #### Internal Functions To test `internal` functions, write a harness contract that inherits from the contract under test (CuT). Harness contracts that inherit from the CuT expose the `internal` functions as `external` ones. Each `internal` function that is tested should be exposed via an external one with a name that follows the pattern `exposed_<function_name>`. For example: ```solidity // file: src/MyContract.sol contract MyContract { function myInternalMethod() internal returns (uint) {  return 42; } } // file: test/MyContract.t.sol import {MyContract} from ""src/MyContract.sol""; contract MyContractHarness is MyContract { // Deploy this contract then call this method to test `myInternalMethod`. function exposed_myInternalMethod() external returns (uint) {  return myInternalMethod(); } } ``` #### Private Functions Unfortunately there is currently no good way to unit test `private` methods since they cannot be accessed by any other contracts. Options include: - Converting `private` functions to `internal`. - Copy/pasting the logic into your test contract and writing a script that runs in CI check to ensure both functions are identical.",471
173,best-practices.md,"#### Workaround Functions Harnesses can also be used to expose functionality or information otherwise unavailable in the original smart contract. The most straightforward example is when we want to test the length of a public array. The functions should follow the pattern: `workaround_<function_name>`, such as `workaround_queueLength()`. Another use case for this is tracking data that you would not track in production to help test invariants. For example, you might store a list of all token holders to simplify validation of the invariant ""sum of all balances must equal total supply"". These are often known as ""ghost variables"". You can learn more about this in [Rikard Hjort](https://twitter.com/rikardhjort)'s [Formal Methods for the Working DeFi Dev](https://youtu.be/ETlNhV9jYJw) talk. ### Best practices Thanks to [@samsczun](https://twitter.com/samczsun)'s [How Do You Even Write Secure Code Anyways](https://www.youtube.com/watch?v=Wm3t8Fuiy1E) talk for the tips in this section and the following section. - Don't optimize for coverage, optimize for well thought-out tests. - Write positive and negative unit tests. - Write _positive_ unit tests for things that the code should handle. Validate _all_ state that changes from these tests. - Write _negative_ unit tests for things that the code should _not_ handle. It's helpful to follow up (as an adjacent test) with the positive test and make the change that it needs to pass. - Each code path should have its own unit test. - Write integration tests to test entire features. - Write fork tests to verify the correct behavior with existing deployed contract. ### Taint Analysis When testing, you should prioritize functions that an attacker can affect, that means functions that accept some kind of user input. These are called _sources_. Consider that input data as _tainted_ until it has been checked by the code, at which point it's considered _clean_. A _sink_ is a part of the code where some important operation is happening. For example, in MakerDAO that would be `vat.sol`. You should _ensure_ that no _tainted_ data ever reaches a _sink_.",474
174,best-practices.md,"That means that all data that find themselves in the sink, should, at some point, have been checked by you. So, you need to define what the data _should_ be and then make sure your checks _ensure_ that the data will be how you expect it to be. ## Scripts 1. Stick with `run` as the default function name for clarity. 1. Any methods that are not intended to be called directly in the script should be `internal` or `private`. Generally the only public method should be `run`, as it's easier to read/understand when each script file just does one thing. 1. Consider prefixing scripts with a number based on the order they're intended to be run over the protocol's lifecycle. For example, `01_Deploy.s.sol`, `02_TransferOwnership.s.sol`. This makes things more self-documenting. This may not always apply depending on your project. 1. Test your scripts.  - Unit test them like you would test normal contracts, by writing tests that assert on the state changes made from running the script. - Write your deploy script and scaffold tests by running that script. Then, run all tests against the state resulting from your production deployment script. This is a great way to gain confidence in a deploy script. - Within your script itself, use `require` statements (or the `if (condition) revert()` pattern if you prefer) to stop execution of your script if something is wrong. For example, `require(computedAddress == deployedAddress, ""address mismatch"")`. Using the `assertEq` helpers instead will not stop execution. 1. **Carefully audit which transactions are broadcast**. Transactions not broadcast are still executed in the context of a test, so missing broadcasts or extra broadcasts are easy sources of error in the previous step. 1. **Watch out for frontrunning**. Forge simulates your script, generates transaction data from the simulation results, then broadcasts the transactions. Make sure your script is robust against chain-state changing between the simulation and broadcast. A sample script vulnerable to this is below: ```solidity // Pseudo-code, may not compile. contract VulnerableScript is Script { function run() public {  vm.startBroadcast();  // Transaction 1: Deploy a new Gnosis Safe with CREATE.",475
175,best-practices.md," // Because we're using CREATE instead of CREATE2, the address of the new  // Safe is a function of the nonce of the gnosisSafeProxyFactory.  address mySafe = gnosisSafeProxyFactory.createProxy(singleton, data);  // Transaction 2: Send tokens to the new Safe.  // We know the address of mySafe is a function of the nonce of the  // gnosisSafeProxyFactory. If someone else deploys a Gnosis Safe between  // the simulation and broadcast, the address of mySafe will be different,  // and this script will send 1000 DAI to the other person's Safe. In this  // case, we can protect ourselves from this by using CREATE2 instead of  // CREATE, but every situation may have different solutions.  dai.transfer(mySafe, 1000e18);  vm.stopBroadcast(); } } ``` 1. For scripts that read from JSON input files, put the input files in `script/input/<chainID>/<description>.json`. Then have `run(string memory input)` (or take multiple string inputs if you need to read from multiple files) as the script's signature, and use the below method to read the JSON file. ```solidity function readInput(string memory input) internal returns (string memory) { string memory inputDir = string.concat(vm.projectRoot(), ""/script/input/""); string memory chainDir = string.concat(vm.toString(block.chainid), ""/""); string memory file = string.concat(input, "".json""); return vm.readFile(string.concat(inputDir, chainDir, file)); } ``` ## Comments 1. For public or external methods and variables, use [NatSpec](https://docs.soliditylang.org/en/latest/natspec-format.html) comments.  - `forge doc` will parse these to autogenerate documentation. - Etherscan will display them in the contract UI. 1. For simple NatSpec comments, consider just documenting params in the docstring, such as `` /// @notice Returns the sum of `x` and `y`. ``, instead of using `@param` tags. 1. For complex NatSpec comments, consider using a tool like [PlantUML](https://plantuml.com/ascii-art) to generate ASCII art diagrams to help explain complex aspects of the codebase. 1.",480
176,ref_anvil_README.md,"ref_anvil_README.md. ## anvil ### NAME anvil - Create a local testnet node for deploying and testing smart contracts. It can also be used to fork other EVM compatible networks. ### SYNOPSIS `anvil` [*options*] ### DESCRIPTION Create a local testnet node for deploying and testing smart contracts. It can also be used to fork other EVM compatible networks. This section covers an extensive list of information about Mining Modes, Supported Transport Layers, Supported RPC Methods, Anvil flags and their usages. You can run multiple flags at the same time. #### Mining Modes Mining modes refer to how frequent blocks are mined using Anvil. By default, it automatically generates a new block as soon as a transaction is submitted. You can change this setting to interval mining if you will, which means that a new block will be generated in a given period of time selected by the user. If you want to go for this type of mining, you can do it by adding the `--block-time <block-time-in-seconds>` flag, like in the following example. ```sh # Produces a new block every 10 seconds anvil --block-time 10 ``` There's also a third mining mode called never. In this case, it disables auto and interval mining, and mine on demand instead. You can do this by typing: ```sh # Enables never mining mode anvil --no-mining ``` #### Supported Transport Layers HTTP and Websocket connections are supported. The server listens on port 8545 by default, but it can be changed by running the following command: ```sh anvil --port <PORT> ``` #### Supported RPC Methods ##### Standard Methods The standard methods are based on [this](https://eth.wiki/json-rpc/API) reference.",360
177,ref_anvil_README.md,"* `web3_clientVersion` * `web3_sha3`  * `eth_chainId`  * `eth_networkId`  * `eth_gasPrice`  * `eth_accounts`  * `eth_blockNumber`  * `eth_getBalance`  * `eth_getStorageAt`  * `eth_getBlockByHash`  * `eth_getBlockByNumber`  * `eth_getTransactionCount`  * `eth_getBlockTransactionCountByHash`  * `eth_getBlockTransactionCountByNumber`  * `eth_getUncleCountByBlockHash`  * `eth_getUncleCountByBlockNumber`  * `eth_getCode`  * `eth_sign` * `eth_signTypedData_v4`  * `eth_sendTransaction`  * `eth_sendRawTransaction`  * `eth_call`  * `eth_createAccessList`  * `eth_estimateGas`  * `eth_getTransactionByHash`  * `eth_getTransactionByBlockHashAndIndex`  * `eth_getTransactionByBlockNumberAndIndex`  * `eth_getTransactionReceipt`  * `eth_getUncleByBlockHashAndIndex`  * `eth_getUncleByBlockNumberAndIndex`  * `eth_getLogs`  * `eth_newFilter`  * `eth_getFilterChanges`  * `eth_newBlockFilter`  * `eth_newPendingTransactionFilter`  * `eth_getFilterLogs`  * `eth_uninstallFilter`  * `eth_getWork` * `eth_subscribe` * `eth_unsubscribe` * `eth_syncing`  * `eth_submitWork`  * `eth_submitHashrate`  * `eth_feeHistory` * `eth_getProof` * `debug_traceTransaction` Use `anvil --steps-tracing` to get `structLogs` * `debug_traceCall` Note that non-standard traces are not yet support. This means you can't pass any arguments to the `trace` parameter. * `trace_transaction` * `trace_block` ##### Custom Methods The `anvil_*` namespace is an alias for `hardhat`. For more info, refer to the [Hardhat documentation](https://hardhat.org/hardhat-network/reference#hardhat-network-methods). `anvil_impersonateAccount` Send transactions impersonating an externally owned account or contract.",495
178,ref_anvil_README.md,"`anvil_stopImpersonatingAccount` Stops impersonating an account or contract if previously set with `anvil_impersonateAccount` `anvil_autoImpersonateAccount` Accepts `true` to enable auto impersonation of accounts, and `false` to disable it. When enabled, any transaction's sender will be automatically impersonated. Same as `anvil_impersonateAccount`. `anvil_getAutomine` Returns true if automatic mining is enabled, and false if it is not `anvil_mine` Mines a series of blocks `anvil_dropTransaction` Removes transactions from the pool `anvil_reset` Reset the fork to a fresh forked state, and optionally update the fork config `anvil_setRpcUrl` Sets the backend RPC URL `anvil_setBalance` Modifies the balance of an account `anvil_setCode` Sets the code of a contract `anvil_setNonce` Sets the nonce of an address `anvil_setStorageAt` Writes a single slot of the account's storage `anvil_setCoinbase` Sets the coinbase address `anvil_setLoggingEnabled` Enable or disable logging `anvil_setMinGasPrice` Set the minimum gas price for the node `anvil_setNextBlockBaseFeePerGas` Sets the base fee of the next block `anvil_dumpState` Returns a hex string representing the complete state of the chain. Can be re-imported into a fresh/restarted instance of Anvil to reattain the same state. `anvil_loadState` When given a hex string previously returned by `anvil_dumpState`, merges the contents into the current chain state. Will overwrite any colliding accounts/storage slots. `anvil_nodeInfo` Retrieves the configuration params for the currently running Anvil node. ##### Special Methods The special methods come from Ganache. You can take a look at the documentation [here](https://github.com/trufflesuite/ganache-cli-archive/blob/master/README.md). `evm_setAutomine` Enables or disables, based on the single boolean argument, the automatic mining of new blocks with each new transaction submitted to the network `evm_setIntervalMining` Sets the mining behavior to interval with the given interval (seconds) `evm_snapshot` Snapshot the state of the blockchain at the current block `evm_revert` Revert the state of the blockchain to a previous snapshot.",489
179,ref_anvil_README.md,"Takes a single parameter, which is the snapshot id to revert to `evm_increaseTime` Jump forward in time by the given amount of time, in seconds `evm_setNextBlockTimestamp` Similar to `evm_increaseTime` but takes the exact timestamp that you want in the next block `anvil_setBlockTimestampInterval` Similar to `evm_increaseTime` but sets a block timestamp `interval`. The timestamp of the next block will be computed as `lastBlock_timestamp + interval` `evm_setBlockGasLimit` Sets the block gas limit for the following blocks `anvil_removeBlockTimestampInterval` Removes an `anvil_setBlockTimestampInterval` if it exists `evm_mine` Mine a single block `anvil_enableTraces` Turn on call traces for transactions that are returned to the user when they execute a transaction (instead of just txhash/receipt) `eth_sendUnsignedTransaction` Execute a transaction regardless of signature status For the next three methods, make sure to read [Geth's documentation](https://geth.ethereum.org/docs/rpc/ns-txpool).",227
180,ref_anvil_README.md,"`txpool_status` Returns the number of transactions currently pending for inclusion in the next block(s), as well as the ones that are being scheduled for future execution only `txpool_inspect` Returns a summary of all the transactions currently pending for inclusion in the next block(s), as well as the ones that are being scheduled for future execution only `txpool_content` Returns the details of all transactions currently pending for inclusion in the next block(s), as well as the ones that are being scheduled for future execution only ### OPTIONS #### General Options `-a, --accounts <ACCOUNTS>` &nbsp;&nbsp;&nbsp;&nbsp; Set the number of accounts [default: 10] `-b, --block-time <block-time>` &nbsp;&nbsp;&nbsp;&nbsp; Block time in seconds for interval mining `--balance <BALANCE>` &nbsp;&nbsp;&nbsp;&nbsp; Set the balance of the accounts [default: 10000] `--derivation-path <DERIVATION_PATH>` &nbsp;&nbsp;&nbsp;&nbsp; Set the derivation path of the child key to be derived [default: m/44'/60'/0'/0/] `-h, --help` &nbsp;&nbsp;&nbsp;&nbsp; Print help information `--hardfork <HARDFORK>` &nbsp;&nbsp;&nbsp;&nbsp; Choose the EVM hardfork to use [default: latest] `--init <PATH>` &nbsp;&nbsp;&nbsp;&nbsp; Initialize the genesis block with the given `genesis.json` file.",314
181,ref_anvil_README.md,"`-m, --mnemonic <MNEMONIC>` &nbsp;&nbsp;&nbsp;&nbsp; BIP39 mnemonic phrase used for generating accounts `--no-mining` &nbsp;&nbsp;&nbsp;&nbsp; Disable auto and interval mining, and mine on demand instead `--order <ORDER>` &nbsp;&nbsp;&nbsp;&nbsp; How transactions are sorted in the mempool [default: fees] `-p, --port <PORT>` &nbsp;&nbsp;&nbsp;&nbsp; Port number to listen on [default: 8545] `--steps-tracing` &nbsp;&nbsp;&nbsp;&nbsp; Enable steps tracing used for debug calls returning geth-style traces [aliases: tracing] `--ipc [<PATH>]` &nbsp;&nbsp;&nbsp;&nbsp; Starts an IPC endpoint at the given `PATH` argument or the default path: unix: `tmp/anvil.ipc`, windows: `\\.\pipe\anvil.ipc` `--silent` &nbsp;&nbsp;&nbsp;&nbsp; Don't print anything on startup `--timestamp <TIMESTAMP>` &nbsp;&nbsp;&nbsp;&nbsp; Set the timestamp of the genesis block `-V, --version` &nbsp;&nbsp;&nbsp;&nbsp; Print version information #### EVM Options `-f, --fork-url <URL>` &nbsp;&nbsp;&nbsp;&nbsp; Fetch state over a remote endpoint instead of starting from an empty state `--fork-block-number <BLOCK>` &nbsp;&nbsp;&nbsp;&nbsp; Fetch state from a specific block number over a remote endpoint (Must pass --fork-url in the same command-line) `--fork-retry-backoff <BACKOFF>` &nbsp;&nbsp;&nbsp;&nbsp; Initial retry backoff on encountering errors. `--retries <retries>` &nbsp;&nbsp;&nbsp;&nbsp; Number of retry requests for spurious networks (timed out requests). [default value= 5] `--timeout <timeout>` &nbsp;&nbsp;&nbsp;&nbsp; Timeout in ms for requests sent to remote JSON-RPC server in forking mode.",431
182,ref_anvil_README.md,"[default value= 45000] `--compute-units-per-second <CUPS>` &nbsp;&nbsp;&nbsp;&nbsp; Sets the number of assumed available compute units per second for this provider [default value=330] &nbsp;&nbsp;&nbsp;&nbsp; See also, [Alchemy Ratelimits](https://github.com/alchemyplatform/alchemy-docs/blob/master/documentation/compute-units.md#rate-limits-cups) `--no-rate-limit` &nbsp;&nbsp;&nbsp;&nbsp; Disables rate limiting for this node's provider. Will always override `--compute-units-per-second` if present. [default value= false] &nbsp;&nbsp;&nbsp;&nbsp; See also, [Alchemy Ratelimits](https://github.com/alchemyplatform/alchemy-docs/blob/master/documentation/compute-units.md#rate-limits-cups) `--no-storage-caching>` &nbsp;&nbsp;&nbsp;&nbsp; Explicitly disables the use of RPC caching. All storage slots are read entirely from the endpoint. This flag overrides the project's configuration file (Must pass --fork-url in the same command-line) #### Executor Environment Config `--base-fee <FEE>` `--block-base-fee-per-gas <FEE>` &nbsp;&nbsp;&nbsp;&nbsp; The base fee in a block `--chain-id <CHAIN_ID>` &nbsp;&nbsp;&nbsp;&nbsp; The chain ID `--code-size-limit <CODE_SIZE>` &nbsp;&nbsp;&nbsp;&nbsp; EIP-170: Contract code size limit in bytes. Useful to increase this because of tests.",334
183,set-nonce.md,"set-nonce.md. ## `setNonce` ### Signature ```solidity function setNonce(address account, uint64 nonce) external; ``` ### Description Sets the nonce of the given account. The new nonce must be higher than the current nonce of the account. ### Examples ```solidity vm.setNonce(address(100), 1234); ``` ",70
184,cast--to-int256.md,cast--to-int256.md. ## cast --to-int256 ### NAME cast---to-int256 - Convert a number to a hex-encoded int256. ### SYNOPSIS ``cast --to-int256`` [*options*] *value* ### DESCRIPTION Convert a number to a hex-encoded int256. ### OPTIONS {{#include common-options.md}} ### SEE ALSO [cast](./cast.md) ,80
185,cast-gas-price.md,"cast-gas-price.md. ## cast gas-price ### NAME cast-gas-price - Get the current gas price. ### SYNOPSIS ``cast gas-price`` [*options*] ### DESCRIPTION Get the current gas price. ### OPTIONS #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the current gas price:  ```sh  cast gas-price  ``` ### SEE ALSO [cast](./cast.md), [cast basefee](./cast-basefee.md) ",109
186,wallet-options-keystore.md,wallet-options-keystore.md. #### Wallet Options - Keystore `--keystore` *path* &nbsp;&nbsp;&nbsp;&nbsp;Use the keystore in the given folder or file. &nbsp;&nbsp;&nbsp;&nbsp;Environment: `ETH_KEYSTORE` `--password` *password* &nbsp;&nbsp;&nbsp;&nbsp;The keystore password. Used with `--keystore`. ,86
187,cast-create2.md,"cast-create2.md. ## cast create2 ### NAME cast-create2 - Generate a deterministic contract address using CREATE2 ### SYNOPSIS ``cast create2`` [*options*] ### DESCRIPTION Generate a deterministic contract address using CREATE2 ### OPTIONS {{#include common-options.md}} ### SEE ALSO [cast](./cast.md), [cast compute-address](./cast-compute-address.md) ",77
188,forge-update.md,"forge-update.md. ## forge update ### NAME forge-update - Update one or more dependencies. ### SYNOPSIS ``forge update`` [*options*] [*dep*] ### DESCRIPTION Update one or more dependencies. The argument *dep* is a path to the dependency you want to update. Forge will update to the latest version on the ref you specified for the dependency when you ran [`forge install`](./forge-install.md). If no argument is provided, then all dependencies are updated. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Update a dependency:  ```sh  forge update lib/solmate  ``` 2. Update all dependencies:  ```sh  forge update  ``` ### SEE ALSO [forge](./forge.md), [forge install](./forge-install.md), [forge remove](./forge-remove.md) ",171
189,sign.md,"sign.md. ## `sign` ### Signature ```solidity function sign(uint256 privateKey, bytes32 digest) external returns (uint8 v, bytes32 r, bytes32 s); ``` ### Description Signs a digest `digest` with private key `privateKey`, returning `(v, r, s)`. This is useful for testing functions that take signed data and perform an `ecrecover` to verify the signer.",84
190,cast-resolve-name.md,"cast-resolve-name.md. ## cast resolve-name ### NAME cast-resolve-name - Perform an ENS lookup. ### SYNOPSIS ``cast resolve-name`` [*options*] *who* ### DESCRIPTION Perform an ENS lookup. If `--verify` is passed, then a reverse lookup is performed after the normal lookup to verify that the name is correct. ### OPTIONS #### Lookup Options `-v` `--verify` &nbsp;&nbsp;&nbsp;&nbsp;Perform a reverse lookup to verify that the name is correct. #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the address for an ENS name.  ```sh  cast resolve-name vitalik.eth  ``` 2. Perform both a normal and a reverse lookup:  ```sh  cast resolve-name --verify vitalik.eth  ``` ### SEE ALSO [cast](./cast.md), [cast lookup-address](./cast-lookup-address.md) ",202
191,cast-publish.md,"cast-publish.md. ## cast publish ### NAME cast-publish - Publish a raw transaction to the network. ### SYNOPSIS ``cast publish`` [*options*] *tx* ### DESCRIPTION Publish a raw pre-signed transaction to the network. ### OPTIONS #### Publish Options `--async` `--cast-async` &nbsp;&nbsp;&nbsp;&nbsp;Do not wait for a transaction receipt. &nbsp;&nbsp;&nbsp;&nbsp;Environment: `CAST_ASYNC` {{#include ../common/rpc-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Publish a pre-signed transaction:  ```sh  cast publish --rpc-url $RPC $TX  ``` 2. Publish a pre-signed transaction with flashbots.  ```sh  cast publish --flashbots $TX  ``` ### SEE ALSO [cast](./cast.md), [cast call](./cast-call.md), [cast send](./cast-send.md), [cast receipt](./cast-receipt.md) ",201
192,snapshots.md,"snapshots.md. ## snapshot cheatcodes ### Signature ```solidity // Snapshot the current state of the evm. // Returns the id of the snapshot that was created. // To revert a snapshot use `revertTo` function snapshot() external returns(uint256); // Revert the state of the evm to a previous snapshot // Takes the snapshot id to revert to. // This deletes the snapshot and all snapshots taken after the given snapshot id. function revertTo(uint256) external returns(bool); ``` ### Description `snapshot` takes a snapshot of the state of the blockchain and returns the identifier of the created snapshot `revertTo` reverts the state of the blockchain to the given snapshot. This deletes the given snapshot, as well as any snapshots taken after (e.g.: reverting to id 2 will delete snapshots with ids 2, 3, 4, etc.) ### Examples ```solidity struct Storage {  uint slot0;  uint slot1; } contract SnapshotTest is Test {  Storage store;  uint256 timestamp;  function setUp() public {   store.slot0 = 10;   store.slot1 = 20;   vm.deal(address(this), 5 ether);  // balance = 5 ether   timestamp = block.timestamp;  }  function testSnapshot() public {   uint256 snapshot = vm.snapshot();  // saves the state   // let's change the state   store.slot0 = 300;   store.slot1 = 400;   vm.deal(address(this), 500 ether);   vm.warp(12345);       // block.timestamp = 12345   assertEq(store.slot0, 300);   assertEq(store.slot1, 400);   assertEq(address(this).balance, 500 ether);   assertEq(block.timestamp, 12345);   vm.revertTo(snapshot);     // restores the state   assertEq(store.slot0, 10, ""snapshot revert for slot 0 unsuccessful"");   assertEq(store.slot1, 20, ""snapshot revert for slot 1 unsuccessful"");   assertEq(address(this).balance, 5 ether, ""snapshot revert for balance unsuccessful"");   assertEq(block.timestamp, timestamp, ""snapshot revert for timestamp unsuccessful"");  } } ``` ",462
193,cast-completions.md,cast-completions.md. ## cast completions ### NAME cast-completions - Generate shell completions script ### SYNOPSIS ``cast completions`` *shell* ### DESCRIPTION Generates a shell completions script for the given shell. Supported shells are: - bash - elvish - fish - powershell - zsh ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Generate shell completions script for zsh:  ```sh  cast completions zsh > $HOME/.oh-my-zsh/completions/_cast  ``` ### SEE ALSO [cast](./cast.md) ,123
194,mock-call.md,"mock-call.md. ## `mockCall` ### Signature ```solidity function mockCall(address where, bytes calldata data, bytes calldata retdata) external; ``` ```solidity function mockCall(  address where,  uint256 value,  bytes calldata data,  bytes calldata retdata ) external; ``` ### Description Mocks all calls to an address `where` if the call data either strictly or loosely matches `data` and returns `retdata`. When a call is made to `where` the call data is first checked to see if it matches in its entirety with `data`. If not, the call data is checked to see if there is a partial match, with the match starting at the first byte of the call data. If a match is found, then `retdata` is returned from the call. **Using the second signature** we can mock the calls with a specific `msg.value`. `Calldata` match takes precedence over `msg.value` in case of ambiguity. Mocked calls are in effect until [`clearMockedCalls`](./clear-mocked-calls.md) is called. > ℹ️ **Note** > > Calls to mocked addresses may revert if there is no code on the address. > This is because Solidity inserts an `extcodesize` check before some contract calls. > > To circumvent this, use the [`etch`](./etch.md) cheatcode if the mocked address has no code. > ℹ️ **Internal calls** > > This cheatcode does not currently work on internal calls. See issue [#432](https://github.com/foundry-rs/foundry/issues/432).",340
195,env-string.md,"env-string.md. ## `envString` ### Signature ```solidity function envString(string calldata key) external returns (string value); ``` ```solidity function envString(string calldata key, string calldata delimiter) external returns (string[] memory values); ``` ### Description Read an environment variable as `string` or `string[]`. In case the environment variable is not defined, Forge will fail with the following error message: > [FAIL. Reason: Failed to get environment variable `FOO` as type `string`: environment variable not found] ### Tips - You can put your environment variables in a `.env` file. Forge will automatically load them when running `forge test`. - For arrays, you can specify the delimiter used to separate the values with the `delimiter` parameter. - Choose a delimiter that doesn't appear in the string values, so that they can be correctly separated. ### Examples #### Single Value With environment variable `STRING_VALUE=hello, world!`, ```solidity string memory key = ""STRING_VALUE""; string expected = ""hello, world!""; string output = cheats.envString(key); assertEq(output, expected); ``` #### Array With environment variable `STRING_VALUES=hello, world!|0x7109709ECfa91a80626fF3989D68f67F5b1DD12D`; ```solidity string memory key = ""STRING_VALUES""; string memory delimiter = ""|""; string[2] memory expected = [  ""hello, world!"",  ""0x7109709ECfa91a80626fF3989D68f67F5b1DD12D"" ]; string[] memory output = cheats.envString(key, delimiter); for (uint i = 0; i < expected.length; ++i) {  assert(keccak256(abi.encodePacked((output[i]))) == keccak256(abi.encodePacked((expected[i])))); } ``` ",396
196,cast--concat-hex.md,cast--concat-hex.md. ## cast --concat-hex ### NAME cast---concat-hex - Concatenate hex strings. ### SYNOPSIS ``cast --concat-hex`` *data...* ### DESCRIPTION Concatenate hex strings. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Concatenate hex strings:  ```sh  cast --concat-hex 0xa 0xb 0xc  ``` ### SEE ALSO [cast](./cast.md) ,98
197,foundry-support.txt,"foundry-support.txt. Foundry Support hey, sorry for a simple question, coming from dapptools, what should i do different while making a cast call (what env variables?) i've set eth_from and eth_rpc_url, but i'm getting 'error accessing local wallet' do point to some documentation if possible, i wasn't able to find any. thanks! gonna make the error msg better you need to use —private-key / —interactive / --mnemonic-path to provide your key to actually execute the tx, otherwise there’s no way for the program to know your account * while calling forge create oh,idk how ethsign works, but is it not inbuilt with foundry? no it’s not https://github.com/gakonst/foundry/commit/dbbb2482a912e32b4bd7232e3e6f3d215edb456e check this new error message instead of using ethsign as a key management toolchain, you should private the account privkey yourself we could eventually want to plug in a key manager like ethsign, but haven’t considered it so far given that people have private keys all over the place anyway, and in my experience it’s created more friction vs the opposite this is much better yy ethsign is def not a great exp imho Following our discussion on main chat, here is what I got, running forge test --fork-url as always, very interesting to exp folks say this, as a newbie so far it has been good exp, curious as to why you feel this way to see* Only difference from yesterday is that I did my daily forgeup to me it’s just extra software i need to think about and just too much mental overhead something in your setup is failing obviously but what is unknown. Can you increase verbosity? forge test —fork-url … -vvv also checkout the new foundryup it installs new versions in like 3 seconds It might be that actually @warren0x try curl -L https://foundry.paradigm.xyz | bash and then in a new terminal foundryup, then forge t etc.",430
198,foundry-support.txt,"👍 Here is what I got with verbosity Also tried before that to upgrade with foundryup, doesn't seems to be Tests that don't require rpc works well, dapptools with rpc works well too, but forge gives me the above can you describe what u do in the setup? i see one call but it seemed to have succeeded i see a warp and 1 call, do you try to make any other calls? most likely this is something around you making a call to a contract that has no bytecode so it reverts before making the call Are you using a library contract with a public function? Here is the only call I make it’s the getAmountsIn call failing? probably i guess Seems to be yes, tried to log the result, reverted before can u confirm u have the expected eth balance? if you don’t, call vm.deal(addr, newBalance) Yes I have, but the thing is: it works well with dapptools, so tests shouldn't be the issue right if foundry is compatible ? there are slight intricacies that can differ Didn't change the tests either since yesterday, and it worked well too with forge, that's why I though at the beginning it was maybe because I upgraded forge version we have tried to squash them to get exact parity but it’s been a slow process closing the gap entirely hmm Can you share the repo can't but cloned rari-vaults and added the components that reproduce the issue https://github.com/warren-0x/vault-template Also added the cli command i use in package json does foundryup installs cast too? yes so I should also rm -rf the cast bin right? ye Hi, my test keep failing for some reason.",352
199,foundry-support.txt,Is it due to ftm scan ? interface Vm{  function prank(address) external;  function startPrank(address) external;  function stopPrank() external; } contract SpookySwapperTest is DSTest{  SpookySwapper testSwapper;  IERC20 dai;  IERC20 TOMB;  Vm vm = Vm(0x7109709ECfa91a80626fF3989D68f67F5b1DD12D);  function setUp() public {   testSwapper = new SpookySwapper();   dai = IERC20(0x8D11eC38a3EB5E956B052f67Da8Bdc9bef8Abf3E);   TOMB = IERC20(0x6c021Ae822BEa943b2E66552bDe1D2696a53fbB7);  }  function testRouteThroughTokens() public {   console.log(dai.balanceOf(0xa7821C3e9fC1bF961e280510c471031120716c3d)); I mean an error due to the ftm rpc node I double checked the addresses screenshot the call trace and put it here chinmay@chinmay-x1carbon:~/ethonline/phantasm/foundryPhantasm$ forge test --fork-url https://rpc.ftm.tools/ -vvv compiling... success. Running 1 test for SpookySwapperTest.json:SpookySwapperTest [FAIL. Reason: ] testRouteThroughTokens() (gas: 3114) Traces: [589628] SpookySwapperTest::setUp()  ├─ → new SpookySwapper@0xce71…c246  │ └─ ← 2338 bytes of code  └─ ← () [3114] SpookySwapperTest::testRouteThroughTokens()  ├─ [0] 0x8d11…bf3e::balanceOf(0xa7821c3e9fc1bf961e280510c471031120716c3d)  │ └─ ← ()  └─ ← () Failed tests: [FAIL. Reason: ] testRouteThroughTokens() (gas: 3114) this is likely an rpc thing but hard to say for certain.,494
200,foundry-support.txt,"you could try to use the debugger. search the github for an explanation what debugger? https://github.com/gakonst/foundry/pull/356 I ran cargo uninstall foundry-cli to reinstall foundry and now it doesnt want to install here is the error I get when I run : cargo install --git https://github.com/gakonst/foundry --bin forge --locked error: failed to compile `foundry-cli v0.1.0 (https://github.com/gakonst/foundry#f2e46fb9)`, intermediate artifacts can be found at `/tmp/cargo-installUFLHO3` Caused by: could not compile `foundry-cli` can you use foundryup? Try cargo clean if you're installing for source. But the recommended way to install is via foundryup https://github.com/gakonst/foundry#installation @SamuelDare I guess one way to solve this or help debug would be with checksums right? Cc @bjergski Like so that you know if the download was right Vs if it's a build error brb need to be AFK for 40 mins @gakonst haven't made it back to a PC..",254
201,foundry-support.txt,"But I remember I curled the paradigm pre built binary and not the GitHub link so I suspect the issue might be in that pipeline That'd be weird, the Paradigm link is just a redirect to the github Will delete all and try to repro this evening Thanks for the patience, appreciate the feedback @DeGatchi remove the .t.sol just use the contract name Yes ah okay can i specifiy a folder though? like you only want to run a subset of the tests? the mock has the same name but in /mocks yeah like specific tests instead of running all of them ya'll should get a discord for modularising channels we’re keeping it here for now cuz most ppl use telegram and it’s easiest to trakc fair this worked yep gg how does it choose which contract path to go to? What do you mean It takes the test folder Configured by .envs ah okay, ty coolios, ty frens Or toml I haven't really played with that file yet Ye also works Maybe I can add some neat configurations from others to the foundry list is there a way i can call: forge clean forge test together? instead of typing each one individually forge clean && forge test As you'd do in bash ah forgot about that thanks legend i'm looking into the adm64 mac bug, if u guys have been hitting that issue feel free to help me with additional info here: https://github.com/gakonst/foundry/issues/531#issuecomment-1019331597 just replied with the outputs you requested Can you run file forge on the actual forge binary downloaded from GitHub that didn't work? Appreciate it 😄 sure. i've just been running foundryup so that would be the latest nightly for me gonna update the issue with that asap hi sorry i'm not very familiar with the file command, the only output I get from the command when I use it against the binary is /Users/ruvaag/.foundry/bin/forge: data hmm that's strange I’m getting the same output.",416
202,foundry-support.txt,"Anyone know about a tool to flatten a foundry project to a single file? Need it to verify the contract afaik forge flatten landed 2 days ago try updating? 😁 👀 not really sure what's going on, building it exactly as on CI with the same flags as well (RUSTFLAGS='-C link-args=-s') works fine but I do see that the binary yielded from CI lacks some headers. it wasn't always like that though, it used to work just fine any idea when it started happening @gakonst? ok so it builds correctly but the tar archive is broken apparently we're not the only ones https://github.com/actions/virtual-environments/issues/2619 ""It seems to occur with binary outputs of two compiler/linker toolchains based on LLVM: clang and rustc."" 😣 macos (x86_64) builds are fixed now! thanks a lot Oliver! 💯 runs perfectly for me now glad it worked! really obscure bug in github actions with the tar command on macOS runners had me splitting hairs can someone please tell me if this runs fine for them? contract HelloWorldTest is DSTest {  HelloWorld hello;   IERC20 dai;  function setUp() public {  dai = IERC20(0x6B175474E89094C44Da98b954EedeAC495271d0F);  hello = new HelloWorld(""Foundry is fast!"");  }  function test1() public {   assertEq(    hello.greet(),    ""Foundry is fast!""   );  }  function test2() public {   console.log(dai.balanceOf(0xbEbc44782C7dB0a1A60Cb6fe97d0b483032FF1C7)); I am just trying to get the dai balance just went through the PR comments. definitely one of the more obscure issues. amazing work on the quick fix ser! are there any comparissons vs brownie? I'm sure its slower than hardhat but it'd be interesting to see it's hard to compare since tests in brownie are not written in solidity same for hardhat - we would need to make tests that match the original ones as closely as possible and benchmark I’m setting up my first project with foundry.",470
203,foundry-support.txt,"How do I pin my contracts to a specific solidity version while still using a version range in contract? i'm not sure what you mean - you want the pragma to be a version range but the solc compiler that forge uses to be a specific version? Yes update to the latest version if you haven't in a while (foundryup) and add a forge.toml file in the root of your project (if you don't have one) then add these contents: [default] solc_version = 'version you want' more info here: https://github.com/gakonst/foundry/blob/f2e46fb9f56fe18eba52e0aa5def537f57db4dee/config/README.md sorry, foundry.toml not forge.toml Thanks 😄 any time :) Do remappings typically not break other imports? wdym? I imported an openzeppelin contract using the remapping.txt to point it to the lib but now the ds-test import seems broken. That should not be the case, how do your imports look and your remappings as well? i would use the new config and specify all the top level paths that are used as libs even so it shouldnt break using remappings.txt ofc if you overwrite the libs path with only one it will forget the other no they are stacking we load the autogenned remappings too if you use the hardhat flag i think it doesn’t stack fwiw oh hmm that might be true not saying it’s correct but i think it’s how it currently functions import ""ds-test/test.sol""; import ""solmate/tokens/ERC20.sol""; import ""../Contract.sol""; import ""@openzeppelin/contracts/access/Ownable.sol""; @openzeppelin/=lib/openzeppelin-contracts/ are you using the -hh flag? No 🤔 hmmm.",381
204,foundry-support.txt,"i’ve def ran into this try the foundry.toml config wait hmm oh it broke in the config merge if remappings.txt exists then it ignores everything else :/ heh ye we were talking about slowing down the aggressive merging strategy we’ve had thus far its now an or instead of a merge so if env is set, just use that, if remappings.txt set, just use that im a bigger fan of merging because u might want to just remap 1 lib i meant wrt pr merging that breaks stuff oh yea i understand we should probably also start caring more about integration testing making sure we don't release without them passing etc which might be harder cus i think some of the integration tests fail cus of missing features did config pr also break forking? had a bunch of issues related to that today ye and ffi ah cest la vie we have been patching them pretty quick yea i mean it is bleeding edge so Happy to have been of service sirs Reinstalled through foundryup instead of cargo and it seems to get rid of the error No, I'm mistaken. Still broken. Appears that if you make a remappings.txt with only say openzeppelin in it, it'll break the other dependencies. And if you remove it, it sometimes will and sometimes won't break those besides ds-test (such as solmate in my case) what's the best way to check gas usage now? doing something like: uint256 startGas = gasleft(); _; uint256 endGas = gasleft(); uint256 gasUsed = startGas - endGas; Running with forge test -vvvv (always display traces) imo. The number inside the square brackets is the gas usage for that trace yeah interesting, the number calculated with my approach is not the same as the trace usage 🤔.",369
205,foundry-support.txt,"the reason I wanted to calculate the variable there was to add a test to ensure gas usage is low (or doesn't regress) for a given function call, is that possible? (edit — the amount calculated by my code does match the gas costs from -vvvv, there is just some overhead from console.log etc that was added too) Hello, carrying my question from the other channel, is there a way to spin up a test environment with two networks? Like an L1 and and L2? Also is there a way to set up a test environment where you can input shell commands like calling functions similar to other testing frameworks? Maybe ffi is what you're looking for? https://github.com/gakonst/foundry/blob/3eb54777f489335551a5ddcef170a286e875c601/forge/README.md?plain=1#L126-L130 What are you trying to test exactly? Are these both remote networks that you're wanting to fork locally? not exactly, it is something like this brownie console I am trying to test an Ethereum Test net and Arbitrum Cast allows you to send transactions from the command line. https://github.com/gakonst/foundry/tree/master/cast But I don't believe foundry has rpc support yet, so you would need to use something like ganache as your local test network. Ahh gotcha, cast is what I am looking for then for the cli or something like this ill take a look. As for the test net, am I able to boot up a ganache local fork and then hook up my test in foundry to this? How would I do that? As far as I know that's not possible. You could use cast or forge create to deploy a contract and then cast commands to interact with that contract on a ganache node. But forge test is currently tied to using its own adapter to the sputnik evm implementation, and I believe part of what makes it so fast is that the interactions that happen during tests skip rpc altogether. ahh ok I gotcha The above makes this tricky too. I don't know what kind of tooling arbitrum provides for stuff like this, but you can't fork arbitrum on a vanilla test-rpc implementation like ganache. Trying to test interactions between a forked L1 and a forked L2 is a serious devops task.",490
206,foundry-support.txt,"But if anyone knows some good tooling for this, please let me know! Yeah definitely, I am not sure if there is a simple way to do it. So is there a way to run a script to test on the local ganache fork once you deploy to that fork? Or does everything have to be done by commands one by one? So basically I can test with a local fork of a testnet with real data from the network unless forge test is able to do that You could write a bash script full of test commands, but ethers-rs or ethers-js and something like hardhat tasks might be more what you're looking for Yeah I love how tests are written in solidity with foundry and if I can avoid writing JS, I would like to but it seems like that might be inevitable in some cases This you can do via forge test -f {URL}. But it sounds like you want something where you can interact with the forked network independent of the tests Ok this is good to know, I will probably use this for most tests and only if I need to interact with the network move to hardhat. Is there any place with some solid tips and tricks like this? The docs are great for what they have but I feel like this kind of detail would be really awesome unless I missed it in the docs Also just curious, why is this group on telegram and not discord? Just preference, or is there a reason? Someone else might have a good docs link, but the foundry book might be a good place to look after the github. https://onbjerg.github.io/foundry-book/index.html As to why TG, I'm not sure. But I find Discord to be pretty noisy at times. Sweet thank you for the link Ill check it out if you’re writing only contracts and separate out the need for frontend devs, ideally you don’t need js that’s a guiding notion for foundry is reduce any need to know any other language so if you have feedback plz share As for Discord vs TG, yeah discord can get noisy, I have just found it to be easier to use for dev related things but that could just be my personal preference For sure! That is what I love about Foundry (and before, Dapptools). JS is really not my favorite language and I find it cumbersome at times, but most toolchains are written with JS in mind (understandably in cases).",489
207,foundry-support.txt,"Ill let you know if I have any feedback for sure or create an alias that does that in the .profile can you open an issue for this? it fails for me too without any reason;. Running 1 test for HelloWorldTest.json:HelloWorldTest [FAIL. Reason: ] test2() (gas: 2988) Traces: [334] HelloWorldTest::setUp()  └─ ← () [2988] HelloWorldTest::test2()  └─ ← () Hi, all my tests failed without reasons, @ChinmayGopal maybe its because the the address you use for dai in the set up fucntion is an EOA and not a contract : https://ftmscan.com/address/0x6B175474E89094C44Da98b954EedeAC495271d0F Hey, it does give you a reason: your setup failed :) If you run forge test -vvvv you can see the trace for setUp as well, but just generally: something reverted in your setUp function in your test contract I opened a new issue It got fixed Pull again and it works Hey. When using foundry run ./c.sol --sig command, is it possible to pass arguments to the function? I am interested in passing custom bytes calldata to the func Not currently, no Ok, thanks. I guess that could be useful. My setup function deployed two contracts , the test reverted after deploying the second contract, need to figure why it happens now, it was working fine few hours ago . Flagging this resource: https://onbjerg.github.io/foundry-book/ Has great guides and should answer a ton of questions and help you debug a lot of issues +1 ^ that would be great to include in the GitHub repo imo, was tricky to find resources when getting started otherwise yep it’s being actively written so it just reached a state that won’t leave users frustrated that a part is missing. will be linked/upstreamed soon i imagine while calling a source contract function in a test, what's the default msg.sender and how do I set it? You can do a log(msg.sender) to see that log is from ds-tests Run the test with - vvv thanks 🙂 log_address worked.",459
208,foundry-support.txt,"any way I can set the msg.sender to a specific address? vm.prank(address) Also cool to checkout @brockelmore tutorial on the cheatcodes it is out of date now i need to update it but a decent amount is still relevant Oh... Really... Wow thanks. I tried using the hevm_address for chats. wrap() is working for me, but not prank(). To check this, I logged the msg.sender inside the next contract functino call. It's not the same. really confused about this. can you post exactly how you are setting up the prank should be vm.prank(addr) this is my interface: interface CheatCodes {  function prank(address) external;  function warp(uint256 x) external; } then I did CheatCodes constant cheats = CheatCodes(HEVM_ADDRESS); in my test contract note that vm.prank() is for the next call only vm.startPrank() is for all subsequent calls you may need startPrank. prank is only the very next call so if you make any call at all, before the one you want to prank, the prank gets consumed and then cheats.prank(address(bidderWR)); bidderWR is a contract and bidderWR is the expected msg.sender yes trying startPrank, the call that I want to make is the immediate next one.",269
209,foundry-support.txt,"and the actual line in which you make the call has no other calls like contract.func(token.balanceOf(someone)) if you post a code snippet or the trace that would be helpful -vvv to print out the trace in the command line here's the trace: [0] VM::prank(0x42997ac9251e5bb0a61f4ff790e5b991ea07fd9b)  │ └─ ← ()  ├─ [261] DittoMachine::DNOM()  │ └─ ← 65536  ├─ [25584] Currency::approve(0xce71065d4017f316ec606fe4422e11eb2c47c246, 65536)  │ ├─ emit log_address(: 0xb4c79dab8f259c7aee6e5b2aa729821864227e84) in the last line I am logging the msg.sender oh so the DNOM is the issue yes never looked at the trace getting used to it 🙈 startPrank would fix this for you sorry for the trouble! or moving the dnom call np I'm looking to deploy contracts I wrote to a testnet, everything looks good when running forge test/forge build. However, forge create fails with compiling... no files changed, compilation skipped. Error: 0: Invalid data any idea how to debug this? the backtrace doesn't seem very helpful just. running something like forge create --chain=rinkeby --private-key=abc123 --rpc-url=https://ropsten.infura.io/v3/xyz987 MyContractName ah hm. I'm able to deploy a different contract of mine, maybe there's something specific wrong..",362
210,foundry-support.txt,"Has anyone been using the getCode cheat code re: https://github.com/gakonst/foundry/pull/440/files / does it require foundry / dapp style json output, could we use hardhat style as well? For context, I’m trying to use Uniswap’s builds from their unpkg repository at: https://unpkg.com/browse/@uniswap/v2-periphery@1.1.0-beta.0/ Happy to add documentation myself once I understand it a bit better but just wanted to survey the field if anyone’s more in the weeds than I am at the moment @ttarsi all cheatscodes need forge cause the EVM implementation will detect them and do the special action I think other EVMp implementations will just nop and skip them So you need to forge test which internally will build and then test the project @odyslam Appreciate it! I was just referring to the json artifacts (input into the getCode cheatcode) which contain and abi and bytecode.",204
211,foundry-support.txt,.,1
212,foundry-support.txt,"the first mock call i do seems to work since in my contract tick.yieldProviderLiquidityRatio = pool.parameters.YIELD_PROVIDER.getReserveNormalizedIncome( address(pool.parameters.UNDERLYING_TOKEN) ); sets 1 as the tick.yieldProviderLiquidityRatio which i told it to with the mock bytes memory mockGetReserveNormalizedIncome = abi.encodeWithSelector(aaveLendingPool.getReserveNormalizedIncome.selector); bytes memory mockReturnGetReserveNormalizedIncome = abi.encode(1); vm.mockCall(address(aaveLendingPool), mockGetReserveNormalizedIncome, mockReturnGetReserveNormalizedIncome); mockcall *defines* the mockCall. It stores in an internal mapping a call to address A with data X returns Y. thats all it does.",160
213,foundry-support.txt,"so all youre doing is saying address(0) with data X, returns 0 bytes so it will always work because it just is storing into the mapping is this in another test tho? in the trace u provided we never see it call getReserveNormalizedIncome on any contract its the same function testDeposit() public { bytes memory mockGetReserveNormalizedIncome = abi.encodeWithSelector(aaveLendingPool.getReserveNormalizedIncome.selector); bytes memory mockReturnGetReserveNormalizedIncome = abi.encode(1); vm.mockCall(address(aaveLendingPool), mockGetReserveNormalizedIncome, mockReturnGetReserveNormalizedIncome); bytes memory mockApprove = abi.encodeWithSelector(ERC20Upgradeable.approve.selector); bytes memory mockReturnApprove = abi.encode(true); vm.mockCall(address(ERC20Upgradeable), mockApprove, mockReturnApprove); bytes memory mockTransfer = abi.encodeWithSelector(ERC20Upgradeable.transferFrom.selector); bytes memory mockReturnTransfer = abi.encode(true); vm.mockCall(address(ERC20Upgradeable), mockTransfer, mockReturnTransfer); bytes memory mockDeposit = abi.encodeWithSelector(aaveLendingPool.deposit.selector); bytes memory mockReturnDeposit = abi.encode(); vm.mockCall(address(aaveLendingPool), mockDeposit, mockReturnDeposit); // Note: to param needs to be and EOA for mint token to succeed position.deposit(address(1), WAD, WAD.wadDiv(20 * WAD), borrowerHash, address(0)); } add a require(address(aaveLendingPool) != address(0)) and lmk if that fails hm ok, i need to think about this a little 🙂 what does your setUp look like? contract ContractTest is DSTest { Position position; BorrowerPools pools; ILendingPool aaveLendingPool; uint256 constant WAD = 1e18; using WadRayMath for uint256; Hevm vm = Hevm(HEVM_ADDRESS); bytes32 borrowerHash = keccak256(""testBorrower""); IERC20Upgradeable ERC20Upgradeable; // Types struct ReserveConfigurationMap { uint256 data; } struct reserveData { //stores the reserve configuration ReserveConfigurationMap configuration; //the liquidity index. Expressed in ray uint128 liquidityIndex; //variable borrow index. Expressed in ray uint128 variableBorrowIndex; //the current supply rate.",495
214,foundry-support.txt,Expressed in ray uint128 currentLiquidityRate; //the current variable borrow rate. Expressed in ray uint128 currentVariableBorrowRate; //the current stable borrow rate. Expressed in ray uint128 currentStableBorrowRate; uint40 lastUpdateTimestamp; //tokens addresses address aTokenAddress; address stableDebtTokenAddress; address variableDebtTokenAddress; //address of the interest rate strategy address interestRateStrategyAddress; //the id of the reserve.,99
215,foundry-support.txt,"yup no it shud be fine provided he also calls 0 addr like if he never deploys which seems to work for my other mocks. all mocks make calls to a 0 address since its all interfaces of contracts that are not part of my protocol is the mockcall suppose to happen *inside* Position::deposit? yes as long as it is a call and not a jump it should be fine it makes an external function call to boroowerpools.deposit oh which uses a lib i know why its because address(0) has no codew in which this the deposit to aave happens so the tx fails when it does a code length check ohhh yea solidity does that thing where it does extcodesize for no reason add vm.etch(address(aaveLendingPool), hex""0x01"") oke chads explain to me layman 🙂 in your setup so before each call, if u do not do address.call(abi.encode(blablaba)) solidity will insert an extcodesize check to see that u are calling a contract its somewhat wasteful but w/e so it will basically, before doing the call, check that the address u are about to call actually has any code we should add this to stdlib cheats wrapper like we do for hoax if you use etch as brock showed you can put arbitrary code into an address any number of bytes will do to make the check pass its solidity-specific, not rly something we can do much about.",303
216,foundry-support.txt,"Error: 0: Compiler run failed DeclarationError: Identifier not found or not unique. --> /home/r/dev/solidity/foundry/src/test/OwnerUpOnly.t.sol:12:3: | 12 | OwnerUpOnly upOnly; | ^^^^^^^^^^^ idk i just recreated the repo following teh directions and it worked as expected test file should match this: OwnerUpOnly.sol should match this: ok it matched after I fixed myself but tutorial misguides where specifically? cuz i just copy pasted from the guide https://onbjerg.github.io/foundry-book/forge/writing-tests.html on this page there is no reference to import ""../OwnerUpOnly.sol""; thats because in the guide technically its all in one file I tought test runner it's magically imports necesary libs at first i see then my bad but likely should change in guide ah no not really actually after I got the error I checked Contract.t.sol doesn't import Contract.sol so that made me confused yeah in general if you get a “clear” compiler error, assume that this is a solidity issue and there is another thing which confused me . why there are no assertions on testFailIncrementAsNotOwner testfail passes if the call reverts testfail is kind of an antipattern in general and most of the time you should use expectRevert yea it says that somewhere in the book both explains what it is and why not to use it i see thanks feel free to suggest improvements to the book on https://github.com/onbjerg/foundry-book btw :) will do :) Hi everybody. Question, is it possible to just with forge test -vvv and changing the eth-rpc-url on the foundry.toml to point to a local node (forking mainnet) do exactly the same as with forge test -f http://localhost:8545/ -vvv ? ye but i believe in foundry.toml, the correct parameter is eth_rpc_url? True...works, thanks! Oh... Wow...",410
217,foundry-support.txt,"Does that mean I can have a Mainnet fork running on a local instance and run all consequent tests on it Yep, just with a harhat node in my case And the vm cheatcodes work?? yes That's awesome! You don't even need that, just fork from the remote node immediately vs from local Both are now accepted since the latest Config PR Reason I prefer Mainnet already running on local is because its faster to run later tests I mean instead of forking again.. It just runs it on that local instance Saves time Ah @brockelmore we should do the disk caching to get over this Makes sense why ppl do it, skips redundant network reqs on multiple test runs This would be freaking awesome Is there a foundry.toml.example Sorry for disturbing got this error with a mainnet fork(spawned with hardhat) am i missing something? thats a hardhat bug https://github.com/nomiclabs/hardhat/issues/2230 they dont follow spec ooh..got it Check the Readme, yes anyone using Vim? not sure how to integrate the remappings with lsp did verbosite change back to numbers or somehowm my env is using an old version getting some errors regards --vvv its single dash always has been iirc using old tests so that might be the issue thanks Hi. I am writing tests in solidity using Forge and locally forking mainnet of Arbitrum. When I call the precompiled contract ArbAddressTable.size() it takes infinite gas and crashes the test. Same problem on testnet. It works fine to call other contracts that are deployed. I have tried interacting with the ArbAddressTable via web3py and it also works. Is anyone else having problems with this? My code looks like this. hello! pretty new to solidity and loving forge so far. Just wondering if it's possible to test that a contract emits a specific event? looking at ds-test nothing stands out atm check the expectEmit cheat code thanks! this is probably a custom precompiled contract by Arbitrum, I’d expect it has no actual bytecode where you’re calling it that’s why it’s failing i.e. the runtime intercepts that vs there actually being any evm bytecode at that address for fokring mode to work e.g. i am not sure if this work with like hardhat fokring mode either Yes it is specific to Arbitrum and exists on all Arbitrum forks at the same address.",495
218,foundry-support.txt,"But it does store a table... Is there a way to test my contracts that use this table? Does this contract exist in Solidity? Should I implement my own contract with the same interface and provide disk storage there? Or should I mock it (I have never done this in Forge before...)? What do you think is the easiest approach? I’d mock it check mockCall For this specific case the precompile does not exist in bytecode so you cannot actually get it via the forking mode Ok, thanks! Going to try it. Forge seems very powerful. Yessir Is there an example of how it is used? I kind of figured it out. Thanks a lot for the help. what was the solution? just updated to latest with foundryup and now a bunch of the imports in lib are broken--known issue? rip @bjergski ^ what does broken mean? @wilsoncusack prob related https://github.com/gakonst/foundry/pull/549 https://github.com/gakonst/foundry/issues/569 builds should produce different versions for debug vs.",223
219,foundry-support.txt,"release like I have v3-core as a dep and now all the v3-core internal imports don't work for uniswap? they changed their mappings is it open source? is this for uniswap v3? uniswapv3 has had some changes for their dist in node_modules this is recent b/c of their routing sdk Hmm but it only broke after foundryup? Does that also update submodules? It’s just my forge Squeeth repo oh weird - the error is File outside of allowed directories Yeah (Sorry I’m being unhelpful, kids bedtime) Maybe UNI changes broke my remappings share ur lockfile the yarn.lock hasnt changed in 2 months thats not it its not related to remapping pr, nightly for today hasnt been released yet do u know when u updated last approx? also does error persist if u do foundryup -b master? i am fairly certain it is because i just removed the serde(skip) and it solved like 99% of the issue (builds from source) did u install from source @wilsoncusack? with foundryup cus that pr hasnt been released thru binary nightly yet oh weird nightly build broken my pr is waiting Yeah I used foundryup Got it (unrelated to above) so i know we can test for Events and Reverts using expectEmit, and expectRevert. is there something equivalent for require? or is this something that people typically don't test for u'd use expectRevert for that no? ye i dont understand? @brockelmore does the serde skip break on master? oh...i should have tried that first 🤦.",341
220,foundry-support.txt,"@brockelmore did you have to change anything else? oh did u update foundryup curl -L https://foundry.paradigm.xyz | bash try that and then foundryup again ty ser, working yo @mattsse @bjergski.. someone changed forge init to create a libs folder instead of lib... seems to have slipped in in #541 https://github.com/gakonst/foundry/blob/6be75fa06a9ac6084629f533a5779e45f945cf2d/cli/src/cmd/install.rs#L46-L47 if u change that line to ""lib"" does it work as expected? idk im working on library linking rn https://github.com/gakonst/foundry/pull/577 Has anyone encountered that traces (calls, gas, etc.) print only for the setUp function, but not for the rest? dapp works as expected. @brockelmore i’d like to try this debugger you shared https://twitter.com/brockjelmore/status/1480565584479887367 i’ve been trying to run: forge run ./src/test/Contract.t.sol --debug but i get a panick crash what does the error say ""cannot find contract""? The application panicked (crashed). Message: couldn't deploy: 0: deployment reverted, reason: Error(CreateContractLimit) ah thats an oversight on my part, forgot to turn off size limit for contracts - the contract is too big. u can either try it out with a smaller contract or wait for a pr ok thanks, is the test contract too big or the ones im calling ( the ones being tested) the one u r calling sorry this feature looks sick will wait till it works! thanks the way it is shown in the gif can you jsut arrow down each opcode in your terminal? ye there are a bunch of movement options 🤯 prev/next jump destination, prev/next call, start/end, etc think thats the best way to work on optimizing gas in terms of tolling How should I read this WRT to gas? Are those numbers on the left hand side the amount of gas at the start of the call frame? circled in green Hi, quick question.",458
221,foundry-support.txt,"Is it possible to import an existent foundry project to hardhat? look at the pinned comment and read the book - there is a section on traces you want to go from foundry to hh? Yes, I would like to use an existent foundry project on the context of scaffold-eth that uses hardhat for smart contract development. I can just copy the contracts and fix the imports if any. But was wondering if there was compatibility already in place not sure - thats more of a hardhat configuration question. I would ask their community Cool, make sense what exactly does scaffold-eth get you? this is a nice template for mixing hh and foundry https://github.com/wighawag/template-ethereum-contracts#readme Exactly this, and smoth integration with front-end and subgraph development in a single place. Thanks for sharing! Also I like how hardhat-deploy manage the whole deployment aspect of smart contract development. The above is more a hardhat feature than a scaffold-eth feature. Though having a everything already in place is great to jump on a quick prototype with sacffold-eth looking into scaffold-eth, i would caution against mixing frontend and smart contract development like this +++ Using foundry in a scaffold-eth repo is a no no Even a hardhat initialized repo requires some manual changes hi! 👋 i'm a foundry newb, is this the best place to ask questions? or is there a less annoying place for novice questions? yeah this is the spot check the book awesome ty can someone help me? When I run forge test -vv it simply says compiling and then success and nothing gets show on the screen the file is in src/test/Contract.t.sol and the contract is called TestContract do u use a library? im working on library linking rn looks like yes? should have support working for libraries by end of week i imagine the contract I'm testing uses libraries is there any issue? not with ur code. foundry just doesnt support library linking yet.",408
222,foundry-support.txt,"should be live by eow ah, ok, thank you so much please let me know when it's out and what about this? when I input the path it doesn't work, when I input the path:contract-name it doesnt work also verify doesnt currently work, i would recommend using dapp verify I want to work web3 side of my app, do foundry help to keep blockchain open so I can interact from the web not currently - you need a geth local network or hardhat node and use —fork-url then u can use the forge create command we are working on it tho so that you wont have to do this for setting parameters like --rpc-url or the ETH_RPC_URL can we use some config file or do we have to use command line for such stuff to anyone who has setup a large number of tests, how long is it taking foundry to run for you? I'm sitting here with a few hundred tests using brownie and it takes like an hour heh you’ll be hard pressed to find any repo that takes longer than a couple minutes at most to run - except if you tens of thousands of fuzz runs or use ffi solmate for example takes about 12 seconds to run i think 180 tests and a lot of those are fuzz tests wtf that is just wild how does deployment work? bash script? I feel like forge doesn't recompile immediately? I made the changes to the smart contract and retested and the changes doesn't seem to be reflected immediately yeah currently bash script using forge create but there is ongoing work to improve this Yeah caching has a problem which we're working on Use the --force flag.",333
223,foundry-support.txt,"Or Forge clean first How do I use the debugger? ^ forge run —help and see the autoremappings feature is not working correclty can we drop support for hardware wallets No why Libusb issue? We should try to only load it for cast, I suspect separating the binary crates would do it? What's not working correctly? make it optional first: you cant see what your signing anyway on the ledger, there is no security benefit per se without ABI support for the contract interaction second: we can make hermetic releases / binaries with this as an optional support This is a bit of a stretch, you could say that for anything using hw wallets This I can see Ideally the Libusb should only be required in cast send or Forge create When using hw wallet for the remappings, /@openzeppelin/ is sufficient we dont need /@openzeppelin/contracts/ IE lazy loaded Because everyone imports it as openzeppelin/contracts right? flag at build --usb etc etc no @openzeppelinV2/=$(pwd)/node_modules/@openzeppelin/ contracts/*.sol openzeppelin-solidity/=$(pwd)/node_modules/openzeppelin-solidity/ contracts/**/*.sol export @openzeppelinV2/=$(pwd)/node_modules/@openzeppelin/ contracts/*.sol `openzeppelin-solidity = openzeppelin-contracts = @openzeppelin` semanticaly the same this is in re for yearn contracts - also many brownie setups are like this im guessing yes yes :> hey! is it possible to set default keystore_path for wallet? hi there, random one. Is there a good option to import a json into my tests? I want to be able to run a test over a large set of data inputs and couldn't figure out a good way to do it that wasn't just hardcoding it into my test. thanks also I am not able to find option to set gas for SendTx subcommand. Is it possible to set? i have trouble to deploy contract the out/ dir have generated the artifact what's wrong with this ? You can’t do this now IIRC because foundry doesn’t have a signer integrated yet do u have multiple contracts in Snake.sol? if so you need to do src/Snake.sol:ContractName only one contract hmm try forge create -c src/Snake.sol:Snake ...",481
224,foundry-support.txt,"im also assuming the path is correct, you may wanna double check This is parsed as a contract folder 🤔 oh oops u dont need the -c another question, how can i group multiple constructor args ? idk if this error is caused by the constructor args btw i think i found a typo, this should be a dash line i think rn constructor args are kinda borked and you have to do --constructor-args ""snake"" --constructor-args ""SNK"" rabbit hole 😂. Am i missing another command arg? i intend to deploy it on bsc testnet add the --legacy flag wow, it works. Thanks @brockelmore 0: Invalid character 'x' at position 1 plz dont put pvk in chat deleted msg it was ganache okay sorry u can repaste but better safe than sorry actually good thing. respect ! :) r@pop-os:~/dev/solidity/foundry$ forge create src/Ryoma.sol:Ryoma --rpc-url http://127.0.0.1:8545 --private-key 0xa6b82d4eab10c730a13725cada9a485b3ed9cc265447f9e62db0518f03ec48a5 compiling... no files changed, compilation skipped. Error: 0: Invalid character 'x' at position 1 Location: /rustc/db9d1b20bba1968c1ec1fc49616d4742c1725b4b/library/core/src/result.rs:1911 Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets. try just a6b82d4eab10c730a13725cada9a485b3ed9cc265447f9e62db0518f03ec48a5 no 0x prefix we should strip internally but we dont ah I see now the error is Error: 0: Invalid data try --interactive then paste the key r@pop-os:~/dev/solidity/foundry$ forge create src/Ryoma.sol:Ryoma --rpc-url http://127.0.0.1:8545 --interactive compiling... no files changed, compilation skipped.",482
225,foundry-support.txt,Insert private key: Error: 0: Invalid data Location: /rustc/db9d1b20bba1968c1ec1fc49616d4742c1725b4b/library/core/src/result.rs:1911 Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets.,81
226,foundry-support.txt,"forge clean && forge test its still really good, I just need to look up signatures on 4byte, it was just weird to me that things like ERC20 transferFrom were not picked up are you using a mainnet fork? or should all of those functions be available locally? perfect thanks Hey all, is there a way to skip gas estimation on forge create? Yeah you'd want to do this via the FFI cheatcode and a script that abi encodes your inputs to bytes. Then you read the inputs via FFI, abi decode them in your data structure. See here https://github.com/gakonst/lootloose/blob/master/src/test/LootLooseMeta.t.sol#L101 No but should be possible if you PR it, is simple enough Else open an issue And we can track Amazing, thanks. I'll check it out Foundry has these signers integrated actually! Ledger, trezor, mnemonic, private key 🔥🔥🔥 You guys ship too fast Yoo What is path supposed to be? Hmmm got it I guess it’s supposed to be the target contract as well? what is the order in which tests run? Ya Foundry Support Parallel and each test is isolated from each other thx. what order do they get printed to the console? we collect all of them then print alphabetically by test name i believe but that could be wrong now - i would have to check yeah alphabetically seems right thx Trying to install foundry as a dependency on Cargo.toml i.e. [dependencies] evm-adapters = { git = ""https://github.com/gakonst/foundry""} # or evm-adapters = { path = ""../foundry/evm-adapters"", features = [""sputnik"", ""sputnik-helpers""] } I have tried creating a new project, mac vs linux, cargo nightly vs stable, local vs remote git.",396
227,foundry-support.txt,"Everything errors out with:  Compiling borsh v0.9.2 error: cannot find macro `vec` in this scope --> /home/ubuntu/.cargo/registry/src/github.com-1ecc6299db9ec823/borsh-0.9.2/src/de/mod.rs:308:30  | 308 |    let mut result = vec![T::deserialize(buf)?]; Anything else I can try? https://foundry.paradigm.xyz is the version that adds forge config, right? 🤔 yes but if u do which forge and had previously installed forge, it may point to the wrong location and u will continue to use the old version - you have to remove that old version Thanks! That was the issue 🧠 Hey @letalish You pinged me in Foundry, moving over here. I was able to get my foundry fork/patch madness built. Unfortunately I don't have great repro steps for you.",196
228,foundry-support.txt,"I'm running: rustc 1.58.0 (02072b482 2022-01-11) Only changes I made were to the top level cargo.toml -#[patch.""https://github.com/gakonst/ethers-rs""] -#ethers = { path = ""../ethers-rs"" } -#ethers-core = { path = ""../ethers-rs/ethers-core"" } -#ethers-providers = { path = ""../ethers-rs/ethers-providers"" } -#ethers-signers = { path = ""../ethers-rs/ethers-signers"" } -#ethers-etherscan = { path = ""../ethers-rs/ethers-etherscan"" } -#ethers-solc = { path = ""../ethers-rs/ethers-solc"" } +[patch.""https://github.com/gakonst/ethers-rs""] +ethers = { path = ""../ethers-rs"" } +ethers-contract = { path = ""../ethers-rs/ethers-contract"" } +ethers-core = { path = ""../ethers-rs/ethers-core"" } +ethers-providers = { path = ""../ethers-rs/ethers-providers"" } +ethers-signers = { path = ""../ethers-rs/ethers-signers"" } +ethers-etherscan = { path = ""../ethers-rs/ethers-etherscan"" } +ethers-solc = { path = ""../ethers-rs/ethers-solc"" } I didn't change any toml files in ethers-rs.",359
229,foundry-support.txt,"Only made code changes there (printf debugging and such) thanks for coming back to me Josh, how does your foundry line look like? Sorry can you clarify ""foundry line""? it looks like all your dependencies are from ethers-rs, I am trying to install from the foundry repo though it might be the case that the problem lies during the installation of ether-rs given we have the same error What exactly are you trying to do? Just build foundry from head? Or are you trying to build it with some code changes? I am trying to use evm-adapters from foundry in my code, so no modifications i created a new repo with this line: [dependencies] evm-adapters = { git = ""https://github.com/gakonst/foundry""} and getting the same error as you Ok one sec, grabbed a fresh foundry from head and building it now 🙏 building repo using that as dependency Ah ok same error! I'll get back to you in ~15 minutes after I look at this for a sec ok? no hurries, thanks for taking the time I think there may be an actual issue with borsh v0.9.2, my succeeding builds us 0.9.1.",255
230,foundry-support.txt,"It looks like the revm_precompiles package is what imports borsh but it only needs v0.9 Trying to figure out how to specify to use v0.9.1 🙃 ok this will get borsh version right [dependencies] evm-adapters = { git = ""https://github.com/gakonst/foundry""} borsh = { version = ""=0.9.1"" } Now i get ethers-providers/src/transports/http.rs:162:27  | 162 |  InvalidHeader(#[from] http::header::InvalidHeaderValue),  |       ^^^^ use of undeclared crate or module `http` Looks like that's because https://github.com/gakonst/ethers-rs/commit/a97526d6fea02a95d33a5174988a6c966f4d379b#diff-9d1bf55195e9bdfb5252063b81a5579275fb8e689640629e9cfc1c151b68abdc i think I got that one also with this combination: [dependencies] borsh = ""0.9.2"" evm-adapters = { git = ""https://github.com/gakonst/foundry""} Ya it's the change that included some new stuff and the http package isn't getting imported right somewhere in the dependency chain Ok I got this to build by patching in a local ethers-rs [patch.""https://github.com/gakonst/ethers-rs""] ethers = { path = ""../../forks/jbowen93/ethers-rs"" } But I should be able to get this working without that But if you just want to move ahead you can probably git clone ethers-rs locally and add the patch lines ^ to include it. Make sure you have an ethers-rs that just doesn't include this commit https://github.com/gakonst/ethers-rs/commit/a97526d6fea02a95d33a5174988a6c966f4d379b# But that's a hacky workaround you mean reverting that PR because it broke things? Ya my local ethers-rs just hasn't been update in last 8 hours There should be a correct way to do this though...",479
231,foundry-support.txt,"I just haven't used rust for a long time thanks a lot Josh, i think i understand whats happening better now Ya, I'm still poking at this since you should be able to specify the specific git version... ethers = { git = ""https://github.com/gakonst/ethers-rs"", rev = ""5da2eb1eb922c20bf9da88780e5a368cf3641176""} isn't working for me I'll give this another 10 minutes, but just know you can manually patch in a local ethers-rs directory if you need to be unblocked Ok I've gotta go do other stuff. I can't figure out how to force it to use a version before that commit for all sub dependencies and have only gotten a build with the local patch. Strangely cargo doesn't let you patch with a specific git rev if the dependency already comes from git. I keep getting erc20 approval failures when testing, anyone deal with anything similar? Transaction swap approvals to be more specific, between a ""trader"" and the contract. Brock mentioned using the prank cheatcode but I'm not familiar I'm getting this error Anyone has idea? thanks a lot Josh When running `forge install https://github.com/OpenZeppelin/openzeppelin-contracts` it semi-works ; the command doesn't return anything, no .gitmodules created. Also, if I try it with the chainlink repo, it doesn't install it at all. Anyone encountered a similar issue? Any ETA on this? ye i ran into this today i thought it was just my weird repo setup oh it was forge install OpenZeppelin/openzeppelin-contracts Seems to work with Ganache for now but I would really prefer using Forge for everything. Loving it so far. is there any way to stop stop running test when the first assertion fails? what do you mean? stop all tests if one test fails? the answer is no. you can’t and we are unlikely to support that as an option. you should use forge test -m testName -vvv to isolate the test I have a test function which contains 4 asserts. If let's say the first assert fails, I want it to stop further executing that particular test function.",458
232,foundry-support.txt,"it does stop your assertion must not be hitting if execution continues [FAIL] testDuplicateTransfer() (gas: 408760) Logs: Error: a == b not satisfied [uint]  Expected: 262144  Actual: 262016 Error: a == b not satisfied [uint]  Expected: 262400  Actual: 262271 Error: a == b not satisfied [uint]  Expected: 0  Actual: 524415 Error: a == b not satisfied [uint]  Expected: 192  Actual: 262335 Error: a == b not satisfied [uint]  Expected: 262208  Actual: 262080 oh assertEq, not assert oh I see. just change it to a require statement we may look into this as a configuration option but likely most people will just choose whether it’s a revert causing assert or not on a per assertion basis I think it should revert each time, since the default assert also reverts. But maybe it depends on personal perference you’re the first to say this so i think our current default is the correct one imo In that case then I agree 🙂 you could also do this with your own DSTest, and just add a revert statement in all of the asserts yeah, doing something similar. Made the fail() function virtual and then override it to revert. hey ya'll, any idea for this error? I only have this assembly code ah its one of my tests so uh, I know this is really vague and schizo, but did anyone experience flakiness with forked mode? I’m testing out a contract and sometimes the same exact test on the same block will give 2 different revert reasons this doesn’t happen a lot, but still weird sorry moved here Oh can you open an issue? @jskybowen FYI this works now on the latest master: [dependencies] borsh = ""0.9.2"" ethers = { git = ""https://github.com/gakonst/ethers-rs"", features = [""ws"", ""rustls"", ""abigen""]} evm-adapters = { path = ""../foundry/evm-adapters"", features = [""sputnik"", ""sputnik-helpers""] } thanks for your help Thanks for updating me! help your test has it as a library so it doesn’t actually make a call you need to make it an explicit call i.e. have a different contract.",498
233,foundry-support.txt,"we should probably allow for same depth reverts for test contracts but currently don’t thanks!! can u share a screenshot instead so i get coloring of course 🙂 also for deciphering: https://onbjerg.github.io/foundry-book/forge/traces.html :) lol hehe ye so ur call that u expect to revert is reverting but not with any bytes so probably a bad call meaning the inputs are incorrect? the method being called is incorrect? idk - its a bug in your solidity tho. address may be wrong or input data or something like that essentially the call *is* reverting, but with no reason you are expecting it to revert with ""My expected revert string"" I added the expect revert to the advice of guidance in the Foundry chat got it 👌 Are all block.timestamps the same on each chain? Question from other channel: can anyone point me towards how to deal with checking if there's enough gas and reverting the execution if not? In a smart contract in general or you need something specific to forge test? Solidity in general But forge test specifically would also help require(gasleft() > amount_needed) I guess my problem is how do i figure out what is amount_needed Do i need to precompute? Yeah amount_needed is the tricky part. If you can hardcode an amount I would definitely do that so what im trying to do is kinda weird i have a function thatll recurse a bunch of times (think 100+ depth), and i wanna check that it has enough gas to do the next iteration before running it should i precompute the amount_needed for the function body, then put that into a modifier? Is it making an external CALL each time, or is it recursing internally? internally like i'm tryna make an nft out of integer sequences I would say precomputing is the way to go, but I'm obligated to say that this sounds very error prone so itll go something like mint(n) -> calcNext(n) -> calcNext(n-1) -> ...",411
234,foundry-support.txt,"-> calcNext(1) then back to mint() Why do you need to check the gas remaining? wanna revert if gas is exhausted midway this could be the wrong way to go about this entirely tho It will revert if it runs out of gas anyway, no? i'm a bit new to EVM ahh i thought you could DOS contracts by giving them insufficient gas for some reason or is that only for external calls? https://consensys.github.io/smart-contract-best-practices/known_attacks/#insufficient-gas-griefing this is what i'm referring to o-o oops wrong link, fixed ^ ahh it is only for external calls, my bad Ahh that is a thing. But a somewhat obscure vulnerability. If you run out of gas within a call frame, all state changes made within that call will be reverted automatically by the EVM, which it sounds like is the case here. Where insufficient gas becomes a problem is when you are relying on an external call to succeed. The incorrect assumption you have to watch out for is ""If the current function succeeds, any calls made from the function must have also succeeded"" more general question: is this a good place to ask questions like this, or am i a bit off topic? if so, what would be a good channel to hang around? There are a lot of smart contract folks in here, so you might be able to get some good answers for more general questions. You will probably have more success on an Ethereum focused dev server though, like CryptoDevs: https://discord.gg/EPuActEQ oh thanks, appreciate the link @ anyone who was running into borsh issue: https://github.com/bluealloy/revm/issues/41 u can fix by editing the cargo.lock file for anything that uses borsh and change them to match the Cargo.lock in the foundry repo. Thanks! Hey, what's the reason for getting this - ""Jan 29 03:24:15.983 ERROR ethers_solc::compile: Releases request timed out: Elapsed(())"" when I'm running forge build? It still compiles, but throws an error before the ""success."" message. network issue i think if i use foundry is it still possible to use upgradable contracts? upgradable contracts are a solidity construct so yes.",474
235,foundry-support.txt,"you can use open zeppelin upgradable contracts if you want lets not advertise discord links pls noooooooo gotcha thanks also, is there some sort of bindings in rust/python for forge so that i can programatically deploy a contract? Vm constant VM = Vm(HEVM_ADDRESS); VM.store(address(WETH), keccak256(abi.encode(address(this), 15)), bytes32(uint256(100_000 * 1e18))); VM.store doesn't seem to be working for me, am I using it incorrectly? Trying to unit test with WETH, but even assertEq is failing testing if VM.store worked check out the stdlib you’re probably writing to the wrong slot. the std lib has helpers for writing to a public variable oh cool, ty where is the stdlib? In HEVM repo or readme on foundry? https://github.com/brockelmore/forge-std will be upstreamed eventually God bless ya So i use one of the test functions to search for the slot location? Im curious, how is the slot location determined in the first place? no. the read me has example usage. i.e. import, have a StdStorage struct in storage, do “using ..",247
236,foundry-support.txt,"for StdStorage”, then on the struct do stdstore.target(weth).sig(weth.balanceOf.selector).with_key(address(this)).checked_write(new_balance) appreciate it a ton! running with forge -vvv but console.log statements still not showing up...any ideas? -vvv only shows traces and logs for failing tests -vvvv shows traces + logs for all tests https://onbjerg.github.io/foundry-book/forge/tests.html i'm doing -vvvv and it's still not showing up my test is here https://github.com/bryanhpchiang/cryptozombies/blob/master/src/test/ZombieFeeding.t.sol#L40 Ya you can use any language to deploy from the compiled artifact gotcha ok thanks also when i install stuff like forge install rari-capital/solmate it doesn't create remapppings.txt by itself, so i have to do it manually to get the imports working is there some way to avoid having to do that What do you mean? What doesn't work? It shouldn't be necessary to create the txt file (base) bryan@DN51o863 work % mkdir test-foundry (base) bryan@DN51o863 work % cd test-foundry (base) bryan@DN51o863 test-foundry % forge init Initializing /Users/bryan/work/test-foundry... true Installing ds-test in ""lib/ds-test"", (url: https://github.com/dapphub/ds-test, tag: None) Cloning into '/Users/bryan/work/test-foundry/lib/ds-test'... remote: Enumerating objects: 172, done. remote: Counting objects: 100% (76/76), done. remote: Compressing objects: 100% (35/35), done. remote: Total 172 (delta 31), reused 60 (delta 25), pack-reused 96 Receiving objects: 100% (172/172), 44.20 KiB | 545.00 KiB/s, done. Resolving deltas: 100% (69/69), done. [master (root-commit) a89cbe3] forge install: ds-test 2 files changed, 4 insertions(+) create mode 100644 .gitmodules create mode 160000 test-foundry/lib/ds-test Done.",481
237,foundry-support.txt,"(base) bryan@DN51o863 test-foundry % ls lib src (base) bryan@DN51o863 test-foundry % no remappings.txt yeah by design remappings are automatically detected Is it possible to drop into a debugger on error? Similar to brownie’s test interactive flag? not currently How does this flag work for brownie? A brownie console is dropped into on first error and you can explore all variables in scope. Once you exit the debugging console the rest of the tests resume. Hm, I keep getting an indexed out of bounds error when using the stdLib stdstore.target(WETH).sig(IERC20(WETH).balanceOf.selector).with_key(address(this)).checked_write(100_000); what is the difference between —fork-block-number and —block-number ? For example if I have a contract that reads the reserves from a pair, what would be the actual difference? My guess is that —fork-block-number gives you the state at that block, while —block-number just changes the block.number variable in the evm is there a way to get build more verbose? wdym instead of just compiling and success, maybe some info about how many contracts were built? or solidity version uesd? there may be many solidity versions used - but point taken. u can open an issue for it on it done. for using multiple profiles I always need to set the FOUNDRY_PROFILE? is the a way to pass it as a cli variable? forge test -p deep or forge test -p hardhat Wait really? Also is it possible to fork mainnet on different chains? yes just provide an rpc but gas costs and what not may be different on other chains Oh great. Is there any docs i can use to do this? it’s like a normal fork just provide an rpc via a url so whatever docs for fork apply regardless of chain.",385
238,foundry-support.txt,"there may be some differences if the target chain makes fundamental changes to the evm ive never actually forked mainnet and i dont use any settings for forge you got an example by any chance? check the pinned comment and github https://onbjerg.github.io/foundry-book/reference/config.html ah so switch the chain_id in .toml to whatever mainnet ? No just use a different RPC which points to mainnet In general try tinkering around with the choices you have available is it possible to create this type abi instead of the big json out Ya should be possible But not supported rn do this format have a name is there a way to flatten a contract w/ forge? forge flatten u should take some time to explore all the options via forge help ah okay ty then to get more info for a specific command you can do forge <cmd> --help okay ty ser erm, it says flattern isnt there what does forge --version output u have a v old version o rekt whats which forge output does it have .cargo in it or .foundry .cargo do rm ~/.cargo/bin/forge & rm ~/.cargo/bin/cast & foundryup u dont have foundryup? i dont think so go look at the readme and follow install instructions i used frankie's template ah okay lemme check if that has most recent install instructions i forked it and added openzeppelin https://github.com/DeGatchi/forge-template and thats what i use now ah this is assuming u already have forge.",307
239,foundry-support.txt,"just reinstall forge based on the readme Sorry to ask a stupid question, but is there any way to fetch/expect the address your test contract will receive when running a test? Alternately, is there a way to set what address is ""owner"" when calling the setUp function I think it worked nvm i broke it lol try forge —version again for me ah u dont have libusb? do brew install libusb probs not then should work assuming u r on macos if on linux lmk ye on mac forge 0.1.0 should give a date and time yep has anyone found the best way to use forge in a project that supports a range of compiler versions? great now forge flatten should be available forge should just work for the most part unless the compilation pipeline cant find a version that satisfies everything yeah it is 😄 so target path must be where to put the flattened contract? i just want to flatten a single contract forge flatten ./src/collection-creator/CollectionFactory.sol but if there are multiple contracts it wont work got it bit dumb if u wanna open an issue for it that would be nice lmk if u have issues oh, like inheriting ? no inheritance is fine. yea..1 sec if u have multiple contracts in the same file oooh u just didnt give it the correct path yeah thats annoying i modularise so i think i should be fine ty for the help fren running forge build(no flags) in such a project complains of the absence of artifacts ERC1155Facet.json"": No such file or directory (os error 2) do rm -rf out first then lmk if it still fails also make sure u are on latest forge version where should i open issues to for forge? dumb question but how do i ensure this? oop found it i think foundryup now it can't find the contracts in node_modules just remappings Thanks a lot https://github.com/gakonst/foundry/issues/641 ok added this issue lmao so did it get fixed with correct remappings or did i make it worse? plz update version to match the entire output of forge --version no, removing out fixed the compile issue now need to deal with node_module remappings ah okay, will do I think i just flattened a contract that was so big it didnt fit in the terminal just pipe the output. forge flatten ...",481
240,foundry-support.txt,"> outfile.sol oh thats so much better, ty I am trying to compile with hardhat to get pretty ABI files. is there a way to make hardhat use remappings.txt what do you mean by ""pretty ABI files"" btw? and idk u should ask their community here is https://github.com/ItsNickBarry/hardhat-abi-exporter the plug in I use this is called ""pretty"" abi instead of default ABI files oh this looks like a solidity interface? yes I am using clojurescript to develop web3 part. this version is much more ergonomic cast interface ./path/to/Contract.json ah actually that wont work cuz its not pure json how can I cast this with what cast is a toolkit shipped in foundry. interface command generates the solidity interface there are also online tools u can use oo cool I will try just copy and paste the json r@pop-os:~/dev/solidity/foundry$ cast interface ./out/Ryoma.sol/Ryoma.json Error: 0: unable to parse json ABI from file 1: invalid type: map, expected valid abi spec file at line 2 column 2 ^ I think you emant this I'll try to find an online tool then :) https://bia.is/tools/abi2solidity/ 👌 thanks What y’all using for deployment rn? Debating between just using hh or writing a bunch of shell scripts actually depoying with forge is pretty convenient I am saving all commands in a file and execute with vscode https://marketplace.visualstudio.com/items?itemName=ChenJun.vscode-send2terminal this is very handy to send commands to terminal damn i really need to focus on deployment this week Are the artifacts generated by foundry usable for verification on etherscan? dapp verify seems uncooperative i would use forge flatten and go from there. it’s not perfect tho so we cant use it to verify yet. if dapp build + verify doesn’t work that is flatten produces invalid solidity output, fun sorry :( I'll just open an issue dapp should work - are u using multiple solidity versions? no just one, but dapp fails with Details: Missing or invalid contractAddress (should start with 0x) on dapp build? https://github.com/gakonst/foundry/issues/641 looks like it's already reported no, on verify-contracts, i.e.",489
241,foundry-support.txt,"coming back from etherscan it seems you’re inputting the wrong address for the verify? can u paste ur input aight, re-deployed and now it just fails with Fail - Unable to verify r u on a testnet? yeah, goerli you probably have to pass a flag for verification on goerli ya I am, but using the output of forge flatten to verify manually on etherscan also fails, with etherscan presenting me bytecode with the {ipfs} placeholder still in there dunno then. not giving me much info tho ya sorry, https://goerli.etherscan.io/address/0x30179dd2a0a74fa21cd21573ed2b1bbe5ed54a4f#code this is the contract and the cleaned flatten output https://gist.github.com/endophysics/2e3551c67af0a918f75057792c65b730 so it verifies with 0.8.11 even though i've got 0.8.10 in my solc version for foundry, now I'm even more confused wdym as the solc version for foundry? like in my foundry.toml I got solc_version = '0.8.10' you need no-auto-detect you mean auto_detect_solc = false? ye so if I got true there it'll just look at the pragma and take the latest version that satisfies it? basically. it’s not optimal we should really take the provided version as a hint the config in the readme suggests that the version overrides ## Sets the concrete solc version to use, this overrides the `auto_detect_solc value` anyway, appreciate the help! @brockelmore forge flatten isnt a recognized cmd for me (also trying to figure out how to verify) ive run foundryup to get the latest ver realized i messed up and somehow initialized forge in my big parent folder wait. i just realized.",399
242,foundry-support.txt,"i don’t think console.log works in fuzzed functions, even when you do -vvvv lol been trying to add custom configs but seems my foundry.toml in root doesn’t take effect to try it out i’ve added a simple overwrite of the out directory [default] out='outTest' but running tests still output aritfacts to out directory anything i’m missing? or argument to add to the cli to run that default profile? also is --gas-report supposed to work already if i foundried up this morning? This should work on latest This should work. Can you open an issue? It should be released yeah Triggering a release now just in case Should be there in 15m sure here it is https://github.com/gakonst/foundry/issues/642 thanks will check again! same thing happened to me. I did foundryup and then run forge test --gas-report. Did I miss something? Same here. I run foundryup but it’s not updating, I had to install manually to get the gas-report feature Manually? Like... Building the bin? Yes how to do so? it seems like my foundryup not upgrading foundry since my foundry version is still foundry-cli 0.1.0 if foundryup doesn't work then it means you have 2 forge bins installed you can do whereis forge to find out where the bins are located the only one you need is the one located at /home/$USER/.foundry/bin/forge so you can rm any other one you find thanks @Timidan_x it works for me when I use which forge cool there's another foundry on .cargo for me yep rf that done and now foundryup works fine. I can do --gas-report @brockelmore gas snapshots won't work if i am on a mainnet fork right? Yeah that's the most common issue we've seen working now 🙂 whenever I install a new dependency, it doesn't update .gitmodules correctly when I change it to this, it works sigh ye a bit ago we pushed a forge version that used an absolute path for the submodule. that broke a lot of things is latest not outputting this? this is only temporary there are deeper things associated with changing the submodule.",464
243,foundry-support.txt,"you should follow guides online for removing a submodule then reinstall with the latest forge version just updated to make sure I'm on the latest can't I just delete the folders on lib and running forge install again? you also gotta delete stuff in .git there’s also stuff under .git/modules ah ok if u just google manually remove git submodule there is a guide on sof haha, thanks, just found it nice seem to support bigger contracts now! not sure on how it works though when running forge run ./src/test/Position.t.sol --debug it seems its just running the debugger for the init byte code how do i run through debugger of my tests we just turn off the create contract limit to run for a test: forge run ./src/test/Position.t.sol -t PositionTest --sig ""testMyFunc()"" --debug oh cool will try that by the way curious on the choice of j/k for prev and next opcode im on qwerty keyboard vim style bindings - up/down should also work 👍👍 @brockelmore when exactly does it say no source map trying to figure out but sometimes in the test contract i doe abi.encode(1) for instance generally for ""generated sources"" - i.e. the compiler generated code and the resulting opcodes show no source map that doesnt map to explicit code so abi.encode is one such thing because it leverages the abi encoder that is codegenned by the compiler so when compielr runs it generates some helper source code temporarily which it comiles to bytecode thereafter and for those things there is no source map my understanding coorect? ye because there is no actual sourcecode for it ok thanks didnt know hey, when i modify contract source code and then run forge test , it seems that forge test doesn't compile the modified code. i have to explicitly specify the --force flag i think this is not the desired behavior ? Yeah cache issue Should be resolved soon https://github.com/gakonst/ethers-rs/pull/802 nice dude this debugger is so crazily useful its sick tbh i would mostly use it for scripts and debug through my contracts but not for unit tests themselfes with forge is one supposed to use the unit testing set up for such things? not sure if this is clear, what i mean is that for unit tests is really useful to debug as well.",477
244,foundry-support.txt,"but this debugger is also really useful to just call some funcitons of your contract and see whats costing a lot of gas with the debugger and iterating on improvements. for the latter use case, is the best way to do this through the test contacts set up? Hey! I'm trying to do some fuzz testing and getting an issue with safe math ```[FAIL. Reason: SafeMath: multiplication overflow. Counterexample: calldata=0x71e1a2970000000000000000000000000000000000000000000000000100000000000000, args=[72057594037927936]]``` Any ideas? that seems maybe like intended behavior? what are your types? I believe every amount is an uint256 this makes sense then, because the fuzzer will generate very large values that will overflow uint256 when multiplied—you can either use smaller types as the inputs to your fuzz test, or wrap the uint256 inputs to the desired range with something like https://github.com/Rari-Capital/solmate/blob/d22d831c1ba559cfd47f54c3d8095da898aaefdd/src/test/utils/DSTestPlus.sol#L114-L133 Thanks! How should I use part of the Bound method? Would I take the fuzzed uint256 argument in the test and then try to divide it by some reasonable amount to make sure it is less than the max size? I am trying to test swap functionality, is there a way similar to ganache and hardhat before running my tests where I can unlock an account, give it a ""x"" amount of tokens to swap and then run my test on a local fork of a network? Or should I just use hardhat for this? with bound you should always use a uint256 input to avoid modulo bias, but otherwise it depends on eaactly what you want to do, e.g.",388
245,foundry-support.txt,"maybe you should hardcode a known safe bound and use bound(x, 0, myMaxValue), or you could have a while loop in an unchecked block to keep shrinking values until x*y no longer overflows you can use the prank and startPrank cheatcodes to impersonate account, and overwrite storage to give yourself a balance this has good helper methods for overwriting storage: https://github.com/brockelmore/forge-std I don't exactly know what the min/max for my function should be, only that I get some multiplication errors when taking the fuzzed the number in uint256 * 10**18 Other times I get a ```[FAIL. Reason: SafeMath: subtraction overflow. Counterexample: calldata=0x71e1a2970000000000000000000000000000000000000000000000190000000000000000, args=[461168601842738790400]] ``` Would you be able to reccomend how I can determine the max uint256 value I should allow? what exactly is your test doing? just taking the fuzz input and multiplying by 10^18? Its wrapping then unwrapping between OHM, sOHM, and wsOHM. An error occurs in the transfer method if its a subtration overflow and Otherwise a multiplication error occurs in this method ah ok so there’s a lot going on it sounds like? easiest approch might be to just use a uint128 (or some smaller type) to just ensure there’s no overflow ok ill check it out thanks. Will this work with just forge test then? Or do I need to make a local fork with forge test -f url the cheatcodes work without forking, but if you are testing against the actual OHM contracts/owners/addresses you will need to fork Hi - foundry & Rust noob here - I’m updating a mapping(address => bool) to mapping(address => address) and instead of compilation errors I get the error below Tried removing the out folder and the cache folder How do you write a test that is supposed to fail? so that it only passes if it fails, like in dapp tools? sorry got busy - can you tell me the output of forge --version the best pattern is to use the cheatcode expectRevert. check the resource that is pinned you can also use testFail prefix to the test name but thats kind of an anti-pattern Got it, thank you.",498
246,foundry-support.txt,"I usually use discord not telegram so I didnt see the pinned message sounds good ill check that out as well No worries forge 0.1.0 (2f6148f 2022-01-28T18:45:29.997211+00:00) can you upgrade by running foundryup I might have messed up installation or installed multiple times b/c foundryup isn’t updating my forge version do which forge .cargo/bin/forge do rm ~/.cargo/bin/forge & rm ~/.cargo/bin/cast then redo foundryup Nice - now which forge and version .foundry/bin/forge And forge 0.1.0 (8107afe 2022-01-31T10:48:23.593667+00:00) But still same issue Not sure where im getting this overflow but can someone help me? function setAbacusFee(uint _abacusFeeMul1000) external onlyOwner() {  require(_abacusFeeMul1000>=0 && _abacusFeeMul1000<MAX_ABACUS_FEE_MUL_1000, ""!fee<max"");  abacusFeeMul1000=_abacusFeeMul1000;} Here is my test  function testSetAbacusFee() public {   abacusV0.setAbacusFee(25);  } Its telling me [FAIL. Reason: Arithmetic over/underflow] testSetAbacusFee() (gas: 3414) Can anyone spot why? can u do RUST_BACKTRACE=1 forge test I tried to put require(false, ""!"") at the top of the function but it doesnt even hit that hmmm is the repo open source? can u do forge test -vvv No, but let me see if I can rip stuff out if it will reproduce well thats an awesome feature Traces: [993996] AbacusV0Test::setUp()  ├─ → new AbacusV0@0xce71…c246  │ └─ ← 4108 bytes of code  └─ ← () [3408] AbacusV0Test::testSetAbacusFee()  ├─ [2777] AbacusV0::setAbacusFee(25)  │ └─ ← ""Arithmetic over/underflow""  └─ ← ""Arithmetic over/underflow"" Failed tests: [FAIL.",492
247,foundry-support.txt,"Reason: Arithmetic over/underflow] testSetAbacusFee() (gas: 3408) yea so it’s somewhere your setAbacusFee function but wouldnt it hit the require statement at the top? forge test --force i added require(false, ""!"") as the first thing in the function try that ok it might hit the caching bug fairly sure it’s that it hit the same thing, here is the function function setAbacusFee(uint _abacusFeeMul1000) external onlyOwner() {  require(false, ""!"");  require(_abacusFeeMul1000>=0 && _abacusFeeMul1000<MAX_ABACUS_FEE_MUL_1000, ""!fee<max"");  abacusFeeMul1000=_abacusFeeMul1000; } and its not hitting the false require statment it is either hitting a different function (do you have a similarly named thing elsewhere?) or do you do math in OnlyOwner? also your formatting is brutal to read what is actually happening Ok so I manually deleted cache and now it hits the require function cool how do you format in telegram, I barley use it, used to discord i meant u don’t use spaces between your comparisons combined with values at the end of variable names the combination makes it difficult to read ahh ok gotcha, ill change it do I need to delete cache every time or is that not supposed to happen and I should restart my env hmm not sure. i thought we had fixed the clean/force bug @gakonst but apparently not? zuko r u on latest forge version? we are working on a longer term fix now that should fix all (or close to it) of our cache issues i think clean and —force should work, but the gneral caching bug still exists Zuko what does forge --version output? forge 0.1.0 that’s it? no date timestamp or anything? that is the only thing that was output ok so u have a v old version ahh ok whats which forge output /home/{myusername}/.cargo/bin/forge see here ^ rm: cannot remove '/home/{myusername}/.cargo/bin/cast': No such file or directory thats fine now just do foundryup Before asking a Q in the chat, go through the following checklist! This will help avoid repetition, keep the chat clean, and save people's time! 1.",494
248,foundry-support.txt,"Is your problem in any of the * READMEs: https://github.com/gakonst/foundry/blob/master/README.md * Issues: https://github.com/gakonst/foundry/issues * Open PRs: https://github.com/gakonst/foundry/pulls 2. Do you use Foundryup? If not installation instructions here: https://github.com/gakonst/foundry#installation 3. Are you on latest version? What is your forge —version output? If it doesn’t show a date, try rm -rf ~/.cargo/bin/cast && rm -rf ~/.cargo/bin/forge 4. Did you check the Foundry Book for common usage patterns? https://book.getfoundry.sh 5. Tests are not updating? Did you try forge clean && forge test? You might be hitting a caching bug which we’re still resolving. 6. Tests are failing and you dunno why? Did you try forge test -vvvv to get more context via traces? 7. DId you ctrl+f this group chat or the main Foundry room to see if the question was asked before? 8. If there’s a lot of context required -> Open a new issue on the repo 9. If none of the above apply, ask here! Hopefully somebody will answer! ^Added the above for FAQ cool looks like the version now has a timestamp forge 0.1.0 (8107afe 2022-01-31T10:46:25.871921953+00:00) now try forge test --clean sorry --force looks like it works with that! So just run it with force for now? otherwise I have to clear my cache Ok - pretty much I think it boils down to having a ‘require(address(0), “error”)’ recreates it. isnt needed if changing the test but if u change the real contracts its likely needed is that all i need for a reproduction? Yes seems.. strange explicitly with count not defined? i dont think this even compiles? lol or does that not matter? but we should still bubble up teh compiler error Sorry sorry - you can remove the counter.",448
249,foundry-support.txt,"Yeah, it’s a dumb error, but agreed on bubbling the compiler error can reproduce - weird oh ah weird this is the solc output wonder why this doesnt get bubbled up Hmm weird cc @mattsse probably same type of error as stack too deep? no because we bubble those up now just not full info like file is it possible to store an rpc url for passing into -f with foundry.toml? eth-rpc-url config option iirc there was some weird thing with stack too deep without the optimizer enabled Will try to debug with the repro not sure if it’s related, but even with latest version I still don’t see compiler warnings. very rarely do they show up, and I have yet figured out how to reproduce it (i.e. how to get warnings to show up, removing out/ and cache/ does not always do it), but dapp build shows plenty of solc warnings which forge build suppresses found the issue, fixed here https://github.com/gakonst/ethers-rs/pull/849 cc @gakonst Awesome. I appreciate the responsiveness and have been enjoying working w foundry so far! is it possible to install a git module from a particular branch(override master)? Ya add an ""@branch"" With your branch name Forge install Rari-Capital/solmate@develop For example awesome...thanks Is there a way to test private functions or check private variables? I am getting an error saying ""not found or not visible"".",305
250,foundry-support.txt,"have a test contract inherit it ahh perfect, thanks! I was able to change the function to internal and make it work but is there a way to test a private function? Since private wont allow access to anything that isnt the contract? if you want to debug(step by step output), you can just use console.log or emit the results Is there a specific design decision to make something private vs internal? Maybe I can just make it internal Like when its important to use one over the other in terms of use case or efficiency? private functions or variables are not visible to other contracts(even the ones inheriting) most of the time there isn’t a compelling reason to not use internal Right but I mean why would you want to use private vs internal gotcha, is there any use cases that make sense for private for functions specifically? personally...i prefer to make calculations specific to that contract private i do not like private vars but i sometimes use private functions Is there any gas efficiencies like when you change a function from public to external? none that i know of gotcha, would prob be a good addition to the foundry book https://onbjerg.github.io/foundry-book/reference/config.html also, is there a difference between solc-version and solc_version? both from here https://github.com/gakonst/foundry/tree/master/config nope no difference, both underscore and hyphen format are supported, as of https://github.com/gakonst/foundry/pull/562 got it, thanks i set eth-rpc-url in ~/foundry.toml but my tests don’t seem to be picking up on that FOUNDRY_CONFIG isn’t set it needs to be in the repo not in ~ oh that works, thanks a ton! is that from the book? will update its from https://github.com/gakonst/foundry/tree/master/config and the book ah gotcha.",387
251,foundry-support.txt,"ye sorry that’s incorrect no worries thx for the help global will eventually be configured in ~/.foundry/foundry.toml there is an open pr for it if u have time to open an issue that would be helpful or a pr that fixes it in the readme fs will send in a PR tn Im hitting a eth transfer failed, not sure why is it something with my setup with the foundry test or with my code?  function testWithdrawAbacusProfits() public {   // give the test contract eth   cheatCodes.deal(address(this), 9999999999999999999999999);   // print the balance   console.log(address(this).balance);   //transfer eth   SafeTransferLib.safeTransferETH(0x53A2C854F3cEA50bD54913649dBB2980D05980ad, 345342334534);   //print the balance   console.log(address(this).balance);     // ^^^^ this works   //transfer eth, abstracted   abacusV0.withdrawAbacusProfits(0x53A2C854F3cEA50bD54913649dBB2980D05980ad, 345342334534);   // ^^^^ this fails, error is ETH_TRANSFER_FAILED  } this is the function function withdrawAbacusProfits(address _to, uint _amount) external onlyOwner() {  require(_amount>address(this).balance, ""amt>bal"");  SafeTransferLib.safeTransferETH(_to, _amount); } Does anyone know why it fails when the safe transfer is wrapped by the function call? I think I solved my own problem Hi, I was trying to setup a basic test project following the steps in the foundry book. I had setup the basic project with no additional contracts. However, when I am trying to run forge build I am getting the error as seen in the screenshot. What's the Forge version? forge 0.1.0 (8d84701 2022-02-01T00:34:27.479773+00:00) So you just did forge init, cd into that project and Forge build failed? Seems weird. Can you try sharing exact steps to reproduce the issue in github? I just did what you have mentioned. Sure, I would share the steps on github.",484
252,foundry-support.txt,"[0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2,0x514910771AF9Ca656af840dff83E8264EcF986CA] oh amount out min cant be 0 iirc try it as 1 Oh right, I completely forgot about that. I saw that once when going through the uni contracts. Let me try that still failed stack trace still the same? yes its exactly the same and u r providing a fork url? oh no, I am just doing forge test —force -vvv do you need to for for external calls like this? if u rnt deploying uniswap, weth, and link yourself then yes if u want to use mainnet state u need it So if I am just initializing like this in the setup:   _uniV2Router=IUniswapV2Router02(_uniV2Address); ill need to fork? what is the syntax again? forge test -f ${url}? yes otherwise how would the evm know whats at that address? right that makes sense so to fork its just -f url? ye ok thank you, ill give it a shot so the fork gave a much longer stack and now im hitting transfer from failed, im swapping eth for tokens, what do I have to approve for the router to work? erc20.approve(router, amoutn) which one though, since im only sending it eth i recommend you look into how to integrate with uniswap in general no need to approve then got it, I must be hitting it because of something else then, ill dig into it. Thanks for all the help everyone Hey guys I recently switched to foundry and am loving it so far. I was trying to run the expectEmit example from the docs but am getting a TypeError: Member ""Transfer"" not found or not visible after argument-dependent lookup in type(contract ERC20).",403
253,foundry-support.txt,"Is there a way to run this without redeclaring the event? does MyToken.Transfer not work? hmm sadly events arent usable like that iirc yeah maybe not weird solidity quirk u have to redefine or have the test contract inherit the other contract I wonder if defining the event outside of the Contract could make sense rm ~/.cargo/bin/forge & rm ~/.cargo/bin/cast & foundryup ^check here i keep forgetting the pinned comment answers a ton of questions now Pinned comment worked for me 😄thanks @brockelmore Makes sense. Thanks! Ayes Hello everyone, for some reason when forge tries to compile it gives me what apperently is an error in the rustc compiler, it was working fine a few minutes ago but after only updating one of my contracts this happend, any directions? Are you on latest version? Check the bulletpoints 2/3 I added that piece in but now I am getting a blank failure for that test case [FAIL. Reason: ] testSafeMintGas1() (gas: 11404) Traces: [2331020] TestTravelToucans::setUp() ├─ → new TravelToucans@0xce71…c246 │ ├─ emit OwnershipTransferred(previousOwner: 0x0000000000000000000000000000000000000000, newOwner: 0xb4c79dab8f259c7aee6e5b2aa729821864227e84) │ └─ ← 10554 bytes of code └─ ← () [11404] TestTravelToucans::testSafeMintGas1() ├─ [602] TravelToucans::flipPublicSale() │ └─ ← () ├─ [0] VM::prank(0x0000000000000000000000000000000000000002) │ └─ ← () ├─ [0] TravelToucans::publicMint{value: 32000000000000000}(1, false) │ └─ ← () └─ ← () Failed tests: [FAIL.",445
254,foundry-support.txt,"Reason: ] testSafeMintGas1() (gas: 11404) Yes I am Alright I found the mistake It was a solidity mistake rather than something wrong with Forge https://ethereum.stackexchange.com/questions/13021/how-can-you-figure-out-if-a-certain-key-exists-in-a-mapping-struct-defined-insi ye i know what the error is here we have an open pr that will bubble up the compiler error here Basically I was trying to find if key in a mapping exists, when actually they all exist, it would be nice if Forge could display the error that the solc compiler would instead of what I got up there, made me think that was a error in the compiler Is there a way to check how much gas a contract deployment will require? Forge test —gas-report The output seems to be identical to just using ``forge test`` then u have an old version plz use foundryup to update and if u see no change follow the instructions in the pinned message Weird I reinstalled like yesterday but let me run foundryup again follow instruction 3 in the pinned comment then rerun foundryup This isn't the newest version? forge 0.1.0 (8d84701 2022-02-01T00:27:09.328113527+00:00) But let me try that hmm that’s the newest do forge test —force —gas-report Very sorry to ask again Will gas report work on forked Mainnet? yes but only reports for identified contracts Nice that worked Thanks Brock The new gas report looks good as well Oooh... Got it Interestingly, it's showing the deployment costs for one of my lib contracts, do you know how it decides which contract to show metrics for? it does for all contracts that are called excluding test contracts by default you can specify in foundry.toml with gas-reports = [“MyContract”] Perfect, that fixed that issue as well, you're a lifesaver man I figured this out. I need to deal that address some ETH. Maybe we could bubble that reason up in the failure.",429
255,foundry-support.txt,"is there a way to deploy a contract to a mainnet fork and then run a script against it? Yes, just run forge test -f ${url} feel free to correct me though anyone who made the package lol right, that runs tests, but can I run other stuff against it? Im asking bc I want to test a contract where inputs come from offchain calculation and want to make sure the state is the same https://twitter.com/fakenickels/status/1486156974651809798?s=20&t=AzBN_mor_4KVfuz6kl7-Yw bug found I am not sure if im hitting an issue with foundry or with my code, I am approving the uniswap router before I call my contract function but I am hitting TRANSFER_FROM_FAILED. I made a stack overflow post so I didnt clog the channel with code: https://stackoverflow.com/questions/70946734/foundry-test-is-throwing-transfer-from-failed-during-a-swap-with-univ2router-bu. Can someone help me figure out what is wrong with my Foundry test? Is there an equivalent to dapp tools seth send --value 1 <TO> in cast? cast send --value 1 <TO> doesn't work, needs a <SIG> Ugh we should support this Should be easy PR If you can point me to a rough location I can give it a shot, already got stuff forked locally Oh cast is one file Ya And then just expose over CLI @brockelmore Love the stdlib. Had a qq, isn't this just abi.encodePacked? Hi there, any suggestions on testing MerkleTree.verify() in solidity? Can't figure out how to properly construct the bytes32[] proof, either errors or gives wrong result.",370
256,foundry-support.txt,"Smart contract programmer on YouTube has a pretty good video on it Thanks, I think he's testing in Remix though I want to be able to test in Solidity eth_rpc_url not working forge 0.1.0 (8d84701 2022-02-01T00:34:27.479773+00:00) i moved my config to ~/.foundry/foundry.toml https://github.com/gakonst/foundry/commit/3ecde08ac9bad4bb6e0256e2c1e7cc5c6f79d04f does foundryup update all the way to latest on master? nightly hasn’t been released yet only releases once per day at midnight utc mb thx so u have 20 mins until it gets released + build time gotcha awesome What’s the best way to check the gas usage of functions and or state variables? I see people come up with like charts for each function not sure what the command is —gas-usage —gas-report* Bet thx imma try it what context would this work in? forge run? forge test if it doesnt work, you have an old version of forge. check the pinned comment and follow steps 2+ to make sure u r updated more than likely I have an old version I will try im on 0.1.0. I just delete the bin files and redownload right? yes just follow the pinned comment exactly Hey all, it seems like forge test not catch all console.log in fuzz test. Any idea? ye fuzz tests are eating logs right now annoyingly i just noticed tonight could u open an issue? sure I can help with fixing it. Can you point to where the issue could be? hey frens, not sure why im getting this error cuz you’re not importing it? doesnt importing do the same though? put it above the contract just tried w/ importing and still same result oh you can't just put the interface at the top of the test... Does anyone know why I would get a fallback when unwrapping weth? My function is hitting an error when trying to unwrap Debug I am and see that the balance is 61 in the test case, I try to unwrap 61 and hitt this error.",465
257,foundry-support.txt,"Here is the stack trace 534] 0xc02a6cc2::balanceOf(0xce71065d4017f316ec606fe4422e11eb2c47c246)  │ │ └─ ← 61  │ ├─ [6186] 0xc02a…6cc2::withdraw(61)  │ │ ├─ [45] AbacusV0::fallback{value: 61}() Isn't 61 in wei? Yes im just trying to unwrap the current balance unwrapping weth sends eth to the msg.sender, which triggers a contracts fallback method fallback isnt an error Ahh gotcha, so I just need a fallback function in my contract to handle the call? this is a fundamental ethereum concept - there are tutorials and explanations out there you can find Right, I have worked with callbacks before with flashloans but didnt know weth had a fallback, thanks *weth* doesnt have a fallback, you AbacusV0 contract does well weth does but its for wrapping eth any contract that accepts eth has a fallback Got it, I am reading up on it now, thanks for the guidance ye np is there a standard design pattern for when you just want the contract to do nothing? Or is that bad practice? Is there something you should always check when receiving eth? what do you mean ""do nothing""? check this out https://ethereum.stackexchange.com/questions/81994/what-is-the-receive-keyword-in-solidity awesome, this is what I was looking for thank you, ill spend sometime with contract fallback functions thanks again How do I specify the foundry profile? How can I quickly change it? Is it only via the environmental variable FOUNDRY_PROFILE which requires FOUNDRY_CONFIG to point at the .toml file? But what if I have several foundry repos? hi i have some issues with foundry.toml. it seems not working i specify the fuzz runs and msgsender. seems it does not work Aight I think I'm going a little crazy, at little bit.",427
258,foundry-support.txt,"My current setup, contracts/src/test/A.t.sol node_modules/@abcd/contracts1 node_modules/@abcd/contracts2 Config output λ forge config --hardhat [default] src = 'contracts' test = 'test' out = 'out' libs = ['node_modules'] remappings = [  '@abcd/=node_modules/@abcd/',  'ds-test/=lib/ds-test/src/', ] libraries = [] ...  λ forge build --hardhat compiling... Error: 0: Compiler run failed  /Users/me/projects/ethdev/forge/contracts/src/test/A.t.sol:6:1: ParserError: Source ""/Users/me/projects/ethdev/forge/node_modules/@abcd/contracts1/src/B.sol"" not found: File outside of allowed directories.  import ""@abcd/contracts1/src/B.sol"";  ^----------------------------------^ Am I crazy? Should symlinks be respected by ethers-solc/solc (assume node_modules/@abcd/contracts1 is symlinked in)? On absolute latest master forge 0.1.0 (7575f10 2022-02-02T06:03:14.227021+00:00) aabfb0ed15a9213f2eb26c9eb6635fdb6aee0a3c I dig into it a bit. Found out that log getting from evm.call_raw in fuzz function not the same as evm.call_raw in run_fuzz_test function after it found that there is a failed case. hi my test failed but i couldnt find any error or revert in the call trace. wonder what would cause this. I guess it's normal behaviour? If fuzzed func spits out console logs, there would be 256 console logs for each console log. Could just show the last run's output though. Is there a way to get a random uint256 via cheatcodes? I guess can use ffi to get from OS but it's bad practice I guess.",406
259,foundry-support.txt,"no this kind of issue found when i rerun the tests with dapptools it would be very helpful if it the trace log can include contract line number like dapptools trying to work on https://github.com/gakonst/foundry/issues/592 can someone give me a rough idea of where to look? i could follow it till https://github.com/gakonst/foundry/blob/be2cfadc04c0cf8b352e1d9bb920b0ceecd22b11/evm-adapters/src/sputnik/cheatcodes/cheatcode_handler.rs#L840 at which point it transfers the control to handler in Sputnik? Console log only split when fuzz found failed case so it not split 256 cases but only a single failed case there should be logs shown if the fuzz test failed but not if it passed I feel like im going crazy and this feels like a stupid question, but I keep getting this error but the allowance is max uint [FAIL. Reason: ERC20: transfer amount exceeds allowance] . I brought it into a test to check out what is going on and I logged all the values but cant figure out what is going on. Here is the snippet from the test:  console.log(ERC20(swapTokenFeeOnTransfer).allowance(address(this), address(abacusV0)));   console.log(ERC20(swapTokenFeeOnTransfer).balanceOf(address(this)));   console.log(amountIn);   ERC20(swapTokenFeeOnTransfer).transferFrom(address(this), address(abacusV0), amountIn); and the ouputs from console.log are these: 115792089237316195423570985008687907853269984665640564039457584007913129639935 9692851369290771289329 9692851369290771289329 Do you have a repo you could share? Most tokens won’t even check the allowance if the from address is msg.sender, so that does seem strange I originally tried to transferFrom in my contract that I was testing, but it didnt work and was giving subtraction overflows, so I brought it into the test to see whats happening. I dont have a public repo for this one, im working on a small team that is keeping it private for now. I can’t think of what might be causing it off the top of my head, other than mixing up addresses somewhere.",497
260,foundry-support.txt,"Could be a good chance to take the debugger for a spin though ah got it. How do you guys generate function selectors? I have the ABI. cast sig transfer(address,uint256) bash: syntax error near unexpected token `(' Are you sure there is such a command? error: Found argument 'sig' which wasn't expected, or isn't valid in this context you’re on old version, check pin cast sig ""transfer()"" 0x8a4068dd Noob question are u supposed to use contract{} like describe{} when writing tests in solidity? Or if anyone can point me to best practices for .sol tests contract -> describe, setUp -> beforeEach yep is libusb optional yet sers? hi guys, just wondering, is there a way to extract solidity standard json input from forge? I do have the latest stable version forge 0.1.0 (6fc0c97 2022-01-23T11:38:44.545769893+00:00) According to latest documentation there is no sig command However, there are newer nightly builds. How do I install them? I can't really understand what version number I am supposed to provide. I have tried running foundryup -v nightly-fe2dbfed620222f806f23f16511c85173480f8d3 but it didn't work Just foundryup Also check ""which cast"" Wdym? It's not yet Just ""foundryup"" installs cast 0.1.0 (6fc0c97 2022-01-23T11:38:44.545769893+00:00) I think I found what the problem is. Previously foundry was installed in ~/.carge/bin/cast but now it is installed in ~/.foundry/bin/cast. The new installation did not get added to the path... Yeah it's in the support pinned msg Check bullet 3 https://docs.soliditylang.org/en/develop/using-the-compiler.html#compiler-input-and-output-json-description I was just getting my repo to pass tests two days ago, but now when I re-cloned it fresh and run forge test, I get the following errors. I reorganized my repositories locally Now I get the following ``` compiling...",466
261,foundry-support.txt,"Error: 0: ""/wsROME/lib/ds-test/src/test.sol"": No such file or directory (os error 2) Location: /rustc/db9d1b20bba1968c1ec1fc49616d4742c1725b4b/library/core/src/result.rs:1911 ``` Any ideas what could have happened? Separately, how do you log in foundry? use the events in DTest like emit log_named_uint(""my string"", variable) thank you for your response thanks! when I run forge build my contracts build fine, but when I run forge flatten ./src/MyContract.sol I get the error: Error: 0: failed to flatten the file: failed to resolve library import """"lib/ERC721A/contracts/ERC721A.sol"""" anyone have any ideas? Should it be looking for tests in test.sol even if there is no test.sol in my directory? It looks like my code is failing to call the prank method in vm.prank for some reason every time I try to install solmate from a cloned repo, this error is thrown I guess it's because Solmate's repo uses a main branch as default instead of master I'm getting this error when I run dapp build any ideas? ```ParserError: Source ""ds-test/test.sol"" not found: File not found. --> src/test/Wsrome.t.sol:4:1:``` try run dapp update it will download the submodule again dapp doesn’t use forge remapping so it doesn’t know where to look for ds test would be my guess flatten only supports single contract files rn :( if u used an old version of forge there was one version that screwed up the install and did it via absolute paths instead of relative. check your .gitmodules if it has absolute paths u have to manually go in and remove it then reinstall. stackoverflow has some guides for doing this do you have lib/ds-test/src/test.sol? or is lib/ds-test empty? otherwise same suggestion: check you .gitmodules for any absolute paths. manually remove any absolute paths and do forge install make sure you have the lastest forge version via foundryup working on a new nft project in forge, and was getting strange stack too deep errors. I decided to sanity check and setup an old project in forge (since I know it works fine with HH) and am seeing the same error.",493
262,foundry-support.txt,"Pushed code here https://github.com/wilsoncusack/gtap-forge seems like compiler does not like abi.encodePacked with many strings, so the on chain svg stuff is giving this error HH version here, incase useful https://github.com/Generative-Transfer-Art/solidity hey everyone, (basic doubt) im working on the seth feature parity issue, trying to implement --from-bin in cast, don't know how to get it to work in seth, (giving binary data in stdin) any idea how? so that i can replicate the behaviour in cast. Thanks! cat foo | Seth --from-bin Where foo is a binary file https://unix.stackexchange.com/a/118251 works, thanks! We also want it to work with a cli positionlarg i tried seth --from-bin $(cat data.bin), why is this wrong? im kinda new to bash Same way that it's done in the WIP open PR I think they just don't support it without stdin But we want it got it, if @odyslam isn't working on it ill give it a shot Heya, I deployed a OZ based proxied contract to a Hardhat node and then connected to it using the RPC url option. No errors up to this point but for some reason when the contract tries to access owner() from OwnableUpgradeable within the test it returns address(0). Tried the same with Hardhat tests but it worked fine.",301
263,foundry-support.txt,"Any ideas? I appreciate the suggestion! just tried and got this error ``` dapp-remappings: error: ./lib/ds-test is not a Git repository dapp-remappings: error: try ""dapp update"" to initialize submodules + git submodule update --init --recursive fatal: No url found for submodule path 'lib/ds-test' in .gitmodules ``` do you have any suggestion @unwoono? it is empty, do you have any suggestion @brockelmore? I don't think I have a .gitmodules either 😅 Susheendhar yy on it, completely forgot about it Cool 😅 I'm implementing cast index, any idea why the hashes don't match here? am i missing some nuance of how keccak works in cast? Is the abi encode result the same? yes seth keccak $(seth abi-encode ""x(address,uint256)"" 0xD0074F4E6490ae3f888d1d4f7E3E43326bD3f0f5 2) if you want to check locally 👆 I'm getting some unexpected behaviour with expectEmit. Looks like it doesn't work for proxies. I created a minimal example in this repo. All 4 tests here should fail but the ones which query a proxy somehow pass https://github.com/shuklaayush/forge-expect-emit/blob/main/src/test/Contract.t.sol can you please use the resources & comments pinned in this channel to find the book and setup the directory for forge? the book is a *very* good guide hmm ill take a look looks like it does emit a log any that u call update pass so 1c1 fails and 2c1 fails because u call u() not update like u do in the others Shouldn't the other two fail as well? no because they emit the expected event run forge test -vvvv and examine the trace oh actually sorry u r right i think this should fail Yeah, the vals are different ye can u open an issue thanks for finding this Sure, will do it right away haven’t looked further, but seems the difference is related to how the 0x prefix is handled.",454
264,foundry-support.txt,"See here where they give the same result if you strip the prefix huh ethers.js confirms that seth’s handling is correct I’ve also used seth index to find slots many times, so definitely the cast implementation that needs to be fixed from https://github.com/dapphub/dapptools/blob/1be7d796a468f52a5eb5b6830591d76a3b4b1c49/src/seth/libexec/seth/seth-keccak#L7-L10 /// If <data> has a 0x prefix, read it as hexdata. Multiple hexstrings /// can be concatenated with `:`. /// /// If <data> has no 0x prefix, read it as text.",152
265,foundry-support.txt,"great catch we should fix that in cast we just do let hash: String = keccak256(data.as_bytes()).to_hex(); so need to adjust that conditionally using the above, cc Susheendhar Hey guys, does cast not support function signatures with tuples? I keep getting illegal abi errors and trying it in seth it specifically complained about the double parentheses I guess I can just create the calldata manually but I was hoping there was a better way can u show ur cmd here cast send $CONTRACT ""funcName((bytes1,bytes32,uint64,bytes32,bytes32,bytes32,uint128,uint128,uint128,bytes32,bytes32,address))"" [""0xff"",""0x9bfb7b21c884b2bbafc999275b3c66eb08af3fb95dd615eea0cd7554ce7709ce"",438470,""0xad746b334b83634c0b24c85238bdc982c90576db984a8f6411e7ef05aa776b6d"",""0xc36524f2ee84cad7751099e7736f5513f18cb2be98467ac5813ed7905d1057a6"",""0x452e082848c615c8e5f69f1b3c06209a7c2115f8560ed056ebb233c4ab492bba"",9987237428,1003,22369621,""0x7d97fbf0afe5facfb25f803527bf0e8cefe26dd3146fe3889a43d1fd4a347f88"",""0x92707d70a55d32778eced56feb672a3e25a8dc5d5278adb542e61edd2f2d3f44"",""0x4fDD02c537AA4cAB34b4a89740Ef516938e5dfEd""] I've tried it without the brackets, wrapping addresses/bytes in quotes, w/o wrapping, etc.",436
266,foundry-support.txt,"This was just the last one I've tried have to dig into ethers-rs crate It looks like that might be handled here: https://github.com/gakonst/ethers-rs/blob/77dcccb7bae83a896a319e116bd34a6844b896ba/ethers-core/src/abi/human_readable.rs It seems like line 261 specifically would be causing the issue since is splits the abi with regards to '(' in order to seperate input args and output args but that would break if there are any tuples in the abi u can log an issue Yeah I'll go ahead and do that Will make the changes, awesome stuff @msolomon4 , thanks great example of how a great issue should look like by @msolomon4 https://github.com/gakonst/foundry/issues/669 Question: if I have two identical contracts. Then on one contract I move some of the functionality to a library in the same .sol file. Do I need to do anything different in Foundry to test the second contract? I have this situation and the contract with the library is compiling but not running the tests. fix #669 forge test compiling... Error:  0: ""/Users/rahul/connext/repos/nxtp/packages/contracts/artifacts/Ownable.sol/Ownable.json"": No such file or directory (os error 2) im trying to use Forge in a hardhat project the actual path is packages/contracts/artifacts/@openzeppelin/contracts/access/Ownable.sol/Ownable.json https://onbjerg.github.io/foundry-book/forge/dependencies.html#hardhat-compatibility i found this but which command do i use it for Nevermind just answered my own question. It's something else in my code still troubleshooting... Anyone seeing 0: missing field file at line 1 column 1724 or similar? i was able to fix my issue by cleaning forge and using forge test --hh Yep that's the way amazing, excited to use this Having some trouble with submodules atm: forge install is outputting Installed ... but nothing is downloaded. Have tried deleting lib and doing forge clean.",442
267,foundry-support.txt,"try forge install fatal: No url found for submodule path 'lib/ds-test' in .gitmodules But as far as I can tell the path is there in .gitmodules Anybody have good examples of how one might call an external API within their foundry tests? For simplicity sake, let's say I wanted to call the OpenSea api, then do something with that resulting api call within some of my tests. I've got a feeling I would use ffi for this, but unsure how it might look here’s an example of ffi https://github.com/gakonst/lootloose/blob/master/src/test/LootLooseMeta.t.sol#L97-L105 is it set to this? [submodule ""lib/ds-test""] path = lib/ds-test url = https://github.com/dapphub/ds-test @gakonst wow, this rocks.",181
268,foundry-support.txt,"thank you sir! Yes, except it looks like my paths are the full local path are you on latest forge? I think so -- ran foundryup a few minutes ago the repo was probably created on an older version just recreated the folder with a fresh forge init and installs work -- but now seeing this error again: 0: missing field file at line 1 column 168 w/ full backtrace: Error:  0: missing field file at line 1 column 1689 Location: cli/src/cmd/mod.rs:89 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ BACKTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━         ⋮ 4 frames hidden ⋮         5: <core::result::Result<T,F> as core::ops::try_trait::FromResidual<core::result::Result<core::convert::Infallible,E>>>::from_residual::he88698a2df8f881a  at <unknown source file>:<unknown line> 6: forge::cmd::compile::hced1dc1a8a687a6b  at <unknown source file>:<unknown line> 7: forge::main::h787c9f3ff57574ea  at <unknown source file>:<unknown line> 8: std::sys_common::backtrace::__rust_begin_short_backtrace::h729c07892ce08e1b  at <unknown source file>:<unknown line> 9: _main<unknown>  at <unknown source file>:<unknown line> Run with COLORBT_SHOW_HIDDEN=1 environment variable to disable frame filtering. anyone have ideas here? I'm at a loss no idea, i'm running into the fs error No such file or directory (os error 2) as well atm while running forge verify-contract verification isnt working yet i tried on fresh repo and it works for me yeah, I think there's something wrong w/ my project specifically -- maybe remappings or in the submodules themselves Is there a way to deploy with foundry? I didnt see one in the docs I may have missed it though just via the CLI my solidity project hits code freeze in a couple days then ill be focusing on deployment mechanism that has been discussed at length so that i'll have it for deployment myself.",494
269,foundry-support.txt,"imagine deployment feature should ship between feb 7th and 15th Sounds good, looking forward to the deployment feature, when you say just via the CLI is there a way to do it now? Like with cast commands or something? ye Yo Is there a way to fork from main net? Sorry if this has been asked before I just couldn’t find anything on the readme plz checkout the book Ok must’ve missed it see pinned comment a lil help.. sorry if noob question.. wondering why i cant run tests with this code: test file it runs fine when not using the library output basic sanity test never ran Foundry Support plz check pinned comment and follow the linked steps u probably have the wrong which forge using an old version $ forge --version foundry-cli 0.1.0 ye thats old. again, plz follow the linked steps ok appreciated.. tried installing foundry up $ foundryup foundryup: unsupported platform: MINGW64_NT-10.0-19044 r u on windows NT lmao no WSL? yea wsl i used bash to install instead of cmd does it matter? sorry i dont use windows so im not entirely sure. you probably need to install from github. has foundryup worked before? havent used foundryup before, new to foundry go here and manually install what u think is the right version https://github.com/gakonst/foundry/releases ok will do thanks probably foundry_nightly_linux_amd64 since its WSL ok will try that one i just removed and reinstalled from source. tests now successfully running.. thanks a ton! How accurate is the gas estimation when testing? I checked a tx on etherscan that used swapExactETHForTokens with the Univ2 router and it used 138,841 gas. My test used the same function on a mainnet fork and used 96,562 gas. Is there a difference or is there something I should be aware of? do the amounts swapped matter im guessing tests dont report base cost and call data costs sort of but not the base of the cost.",432
270,foundry-support.txt,"most will be the 21k base gas cost for all txs and calldata why does an empty test have a cost of 120 gas? there could be slight differences between when u ran the test and executed on chain as well as the addresses you used on chain vs in the test because its still a contract that has to get to that empty function ahh ok, so what would you recommend that someone should do to get accurate gas tests? Hardhat or test net or something? ah so that’s just the function dispatch? ye pricier than I’d expect, still 98 gas if I get rid of setup and other tests use gas-report functionality and just add 21k + calldata cost if u want cost for user. its structured so that smart contract developers see the number that they can affect so we remove things they cant affect as best as possible u can step thru teh debugger and watch the gas usage Is there a special way to test gas or just do forge test -vvvv? How do I know how much the call data will cost? ah yea not saying its wrong, just that it’s more than I thought it’d be to find a function on a contract with just one funciton 😅 some helpful resources: https://ethereum.github.io/yellowpaper/paper.pdf evm.codes forge test —gas-report 4 gas per 0x00 byte, 16 gas !0x00 byte (i.e. 0x01, 0x02, ..",304
271,foundry-support.txt,"etc) how do we pass constructor args while using 'forge run' —constructor-args doesnt seem to work in this context How can I find out more about why my tests are failing? All I have is there's a known issue u can check if that match ur situation do you know which one? i'm too much of a noob to know which of the 80 issues sounds like my situation 😅 All I know is that I was able to get tests passing before hand with the same code repo, and now I am not able to and am stuck with this trace? https://github.com/gakonst/foundry/issues/499 i don't think so, i hadn't had any errors running this code before and the gas usage seems low so I doubt that is the issue, right? do u use mainnet fork? no I don't have any configurations for a mainnet fork, or rpc set up however if I try to run forge test with a --rpc-url flag specified that points to mainnet, i get this error This is happening on CI too I wonder if Infura is down they're reporting issues https://status.infura.io/ Without the rpc flag, i get this error though, so i doubt a good rpc url would help, right? do you need mainnet state? Don’t think so i just prank to mint an asset and u deploy the asset yourself? it doesn’t look like it Ahh no i do not. Good point ye so u need mainnet state. and therefore need to provide a —fork-url Infura is down Got it! And do i need to use the —rpc-url flag too? Thanks for letting me know. I’ll try with an alchemy url, i thought i got the same error with alchemy, but I’ll double check I can't seem to format my bytes32 array and pass it without getting an error. I can pass the argument using Remix and it works properly. Any ideas? most likely different compiler versions try hardcoding the solidity pragma to match remix its parsing the ""0x..."" as a string instead of bytes32 so alternatively you could do bytes32(hex""63616e..."") TY will give that shot Thank you, this was the flag I've forgotten the past few days that was throwing me off, my tests pass as they used to now.",476
272,foundry-support.txt,"I appreciate the help @brockelmore 🙏 I've changed compiler versions to 0.8.6 and locked the pragma but I'm getting the same error as before. When I explictily define my value as bytes32 and pass it I get a new error this is purely an issue with your solidity. you need to define the type correctly by doing bytes32[] memory values = [bytes32(hex"".."")]; or something like it. you should do more research into how solidity handles dynamic length arrays vs set length arrays Appreciate the feedback - will do some searching. Thank you! should the lib be in the gitignore? every time I clone my repo that has an no lib, forge build and forge test cannot run Is there any reason that forge install ds-test wouldn't update the lib folder? https://onbjerg.github.io/foundry-book/forge/dependencies.html Trying to figure out how to easily clone my foundry repos so I run locally. i end up having to just copy over a lib repo from a newly initialized forge init directory in order to run any forge commands you have to specify the author forge install author/repo wait u mean cloning from github? yes if u have previously committed dependencies and have a clone from github, you can run forge install ideally you run git clone --recurse https:/github.com/...",274
273,foundry-support.txt,"when cloning it looks like my dependencies are getting committed, forge install doesn't seem to add any files for me r u sure u have the latest forge version think so, I've run foundryup a few times today ```forge 0.1.0 (0b6b202 2022-02-04T16:41:12.396200+00:00)``` whats the output of cat .gitmodules `cat: .gitmodules: No such file or directory` then u dont have any dependencies committed do u have lib in ur .gitignore I do not have lib in .gitignore, but I did have lib in my .gitignore earlier today how can I commit dependencies? each time I try to install with forge install i get this error ````Installing ds-test in ""/repos/solidityRepos/wsROME/lib/ds-test"", (url: https://github.com/ds-test, tag: None) fatal: cannot chdir to '../../../../../../../repos/solidityRepos/hellof/lib/ds-test': No such file or directory fatal: 'git status --porcelain=2' failed in submodule lib/ds-test```` seems like your git configuration got screwed up some how. if its possible to migrate your work to a new folder, do forge init new_name, then copy over the needed stuff that will probably be the easiest since it seems you arent too familiar with git dont copy over any .git or .gitmodules or .gitignore and rebuild those manually Doing so now. For a sanity check, after initializing the new forge repo, should `cat .gitmodules` return `cat: .gitmodules: No such file or directory` no [brock@main git_pkgs]$ forge init test21 Initializing /home/brock/git_pkgs/test21... Installing ds-test in ""/home/brock/git_pkgs/test21/lib/ds-test"", (url: https://github.com/dapphub/ds-test, tag: None)  Installed ds-test  Initialized forge project. [brock@main test21]$ cat .gitmodules [submodule ""lib/ds-test""] path = lib/ds-test url = https://github.com/dapphub/ds-test hmm, that isn't good then r u on windows? mac m1 r u in a monorepo i.e.",480
274,foundry-support.txt,"r u in a repo that already has a .git this makes me think that there’s some git directory set up way outside of the package lol ye thank you for the clarification, but no $ ls -a . .. foundry.toml lib src Meaning I manually removed the lib from my .gitignore earlier today https://github.com/mark-antony1/wsROME/commits/master no meaning somewhere in .. or ../.. or ../../.. u have a directory with git setup or any number of ancestor directories up from the current like if you do cd /tmp && forge init test almost certainly it will have a new .git that command runs for me, are you saing I should have a .git file in my /tmp folder? how do we pass constructor args while using 'forge run' —constructor-args doesnt seem to work in this context forge run doesnt need construcotr args, you’re not deploying you’re running against deployed code what’s the ls -a of the new folder in tmp can you actually run cd /tmp && forge init test && cd test && ls -a idk why i’m asking ```. .. .git .gitignore .gitmodules foundry.toml lib src``` Ok I have some misunderstanding then…. So if my code has constructor args where would I put them? Like say I’m starting from a brand new project never been complied or ran before exactly. so as you can see you *must* have a parent directory that already has a git directory.",303
275,foundry-support.txt,"keep moving up in directories from where you were working before doing ls -a and checking for .git things will do! does the presence of a .gitignore but not a .git file with ls -a mean anything? add all your code in the run function, if you need to deploy a contract do it in solidity via ""new"" not sure but id delete it just in case unless u r sure u need it alright! also in n my home directory I have a .git and a .gitmodules should those be deleted as well? lmao yes and the git modules too? Yeah this is the issue Your home dir is not a git project This is what I meant here no it is not makes sense Right so get rid of that and try again Use git status Frequently To understand where you're at will do, so now I should go and initialize a new forge folder and look for the presence of .gitmodules? cool .gitmodules now show up in the newly initialzed forge directory Ok cool I will try it soon thanks… just to clarify make a regular solidity function called “run” with the constructor logic essentially? Ok, everything clones, runs, and tests properly now with submodules installed with the recursive flag. Thank you both @gakonst and @brockelmore, I appreciate both of your patience, you both helped tremendously Hey everyone - For some reason when I try running either forge or cast, I get the following error on Ubuntu 16.04 (fresh install of Foundry): `forge: error while loading shared libraries: libssl.so.1.1: cannot open shared object file: No such file or directory` u don’t have ssl by the looks of it Thanks. are you still dealing with this error? i was having it just now and managed to fix it by fixing a code error in my contract try compiling in remix it’s an unrecognized error from the compiler - i think there is a WIP fix to bubble up the compiler error how do I use a personal token when installing dependencies with forge install? Forge install is just installing the repo as a submodule correct? when I install the submodule directly I have no problems but when I use forge install it asks me to log in and then I get an error saying support for password auth has been removed, use personal token (i'm using gpg). u can just use the personal token as the password (assuming you mean its a personal access token) Yeah access token.",500
276,foundry-support.txt,"I’ll try this later tonight. Ty! any way i can verify the new optimizer_details setting that got merged? i ran foundryup and set yul = false but forge build still complains The msize instruction cannot be used when the Yul optimizer is activated because it can change its semantics. my problem the entire time was a spelling error... everything works >< Check the --snapshot command how do i get how much eth it’ll cost to deploy a contract? forge test —gas-report doesn’t show anything nvm. gas report doesn’t work with fuzzing seems like a problem, in order to get the gas report i need to manually remove fuzzing from all my testing functions.... @bryanhpchiang Are you on the latest version? It does work for me even when your tests have fuzzing? forge 0.1.0 (63644de 2022-02-06T00:32:35.377366+00:00) Yeah Can you try adding a non-fuzz test? yup i removed the fuzzing and get this works great Ah yes you're right, I have many other non-fuzz tests that use same functions so I thought it's working When I keep only fuzz func, it doesn't show gas-report *same contract calls. It is in latest For sure @gakonst I'm not sure if I'm doing something wrong Try adding one or two more -v This might be a bug with how we trigger gas reports @brockelmore Same with most verbose. Also when I enable non-fuzz functions it shows the gas report but fuzzed function stats are definetely not included. Yeah that's not supported yet There's an issue for that I think If you wanna drop any thoughts there Sure, I'll try to find the issue. Also, afaik currently gas-report shows stats from all calls in same bucket. Would be great to see stats seperately for reverted and non-reverted calls. Does this make sense? If so, I'll open a feat request. Hey everyone, whenever I add a new test contract, not just that it is not detected; it is making other tests fail.",440
277,foundry-support.txt,"I can reproduce the same error by moving my new test outside of test/ directory and putting back again [splash-core] tree src/test                             src/test ├── Player.t.sol ├── Stake.t.sol └── helpers  ├── CheatCodes.sol  └── Helpers.sol 1 directory, 4 files [splash-core] forge test                             compiling... success. Running 1 test for PlayerTest.json:PlayerTest [FAIL. Reason: Setup failed: Execution reverted: Index out of bounds, (gas: 5110302)] test_list_addresses() (gas: 0) Failed tests: [FAIL. Reason: Setup failed: Execution reverted: Index out of bounds, (gas: 5110302)] test_list_addresses() (gas: 0) Encountered a total of 1 failing tests, 0 tests succeeded [splash-core] mv src/test/Stake.t.sol .                          [splash-core] forge test                              compiling... success. Running 3 tests for PlayerTest.json:PlayerTest [PASS] test_list_addresses() (gas: 15081) [PASS] test_mint_player_cards() (gas: 64910) [PASS] test_open_player_packs() (gas: 782128) One small note is that I use libraries inside the tests and as far as I understand it is a relatively newer feature so that might be a problem Can you open an issue with a repro? This looks weird - nice catch Let me try reproducing it in a smaller project, thanks Turns out I haven't changed the contract name for the new test file lol, it's all good now Is Linux Arm64 supported? I can’t get forge to run how do I remove a library? forge remove/uninstall aren't available. I could remove the submodule directly I guess.",363
278,foundry-support.txt,"wdym aren’t available hmm i don’t know if we put out binaries for it We don't, there's an open issue for now you can still install foundryup but do foundryup -b master this will build from source (assuming you have rust and cargo) what forge version 0.1.0 does it say anything else see the pinned comment u likely have the pinned issue error msg or --version? version just what I sent, I'll try `rm -rf ~/.cargo/bin/cast && rm -rf ~/.cargo/bin/forge` great ok yup, that's on me, fixed it This happened to me on Debian Linux can you try again, same command? sometimes i get flakes on arch It failed to compile using the cargo install —git —bin forge —locked what’s the end of the error you showed the top running forge install openzeppelin/openzeppelin-contracts@3.1.0 doesn't seem to be installing 3.1.0 if I use @v3.1.0 this works however the tag on github is probably v3.1.0 it runs an exact match through the tags then? if it were to grep the list, only one tag would be returned i forget if it’s branch or tag off the top of my head. i haven’t done work on that part of the codebase but ye that would work do u wanna open an issue sure Ya needs the v This is the end of error I tried it 6 times. Keep on getting the same thing that’s not the end of the error right below that it has more info in blue can you make sure you have the latest rust version by running rustup If you get sigkill you don't have enough memory on the vm you're running the command in cheats.mockCall(  address(txManager),  abi.encodeWithSelector(TransactionManager.approvedRouters.selector),  abi.encode(true)  ); trying to mock a call like this TransactionManager.approvedRouters is a mapping TypeError: Member ""approvedRouters"" not found or not visible after argument-dependent lookup in type(contract TransactionManager).",433
279,foundry-support.txt,"  --> /Users/rahul/connext/repos/nxtp/packages/contracts/contracts/TransactionManager.t.sol:41:30:   |  41 |  abi.encodeWithSelector(TransactionManager.approvedRouters.selector), this is the error im getting is the mapping public? yes mapping(address => bool) public approvedRouters; on the TransactionManager contract wait u dont need encodeWithSelector of u are using the selector itself ``` cheats.mockCall(  address(txManager),  TransactionManager.approvedRouters.selector,  abi.encode(true)  ); ``` if that doesnt work, try with an instantiated version of the contract like TransactionManager txmgnr = new TransactionManager(); /* snip...*/ txmgnr.approvedRouters.selector TypeError: Invalid type for argument in function call. Invalid implicit conversion from bytes4 to bytes memory requested.   --> /Users/rahul/connext/repos/nxtp/packages/contracts/contracts/TransactionManager.t.sol:39:41:   |  39 |  cheats.mockCall(address(txManager), txManager.approvedRouters.selector, abi.encode(true));   | oh i thought we overloaded it to accept bytes4, my bad, you do need the abi.encodeWithSig wait abi.encodeWithSelector(txManager.approvedRouters.selector) withselecotr ah this worked ye using the instantiated version idk solidity is weird https://onbjerg.github.io/foundry-book/reference/cheatcodes.html#mockcall prob should update docs what solidity version are u using? 0.8.4 0.8.11 seems to support uninstantiated versions i believe no just tried 0.8.11 TypeError: Member ""approvedRouters"" not found or not visible after argument-dependent lookup in type(contract TransactionManager).",371
280,foundry-support.txt,"  --> /Users/rahul/connext/repos/nxtp/packages/contracts/contracts/TransactionManager.t.sol:41:30:   |  41 |  abi.encodeWithSelector(TransactionManager.approvedRouters.selector), idk solidity just weird ty anyways but now it looks like my mock isnt working 🙁 post the trace? -vvv (preferably as a screenshot) no wait i guess it is working function testAddRouterAlreadyApproved() public {  cheats.mockCall(address(txManager), abi.encodeWithSelector(txManager.approvedRouters.selector), abi.encode(true));  cheats.expectRevert(bytes(""#AR:032""));  txManager.addRouter(address(1)); } is this the correct test to write? this is the function im testing: function addRouter(address router) external override onlyOwner {  // Sanity check: not empty  require(router != address(0), ""#AR:001"");  // Sanity check: needs approval  require(approvedRouters[router] == false, ""#AR:032"");  // Update mapping  approvedRouters[router] = true;  // Emit event  emit RouterAdded(router, msg.sender); } i want to test the second require if i mock the call, it should return true in that, right? quick glance it seems yes if u post the trace it will be easy to tell whats happening forge test -m testName -vvv ah damn we dont trace for mocked call. we should add that can u add a dummy event that logs the response from the mock call and redo the screenshot? whats the format of the mock call return value? emit logs(  cheats.mockCall(address(txManager), abi.encodeWithSelector(txManager.approvedRouters.selector), abi.encode(true))  ); this is what you want? TypeError: Invalid type for argument in function call. Invalid implicit conversion from tuple() to bytes memory requested.",389
281,foundry-support.txt,"any clue *why* it does this? Mock only works for CALL/STATICCALL/DCALL not for jumps yeah. Once we change the EVM we'll be able to do that too in this case its not even a jump tho Right whatever is there a way for forge install ... to automatically add the package to remappings.txt? remappings.txt is mostly not needed if u are in a pure forge repo it should all be picked up automagically interesting... my repo is forked off https://github.com/FrankieIsLost/forge-template, would you consider this to be a pure forge repo? if u do forge remappings it shows the picked up remappings ye nice, I see that now, tests pass properly without the remappings.txt the remappings.txt did make my VSCode imports happy, is there a suggestion for how to handle that? could do echo $(forge remappings) > remappings.txt, right, but is there another automagic thing? I'm getting a the following error thread 'main' has overflowed its stack fatal runtime error: stack overflow fish: Job 1, 'forge test' terminated by signal SIGABRT (Abort) my project is similar to frankie is lost's template but with a hello world test file whats ur forge version (include *entire* output plz) not sure i dont use vscode forge 0.1.0 (0b6b202 2022-02-04T16:41:12.396200+00:00) can u push the repo to github so i can take a look? sounds like a bug or tell me what u changed sure got it, for posterity, this works for me in settings (for most packages)  ""solidity.packageDefaultDependenciesContractsDirectory"": ""src"",  ""solidity.packageDefaultDependenciesDirectory"": ""lib"" https://onbjerg.github.io/foundry-book/guides/vscode.html ah perfect, maybe the only addition necessary is that non-standard libs (eg openzeppelin-contracts) would require updates in remappings.txt hey, I'm having this error The application panicked (crashed).",437
282,foundry-support.txt,"Message: No Manifest found: NotPresent Location: /home/runner/.cargo/git/checkouts/ethers-rs-c3a7c0a0ae0fe6be/b2b891d/ethers-core/src/macros/ethers_crate.rs:46 when trying to run forge bind It's a simple repository with some rust code in src along the contracts of foundry I don't understand the manifest it refers to, it should be noted that I have ethers-rs listed as dependency in Cargo.toml, and I re-ran cargo build to make sure it's not rust-related Running with RUST_BACKTRACE=1 gives out this: 1: __libc_start_call_main<unknown> at ./csu/../sysdeps/nptl/libc_start_call_main.h:58 2: __libc_start_main_impl<unknown> at ./csu/../csu/libc-start.c:409 Is there a way to get an EOA nonce? GetNonce is pending It's in open PR See it. thanks @gakonst is there a way to better see transaction errors wit foundry? My stack traces have been a bunch of opcode @mattsse im trying out your PR that was merged and setting optimizer = true, yul = false but still get an error in compilation ""msize instruction cannot be used when the yul optimizer is activated"" -vvvv when deploying a contract to kovan with forge create getting the following error (code: -32602, message: Invalid params: unknown field chainId, expected one of type, from, to, gasPrice, maxFeePerGas, gas, value, data, nonce, accessList, maxPriorityFeePerGas., data: None) anyone getthing this? this is an ethers-rs issue t.me/ethers_rs if you can share there ok thx any quick workaround for it? to deploy with forge or is best way to deploy with cast and send a raw deployment transaction in mean time? Does this issue persist in other networks too or just Kovan? goerli works dont have eth on other networks to check but seem kovan specific hmm any chance you could provide a repro in an issue? minimal contract and command? forge test --hh compiling...",462
283,foundry-support.txt,"thread 'main' has overflowed its stack fatal runtime error: stack overflow [1] 69574 abort  forge test --hh wtf What code causes this? Hello everyone! im not sure i just added one very simple test pragma solidity ^0.7.6; // SPDX-License-Identifier: UNLICENSED import ""ds-test/test.sol""; import ""forge-std/stdlib.sol""; import ""forge-std/Vm.sol""; import ""./FusePoolDirectory.sol""; contract FusePoolDirectoryTest is DSTest { using stdStorage for StdStorage; Vm public constant vm = Vm(HEVM_ADDRESS); StdStorage stdstore; FusePoolDirectory fusePoolDirectory; function setUp() public {  fusePoolDirectory = new FusePoolDirectory(); } function testInitialize() {  fusePoolDirectory.initialize(true, [address(1), address(2)]); } } seems like it was the import ""./FusePoolDirectory.sol""; but why would that be yes if i remove the import it works but how can i test if i cant import my contracts? 😅 this reared it’s head yesterday. not entire sure the issue but mattsse has a repro from another private repo ok so you guys are on it? > hardhat compile && npm run build:sdk Error HH411: The library ds-test, imported from contracts/FusePoolDirectory.t.sol, is not installed. Try installing it using npm. also hardhat compile doesnt seem to play nice we will eventually try out forge deployment but for now need this to work One quick question, is there a way to upgrade a contract on forge tests? (using openzeppelin upgradable contracts I mean) https://github.com/gakonst/ethers-rs/pull/878 PR is here u know i think the main issue is stdlib requires ^0.8.0 when it doesnt really need to ill update it with lowest version possible ah i forgot i use custom errors probably worth removing those for better compatibility ok just updated versioning to be looser in stdlib.",414
284,foundry-support.txt,"if you do forge update lib/forge-std lmk if it works does anyone have an idea how I could help with diagnostic? The error message isn't really helpful because I have no idea what Manifest it refers to I tried several things already no sorry i havent tried forge bind, maybe @gakonst or @prestwich (in the other chat) can advise oh wow this fixed my stack issue too! thanks champ that fixed my issue as well, tyvm Brock!! also ty @mattsse TypeError: Invalid type for argument in function call. Invalid implicit conversion from address payable[2] memory to address[] memory requested.   fusePoolDirectory.initialize(true, [address(1), address(2)]); anyone know how to get rid of this? function sig  function initialize(bool _enforceDeployerWhitelist, address[] memory _deployerWhitelist) public initializer { address[] memory addresses = [address(1), address(2)]; fpd.initialize(true, addresses); Ya the above is solidity thing TypeError: Type address payable[2] memory is not implicitly convertible to expected type address[] memory.   address[] memory addresses = [address(1), address(2)]; check how to manage address/payable addrs (this is not a bug in foundry so would recommend looking up how all that works) i always just construct the array first then set via index generally but was being lazy in my solution yeah same, address[] memory arr = new address[](2); arr[0] = foo; arr[1] = bar; fuck solidity lmao Sorry to bother again guys, did someone had to deal with this? This worked do you mean like a script for upgrading like oz provides in js? Correct, I wonder if there's something similar to OZ test-helpers or would I just need to deploy all contracts and upgrade ""manually"" upgrade manually like a tru solidity chad T_T Manually it is then it’s important to know how upgrades work and what actually happens imo. i have a distrust of magic like that personally. if you build a solution i’d be open to upstreaming into forge-std where people can at least quickly understand the code what things does the OZ code do for you? we could ofc bundle them as helper contracts Yes, I agree, in this case I needed a quick workaround but I like it better when not using magic modules.",494
285,foundry-support.txt,"As soon as I'm available I will take a closer look and maybe propose a bundle Error HH411: The library ds-test, imported from contracts/FusePoolDirectory.t.sol, is not installed. Try installing it using npm. anyone get around this? that seems like a hardhat error? i have no idea. i would check with their community yeah i figured it out, basically separating out the contracts completely Hey all! Quick question, when I create a new repo in Git Hub and push the repo from the command line using the following commands - Forge takes 30+ minutes to set up the repo and then crashes before pushing it to the Repo. I imagine there is some mapping that I need to do when setting up the file but I cant find anything in the docs. Any help would be appreciated.",162
286,foundry-support.txt,"git remote add origin https://github.com/BigSky77/Farmland_v3.git git branch -M main git push -u origin main ``` 0: ""/home/runner/work/contracts/contracts/lib/ds-test/src/test.sol"": No such file or directory (os error 2) 294 ``` why does this happen in CI? whats your cat .gitmodules [submodule ""lib/ds-test""] path = lib/ds-test url = https://github.com/dapphub/ds-test [submodule ""lib/forge-std""] path = lib/forge-std url = https://github.com/brockelmore/forge-std is the repo open source? no can i install local? we will opensource it soon r u using the ci from forge-template? https://github.com/FrankieIsLost/forge-template/blob/master/.github/workflows/CI.yml you are probably missing these two lines to make the workflow pull submodules: https://github.com/FrankieIsLost/forge-template/blob/master/.github/workflows/CI.yml#L13-L14 ahhh thank u I'm trying to deploy a contract to Kovan using forge create <name> but I'm getting this error: 0: (code: -32602, message: Invalid params: unknown field chainId, expected one of type, from, to, gasPrice, maxFeePerGas, gas, value, data, nonce, accessList, maxPriorityFeePerGas., data: None) Anyone know what the issue may be? I'm not passing a chainId arg (I don't even have the CHAIN env var set in .dapprc, just the Kovan rpc url in RPC_URL) this is tracked in ethers-rs t.me/ethers_s https://github.com/gakonst/ethers-rs/issues/877 Ah gotcha, thanks for the speedy reply What's the best way to handle converting between mac forward slash and windows back slash in imports+remappings? (Like python normpath) ur gonna have a bad time ser do u mean in rust? or in solidity solidity big yikes if in solidity lol rip whats the usecase if u dont mind all g, i can just pick one.",461
287,foundry-support.txt,"i have a windows desktop setup and a mac that i switch between depending on if i’m traveling windows has the concept of drive specific current working directory which means it can be either be that or an absolute path, unix only has absolute paths for directories but why do u need it in solidity? what do u do with the files? i believe in foundry we canonicalize paths for you for things where you input a path he wants to load sprites hes making unreal 2004 port there may be exceptions but for the most part i think we do our best to abstract it everywhere Useless cat ser Gotcha nice, afk right now, but I’ll ping you in 15 when I’m back on comp i'm trying to generate the rust bindings for my contract, i'm doing the following: forge build forge bind and i'm getting this: The application panicked (crashed).",177
288,foundry-support.txt,"sorry if noob question but any pointers? cant figure out a way for mocktoken and marketplace to import the interface but test contract only needs it once just to add here: the changelog also seems buggy. probably bc they’re diffing from an old commit? not sure..@onbjerg whenever u got time to take a look.. i need the IERCRoyalties interface for market but it is also needed for mocktoken i just download the latest nightly manually and i get the same error. no extra explanation. i will try to find if this is my mistake. if i don't i will open an issue in github https://github.com/gakonst/foundry/pull/663 this is where it got fixed ok i will have a look hm i was doing what was suggested and then i got the error. maybe ethers-core should also use locate-cargo-manifest crate instead of CARGO_MANIFEST_DIR env var? OK I knkow the bug. Windows workflow started to OOM. Which means that the job doesn’t complete, so the step which moves the tag doesn’t get triggered https://github.com/gakonst/foundry/blob/master/.github/workflows/release.yml#L199-L213 y u no use github cli? when u create a repo using the website it is != as git init fyi I understand how to use expectRevert with ""require"" but how do I use it with solidity's new type ""error""? So instead of using a ""require"" I am using a revert with the ""error"" type. vm.expectRevert(abi.encodeWithSelector(Overflow.selector, z, x)); can foundry only parse git dependencies over https? Thanks!! Kk thanks 🙏 https://github.com/cli/cli you can for example, use github's CLI in conjunction with fzf for better searching https://github.com/atusy/gh-fzf Run forge test -vvv compiling...",396
289,foundry-support.txt,"i tried adding: libs = ['node_modules', '../../node_modules'] to foundry.toml, but im seeing: ParserError: Source ""/Users/rahul/connext/repos/nxtp/packages/contracts/../../node_modules/@openzeppelin/contracts/contracts/token/ERC20/IERC20.sol"" not found: File not found.  --> /Users/rahul/connext/repos/nxtp/packages/contracts/contracts/lib/LibAsset.sol:6:1: What is the difference between stream and subscribe? ethers-rs chat ah okay i saw this chat being linked for support ya for foundry support 🙂 thought so too since its the only api key i have in my env but dont use it in my command `cast send --rpc-url=${process.env['RPC_URL']} --private-key=${process.env['PRIVATE_KEY']} to sig args maybe its used under hte hood anyway? it gets used if it’s in the env ye oke cheers forge install OpenZeppelin/openzeppelin-contracts   Installing openzeppelin-contracts in ""/Users/rahul/connext/repos/nxtp/packages/contracts/lib/openzeppelin-contracts"", (url: https://github.com/OpenZeppelin/openzeppelin-contracts, tag: None)  Installed openzeppelin-contracts nothing actually installs into /Users/rahul/connext/repos/nxtp/packages/contracts/lib/openzeppelin-contracts do u have lib in .gitignore no i dont but i had it at one point, and now im seeing my forge libs arent actully inside lib can i change the install location from lib? it worked when i instlled with --no-git but now my repo changes are huge id rather do it with node_modules since i already have the deps but im getting this error still Hey, any idea why this simple test does not pass when forking mainnet? when i create my own erc20 i'm able to call balanceOf() but not on other erc20 here the script i run to test any help would be appreciated -c isnt what you want to use there you want —mc match contract -c is contracts which sets the contracts directory is this for me? no lol sorry your setup seems strange @rhlsthrm so it makes it hard to help Thks -mc is what I was looking for ! its not strange, its a standard yarn workspaces setup.",489
290,foundry-support.txt,"so i have: - app node_modules - packages  - contracts  - contracts   XX.sol ...  foundry.toml so the node_modules are hoisted to the top level Admit I haven't tested forge install in monorepos try moving foundry.toml to top level, setting src to ./packages/contracts, and libs to ./node_modules and run forge from top level This might be the best solution not ideal though > libs = ['node_modules', '../../node_modules'] This should have worked I think, if it hasn’t it might be a bug. cc @mattsse wonder if there’s something we’re missing in relative vs absolute paths? This is a monorepo this looks correct, as we treat all paths relative to the toml file. But the toml file must be either in the current dir where forge is run or in a parent dir but perhaps we’re missing something so feel free to open an issue, ideally with the output of: tree . it seems like it isnt working with relative going up the tree Hello, i'm using forge 0.1.0 (28f6d91 2022-02-08T09:32:28.020675400+00:00), and I don't know if it is a bug, but in case of a test failed, the events log_named_uint are displayed only for non-fuzzing test... Example: ye there is an open issue for this..",296
291,foundry-support.txt,"sorry! ill try to fix rq Ok thanks ! am i doing something wrong? Forge bind buggy still is there another way i can include bytecode from a compiled contract into my code? without copy pasting it each time it's updated Into your Solidity or your rust compiled solidity into my rust since it's just JSON i could just manually get the bytecode.object, but i wonder if there is a cleaner / intended way to doit basically i want to get access to bytecode alongside abi with abigen! or something similar, built in at compiletime Hi, is it possible to test on bytecode instead of solidity code in foundry? sort of it's the first time I am trying to directly deal with bytecode, so any pointers would be helpful! do u have an interface for hte byecode? yes just do: contract T is DSTest {  bytes constant hiddenContract = hex""<insert creation code>"";  HiddenInterface hidden;  function setUp() public {   bytes32 salt = 0;   bytes memory t = hiddenContract;   assembly {    hidden:= create2(0, add(t, 32), mload(t), salt)  }  }  function test_t() public {  hidden.someFunc();  } } thanks 🙂 the above is an approximation, not accurate but more pseudocode np, that's already a good start! Noob question. I copied console.sol to /test, imported it and console.log(""Yo!"") in my test. The test runs. Where would I expect to see ""Yo!"" appear? 😅 add -vv to forge test also, read the guide that is in the pinned comment Sorry 🤦‍♂️ Hi I'm trying to make a cast call but I'm getting: ""Error: 0: (code: -32000, message: Must be authenticated!, data: None)"".",378
292,foundry-support.txt,"How do I authenticate my wallet to make cast calls? Which RPC? Still not getting how I am supposed to use console.log 🙏 did u run forge test -vv u can also do forge test -vvvv The command I was using before is % forge test --contracts contracts --lib-paths libraries\ If I stick a -vv after test, I get the following: % forge test -vv --contracts contracts --lib-paths libraries error: Found argument '-v' which wasn't expected, or isn't valid in this context add -vv at the end % forge test --contracts contracts --lib-paths libraries -vv error: Found argument '-v' which wasn't expected, or isn't valid in this context USAGE: forge test --contracts <contracts> --lib-paths <lib-paths>... also whats forge --version output exactly? My call looks like this: ""cast call 0x6b175474e89094c44da98b954eedeac495271d0f ""totalSupply()(uint256)"" --rpc-url https://eth-mainnet.alchemyapi.io/v2/$\{ALCHEMY_API_KEY\}"" I'm using alchemy this was for u @EricForgy Thanks Brock. Before doing this, I installed and ran foundry up, but it looks like it might be using an old version? % forge --version foundry-cli 0.1.0 ye. follow step 3 in the pinned comment I'm coming from dapptools where we used ethsign to authenticate my wallet. Not sure if I should do that process again or what foundry uses. That did it.",335
293,foundry-support.txt,"Thank you 🙏 ah nvm when I copy and pasted my ALCHEMY_API_KEY into the rpc url it worked! This is so fun 😊 I've been writing code in tradfi for over 20 years, but learning Solidity really feels like coding money directly 😊 How do you use 2 accounts in a single contract test? do mean impersonate an account? please see the pinned comment and look thru the book Is there a multithreaded fuzz test on the roadmap? eventually? but right now we use proptest which is single threaded 👍 suppose my contract under test does the following: 1) check balance of address 2) receives some tokens 3) checks balance again if I want to mock only the initial balance, is that possible with mockCall? it seems that mockCall will allow me to return the same value for every call with the same paramters. check vm.store to override the storage slot mockCall is more useful for when the actual contract does not exist or wehen there’s some comlpex calculation that u want to override thanks, will do. I feel I leveled up by using foundry.toml 🤓🏆🐣 hey, is there a good way to see the size ofa compiled contract? --gas-report generally will tell u, u can also use the getCode cheatcode which returns the creation code, and you use bytecode.length, or if its deployed u can use built in solidity utils to get the size So I tried again setting solc_version explicitly or just use autodetect and for some reason it always uses 0.7.6 for me. Here is a minimal public repo now with the steps and node versions I used: https://github.com/RedVeil/failingForgeTest couldn't really figure it out yet. What is best way to pass cli flags to forge to configure solc configuration Hey does anyone know the current gas cost for call data? IIRC it was 68 per byte and 4 if the byte was 0, but has that changed? 16 & 4 Got it, thanks! I am creating a function that will be able to calculate the gas cost for call data. I think I remember you saying that Foundry doesnt currently account for that? Or does it already account for that.",473
294,foundry-support.txt,"are there instructions for deploying forge projects to chain? with separated multi-chain configuration scripts How did you use it? :) It intentionally subtract calldata costs from the test function being called as that's not what your gas costs are https://github.com/gakonst/foundry/blob/master/cli/README.md looks like here? Not yet - the base way to do this is via forge create and cast send. There's issue 402 where we track a full deployment toolkit thanks! got it, thanks for the clarification. trying to call a function with cast getting an unhelpful error 0: expected value at line 1 column 1 command is cast send --rpc-url=${process.env['RPC_URL']} --private-key=${process.env['PRIVATE_KEY']} contractAddress functionName arg anyone know what that error refers to? or if im missing any required options causing the failure? So far, not too much, but definitely felt it is a level up 😊 I just set the src, test, libs,remappings and verbosity so that % forge test --contracts contracts --lib-paths libraries -vv becomes % forge test 🤓 But using it also points to other things I could be (and probably will be) using it for. I'm still writing the basic contract (a new kind of AMM) so haven't been able to test it yet with actual transactions. Hopefully soon 🙏 PS: If anyone is a quant researcher or math nerd, this might be interesting: https://arxiv.org/abs/2111.08115 (I'm implementing this 👈). I'm struggling a bit doing math in uint 😅 I see some fixed-decimal libraries around, but might end up rolling my own. why you should look at Sushiswap's Kashi, looks to be similar Still wip Nothing serious 😊 My weapon of choice for mathematical modeling (in tradfi) is Julia lang and I made good use of https://github.com/JuliaMath/FixedPointDecimals.jl. It'd be nice to have something like that for Solidity. Like I said, I see a few libraries around I could use, but for what I'm doing I can get by with just SafeMath and squinting. Thanks for the heads up. I'm still fairly new to DeFi.",471
295,foundry-support.txt,"I wrote that paper in Oct / Nov without doing too much scanning of the landscape although my coauthor has a great survey article ( https://medium.com/anchordao-lab/automated-market-maker-amm-algorithms-and-its-future-f2d5e6cc624a ) . There is simply too much cool stuff out there and when you're in catch up mode, new stuff is coming out faster than I can read the old stuff. At some point, you just need to say, ""Let's build this thing."" If it turns out to be similar to Kashi, Notional, Yield, or whatever, that would just be a great form of validation 😊 I am most familiar with Uniswap and Bancor and was recently in a debate with Mark Richardson, Head of Research at Bancor: https://twitter.com/MBRichardson87/status/1487505248516476928. I had some tech difficulties in the beginning, but joined the conversation at 45:35. I should definitely know more about Sushiswap if I have any quixotic asperations of competing in this space though. is there a nice way to run tests from a folder outside of the contracts folder? e.g. contracts in src, tests in tests/ rather than src/tests seems like this is necessary to run foundry in a repo that otherwise uses hardhat ye currently tests have to be in the contracts directory i believe (maybe can be in the lib dir?) we could probably add the ability but most people wont have solidity tests in a hh repo yet so instructing them to add it there feels best because it reduces code complexity and issues that weve encountered trying to support weird dir structures This is what I do: % forge test --contracts contracts --lib-paths libraries -vv but I don't use Hardhat so not sure if that is sufficient. Just this morning, I switched to using foundry.toml for this though.",398
296,foundry-support.txt,"you might be able to add the test dir as an addition lib path ye i think if u just add the test dir as a lib-path (because it can take multiple i believe) it should work (could be wrong tho) yeah this is similar to forge test -hh and that works for stuff like forge build think this is the same issue — hardhat will compile anything in the contracts/ folder and since the ds-test library is forge installed rather than npm installed, hardhat breaks added libs = [""node_modules"", ""forge_test""] to foundry.toml and it's picked up in the forge config but seems like tests don't get picked up there I have set my project up as BOTH a hardhat project and a foundry project. I have configured tests cases in both projects and the foundry project is reporting significantlyl less gas for the functions on my contract. Does anyone know why that would be happening? the reported gas takes away 21064 gas associated with every transaction (21k base tx, 64 gas from calldata) so the gas that foundry is reporting is 21,064 less than the actual gas that would be consumed? basically, yes. u may have a +/- 12 gas around that but for the most part ok thanks. What is the reasoning there? it makes it clearer for small functions to see gas optimizations primarily. otherwise you’re doing calculations in your head to actually know what the computation cost of a function is alright got it. Thanks for clearing that up Apologies if this is covered (I tried and couldn't find it)... When I run my tests now, I see: % forge test compiling... success. It doesn't seem to be running my tests 🤔 Previously, I saw some output for each test saying if it passed or not. (My foundry.toml has verbosity = 2) Nevermind.",378
297,foundry-support.txt,"It is working now 🙏 Somehow along the line, while trial & erroring, I set the test contract to abstract 🤦‍♂️ 0: ""/home/runner/work/contracts/contracts/node_modules/@openzeppelin/contracts/contracts-upgradeable/proxy/Initializable.sol"": No such file or directory (os error 2) 9 ahh super annoyng! why would it be looking here and not in @openzeppelin/contracts-upgradeable this only started happening on the latest nightly btw it was working before, maybe something changed with the mappings? trying to call a function with cast getting an unhelpful error : 0: expected value at line 1 column 1 the command i am running is cast send --rpc-url=${process.env['RPC_URL']} --private-key=${process.env['PRIVATE_KEY']} contractAddress functionName arg anyone got this error? asked already sry for double posting but kind of stuck on that error is process.env a feature of your shell? running it within a node script which reads these env variables from .env file it works fine for deployments etc if this is the actual node string with interpolation, shouldn't you also be interpolating the contractAddress, functionName and arg too? can u show functionName and arg I once encounted this error cuz my env param is empty, u can have.a double check hi there below code is giving me error bytes32[] calldata _merkleProof = bytes32[0x0ad2638c89ef98de7e450ea32c9d37a3db5d4d3634d8d6464dcb20564ad0ccd6,0x786798a204e61c33bb5d957f2256bb15d56f492060bcd04212d467e5e3e667e9,0x441058d0fcd1dffe5ccd3f391d3b6d2dd5ff2195d6677d9ae24d84d3faeeda4a]; Expected ']' but got ',' contract address is just my contract address functionName is mintTo and the arge is an EOA which is the only param that mintTo accepts.",462
298,foundry-support.txt,"mintTo(address) anyone? let me try to repro give me 20 thy this bytes32[] _merkleProof = [bytes32(0x0ad2638c89ef98de7e450ea32c9d37a3db5d4d3634d8d6464dcb20564ad0ccd6), bytes32(0x786798a204e61c33bb5d957f2256bb15d56f492060bcd04212d467e5e3e667e9)]; *try dont you need to give it a location? oh yeah sorry, missed that @gakonst I started converting Moloch Baal to forge but there's some stuff with multicalls that I am don't understand how to implement in solidity. Specifically this part -  const initalizationActions = encodeMultiAction(  multisend,  [setPeriods, setGuildTokens, setShaman, mintShares, mintLoot],  [baal.address, baal.address, baal.address, baal.address, baal.address],  [   BigNumber.from(0),   BigNumber.from(0),   BigNumber.from(0),   BigNumber.from(0),   BigNumber.from(0),  ],  [0, 0, 0, 0, 0]  ); encodeMultiAction is defined here they make use of gnosis' MultiCall Library can u give me some pointers as to where can I look? no luck mate bytes32[] calldata _merkleProof = [bytes32(0x0ad2638c89ef98de7e450ea32c9d37a3db5d4d3634d8d6464dcb20564ad0ccd6), bytes32(0x786798a204e61c33bb5d957f2256bb15d56f492060bcd04212d467e5e3e667e9)]; giving me this error TypeError: Type bytes32[2] memory is not implicitly convertible to expected type bytes32[] calldata. right, gotta do this if you are passing it to a function with dynamic array as parameter thank you it worked how do i add balance to an address for testing? Hi everybody.",470
299,foundry-support.txt,"&& ls -a searching for a .git soliditytest2 has a .git I've deleted it same issue was soliditytest2 a parent directory of the pwd? that's the directory I'm running forge install in, where I ran forge init originally did u just ignore my recommendation above? the issue is a *parent* directory has a .git no that isn't the case I don't know if it's relevant but forge init creates a .git in the folder, I removed that there is a directory called .gitkraken two levels above and a gitignore and gitconfig okay *that* is where the issue is almost certainly. is that your home directory yeah that shouldnt be there .gitkraken? That's where GitKraken stores its config then no need to delete that now u will need to go initialize a new forge repo because you clobbered the git in the one you made have done are you saying forge install isn't comatible with having gitkraken installed? no thats not what im saying im saying if u have a parent directory as a git directory, that is incompatible (well, technically it is fine but takes more configuration) but that isn't the case can u run git rev-parse --show-toplevel ~/Desktop/soliditytest3 » git rev-parse --show-toplevel fatal: not a git repository (or any of the parent directories): .git interesting - and whats the output of forge --version forge 0.1.0 (fcc0fe5 2022-02-10T00:27:20.909300+00:00) okay can u do: cd ../ && forge init soliditytest4 && ls -a ~/Desktop/soliditytest3 » cd ../ && forge init soliditytest4 && ls -a Initializing /Users/x/Desktop/soliditytest4... fatal: not a git repository (or any of the parent directories): .git fatal: not a git repository (or any of the parent directories): .git Installing ds-test in ""/Users/x/Desktop/soliditytest4/lib/ds-test"", (url: https://github.com/dapphub/ds-test, tag: None) fatal: not a git repository (or any of the parent directories): .git Installed ds-test Initialized forge project. and then a list of files on my Desktop oh oops . ..",479
300,foundry-support.txt,".DS_Store .localized should have a cd soliditytest4 cd into the new folder and do an ls -a . .. .git .gitignore foundry.toml lib src weird run `cd .. && git rev-parse --show-toplevel` i dont expect that to change but something strange is happening with git on ur system fatal: not a git repository (or any of the parent directories): .git It's macos and u deleted the .gitignore there? no the gitignore is still there Inconviniently I have to go to a meeting, I'll be back in around an hour if you'll still be here? can u do cat .gitignore ye i should be around ~/Desktop/soliditytest4 » cat .gitignore cache/ out/ cool, speak soon Hello, I'm back git clone https://github.com/openzeppelin/openzeppelin-contracts works fine i dont think foundry toml is supported in cast yet Alright, I think I've found a solution. I manually ran git init in the soliditytest folder Do i have to enable something like in dapptools HEVM_RPC=yes to be able to test on mainnet fork ? i can't figure out how to fork mainnet here is my command forge test -v --fork-url https://eth-mainnet.alchemyapi.io/v2/key this should work^ try --rpc-url maybe? @mattsse i wonder if the config merging with the aliases is not working already tried --rpc-url is not working i think whatever i put after --fork-url i get the same result, i feel like it doesn't take into account what is after the flag just trying to get ERC20 balances on mainnet for example i’m surprised - this should def work can you log block.timestamp or block.number yes doing it rn will check hey, is this in the docs somewhere? can't seem to find here's the log this is with the same command as above, forking mainnet @gakonst ran into this issue as well. Spent time searching the repo, etc. for documentation, but there isn't any currently for `--gas-report' since it's such a new feature. So then had to dig in this chat. My initial install was based on this article, which suggests installing via cargo and mentions foundryup as a secondary note. This was ultimately the source of the issue.",487
301,foundry-support.txt,"Perhaps @crisgarner could consider updating the article making a note about this --gas-report issue or making foundryup the recommended install path? For others coming down this path again. Thanks! 🙏 does install from foundryup fixes the --gas-report issue? installing with cargo shouldn't be the same version as with foundryup ? cargo should work foundryup should also work but if you are on cargo you might be on old version of foundry also if you have installed with cargo first, perhaps it's running the old binary run which forge check bulletpoint 3 I will do update the tutorial as foundryup is so much better Yep sorry, but i don't understand what exactly do i encode to get the functionality of the snippet. I have encoded with signature the different functions like setPeriods, etc. do I encodePacked these?' Yes, this was the issue. I did original install via cargo which was a version before the --gas-report update. The twitter post that made me aware of the update and other devs all said to update via foundryup. foundryup was installing and and updating, but was not the default path. I'm not a rust dev so it didn't occur to me to update via cargo. Removing the cargo bin and having foundryup installed resolved the issue. But if the article gets updated it should help prevent new people falling down this particular rabbit hole. yeah, if you installed via cargo you need to remove the other way we cannnot ser yes when in doubt, replace your question of ""forge"" with ""dapptools"" and you will find ur answer here's what I tried to do for one of the functions that needs to be called with multiCall - bytes memory x = abi.encodePacked(uint8(0), address(baal), uint256(0), uint256(1), setPeriods); // x- multiCall input param. setPeriods - function encodedWithSignature bytes memory y = abi.encodeWithSignature(""multiSend(bytes)"", x); bytes memory z = abi.encode(TOKEN_NAME, TOKEN_SYMBOL, address(multisend), y); baal.setUp(z); but this doesn't work. what am I missing? hello does foundry not support ewasm.wast as output ? forge test worked correctly when i cleared cache is there any flag in forge to by default clear cache? —force? thank you I recently started using foundry.toml.",500
302,foundry-support.txt,"You can grab a default version here: https://onbjerg.github.io/foundry-book/reference/config.html I set force=true. hey im trying to do an ""ethernaut x foundry"" repo for helping myself and others to learn foundry, currently having an issue with using the prank cheatcode to simulate other addresses interacting with the contract, when using prank i get ----------------------------------------- ➜ ethernaut-x-foundry git:(main) ✗ forge test -vvvv compiling... success. Running 1 test for FallbackTest.json:FallbackTest [FAIL. Reason: Revert(Reverted)] testContribute() (gas: 10321) Traces: [261097] FallbackTest::setUp() ├─ → new Fallback@0xce71…c246 │ └─ ← 810 bytes of code └─ ← () [10321] FallbackTest::testContribute() ├─ [0] VM::prank(0xf6b4e49bdc3bd8dbaad4414569c9afd6e1d9de5d) │ └─ ← () ├─ [0] Fallback::contribute{value: 500000000000000}() │ └─ ← () └─ ← () Failed tests: [FAIL.",268
303,foundry-support.txt,"Now, I'm thinking ahead to how to deploy it. What tools do you recommend for deploying to a testnet once the dapp is built using Foundry? ive used hardhat for deployment so far forge install OpenZeppelin/openzeppelin-contracts-upgradeable@04695ae   Installing openzeppelin-contracts-upgradeable in ""/Users/rahul/dev/projects/midasprotocol/monorepo/packages/contracts/lib/openzeppelin-contracts-upgradeable"", (url: https://github.com/OpenZeppelin/openzeppelin-contracts-upgradeable, tag: Some(""04695ae"")) Error:  0: No such file or directory (os error 2) Location: /rustc/db9d1b20bba1968c1ec1fc49616d4742c1725b4b/library/core/src/result.rs:1911 hey another issue i'm trying to debug, im sending some eth to the contract directly to trigger the fallback method, again getting [FAIL.",207
304,foundry-support.txt,"Reason: Revert(Reverted)] but not much else info, i've done an emit log_uint of the balance to make sure there's ETH in the address, if i remove this line ""owner = payable(msg.sender); "" from the fallback function i no longer get the error but not sure what the issue is with that line, thanks again for any help ---------------- TEST TRACE ---------------------- Traces: [271715] FallbackTest::setUp() ├─ → new Fallback@0xce71…c246 │ └─ ← 863 bytes of code └─ ← () [79087] FallbackTest::testContribute() ├─ [0] 0xf6b4…de5d::fallback{value: 1000000000000000000}() │ └─ ← () ├─ [0] VM::startPrank(0xf6b4e49bdc3bd8dbaad4414569c9afd6e1d9de5d) │ └─ ← () ├─ [22923] Fallback::contribute{value: 500000000000000}() │ └─ ← () ├─ [476] Fallback::contributions(0xf6b4e49bdc3bd8dbaad4414569c9afd6e1d9de5d) │ └─ ← 500000000000000 ├─ emit log_uint(: 999500000000000000) ├─ [2300] Fallback::fallback{value: 500000000000000}() │ └─ ← () └─ ← () Failed tests: [FAIL.",344
305,foundry-support.txt,"Reason: Revert(Reverted)] testContribute() (gas: 79087) Encountered a total of 1 failing tests, 0 tests succeeded ---------------- TEST CODE ----------------------- payable(address(0xf6B4E49bdc3bd8DBaAd4414569c9AfD6E1D9dE5D)).transfer(1 ether); cheats.startPrank(address(0xf6B4E49bdc3bd8DBaAd4414569c9AfD6E1D9dE5D)); ethernautFallback.contribute{value: 0.0005 ether}(); assertEq(ethernautFallback.contributions(address(0xf6B4E49bdc3bd8DBaAd4414569c9AfD6E1D9dE5D)), 0.0005 ether); emit log_uint(address(0xf6B4E49bdc3bd8DBaAd4414569c9AfD6E1D9dE5D).balance); payable(address(ethernautFallback)).transfer(0.0005 ether); assertEq(ethernautFallback.owner(), address(0xf6B4E49bdc3bd8DBaAd4414569c9AfD6E1D9dE5D)); ---------------- CONTRACT CODE ----------------- fallback() external payable { require(msg.value > 0 && contributions[msg.sender] > 0, ""requires must have messages""); owner = payable(msg.sender); // Type issues must be payable address } ok resolved all my previous issues, now getting: forge build compiling... Compiling 178 files with 0.8.10 Compilation finished successfully Error:  0: Compiler run failed  CompilerError: Stack too deep when compiling inline assembly: Variable headStart is 1 slot(s) too deep inside the stack.   0: Location: cli/src/cmd/mod.rs:91 it seems to still compile and give me artifacts though? Since you're using .transfer() your contract is only forwarding 2300 gas, which isn't enough to write to storage (setting owner), if you use .call() it will work as it forwards all available gas.",457
306,foundry-support.txt,"also your address becomes the owner while making the contribution itself, so the check after sending ether to fallback isn't required, just pointing out in case it causes some confusion Thanks again! tests passing now on ""the check after sending ether to fallback isn't required"" is that referring to this line assertEq(ethernautFallback.owner(), address(0xf6B4E49bdc3bd8DBaAd4414569c9AfD6E1D9dE5D)); you mentioned ""your address becomes the owner while making the contribution itself"" which i'm guessing is this code if(contributions[msg.sender] > contributions[owner]) { owner = payable(msg.sender); // Type issues must be payable address } i forgot to include the constructor code of the contract above constructor() public { owner = payable(msg.sender); // Type issues must be payable address contributions[msg.sender] = 1000 * (1 ether); } so you have to have contributed > 1000 eth to become owner ah my bad then no worries my bad for not including the constructor, really appreciate the help! no problem Added more info for expectEmit bug: https://github.com/gakonst/foundry/issues/668 I think the issue might be that we're clearing the whole expected emits vector here, but instead should clear only the ones that have been captured beyond the current depth https://github.com/gakonst/foundry/blob/cfc4ff01e56fda35a584c125a87f9959285dabf6/evm-adapters/src/sputnik/cheatcodes/cheatcode_handler.rs#L1590-L1593 Doing something like this might be a fix, but I don't understand the system well enough to be sure } else {  self.state_mut().expected_emits.retain(|expected| !expected.found); } It compiles the other contracts, and fails for the one with the stack too deep error Cc @brockelmore emit bug Hmm how can I debug this better ok this actually seems to be from the optimizer being turned on. sometimes the optimizer turned on prevents stack too deep errors, other times it causes it.",449
307,foundry-support.txt,"if it compiles with hardhat, can you make sure the optimizer settings match between hardhat config and foundry.toml? hardhat is the way to go, if it will have an interface especially unfortunately in general the solc compiler doesnt give you much information when it hits stack too deep so we are pretty limited based on that depends what you are comfortable with. I hate js enough that i would choose a bash script over js i like reproducible builds and deployments. I would say brownie is ideal If its simple just use remix ide what makes anything in foundry not achieve that libusb, unable to configure compiler output, a few things wen Yul PRs welcome :) i take it back: its feature complete, just for a smaller subset of use cases configurable output is also coming is it possible to provide a flag to bypass foundry and access solc directly this would ofc imply autodetect disabled Im curious not suggesting it fyi what should be included in the solc input? Same input but print solc output to stdout? no ser https://github.com/icetan/abi-to-dhall This will generate your bash scripts for your deployment. metadata and the abi should be outputs really passing cli args directly would be the best https://github.com/gakonst/foundry/issues/705#issuecomment-1036044044 Will make all of these cli flags as well Also just opened this which adds types for all supported options in solc output_selection https://github.com/gakonst/ethers-rs/pull/898 the build command should get an argument that accepts these and piped them to solc my real valentine 😍 🤣 😅 wdyt about „metadata“ being a separate option? For writing metadata.json now we can do FOUNDRY_DISABLE_TELEMTRY= 1 Right? sir i am just happy to have solidity binaries for mac ser we don't have that feature yes it did compile with hardhat let me try this Yeah ensuring the compiler settings are the same should provide so.e clarity here dont need to be feeding github copilot all this alpha thx 🙏 it worked, it was an optimizer thing thx Hi. I'm looking for some best practices here 🙏 I made some progress on my first dapp using Foundry and I've just installed Hardhat. So now I have two projects: Foundry + Hardhat.",491
308,foundry-support.txt,"What is the best way to combine these? I see that hh uses /contracts and /node_modules. I have some .sol libraries. Do people put these in /node_modules? I currently have them in /libraries. Can I keep .js libraries in /node_modules and .sol libraries in /libraries? have you checked the book? See the pinned message! keep the contracts/ directory Yep yep 👍 I understand that —hh sets /contracts and /node_modules. It just feels a little weird to put Solidity libraries in a /node_modules folder. Is that what people do? no thats dependencies contracts are the ones you are authoring Node_modules are ones you are using from someone else Ah. So if I write a library, I would put that in /contracts and not /libraries? 🤦‍♂️ Thank you 🙏 Still, /node_modules seems like it should be for ""Node modules"" 🤔 So now with Foundry + HH, there is significant overlap. We can build and test with both. Would it make sense to have —hh also set the out=artifacts/contracts? (If so, I could try a PR.) I'm hoping to get a work flow going where I build and test with Foundry and deploy locally with HH 🙏 That'd be very useful to have as docs / examples 👍 If I get it to work, I can try a PR to get things going, but would need some guidance. @hingeloss how is your workflow? Did you get the test folder thing worked out? I did not - tried various permutations but didn't find a setup which allowed both hardhat and forge tests to run separately. Happy to try configs / test your changes or anything else Cool Yep this was a bottleneck for me -- ds-test is not a npm package so if hardhat picks it up then it won't find the library Ok. Yeah. I'm trying to keep two separate folders: /node_modules for .js and /libraries for .sol Still trying to carry over my Foundry project over to a new HH project 😅 Hi, is there an equivalent of dapptools --rpc-url='localhost://something' (like a local ganache instance) in foundry? Best I found is --fork-url but it doesn't accept localhosts Hi @hingeloss .",483
309,foundry-support.txt,"Maybe I misunderstood what you are trying to do, but I managed to get a HH project to run forge test with the test contracts in /test and not /contracts/test. Maybe premature. Checking somethings. I accidentally had tests in both locations 🤦‍♂️ Interesting would you mind sharing the config? Also does hardhat test work with that setup? Sorry. False alarm. I'm having the same issue now. Will let you know if I make any progress. I'll try: 1. Getting forge to recognize /test 2. Getting HH to recognize /contracts/test I'd be fine either way. It wold be unfortunate to need /test _and_ /contracts/test. I think you want HH ideally to just ignore contracts/test I think it's reasonable to have two folders - one for js tests and another for solidity tests. I wonder if anyone has gotten dapptools and hh to work together? Is this what you ended up doing? Having two folders? I haven't gotten it to work with any permutation yet ha Oof! Is this the kind of thing you are seeing? % npx hardhat test Error HH411: The library @openzeppelin/contracts, imported from contracts/Pool.sol, is not installed. Try installing it using npm. For more info go to https://hardhat.org/HH411 or run Hardhat with --show-stack-traces Node isn't recognizing my remappings.txt Foundry Support Also looking into doing this to test deployment. 🙏 I guess I can give up and use npm to install the libraries and have remappings.txt point to those for forge. Hardhat doesn't respect remappings ever iiuc Probably the most pragmatic path Sounds good. I'll try that. Hopefully shouldn't be a worry once foundry releases deploymentn sometime next week Oh! Whazzat? Where can I read about deployment? https://t.me/foundry_support/2030 Nice 👍 It looks like ds-test is not on npm 🤔 I'll try installing using npm with github url Oof! No package.json 😅 I guess I need to treat it as if it was my own contract? 🤔 Ok.",448
310,foundry-support.txt,"I am able to run both forge test and npx hardhat test in the same project now 🙏😅 (not with the same contracts yet though: forge is testing one contract and HH is test another in the same project) forge has pretty good autodetction of remappings but you can specify them in the toml configuration file Maybe we could symlink so it's only one truth file? Ye forge does but not hardhat 😢 Yeah, but since HH doesn't, you can't use remappings in a project you want to run both forge and HH tests unless all your remappings can point to the respective file in node_modules 🤔 ^ which is fine so long as all your files are in node_modules; the challenge is when packages such as ds-test aren't Zactly Actually thinking about it more, having symlinks could work, so long as you're willing to symlink each source file I had to put my ds-test inside contracts to get it to work with both. Hmm could alternatively symlink lib/ds-test into contracts/ For libraries that can go inside node_modules, you can use remapping to point to those to get forge test to work, but for libraries that can't go in node_modules, I had to import via relative path. So you would have to do that for each installed library, but that allows you to keep the sub module setup with clean forge update methodology Am afk for a while so can't test though. The sun is out for the first time in a while Does cast gas-price just return the base fee? it returns eth_gasPrice, after 1559 I believe that’s basefee + estimated min priority fee you can see it’s not the same as basefee Oh of course. Don't know why I didn't notice that.",364
311,foundry-support.txt,"I wanted a piece of code to just run once per block (at most). What I did was store the block number and then when a function is called (a swap), I check if the current block number matches the stored block number. I decided against this because it means whoever calls that function first pays more gas. Then I added some logic so that person pays no protocol fees to incentivize the miner to be the first, but that felt too complicated and I went another way. what does your config look like now? Hi @hingeloss Sure. I didn't change any config on the Hardhat side (other than Solidity version) so I got it to work by tweaking the Foundry side a bit. General concepts: - When possible, use npm for dependencies, e.g. openzeppelin, so they go in /node_modules - To get those dependencies to work on the Foundry side, put the respective remappings in remappings.txt - For dependencies that cannot be obtained using npm, e.g. ds-test, put them in your /contracts folder and import them using relative paths, e.g. import './libraries/ds-test'. This ensure both Found and HH can see them. - Change the out path to /artifacts/contracts so that both Foundry and Hardhat put the build in the same location. - Change the src path to /contracts - Hardhat tests go in /test and Foundry tests go in /contracts/test and change test to /contracts/test. @openzeppelin/=node_modules/@openzeppelin/ hardhat/=node_modules/hardhat/ remappings.txt 👆 very nice, that makes sense! does HH compile everything in /contracts/libraries as well then? nice! you got a setup that works with both 👍😊 It compiles but you need the third bullet, i.e. import you libraries in /contracts/libraries using relative paths Deploys too 👍🐣 wanna push a repo as an example Sure 👍 It'll take me a little time since I'm still learning all this, but will drop a Github link. ye np Btw, if anyone is interested in hacking on some of this AMM stuff with me for Eth Denver, I'm still working solo but hoping to form a team. I was on a team, but we went different directions.",476
312,foundry-support.txt,"I'm fairly technical (nothing compared to you guys), but more of a quant researcher / entrepreneur who can write (bad) code 🤓 Yeah super lit, thanks for figuring this out! Glad I can help. I try not to get into too much debt by only asking questions 😅 Happy to help any time I can 🙏 Let me know if this works: https://github.com/EricForgy/foundry-hardhat-sample cool so my extension on this, would just be to symlink the lib folder to contracts/lib ; this allows you to keep everything in there and get forge update which is just ln -s ""$PWD/lib/"" ""$PWD/contracts/lib"" can confirm that this enables us to run hardhat and foundry tests together, so everything works is there a way to get a view into calldata split by words(32 bytes) in cast? like so MethodID: 0x23b872dd [0]: 000000000000000000000000f4b743bd0e9867729874603402f72cfdfb85e0da [1]: 00000000000000000000000058b5cdd4e7eba4e17f8b229a2d37831cd22795f1 [2]: 0000000000000000000000000000000000000000000000000000000000002500 don’t think cast has that ability but i could be wrong will open an issue and see if there's interest on adding this Ya should be easy to do so quick question, is there a way to deploy contract bytecode using cast? my understanding is that you send it as calldata with the to address as null Ya cast send or forge create cast send with TO is complaining, how do I pass null? Seth send --create works Without* Maybe it's unsupported. I haven't tried it Wanna give a shot at a PR? Sure thing 👍 Resharing my question here from main group: Mehran Hydary, [Feb 13, 2022 at 12:29:43 PM]: Hi there! I'm new to using Foundry / Forge.",443
313,foundry-support.txt,Need some help setting up my tests In my setup function I'm initializing my contract Do I need to initialize an account with ETH if I'm testing payable functions? How would I go about doing that? the test contract is loaded with some eth by default iirc tho u can use the deal cheatcode to get more or give some to other contracts Oh hmm - when I try to deposit (with myBank.deposit{value: x}; ) with the loaded account in my test I'm running into this error: [FAIL.,106
314,foundry-support.txt,"am i doing s omething wrong? Seems fine on Remix  function withdraw(uint _amount) public {  require(balances[msg.sender] >= _amount);  (bool success, ) = msg.sender.call{value: _amount}("""");  require(success, ""Failed to send Ether"");  balances[msg.sender] -= _amount; }   My test:  function testWithdraw(uint x) public {   // Should be the same account   emit log_uint(myBank.getBalance());   myBank.deposit{value: x % 5}();   myBank.withdraw(x % 5);   assertEq(0, myBank.getBalance());  } where does it fail? use forge t -vvvv I guess when it hits the fallback i don't have one defined in my contract yea so you need a fallback! On remix I can execute the withdraw without one yea because yore executing from an EOA Ooh I see hm wierd done that says number expected, anyway not sure what it is will digg The account in Foundry isn't an EOA? no it’s a contract you’re making the call from inside a smart contract I see I see Thank you So I added  fallback() external payable {  payable(msg.sender).transfer(msg.value); } Am I declaring the fallback correctly? you need a receive() function https://blog.soliditylang.org/2020/03/26/fallback-receive-split/#:~:text=receive()%20external%20payable%20%E2%80%94%20for,not%20even%20the%20receive%20function). Would I write these in my test contract? yup cast send --rpc-url=${process.env['RPC_URL']} --private-key=${process.env['PRIVATE_KEY']} contractAddress mintTo(address) arg getting “number expected"" arg is simply an EOA “0x1234”? pls ensure that you’re passing it as string an dnot as hex number or something yeah its a string oke nvm got it working the func signature had tro be set in quotes for it to work Yes due to the parentheses 👍 is there a workaround for CompilerError: Stack too deep, try removing local variables.",458
315,foundry-support.txt,"in tests? same strategies as with normal solidity, manual scoping, and breaking things into smaller functions Hey was wondering if theres a way to read a specific slot in another contracts storage from my foundry test contract this relates to the ethernaut vault level where a password is stored in a private variable at slot 1, with ethers js you can do eoa.provider!.getStorageAt(challenge.address, 1) console.log(`password = ${password} ""${Buffer.from(password.slice(2), `hex`)}""`) not sure if this possible based on this stackexchange post, I've played around with the record and accesses cheatcodes by they only have the slot number the data was written to rather than the actual data that has been written https://ethereum.stackexchange.com/questions/49422/reading-storage-from-another-contract/49428 Any ideas on a work around? vm.load cheatcode does exactly that Is there any updates on this one: https://github.com/gakonst/foundry/issues/668 it's quite a deal breaker. If you have any clues I may also try to solve it. I haven't tried it yet - @brockelmore wdyt is the gasometer available in all builds ? it does not require a flag to build correct? Thanks all working with vm load Yeah follow the instructions on pinned message and finally got the upgrade! Now get this error message [FAIL. Reason: Revert(Reverted)], still confused though. (checking my code… It’s weird that no error message is threw and hard to debug… Does this account have ether? You need to vm.deal To add ether to that address there seems a known issue https://github.com/gakonst/foundry/issues/476 Yeah this is hard to give a good error for But you solve it by using vm.deal Your account has no ether yeah, vm.deal did work, thx! the deployer address seems not payable, any workaround? i see, the deployer is the test contract ( address(this) ).",417
316,foundry-support.txt,"Yeah, so u need a fallback function i am looking at if any cheatcode can make contract/deployer to another address if you mean from setup, you can use startPrank or prank if you mean the main test contract itself you can use https://onbjerg.github.io/foundry-book/reference/config.html#sender prank on setUp() works, but makes every deployer-only calls prank first, more redundant code you can use startPrank for consecutive calls followed by stopPrank yeah that’s another solution didn’t work. guess i have to go with the first method, thanks guys though. would someone mind sanity checking me on this? i went to change over my testFail syntax on a couple tests to the specific revert strings and immediately ran into an issue. Here is a demo repo: https://github.com/stevennevins/rev-test/blob/main/src/test/Contract.t.sol expectRevert requires it to be a *call*, a local jump to another part of the same contract won’t work u could do vmTest(address(this)).vert() and it should pass ahhh makes sense Are there any plans to add support for yul? Or is there already support, not sure if I missed that.",247
317,foundry-support.txt,"what should the function signature be passed to cast --calldata-decode for functions that take struct as arguments? struct SomeStruct {  uint256 some_uint;  int256 some_int;  bytes data; }  function something(SomeStruct memory some_struct) external I tried something((uint256,int256,bytes)) but got error: could not convert something((uint256,int256,bytes)) to function Hey wondering if anyone can think of a clean way to get around this modifier in ethernaut GatekeeperOne with foundry solidity tests heres the modifier, i need to provide an amount of gas that at this call will always be a factor of 8191 modifier gateTwo() { require(gasleft().mod(8191) == 0); _; } in hardhat you can brute force it with // use this to bruteforce gas usage const MOD = 8191 const gasToUse = 800000 for(let i = 0; i < MOD; i++) { console.log(`testing ${gasToUse + i}`) try { tx = await attacker.attack(gateKey, gasToUse + i, { gasLimit: 950000 }); break; } catch {} } }); but if i hit a revert in solidity the tests fail, alternatively you can use something like HEVM or Remix debugger to jump through the opcodes, see what the remaining gas is at that point and do some manual adjustments ideally would have something in code that always works rather than a hardcoded value any ideas? Thanks @brockelmore can we add a base contract to forge-std that will have a vm var set to the VM that can be inherited in test cases? Is there a way to determine if a given repo is or is not a forge repo? I have mistakenly issued forge install in other terminals and ended up with the git submodule getting installed elsewhere.",379
318,foundry-support.txt,"Maybe worth preventing that from happening on any arbitrary git repos? vm.expectRevert? You can use solidity’s try and catch this is already the case in `DSTest`Ι τηινκ? hmm not sure how we’d determine that reliably? maybe like hardhat does, it won't work unless there's a hardhat.config.js? We could do that altho not sure it's reliable @brockelmore will there be a feature extension for gas-report to also account base tx and calldata gas? Something like --gas-report full why do you want that? we strip calldata/basetx from the test transaction no way to do it without cloning first using git at lesst buuuut maybe a way @gakonst would be good to see the actual gas cost when it will be called. I know the reasoning behind stripping but at least optionally showing the full cost would be nice. how do you code big calldata for call / delegatecalls into solidity? without abi.encodeX context: trying to write a test which involves checking eip712 sigs, but new bytes(0x...) is too big for uint256 Hey just wanted to know if foundry supports mainnet forking and could help debug mainnet transactions line by line if I have the source code but I cannot verify it, so using my local source code can the debugger debug and old transactions showing inputs and output line by line like tenderly or anything remotely similar —fork-url <end-point> So forking is possible but is there an interactive debugger which can debug a tx line by line using the source code stored on my local laptop? A live TX no But we want to do it If You can open an issue with your ideal features I can take a stab Is there any tool currently that can do that ? Will do. I think Seth but has a few steps, @msolomon4 had a guide somewhere on it If anyof you could refer me to it would help a ton, also will open the issue so this could be done via foundry too, it's pretty clean and easier to grasp.",431
319,foundry-support.txt,"here’s a thread with some details: https://twitter.com/msolomon44/status/1443581030493929476 the summary is use seth bundle-source addressHere > source.json then debug with seth run-tx txHashHere --source source.json --debug (or use --trace instead of debug) the main downside is that only lets you bundle source from a single contract, if there’s multiple contracts you basically need to merge the bundle outputs and it gets kinda hacky/difficult unfortunately That sucks there are 3 contracts involved, In my case. ah, bummer.",120
320,foundry-support.txt,"you could try asking in https://dapphub.chat/ if anyone has a script/simple way to merge them I think only twitter login works there I'll implement this in cast run Just been a bit low on time awesome, yea I’m excited for this having it automatically fetch source/ABIs from etherscan for all touched addresses would be so useful yea we need that for normal tracing against mainnet too and maybe some --label flags to name addresses in forge you mean? yea agreed if you have the source locally the debugger should recognize it assuming the compiled source is close to (basically matching) the runtime code of the called contract but it doesnt support live tx, you would have to recreate it basically in a forge run call So is it possible I fork the mainnet state a block before and recreate that tx in foundry ? That can work for me too If that allows me line by line debugging with inputs and outputs on the recreated tx How do we send call data using forge run? @aaraNSOL see this quoted message for forge run syntax, but yea it sounds like this would be a good workaround i think we just want cast run and cast send --simulate which would both run against local or forked state cast run <txhash>` to re-run a real tx, cast send <…> —simulate to dry-run a new one yea that sounds good to me —trace and —debug modes on both? ye exactly perfect 👌 is there a way to pin block for forge test --fork-url 'http://localhost:8545' --fork-block-number <FORK_BLOCK_NUMBER> :DDDDD I'm trying to have a Evm from evm-adapters inside a struct, but i'm not sure how to please the rust type/borrow checker i have no clue what i am doing just make it generic in the struct with no bounds but in the impl of the struct add the trait bounds how would i do that ..? im really quite new to rust i would read guides online there are hundreds.",413
321,foundry-support.txt,"read the rust book first and foremost you will lose your mind unless you read the rust book i did this about a month embrace the pain Yeah the rust book is absolutely necessary So I just do a forge init -> add my contracts-> add env and rpc variables -> fork mainnet ->type cast run <txhash> --debug? I have 2 confusions, 1) is there a way to add my source code so I could see it in the debugger line by liner, or that happens automatically 2) after forking do I interact with the forked state via a ts script, get the tx hash and do cast run <txhash> --debug ? all hail king rust is it possible to get a flag disabling forge git or a way i can define folder structures ie wen monorepo support What's the dir structure you're having a problem with? We should support that better Has anyone got a working cli command where I can cargo run... and point to a different dir for my smart contracts? I'm trying to step through forge with a debugger during a contract deployment. cargo run --bin forge test --root ~/Code/jbowen93/solidity/hello_foundry isn't working for me Even though forge test from /home/jskybowen/Code/jbowen93/solidity/hello_foundry works it might not be working properly, i have not tested it and i think not enough ppl have tried forge run so havent had much iteration on it Ah alright.",303
322,foundry-support.txt,"Ya looking through the code i don't think the root flag is going anywhere FWIW this is for build and test as well are you on latest? Looks like not quite, but only changes to Cargo.lock pulled ah mhm sec checking forge t —root $DIR works for me forge b too forge clean too Hmmm Bet I'm calling wrong forge binary Yup that was it! Thanks so much! Hello, is it ever ok for forge to crash with panic or is it something that should be handled? I am getting out of bounds error when expectEmit has similar but different signature can u open a repro issue? it shouldnt for sure Yes, I have it ready Hi all, is there a way to deploy bytecode like how seth send --create works? Not yet afaik, will add pr soon how does one debug why expectEmit is erroneously passing? I'm running expectEmit(true, true, true, true) and it seems like regardless what I emit it always passes the subsequent line. I have the same issue when calling address.call() Figured it out. New error after running forgeup. Seems like bytes or bytes[] objects don't get compared properly when using expectEmit, even though -vvv shows the exact same bytes data What’s the difference between cast —abi-decode AND cast —calldata-decode Sorry if my question is unclear. When should I use —abi-decode ? Don’t know what’s ABI encoded hex output data Oh good catch, wanna open an issue and we can track / fix? Or a PR if you got a handle.on how to fix? Calldata for input data, abi decode for output data The setup : A function order that *immediately* checks that msg.value is correct [require]. I use prank and then follow with a call to order with a purposefully wrong msg.value. It reverts without reason, when it should revert with the ""WRONG_PRICE"" reason. Now, if I remove the prank call and proceed just as above, it ... reverts with the right reason this time.",422
323,foundry-support.txt,"Here's the trace : https://pastebin.com/djVMgjBR Idk if I am just having a brainlet moment 🤷 What’s an example of output data in a transaction? Whatever the function returns It can be output data in an internal call (eg when tracing) or the return value in a view call can you try step 3 in the pinned message? nice 🙂 i think —legacy might not even be required? isn’t legacy detection done automatically now? 👍 excellent That's a new one 😱What version are you on and can you try running forge with RUST_LOG=trace? in your terminal prepend the forge command with RUST_LOG=trace RUST_LOG=ethers=trace forge build oh maybe you’re tryign to download 0.8.12 and it’s stuck? checking.. i'd think so, alternatively do you have disk space left? it works for me on latest nightly in a few repos, same for integration tests on CI should be enough yeah it also works for me on latest nightly which is weird i even nuked ~/.svm the RUST_LOG=trace should give us some insight into where u are stuck this command and pls share as a github gist / pastebin so we dont clutter this chat its an environment variable, you can prepend any number of them to any command :) would recommend reading up on them, they're pretty neat! weird, maybe it was a cache issue? try building with --force next time (like forge build --force) i have some pretty long test files too it shouldn't matter too much - when you get stuck does it say something like ""compiling...",336
324,foundry-support.txt,"I was trying to install pbshgthm/blacksmith and pbshgthm thinks said I have an old version and to run foundryup so when i run foundryup it seems like it works but when i check forge --V it always comes back with foundry-cli 0.1.0 Please let me know what other infornamtion I can provide slash should I try reinstalling foundry? slash for a possibly another clue, someone recently suspected i might have a weird install of rust... 😕 https://github.com/pbshgthm/blacksmith/issues/1 Try running curl -L https://foundry.paradigm.xyz | bash This should update foundryup, then you can run foundryup to update forge and cast I did that but I'll do it again. btw im on apple silicon, does it matter if im in a rosetta terminal or not for foundry?!? I'm on M1 too, works fine for me does forge test run fine? from previous discussions, it looks like artifact field in the `solidity-files-cache.json` doesn't looks like this, but it should ""artifacts"": {   ""ContractTest"": {   ""0.8.10+commit.fc410830.Darwin.appleclang"": ""Contract.t.sol/ContractTest.json""   }  } It was missing the file path in your case forge test does indeed work and i use it all th time yeah my artifcats is an arr with the string ""ContractTest"" -- you're not suggesting i manually update that are you? what do you think of my idea of reinstalling foundry? how do u even uninstall I think the pinned message has the commands for reinstalling forge/cast tx @saucepoint @pbshgthm Reinstall did it! Blacksmit installed now too.",378
325,foundry-support.txt,"Thx for ur help!! Great! happy forging Possible solang + regex miss checking Is this in Monorepo? @Lightcycle saw you were trying to get 0.5.0 uniswap contracts compiled in a 0.8.10 test file - i managed to get the contract deployed using (theres no args in the constructor) bytes memory bytecode = abi.encodePacked(vm.getCode(""./src/AlienCodex/AlienCodexFactory.json"")); address addr; assembly { addr := create(0, add(bytecode, 0x20), mload(bytecode)) } Then was able to test a call using event Response(bool success, bytes data); (success, data) = addr.call(abi.encodeWithSignature(""owner()"")); emit Response(success, data); were you able to cast the address to a contract type or did you also have to make all subsequent calls via address.call with the function signatures? i've also got other contracts that interact with this address and expects it in the contract type as soon as i try to import the contract type ie 'import ""../AlienCodex/AlienCodexFactory.sol""' im back to getting the solc incompatibility error Discovered incompatible solidity versions in following Thanks for any help yes We should do some more testing with workspace Monorepos because the libs are hoisted at the top level node modules not always :S what does the command look like when trying to downgrade foundry/forge to a specific build? i see there's foundryup -v $VERSION for reference i'm thinking about reverting this build: 8d84701 2022-02-01T00:27:09.328113527+00:00 why do you need to revert to this build? we have got 17 more days of builds released 😄 when running forge clean && forge test i'm seeing a few logging errors that look like: Unable to resolve imported file: ""src/MyERC20.sol"" i think the 02-01 build is what i had previously (and didnt see the error), recently updated to the most recent build with foundryup the weird thing is clean+test have the tests still passing, but im concerned with the error.",454
326,foundry-support.txt,"thinking it also be the root cause of trying to run tests that rely on multiple different solc versions ah I think i solved it, when importing src/MyERC20.sol in a test file, the error no longer occurs when specifying the full path to MyERC20.sol i.e. in MyERC20.t.sol: import ""/home/saucy/full_path_to/src/MyERC20.sol""; Try importing without the ""src"" no need for full path (in MyERC20.t.sol) both import ""./MyERC20.sol""; and import ""MyERC20.sol""; says compiler failed because file was not found maybe you need to do import “../MyERC20.sol? ah yes, that works too 👍 yes that’s the right way to do it^ gotcha, so i'm guessing that a recent build changed how import src/MyERC20.sol behaved. will move to relative pathing going forward 😁 yes relative pathin always better we’ll add the src/MyERc20 support soon it seemed to work fine in the 02-01 build 🤷 is there a trick to getting forge remappings to work with openzeppelin? I currently have ""'openzeppelin=lib/openzeppelin-contracts/"" in my remappings, which seems fine, but it seems to be adding an extra contracts/ when resolving and forge seems to be adding it's own remapping so maybe that's the issue 'openzeppelin=lib/openzeppelin-contracts/', 'openzeppelin-contracts/=lib/openzeppelin-contracts/contracts/', This was just fixed in a PR ah awesome, thanks @gakonst Gonna have a nightly for it in a sec Next 15m I thought I was going mad and doing something stupid does anyone have guidance on implementing tests that require different solidity versions? for example, I'm trying to test a contract (0.8.11) that handles Sushi LP tokens (SLPs / fork of UniswapV2Pair).",407
327,foundry-support.txt,"However the SLP contract is pinned strictly to =0.6.12 Did u use foundry.toml Someone rewrote uniV2 to v0.8.0 yeah, i havent changed anything other than the remapping repo? if your just using it as an interface it shouldn’t matter private at the moment, i can create a dummy repo i dont know if i can just get away with an interface, I need to test how the SLP rebalances affects the vault contract Ok this seems to happen frequently enough we should make a guide for it. Added to my list The vm.getCode cheatcode addresses this ill look there, thanks! ⛄️ Alright, issue was very stupid, I forgot random addys aren't funded, so obviously fails when you try to transfer eth 🤷, in case it helps someone else Ok so I’m still having an issue using “forge run” if someone can help me If the contract has constructor arguments just reverts… Do I just need to rewrite the contract and remove these args from the constructor if I wan to use this feature?? Ya no constructor, just pull everything in the run function What do u use it for? Debug? is there any way I can use a bytes encoded array as an ffi argument? inputs[2] is returning non utf-8 characters Should be possible yeah https://github.com/gakonst/lootloose/blob/master/scripts/metadata.js Here's the script I used https://github.com/gakonst/lootloose/blob/master/src/test/LootLooseMeta.t.sol#L100 it's not working...",329
328,foundry-support.txt,"nul byte found in provided data you are sending a string there gm, i cant deploy the Marketplace contract and im not sure what the error means Oh can you share the code? sure, https://github.com/zangGallery/contracts https://github.com/zangGallery/contracts/blob/main/src/Marketplace.sol#L3 can you remove the node modules part here? Make the import start from @openzeppelin Wait are you on latest? On CI it seems to work yep just run foundryup i do that because of this settings.json deploying the ZangNFT contract worked, just the Marketplace doesn't does the marketplace use libraries? and require lib linking? looks like yes - you need to deploy the library first, then pass it in as a library in foundry.toml our error should be better tho hmm wonder how we can detect that it’s pretty easy, if we don’t have bytecode and link references are > 0 then we can report a better error i dont get what’s different than the ZangNFT contract which works fine without diving deep into ur contracts most likely things like the base64 contract is an “internal” library, where there are no public functions in the library contract. when that is the case the compiler inlines it into the contract itself when there is a public function in a library contract it’s treated as tho it will be a deployed contract with a delegatecall Yes. Ended up finding some msg earlier that basically solved my problem which is to debug it as a test basically the Marketplace contract does not use libraries and none of the inherited contracts do either? yea it doesnt mhm u can check the Marketplace.json and scroll all the way down and check if there is a link references flag no link references weird. i can try to take a look later. does the bytecode.object start with 0x or something like 60 0x60 huh. so that to me says create is grabbing the wrong contract or something do u have an interface that has the same name? no i have an interface to another contract weird sorry about that.",421
329,foundry-support.txt,"i can try to take a look later 2 quick questions does anyone know a simple way to left pad an address for a byte32 currently doing this bytes20 hackerAddress = bytes20(uint160(tx.origin)); bytes12 leftPadding = bytes12(0); bytes32 leftPaddedAddress = bytes32(bytes.concat(leftPadding, hackerAddress)); which seems a bit long winded second question is to do with bytes extraction once i've padded the address i have 0x00000000000000000000000000a329c0648769a73afac7f9381e08fb43dbea72 is there a simple way to take the last 20 bytes of a bytes32? ie to get the address back using this currently - data is the byte32 above address(uint160(bytes20(uint160(uint256(bytes32(data)) << 0)))) for context this is for the ethernaut x foundry alienCodex level thanks for any help Hey man, can you share it in a gist? Would be easier to read + chat would be cleaner! Wouldn’t abi.encode accomplish this? hey sure it's this file https://github.com/ciaranmcveigh5/ethernaut-x-foundry/blob/main/src/test/AlienCodex.t.sol lines 48-51 for the left padded address lines 63-66 for the last 20 bytes of a bytes32 yep looks like this does the trick for the left padding of an address not sure what i was using or why i didn't find this - remember the padding being on the right side thanks thats much easier! Hello, Is there a way to deploy contracts using remix? I don't want to type my private key as shown [here](https://onbjerg.github.io/foundry-book/forge/deploying.html#deploying) when i build it says ""Compiler run successful (with warnings)"" but no warnings are printed out, is there a way i can see them? -h doesnt seem to show a verbose flag Hi all. Foundry is awesome, tests are lightning fast! Slight teething issue: when I run forge test occasionally I get no test output, like this. forge clean doesn’t seem to help.",449
330,foundry-support.txt,"Unclear what causes/fixes the problem so far hmm do u have a repo we can use to diagnose? I had this issue when I accidentally set my test contact to abstract (trial and error 😅) Huh, thanks! That clue was what I needed. I had a child contract Foo that’s supposed to inherit from Bar . It had a typo in the inheritance: contract Foo is Bur. Corrected it and tests run and show output. I guess it was failing silently and not bubbling the error up. if you're looking to test locally, the hardhat local node gives you a private key if you want to deploy to mainnet or a testnet, just make a burner/one time address Right maybe we're not surfacing an error They should be printed. Possible there's a bug I'll investigate Thanks! Just found the --ledger flag, using that to sign deployment txns for now There's --interactive Which doesn't show the private key when you paste it in Meta question: Would it be cool to enable ""Reactions""? Sometimes I'd like to acknowledge a comment, but don't want to spam the channel 😅 Done hey does anyone know if forge has a debug function similar to what dapptools has, where it pulls up unit tests then uses hevm to jump through the executing opcodes when you run ""dapp debug"" had a look at the forge cli --help found --debug under the test command but it doesn't seem to be doing the above thanks trying to get exactInputSingle working, but there's no revert error - hard to debug, contract is approved for transferring DAI Yea forge run --debug Like this im on a repo with forge, for some reason the tests dont run but only compilation runs it works for a colleague are there some locan env variables that i may have set that can prevent tests from running? Maybe you're not on Latest? Check pinned msgs to check your version Shouldn't be thx will make sure its none of that thanks for the info, i ran forge run ./src/test/Fallback.t.sol -t ""testFallbackHack()"" --debug im getting The application panicked (crashed).",441
331,foundry-support.txt,"Message: No abi for contract Location: cli/src/cmd/run.rs:97 i've ran forge build so the abi is in the .json build file in /out, is there an additional step i'm missing? i've ran foundryup to make sure im on the latest version forge 0.1.0 (26b2256 2022-02-20T00:35:20.745814+00:00) thanks for all the responses they're really appreciated! Did you end up getting it working Yeah I did actualy, the documentation was outdated. SwapRouter uses the IV3SwapRouter interface not ISwapRouter gm 🌞 any update on this? gm sorry was at ethdenver so haven’t been around much. i’ll be more firmly online later today np! thank you Seems so yes. FYI, it also happens when I run a single test with the —match-test flag and have a typo in the test name Can you deploy to testnet with foundry? Yeah just set your RPC to testnet stupid question incoming: I forgot how to mark test to be expected to fail on ds-test. google is failing me I'm sure there was a keyword I add to the test function name to mark it as such testFail 🤝 Don't see this in the docs https://onbjerg.github.io/foundry-book/forge/deploying.html#deploying ? Gas report when there's linked library still shows deployment size as full deployment instead of just the contract itself. Is there a workaround to show just deployment size of the contract itself? does anyone have an idea why keccak256(type(UniswapV2Pair).creationCode produces a different hash than what's here https://github.com/sushiswap/sushiswap/blob/canary/contracts/uniswapv2/libraries/UniswapV2Library.sol#L26 nvm — looks like dapptools also had to work around the hardcoded value https://github.com/dapp-org/uniswap-v2-test/blob/master/test Maybe different compiler or optimizer runs? Ah probably a bug - cc @brockelmore, can you open an issue @ufukaltinok? Overtime my tests start to randomly fail.",458
332,foundry-support.txt,"Has anyone else experienced this issue? However when I reclone and continue it works again Not sure - what do you mean randomly fail? if those tests contain inputs, maybe it fails for some specific range of values? So I have s bunch of test that work as soon as I clone the repo and use forge. However over time they keep getting subtraction overflow errors for Jo reason even if I don't change a single line of code. Eventually after running forge test and clean tests never work I also noticed that using foundryup kind of resets this and causes the tests to work again I have no clue what's going on. Initially I thought it was my rpc acting up but I think it might be foundry This is super weird, which repo are you cloning? Or any way I can try it out locally? What are you trying to do? r u on mac? Perhaps it would be helpful to send a link to such a test that succeed at first and then fails have you tried running with backtrace? Perhaps it shows as at which point it fails is there a way to exclude certain folders from the forge build commad im playing with this idea where a contract accepts SLP / UniV2 LPs are distributes the fee revenue ideally i get Uniswap contracts (Factory, Pair, Router) 'deployed' in the tests so I can test fee distribution.",276
333,foundry-support.txt,"i got them to exist in the tests, but the hard coded value in sushiswaps is causing an error when trying to open an LP (add liquidity) UniV2 LPs *and distributes even UniV2's hardcoded value is different than Sushi's so probably not something i can work around besides forking Sushi's contracts by hardcoded do you mean the create2 salt? ahh nvm just read ur msg are you running with the same optimizer runs? 🤔 i dont think so — i had my friend run the same logic and he produced a different hash for keccak256(type(UniswapV2Pair).creationCode) when I replace the sushiswap hardcode with my hash, the addresses produced by factory.createPair() and library.pairFor() match as expected i think im going to work around it with mainnet/testnet forking i'd assume the init code hash might be different for different optimizer runs try running with the same number of runs and see if the hashes match yeah i was thinking it might be init code hash related, not too much info about it for forge so i didnt bother to dive too deep me and my friend have the exact same forge settings/config so i dont think its optimizer runs related is it compiling with the same solc version? yes does forge verify-contract works with non-ethereum chain like polygon / mumbai? having trouble setting up so was wondering if it's my issue should work now does it automatically fetch the right etherscan url? for mumbai, i'd just need to include --chain-id 80001 i'd assume? actually it works! weird that it didn't work earlier, i think i was setting up the cli command incorrectly actually, it's failing. mhm, do the optimization setting get extracted from foundry.toml? for forge verify-contract. forge flatten output seems a little weird. is the import keyword used correctly? this should be fixed in latest, it’ll get released later tonight sg.",406
334,foundry-support.txt,"does foundryup support build from main? yeah foundryup -b master sick thx Best practices question: Do you bother deploying to a local testnet once you build / test with Foundry or do you deploy directly to a public testnet? Local first (of course) 😅 But at what point do you try a public testnet? Should that be reserved until things are nearly entirely worked out or should we not be too shy to deploy stuff to a public testnet? 🤔 (Sorry, I'm just getting close to being able to deploy my first dapp I've been working on for a few months and getting a little excited 😅) I think a public testnet is very useful for seeing how it connects to any FE, ideally with users poking around and trying ot break it Local testnet is particularly useful when added to ci, but I think we are still working on our in-house node solution I wanted to try out Truffle Dashboard and deploy with Foundry: https://trufflesuite.com/blog/introducing-truffle-dashboard/ Attempting to deploy to the Truffle Dashboard RPC forge create MyToken --rpc-url http://localhost:24012/rpc gives error: 0: error accessing local wallet, did you set a private key, mnemonic or keystore? Run `cast send --help or forge create --help and use the corresponding CLI flag to set your key via --private-key, --mnemonic-path, --interactive, --trezor or --ledger. Alternatively, if you're using a local node with unlocked accounts, set the ETH_FROM environment variable to the address of the account you want to use Can anyone suggest the right syntax? The error says it all! Set your private key or set ETH_FROM I had done that: export ETH_FROM=0x77737a65C296012C67F8c7f656d1Df81827c9541 gm 😂 okay i am *actually* looking at this now. im sorry it took so long is the address i put in for the constructor arg important? nope can I verify a contract on fantom scan? Yes Should be how should I do it? ETH_RPC_URL=fantom rpc ? what's the format for <path>:<contractname>? is the path absolute or relative? Relative should work Yes the path is correct and the contract name too Could you try ""./src"" instead of ""src""? Didn't work...",496
335,foundry-support.txt,"Can you open an issue? I'll debug @naomsa did you build the contract first? afaik forge verify-contract does not build for you hi, hope everyone is doing well, i was just wondering, does this test seem idiomatic? is there anything you would change about it? function test_BuyPublic() public sale_open {  uint256 privateKey = 0x01;  address buyer = address(0xB0B);  (uint8 v, bytes32 r, bytes32 s) = cheats.sign(   privateKey,   keccak256(    abi.encodePacked(     ""\x19Ethereum Signed Message:\n32"",     keccak256(abi.encode(buyer))    )   )  );  cheats.deal(buyer, 1 ether);  cheats.prank(buyer, buyer);  sale.buy{value: 0.065 ether}(Sale.Signature(r, s, v), 1);  assertEq(token.balanceOf(buyer), 1); } the prank call is required because the target contract asserts for tx.origin == msg.sender why do you have a modified on a test? but ye this looks like a good test hard to exactly tell cuz i’m on mobile but you seem to have a v good grasp of cheatcodes you might want to do more asserts if there are other state changes i generally try to check all state variable changes when i am writing a test (as well as writing tests for requires/reverts) you can also add vm.label(buyer, “Buyer”) which will make ur traces show the buyer for clarity, i have these modifiers defined in my test contract, i thought having them there would be more readable because it's hard to map the numbers 0, 1, 2 to a respective sale state, is that fine?  modifier sale_closed() {   sale.setSaleState(0);   _;  }  modifier sale_restricted() {   sale.setSaleState(1);   _;  }  modifier sale_open() {   sale.setSaleState(2);   _;  } ah ye that makes sense it's for an erc721 mint so i don't think i'd have many state changes to assert for but i will check anyway tyvm for your help ye i go line by line of the actual code and make sure i cover each state change and revert hey guys, small question.",499
336,foundry-support.txt,"I was going through the foundry book, and when I reached the fuzzing test section, I decided to give it a go on my computer. For some weird reason in my fuzzing test, if I do: function testWithdraw(uint96 amount) the fuzzer will try 2 96 as one of the values for amount, which exceeds 2 96 - 1 Is this expected? 2^96, 2^96 - 1* this was a bug in a very old version but it’s fixed now—check steps 2 and 3 of the pinned message to make sure you’re on the latest version completely missed the pinned message, removing cast and forge and reinstalling worked like charm, thank you very much no problem! try rpc 127.0.0.1 without using http do you have only the dashboard running or the dashboard And the provider too? truffle dashboard works by having a local provider (message bus) proxying a socket connection to the frontend. The dashboard itself has uses this provider like an 1193 provider That didn't work $ forge create Heart --rpc-url 127.0.0.1 compiling... no files changed, compilation skipped. Error: 0: relative URL without a base Location: /rustc/db9d1b20bba1968c1ec1fc49616d4742c1725b4b/library/core/src/result.rs:1911 Only the dashboard with the port Sorry port too with ip yes you have go run the server too but i think still it wouldn’t work as rpc tx is not the same as an ethersjs tx trying to bypass provider that is. The provider would change the format to be compatible. ie cant interface with dashboard directly without dashboard provider I'm just going to let this one go for the moment then.",372
337,foundry-support.txt,"hey got a weird issue on forge test where selfdestruct doesn't seem to be working or do anything (this is for the motorbike ethernaut challenge) I have these 2 functions in a contract function greetMe() public { emit Returny(0x42); } function destroyMyself() public { selfdestruct(payable(address(this))); } and if i call the following in a single forge test engine.greetMe(); engine.destroyMyself(); engine.greetMe(); both greetMe's excute successfully but i'm expecting the 2nd to fail because that contract shouldn't exist anymore, is this functionality intentional? thanks for any help hahahaha Yeah you mayneed to add http:// 😅 Yeah I think we're limited there because the self-destruct doesnt happen until the end of the transaction..so the 3rd call still works. Are self-destructs not going away? not sure if its being deprecated in the future, but still ok in 0.8.10 https://solidity-by-example.org/hacks/self-destruct/ is there anyway you can think of faking a self destruct? some more context ""Ethernaut's motorbike has a brand new upgradeable engine design. Would you be able to selfdestruct its engine and make the motorbike unusable ?"" if not may just have to leave this one out or tweak the task to do something different https://ethernaut.openzeppelin.com/level/0x78e23A3881e385465F19c1a03E2F9fFEBdAD6045 I think @msolomon4 had thought about this before? he needs port too selfdestruct is available via substate yes not sure i know what substate means? is this checking a memory/storage location directly to see if the contract has been registered to selfdestruct? any docs you can point me at? Thanks pg 8 https://ethereum.github.io/yellowpaper/paper.pdf you can loop it as much as you want* within the call thanks for the info, so given a forge test is a single transaction and the statement below it's not possible ie you'll be able to call any of the contracts functions post selfdestruct call for the entire duration of that Tx guessing there's no way to emulate 2 Txs in a single test to get around this? ""Throughout transaction execution, we accrue certain information that is acted upon immediately following the transaction.",494
338,foundry-support.txt,"We call this the accrued transaction substate which is a tuple ... The tuple contents include As, the self-destruct set: a set of accounts that will be discarded following the transaction’s completion."" yea right now we can’t emulate the selfdestruct behavior you need. I think there’s two ways to get this behavior in the future: - hook into the evm, look for addresses marked for destruction, and at the end of the top level call from a test, destruct it — guessing this is more doable once we switch to revm, cc @gakonst @onbjerg to confirm - once we have forge node support, maybe we can allow running tests against that, so everything won’t be a single tx, e.g. split it up by top-level calls from tests Here is the implementation in geth for ref https://github.com/ethereum/go-ethereum/blob/92b8f28df3255c6cef9605063850d77b46146763/core/state/statedb.go here is an example of selfdestruct usage if you are interested in a bit of ethereum history https://github.com/nexusdev/solidity-quirks/blob/3ebdffe3425f47b84538631f811b81a49e4c54d8/contracts/delivery_test.sol This was used back in 2016 to send ETH to makerdao users I just had to do a little digging to figure out how to get the gas report. In the end I was successful with forge test --gas-report Is forge snapsho supposed to do anything? It seems like it just does the same thing that forge test does. I also found that forge snapshot --gas-report works which feels redundant since the definition of snapshot says ""Creates a snapshot of each test's gas usage"" ^^ slash would it be helpful if I opened a small pr on the snapshot docs that explicitly shows the command forge test --gas-report as it might be helpful to other folks trying to figure this out? forge snapshot creates a .gas-snapshot file in the root of the project and —gas-report prints the results to the terminal it was because of a cyclic dependency, maybe a better error log would be helpful @steven_nevins thanks for explanation. I guess there's something thats preventing that .gas-snapshot file from being created on my end.",479
339,foundry-support.txt,"i noticed someone else had reported this before and ended up just going with --gas-report np! yeah not sure about why the file isn’t being generated then 😅 nexusdev omg ah andy and mushegian og yeah dapphub before dapphub do i need to specify optimizer runs in forge verify-contract or does it automatically get parsed from foundry.toml? i tried verifying a contracts on mumbai, it didn't seem to work. i tried flatten and verifying it manually on polygonscan and that seems to work. Need to manually pass - @rkrasiuk has that and other UX improvements in mind for the future Found a typo, should I create a pull request for it? yes for sure thank you I think the PR got closed? The typo is at cli/src/opts/cast.rs, line 284. Should be excluidng -> excluding Is there a way to bound the input for fuzz tests? e.g. if we want to test a property that should hold for input vals within a certain range check the vm.assume cheatcode for general wrapping of uints to a range, solmate’s bound method is a good approach (it’s a fancier version of just using modulo, e.g. use uint256 input and wrap it to a range): https://github.com/Rari-Capital/solmate/blob/c5ae005b1cefb01b19a21c447d3e2e29aa5425fc/src/test/utils/DSTestPlus.sol#L114-L133 for more narrow bounds, e.g. the fuzzer shouldn’t use address(0), use the assume cheatcode Brilliant, thank you! hey so I have an existing hardhat project that I'm trying to integrate with foundry. I've managed to compile the contracts in the contracts folder with the -hh.",377
340,foundry-support.txt,"Do I need to do the same when using forge create for deployment? it was closed because you deleted your fork 😄 (code: -32602, message: Invalid params: unknown field `accessList`, expected one of `from`, `to`, `gasPrice`, `maxFeePerGas`, `gas`, `value`, `data`, `nonce`, `maxPriorityFeePerGas`., data: None) Getting this error while trying to use forge create means i am using an unsupported network right? Hey yall, im trying to go through ethernaut wargame using Foundry, im getting the following error whenever im using the startPrank(eoa) cheatcode [FAIL. Reason: Invalid data] testFallbackHack() (gas: 853610) the error message is not very verbose and I cant figure out whats the issue. Has anyone seen that before? you got a snippet of the code? I have tried using your repo as well @ciaranmcveigh , I have actually raised an issue over there https://github.com/ciaranmcveigh5/ethernaut-x-foundry/issues/3 hmm just ran the tests for fallback and they're working for me currently on main with the latest version of foundry.",254
341,foundry-support.txt,"(using foundryup) can you try adding --force to the end of you're test command, it'll make sure it recompiles the code before testing, not sure it'll make a different but can cross it off the list of things it could be which OS are you running, and whats the version output from foundryup? ill pull your repo again and try are you running this off your forked repo or the original? mac os and forge 0.1.0 (98f0771 2022-02-25T00:42:54.200449+00:00 forge --version foundry-cli 0.1.0 running macOS too, im testing from your repository now forge test --force Feb 25 15:40:28.422 ERROR forge: error=Not a directory (os error 20) Error: Not a directory (os error 20) Location:  /rustc/59eed8a2aac0230a8b53e89d4e99d55912ba6b35/library/core/src/result.rs:1915:27 im getting this error ^ , which happens when running forge clean too… curious stuff i should add this to the readme do forge install first your repo doesn't have the .src/tests folder which has the tests for each level think that might be whats missing no, no im running from your repo right now yeah still do forge install and rerun see if you get a differetn error same, here’s what I did: 1. recursive clone of your repo 2. forge install 3. check /lib , oz contracts are there, ds-test also 4. check /src, /test dir is there and populated with tests for each level forge test -m Fallback --force --verbosity 3 Feb 25 15:45:22.811 ERROR forge: error=Not a directory (os error 20) Error: Not a directory (os error 20) Location:  /rustc/59eed8a2aac0230a8b53e89d4e99d55912ba6b35/library/core/src/result.rs:1915:27 if I forego `—force`: forge test -m Fallback --verbosity 3 no files changed, compilation skippped. Running 1 test for ""FallbackTest.json"":FallbackTest [FAIL.",490
342,foundry-support.txt,"Reason: Invalid data] testFallbackHack() (gas: 921345) Failure: testFallbackHack() Just reinstalled forge/cast via foundryup, but same stuff 🙁 and forge build by itself works and doesn't return an error? can you create a new directory - run forge init to get the default sample project and then run forge test just to check on other forge repos your forge test is working as expected default forge init works okay could you try running forge clean in your main repo? does it error out just cloned the repo down again in a fresh workspace and got ➜ ethernaut-x-foundry git:(main) forge install Submodule 'lib/openzeppelin-contracts' (https://github.com/OpenZeppelin/openzeppelin-contracts) registered for path 'lib/openzeppelin-contracts' Cloning into '/Users/ciaranmcveigh/Documents/projects/debug/ethernaut-x-foundry/lib/openzeppelin-contracts'... Submodule path 'lib/openzeppelin-contracts': checked out '5b6112000c2e1b61db63d7b0bb33ab0775ec0975' ➜ ethernaut-x-foundry git:(main) forge test compiling... Compiling 2 files with 0.5.17 Compiling 100 files with 0.8.10 Compilation finished successfully Compilation finished successfully success. Running 1 test for AlienCodexTest.json:AlienCodexTest [PASS] testAlienCodexHack() (gas: 342256) Running 1 test for CoinFlipTest.json:CoinFlipTest [PASS] testCoinFlipHack() (gas: 820227) ... im starting to suspect there is smth wrong with my foundry install.. somehow these errors are suspicious the only thing i can think of is to port over the fallback contracts/test to your working default forge init repo and then try removing things ie the openzepplin libraries etc.",401
343,foundry-support.txt,"until the error stops popping up cool let me know if you find the error this is actually what I initially did after having errors using your repo I thought something broke and id be better off doing everything from stratch on my own the test appeared to fail as soon as I added the vm.startPrank(…) line but that doesnt explain why forge clean/test —force are not working You're on old version, pls check pinned steps 3+ yikes… i got tricked by the version number being the same thanks! missed that it didn't have the timestamp that fixed it ill add that step 3 to the main readme 👌, will close out the issue and add a warning Thanks for taking time @ciaranmcveigh , and cool initiative on your end 🙂 also thks @gakonst, I will make sure to check pinned msgs in the future anybody know how to set your private key in foundry.toml? Thanks for the update and info, useful to know Foundryup @SamuelDare Check pinned msgs Thanks. Are there any known issues with the flattener? samueldare$ forge flatten --contracts src/Contract.sol . Error:  0: failed to flatten the file: cannot resolve file at """"/Users/samueldare/Code/solidity/erc721"""" Location: cli/src/cmd/flatten.rs:90 Backtrace omitted. I think you're not calling it right? You have an extra period at the end of the command From what i understand , it needs a TARGET_PATH so i assumed that adding the . would direct it to the root Are we still on cli 0.1.0 Reading pinned forge flatten ./src/Foo.sol will flatten Foo.sol Is there a cheatcode to catch revert(0, 0)? Cannot find it and is out of ideas for handling it when it is internal libraries etc such that I cannot use try/catch. A somewhat hacky workaround that seems to work is to create a predicate that is true if the action is ""safe"" and false when it should revert(0, 0), then the VM.assume(safe) and VM.assume(!safe) can be used for test and testFail scenarios.",451
344,foundry-support.txt,"@ciaranmcveigh new ethernaut style looks great! is there any way to figure out where in a test things are failing forge test -vvv doesn’t help what does it output myFlashLoanCall is completely empty like i commented out all the lines console.logs don’t show up you can try using the debugger link to docs? on debugger are you calling out to a pre-deployed contract on mainnet or a testnet? forge run ./src/test/FlashLoanTest.t.sol -t ""testFlashLoan()"" --debug basically. the path will be wrong but change the ./src/test/FlashLoanTest.t.sol to the path of the test contract the flashloan contract is custom, but there’s a contract on a mainnet that it interfaces with right - do you use —rpc-url $ETH_RPC_URL? to fork mainnet i’m using eth-rpc-url in foundry.toml think that should be the same ? lemme give this a shot Do you mind running RUST_LOG=forge=trace,evm_adapters=trace forge test and sharing a github gist of the logs sure just dmed it gives me this The application panicked (crashed). Message: No abi for contract Location: cli/src/cmd/run.rs:97 is the path actually correct? yeah, i have a pretty standard structure Solved in DMs Is not something we can have better reverts for, there was a call to a contract that doesn't exist wondering if it makes sense to make fail() in DSTest virtual? https://github.com/gakonst/foundry/blob/master/evm-adapters/testdata/DsTest.sol#L48 I discussed this here before that I prefer assertEq and others to revert (as does assert()). Making `fail()` virtual allows me to override it to revert.",369
345,foundry-support.txt,"is there some way to get line numbers when debugging huge traces like i’m not sure where to start looking if u know what addresses are u can use vm.label(“label”, address) and it’ll clean up the traces no way to get line numbers really in debugger u get them for local contracts well u get source mapping We should be able to with source maps right? Dapptools does it i think we would need to basically run in trace mode if we wanted to do that which is slow sorry *debug mode Can do in failures only? Like rerun the test w sourcemap Is the opcode tracing per step logic tightly coupled to the sourcemap Or can I take a reverting call And figure out where I was in the source given less information Perhaps we make reverts also return the PC? ah so there may be a workaround here if we add the pc + ic to a call trace in ""start_trace"" i think we can avoid doing too much work would force us to add the ic generation like we do in debug mode but thats not like the absolute worst thing in the world we could maybe be lazy with the ic generation Hello, new to foundry and have some questions. Does foundry fuzzing only fuzz inputs for that particular function or does it fuzz multiple inputs on multiple functions at the same time while checking properties on the contract state? Also, is it black-box fuzzing, i.e. simply randomised inputs? Right now it fuzzes based on the input parameters to your test function. The second part of your first question sounds like your asking about what dapptools calls invariant testing / what echidna does—this is planned but not yet supported, you can track it here: https://github.com/gakonst/foundry/pull/731 Re the second question, right now it’s black-box but inputs are slightly biased towards extremes so it’s not truly random. There’s plans to make it more grey-box, @brockelmore has a WIP PR to get that started here: https://github.com/gakonst/foundry rip. is there someway to get the full addresses in red? so i can look them up on etherscan + add the labels in Sadly, I really need the invariant testing part, so I guess I’ll turn to echidna for now, but will keep track of the progress. Thank you for the answer.",489
346,foundry-support.txt,"Yeah this is fixable, it’s because in traces we do format!(“{}”, address) instead of format!(“{:?}”, address) So if you want to submit a PR for that - @brockelmore said that he think it’s bloating the interface, so wonder if we could make it only print the full address the first time an address is printed, and only log the short version all follow up times What is your ideal invariant testing UX? We track here https://github.com/gakonst/foundry/issues/69 so if you wanna drop any thoguhts would be great i am writing history of ethereum in excruciating detail sir also, forge produces output that exceeds stack depth yet brownie hardhat and vanilla solc do not how best to provide info for this Think optimizer related bro , i stay unoptimized we never left Doesn't vm.expectRevert("""") work? hmm so it doesn’t i’m cautious to add it as well because as of 0.8 most of the time a raw revert without data is something like a contract size check fail or something similar Could maybe add a new explicit cheatcode, expectEmptyRevert? @brockelmore hi! any progress on that? Hey y'all when did the order of verify-contract args change - I thought it was dapptools-canonical to be <CONTRACT> <ADDRESS> <ARGS> Also, the command echos the Etherscan key on failure - should probably hide it from output. getting transaction underpriced for forge create what's the option to override gas price for forge create? couldn't seem to find it in help I am having errors with depositing using foundry. What's very weird is that tests randomly fail due to subtraction overflows. If I run the same test 10 times I get the overflow exception 5 times. Here is a link to the repo: https://github.com/ChinmayGopal931/Help Hi, I’m just getting started converting a project over from Hardhat tests to Foundry and I have probably a naive basic question that maybe someone here can same me some time figuring out. I have a contract that sets an owner via onlyOwner modifier pattern. Owner is set in the constructor at the moment  constructor(address contractOwner) {  _owner = contractOwner; } In my solidity test file.",484
347,foundry-support.txt,"My initial impression was that I should be able to pass msg.sender in the test setUp / contract constructor to set the owner to whatever I have in the sender variable in foundry.toml and then in functions that need to be tested that have onlyOwner , but this doesn’t seem to work Even explicitly setting the address in the constructor doesn’t seem to set the right address which is kind of puzzling function setUp() public {   example = new Example(0x00a329c0648769A73afAc7F9381E08FB43dBEA72);  }  function testChangeOwner() public {   emit log_address(msg.sender);   emit log_address(example.owner.address);  } msg.sender is different from the contract owner in testChangeOwner and is an address I’m not sure where is coming from? Am I missing something simple here? Something happening under the hood maybe? Try example = new Example(address(this)) That did the trick! msg.sender in example would be the contract calling it So your test contract is msg.sender Ahh okay. That makes more sense Slight learning curve coming from hardhat I was thinking msg.sender would = deployer So address(this) in setUp / after new keyword would be the contract deployer? It’s solidity all the way down Ser So when you do a “new” in your test Msg.sender is the test contract For instance if your constructor set owner to msg.sender , it would be the test contract Aha got it Thanks for the help! Saved me some time and confusion 🙂 Np! Can someone please tell me if they can replicate this This actually might be an RPC issue fantom is having lots of issues with their endpoint, try a different RPC provider like Ankr I also suspected this but non of the RPC end points I use give me consistent tests Do you have another solution? i dont think that is an explicit contract, more of a guide (that it follows dapptools —cmds) I do for $500 @ChinmayGopal sorry didn't realize you were already here How do you test on a local node But what are you trying to do? Deploy with forge create to a local ganache node? Yea I need to be able to deposit to aave and borrow You can't currently use any node other than the built-in sputnik backend.",475
348,foundry-support.txt,"But you can get your state from any other node using fork mode So if you just want to run your tests against a chain with Aave already deployed, you can fork from mainnet by pointing to a mainnet rpc (e.g. Infura) forge test --fork-url https://mainnet.infura.io/v3/{API_KEY} I've been experiencing some rpc issues due to fantoms congestion Can u run against ganache local node? forge test --fork-url http://localhost:8545 will use forked state from your local node, but it still does execution via sputnik. Is that what you mean? how does one get the return values with cast send? you dont, when you make a transaction there’s no return value, it’s just the tx hash oops maybe by mistake wanna track in an nissue? i see. with hardhat running scripts that send transactions and use the return values is quite handy. with foundry would the only way be to do that be in a test contract? any examples in mind? i think the same applies in hardhat Anyone had any luck using typechain with foundry on contracts with struct params? From teammate: the abis generated by foundry are not working properly with typechain (struct params are not named), so I had to build with hardhat to generate proper types true my bad. works with getters of public state variables though i think we fixed that with Raw abi most recently? Or is that the internalTypes issue in ethabi? @mattsse you should be able to do cast call to get the values of variables thx Will do! @brockelmore vm.label(...) should print out an address's name as well as the address when verbosity is up in forge correct? I'm getting address only can u label address(this) as something as see if it works? because it should work fine how I'm naming new accounts labeling ""this"" verbosity @ 3 it’s a passing test you have to use -vvvv to see a trace it won’t show up in console log, you can open an issue if you want but it’s mostly for traces here's 4 verbosity oh, not meant for console.log oh sorry lol it’s in the setup. setup only shows in -vvvvv lol @brockelmore made the first test fail and names print just fine, just didn't realize how it was to be used oh cool.",493
349,foundry-support.txt,"how did you expect it to work? To print out the named account even if the test passes. Patrick I think means that labels dont show in logs, only in traces How to print floating number? I would like to print 0.2 USDC in this case. floating numbers are not supported in the EVM, so you cannot really Printing ""fixed point numbers"" can be done with the`emit log_named_decimal_uint()`. So not practically floating as Georgios mention. Unrelated to that, USDC has 6 decimals so think you have to many in your example. 😊 thanks. What about the standalone tool, cast? Does it have utility to convert numbers conveniently? yeah pls check --to-dec, --to-fix, to-wei and --from-wei, --to-unit where are dependencies listed in a foundry project? Under the lib/ directory that's where they're found after installed, but take HH or Brownie as an examlpe, these dependencies are listed in package.json or dependencies.txt / pyproject.toml dependencies are managed by gitmodules so I suppose they are just listed there Yea is there any way to have foo.abi in src and make forge bind generate me the rust bindings? ok i found that you can use cast interface foo.abi to generate the .sol file if I have calls to something like UniswapV2Pair.swap(...) in the function I'm testing, is there a way to mock & override the behaviour? I'd like to have the tokens be swapped in my test case without having to fork mainnet hey all. im developing a contract which will interface with a contract that is already deployed years ago and is a much earlier solidity version (my contract is 0.8.10, the existing contract is 0.4.24). what is the best way to do this? i want to be able to deploy the exact same 0.4.24 contract in my tests so i can have confidence that my contract will interface with it correctly, but im getting a ""stack overflow"" error when i try to build that. both the 0.8.10 contract and the 0.4.24 contract separately build fine, so the error clearly comes from importing the 0.4.24 contract within the 0.8.10 contract.",475
350,foundry-support.txt,"on one branch i did a mixture of writing my own interfaces for the old contracts & updating the old contracts to 0.8.10 when i needed to import one, and this built & tested fine, but i would much rather be able to just work with the exact same contract that is deployed. Hi all, is there a way to spin up a local testnet similar to Hardhat/Dapptools ( dapp testnet command http://localhost:8545)? I’ve only used Ganache before and it was kind of handled for me Hi everyone, is there a way to test the gas consumption when calling contracts? I have a function refundGas and I prank to a given account to perform some actions and then call this function to refund the gas consumed, but the caller (prank address) balance never changed, how can I do that? forge test —gas-report I meant inside the test, if I check the balance before and after doing some actions, so I can then assert that the balance changed or not and the refunded value rerunning forge test with —hh flag doesn't print tests? not sure if i'm missing something so basically this is my test, maybe that will clarify things: function testRefundGas() public {  uint256 initialWorkerBalance = worker1.balance;  vm.warp(1 days);  vm.prank(worker1);  // withdraw does refund gas to the worker  contract.withdraw(account4);  uint256 finalWorkerBalance = worker1.balance;  assertTrue(  initialWorkerBalance == finalWorkerBalance,  ""the worker should have the same amount of ether""  ); } The problem is that the gas doesn't seem to ever be changing for the worker1 address have this error when trying to run forge after installing via foundryup: forge: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.29' not found (required by forge) running on debian 10. Googling to find solution, but thought id report it here Looks like this is issue with debian 10, as it does not have glibc 2.29. unfortunate.",440
351,foundry-support.txt,"Forge was working before I tried installing with foundryup can you please ehsare a repo example? yeah check gasleft() in Solidity @ind_g0 https://kobzol.github.io/rust/ci/2021/05/07/building-rust-binaries-in-ci-that-work-with-older-glibc.html <— looks like we need to do this gracias @gakonst https://github.com/gakonst/foundry/commit/41f00a06860555b24db52a6ab6e8461191e77adc 🤝 but also this should fix the import issue for cargo, but there are like places in the codebase that I think look for this directory existing?? at least when I was at my laptop I feel like I remember results when I grepped around for this to figure out what it was? sorry for being useless i put my laptop away a while ago It mighta just been docs idk they shouldn’t this was some lingering submodule which idk why it got there hmm my memory may also be faulty this was many hours ago and I am 10/10 sleepy maybe give another try from master once u back at laptop and we can revisit then obv a big devex prob which we dont want i mean just check ‘ag ds-test’ in general there’s been a bit of a backlog accumulating, so going thru small bugs & fixing today because that’s definitely what I did Totally possible my memory fails me but I remember if statement gates for that directory’s existence it may have been the latest tagged release not master, tbh 🙏🙏🙏 i think fixed here https://github.com/gakonst/foundry/commit/9557f38729b2b4e9870a049376a4492b0f4a00c1? might be this ty ser if u wanna open an issue with all your specs that are relevant and this blogpost link, and we can fix CI/foundryup to release musl binaries too (vs libc ones) looks similar but i was either looking at latest tag or master. if you grep the code for that string and don’t find anything it should be fine… sorry for not being helpful I just may forget this tomorrow and don’t want to abandon a possibly-found bug of completely-unknown severity sure thing.",485
352,foundry-support.txt,"I looked at the foundryup script and looks like its defaulting into the ""if"" block, but the ""else"" block is what triggers a build. I think building would be fine in cases like mine. Can't tell how to get into the else though. fwiw i used the old forgeup script and it built by default, which worked for me. ye so foundryup -b master should work for you most likely since it builds from source, thet above is to use the binaries interesting. will give it a shot ya if this build succeeds then this is exactly what i needed. thank you. i can put a PR into the readme to use this if there is an issue with GLIBC yes as a stopgap cool so yeah issue with the blogpost + PR for the readme w workaround sounds great This is a bit contrived, wanna share a minimal code example or open an issue? Not yet. There's an open PR for this, but we need some extra time to get it over the line https://github.com/gakonst/foundry/discussions/827 hi, did something change in the way it checks for tests in the latest version? I was running a previous version and just updated (have also created a new project to test) and none of my tests run. Will only run the default Contracts.t.sol. Have tried using —math-test and nothing runs I just created a new project and it seems to work Are you on latest forge —version? forge --version forge 0.1.0 yea so you’re not on latest check pinned msg pls Step 3 ah, thanks will try that had to poke around on Cargo, but got it to work.",348
353,foundry-support.txt,Thank you did something change regarding block.timestamp with the newer version? seems block.timestamp is zero by default makes some of our tests fail It's always zero by default unless you're forking hm ok thanks You can Configure it with an env var FOUNDRY_TIMESTAMP iirc ye ive always just done a vm.warp(someTime) Has anyone seen this error missing field `file` at line 1 column 2823 are u on latest forge? check pinned msg I'm on foundry-cli 0.1.0 yea pls check 3rd bulletpoint to get to latest forge 0.1.0 (d08a59e 2022-03-01T00:35:40.445140+00:00) is mine forge 0.1.0 (d08a59e 2022-03-01T00:35:40.445140+00:00) as well and it doesn’t work? dont mean to spam but would really appreciate any thoughts on how best to do integration tests between a protocol youre building and a much earlier protocol you dont control written in an old solidity version with breaking change differences. the discussion i opened is verbose and includes contract examples but thats the core question.,257
354,foundry-support.txt,"thanks in advance 🙏 https://github.com/gakonst/foundry/discussions/827 yeah sorry there was somebody that wrote a blogpost on this actually just remembered does anyone have the link vm.getCode —> assebly create -> wrap the address in interface ah thank you! ill try to find the blogpost, if anyone knows where to find it please lmk Is there any way to test with users that are not contracts? yup thx guys that workes hey @brockelmore yeah heres my .gitmodules [submodule ""lib/ds-test""] path = lib/ds-test url = https://github.com/dapphub/ds-test [submodule ""lib/openzeppelin-contracts""] path = lib/openzeppelin-contracts url = https://github.com/openzeppelin/openzeppelin-contracts i've also tried manually adding the lines I expect to see: [submodule ""lib/forge-std""] path = lib/forge-std url = https://github.com/brockelmore/forge-std and running forge install but doesnt help i must be doing something wrong bc i have pretty consistent issues with git submodules and remappings etc whenever i setup a new forge proj. im new to git submodules so probably on me Foundry Support i fixed that ^. also, just a heads up, deployCode didnt respect the custom paths in my foundry.toml but worked when i set it back to defaults (out, src). lmk if theres a setting im missing is /lib in you .gitignore? How did you fix it? ahh @brockelmore yes it is @gakonst i brute forced it without fixing root cause (started fresh new default project, installed it properly there, dragged the library over and updated gitmodules file) but sounds like lib in gitignore is root cause Why is it? we should probably add the force command option to forge install not the first time this has happened If you need to remove submodules, what worked for me in the past is just deleting the .git/modules directory really appreciate your help so far guys. im quite certain im using deployCode correctly, except for something critical: I cannot get a contract deployed via deployCode to interact with *another* contract that was also deployed via deployCode.",470
355,foundry-support.txt,"when i run test -vvvv the trace shows the error coming from the moment deployCodeContract1 calls a function in deployCodeContract2 and gives no reason. ive messed around with it a lot and confirmed its a reproducible issue with a totally contrived simple example. ive also confirmed that when i update those contracts to my current solidity version and deploy them natively there is no error. ill update the discussion post to show this example and post the link again below. actually ill open it as an issue in forge-std. https://github.com/brockelmore/forge-std/issues/22 Thanks, will take a look Cc @brockelmore hmmm this is strange ``` RUST_BACKTRACE=full forge build --optimize --optimize-runs 200 compiling... Error: 0: missing field `file` at line 1 column ``` I've seen this above but could not find a solution. I was messing with my solidity code and it stopped compiling. I didn't mess with no libs or imports or anything, just syntax. I won't post the full backtrace here because it contains PII. I am on the latest version of foundry ok I found the issue: I have this variable in Locker contract: bool public isLocked; when I try reading that var without () I get the above error: require(locker.isLocked); changing to the correct sintax, fixed the build: require(locker.isLocked()); Hmm can u share the source before We should be detecting the error what do you mean? the build error appeared when I added that require line without the () Can you produce a single solidity file Which causes the error That's small, few lines So we can debug, fix and add a regression test? Wondering about exactly this issue. Can't find a way to get my Polygon contract passed the mempool. Seems that the default gas price is just too low. Maybe there is no option, should be simple to PR it though. If u cannot, please open an issue and we'll track. Understood. Thanks.",419
356,foundry-support.txt,"pragma solidity 0.8.11; contract Locker {  bool public isLocked;  constructor() {} } contract Error { constructor(Locker l) {  require(l.isLocked); } } this? Yeah and if u can open an issue With your error (I am asking this both for us to track so we don't drop the ball, but also so that people get in the good habit of opening issues with minimal code examples and good descriptions, helping the maintainers with the resolution) would be cool to have the logging functionality by default instead of manually adding the suggested console.sol contract to the project no? Hello i am trying to build foundry from source and got this error when installing dependencies Updating git repository `https://github.com/gakonst/rust-trezor-api` error: failed to get `trezor-client` as a dependency of package `ethers-signers v0.6.0 (https://github.com/gakonst/ethers-rs#94e2d1b1)`  ... which satisfies git dependency `ethers-signers` (locked to 0.6.0) of package `cast v0.1.0 (/Users/offshore/kit/fy/foundry/cast)` Caused by: failed to load source for dependency `trezor-client` Caused by: Unable to update https://github.com/gakonst/rust-trezor-api?branch=chore/bump-eth-types#02928b58 Caused by: object not found - no match for id (02928b582df79509fe9bf88a364afdf8a372727c); class=Odb (9); code=NotFound (-3) Does anyone know how to fix this? oops should update ethers sec Is there anything I can do on my end or should I wait for a nightly update or something? nah just pull master and build again hmu if u have any suggestions pls and ty awesome thank you! know you all are busy, wondering if anyone has had a chance to reproduce the issue i posted or any suggestions for solutions i could look into / how i could help (deployCode contract interacting with another deployCode contract) sorry i looked at but didn’t have time to reproduce.",466
357,foundry-support.txt,"do u have a repository with the setup by chance? ill make one https://github.com/jgeary/one-off-forge-issue also added to issue description ty ser wait this isnt a forge issue its an issue in ur test line 44 of AB.sol B doesnt create A, therefore a.owner is the address of b Thanks but ownership is transferred in setup And it doesn’t matter what func is called - could be anything And if it were the case I’d expect to see the error message ah u r right exploring confirmed its a solidity issue this: address b = deployCode(""AB.sol:B"", abi.encodePacked(a)); should be address b = deployCode(""AB.sol:B"", abi.encode(a)); packing doesnt left pad the address so when you put it into the constructor its wrong and then a address gets messed up inside B see because u packed encoded, the stack looks like this, where we are about to AND then SSTORE the address of a. but when the and takes place, since u packed encoded instead of encoded, the location of the address is off this is what is stored as the address of A because of the packing lmk if u understand @jgeary totally get it thank you @brockelmore and my original, more complex contracts & integration tests are working now 🙂 Somebody else has had this issue before and had the same fix - we should document 🎉🎉 You mind writing the solution in the issue opened James? Is there any update regarding the empty result with blockhash(blockNumber)? In my case, I'm trying to test against mainnet if an storage proof I'm passing as input is correct based on a past block hash (on the 256 range); so a random block hash doesn't really work for me Oops I'll fix now. That's why we should open issues for everything :) Cool, I can open issue if you prefer for reference Yeah so I dont forget It's a easy fix To be clear you want the mainnet block hash here? Yes, exact same behavior as in mainnet or other network.",419
358,foundry-support.txt,"My use case is generating the proof for block X off-chain, then testing on for example a ""latest"" block fork and verifying the proof against blockhash(blockX) I could manage by forking at exact X, but I guess it is kind of similar to have the 256 historic, no? Created the issue Are there plans to include mutation testing in Foundry? With the lightning fast test speed, this could be really fruitful. The bottleneck with mutation testing is often time, i.e. running the whole test suit on 100’s of “mutations” of core contract code console.sol is a generated solidity contract to begin with is it not? We cannot do this without you explicitly importing it, but we can and should add it stdlib yeah that'd be cool Should be simple PR if you wanna do it :) Take console.sol and put it in forge-std will do 🙂 btw sending pr on nft tutorial soon 🔥🔥 ye at some point we want to but it’ll be down the line just updated this morning: $ forge build Compiling... Compiling 11 files with 0.8.12 Compiler run successful (with warnings) but what are the warnings? I don’t see a flag to view them 🤨 (I’m building this branch if you want to repro: https://github.com/mds1/multicall/pull/2) lmao day 143 of matt wanting his warnings always there Days without warnings incidents: 0 they should be showing.......... i will check it again is ""fuzz_runs = x"" still how we put limits on fuzz testing? i tried it and I cant seem to get it work correctly...",342
359,foundry-support.txt,"Is there any documentation somewhere for a project like ours using Hardhat and accustomed to Node.js world but interested in transitioning to Foundry? ex: I tried getting our contracts to compile but I get a bunch of errors because of our OpenZepplin imports. 🙃 Ideally, I'd like to gradually rewrite our tests in solidity without having to completely change everything else immediately (ex: deployment, hardhat scripts & tasks, etc). Hey Matt. Maybe this is helpful? https://t.me/foundry_support/3112 You should be able to get a HH project working with Foundry with little to no changes on the HH side. It just requires configuring a few things on the Foundry side. (Note: I am a total noob and there may be a better way 😅) can forge read env files? I use different rpcs based on project, one solution is just to read out the var in package.json I guess You could do vm.ffi(“echo $ENV_VAR”) I think oh you mean in the config there’s a profiles feature in the foundry.toml yes, so ti don't have to put it in foundry hm i dont think we have a good out of the box thing for this can u open issue? sure edit: done hello curious what's the difference b/w forking mainnet with hardhat and just using -f with mainnet rpc thanks! this looks helpful. I'll try it out Is there an equivalent of ethers .getContractFactory function in Foundry or is it unnecessary Not necessary 😊 is it possible to change msg.sender? have you tried cheatcodes? https://onbjerg.github.io/foundry-book/forge/cheatcodes.html. prank() and startPrank() cheatcodes which lets you set msg.sender Hi, is there a way to get the full address in trace logs? For example 0x6a87…6ac7::ab9c4b5d. I have used vm.label for known contracts but I want to check which contract is being called here. @brockelmore console.sol is a generated contract i thought try .envrc its exactly what you want https://github.com/direnv/direnv Link to repo sir This fixes the problem for whoever installs this. Foundry should have a way to load env files just as the other frameworks do.",483
360,foundry-support.txt,"Makefile? Dapptools template by gakonsts has a good example of a makefile for that use-case i just ran: forge build —root . —hardhat in your monorepo and compiled without changing anything bro your preaching to the choir in your protocols directory* Awesome much appreciated! https://gist.github.com/sambacha/cfe99953080226fa28ef572cf3366a98 there is the toml file for reference any dependency that is reference within the monorepo must be copied over forge does not understand workspaces / import modules so u gotta cp anything just for future ref Yeah thinking this or just loading it package.json as gotta keep things pretty. The issue I added should be a pretty straight forward change tho. would a symlink work? i wonder if it works in git it should work i dont think the automapping feature is capable just yet of working out monorepos comprehensively Hello, do you have some script example to deploy several SC with forge create ? I wonder how to get the address of the first deployed SC to pass it to others SC, other than parse the output of forge create ? Hello, just wondering if Foundry does caching of rpc calls? So for example if I forked from the same block & rpc link, then rpc calls will only be done for the first time & its results will be cached from the 2nd runs onwards? (Updated: I guess not, was testing it) Was trying out Foundry to see if I can migrate the entire hardhat system to it Not yet, but there's an open PR Expect it next 2 weeks or so as we move to revm Wow nice, after testing foundry I think that’s the only point preventing me from migrating Looking forward! has anyone run into issues with tests freezing up? I have 2 tests files. 1 will run, but the second just hangs indefinitely. Even if I get rid of the first file, the second hangs never had this issue with older versions. only seeing this after updating few days ago interesting - can u share a repro? its private unfortunately i can add you if you like? or take screenshots? whatever works considering the CI works, i think this is an issue with my local installation oh it works on CI but not locally? yessir (obvious q): are you on latest foundry yup. I ran foundryup -b master yesterday again just to be sure.",495
361,foundry-support.txt,"same issue running Debian 10 (in WSL) can you please try minimizing the repro and share a public repo? OK i realized my issue. turns out the other eng turned the fuzz runs very high which was causing it 😳 appreciate the help. LMAO so CI was completing because it's a bigger box? i dont think so lol. i had never seen it hang this long. so used to fast forge tests, i thought something was wrong lol So all good now? How many fuzz runs were u doing? 262144 😭 and yes all good Loll Great! Hey guys. I finally tested Foundry. You guys are amazing. So fast!!! So nice to handle. Seriously, thanks so much for this work! 🙏 bullish My only question is about a local node. I understand it is not released yet. Do you have an opinion about which local node to use? There basically only two options right? 😂 u dont need local node to run forking tests Absolutely bullish. My tests at one of my projects take up to 20 seconds. And I have the new M1 max. With Hardhat. ;) I could actually rewrite one or two tests pages and compare the results. https://mirror.xyz/susheen.eth/bRCzT2QLdNINMVk8251udkfjHW_T9ascCQ1DV9hURz0 I develop the frontend, too. So my best take it so deploy fixtures to a local node. I have done this with hardhat. Is there an opinion on how to do it the foundry way? ah i see we dont have a node yet there's an open PR but needs work still i'd just run hardhat node & deploy my contracts there Ok so hardhat is the opinion? Good thanks. If you get this accomplished it will be a game changer. Or will it actually? How do other people develop the frontend? From my limited perspective I would assume this gets requested quite a lot. my project has been using a geth node personally, we deploy using our deploy scripts as if we were deploying to mainnet then we can test the frontend like normal so ye will be a game changer what do you mean 'develop the frontend' exactly anyone have any examples of writing tests in forge involving eip 712 & signatures? I'm still getting errors from the relative OZ imports.",486
362,foundry-support.txt,"Anyone know how I can fix this? can u share the repo perhaps? @mattsse I think the issue is that this is a monorepo where dependencies are hoisted at the top level node_modules I think the solution is to no-hoist the openzep installation OZ is installed in the sub directory's /protocol/node_modules and I'm calling the command from the subdirectory https://github.com/soundxyz/protocol/tree/gigamesh/foundry ill take a look in a sec, thanks! delete teh workspace package dependency in protocols https://github.com/soundxyz/protocol/pull/60 pnpm installs packages in a specific way. It doesn't use flat structure for node_modules as npm. It installs the declared dependencies into node_modules but all transitive dependencies are installed into node_modules/.pnpm/registry.npmjs.org/. As a result node_modules contains only small set of declared dependencies and all other transitive deps are installed in a different folder. i.e. to be able to solve this there is a config parameter shamefully-hoist=true which says pnpm to install deps into node_modules . The parameter works being added into .nmprc ooh I see - big thanks! this is why deleting the soundxyz package fixed it , you defined its semver requirement as a workspace path making it transitive are there ways of testing that an event was NOT emitted ? not currently, but it’s been discussed in https://github.com/gakonst/foundry/issues/509 is there a way to load data into a solidity test? for example calculating a merkleproof and loading that in? Any good solidity codegen utilities? I’m poking around the blacksmith stuff but curious if folks have used anything else I ran into the same issue and I hope someone has a better solution.",372
363,foundry-support.txt,"I ended up generating a few merkleroots beforehand with the user addresses used in my tests and used OZ merkleproof.sol to verify them Checkout the FFI cheatcode This example uses dapp.tools but you can probably get the jist https://github.com/gakonst/lootloose/blob/master/src/test/LootLooseMeta.t.sol Hi, when calling a function that's supposed to be delegated to an implementation via delegatecall, forge throws a ""member not found or not visible after lookup"", is there a way to test delegate logic on foundry or this feature is not yet implemented? Change interface, i am guessing if you try to do proxy.someFunction it won't work on a Proxy object because it does not define that function, so solidity will throw error. Instead try IImlpementation(address(proxy)).someFunction() or do .call / .staticcall`s with correctly encoded args with `abi.encodeX methods Thanks! if you still want a high number of fuzz runs for CI you can create a CI profile in foundry.toml :) set env.FOUNDRY_PROFILE: ci in github workflow + have something like [default] verbosity = 3 optimizer = true optimizer-runs = 20000 [ci] verbosity = 4 fuzz-runs = 1024 in foundry.toml Also, my tests are hitting outOfGas limit, and it seems that Vm.roll doesn't reset the gas counter, is there a way to simulate a real block mining? Nice and good exmaple if using profiles what are you looking for I’d like to generate some helpers for vm.store based on the contract storage layout.",339
364,foundry-support.txt,"I’ve checked out the std-lib stuff, but I have some structs that get packed into 1 slot Ideally input solidity AST, output a slightly more ergonomic version of stdstorage I’ve done AST stuff in js/ts but not in solidity land you should know that the solidity parser (npm package) is not as strict as the compiler, so if you decide to go that route there may be some issues potentially hardhat console is a generated contract for reference dill has a typed ast tool https://github.com/ConsenSys/solc-typed-ast its not published to npm fyi you will have to get it off github packages Good to know! Will check it out Thank you! it would be sweet if the label cheatcode could label bytes32 for things like rbac is there any way to supress these warnings sers? what’s rbac? not sure sorry maybe @gakonst knows i think they mean roles, like with OZ ACL usually keccak256 of the role name is used, so maybe they want to be able to label a given bytes32 by the role name in the traces I’m currently trying to verify my contracts on rinkeby but getting the error: “Found argument ‘--chain-id’ which wasn’t expected, or isn’t valid in this context” When running: forge verify-contract --chain-id 4 --compiler-version v0.8.10+commit.fc4108 <contractAddress> src/BondingCurve.sol:BondingCurve <apiKey> anyone know what the problem is? Got it to work, required removing old forge rf and reinstalling using foundryup which wasn’t updating to nightly release before Is there a way to run forge to see opcodes for a specific function? gm sers. solidity newbie here. im following the foundry gitbook here https://onbjerg.github.io/foundry-book/forge/cheatcodes.html and i have a question on interface. CheatCodes was first defined as an interface interface CheatCodes { function prank(address) external; } how does the code know that in cheats.prank(address(0)), the prank function comes from Hevm.sol? I searched in the codebase and it is the only place where the prank function is defined.",457
365,foundry-support.txt,"thank you 🙂 The EVM has a hook that says “whenever anybody calls the hevm address, run the cheatcode logic"" https://github.com/gakonst/foundry/blob/master/evm-adapters/src/sputnik/cheatcodes/cheatcode_handler.rs#L755 https://github.com/gakonst/foundry/blob/master/evm-adapters/src/sputnik/cheatcodes/cheatcode_handler.rs#L1508 oh wow, thats so cool! learned sth new today. thanks 🙂 Hi there everyone. I’ve just forked Frankie forge template but when I try to run the tests it fails with this output https://github.com/FrankieIsLost/forge-template/issues/10 there’s something that is strange in my end because I see that frankie suggest (in another issue) to use -vvv for verbose but I don’t have that options (that is also used in forge docs) and I need to use --verbosity 2 so I don’t know if I’m missing some dependencies or if I need to update something I'm having a lot of trouble verifying my contracts on rinkeby, getting the `Fail - Unable to verify' error. I'm running: forge verify-contract --chain-id 4 --compiler-version v0.8.10+commit.fc410830 0x1e4ec9f1cb7bb94af998055a4667cb28c381e577 src/BondingCurve.sol:BondingCurve <ETHERSCAN_API_KEY> the contract has no constructor args and I've specified compiler version 0.8.10 in my .toml file but still getting the error anyone know what the issue could be? hey Kiran! im also getting the same error when i run forge verify-check on rinkeby 😅 did you try to copy and paste your ABI onto https://rinkeby.etherscan.io/verifyContract-solc? apparently i got Error! Invalid constructor arguments provided. Please verify that they are in ABI-encoded format when i copied my contract's ABI 🙁 I didn't, but the contract I'm trying to verify doesn't have any constructor arguments, so that shouldn't be a problem right? yea i think so. just figured out haha oh i fixed my problem.",477
366,foundry-support.txt,"i had to turn on optimization on rinkeby during verification 😂 what do you mean? what command did you run? i couldnt verify on rinkeby previously. now it works on rinkeby but still fails on forge Check pinned bullet 3. You're not on latest forge! For testing events, is there any streamlined method of importing events instead of copy-pasting them every time in the test contract? inheriting the contract is one option is console.log stripped off the contract when compiled / deployed? or should you be commenting those out to not waste gas? Not stripped off :> commenting out it is, save on staticcalls' gas still efficient than having missed few emit log_... that became part of my deployed contract 😅 yeah fixed the issue thanks to @brockelmore ! has remappings behavior changed recently? previously compiled project doesn't compile anymore Is there a way of programmatically asserting that a function call used < X gas? E.g. in HH you could pull .gasUsed from a tx receipt. Use-case is testing that a contract call prohibits use of more than X gas how do i fix this issue? You can't really, you will need compatible versions between dependent files, gotta fork and patch Which repo causes this? You can check gasleft() before and after the call Got an example? I think it should work the same shouldnt force override it Should probably add a postprocess step that removes any debug related code from contracts Looks like Safemath.sol is only valid for =0.6.6 this one https://github.com/Uniswap/v2-periphery I feel like lately I see a lot more people using require(foo == bar) than assertEq(foo, bar) in tests.",353
367,foundry-support.txt,"is that a new standard or an unspoken rule or maybe it just doesn't matter at all? 🤔 Doesn't really matter You use assertEq if you want to test.multiple assertions same issue with me Should be fixed on latest master Additional gas-price and priority fee args merged half an hour ago https://github.com/gakonst/foundry/pull/853 Should be available on foundryup You can configure how does it set the default gas price? Does it use cast gas-price? yeah anyone have any examples of testing EIP 712 stuff in forge? (lmk if this is better for main foundry chat and ill cross post) anyone know if it's possible to have a test with two different contract imports with different versions? i just went through that so i can help. use the forge-std package and specifically the deployCode function. function lives here (line 80 and 90) https://github.com/brockelmore/forge-std/blob/master/src/stdlib.sol#L78 and you can see examples in the tests (line 66 and 71) https://github.com/brockelmore/forge-std/blob/master/src/test/StdCheats.t.sol#L66 for any contract that you want to deploy that is a different version than the version of your test file, you can deploy the bytecode directly with deployCode and interact with it via an interface. here's an issue i opened that shows a complete example https://github.com/brockelmore/forge-std/issues/22 its possible https://github.com/gakonst/foundry/issues/786 trying it out right now, thank you for your help if youre looking at the issue i linked, make sure to read through it to see what i was doing wrong and what the final solution was heh you could use this to deploy vyper contracts via solidity the bytecode I've an issue , an internal function returns a uint256 like that function doSomething () internal returns (uint256 smh) and I call it on another function like smh = doSomething(); forge says undeclared indentifier You need to do ""uint256 smh ="" Hmm ok . thanks it's work. so I need to declare all returns when I work with forge In Solidity Not jsut forge 🤔 ok.",471
368,foundry-support.txt,"It's normal solidity you always must declare the type I think he has it so it’s returns (uint256 smh) then he initializes after, that should work no? Asking again: Is there an easier way of expecting a custom error revert than vm.expectError(abi.encodeWithSignature(customErrString))? Would be nice if I can make my test contract inherit an errors interface with custom errors defined and just re-use instead of rewriting them as strings There's a few standard errors in forge-std here but no canonical interface afaik, not sure it makes sense to add custom string hashings to a standard lib. Maybe forge-std could expose a encodeRevertBytes(string) function that abstracts the`bytes4(keccack256(string))` cc @brockelmore u can make your errors *not* in a contract then when you import the file you get access to the errors. additionally you can use an uninstantiated version of a contract to grab the error selector i believe like Contract.CustomError.selector instantiated versions of a contract do not work for selector of a custom error tho 🤷🏻‍♂️ i.e. Contract a = new Contract(); a.CustomError.selector i may have that backwards tho Contract(0x0).CustomError.selector Works i forget off the top of my head. solidity is weird sometimes Wow, didn't know you could grab the error selector like that. Will give it a shot, thanks all. On that note, sorry if it's off-topic, but I'm very curious how everyone prefers defining their custom errors.",323
369,foundry-support.txt,"Do you: - Define them outside contract in the contract file - Define them within contract in the contract file - Create a shared errors file for your whole project For Foundry integration it definitely seems like the first or last option is easier to work with For some reason even though i installed forge-std when i use deployCode it throws an undeclared identifier error i used the contract as described here https://github.com/brockelmore/forge-std/issues/22 is ur repo public? no, but i can post the specific test contract wait nvm got it oh great lmk if there is anything we can do to improve the ux so that whatever u ran into doesnt happen again sounds like a git modules issue Bumping on my outstanding Q, how would I sign a message / typed data with a random priv key in a forge test? have u checked out the sign cheatcode? are you just curious how to use it? Oh didn’t know it existed, thanks. My bad should have double checked the cheatcodes before asking (uint8 v, bytes32 r, bytes32 s) = vm.sign(pvk, digest); ty ser what was the issue? Yeah it was pretty dumb, I just forgot to add stdCheats to the test contract inheritance Hi, i am trying to set up slither action in my foundry github repo. Judging from previous messages, is it true that currently foundry is not supported yet? it should be, we now emit additinoal artifacts great. maybe I have set it up incorrectly. will check will I need to do foundryup -b master for this? in general u should be able to build a standard foundry repo with dapptools is it a hh repo that u ported? its an option that i have used since i already had dapptools downloaded (and slither ships with dapptools support) i started from scratch if u want slither to work today, you can install dapptools and use slither . --compile-force-framework dapp + some dapp config and if you don’t want to use dapp, you can bump this issue 🙂 https://github.com/crytic/slither/issues/1007 sure, came across this issue when I was looking around why slither is not working for foundry.",467
370,foundry-support.txt,"let's say i was testing and forked a network, if i wanted to change the value of an erc-20 token given to me how would i go about doing that? @brockelmore are you planning to bring frankie utils inside a lib? or should I always clone his repo and remove libs that I don’t need? i would be open to bringing frankie's utils upstream im not super familiar with what all he has added vm.store cheatcode, and there's a write function i nforge-std which libs do u need? we can upstream stuff I was looking at https://github.com/FrankieIsLost/forge-template/tree/master/src/test/utils also is it normal that when I do forge remappings it use not the relative path to the libs but the absolute full path? and I would have assumed that when I add / remove the dep it woul update the foundry.toml or remappings.txt tell me if these things are something that is in the pipeline or if they ae just stupid 😄 yeah it does, but we should probably change that gosh, I’m trying to rebuild the damndefi CTF and I’m rebuilding all the tests.. you can’t understand how I’m enjoying how blazing fast the tests are with forge after having to wait seconds because of typescript (that I still love :D) amazing You guys spoiled me. My first dapp is built with Foundry. I'll never know the struggles of what came before 😊 evening all - using forge tests and seeing some odd behaviour with a test suite; returning early (before a revert) in one test is causing other failing tests to pass (and vice versa) tests share a setup I've scanned the issues in the repo and nothing is jumping out, is there anything known that could cause inter-test weirdness like this before I go down a rabbit hole my understanding is each test shouldn't affect another yeah it shouldnt oh interesting, no this shouldnt be happening OK sick can you share a minimal example? down the rabbit hole I go yep will get something together https://gist.github.com/ohone/8976fc28ca61d80f84ed157e038da49c @gakonst forge test that file toggle comment on line 14 to prove, address fuzz is required on testA I'm giving forge verify-contract a spin, but I'm not able to get it working on fantom.",496
371,foundry-support.txt,"It looks like the API is spitting back some unexpected output, but perhaps it's user error and someone recognizes this? 0: Failed to submit contract verification: error decoding response body: expected value at line 2 column 1 @thingtheory can you post the file Is a gist with the flattened contract good? Should I include anything else? I could also link to the repo yeah repo should I open an issue on github for each of the requests? I have this code vm.startPrank(someUser); // vm.expectRevert(bytes(""Assertion violated"")); receiverContract.executeFlashLoan(10); vm.stopPrank(); The code will revert on this line receiverContract.executeFlashLoan(10); with this stack trace ├─ [2253] ReceiverUnstoppable::executeFlashLoan(10) │ ├─ [1616] UnstoppableLender::flashLoan(10) │ │ ├─ [562] DamnValuableToken::balanceOf(0xefc56627233b02ea95bae7e19f648d7dcd5bb132) │ │ │ └─ ← 1000000000000000000000001 │ │ └─ ← ""Assertion violated"" │ └─ ← ""Assertion violated"" └─ ← ""Assertion violated"" so I would assume that the message I should check is Assertion violated but when I remove the comment on vm.expectRevert(bytes(""Assertion violated"")); I get this error [FAIL.",301
372,foundry-support.txt,"Reason: Error data != expected error data: 0x4e487b710000000000000000000000000000000000000000000000000000000000000001 != 0x417373657274696f6e2076696f6c61746564] am I using expectRevert wrong? Note that 0x417373657274696f6e2076696f6c61746564 from byte to string is Assertion violated And 0x4e487b710000000000000000000000000000000000000000000000000000000000000001 is NH{q Yes please try using this as your assertion error bytes ie: vm.expectRevert(assertionError); how can I get the assertionError ? I'm trying to integrate Foundry into a HH env, so I've rigged up the foundry.toml so that src = 'contracts', but it doesn't look like the compiler is finding the contracts there - am I missing something? is there a way to build just a single contract? nvm just saw -c hmm can you check that foundry config outputs libs = contracts the command isn't working my bad forge config -.- (I did that too) I’m trying to do a two-step compilation to run some code gen that gets used in test files. Right now, i separate my src files from tests in the directory structure compile those, run code gen, and then forge test —contracts dir-with-tests. I tried changing the foundry.toml for the test option but it seems like that option might be relative to the src directory as opposed to the root. Not really a huge issue but would like to handle this with the foundry config vs cli args each time mind opening an issue for this with an example toml dir and dir layout? And describe the preferred behavior Sure basically when i set test=“test” in foundry.toml the expected behavior would be forge test —contracts test @gakonst it seems that vm.expectRevert is not working when the tx get reverted because of a failed assert inside the contract. If I change the assert to revert the test will not fail (it correctly catch the revert).",451
373,foundry-support.txt,"so does the forge vm does not support assert? also it’s not supporting contracts that revert with just require(a==b) or at least I need to do vm.expectRevert(bytes(“”)); probably it would be useful to have a vm.expectRevert() that check if the contract has just reverted or reverted with an empty message hi @mattsse I think this actually might have been fixed recently. I foundryup pretty frequently but i did foundryup just now to check and it’s doing what I was expecting 😅 woops sorry forgot to link https://github.com/brockelmore/forge-std/blob/master/src/stdlib.sol#L103 and u can see how its used here: https://github.com/brockelmore/forge-std/blob/018b7a57ac40c9e4d2b0076b3394e0ee54b7143f/src/test/StdError.t.sol#L17 works like a charm! Yep this point has been discussed before, am personally supportive of this, but remember @brockelmore had some pushback? This is odd, I'd expect it to work. Could you please open an issue so we track / repro / fix? Make sure you're on latest forge too Adding to this now it looks like I can’t compile just the src directory even if I use the —contracts src flag 🤷‍♂️ I has to use vm.expectRevert(stdError.assertionError); as suggested so for older versions of solidity, the compiler doesnt generate panic error codes. i have a strong preference that we push people to use newer versions of solidity and entice them with features. in 0.8.10+, in general if you get a reverted call that doesnt produce an error code something is seriously wrong that you generally *shouldnt* be testing for, i.e. its actually invalid and you have a bug.",394
374,foundry-support.txt,"if someone is able to provide an example in a newer solidity version where this isnt the case, im happy to change my mind if require without an error msg produces the above case, i think we should support it but i need to test myself i guess requires without a string msg dont generate a panic code which is annoying tbf tho those should in general be an assert imo Meh hard to enforce agree - probably should just add @brockelmore I had this issue while “translating” damn vulnerable defi from hh to foundry. This is the assert that I need to verify that will fail https://github.com/tinchoabbate/damn-vulnerable-defi/blob/v2.0.0/contracts/unstoppable/UnstoppableLender.sol#L40 while I was experimenting I tried to change it from an assert to a require(poolBalance == balanceBefore);. and I was only able to verify it on my test using `vm.expectRevert(bytes(“”));` that’s not so good for UX (I would expect `vm.expectRevert();`) vm.expectRevert(stdError.assertionError) doesnt work here when compiling with >=0.8.10? no that has “fixed” my test wanna open an issue for this? shouldnt be too hard to add an overloaded expect revert no problem I will collect everything (I had others) and do it after work https://github.com/thingtheory/beets-to-reaper/blob/master/foundry/scripts/verify.sh, any questions plz let me know anyway I totally understand your point, but from an auditor standpoint I need be able to use foundry with any kind of dev behaviour Yep agree I resorted to moving my tests directory to nottests🥸so they don’t get automatically get added to the build task, run the code gen, and then compile/run tests do I need to open it under foundry? which components should be under? ye in the foundry repo forge is the only component I’ve also another question. If I install libs using a tag it seems that the .gitmodules does not use the tag. is it normal? where is the information about the version/tag I installed stored? if you explicitly use git to install does it include a tag? mmm never done that tbh, this is my first time using submodules.",481
375,foundry-support.txt,"but if submodules is a substituted for node_modules there should be someplace where you track which version in used by the project otherwise I would expect that if I clone the repo it will always use the master version with the last update. something that I would not want for security purposes Submodules are pinned against a commit ye thats what im reading. sounds like if its a specific branch, there will be a branch entry in .gitmodules, but for tags its just a human readable wrapper around a commit hash that isnt stored in gitmodules Exactly k I should have created all the issues I had bug/feature requests ya go for it @cruzdanilo can u tell me output of forge --version? forge 0.1.0 (339ff41 2022-03-09T00:17:01.677842+00:00) and the command u are using? forge test --gas-report ? hey, this actually is not causing any problems for me, compilation runs successfully, but with today's version of forge, im getting ERROR ethers_solc::compile: ReqwestError(reqwest::Error { kind: Decode, source: Error(""expected value"", line: 1, column: 1) }) when i run forge build % forge test --gas-report Compiling...",263
376,foundry-support.txt,"Mar 09 16:10:11.283 ERROR ethers_solc::compile: ReqwestError(reqwest::Error { kind: Decode, source: Error(""expected value"", line: 1, column: 1) }) Compiling 3 files with 0.8.11 Compiler run successful Running 5 tests for PoolLibTest.json:PoolLibTest [PASS] testAtomicDepositBorrow() (gas: 58841) [PASS] testInsufficientLiquidity() (gas: 20693) [PASS] testIntegration(uint64,uint64,uint64,uint64,uint64,uint64,uint64) (runs: 6666, μ: 112445, ~: 114444) [PASS] testIntegrationLoop(uint64[6],uint64[6],uint64[6],uint64) (runs: 6666, μ: 140033, ~: 135894) [PASS] testSmartPoolBorrow() (gas: 61418) try --offline Interesting, I wonder if somethign changed in the Solidity URLs again likely something wrong with binaries.soliditylang.org same thing sorry was helping mike one sec is repo open source? no :( hmm can u comment out all tests and reenable them one by one to see if that fixes it? notably comment out fuzz tests hard to diagnosis on closed source repo sure, i am doing this right now pragma solidity ^0.8.4; import { DSTest } from ""ds-test/test.sol""; contract Test is DSTest {  function test() external {   assertTrue(true);  } } wait do u make 0 calls in your tests? This is something that's happening on m1 macs. There's already an issue for this https://github.com/gakonst/foundry/issues/874 gas report by default removes test contracts i believe i am testing a lib ⚰️ yeah we dont have that gas reports are built from call traces so if there's no calls, there's no gas report hmm ^ assuming u arent doing calls we should document that as a known limitation around testing libraries some libs will make calls if they are public funcs i am doing calls on fuzz tests, tho. it's a hack for using expectRevert fuzztests dont get gas-reporting we could add but will blow up memory usage should probably config flag it tho got it.",490
377,foundry-support.txt,.,1
378,foundry-support.txt,"I wanted to know if it make sense what I’ve done for BaseTest that is the sharable wrapper of the tests and how I’ve extended Frankie Utilities in the Utilities.sol Does it make sense? Is there a better way to do that? Basically I would like to have a base test that will setup users and label them if needed. Probably the structure of BaseTest make sense only for this project that is solving dam vulnerable defi CTF that always have exploit`/`success functions (or at least this is how I’ve strutured) https://github.com/StErMi/forge-damn-vulnerable-defi Check the pinned message, you should be on latest nightly not simple 0.1.0 not supported nor this see my comment here :(((; @andreaslb wanna open an issue for these Yup! Then “forge inspect” should be good to go - left those three “modes” commented out in cli/cmd/inspect.rs https://github.com/gakonst/foundry/pull/873 Is there a way to make the fuzzer ignore reverts, whether it be all reverts or a specific chosen subset of reverts with certain messages I'm getting weird compilation errors with the latest release solc complains about incompatible solidity version req. Does ^0.8.11 or >=0.8.11 work? Interesting, ^0.8.11 works. Thanks! So it worked because it was compiling with 0.8.12. If I delete ~/.svm/0.8.12, then it doesn't compile. I think the issue probably is that ethers-rs is fetching solc binaries from this repo which contains only pre-release builds https://github.com/roynalnaruto/solc-builds/tree/master/macosx/aarch64 Getting the same error as Ayush. It uses a -develop build from the 0.8.11 solc . Is this maybe mac m1 related? It says a -develop version note that nightly builds are considered to be strictly less than the released version Installing a 0.8.12 prerlease to be greater than 0.8.11 does not seem to be a great fix for that.",450
379,foundry-support.txt,"😂 I have solc 0.8.11/12 binaries here that you can probably use in the meantime by setting SOLC_PATH and using --no-auto-detect https://github.com/shuklaayush/solc-builds/tree/master/macosx/aarch64 How does the tip cheatcode work under the hood - is it transferring tokens to the 0x0 address or the token’s own address? It works nicely for a generic ERC20, but for an ERC20 with transfer restrictions to those above addresses, I get Execution reverted: Invalid data it writes to the storage of the token, it's not a builtin cheat it's in forgestd see here: https://github.com/brockelmore/forge-std/blob/master/src/stdlib.sol#L70-L76 Great, thank you. Good way to do it, my error must be related to something else then unsure, it works with the majority of erc20 tokens but not all - maybe it is the cheat Any ideas why it wouldn’t work for certain tokens? Since it’s directly writing storage I guess it should bypass any restrictions on mint, transfer etc.",234
380,foundry-support.txt,"My token in question is LUSD (which has restrictions there) but is otherwise conventional: https://github.com/liquity/dev/blob/main/packages/contracts/contracts/LUSDToken.sol unsure - can you try running it with traces on? the cheats in forge-std emit logs along the way it might give a pointer can we write and test yul contracts with foundry? eh, actually i think it should work with LUSD, but I haven't really looked at forge-std before (cc @brockelmore) no yul support yet - curious why u'd want to write a test in yul tho? not necessarily the test in yul, just the contract, test as per current ah Thanks - digging in! well, no, no yul support yet - it is planned tho :) awesome vyper? same? yes, afaik someone is working on it https://github.com/gakonst/ethers-rs/pull/936 here !!! thanks legends, all of you working on this how can i repeat the same counterexample in the next fuzz run? it’s probably a proxy token -i haven’t adjusted tip for proxy tokens because they are obnoxious to setup afaik there is no fuzzer case persistence but it should use a static seed by default, so the same cases are run? don't quote me on that though ye not currently but we can do it later. i generally copy down the variables and just make it its own test not true aight, i swear i read it somewhere in the proptest crate probably unrelated i opened a feature request for that https://github.com/gakonst/foundry/issues/893 Oh hm Cc @rohitnarurkar tracked here https://github.com/roynalnaruto/solc-builds/issues/1 pre-release builds have lower precedence in SemVer than released versions and lead to weird compilation errors Wild I didn't know that TIL Waaaaat how are these builds being made? Locally built cuz there's no GHA runner I think to generate? that'd be prefereable but I don't think there's an M1 runner? but atleast the script used to compile the version should be included.",452
381,foundry-support.txt,"https://github.com/sambacha/solidity-osx That is the tool chain i was using Why cant you cross compile? need osx 11 i c pffft @rohitnarurkar can you push the command you used to compile? FWIW, also having compiler issues after foundryup to latest version (on Macbook M1) i already have it compiling rn make sure your foundry config is sourced from bash_profile and not bashrc (only for osx users) yes bashrc is the correct dotfile, osx does not respect it what versions do you want https://github.com/sambacha/solc-osx-aarch64 ymmv, i dont even have a m1 :( I have 0.8.11/12 here but imo there needs to be a more secure way of sharing/releasing these builds https://github.com/shuklaayush/solc-builds/tree/master/macosx/aarch64 @brockelmore very much enjoying using forge-std. quick quesiton using forge-std slot finder, how do we access slot of non private variables given they dont have a generated getter and hence no function selector to pass to the sig() yeah the more secure way is the solidity team doing it..sigh if there is a public view function that reads the slot at all, you can use that if not, std lib doesn’t support mutating function calls but it’s possible to do it with those but u will have to enter into the record and accesses cheatcodes urself got it thanks! btw in a (uint-> address) mapping why do i have to i access the storage slot for key 0 like this: uint256 slotOfNewOwner = stdstore .target(address(nft)) .sig(nft.ownerOf.selector) .with_key(1) .find(); instead of passing the key 0 of the map to it? if i pass 0 it complains about index out of bounds uhh yeah, look at my repo ser *chrisseth intensifies* Oops, yeah. Typed too soon 😅 can you open an issue about this? oh hmm ye open issue plz vat versions u using here is v0.8.10 https://github.com/sambacha/solc-osx-aarch64/actions/runs/1964220337 👍 Did this build succesfully? Can't find the binary in artifacts.",492
382,foundry-support.txt,"Also, I'm not that familiar but how would this work if github actions doesn't have a m1 runner? https://d.pr/i/qcFioK.jpeg wait it does not have a m1 runner? Lol, you know what. Works perfectly. Even found a bug in my contract 🔥 wait wut so it’s confirmed working? pls let me know before i gouge my eyes out setting up buildkite for m1 as they have physical machines any word on verifying on fantom? I can open issue if that would be better go for it, if there is a script to reproduce the issue, that'd be helpful Hey friends, im looking at expectEmit from the docs and i still dont understand how it works. What do checkTopic1,2,3 and checkData mean? Is there a good example i can look at other than the docs? Thanks :) Will do, cheers In 20 minutes 👇 https://twitter.com/nascentxyz/status/1501945286117117959 Hey guys. I'm trying to test out foundry, coming from Hardhat. One of the things I was looking for is support for something like Hardhat tasks. for a project in particular with decently complex deployment logic I was looking for something similar in foundry (i.e. just writing a script or something to perform all that is necessary to deploy the project all at once). Is there something that can help or should I just stick to Hardhat for this functionality in particular while using foundry for the rest? is forge create broken right now? Even after doing foundryup -b master, forge create command is saying code: -32000, message: Unable to complete request at this time., data: None). It was working yesterday Which network? polygon Polygon is down rn i think? This is not forge related oh, thanks. yeah, sorry didn't check the network state before Yes its down From Polygon: Network update: The team is currently looking into an issue with the Tendermint implementation used by one of the two layers of Polygon PoS chain. All users funds and data remain fully secure but there is a potential threat of Polygon PoS users experiencing downtime sporadically.",449
383,foundry-support.txt,"Running Brock's demo, but having issues: $ forge build --force Mar 10 16:27:47.368 ERROR forge: error=unknown variant `error`, expected one of `constructor`, `function`, `event`, `fallback`, `receive` at line 1 column 326236 Error:  0: unknown variant `error`, expected one of `constructor`, `function`, `event`, `fallback`, `receive` at line 1 column 326236 Location: /rustc/f1edd0429582dd29cccacaf50fd134b05593bd9c/library/core/src/result.rs:1914 tried foundryup normal and nightly also, is there anyway to see what version of solidity is being used? are you on the latest version? it doesn't seem like I am $ forge --version foundry-cli 0.1.0 could have been rugged by previously installing with nix probably as forge version now also emits build timestamp ahhhh, forgot about .bash_profile w/ nix stupid nix and also nix had installed forge to ~/.cargo, which took path precedence over .foundry okay, all good. thanks! forwarding i have this test that deploys bytecode and when i set the verbosity to 3 it logs the entirety of the bytecode There's going to be a new deployment feature that'll make this super easy - Brock previewed it in his talk just now which will be uploaded on YouTube later. Until it gets released, I'm personally using HardHat tasks for deployments and Foundry for everything else, since I heard forge create + cast can be messy for more complicated pipelines. contract BlacksmithTest is DSTest { Blacksmith blacksmith; function setUp() public { blacksmith = new Blacksmith(address(this)); } } How do you get the address of the blacksmith contract? Nvm address(blacksmith) works 🤕 Uhh sounds good. Thanks for the answer. I'll use the mixed approach and wait for the new feature then This is probably a SUPER niche question, but anyone with more experience of rust know how rust/cargo/foundry finds libusb? On m1 macs it can be under /usr/local/Cellar/libusb/ for x86_64 or under /opt/homebrew/Cellar/libusb/ for arm64.",476
384,foundry-support.txt,"Trying to track down how the former is chosen during linking when it should be the latter (when building for native arm64) hey, is it possible to pass function args to forge run ?? Write a test for it and run the test 🙁 haha what i really want to do is write a bash script that passes value to forge run. i can get them in there using ffi but would be sweet if i could define them in the cli honestly i do not know and I'd rather not have the libusb requiremnt unless somebody does cast send --ledger so if you figure it out, that'd be great not supported rn, but we could i think this has some really awesome use cases i can get around by eg writing to a scratch file and importing to the script with ffi @gakonst should I compile with a specific command? I was checking out tags and then “cmake .. && make” From a “build” directory in the issue there's a flag you can give for prod builds i believe Is there a GitHub issue regarding this? ya on svm-rs and on foundry Cool, checking in a few mins Will update the builds and svm-rs in an hour Even after building with the `CMAKE_BUILD_TYPE=Release` flag I see this as the version of the built binary: `0.8.8-develop.2022.3.11+commit.dddeac2f.Darwin.appleclang` try compiling something, does it throw the warning? It should, because the version we're looking for (after a release build) is this `0.8.8+commit.dddeac2f.Darwin.appleclang` checking how they build in the solidity repo Hmm, they build the same way: https://github.com/ethereum/solidity/blob/develop/scripts/ci/build.sh#L30 not sure why there's still the develop.YYYY.MM.DD pre-release tag @shuklaayush have you tried building it yourself in your M1 machine? okay, their scripts/build.sh does it pushing, that should fix the issue Yeah, I used that as well.",432
385,foundry-support.txt,"I think the flag is -DCMAKE_BUILD_TYPE=Release Yea, simply adding that flag does not help (I think there are more cmake options coming from the configs) but the script does build it this foundry too unstable for proper package distribution this libusb causes foundry binary to be non deterministic I have travis ci setup with m1 can you try the binary of this output? Travis supports osx 12 even updated both solc-builds and svm-rs i missread the nightly comment :/ libusb is dynamically linked so what libusb ur system uses (if u have multiple installations) is platform dependent and up to your library search paths not sure how it works on mac but on linux u can use ldd to see what dynamic libs are in an executable and what they resolve to and u can adjust the search paths with LD_LIBRARY_PATH iirc Still haven't found the root cause of how /usr/local/Cellar is discovered/added or which package might be rocking a suspicious cargo:rustc-link-lib, or if its a toolchain setting 😂. All my library path ENV vars are empty https://doc.rust-lang.org/cargo/reference/environment-variables.html#dynamic-library-paths Luckily I can front run it for now and tell it to look in arm homebrews new directory, RUSTFLAGS='-L /opt/homebrew/lib' cargo build --release. Which luckily prepends infront during linking: -L /opt/homebrew/lib -L native=/Users/dekz/tmp/foundry/target/debug/build/ring-5ed5473c10a742c7/out -L native=/Users/dekz/tmp/foundry/target/debug/build/hidapi-rusb-4e1fc547c7421e19/out -L native=/usr/local/Cellar/libusb/1.0.25/lib` Time to go down a rabbit hole of rust linking should the vscode remappings fix all this errors? Or is there a way so that vscode doesn't show them? I ran forge remappings > remappings.txt those look like linter issues ah my bad, you're missing a emit But these are the default tests that come with demo.sol this is the ds-test demo, I suppose? Yeap logs don't work on passing fuzzy tests right ? I'm also having some issues with installing the openzeppelin contracts.",483
386,foundry-support.txt,I ran forge install OpenZeppelin/openzeppelin-contracts which worked but then I don't have the folder on lib same with Rari-Capital/solmate Maybe your git setup is borked? It works on a clean repo Wait you're right. Clean install works. I have no clue how it broke but will start clean and test it again. I only ran the remappings and changed Contract.sol + Contract.t.sol Unclear But glad it worked out Me neither but thanks Geogios.,103
387,foundry-support.txt,"Will keep trying it :) Everything worked perfeclty now 👌 Hello, I would love to know if the team has any plan of maintaining a docker image of the latest version of foundry? Was this bug fixed? https://github.com/gakonst/foundry/issues/457 Still occurring with compiler v0.8.9+commit.e5eed63a and forge 0.1.0 (f01d2f7 2022-03-11T00:05:09.559922+00:00) we're emitting the exact abi that's returned by solc What do you recommend doing? Manually changing the abi file? is this still an issue on older compilers? because constant has been removed With this compiler v0.8.9+commit.e5eed63a yea, let me try with later version With compiler v0.8.11+commit.d7f03943, the error is no longer there, thanks! when using vm.expectRevert(CustomError.selector), is there any way to have it decoded on traces? currently i get this: ├─ [0] VM::expectRevert(0x016a0d68) │ └─ ← () itll be decoded in the next call, but we could add it being decoded in the expectRevert input i..e if the next call fails with the expected error, its correctly decoded yes, but in this case i am debugging a ""Expected revert did not revert"", so there is no signarture if u open an issue we can try to get to it cool 😎 The IDE giveth, and the IDE taketh Do you want foundry or just forge fwiw osx loads from bash_profile, not bashrc as how foundry up configures the env Hi there - Maybe it's a noob question so please bear with me: when using Truffle and likes, you write test for your smart contract in JS which is a bit cumbersome, but at the same time, because of that you can do end to end testing, from the enduser app to the smart contract. Can we do the same with Foundry ? i.e.",448
388,foundry-support.txt,"is there a way I can spawn up a smart contract easily and send my inputs to it from Rust ? (using ether-rs for example) yeah, take a look at this https://github.com/gakonst/foundry-rust-template for example https://github.com/gakonst/foundry-rust-template/blob/master/app/src/main.rs you'd need to deploy it with the standard ethers-rs apis Oh damn that's awesome ! You should definitely put that up in the book (or said differently, I did not see this in the book ;) ) Thanks but this monorepo setup is so that you do your unit testing in foundry and then you do whatever in your rust crate, which can spin up a ganache, talk to a live network or anything do u wanna PR it to the book kind sir Yeah exactly so I can use the bindings in Rust, deploy it to ganache and make my tests in Rust there (IIUC) ye Done you take your abi and just use typechain to generate your types etc for frontend The nice thing about using ""everything in the mono repo"" is that it seems quite easy to put a CI test that does the end to end testing now. Instead of doing it ""manually"". Foundry.",256
389,foundry-support.txt,"I put together an imagine, more than happy to open up a pr and let yall bring it home @brockelmore I often find forge update creating weird git issues with upstream depenencies where they become dirty but you can't commit the changes because they are in submodules forge install Is there a way to clean this or something? instead of update to install deps the first time ah will try that or do you want to actually pull new updates pull new hm they shouldnt be getting dirty is that always the case? any time one gets updated, yes for example a new solmate change makes ERC4626 repo dirty have you tried committing the lib dir updates? yes and that works but its pretty annoying that seems to make sense to me? you pull in changes, they're not committed, you should commit them you want auto commit on update? A shortcut to clean would be better right? yes or a clean is better wait it's dirty even if you commit? why clean? because lets say ERC4626 intentionally doesn't update for some reason I don't want to autocommit on my upstream repo feels incorrect it wont do anything to upstream i believe right but even still Maybe I'm overthinking it I'd rather just forge update of depth 1 instead of infinite depth What is the possibility of being able to write extension crates that can hook into the evm for custom cheatcodes? I know for now we can just build a command out of it and use ffi cheatcode. (Ideally not needing to rebuild forge whenever we need to update plugin) solc checksums failing on m1 latest nightly cc @rohitnarurkar georgios has the fix https://github.com/roynalnaruto/svm-rs/pull/27 but flagging so others don’t update until merged Hey everyone, having a problem with running forge build on a completely new system. M1 Macbook, after running foundryup doing: forge init hello_foundry, cd hello_foundry forge build Getting Error: 0: Compiler run failed  Warning: This is a pre-release compiler version, please do not use it in production.",434
390,foundry-support.txt," ParserError: Source file requires different compiler version (current compiler is 0.8.10-develop.2022.2.18+commit.fc410830.Darwin.appleclang) - note that nightly builds are considered to be strictly less than the released version Did some digging and this seems to be the most relevant issue, marked as resolved but not sure how to implement this solution into my system? https://github.com/roynalnaruto/solc-builds/issues/1 Is anyone else experiencing this? *Note* Found the issue, since I had this problem this morning it was solved. For future reference this is what fixed it! https://github.com/gakonst/foundry/issues/892 Nuking SVM Sorry for cluttering the channel 😅 @gakonst would that make sense to have in the stack trace who’s the msg.sender of the transaction? Hey Jacob, were you able to find a solution to this? It's fixed, I put in my own patch Yep this unfortunately happened to whoever installed that version during a couple of days where the bug existed Should no longer be an issue Hi there - i searched in the chat and ppl have been asking the same question: can we use upgradeable contract from OZ. Brock seems to say ""yes since everything's in Solidity"" but here's the noob question coming: Looking at OZ docs, it's not, they have a specific library for truffle and hardhat to wrap the contract into their upgradable one when they interact with it (https://docs.openzeppelin.com/upgrades-plugins/1.x/truffle-upgrades). How does one do that in Foundry ? Does anyone have an example where we can have a look ? Hi guys! I have a contract in vyper (😵 curve gauges) and everything else its in solidity. I am looking for a possible way to keep using foundry for testing. Any idea / gh repo for how to get the vyper contract to be tested? I was thinking perhaps using the bytecode of the contract, but not sure how that will work.",428
391,foundry-support.txt,"Thanks! see here https://github.com/gakonst/v3-periphery-foundry/blob/main/contracts/foundry-tests/utils/Deploy.sol#L32 on how to deploy from an artifact 🙏🙏 thx Updated to the latest and am now getting are you on M1? which solc version is your proj using? Can you pass --offline? yes on m1 ah ok offline has useful messages TLDR of the issue: We bumped svm-rs, previously it used Rosetta Solc binaries for M1. The latest version uses native M1 builds which do not require Rosetta, but they only exist for 0.8.9-0.8.12. But if you had the solc version installed from the previous update, it tries to check the M1 checksum, which doesn't exist in the M1s This happens because the Solidity team doesnt publish M1/ARM binaries, so we have to build & deploy them ourselves This is done automatically here: https://github.com/nikitastupin/solc/, but unfortunately for M1 there is no runner, so we can't set up a CI job I think this is what is needed https://github.com/actions/runner/pull/1618 ah ok, so is there any action for now or just run offline? If this keeps happening and --offline doesnt solve it for people I'll revert to the previous svm-rs version We are going to publish all the missing solc versions just need to manually compile them - @rohitnarurkar is on it @wilsoncusack which version is your project on? 8.6 but I can bump Yeah if you go to 8.8+ you'll be fine, see https://github.com/roynalnaruto/solc-builds/tree/master/macosx/aarch64 Wonder if we could cross-compile somehow? https://github.com/gakonst/foundry/blob/master/.github/workflows/release.yml#L88-L91. Not sure if that'd work https://stackoverflow.com/a/65385996 yeah not sure. I am also now getting, even when setting optimization runs to 0. But maybe something on my side.",455
392,foundry-support.txt,"Haven't touched this repo in a little while I sent a bump here https://github.com/ethereum/solidity/issues/12291#issuecomment-1065878089 this is unrelated, probably gotta move your code around a bit? big function? is optimizer on/off? as I said, doesn't work even with optimizer off. But this was for sure running with foundry like ~ 1 month ago. Will investigate maybe I need the toml and some settings there might be newer solc? did it work with 0.8.6 and --offline? no was same just assume I made a mistake somewhere Hey guys, i'm running into lib-path issues when trying to link to brownie-installed packages OpenZeppelin. Tried running this: forge build --root . -c contracts --lib-paths ~/.brownie/packages and got this: ParserError: Source ""OpenZeppelin/openzeppelin-contracts@4.3.0/contracts/token/ERC20/IERC20.sol"" not found: File not found. ... | 4 | import 'OpenZeppelin/openzeppelin-contracts@4.3.0/contracts/token/ERC20/IERC20.sol';  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ iirc it was working fine before switching to foundryup What's your version? You might need to add a manual remapping? ❯ forge --version               forge 0.1.0 (1d31ecb 2022-03-12T00:13:44.180973+00:00) this is setting via foundry.toml right? Tried putting this in foundry.toml: remappings = [  'OpenZeppelin'='~/.brownie/packages/OpenZeppelin' ] and got this: ❯ forge build --root . -c contracts --lib-paths ~/.brownie/packages --force The application panicked (crashed).",409
393,foundry-support.txt,"Message: failed to extract from provider: Error { tag: Tag(Default, 2), profile: Some(Profile(Uncased { string: ""default"" })), metadata: Some(Metadata { name: ""Backwards compat provider"", source: None, provide_location: Some(Location { file: ""config/src/lib.rs"", line: 736, col: 14 }), interpolater: }), path: [], kind: Message(""expected a right bracket, found an equals at line 6 column 19""), prev: Some(Error { tag: Tag(Default, 2), profile: Some(Profile(Uncased { string: ""default"" })), metadata: Some(Metadata { name: ""Backwards compat provider"", source: None, provide_location: Some(Location { file: ""config/src/lib.rs"", line: 736, col: 14 }), interpolater: }), path: [], kind: Message(""expected a right bracket, found an equals at line 6 column 19""), prev: None }) } Location: config/src/lib.rs:271 Well ya you have a quotation mark extra Remove the quote around the = ah im dumb. thanks @gakonst is there a way to get more info when I see reverts like this?  [5701] SideEntranceLenderPoolTest::test_Exploit()  ├─ [0] VM::startPrank(Attacker [0x9af2e2b7e57c1cd7c68c5c3796d8ea67e0018db7])  │ └─ ← ()  ├─ [1150] SideEntranceLenderPool::flashLoan(0)  │ └─ ← ()  └─ ← () Failed tests: [FAIL. Reason: Revert(Reverted)] test_Exploit() (gas: 5701) Encountered a total of 1 failing tests, 0 tests succeeded I usually use console.log for debugging (use -vvvvv flag) Are there any known issues for installing on foundry on centos? I get the error that glibc is version 2.29 is needed but centos 8 is only up to versio n2.28 check the readme. it covers this error iirc @brockelmore sorry for pinging but just wanted to know if I’m on the right path.",488
394,foundry-support.txt,"Does it make sense to have a wrapper contract like that? yes, you have to Install.from source unfortunately note this is because centos and ubuntu ship an outdated glibc in their kernel switch to arch ;) Anyone else getting Solc errors on a freshly initialized project? Could be something got borked on my machine but wanted to see if anyone else is seeing issues Nuke your ~/.svm folder I think that solves Using the mono repo structure, is there a way to get back the bytecode from the bindings of my contracts (so from Rust land), so I could deploy them using ether-rs ? The ether-rs ContractFactory requires the ABI (which is available from the bindings) and the bytecode of the contract but Im not sure how to get the bytecode... Success, thank you! 👌👌 Uh @mattsse what was the way to retrieve an artifact bytecode by name again? Alternatively @mattsse should we start making abigen operate on json artifacts so that it can ingest bytecode if present, instead of just the abi, and expose a deploy method on the codegen rust so you can do Greeter::deploy? Otherwise @nikkolasg temporarily you'd need to manually get the json of the contract yourself, Deserialize it as a CompactContractBytecode and use that? Will add some helper functions to access that directly rn iirc you need to go via cache Since deploy is not a trait function I think should definitely do generate a deploy function and embeds the bytecode in the code as well? Yes exactly If bytecode is present in the artifact, codegen a deploy function ser i dont work here above my paygrade Yeah that would be awesome, enables a nice compatibility with ether-rs and get the full end to end picture of foundry. Ok will try to take it manually in the meantime by the method you suggest. Thx. Lmfaooo understood. I put the pr together. For free 🤣 👌👌👌 Is there any way to determine in test contracts if the tests are being executed on a fork of a chain? For example: forge test --fork-url ... in a test function something like this function testX() public { if (forked) { /* Test the thing */ } }. gm sers.",462
395,foundry-support.txt,"i have a function function stake(uint256 _amount) external payable {   address owner = msg.sender;   require(_amount <= msg.value, ""Insufficient balance""); and in the test, i took the example from SafeTest and did contract Bob {  receive() external payable {} } function testStake() public {   payable(address(bob)).transfer(2 ether);   cheats.prank(address(bob));   staker.stake(1 ether); but it is failing and im getting `""Insufficient balance""` as the error. does anyone know the corect way to transfer some ether to a user? i was thinking that _amount should be 1 ether and msg.sender should 2 ether in the example above right? cheats.deal(address(bob), bobsNewBalance); oh wait hmm oh staker.stake{value: 1 ether}(1 ether) you have to pass the value in the call via the above oh cool, it works now! thanks Brock 🙂 what is the point of `payable(address(bob)).transfer(2 ether);`? as in, in the SafeTest example, payable(address(safe)).transfer(amount); that transfers eth to bob from the test contract how do i fund the test contract? u can always use cheats.deal(address(this), amountToSetBalanceTo) but it is funded at start with (1«128) -1 eth i believe maybe (1«96) -1 yup, 2**96 wei which means payable(address(bob)).transfer(2 ether); should fail if i dont fund my test contract, right? no - the test contract is always funded at the start of the tx wait no i may be wrong i forget off the top of my head lemme check thank you 😅 ye its funded w/ (2**96)-1 eth most likely what you actually want is require(amount == msg.value, ""Bad stake amount""); and probably will want a reentrancy check as well ok thank you! lemme check 😄 I don’t think so, but the default block number/timestamp on a non-fork is zero so you could leverage those, e.g.",439
396,foundry-support.txt,"if you’d be forking mainnet: function isFork() public view returns (bool) { return block.number > 14_000_000; } So I read the JSON outputs in contracts/out/..../mycontract.sol with let ccb: CompactContractBytecode = serde_json::from_reader(file).unwrap(); and then to get the Bytes (what ContractFactory expects) I do ccb.deployed_bytecode .unwrap() .bytecode .unwrap() .object .into_bytes() .unwrap() It seems a bit longish (to go from CompactDeployedByteCode to Bytes), am i doing the right thing / is there a better/shorter way to do this ? I'm trying to play around with the v3UniPeriphery tests that @gakonst and @odyslam recently ported but am having trouble w that repo. not sure whats going on. other foundry repos seem ok. ive recloned repos and reinstalled forge/cast a cpl times to make sure. keep getting weird checksum not found could it be related to the compiler version? i didnt see a foundry.toml or any other foundry config files in that repo but wasnt sure if that was necessary? Foundry Support this repo: https://github.com/gakonst/v3-periphery-foundry forge 0.1.0 (1e1583b 2022-03-13T00:08:24.451192+00:00) nvm. i answerd my own question -- it was a compiler thing. once i added a foundry.toml specifying the solc version everyhthing worked mystery to me though, when I do forge remappings I see what appears to be the correct mappings for the @npm style uni package dependencies... but I couldnt find a foundry.toml file or a remappings.txt so how did it know? 🤔 I am trying to run test on a hardhat node. Here is what I have done. Started the node with: npx hardhat node --fork https://eth-mainnet.alchemyapi.io/v2/<key> And then running the test with: forge test --fork-url http://127.0.0.1/8545 However it is not working and I am getting the error as seen in the screenshot.",478
397,foundry-support.txt,"Can somebody please help me by pointing out as to what I am doing wrong? we scan the lib folder or node_modules when hardhat and try to detect them automatically rhe total set of remappings is created by merging them from env,toml,txt,autodetect The url looks wrong, could you please make sure you called 127.0.01:8545 and not 127.0.0.1/8545? My bad. the url was wrong 😅 Thanks! is there a good way to test internal functions in forge? you can inherit from the contract ah so i make a test contract that inherits and exposes the internal function publicly that makes sense thx const message = ethers.utils.defaultAbiCoder.encode( ['address', 'address'], [userAddress, contractAddress] ); const hash = ethers.utils.keccak256(message); const signature = await signer.signMessage(ethers.utils.arrayify(hash)); Is it possible to sign a message in the testing contract? yeah check vm.sign ty ser vm.sign(keccak256(abi.encodePacked(userAddress, contractAddress)) i forget if it prepends the eth sign hash i believe it does you need to also pass the private key as the first arg vm.sign(pvk, digest) yeah^ sorry Found an example here if someone needs to do the same thing: https://github.com/dsam82/ps/blob/a770881421e5f0775223f016e96bde8a86110f2d/src/test/ERC20Permit.t.sol ^answers this Q we should add maybe to the book? Thanks I’ll take a look gm sers, im looking at expectEmit from the docs and i still dont understand how it works. What do checkTopic1,2,3 and checkData mean? Is there a good example i can look at other than the docs? Thanks 🙂 https://github.com/gakonst/v3-periphery-foundry/blob/main/contracts/foundry-tests/SwapRouter.t.sol#L186-L205 https://github.com/gakonst/foundry/blob/master/evm-adapters/testdata/CheatCodes.sol#L377-L455 cool thanks ^ if any of the values are false, then the event can have any param there i.e.",468
398,foundry-support.txt,"expectemit(true,false,true,false) will only check the 1st and 3rd indexed topic and ignore everything else for example, in testExpectEmit(), it reads hevm.expectEmit(true,true,false,true); emit Transfer(address(this), address(1337), 1337); 1. what are we checking address(this) against? as in what is it compared to? 2. true, true, false, true means we want to check address(this), address(1337) but not 1337. what is the motivation behind leaving out 1337? 3. when we do checkData = true, what does it mean for emit Transfer(address(this), address(1337), 1337);? from = address(this) sorry for asking the dumb question. thanks for helping out though 😄 to = address(1337) amount = 1337 there's no 3rd inexed topic, so the value can be true or false true true false true still checks 1337 its topic0-1-2 and data in transfer, the amount is not an indexed topic so it's part of the data field ""checkData = true"" means ""check the valuse of non-indexed topics"" thank you ser. i'll take a look at a few examples and think about it. i kinda get it now. 😄 it's definitely clearer to me now if you want, a PR to Foundry Book that explains it intuitively would go a long way understand that the cheatcode is not the msot intuitive to use rn, sorta liimted by solidity cool, understandable. thanks for your patience 😂 i rlly like the convenience it offers 🙂 https://github.com/onbjerg/foundry-book <-- anye xtra docs here would be great yes sure! lemme try to explain in my own words and i'll do it (uint8 v, bytes32 r, bytes32 s) = vm.sign(signerPrivateKey, msgHash); vs const signature = await signer.signMessage(ethers.utils.arrayify(hash)); let { r: r1, s: s1, v: v1 } = ethers.utils.splitSignature(signature); I checked the private keys and hash both match.",457
399,foundry-support.txt,"Anyone knows why signatures don't match? Thanks and sorry for the spam! Ethers-js will prefix with Ethereum Signed Message so I believe you need to do the same https://github.com/gakonst/foundry/blob/master/evm-adapters/src/sputnik/cheatcodes/cheatcode_handler.rs#L763-L766 this signs a hash directly, without touching it suspect u need this https://github.com/gakonst/ethers-rs/blob/dcf20022c66921779059bbfc58f5d378d20b84be/ethers-core/src/utils/hash.rs#L9-L22 https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/utils/cryptography/ECDSA.sol#L203 try doing vm.sign(signerPrivateKey, keccak256(abi.encodePacked(""\x19Ethereum Signed Message:\n32"", msgHash))) mhm I tried but still different Got it - please open an issue then with repro code (solidity + js) and we can investigate okok i messed up, now works removed ethers.utils.arrayify(hash) by mistake, adding Ethereum Signed message works, cheers! so it was missing yeah? yeah cool cool we cannot be doing ti for the user, because it wouldnt support eip712 style sigs so you have to do the prefixing yourself which is standard in most solidity Fair enough, didn't know about it (semi new to solidity). Thanks for the help (: we are expecting a failure for  function testFailExpectEmit() public {   ExpectEmit emitter = new ExpectEmit();   hevm.expectEmit(true,true,false,true);   emit Transfer(address(this), address(1338), 1337);   emitter.t();  } but why it does not do any error handling like hevm.expectRevert? this test is going to fail due to testFail you can either write failing tests this way, or with the cheat code LOL magic. got it. i suspected so.",414
400,foundry-support.txt,"haha is it documented anywhere? might have overlooked i think so https://onbjerg.github.io/foundry-book/forge/writing-tests.html ctrl+f testFail cool, thanks! 🙂 should we always open an issue before submitting a PR? getting `remote: Permission to gakonst/foundry.git denied to bblanc42.` ah also, would be great if i can also get permissions to foundr-book, getting `remote: Permission to onbjerg/foundry-book.git denied to bblanc42.` I figure you usually work on a fork and do the PR against the original repo. oh lol ok, i thought i could just clone and make a branch? does this way not work ^ ? Any particular things I should be checking if on CI the check bindings consistency fails ? > Bindings found. Checking for consistency. > Error: > 0: file contents do not match Locally it works. I guess it's a version stuff, but I'm using latest foundry... That's it yes, you clone, do your change and then open a PR against the original repo. There shouldn't be any weird permission issue there. that that was how i went about it tho, i cloned -> made a branch -> made changes -> git push are you sure you are pushing on your fork ? (git remote show) what does git remote show origin returns ? if it's the original repo you must tell git to add your new fork (git remote add myfork <url>) and then push on it git push -u myfork refine-testFailExpectEmitWithCall1-to-only-check-for-data) thank you ser. what does <url> refer to? i havet not managed to push so i dont have a url for my PR yet 😮 let's continue in DM Here's what CI tells me, but the check pass locally. Not sure what is different. If anyone has an idea 🙏 This indicates the generated bindings are outdated and need to be regenerated. The error message is a bit poor, mind opening an issue so we can track adjusting that? But locally it passes, my git doesn't show any difference, i.e. bindings/ locally and on github are the same, so why the error ? (ie.e forge bind --bindings-path ./bindings --root ./contracts --crate-name bindings returns OK on my machine and bindings/ is tracked on github) hmm Same version? I think so.",495
401,foundry-support.txt,"I used the foundry installer as shown in the book and I'm using the Github actions from the mono repo template from gakonst How can I check? hmm Good q, running forge —version in CI should do it I don’t think the installed version is emitted in foundryup but should probably be displayed thank you for helping me to understand. here is the PR: https://github.com/onbjerg/foundry-book/pull/106 🙂 It might be that the order of the bindings changes per run? So the content is different possible, will check Hi all, New to foundry and want to learn more about this tool who seems amazing 🙂 So I create a basic contract with a deposit function that when Alice call the deposit function it transfer an ERC20 from Alice to the deposit contract. When writing test how to set the alice approval before calling deposit function ? Check out the prank / startPrank cheatcodes! Oh ok I see is it possible to log/see all the value passed when a fuzzer is used ? Ok thanks for the tip - indeed, forge on CI was different than on my machine, I redid foundryup on my machine and then bindings were changed. We may need to think about compatibility between versions because both CI and local versions were 0.1.0 so I was expecting the build to be compatible but the commit were not the same exactly. Anyway, thanks ! Yeah run with RUST_LOG=evm-adapters=trace Got this with the last update, any workaround ? try nuking ~/.svm Perfect, thank you Is there a recommended way to write deployment scripts instead of deploying with forge create --rpc-url ...? Currently bash scripts, but we are working on a new flow based on Solidity any plans for flows executing transactions for protocol through solidity. For eg: protocol proposals? You can do it via ""cast send"" Not sure if it’s possible but it would be very nice if the deployment system can read environment variables & read from files (json/toml) ++ yeah, that'd be awesome It’s my only blocker from migrating to Foundry. Prefer it so much to hardhat haha but I always try to use the same deployment system for testing & production is there any more info about that somewhere (PR, Github issue...)? I'm writing an article about Foundry and I could include that new deployment tools are planned I am aware of this.",490
402,foundry-support.txt,"However, for our protocol the proposal gets generated through multiple steps and it would be great if no manual intervention is required. Using cast to execute it would need copy pasting and also setting up other parameters. How much time do people spend deploying vs testign? Can people drop their desired deployment features here? https://github.com/gakonst/foundry/issues/402 @uF4No see this issue with the broadcast cheatcode * https://github.com/gakonst/foundry/issues/402#issuecomment-1022530001 * https://github.com/gakonst/foundry/issues/402#issuecomment-1013930576 You can use Hardhat for deployment + Foundry for tests btw, no special change should be needed But then testing deployments will be in solidity while the production deployment will be in typescript right? Nice, will try to add stuff to this Right - that's the tradeoff idk how comlex your deployment gets thank you, where am I suppose to add this ? RUST_LOG=evm_adapters=trace forge test or RUST_LOG=evm_adapters=trace forge test | grep ""fuzz: input"" ok thank you 🙂 is it possible to have sendSignedTransaction with foundry? what do you mean exactly? didn’t want to spoiler 😄 I’m doing a CTF and I need to craft a tx given a privatekey I know how to do it with ethers but not with cheatcode/solidity Using the debugger I'm seeing that the stack size only every increments, even after POPs, is this a bug? how many items are on the stack? currently if the stack is more than what fits in the pane, it is hidden so when you pop things do leave the stack but you may not notice A ton of items haha, but I'm talking about the stack size count at the top of quadrant 2 oh that’s actually unrelated to stack and it’s basically the current number of executed ops it’s dumb sorry was a left over from debugging the debugger lol Ah I see, no worries man I think onbjerg may need to update the book with that info as well will just fix it in #920 instead im running a script with forge run and quite confused bc it was working for me (on a different machine) and now im getting The application panicked (crashed).",480
403,foundry-support.txt,"Message: No target contract any ideas ? Check coinbase address most likely its set to the 0x0000 address Are you running the latest foundry version? Sure 3:1 ratio for new strategies is typical at yearn for example While running the test seen in the screenshot on a hardhat node forked from mainnet. I am getting the following error: Errors encountered in param 1: Invalid value ""0x0000000000000000000000000000000000000000000000000000000000000001"" supplied to : QUANTITY However, I am able to execute the same code via hardhat without any issues. I think @brockelmore mentioned that hardhat doesn't follow specs This https://github.com/nomiclabs/hardhat/issues/2230 they dont follow spec Ohh, is there a workaround? Use forge to fork mainnet That is not working as well. The test still fails The trace is the same in both the cases yeah i am v interesting... i figured it out. i had changed the capitalization on a folder that imported from forge test still worked ! hello all, started playing w foundry and porting yearns strategy template to it, i guess ill have more Qs as i stumbled into them but glad to be here 👋 how do you prevent forge from recompiling contracts when running forge test? Might be a cache bug, can you open an issue with a repro? https://github.com/gakonst/foundry/issues/941 saw you closed out a similar issue so recreated another with the repo linked could it be fixed by https://github.com/gakonst/ethers-rs/pull/1029? what's the best way to test with that change? is there a branch with that change incorporated I can run forgeup -b with? clone ethers, checkout the branch, clone foundry, uncomment https://github.com/gakonst/foundry/blob/master/Cargo.toml#L26-33, build from source it’s related to errors.sol which does not emit artifacts and somehow gets excluded.",429
404,foundry-support.txt,"Debugging rn 👍 not sure if it helps but my repo had an errors.sol file defined as well in the contracts folder - might that be causing a mix-up? Fixed here https://github.com/gakonst/ethers-rs/pull/1035 Swag I’m getting wildly different gas cost on Foundry vs on Remix (with the numbers on Foundry being unusually small). Is there anything I need to pay attention to? Testing out SSTORE2 of Rari. On Foundry test1 costs just 3875 gas vs Remix costs ~25k foundry removes fixed transaction fees. so 21k + 64 is remove for base fee plus calldata cost Actually on Remix it costs 46k, I have subtracted the 21k I’m reading 10 address variables from a dynamic array (so packing is not possible), I think the gas cost should be around 10 x COLD_SLOAD ~ 25k? can you screenshot the output of forge test -vvvv -m test1 Here it is oh duh. u don’t actually do anything in test 1 there is no way remix says it’s 45k what’s the gas of test2 For test1, I read gtokens into tokens, and hrere is the cost on Remix: For test2: is optimizer on or off here optimizer is on, 10000 On Foundry, I’m using the default setting, which is 200 runs I believe i would break out the debugger personally to see what’s happening compiler versions are the same? Same yeah, 0.8.11 I have tried to make everything the same This is the test if you need it Personally I feel like 3875 doesn’t justify it for me (Have tried adding some code to use the tokens just in case the compiler somehow optimizes it out, but the gas cost is still very low ~5000) i’ll take a look Much appreciated! Just in case, can you try running this against the revm branch? Okay lemme try We'll be switching to it soon, and wonder if it solves it.",430
405,foundry-support.txt,"We did make some changes internally `cargo build --release` on branch revm is hitting error: couldn't read cli/test-utils/src/../../../evm-adapters/testdata/DsTest.sol: btw good ole unix fs :))) Just added the missing file and it has been built successfully @gakonst it works 😄Now the numbers perfectly match the numbers on Remix Hi, how do I correctly set remappings.txt? $ cat remappings.txt solmate-utils/=lib/solmate/src/utils/ $ ls lib/solmate/src/utils/ReentrancyGuard.sol lib/solmate/src/utils/ReentrancyGuard.sol But when I try to use it: import ""solmat-utils/ReentrancyGuard.sol""; I get this error: Unable to resolve imported file: ""solmat-utils/ReentrancyGuard.sol"" are the remappings included when you run forge config? It seems so remappings = [  'ds-test/=lib/ds-test/src/',  'solmate-utils/=lib/solmate/src/utils/',  'solmate/=lib/solmate/src/', ] ah, I made a typo when importing. Sorry, it works now! Hi again... How do I actually test for overflow/underflow? This code doesn't pass test: ``` pragma solidity 0.8.12; import ""ds-test/test.sol""; interface CheatCodes { function expectRevert(bytes calldata) external; } contract UnderflowTest is DSTest { CheatCodes cheats = CheatCodes(HEVM_ADDRESS); function testUnderflow() public { cheats.expectRevert(abi.encodeWithSignature(""Panic(uint256)"", 0x11)); _underflow(); } function _underflow() private { uint256 a = 0; a -= 1; } } ``` forge test resut: Failed tests: [FAIL. Reason: Arithmetic over/underflow] testUnderflow() (gas: 3682) ser you have your target function within the testing contract.",407
406,foundry-support.txt,"it needs to be in an external contract you are testing contract UnderflowTest is DSTest {  CheatCodes cheats = CheatCodes(HEVM_ADDRESS);  Ext ext = new Ext();  function testUnderflow() public {   cheats.expectRevert(abi.encodeWithSignature(""Panic(uint256)"", 0x11));   ext._underflow();  } } contract Ext {  function _underflow() public {   uint256 a = 0;   a -= 1;  } } this should pass hello, is it possible to pass in constructor arguments to the test contract when running $ forge test? Nope ok thank you! hmm I'm trying to verify contract through rinkeby and I'm getting an OK response but there's no sign of api call on etherscan and contract isn't verified it takes a minute or two for testnets to update iirc gotcha 👍 Yeah either this or if There’s something off can you open an issue with link to repo if public? Trying to add some verify tests, because we’re perhaps missing some edge case when flattening still not verified doesn't seem to be sending an api req the new updates seem to have wiped my remappings (they no longer work), anyone know why? 🤔 .txt or toml? Can you open an issue with your remappings file and output of forge config and describe your issue? .txt, also it only happens with other forge projects as dependencies hi! where might I find the current production build's version number? i'm running forge 0.1.0 (9de25d1 2022-01-26T04:59:23.324966+00:00) and wondering if its out of date as I'm encountering an Invalid data error when using the label cheatcode. This is 2 months old Check bullet point 3 sorry For getting latest version The string in the command here is the build date yes that string is what outputs when i call forge --version after calling foundryup. check bulletpoint3 pls 😄 your which forge is prob wrong ^^ fixed. thank you for your patience yay nice reminder to always check pinned msgs folks 🙂 I just managed to get it verified on rinkeby, you can use the command forge verify-check to check if it failed or not.",474
407,foundry-support.txt,"Documentation that was useful was this one https://onbjerg.github.io/foundry-book/forge/deploying.html https://github.com/gakonst/foundry/blob/f137539944ac554d62d357a689e21308a4fa73f8/evm-adapters/testdata/Contract.json question, if i can get a vyper contract to produce this artifact, would deploy and getCode work just the same, or do i need something else? Ye should work Just need a solidity interface around it With same casing on functions etc The artifact can also be simpler Just bin/abi No need for runtime the full object iirc cool, will have a go at it it's my imagination or compiling before tests now takes more time? On latest? With cache? Uncached too? Uhhhh it seemed faster to us when we benchmarked Can u share repo must be doing smth wrong i guess, trying to check if i can deploy first weth.json example here https://github.com/gakonst/v3-periphery-foundry/blob/main/test/contracts/WETH9.json but getting the following error: [FAIL. Reason: Setup failed: Execution reverted: missing field bin at line 156 column 3, (gas: 3329)] testExample() (gas: 0) vault.json fails w same reason What is the key for the bytecode? bytecode Mm Guess we don't have that and need to extend its from this example https://github.com/gakonst/v3-periphery-foundry/blob/main/test/contracts/WETH9.json let me check, it was an old repo that I just updated foundry version same json artifact Yeah if you can share repo and before after times Are you on latest version? apparently not updated w foundryup, now it deploys weth, unto vault now thx 👌 found the issue @gakonst internet speed kind of affects compiling time If I turn off internet I get this error mmm telegram doesn't like my image 😂 Was this ever answered? I was wondering as well.",424
408,foundry-support.txt,"forge test --offline It's very smart now The auto detection by @mattsse is quite advanced what's the benefit of being online? Wow can foundry print a trace log for a on-chain tx? you can recreate it in a forge run call offline disables fetching solidity binaries from remote i have m1 CI setup working now https://github.com/sambacha/solc-osx-aarch64/blob/master/.travis.yml Do you need to fetch them on every test? they are downloaded and reused So something is wrong on my repo that downloads it every time I run a test? can --fork-block-number take latest as a value ? meaning rn it only accepts digit latest is the default 😧 just remove the cli flag https://twitter.com/storming0x/status/1503970927872200705?s=20&t=kM08t6UClxyOga30NwuslQ Thanks for the help, i got it working and following Brock's video + georgio setup on uni + plenty coffee Traces are godtier Try nuking the ~/.svm folder If it still happens, that’s a bug In a function I have defined drop(string calldata URI) which performs emit on event Drop(string URI) Now, if I do a test with URI=""somestring"", vm.expectEmit(true, true, true, true); emit Drop(URI); contract.drop(URI); This fails. However, if I replace URI with the raw string, the test works. Any idea why? Is this expected behavior? Mind opening an issue with a repro for this? yeah, it's a super weird bug that I can't seem to replicate with a barebones contract setup - changing the string to constant seemed to fix it (although I'm sure that URI is not modified) worth making an issue and linking to the repo in its broken state? i've def encountered similar issues before too, though yes, issue + link to repro with minimal example is best! thank you Interesting issue.",408
409,foundry-support.txt,"I keep getting “nothing changed, compilation skipped” without having an out directory with the artifacts https://github.com/odyslam/foundry-upgrades/tree/feat/core Cc @mattsse It works though in other repos 👀looking The cache is showing though I'm using CAST and I'm trying to call the balanceOf method of an erc20 contract, but I'm unable to pass an address as an argument like this: cast call --rpc-url https://rpc-endpoint/12345 0x44F4B3639B27E76c55C829DBEb99A4874B2bC0DA ""balanceOf('0x123456789')"". It fails with error Illegal ABI.",150
410,foundry-support.txt,"How can I add parameters in cast? ""balanceOf(address)"" ""0x1234"" You don't put the argument inside the function signature 2 separate args ohhh, I see 👌 thx Sir it compiles fineeee wtf let me push the latest version only a typo 🙃 Pushed latest Sorry for that @mattsse nbd Also tried sudo forge build, but nada Ah so shouldn't do anything 😅 does anyone have an example of using deployCode() w arguments? 🙏 maybe some perm issue that didn’t allow forge to creae out dir and failed silently sec https://github.com/gakonst/v3-periphery-foundry/blob/67d6f43d8151531e6351d766343cc92daaa7dae4/contracts/foundry-tests/utils/Deploy.sol#L32 those dont pass arguments 😢 https://github.com/gakonst/v3-periphery-foundry/blob/67d6f43d8151531e6351d766343cc92daaa7dae4/contracts/foundry-tests/utils/Test.sol#L30 Basically we want that ,but with args https://github.com/brockelmore/forge-std/blob/master/src/stdlib.sol#L80 its here, just wanted an example of usage A quick google search, landed me here https://ethereum.stackexchange.com/questions/78738/passing-constructor-arguments-to-the-create-assembly-instruction-in-solidity have you seen this? you need to do abi.encode(...) your arguments, that's it oh ok, thanks! makes sense deployCode(code, abi.encode(arg1,arg2,arg3)) if you don't see it in the docs, do you mind opening a PR with the ideal documentation that you would've wanted? @kesarito https://github.com/onbjerg/foundry-book would go a long way 🙂 prob something on your local setup, check directory perms etc., this shouldnt be happening made a pr to the source code to add that yeah, super wierd sure. Since its related to forge-std should we create a new section similar to ds-test Reference // Cheatcodes Reference ? stdCheats its a wrapper on top of cheacodes, wondering where this will fit better :) Sounds good to me, defer to @onbjerg on bet place on your system it builds normally? I git cloned into a diff directory and it’s the same situtation.",500
411,foundry-support.txt,"lol that was a weird one, I found the underlying issue. solc not necessarily used the same file path in its output, for example it capitalizes upgradeProxy.sol to UpgradeProxy.sol So we ended up swallowing all the errors… In the meantime try to use capitalized files names What was your process? I want to start being able to find these myself 😅 Patched local version with debug prints riddle in the code path you suspected ? dumped the json compileroutput and checked that will investigate how to conditionally include this in a trace or write to file Nice, thanks for this 😊 patched to this branch https://github.com/gakonst/ethers-rs/pull/1041 or if you rename your files you should see the „refert“ error 😅 fixed it by renaming the files in 2 steps, as macOS is case insensitive thanks for digging into this. hi all, does Foundry support multiple versions of solidity compilers like hardhat? Yes awesome! watched Brock's seminar, excited to port our work to Foundry 🤓 fyi the error resurfaced even in a repo with capitalised files. Same repo? yy want me to push? Yes please! how can i get a rpint of all these tracing! rust_log=debug doesn’t cut it run with RUST_LOG=ethers=trace nope, everything checks out as far as forge is aware, everything went ok: ` Mar 16 16:33:24.534 TRACE compile: ethers_solc::compile::project: compiled input, output has error: false ` okay pushed @mattsse does foundry test have the running time? would be great for comparing our CI vrs foundry.",349
412,foundry-support.txt,"FYI these tests in brownie are down to 15s w fuzzing on foundry 😱 that was one of my motivations for this, our CI takes ages to run Last commit still has a couple of errors that I’m not sure how to fix so can’t debug at this stage on per test basis? or total? total, when you run forge test -vvvv or smth 76s -> 15s? yes for this test suit, and brownie ones dont have fuzzing 😁 how long does compiling take on brownie vs foundry? without tests fairly similar, just tested is like a second better for foundry and hardhat? still like 3s or so, since this only has 1 contract ah i see wonder how it is on bigger repos altho we dont have vyper yet dont have one for hardhat, we are getting a contributor to port them to, we want choice of framework for anyone doing strategies yeah i guess thats where you will see more benefits still keeps happening --offline flag does help goes from 4 secs to 1 sec Yeah I suspect it's the ""check for new solc versions"" check happening every time slowing things down on a slow network connection yeah yesterday with my connection was 8 secs currently I'm running a lot of stuff on my local network so will just use offline for now not sure why needs to run a check for new solc if I put an specific version in my contracts The autodetect feature needs to know what versions exist so it can find one that’s compatible with all files.",320
413,foundry-support.txt,"We should makes this offline first and store the list of available releases on disk I guess wen hardcoded checksums in svm there are yeah instead of detecting for new version always maybe we should look for new version _only if_ we didnt find a matching version? this is just for new version check @brockelmore ahhh word so no http call out when we have the versions needed right? yep yes, I do see for example that the .svm folder updated and downloaded the version I use sorry for my late reply ser, I can confirm that your solution works I'm setting up Forge (`0.1.0 (1d31ecb 2022-03-12T00:16:00.034811+00:00)`) inside an existing Hardhat project with multiple compilers configured (`0.6.12`, 0.7.6, and 0.8.9`). `forge build gives me a Discovered incompatible solidity versions error that I'm having trouple parsing—it looks to me like the version pragmas and imports for the contracts it's flagging should all be compatible. Am I missing something obvious? I can share the whole message if it helps. Yes please open an issue with the output and ref the repo if public Cool, thanks. The repo is not public, but I'll try to put together a minimal repro for you. now with the new spinner, how can i check solc version on ci logs? Good point. Rn check if There’s a terminal and only print if available. If there’s none we should fallback to without spinner Mind opening an issue for that? done :) https://github.com/gakonst/foundry/issues/953 Not sure why ffi doesn't seem to work with my tests now? string[] memory test = new string[](2); test[0] = ""echo""; test[1] = ""test""; bytes memory x = vm.ffi(test); Setup failed: Execution reverted: Odd number of digits Any ideas? echo prints a newline char that ffi doesnt like. use -n to skip the newline, and ffi is going to want only hex chars in there so 'test' isnt gonna work anyway @mattsse any way to enable the settings.viaIR compiler input? Ran foundryup for good measure and using build b501848 works.",477
414,foundry-support.txt,"Not sure what the underlying issue was, but seems to be fixed! echo -n ffff or echo -n 0xffff (any even number of hex chars is good) apparently the new nightly is generating different gas snapshots for the same code and solc version @brockelmore can it be related to https://github.com/gakonst/foundry/pull/951 ? seems like only tests with setUp changed yes new ones will be more accurate sorry for the trouble do we have individual benchmarks of compiling and testing? I see ""When tested with openzeppelin-contracts, Hardhat compilation took 15.244s, whereas Forge took 9.449 (~4s cached)"" Is it faster even at compiling? If so, why is that the case considering everyone uses the same solidity compiler? rust vs haskell ? Bump who has an example of an easy to test proxy token? gonna add tip support in forge-std usdc, or you mean locally testable locally testable Hi everyone,how could I get the contract deployed address in the test contract? The msg.sender? what do you mean? the address of the test contract? or the address that creates the test contract? I solved it! I mean the creator of the tested contract I am testing my ERC721 Contract, but when I call the myTokenMint function The test report that ERC721: transfer to non ERC721Receiver implementer Getting this on forge update: fatal: No url found for submodule path 'lib/ds-test' in .gitmodules AFAIK I haven't changed anything from the default init wrt ds-test. Has anyone else seen this? .gitmodules does have this: [submodule ""/local-path/lib/ds-test""] path = /local-path/lib/ds-test url = https://github.com/dapphub/ds-test Is it possible to run a devnet hardhat style with forge cheatcodes deployed to the hevm address? you can use the hardhat node as the —fork-url input which i think is what youre asking? but maybe not using a --fork-block-number and it fails, without it succeeds, any known issues before I spend more hours on this? [FAIL.",450
415,foundry-support.txt,"Reason: Setup failed: Execution reverted: Revert(Reverted), (gas: 64680)] So I’m trying to run a deploy script that I wrote in bash But it involves some cheat codes But the hardhat node doesn’t have those available And I think we’re trying to avoid using hardhat at all im guessing the test Contract / vm(Alice) needs some gas money? infura node eth_getBalance() showing 100% failure for requests... can u post the trace screen shot preferable yep failure case using --fork-block-number success case without block number (shouldnt actually work) based on what im testing likely that address has code already so you need to etch it to have 0 bytes as its code the address being instantiated with the contract under test? makes sense thanks turns out test contract itself has code on kovan and ropsten, not eth mainnet wihch is what im usin doh! rtfml properly, first page on ""writing tests"" re above comment hey guys can I get a bit of help here? [⠰] Compiling...",224
416,foundry-support.txt,"[⠢] installing solc version ""0.8.10"" [⠆] Failed to install solc 0.8.10: error decoding response body: operation timed out Error: 0: error decoding response body: operation timed out 1: operation timed out basically cannot install bc requests aren't coming back? is it just bc it cannot work on WSL? since this is rust can't we compile it to windows binaries as well? LLVM can do both no? Could you do cargo install --git https://github.com/roynalnaruto/svm-rs && svm install 0.8.10 I got that error recently and it happened because my Solc installation took too long We need to increase the timeout _I believe_, but didn't debug yet ah I see it defo could be that but which solc package is it trying to get it from? foundry doesn't use nix either right? it's getting from the official upstream releases https://github.com/roynalnaruto/svm-rs/blob/master/src/platform.rs#L21 https://github.com/roynalnaruto/svm-rs/blob/master/src/releases.rs#L13 soz for the confusion, this is a mistake on our end to not set the timeout higher is it like nvm for solc? https://docs.rs/reqwest/0.8.4/src/reqwest/client.rs.html#503 default timeout 30s, so if the download takes >30s yep no worries but I think some message on the readme would be helpful haha what should I do after this? try the install again? yeah try forge build or forge test again alright thanks I'll try that thanks ser ah yes it works thanks again forge is defo blazing fast compared to anything else I'll admit that ok good feedback What's the best way to pass a command-line option to solc? Trying to use the --via-ir flag from 0.8.13 Looked in the foundry.toml config but don't see anything that enables options passing How do you call console.log from your contract ? I understand the emit log from DS test but that's from the test, not the contract.",456
417,foundry-support.txt,"Do I have to copy this contract for example https://github.com/gakonst/foundry/blob/master/evm-adapters/testdata/console.sol ? Sorry if it is somewhere, I searched a bit but I didn't find any example in the forge book or telegram. You need to add hardhat's console contract and then import it https://github.com/ZeframLou/foundry-template is a good example The template doesn't use the console from the ""main"" contract, only from the test contract - is there a way to plug, just for debugging that console.log inside the ""main"" contracts, and how to do that, without starting from scratch with this template ? Just importing the console.sol file ? (https://github.com/ZeframLou/foundry-template/blob/main/src/test/utils/console.sol) I think you can just import it with ( I haven't tried it btw) import {console} from ""./test/utils/console.sol""; It looks like there is an implicit assumption that the configured test path is a subdirectory of the configured src path. Is this actually the case? If so, is there any technical reason for this? I'm introducing ds-test to a Hardhat project with an existing test suite, and I'd love to keep all our tests in one place if it's possible. In Hardhat, that's ./test, not ./src/test. If this is a simple change, I'd be happy to take a swing and open a PR. we should be able to support this buti dont recall if we do, maybe somethign we should do? @mattsse how hard is it to include contracts under ./test in the CompilerInput? is there any docs on how to setup a project to support both hardhat & foundry builds? some of our tests/instrumentation is easier to do with the flexibility of JS so we'd like to have hardhat for it I believe we actually do include ./test already but need to double check possible, i havent tested it @eth_call you mind giving it a try see if it works Sure, I'll try it out ...doesn't look like it. I wanted to rule out anything weird about my own environment, so here's a minimal example: https://github.com/ecmendenhall/foundry-test-path. This is an out of the box Hardhat project with a foundry.toml and two DSTest contracts. One runs, the other doesn't.",500
418,foundry-support.txt,"Thank you. Mind opening an issue as well? Sure, will do. thank you:) Here you go: https://github.com/gakonst/foundry/issues/970. Like I said, I'd be actively interested in picking this up as a first issue if it's a good one. Great I’ll leave some comments there Ok thanks, I'll try it. When using a filter, I specify ""from_block"" and ""to_block"" with the ""to_block"" argument being a block _in the future_. I was thinking the call would wait until the block comes in. But the call returned before, at the current block. Is this expected ? What would be the ""forgean"" way to ""retrieve all events until the block X which is in the future"" ? yes this is the case, you cannot watch for future blocks you need to query up to current block and then subscribe recommend moving to t.me/ethers_rs for ethers related questions given that thi sis about ""client"" side querying of stuff Oups right, sorry, I messed up the channel >< hey Georgios, addressed your comment and updated the code here: https://github.com/onbjerg/foundry-book/pull/106 thanks for reviewing 🙂 is there a good repository example of combining hardhat + foundry? @EricForgy ^ say i want to run the tests i already have in HH, but add foundry fuzzing tests incrementally Here are some notes: https://t.me/foundry_support/3112 Here is a sample: https://github.com/EricForgy/foundry-hardhat-sample https://github.com/wighawag/template-ethereum-contracts 👍 I’m liking how smart the fuzzer is! It’s finding the minimum failing input on very few runs. I guess it’s trying state variables from a contract I’m calling into, rather than bisecting / narrowing results down after a random failure it doesn't even extract state yet, just biases towards extreme inputs and has a nice shrinking system! but brock is working on a super smart dictionary that pretty much just lifts the entire evm state which will blow your mind :) Okay, so this is maybe more a JS question than a Foundry one, but thought I’d try anyway.",461
419,foundry-support.txt,"I’m calling a node script from one of my tests (using `Vm.ffi`), and need to pass some data to that script (an address and some bytes in string form (`string(abi.encodePacked())`)). What’s the best way to get this data to JS-land? I thought about just abi encoding and putting it in argv, but I’m struggling to get it back afterwards thru abiCoder A way to see the output of ffi would also be helpful, currently getting FAIL. Reason: Revert(Reverted) while the same script runs fine from my terminal so @mattsse I literally copied paste the source code to new files in a new repo and it reached again the same point that it doesn’t build. Could it be the OZ library? if I run foundry with FOUNDRY_FORK_BLOCK_NUMBER set to a specific block, should it cache the fork in the next test call? nope not yet but it's rihgt up on our prio list Trying to build ethers-rs from source with some debug prints, but apparently in master there is some dependency conflict Which conflict? Don't think I see anything in screenshot? Really, it doesn’t extract any state yet? It managed to find the deposit limit of a contract in 50 runs. I guess the shrinking can get there quickly with log(n) binary search for some cases. Excited for the dictionary approach! @brockelmore Would that need a lot of local storage, or is that where the “smart” comes in? 😄 That’s the issue. Everything appear normal but forge build doesn’t output artifacts or an out directory. It keeps saying that nothing changed, compilation skipped. Same repo? Yeah, Also tried ot do the custom ethers-rs thing this time and be more helpful, but ethers-rs master has some depedency issue and didn’t buld Also, I cloned frankie’s template and it worked OK. Once I added the OZ library and the new proxy contracts, it stopped working. Still the feat/core branch? Yeah.",422
420,foundry-support.txt,"Let me push again So, the error appears to be between that 2 trace logs cause the source files are detected Can’t reproduce with todays nightly and current feat/core branch Fails with undeclared identifier let me check again regular foundryup right @mattsse try foundryup first yeah, nothing change ensure it’s from last night forge —version ah, worked when I did forge clean to be clear, obviously I did forge clean all this time so, your fix made the trick, even though my files were all capitalised 🤔 Assumption: macOs is case insensitive, so while it appeared capitalised, OS-level could be messed up and thus trigger the bug? nah that’s apparently some solc weirdness because the file name in path that’s included in the error object that solc returns is always capitalized, and we ignored that previously because that then doesn’t match any input file I also capitalised 2 OZ files that weren’t. Given that I recreated the files for the contracts, but copied the OZ files, it should be something in there that triggered it in any case, thank you man. Next time, I can pipe the raw compiler output with some println here? https://github.com/gakonst/ethers-rs/blob/262149945a0c7e4c32ea8614a3f71190c4d99d4f/ethers-solc/src/compile/mod.rs#L611 you can now use ETHERS_SOLC_LOG=in=in.json,out=out.json to dump compiler input and output LIT I'm getting this error message after trying to squash another bug and nuking my .svm file. I'm using an M1 mac which I've gathered from this chat there are issues. [⠒] installing solc version ""0.8.13""The application panicked (crashed). Message: checksum not available: ""0.8.13"" Location: /Users/runner/.cargo/git/checkouts/svm-rs-cd2fa967df1e48a1/37d0095/src/lib.rs:175 that is after running forge test I believe we didn’t compile and publish 0.8.13 for M1 yet @rohitnarurkar @gakonst ahh thanks, just tried with 0.8.12 and it works I have a strange bug that keeps cropping up.",495
421,foundry-support.txt,"When I run tests it seems that a cache is being reused and so my tests aren't reflecting changes I make in the code. For example, I tried to comment out a few emit Events for testing but after recompiling and testing they are still emitted. But strangely the values I changed in those tests are updated and emitted. I have tried forge clean && forge test Is there a way for us to reproduce this? Mind opening an issue and link to repo if public? Actually, I think typing it out helped me figure out what's going. I copy/pasted these files from another Forge folder and the solidity-files-cache.json is still pointing to that folder After deleting that cache file and running tests the new cache file still points to my old folder Sorry @mattsse repo isn't public are there any examples of projects successfully using the libraries config option? A dependency is using one of these libraries that are just an interface, and I’m having some issues replacing that with the actual bytecode of the contract this is a python ffi example, but same concept so maybe this will help: - https://github.com/mds1/solidity-trigonometry/blob/d898794756110dca967495d543f51719a5f9435b/src/test/Trigonometry.t.sol#L70-L81 - https://github.com/mds1/solidity-trigonometry/blob/d898794756110dca967495d543f51719a5f9435b/src/test/trig.py#L28 In particular, I need to swap Circom’s Poseidon interface with the actual code (which I only have the bytecode for) here with DAPP_LIBRARIES env var, if that doesn’t work in config then it’s a bug https://github.com/makerdao/spells-mainnet/blob/master/scripts/test-dssspell-forge.sh#L20 is there a way to support solpp precompiler with foundry? plugins? The issue is I only have the bytecode, not a full Solidity contract So I’d need a way of dynamically swapping the interface for the bytecode Keep running into this Deserialization Error: invalid type: null, expected u64 at line 1 column 26.",449
422,foundry-support.txt,"Response: {""jsonrpc"":""2.0"",""id"":null,""result"":""0x89""} trying to do forge create that’s a serde error, apparently we‘re requiring a number when it’s in fact optional, Mind opening an issue with additional context you may have? will try if I have time! in other news, been having trouble managing versions with foundryup on mac, is it still the recommended version manager? i wanna add proxy tip support to forge std - once again asking for minimal proxy token impl :) How would one test a contract that interacts with different deployed contracts? (e.g.",123
423,foundry-support.txt,"using AAVE v2 flashloans) Do you create the classes in the tests and mock them or is there an easier way? fork mode you use the real addresses and do fork tests Looking at this but not a lot of info: https://onbjerg.github.io/foundry-book/forge/forking-mode.html i guess you can mock a lot of the interactions but to make it an integration test forking is better im sure there are far better examples here, but in the strategy mix, im using here DAI and WETH the real tokens in fork mode to setup tests https://github.com/storming0x/foundry_strategy_mix/blob/a755cb4b8fcbf1c56e8a4c40285f7744866ee17a/src/test/utils/StrategyFixture.sol#L29 if you run the tests without fork mode it will fail cool thing is it seems we can use forge-std to tip (add balance to DAI) in fork mode Ty ser, gonna have a look https://github.com/gakonst/foundry/issues/982 Hope that helps! Will likely have to switch to a different tool for deploying for now :( You need a proxiable erc20? i got it figured :) thanks tho forge-std is updated now to support proxy tokens Nice! https://github.com/brockelmore/forge-std/commit/4bfb08b7f2b60b84cfaa3c3797d0a8f58fa0b18e @brockelmore is it not safe to use this directly? this broke my tests since i was using it directly what i did is i created an instance on my Fixture but not sure whats the best way to go about this https://github.com/storming0x/foundry_strategy_mix/blob/a755cb4b8fcbf1c56e8a4c40285f7744866ee17a/src/test/StrategyShutdown.t.sol#L44 need several of the methods that i dont see on stdCheats wrapped i guess i can fall back on using them directly from foundry, just wondering if theres any harm in using them in general you should just have a global vm imo im sorry for the breaking change :( i.e. in your test, do Vm vm = Vm(HEVM_ADDRESS) does console.log formatting work? it doesn't for me e.g.",500
424,foundry-support.txt,"console.log(""balance: %s"", 0); will log balance: %s, 0 Not that I’m aware of Just do (“balance:”, 0) Thanks, that's what I am doing what is the difference between block_number and fork_block_number? fork_block_number is what actually works for me. block_number doesn't change block state. below is the help from evm.rs block_number: fetch state over a remote instead of starting from empty state fork_block_number: pins the block number for the state fork Experimented a bit with forking and its really cool, thank you 🙏 my only issue is how you debug this, getting vague reverts e.g. SafeERC20: low-level call failed add console.log and -vvvv for traces is my usage of vm.assume wrong? because fuzz testing still considers very large input like 2**256-1 . I submitted a create tx, which stalled, so I stopped the process. Now when I try again I get (code: -32000, message: replacement transaction underpriced, data: None) -- anyone know how to resolve? I've tried upping gas price but not sure what else to do. you mean *post* assume b may still be v large? Could be that there’s already a tx pending? I don’t think we have the option to manually set the nonce rn in forge but probably should add this? revm will let us do this but sputnik maintainers refused the PR yes, my test fails on Arithmetic over/underflow. where the input cases are very large, larger then my assume.",331
425,foundry-support.txt,"what version of foundry are you on? also, you should try using a smaller input type then uint256 so the fuzzer can pass your assumptions faster annnnd youre sure that you dont legitimately have an error? is code public? can take a look We should prob add this to Foundry book Which specific features are you using Can you open an issue with the full use case? I'm trying to see if I can get it to work first but hmmm probably macros and ways to get around not having generics for libraries that I wrote for like arrays and such so not really a specific one in mind If you have ideas pls open an issue and we can investigate I guess I could also just preprocess first and then use forge on it but was wondering if it could be more seemless maybe a plugin system? if that makes sense yeah I'll open an issue Is this expected soon? Would be great to try out the new compilation pipeline features https://github.com/roynalnaruto/svm-rs/issues/32 trackign here cc @rohitnarurkar hey Georgios, i've addressed your feedback on the PR. can you pls take a final look and approve it? thanks! https://github.com/onbjerg/foundry-book/pull/106 im assuming this limitation still exists? i was testing some selfdestruct tings and faced the same encounter as ciaran Also turns out there you can set viaIR = true in foundry.toml and it'll work New merged feature as of 2 days ago how to safely upgrade foundry if we installed thru cargo and foundryup does not work? check item #3 in the pinned comment How have you found the optimizer so far? Yep, no good solution to this natively..",354
426,foundry-support.txt,"We could add maybe a expectSelfdestruct() cheatcode? if u know for a fact something is selfdestructing you can do vm.etch(address(contract), """") as well as vm.deal(address(contract), 0) its a hack that we will likely be able to more easily change when we switch to revm ill try that out, thanks! has anyone had success using forge verify with arbitrum rinkeby testnet? and if so, do u just use ur regular etherscan api key? 🤔 i dont think its the regular etherscan api key: Error: 0: Encountered an error verifying this contract:  Response: `NOTOK`  Details: `Invalid API Key` but dont see a way to get an api key from https://rinkeby-explorer.arbitrum.io/ Very nice! Was able to remove all my manual block scoping, and stuff that failed with stack-too-deep before now compiles like a charm https://arbiscan.io/ < u use the etherscan version here thanks, not sure how i missed that Wow extra nice how can i figure out the exact commit of the compiler that was used so i can pass that in to forge verify? finally Added Also enabled notifications for Solidity releases 👍🏼 Hi!, I check and it seems this error didn't occure to other person: I am downloading foundry, but it show me this error: error: failed to select a version for the requirement comfy-table = ""^5.0.0"" candidate versions found which didn't match: 5.0.0, 4.1.1, 4.1.0, ... location searched: http://crates.io index required by package evm-adapters v0.1.0 (/home/baphomet/foundry/evm-adapters) huh wonder if it was yanked? hi! is there a particular usage pattern to pass a bytes32 char sequence as an argument to cast send. eg. the call cast send ""setAddress(bytes32)"" ""ACCOUNT"" fails but modifying the bytes32 to a string helps the same call go through for anyone who might face this --fixed it by converting ""ACCOUNT"" to a bytes32 using cast --from-utf8 and --to-bytes32. Then passed the computed value to the original command.",480
427,foundry-support.txt,"@mattsse continuing with out discussion, I think there is some issue with how the cache is generated. Even if the build fails, the cache is created nonetheless, forcing me to forge clean in order to be able to build correctly: I could open a GH issue instead to have all the discussion there. Whatever suits you best @odyslam are you at latest version? yup Just foundryuped Yep! This is what's needed here. https://github.com/tynes/dapptools-rs/pull/1#issue-1174462305 what were the solc issues mentioned here? @dmfxyz see https://github.com/gakonst/foundry/pull/981#issuecomment-1072931035 and https://github.com/gakonst/foundry/pull/981#issuecomment-1072938135 I’ve come close to making a new PR and adding co-author tags for everyone who contributed through PRs 914 and 981, but I think we should close out the others first because we’re working in 3+ different place right now @gakonst Hello, I was wondering if was possible to use a relative path for the test path. I set my src path to '../contracts' and so I want to be able to set my test path to '../tests'. Is this possible? thread 'main' has overflowed its stack fatal runtime error: stack overflow Abort trap: 6 when I try to flatten large files is there a way to increase stack size Can you share repro? Def a bug we should fix. Thanks! We haven't addressed this yet..",331
428,foundry-support.txt,"https://github.com/fei-protocol/tribe-turbo forge flatten src/modules/TurboAdmin.sol Do you also mind opening an issue about it? amd forge flatten src/deploy/Configurer.sol happy to https://github.com/gakonst/foundry/issues/998 thanks 🙂 is test in foundry.toml the path relative to the source dir or relative to the root of the project? well looky here This would address ur issue https://github.com/gakonst/foundry/issues/786 Comment critique etc Root of git repo Whats the point of alpine container if you have to use glibc? My issue is not with remappings, but with the foundry.toml file I want to be able to do [default] src = '../contracts' out = 'out' libs = ['../utils/ds-test', 'node_modules'] test = '../tests/foundry' remappings=[ ... ] Can you confirm whether your issue addresses this? If not, I will open a separate one Can you open an issue? We should be able to do that With a mainnet fork: when I start a test with a past timestamp A, and then warp into the future to an instant B, does it include all historical mainnet transactions that happened after A? Or is time frozen at A and only my test transactions occur? nope, only block number changes Great, as expected. Weird results coming from somewhere else then 😄 there’s a related issue for this here: https://github.com/gakonst/foundry/issues/939 what do you mean? You confirmed it worked how I hoped/expected. In one test I’m getting a weird result whereby a token balance changes depending on amount of time I warp forward, but if only the block number changes then I can rule out historical mainnet transactions as the cause ok gotcha Saw this got merged! What's the next step to enable 0.8.13 natively in foundry.toml? it should just work? ` The application panicked (crashed).",419
429,foundry-support.txt,"Message: checksum not available: ""0.8.13"" Location: /Users/runner/.cargo/git/checkouts/svm-rs-cd2fa967df1e48a1/37d0095/src/lib.rs:175 ` Ran foundryup but still failing are u sure you're on latest? what's forge --version output? forge 0.1.0 (64f779a 2022-03-20T00:10:35.957576+00:00) and you're on m1 right @rohitnarurkar do we need to make extra mods to svm? https://github.com/roynalnaruto/svm-rs/blob/master/list/linux-aarch64.json#L171 https://github.com/roynalnaruto/solc-builds/blob/master/macosx/aarch64/list.json#L5 this is weird because it has it uhh the svm bump came after 64f779a -.- @oxfoobar it'll be available tonight OR you can do foundryup -b master to get it Thanks! Will give it a shot tonight Any issues with this? maybe no need Ah ok think we need to add 8.12 and 8.13 to the aarch64 linux list? Lemme check https://github.com/gakonst/ethers-rs/pull/1074 Just verified that things are working on master 👌👌👌 @merkle_01 r u using tip? i don't think so. what is tip? a forge-std helper for writing balanceOf is ur code open source? oh i see it's not rn can u give me a trace output? preferably screenshot yes can i dm it to you? ye I have added it as this issue: https://github.com/gakonst/foundry/issues/1008 Thanks once again! Hi all, I'm switching my project testing framework to Foundry, a very big fan so far! I see on GH that there are some issues lately with emits and expectEmits. I have another possibly related issue, namely that I can't get any forge-std/console ""log"" events to be logged when testing. Even with > -vv. Anyone encountered a similar issue? Out of curiosity, does Foundry have a Twitter handle? Was gonna tag it 😊 eric you're missing the bancor v3 release call! Nice.",499
430,foundry-support.txt,"Thanks for the reminder. Will hop on 😊 FYI: https://twitter.com/EricForgy/status/1506035236131381253 This stuff is so cool 🙌😊 is there a best practices document for solidity testing like unit/mock/integration/end-2-end etc? or a repo of an existing project that's well known for their testing practices Can forge create deploy multiple contracts at once? nope one per invocation thank you. also what's the purpose of the :MyContract in forge create --rpc-url <your_rpc_url> --private-key <your_private_key> src/MyContract.sol:MyContract from the Foundry Book? https://onbjerg.github.io/foundry-book/forge/deploying.html#deploying i'll PR a clarification to the book with your answer A solidity file may have multiple contracts defined What command does the --hh apply to for enabling hardhat compatibility mode? I would have guessed forge install but I don't see it for that command or other similar ones. I'm migrating some tests from Hardhat/TypeScript and want to ensure I can still run both without breaking the imports to mocks and such. How would you be able to do this this would be outside the git repo would it not , assuming your config is in the root the most popular way is flattening contracts is foundry currently compatible with optimism? if yes should it be added here? https://community.optimism.io/docs/developers/build/using-tools/ should be, yes it changes the directory structure that forge expects (e.g. node_modules instead of lib, contracts instead of src). no changes to forge install/remove etc so applies to forge build/forge test i'm not sure i understand what u mean for in-depth tests look at solmate as an example Ah, not sure how I missed it as a flag for forge test Thanks! hi, how can i get the full address in the trace, which only gives the abstract 0xaaaa....bbbb? because sometimes i need to have the full address to check in the etherscan uh u cannot right now but we'll have it next release with revm yes, thanks for the clarification.",441
431,foundry-support.txt,"waiting for the revm :) is there a way to read from a JSON file in foundry? im guessing no but it would be nice to share some config between the rest of the code and the tests thanks, found them Maybe create a makefile with env file and create different commands for prod/test? ffi :p and you need to decode / parse the json so not ideal you could do cat json_file | jq to get your field in a var im trying out whats the work for getting foundry added into a brownie repo (anyone done this before?) cant move contracts or folders, i saw gakonst uni periphery example but it doesnt have a TOML 🤔, how does foundry find the tests folder for these? im adding a toml and running forge build getting this error must be missing smth i ran foundryup to update too your library directory is specified as “foundry-lib” but then your remappings are routing to “lib”, that might be your issue. yeah noticed that, updated that, still cant build did you post the full toml this is my current toml ah you’re missing a comma after the second remapping uff, lets see awesome that was it thanks great! why not just do forge config > foundry.toml it autogenerates it hmm wasnt sure if that would work, since i needed custom folders to drop it in brownie existing repo https://gist.github.com/sambacha/4b7cdfab3d466a9d48c56b7341eafdfc is there a way to test internal/private functions and fields without doing that sus inheritance pattern? Dumb question: why do devs like using the num 1337? What meme is that? I know web2 uses 42 as that’s the “answer to life”. What is 1337? ""Leet"" elite https://en.m.wikipedia.org/wiki/Leet https://twitter.com/storming0x/status/1506351256490573824?s=20&t=Y9pnrevgV1POzgBTE0SfiQ very rough POC, but it compiles and run tests on both frameworks.",449
432,foundry-support.txt,"Got it working today, w more time i can get more toys added to this brownie-foundry-mix in case anyone wants an example or has a better working integration i read here somewhere a way to solve foundry to stop fetching the compiler if it already has it in local --offline / latest release Oh Wait so you had 0.8.10 And it dled 12? Yea then --offline ok will try, thx 👋 Having some issues with the submodules. I tried removing and reinstalling and forge clean. Also when I run forge update I get fatal: No url found for submodule path '--force' in .gitmodules does git submodule update --init --recursive pull them? what does your .gitmodules look like if your deps are in node_modules you could try yarn install Same result as forge update This is my .gitmodules the submodules are present on disk? are remappings autodetected?: forge remappings Yes and yes oh you're setting the --hh flag, does without work? oh I suppose the remappings don't include the @ ? They don't. I *think* this is expected behavior with node module style imports? yeah the @ prefix is not autodetected like that, so you'd need to add manually To the remappings.txt? you can start with forge config --basic > foundry.toml and modify the remappings in the foundry.toml file That worked. Much appreciated! I see I perhaps misunderstood the proper use of the --hh flag. —hh is the global install of hardhat, is there a —hh in foundry? f For forged test and forge build yes. I figured you used it with forge test if you had node module style imports. 🙏 why does this test fail only when _message is """"? is this solidity related or foundry Is it possible to get the (all, or one) traces for fuzzed tests? I guess this hasn’t been fixed yet? 🙂 https://github.com/gakonst/foundry/issues/837 On a related note, I’m curious if there’s any documentation about how blocks work in general? It looks like the block number (and hash) will always be zero unless the roll() cheatcode is used. Is fixed on revm Is also fixed on revm.",474
433,foundry-support.txt,"Today is the day 😅 Yeah unless you do --block-number or fork from a network Cool, seems like one hell of a PR 😅 will fuzzed tests also be included in the --gas-reports by any chance? anyone know of any examples of shell scripts for deploying and verifying contracts? what im specificaly not sure how to do is get the deploy address of one successful deploy and then use it as a constructor arg for the next contract, or use it in a verify command Assign the deploy addr to a variable yeah but how to actually get the deploy addr in memory? X=$(forge create <..>) And in your next command do $X where you expect the address I think our create command has a bunch of other stuff That's not needed So we should remove that probably so it's easy to pipe and use as var ok yeah so echo $X yields the typical last 3 lines of create output: ""compiling (...) Deployer: (...) Deployed to: (...) Transactin hash: (...)"" i guess from there ill just try to parse only the string after ""Deployed to: "" Yea Grep Works for that yeah ok thanks But we should simplify So that you don't need to It should be a simple PR if it annoys you a lot and would want fixed for anyone else whos wondering, i used this to get the address from forge create output in a shell script: ADDR=$(forge create <args ...> | rev | cut -d "" "" -f4 | rev) any help please? 🙏🙏 can u show the trace? can u show the event code? i.e. event Message(...) this is the whole contract hmm probably a forge bug wanna open an issue? sure i imagine its the same for bytes as well done, issue #1027 Hey, it's me your favorite contract verifier :) Hitting issues again with trying to verify a contract. It's deployed on Rinkeby and I'm following the same steps that succeeded last time, but still getting failures.",414
434,foundry-support.txt,"i’ve checked lib/forge-std is all set and imported like you show here in my contract. In fact, did a clean init of https://github.com/abigger87/femplate/, ran make test, and noticed none of the console.log()s were printed hmm still having difficulties getting the logs import { console } from ""forge-std/console.sol""; console.log(""here""); Tried running verbose as well, is there a separate option I need to add? forge t -vvv? ah I did not read this carefully I guess, i have a failing test and assumed -v was sufficient never looked at the docs again to see if there was more verbose flags we've talked about consolidating Personally, by default, I just assume verbose is the most verbose but regardless, should have looked at the docs more than once lmao what does this error mean? oh interesting cc @msolomon4 we shouldnt be surfacing this error to the user what kind of test creates this? do u use vm.assume? yes why not? imo it’s useful to surface this error because it typically means you aren’t using assume the way it’s meant to be used. @donnoh see here for more details: https://onbjerg.github.io/foundry-book/reference/cheatcodes.html#assume summary is you should either use a smaller type for n and keep vm.assume, or use solmate’s bound method to wrap the uint to the desired range instead of using assume got it would be helpful to have this info in the error tho yea fair, that error is a bit cryptic if you don’t know what it’s referring to ah i think this can be solved here with bundling it in one statement assume(n < 350 && n > 250) so yeah we should publish a guideline to ""bundle your conditions"" when using assume it doesn't I think that would still cause the issue, since it’s a very tight range—you’re looking for 100 valid values out of 2^256 possible ones hmm i see right mhm @donnoh does vm.assume(n < 350) work? I think it should, but just curious (I know that’s a different condition) this is probably still good advice though yes cool, thanks for checking.",467
435,foundry-support.txt,"so yea @gakonst I’m not sure exactly how proptest regenerates values for failed assumptions, but would be curious to learn exactly how this works so we can better document safe cases for assume anyway i was setting those boundaries because my test sometimes fails when n is around 400 and i wanted to see what is the lowest value but i think it just gets less likely to happen with lower n values [FAIL.",87
436,foundry-support.txt,"sorry do you have a public repo of this? unicode 0 is the null character so it’s decoding correctly nop but im trying to write the smallest contract where it happens ah interesting so when fuzzing strings, what’s the set of characters used? any bytes we just ask proptest to give us a Vec<u8> and then we do std::str::from_utf8_unchecked perhaps thats why also with fuzz dict we pick random bytes too from the state and do from_utf8_unchecked as well also once we figure out the cause we can probably show a more useful revert reason here? there’s probably some evm edge cases we don’t handle/decode properly which is the correct thing to do because the evm doesn’t enforce valid utf8 encoding yea not saying its not correct yea agreed that makes sense i’m thinking it may be an invalid generating input but idk how yet.",182
437,foundry-support.txt,"^ when using foundryup -b <commit> ok we should adjust foundryup to support commits agreed @brockelmore debugger still crashed pre-revm, I suspect because of how big the tx is crashes ~5 minutes after compiling finishes both pre and post revm huh weird one sec trace is here with some useless logs https://app.warp.dev/block/HVMAeLFj83kzxo1iGlW2Pj though actually if I remove the logs the test passes if I remove those logs the debugger slowlyyy opens after a few minutes, we’ll see if it’s usable… is this a bomb tx or do we have a general regression I think this is like the convex sim where it’s a stress test of the vm @brockelmore debugger still chokes haha this is an awesome stress test lol i am afk for rest of night i think but i’ll take a stab at this tmrw Does the new REVM still allow for gas used to be Unlimited or is there now some accounting introduced to remove that ability We added a cap but will remove it soon Did you hit it? ya, I forget what EIP1559 introduced as a potential max cap (is it 12.5m x 2?). But from tests it's reverting around 29m. We hit that with eth_call reads quite easily, so would love a flag to make it unlimited. I have a speed test where it uses UniswapV2.getAmountsOut with ever increasing amounts (1-10_000) after a warmup of remote fetch of storage. Anecdata but REVM looks to be 50-60% faster in pure execution than the previous SputnikEVM/RustEVM. was looking for the exact same thing today.",364
438,foundry-support.txt,"Is there a simple way to get myself some amount of some token without having to go trough an exchange, but use some kind of cheating? download forge-std and use the tip cheat code https://github.com/brockelmore/forge-std Sweet! TY! hey how to do parametrization testing like https://docs.pytest.org/en/6.2.x/parametrize.html ? usecase - execute all your test against specific version of your objects https://github.com/yearn/yearn-vaults/blob/main/tests/functional/conftest.py#L40 i am actually using (brutally) a modifier which iterates _; and set a global variable. any other means? thanks! anyone else encountering weirdness of gas-reports after upgrading to v0.2.0? Looks like it's not taking anything anymore into account, and only displays the setUp function The call traces also don't seem to be decoded as they were in <0.2.0. I'll see if I can collect some more feedback and put it into a gh issue it’s working for me, but fuzz tests are not reported Strange, I'm encountering issues both on the gas reports and the call trace decodes. Are the latter working for you on 0.2.0? oh i see, there are gas reports for tests too The only function that gets decoded for me is a solmateERC721.mint(), but only the function selector, not even the contract. I'm trying to get it reproduced on the NFT.t.sol from the foundry handbook, but for some reason those contracts&functions seems to be decoded 🤯 but only setUp I also indeed only see the 'setup' in the tests.",351
439,foundry-support.txt,"Do I see it correctly that this shows the same issue for you? yep but you should care about contract cost not test cost right? We do are alot about the function call costs, we use it to benchmark our gas efficiency you can add test contracts to the gas report in foundry.toml by default they are stripped out I'm using gas_reports = ['*'] in my projects, so I assume it should take it for all? what do mean take it for all? this is my toml but i still get gas reports for test contracts you get gas reports for other contracts that tests call not for the test contract (no test functions) based on ur screenshot For example, the NFT.t.sol example test from the foundry handbook, shows only the setUp calls. If I remember correctly it showed more function names in <0.2.0 and I have a similar issue in my main project, where suddenly I only get a gas report for the setup function i’ll take a look and make sure they didn’t change too much today something may have broken I'm also making a POC for the function decoding, hopefully I can put it on gh today Hm, for some reason the decoding does work on a new POC I set up. Any idea what might cause the functions/input decoding to not work anymore after upgrading to 0.2.0? A forge clean doesn't seem to solve it the new fuzzer is breaking with calldata arrays function testAdd(uint64[2] calldata values) external { } Downgraded to 0.1.0 and the decoding works again makes sense, thanks! any idea on the original cause of the reverts @donnoh was seeing? Is there a way to debug foundry transaction in Tenderly? wdym? why dont u use -vvvv or use the debugger? Can you open issue? We'll track and fix asap In general assume that all bugs introduced in 0.2.0 are P0 for us to fix, and appreciate all the reports + patience as we resolve will need to make a PR on ds-test to have all the expected and actual results in an assertEq to be in the same order 😅 tracking here https://github.com/gakonst/foundry/issues/1038 Can you share a minimal repro? I tried to make a minimal repro for it, but for some reason it decoded the calls correctly there.",493
440,foundry-support.txt,"Might be a new vs ""upgraded"" project? I'll see if I can reproduce it again, or later this evening upgrade to 0.2.0 again to see what's up. Unfortunately I can't share my actual project publicly (yet) is the ""forge test —watch"" mode not working currently? Not that I’m aware of, mind opening an issue? sure I can do that rn hey @onbjerg do we need to change anything about CI configs to use the new revm version of foundry? currently using actions/checkout@v2 and onbjerg/foundry-toolchain@v1 oh btw I also can't seem to find a way to force forge to use 0.8.11 I ask because I recently had a CI run fail with [FAIL. Reason: Too many global rejects], but I don’t see that string anywhere in the repo. Looks like it should fail with ASSUME: Too many rejects? because iirc we can’t distinguish local vs.",205
441,foundry-support.txt,"gloabl reject failures, though maybe that’s changed I set svm to use 0.8.11 I set the dapp env var I set the foundry.toml it still is using 0.8.13 for some reasons? hmm Can you open another issue with the env vars you set and the output of forge config this is a proptest error hmm what exact command are you using and what does your foundry.toml look like? [default] src = 'src' out = 'out' libs = ['lib'] auto_detect_solc = true # solc_version = '0.8.11' remappings = [ '@contracts/=src/contracts/', '@openzeppelin/=lib/openzeppelin-contracts/', 'ds-test/=lib/ds-test/src/', 'openzeppelin-contracts/=lib/openzeppelin-contracts/', 'ds-test/=lib/ds-test/src/', ] # See more config options https://github.com/gakonst/foundry/tree/master/config but I do have a .dapprc with export DAPP_SOLC_VERSION=0.8.11 auto_detect_solc = true takes precedence i believe yea, and to clarify this is a new test suite — this CI did not exist pre-revm, just set it up today does that detect from the system or from svm or from foundry's own config? it uses svm but when I do ""svm list"" 0.8.11 (current) Installed Versions 0.8.10 0.8.11 0.8.13 yeah so the latest is 0.8.13 that can be used for your project based on your pragma solidity it is very possible that I didn't do something properly but i'm just tring to figure it out. oh it automatically chooses latest? ""auto detect solc"" 🙂 yes always latest oh I see thanks ser. btw is it a good idea to use latest for a new project? or is it better to use a few versions behind? when it's pushed it means it's stable already right? yeah IMO it's fine has anyone else reported issues with the current nightly? our CI started to fail right after it was built last night will see if i can reproduce and share in a minimal repo Hey everyone! New to foundry... I'm wondering if anyone knows the behavior of --constructor-args when deploying an initializable contract. I.e.",495
442,foundry-support.txt,"if I have an upgradeable contract with no contructor, but an initializer. Right now, passing the initializer arguments to --constuctor-args seems to work even though the contract being built has no constructor. @onbjerg I think we might have changed Prank semantics a bit? (by accident) This sounds like a double prank Maybe there's a bug The tests that are failing i believe are ones where we prank 2 or more times in the same test yeah Also experiencing the [FAIL. Reason: You have an active prank already.] error on tests that were previously passing on old forge versions Works if I fix things up to do precise prank stopping though, so maybe the bug was that tests were passing on old versions Yeah I suspect that our previous pranking logic might have been a bit loose Is it maybe that the startPrank is not being stopped explicitly at the end of your test? Hi, sorry if this is an obvious question, or has been asked before, I'm pretty new to this. I'm trying to deploy a simple contract using 'forge create', but whenever I try to deploy to Polygon Mainnet, I receive the error: ""code: -32000, message: gas required exceeds allowance (0), data: None"". I can successfully deploy to the Polygon Mumbai Testnet. And I have plenty of Matic token on Polygon mainnet. Is there some step I need to do to allow the use of that Matic? Hi frens! Is there any way to deploy a contract/library using only its bytecode via the command line, with either forge or cast? I tried via cast send to 0x0, but it complained about the address not being verified on Etherscan Cast send should be the way, the etherscan part shouldn't be always necessary If it is, then it's a bug Are you sure you're using the right RPC + privkey? Yo, is there a way to dump a contracts state/storage into a file at the end of a test? Or maybe a specific slot range in the contracts storage Updating to explicitly using startPrank and stopPrank fixed most of the tests.",432
443,foundry-support.txt,"I think there might be a remaining bug for tx.origin persisting through the prank Have people ound any bugs yet with the Revm update, beyond the prank related ones? Hey @brockelmore, using tip() from stdCheats is failing on solidity 0.8.13 —via-ir because it uses inline assembly. Is this a known issue? not a known issue - can you open an issue with the error the compiler spits out? sorry i haven’t tested it on 0.8.13 with —via-ir Error:  0: Compiler run failed  YulException: Variable _18 is 1 too deep in the stack [ _18 expr_mpos_3 _5 _17 _1 _15 expr_component_mpos_1 _9 RET var_ins_mpos _3 _6 _2 _13 var_i expr_1 _29 ]  No memoryguard was present. Consider using memory-safe assembly only and annotating it via 'assembly (""memory-safe"") { ... }'. If I insert tip(erc20Address, userAddress, 1) into a previously succeeding test function ah interesting. i’ll go thru and add the mem safe tags. it’s cuz the ir backend isn’t as good at stack management it seems so it can’t optimize away as many stack vars so it hits stack too deep errors because it assumes it would be able to move them to memory but without mem safe tags it can’t move Are there any plans for something like forge rpc that runs a standalone rpc server? I have a bunch of existing brownie tests that i run against mainnet/hardhat/ganache and would like to also run them against forge. it sounds like it will be much faster Check the forge node PR but i was told ctack too deep doesnt exist in 0.8.13 possible to skip directories in forge clean? Nope.",385
444,foundry-support.txt,"What do you want to do? I have an artifacts directory of abis that I don't want to delete only if you have memory safe assembly otherwise the compiler can’t guarantee it’s able to write to memory to avoid stack too deep https://github.com/brockelmore/forge-std/blob/d880879a97cea1857688c13a6ceb869ef48d715f/src/stdlib.sol#L81 using this cheat Is there a way to get a gas breakdown of the functions run rather than total gas used by the test? —gas-report Ah super nice, essentially the hardhat gas estimator hello! just want to know how mainnet-forking + fuzzing interacts. my question is: on each iteration of a fuzz test, does foundry re-use the initial mainnet-fork state? my understanding is that each test reuses a fresh fork state (as it re-runs setUp()) but i'm guessing each iter of a fuzz does not? I'm currently trying to deploy a contract with forge create, but it's giving an error that a library isn't linked and forge can't auto link it.",231
445,foundry-support.txt,"So I manually specified the path to the deployed library as shown here https://onbjerg.github.io/foundry-book/reference/config.html?highlight=--libraries#configuration-keys, but then it spits out another error: error: Found argument 'node_modules/@chainlink/contracts/src/v0.8/Chainlink.sol:Chainlink:0x922d6956c99e12dfeb3224dea977d0939758a1fe' which wasn't expected, or isn't valid in this context my man My man nope can you open an issue w link to example? ill take a look Getting (code: -32000, message: replacement transaction underpriced, data: None) trying to deploy to Polygon again -- do we have a way to manually use a new nonce? Or any other ideas to get out of this? Have tried manually using higher gas price, same result Is there no --nonce parameter? If not we should add it Could you open an issue? Yeah it doesn't double fetch things It only needs it the first time That's why it's very fast What is the exact command you're running? Just to confirm but “first time” is referring to first run of the test (ie first fuzz run)? Thanks! Ya I have a contract with a Bid logic, is it possible to simulate with foundry that multiple user try to bid with different in the same time, like with a fuzzing test ? Don’t think so but will look again and open an issue tomorrow if not Forge create. I got past the issue by inlining all library functions echidna can do thid https://github.com/Uniswap/v3-core/blob/main/audits/tob/contracts/crytic/echidna/E2E_swap.sol similar concept hi, since the fundry 0.2.0 is released, how i can get a full address in the trace instead of the abstract one, like 0xaaaa....bbbb? is there a config? there is not, can you file an issue for this request? not sure if we already have one, but it should be a relatively simple fix.",439
446,foundry-support.txt,"not sure if we want it behind a flag - short addresses are nice because it declutters large traces, but i also assume that when you look at traces you probably want the full picture anyway so it probably doesn't matter that we're a bit verbose thanks for it, i'll try to open an issue to make it more clear. is there a way to spoof tx.origin? I have a check in my contract (msg.sender == tx.origin) which is failing cause I cant seem to spook it startPrank(address,address) or hoax(address,address) for singular call hoax is from forge-std in case u cant find it in cheatcodes docs i generally like short addresses (lol that’s why i built the og version that way) so i would prefer to maybe have it be level 5 verbosity causes long addresses? Think something just broke in the latest nightly. Adding a console.log statement is messing with either msg.sender or tx.origin and materially changing the codebase path (throwing error when console log is there that doesn't get thrown when console log is deleted) do you have a minimal example to repro that, would appreciate an issue 🙂 Not on hand, nested with some internal stuff. If it persists I might be forced to spend the time to whittle it down, but hoping that description would trigger somebody's recognition of what changed. But CI was passing yesterday and is failing today on the exact same code, so something went wrong in the latest nightly > Running 2 tests for Deploy.json:Deploy when was this Deploy.json:Deploy syntax introduced? feels like this should show <file.sol><contractName>, instead of the json file containing the test artifacts and I think it used to show .sol instead? been like that as long as i can remember huh yea you’re right, just found an old screenshot and verified Yeah did it ever show .sol somewhere or am I going crazy? 🙃 Idts When using expectEmit, what if you don't know a param of the event until you call the function? do you mean for the data or an indexed topic? eitherway the answer is to do vm.expectEmit(false, false, false, false) < all falses just looks for the event being emitted see the docs for more ok but if you mark it as false, that param just wont get checked. We'll only be checking that an event was emitted and anything else you mark as true? ye.",493
447,foundry-support.txt,"@msolomon4 has had similar requests but i have a low preference for testing logs so low motivation personally for me to work on implementing those features no problem! thank you for the info! heh I think you are too bearish on testing logs—if your contract has messed up logs, getting historical data/analyses from it becomes so much worse since now you have to get an archive node or subgraph and call at each block instead Curious if there’s a repo or two folks would recommend as a good reference for conventions and testing patterns using forge? Anyone getting ethers_solc::resolver: failed to resolve versions when running a github action? don't see any issues when running locally havent had that before, where is it? It's complaining about almost any file @mattsse i wonder if this is a false positive with missing solc triggering the fulll error 🤔 let me try something I'm using the local configuration with ""--offline"" so that might be the issue This looks like a false positive on CI? yeah That could be it If you don’t provide a solc version and use autodetect there’s an open issue to improve that message Yeah should remove that It doesn't have the solc version and it's trying to resolve it And it finds no solc So it gives this bad error Which one was it? can I add offline to foundry.toml? Think so? recent ethers-rs Why do you want it though? It's default offline now yeah that was the issue Doesn't make any network requests Should If not then it’s a bug just tested it out oh nice Yeah it's fast always now wasn't default when was using it Yea it's a last week feature Or evenpre recent can't remember Or it may be intermittent issues with the binary server has happened plenty of times awesome Hi! Is there a way to add labels for function selectors, e.g. in my traces section I see ""[8062] WETH::a9059cbb(000000...)"" and I'd like to add a label for ""0xa9059cbb"" showing as ""transfer(address,uint256)"" for better trace readability. not currently and the goal is to not need it :) using etherscan abi and 4byte register when we can forge clean seems to be wiping the artifacts directory, I don't see any documentation that mentions this.",483
448,foundry-support.txt,"I thought clean by default clears cache and out directories It cleans whatever the output directory is In a hardhat style project that's gonna be artifacts/ Otherwise you need to set a different output dir iirc still clears artifacts ex: Sounds like a bug You wanna open an issue? sure Oh I think we’re not taking the config value but autodetect in clean unable to install this package in forge: https://github.com/fei-protocol/flywheel-v2 when i run forge install fei-protocol/flywheel-v2 it doesnt do anything and doesnt add the submodule do u have /lib in your gitignore no, ive been installing other packages without issues foundryup + removing/readding made it work sorry for the troublez What's the state of the art for gas profiling with forge? Is there anything better than forge test -vvvvv? Is the number of v matters? it does  -v, --verbosity    Verbosity of the EVM.    Pass multiple times to increase the verbosity (e.g. -v, -vv, -vvv).    Verbosity levels: 2: Print logs for all tests 3: Print execution traces for failing tests 4: Print execution traces for all tests, and setup traces for failing tests 5: Print execution and setup traces    for all tests Thx! should I open a PR to make forge build --optimizeeeeeeeeeeeeeee a thing? 🙂 I'm having an issue with gas reports, for some reason when I set my Foundry.toml to [default] gas_reports = [""*""] forge is providing reports for all test contracts but not for my main, even if I change to gas_reports = [""MyContract""] I already ran foundryup and have tried forge clean and forge test —force —gas-report is there a test for that contract? For some reason I am getting errors on vscode despite setting remappings.",389
449,foundry-support.txt,"Here are my remappings/settings set Foundry.toml 'ds-test/=lib/ds-test/src/', '@openzeppelin/=lib/openzeppelin-contracts/contracts/', 'oz-upgrades/=lib/openzeppelin-contracts-upgradeable/', 'solidity-json-writer/=lib/solidity-json-writer/', 'solmate/=lib/solmate/src/' Settings.json, solidity.remappings ""ds-test/=lib/ds-test/src/"", ""@openzeppelin/=lib/openzeppelin-contracts/"", ""solidity-json-writer/=lib/solidity-json-writer/"", ""oz-upgrades/=lib/openzeppelin-contracts-upgradeable/"", ""solmate/=lib/solmate/src/"" yes the hell is a settings.json ? how can you optimize without a benchmark? or rather , should you optimize without a benchmark? k, I'm on the right track then Question: is it possible to generate traces not just for calls, but for jumps too? I'm trying to profile a function that does *10 nested calls*, but all of those calls are pure internal, so there are no useful traces: Running 1 test for TestComputeStaticObjectIndex.json:TestComputeStaticObjectIndex [PASS] testRunning() (gas: 742824) Traces: [742824] TestComputeStaticObjectIndex::testRunning()  └─ ← () Vscode lmfao your remappings differ - the one in foundry.toml has an extra /contracts, your settings.json does not when running cargo build —all-targets, the semver of the clis says 0..1.0 stil weird lol This might be possible now that we’ve switched to revm, @onbjerg would know for sure. Would be a neat feature to have behind a flag.",364
450,foundry-support.txt,"Though the optimizer might inline some functions instead of jumping to them, which may make this harder to implement? Though it sounds like for your case you can just add unit tests for those internal methods and use forge snapshot (or forge test --gas-report, not sure if that supports internals methods) Gas reports don't work with internal methods because they are basically a different view over traces Unfortunately not yet, because we only hook on CALL/SCALL/DCALL We should combine the 2 but it requires going a little deeper in the jumps and checking which function they correspond to Hi, is it possible to test a contract using 2 sequential transactions? For example, I want to test selfdestruct but its effects are realized once that transaction is committed https://ethereum.stackexchange.com/a/113862/72878 @mattsse seems --extra-output evm.bytecode.* doesnt work where * is any of the available things - still only outputs default bytecode stuff like opcodes, generatedSources, etc This is a limitation we have rn. No great solution yet. Maybe a cheatcode expectSelfdestruct ?? you can in fact loop as many times as you want until the call is done i think i know why btw @mattsse - i think we should allow evm.bytecode.x in extra-output-files but not extra-output its cuz we have it as CompactBytecode in ConfigurableContractArtifact which strips the other stuff I see, extra outputs only supports other output entries and we're stripping the opcodes and generated sources but requesting `evm.bytecode` by default, so they should be always there just excluded, I think we should make this an option and include if requested https://gist.github.com/sambacha/25e167ef0a5093f206bb5a9ba9900b57 where should i open an issue? ethers or foundry? is an ethers issue When migrating from a brownie project, one step is to make sure the dependencies found in brownie-config.yml are ported over as submodules. I generally just copy the dependency such as yearn/yearn-vaults@0.4.3 and install with forge install but... forge cannot find the version 0.4.3 from tag list found https://github.com/yearn/yearn-vaults/tags . Not entirely sure what it defaults to, maybe the v0.4.3-1 which is the latest version.",488
451,foundry-support.txt,"In order to install the version I want for each package I need to go look up the tags and make sure I have the correct one. In this case it's v0.4.3 and after updating my install to forge install yearn/yearn-vaults@v0.4.3 we get the correct version. This issue is not unique to the yearn-vault btw. Brownie installs the correct version. I can open an issue if, just checking here first to make sure I'm not making an obvious error. forge install yearn/yearn-vaults@v0.4.3 is the correct way to install a version, is that counter intuitive? when porting from brownie it is, yes I expect to just grep out the dependencies and run forge install aha so the extra v is the problem here? Yeah, I've had this issue with multiple dependencies. brownie leaves out the ""v"" it seems but still finds the correct version when eth-pm downloads it this is the code for parsing the version https://github.com/gakonst/foundry/blob/33f1df0ec7e17799342ee78e5e1ffb07e9ea086d/cli/src/opts/forge.rs#L249-L257 Hmm i see. this is a bit odd, because git checkout 0.4.3 doesn't work, whereas git checkout v0.4.3 is what works which makes sense! the github tag has the v in front does brownie use ethpm? or does it checkout from github I think it uses ETH pm to manage this but I’m not 100% sure. Mhm I see - guess we could add a ""v"" if there is none and there's a ""."" in the tag path of the string? Wdyt @mattsse Sometimes I wish there were easier scripting features in foundry (or maybe I havent read enough docs yet) RIght now, Im gating mints function via different merkle roots.",414
452,foundry-support.txt,"To test this, Im hardcoding the adddresses in my foundry test file, generating the merkle root in a separate js script, then copy/pasting that merkle root into setup() its just mildly inconvenient 😂 Can you explain the use case a bit more specifically? We don't want you to hard-code stuff Have you tried the FFI cheatcode? Im writing a helper that uses FFI right now, essentially it could let me call a local JS script and pass in that return value back into my test file right? Yes https://github.com/gakonst/lootloose/blob/master/src/test/LootLooseMeta.t.sol#L100 Check usage here Awesome thanks, it still seems a little 'hacky' to me back I like how the option is there Yeah hence why it's good to get feedback on how this would be better in a non hacky way In this case, maybe a merkle tree library? I think in my use case that merkle tree lib would be awesome (but idk how much others would use it), but I think a general cleaner wrapper around FFI could be cool - yet I wouldnt know what that would look like yet Would have to keep experimenting with it, but I do have to say, this foundry TG is amazing It seems to me that people just haven't used FFI enough yet, so the patterns aren't super clear And yeah in your case it's something you can do in Solidity easily Altho I can see us adding more cheatcode-like functionality for general programming, @mattsse had a PR eg for reading files from the file system ooh we got automated nightly releases, nice is there a command similar to truffle .getStorageAt() ? its in the stdlib it does use ethpm sort -t. -k 1,1 -k 2,2n -k 3,3n locales dont effect this does it? hey, any example on how to use the ffi cheat code ? I used Cheat code prank to impersonate an address. And I send some eth to another address. But the impersonated address still has the same balance as before..",444
453,foundry-support.txt,"Is it a bug? https://github.com/gakonst/lootloose/blob/master/src/test/LootLooseMeta.t.sol#L100 nice is there an easy way to console.log an entire array ? Have you been able to find the correct command usage for this? I'm also looking to downgrade to 0.1.0 from 0.2.0 (on mac), since call & function decodes don't work for me at 0.2.0 there is not without looping yourself - both for hardhat's console.log and ds-style events remember you can always make your own test utilities, so you could conceivably add one yourself that you can reuse :) see e.g. https://github.com/Rari-Capital/solmate/blob/main/src/test/utils/DSTestPlus.sol Anyone else having issues on call trace decodes on 0.2.0? For some reason I can't seem to reproduce it on a small POC/small repo, but on a large repo it seems to not be able to decode any call traces really? 🤔 do you have an example? also there were some trace fixes yesterday can you try running foundryup and doing it again? Did that and indeed saw that the yellow ""staticcall"" etc is added in the traces. Unfortunately still no decodes. Only on a solmate ERC20, I get a 'mint' decoded, but only the function call, not the contract and not the input data. Currently installing 0.1.0 so can't do a re-run to have a screenshot, but it's similar as one of my screenshots above, let me find one nvm haven't shared a screenshot here apparently 😅 interesting, any way you can file an issue? fwiw i've tested on solmate and lil-web3 which should both be ok-sized repos and they do not have these issues or well, lil-web3 has 1 issue with some events but that's because of how solidity encodes the event identifier so i'm fixing that today 🙄 basically topic 0 is the selector for the event, but topic 0 is not unique for events of the same name + types but different indexed parameters.",453
454,foundry-support.txt,"so even though decoding event SomeEvent(uint256, uint256) is different from decoding event SomeEvent(uint256 indexed, uint256), both of them have the same identifier which means that codebases with mixed erc20/erc721 will have issues with event decoding The events did seem to work though, at least a ds-test.log_named_uint seemed to work fine, but I haven't really paid a lot of attention to the events. I'll try to open an issue about it, will be hard if it's not reproduceable though. the ds-test events are decoded separately so they will always work curious if anyone has been having success deploying to polygon? Keep running into transaction underpriced and replacement transaction underpriced on Polygon only, but never had this problem deploying there using hardhat can you share a link to the code or a snippet did you ever figure this out? I'm seeing the same thing now, where a test fails if I comment out a console.log—haven't looked into it yet Yep, its the vm.load cheatcode We should track this for sure and solve asap Thanks all for bringing these up Pls share a repro for the so we can track / resolve asap Can you share a repro as well? Nope. Still waiting Waiting for?😅 Someone else to have the same issue and come up with a minimum viable reproduction 😂 The old staring contest today might be your lucky day I tried last week to make a small set of contracts as a proof of concept. For some reason it did work on such a project, but not on my main project (~30-ish contracts, plus some libs). The code is not (yet) public, so kinda difficult to share it 😅 in my case we have a factory contract, and when commenting out console.log, the msg.sender within the factory is changed from the test contract address to the zero address, cc @gakonst address _expectedContractAddress = calculateAddress(_owner); // comment out this console.log line and the this test will fail console.log(""_expectedContractAddress"", _expectedContractAddress); vm.expectEmit(true, true, false, true); emit MyFactorysContractDeployedEvent(_expectedContractAddress, _owner); MyNewContract myNewContract = factory.deployContract(_owner); basically like that @oxfoobar is this the same scenario you had? I believe so. msg.sender being improperly modified by console log cool, thanks.",493
455,foundry-support.txt,"@gakonst @onbjerg lmk the best way to help you debug the above—not sure if that info is sufficient, or if you want me to setup a repo I can do that later today can you file an issue? i'll take a look wait @oxfoobar did your test fail when commenting out console.log, or when it was present in my case the test passes with the console.log, and fails (because msg.sender is the zero address) when we remove the console.log My test is accessing a whitelisted contract, so it started failing when I added the console log Failing with an Unauthorized error huh interesting, that seems to be the reverse of what I'm seeing I'm using hevm.prank everywhere though to explicitly set msg sender Something else broke in the March 25 nightly though, because CI switched from 3/3 tests passing on an internal tool to 2/3 tests passing with no code changes (and wasn't using console log there) Only noticed the console log issue when I tried to debug and suddenly hit 0/3 tests passing once we added log statements looks like we only keep 3 nightlies so I'm not sure, but guessing that might be the first nightly after the revm transition? its not revm was nightly on 23rd/24th unfortunately not, ive built from source before too. you could try that @onbjerg is there no way to see changelogs for older releases? since we know it happend around the 25th I was gonna see what PRs were merged then to see if I can track it down but https://github.com/gakonst/foundry/releases doesn't go that far back and there's no changelog.md file no, it doesn't keep the changelog and we don't keep a changelog.md while we don't have a stable release.",378
456,foundry-support.txt,"would need to filter the PRs that were merged around there or check the commit log it's not too far back in the history i skimmed it and i couldn't see anything obvious the changelog is generated from the PR titles anyway only thing I could find was that we fixed a bug in the fuzzer, so if it's a fuzz test it was probably meant to fail hm alright if you already did that let me get the issue opened, then can circle back to trying to debug after mine was a fuzz test, but I converted it to concrete for debugging and still see the same issue Agreed, skimmed the github prs on the day of and didn't se anything glaring and the cause is msg.sender being changed to zero address Hello everyone I don't know if this is a question that has been asked a lot of time please pardon me i am trying to test the mint function and i keep getting this error, do you any idea where it coming from [FAIL. Reason: TransferToNonERC721ReceiverImplementer()] I will appreciate if anyone can help me Your User/test contacts need to implement the onERC721Received function @oxfoobar do you have your console logs right after a prank? I think the issue is that the staticcall in console.log is where the prank occurs, i.e. it doesn't get ignored like calls to the cheatcode address do, cc @onbjerg Do you have any project you have implemented that I can check out? ah that might be it yeah altho i wonder why it reverts to 0 address that's just because the fuzzer chose the zero address which I didn't realize when saving off the calldata haha ah ok lol good so I think we just need to treat 0x000000000000000000636F6e736F6c652e6c6f67 the same as HEVM_ADDRESS and ignore it for the context of cheatcodes https://github.com/brockelmore/forge-std/blob/8f1a9720250512a49c6638979a87613700e2a68b/src/console.sol#L5 Not in my case, though that might also be an issue hm, you did say you use prank a lot though? hard to say without seeing your code but I suspect it must be a related cause I do but nothing fancy.",478
457,foundry-support.txt,"Just refactored the code to use startPrank() and stopPrank() explicitly everywhere and still seeing the same issues cause I believe even expectEmit and others would get redirected to that staticcall so it wouldn't be strictly a prank issue, but any cheatcode that relies on the next call doing something Continuing the conversation from main chat. Not sure if this should be an issue instead, it‘s related to the issue where calling libraries from tests would not allow forge test debug. I‘m on 613da19, what happens now is when I run forge test —debug testName I get compiling twice (first time skipped, second time it compiles) then it‘s successful, waits for a bit and then I get a SIGKILL. I would like to share contract but we‘re closed source until mid april so I‘ll have to double check if the test you are trying to debug does a lot of stuff then the debugger won't work; it will run out of memory it is not an actual interactive debugger, it records what happens and plays it back to you Ok yeah then this is it for sure I guess I‘ll do more granular debugging then Or is there a way to give it more memory? there is not, it will try to use as much as your operating system gives it we do have plans to make an actual interactive debugger at some point but it is not a priority currently I have noticed that there's double compilation sometimes when doing debug too yeah this is a side effect of how forge test works What is crashing? Is it the TUI loading too many things? Or the evm Fwiw, first time it compiled filly twice, after that it only compiled the second time it's not the TUI it is the debugarena that has too many nodes it happens if you do e.g.",372
458,foundry-support.txt,"So what do you think can be done? foundryup on both machines ah, i dont think we persist stuff from the constructor if you move it to setUp it should work hmm ah we clear startPranks? yeah we do interesting.",48
459,foundry-support.txt,.,1
460,foundry-support.txt,"I failed to create an issue and lost track of it, sorry. I'll prioritize it. The fix is pretty straightforward actually Found a way to reproduce it on my machine, created #1100 for it. I'm eager to see if it can get reproduced on another machine Yep, 1099 solves the console log problem. There's something deeper as well I'm investigating, but this gets the first one out of the way Thanks for the fix! Looks like my underlying issue was running mainnet fork tests, some state assumptions I'd made were modified. So that was the cause of the CI reversion. Sorry for crying wolf! no worries, glad it wasn't anything more severe :) Feature request (that would've helped me diagnose this a lot sooner): automatic error decoding in stacktraces Turn this into a revert CustomError(arg1, arg2) stacktrace hello, i've a question, it's there a way to log/emit an event with a value when fuzzing, say the highest output yielded by all the inputs tested? it should do that, unless that error is from a contract not in your code base? Yeah it's from a mainnet contract I was interacting with Verified on etherscan but not in the codebase yea that's https://github.com/gakonst/foundry/issues/1015 i've made some progress on it but been stuck fixing bugs Sweet, two steps ahead yep etherscan decoding soonTM thanks! i think we have an idea on what causes this If there's any more info needed, happy to provide whats the simplest way (cli preferable) to verify contracts from a forge project on other etherscan-like sites, like polygonscan? doesnt seem like its possible with forge verify-contract, which uses ethers_rs' etherscan client, right? it should work, ethers-etherscan supports polygonscan i think it auto-switches to polygonscan if the chain id matches polygon ah i was looking for some logic like that but couldnt find it ah got it https://github.com/gakonst/ethers-rs/blob/master/ethers-etherscan/src/lib.rs#L33 Is this expected behavior? I'm writing a test that imports 2 of my src contracts. Each of those src contracts defines a library Base64.",467
461,foundry-support.txt,"I'm running into an error when trying to build, essentially that the two libraries are clobbering each other Hello! Wanted to find out if there's a foundry equivalent to spoofing addresses like in hardhat: const [address, address1, address2, ...addrs] = ethers.getSigners() Solved it by moving the library to its own local file and having my contracts import that file Okay but still running into same issue because of different ERC721s b/w OZ and solmate 😭 try importing under a different symbol for one of them see https://docs.soliditylang.org/en/v0.8.13/layout-of-source-files.html?highlight=import#syntax-and-semantics this is a solidity restriction not a foundry issue :) Ty sir will give it a go import { ERC721 as SolmateERC721 } from ""..."" also why are you using both? the cheats.addr(privateKey) cheatcode should help you you can also just do vm.prank checkout the foundry book I'm importing some prod contracts out of the box that use OZ, and my contract uses solmate Making edits to the imported contracts tho to get the building successful. Just didn't expect to hi has there been any change to the way mockCall works over the past few releases? some of our test are unexpectedly failing due to a call not being mocked as expected r u setting them up in the setUp call? yes setUp calls another function defined in a parent contract, if that makes any difference ye we had a discussion earlier today, we started clobbering cheatcode state between setup and tests (mostly, some caveats).",333
462,foundry-support.txt,"I believe the resolution is we are going to switch back to the other way it was overlooked in our move to 0.2.0 sorry for the trouble understood, thanks for the prompt response! is there a way to force install foundry 0.1 on a CI? i believe @onbjerg is offline now but he either already fixed or will in next few days i think was fixed on master GOAT nightly soon ™️ given that, just run foundryup -b master i think within next hr? if u need it immediately otherwise wait like an hour or something not that urgent, thanks a lot sers, much appreciated 🙏 sorry for the breakage 😔 looks like should release nightly 2hrs from now awesome, looking forward to it 🔥 heh @onbjerg u r gonna kill me but to add the gas lines PR it bumps memory requirements even higher... 😔 a problem for another time i'm done w bug fixes for today at least gn gang hopefully this nightly fixes errthing u da best, gg king gg a `forge install`d submodule with `remappings.txt` is looking for the `lib/` path from my project root level, not the submodule level - how does one manage nested forge projects and their remappings? this is a monorepo? yeah I'd open an issue for this because monorepos have been a bit underexplored You may be able to do forge install <..> --root . but unsure if it works mmm, no dice. but i’ll open an issue, thanks! ive seen it similar to a cargo repo with multiple pkgs - i.e.",335
463,foundry-support.txt,"a foundry.toml per folder can link https://github.com/sense-finance/sense-v1 then look in pkg then each folder is its own foundry ah, thanks i’ll check this out actually maybe different situation - my root project is a foundry with its own foundry.toml and then root/lib/projectB has its own foundry.toml + remappings.txt which is searching not from root/lib/projectB/lib but rather root/lib Is there any equivalent of ethers RLP encoding or ethers.utils.getContractAddress({from, nonce}); functions? EDIT: is also possible to get the transaction nonce of a given contract addy? Just trying to pre-compute an expected contract address gm frens, is it true that foundry's abi output is incompatible for geth's abigen? Always getting unmarshal errors. Any ideas on how to generate go bindings otherwise (compiling with abigen directly is tricky because the imports can not be resolved). Thx Not sure if there is such a cheatcode, but you could calculate it in your contract yourself. https://ethereum.stackexchange.com/questions/24248/how-to-calculate-an-ethereum-contracts-address-during-its-creation-using-the-so might help you out. I don't think there is a practical way to get the nonce of a transaction in solidity. You could use a create2 to calculate the address based on a salt, might be more predictable. Alternatively if your function returns the created address, you could use the mock() cheatcode? Yes I already calculated the address based on parent contract/rlp/nonce Was just wondering if there's a built-in helper to make my test tidier :)) (and learn more Foundry at the same time) forge install OpenZeppelin/openzeppelin-contracts-upgradeable Installing openzeppelin-contracts-upgradeable in ""/Users/rahul/dev/projects/midasprotocol/contracts/lib/openzeppelin-contracts-upgradeable"", (url: https://github.com/OpenZeppelin/openzeppelin-contracts-upgradeable, tag: None) Error:  0: ""https://github.com/OpenZeppelin/openzeppelin-contracts-upgradeable"" is not a git repository Location: cli/src/cmd/forge/install.rs:145 but it is...",462
464,foundry-support.txt,"fixed by deleting a bunch of directories and retrying hey did u mean to send this to the group as a whole? Yeah it‘s not confidential Hey everyone I am trying to test a private function in my smart contract but I am getting error that ""the function is not found or not visible after argument-dependent"" you’d have to expose that function by inheriting the contract into a wrapper with a public function that calls the private one. The error is telling you that it’s just not in the interface at all right now. Is it possible to compile yul with foundry? (Or Yul+ directly) not sure.",126
465,foundry-support.txt,"i know someone began work on yul but i don’t know the status Hi guys, I'm running tests on foundry and I'm having troubles with a unit test, I've also tried deploying on testnet to double check and I'm suspecting there might be an error in the forge-std vm here is the code that should check the sellFee of the token: function testSellFees(address seller,uint96 amount) public {   vm.assume(seller!=address(0));   vm.assume(amount> 1 ether && amount<=token.balanceOf(address(this))&& !token.isExcludedFromFees(seller));   token.transfer(seller,amount);   vm.prank(seller);   vm.deal(seller, 100 ether);   (,,,uint256 sellFees)=token.sellFees();   uint balanceBeforeToken = token.balanceOf(seller);   assertEq(balanceBeforeToken,amount);   uint balanceBeforeETH = address(seller).balance;   uint[] memory amounts=router.getAmountsOut(amount, sell_path);   uint[] memory amountsTaxed=router.getAmountsOut(amount-amount*sellFees/100, sell_path);   //console.log(amounts[0],amounts[1]);   //console.log(amountsTaxed[0],amountsTaxed[1]);   token.approve(address(router),type(uint256).max);   router.swapExactTokensForETHSupportingFeeOnTransferTokens(amount, 0, sell_path, seller, block.timestamp);   uint balanceAfterETH = address(seller).balance;   //console.log(balanceAfter-balanceBefore);     assertEq(balanceAfterETH-balanceBeforeETH,amountsTaxed[1]);  } this fails while assertEq(balanceAfterETH-balanceBeforeETH,amounts[1]); would pass, which means no fee is being taken, even tho it should be taken since the address is not excluded from fees deploying the same token on a testnet and checking the amounts and amountsTaxed I see that on testnet it behaves correctly am I missing something? what is the input of seller and amount that cause it to fail? actually just run forge test -vvv -m testSellFees and screenshot it Is there a way to check for failure.",469
466,foundry-support.txt,"I am using require in my contact and not revert so I can't seem to get expectRevert to work? Currently using testFail to start the test name and it's working for failed test this is incorrect - u can use expectRevert on a require require is just a wrapper around revert effectively can you post your require statement and i can tell u how to do the expectRevert? I got an error that ""did not get expected revert"" Alright let me do that require(_mintAmount <= MINT_PER_TX_PUBLIC, ""max mint amount per transaction exceeded""); vm.expectRevert(""max mint amount per transaction exceeded""); can u do forge test -vvv -m <testName> and post the screenshot? Alright With the expectRevert expectRevert is for *the next call* so you would place it just before calling publicMint Thanks very much it worked, I was putting it at the top🤦🏽‍♂️🤦🏽‍♂️ [FAIL.",211
467,foundry-support.txt,"Counterexample: calldata=0x6d4a512a0000000000000000000000000000000000000000079e222b27bf1e659508486900000000000000000000000000000000000000000000000118d7bc13691b3c12, args=[0x0000000000000000079e222b27bf1e6595084869, 20236850242166406162]] testSellFees(address,uint96) (runs: 0, μ: 0, ~: 0) the full output is a little bit messy cause a lot of things happen in the transfer, I try to make a toy example and see if I get the same behavior u only prank for the token.sellFees call - is that what u intended to? oh, doesn't the prank change the msg.sender until I change it again? no, only for the next call use startPrank for a longer duration no u gotta do startPrank for continued msg.sender startPrank continues until u call stopPrank 😄 Thanks a lot guys, that is surely the root of the problem😅 now I run to verify it fingers crossed! and another thing, now when I run tests I run them like forge test --fork-url <url> -vv but it takes quite a while (I imagine because every time I call it it has to fork the chain, can I make it more efficient by forking the chain and letting it on and just say ""use the forked chain for the tests""? How can I do this with foundry? not entirely sure what u mean - but forking can be pretty slow in the beginning.",351
468,foundry-support.txt,"i recommend setting a --fork-block-number so we can cache the results for you then it will be faster the next time u run if you set --fork-block-number we will write the data that the tests asked for to ~/.foundry/cache (also generally a good idea to set a block number in case the state changes on chain) now it works 😄 thanks guys great! mmhh it's still quite slow but I don't know if it may be normal and probably caused by the fuzzer (I changed the runs to 16 tho) should be pretty fast is there any saved data in ~/.foundry/cache? for one of our benchmarks the cache reduced testing time to 500ms from 7 mins yes there is a solidity-files-cache.json wow! nothing else? are u on the latest foundry? try running foundryup there should be something like ~/.foundry/cache/mainnet/<block number>/storage.json (provided you set --fork-url and --fork-block-number) ok maybe it wasn't the latest version, running it it downloaded stuff, now I retry fingers crossed again 😄 did something change with the new version?now I get [FAIL.",236
469,foundry-support.txt,I didn't set a mnemonic 16487124 whats the 0x9cc6..,19
470,foundry-support.txt,"I got an error on installation, 'could not execute process PATH\build-script-build' caused by system cannot find file . the install command I used was: cargo install --git https://github.com/gakonst/foundry --bins --locked Have you tried foundryup? To install pre-built binaries How do most people do local development of a front end with projects that use foundry? I'm pretty new to solidity dev and most docs/tutorials use some combination of hardhat, truffle, waffle etc that seem bloated and not aligned with a workflow that foundry is trying to enable. Are there any guides on a recommended workflow for getting a local chain setup and building a react app with a structure that plays nice with foundry defaults? We don't have a node for deploying contracts w frontend yet, it's WIP here https://github.com/gakonst/foundry/pull/1037 Thank you Georgios, I just restarted and re-ran the command and the installation was successful. I was about to delete the question, thank you for the response! hey, any reason forge-std is not included in forge by default? I may be interpreting it incorrectly, but to realize the effects of selfdestruct, we need to wait until the ethereum txn completes. extcodesize of the destructed address is nonzero in the same transaction. This doesn't mean its not possible now right, maybe just not simple? Some combination of geth, ethersjs and deploying contracts with a bash script would be doable? I usually go with hardhat node and deploy the contract there. So far the easiest I’ve tried You can use forge create to deploy, and we have a Solidity-native deploy system in the priorities right after the node We've been focused on the testing experience first, and not the deployment so far, but that's changing Is there a foundry equivalent of upgradeable proxy scripts found in hardhat? I came across this one https://github.com/odyslam/foundry-upgrades/blob/main/src/test/ProxyTester.t.sol i have a contract as follow contract Foo {  function bar() {   require(msg.value >= 0.01 ether, ""insufficient ETH"");  } } and in the test file, im doing vm.prank(attacker); foo.bar{value: 0.01 ether}(); but i get Arithmetic over/underflow.",489
471,foundry-support.txt,"does anyone know how can i fix it? thanks! can you try including the function modifier payable? cause without it I think you might be calling a non-existent fall back function, doesn't totally align with the error you're getting but worth a try hey thanks! yea the function has a payable but i got the same error sorry i left it out i also tried changing the value to 0.001 ether and added assert(msg.value == 0.001 ether); and it passes this assertion but fails the ""insufficient ETH"" here is the repo: https://github.com/bblanc42/etherhack-foundry/blob/main/src/test/Azino777.t.sol#L37 I wanted to create a foundry version of damn-vulnerabele-defi but I’m at the point where I need to deploy a uniswap-v1 exchange and factory. which should be the best way to do that? I’ve searched and there’s the source code but it’s in vy. Would I be able to just import it “normally” like I’m doing with other external dependencies? How to use cheat code to simulate passage of time? 7 days for example. I’m using this  //move block.timestamp forward by a given number of seconds  function mineTime(uint256 numSeconds) external {   uint256 targetTimestamp = block.timestamp + numSeconds;   vm.warp(targetTimestamp);  } Thanks! Another question. How to increase the balance of Ether(or other native tokens) of an address using cheat code? I am using fork mode deal(address,amount) Amount is in wei quick question - i've looked at foundry.toml options defined here https://github.com/gakonst/foundry/blob/master/config/README.md#all-options my question is whether you can define an equivalent config file relating to the ""forge create"" command ie for constructor-args, contracts, chain etc.",388
472,foundry-support.txt,"know some of these can be catured in env vars but a config file would be useful for us when we have a generic contract that is being deployed for a couple projects ideally could just do something like (not sure if something like this exists) forge create --config project1.toml forge create --config project2.toml Anyone else ran into a /root/.foundry/bin/forge: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.29' not found (required by /root/.foundry/bin/forge) on their ci/cd setup? $ foundryup foundryup: installing foundry (version nightly, tag nightly-9ed6b8878c7c2daeb0a6b17ec3b9ff04e7752131) foundryup: downloading latest forge and cast ######################################################################## 100.0% foundryup: downloading manpages ######################################################################## 100.0% /root/.foundry/bin/forge: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.29' not found (required by /root/.foundry/bin/forge) foundryup: installed - foundryup: installed - cast 0.2.0 (9ed6b88 2022-03-30T00:30:24.627142823+00:00) foundryup: done $ forge test -vvv --gas-report forge: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.29' not found (required by forge) https://github.com/gakonst/foundry/#out-of-date-glibc-error-when-running-forge-from-default-foundryup-install ubuntu is dumb and doesnt ship latests GLIBC damn, a RTFM in my face... Thanks! Nope we're working on a separate deploy system though cool thanks for the info does anyone have a good hardhat + foundry repo example? Congrats to the team for Foundry v2.",426
473,foundry-support.txt,"Thankful for your hard work :) Does anyone know if the solidity compiler optimizes tail recursion? has someone tried to port damn-vulnerable-defi to foundry? I’m trying to migrate Puppet where it needs to use/deploy uniswapv1 but I’m failing in the setup with this instruction uniswapExchange.addLiquidity I’m using the abi+bytecode provided by the repo (I’ve moved the bytecode to the root of the json) and following @storm0x example to import the json + deployCode but I’m getting this error (for the instruction above)  ├─ [800] UniswapV1Exchange::422f1043{value: 10000000000000000000}(00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008ac7230489e800000000000000000000000000000000000000000000000000000000000000000000)  │ ├─ [230] 0xefc5…b132::422f1043(00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008ac7230489e800000000000000000000000000000000000000000000000000000000000000000000) [delegatecall]  │ │ └─ ← ()  │ └─ ← ()  └─ ← () https://github.com/nicolasgarcia214/damn-vulnerable-defi-foundry Hi, I have a local mainnet fork through hardhat. When I run this command: cast send 0x462Cd4e2446efC382A9e2a0b1C64a8d17f8bB87D --value 100ether --rpc-url http://127.0.0.1:8545 --from $VITALIK, it returns an error: (code: -32000, message: unknown account 0xd8da6bf26964af9d7eed9e03e53415d37aa96045, data: None) I read above that this was a bug and should be fixed now where I am trying to impersonate an account via --from.",501
474,foundry-support.txt,"This is my cast version: cast 0.2.0 (9ed6b88 2022-03-30T00:35:34.802259+00:00). Yeah this makes sense, you are trying to send from an account that's not unlocked on the node You can only use --from / ETH_FROM for accounts that exist on your node Not for any account If you're using hardhat node you need to do a custom hardhat_impersonateAccount call to your node I believe to allow this to work (we might add this in the forge node by default, but not yet done) got it. thanks for explaining can we do a custom RPC call from cast? @gakonst I saw this this morning but he’s not implementing all the tests. The puppeter (the one with univ1) is not there 🙁 ah rip no but should be easy to add, PRs welcome 😄 you'd need to call provider.request(""..."", [...]) and there’s no way atm to deploy vy contract with forge right now right? not familiar with Rust, but can try. https://github.com/gakonst/ethers-rs/blob/master/ethers-providers/src/provider.rs#L191 thanks, I'll try to code it up! is it possible to ignore warnings in libraries? as mentioned in other chat - we can spoof it like we do now for the block, but i'm not sure what the gain is? what are u trying to do more specifically is it possible to write to a mapping using store or forge-std? should be if you know the slot it occupies, see https://docs.soliditylang.org/en/v0.8.13/internals/layout_in_storage.html#mappings-and-dynamic-arrays more specifically, if you know the slot p, a value in a mapping with key k will be at slot keccak256(k + p) where k + p is k and p concatenated dont know if there is a helper in forge-std cc @brockelmore directed at me? no sorry, at @benesjan - for ur question it should be possible to ignore errors but u need to know the error code.",454
475,foundry-support.txt,"if I think foundry as something that allow me to test real-life scenarios it would make sense to expect timestamp and block > 0. maybe not if I’m testing the genesys of a blockchain 😄 anyway yea i'd recommend getting into using the debugger, it may be a little daunting at first but u don't rly need to pay too much attention most of the time :) for this case it was enough stepping to the last part of the bytecode and seeing that it had ""TIMESTAMP"" ""GT"" in it is there a tutorial on the debugger? the book has a section but would be cool to see some more content if any no tutorial yet, i have 1-2 remaining tasks on foundry before i put a lot of energy into getting the book finished/up to date forge test —debug testName then just start exploring :/ controls are displayed in the debugger itself which will include a better debugger section but yea there are no hidden super features (yet), it's pretty simple and the controls are on screen :) altho i must say, i used the latest debugger and those colorings on memory/stack are 🔥@brockelmore just foundryup? yep can someone pls help me with the `Arithmetic over/underflow` error here? https://github.com/bblanc42/etherhack-foundry/blob/main/src/test/Azino777.t.sol#L37 i also tried changing the value to 0.001 ether and added assert(msg.value == 0.001 ether); and it passes this assertion but fails the ""insufficient ETH"" block.number starts out at 0 so you need to do vm.roll(1) otherwise https://github.com/bblanc42/etherhack-foundry/blob/main/src/Azino777.sol#L24 fails lol thank you ser. it worked! oh man never expected that 🙁 one more question, is vm.load the same as web3.eth.getStorageAt()? yep thanks! 🙂 how do you deal with incompatible solidity versions for forge-installed submodules that you don’t own? e.g. lib/submodule1/contract1.sol uses pragma 0.8.10 and lib/submodule2/contract2.sol uses pragma ^0.8.11 but i need both contracts in my project.",471
476,foundry-support.txt,"for OZ dependcies i try to ""pin"" the exact release branch to the version so maybe one of your dependencies is more flexible w other versions [submodule ""lib/openzeppelin-contracts""] path = lib/openzeppelin-contracts url = https://github.com/OpenZeppelin/openzeppelin-contracts branch = release-v4.4 and you’re out of luck if there’s no release branch with a compatible version then? sighs I'm having trouble verifying my contract Error: 0: ←[91mContract verification failed: Response: NOTOK Details: `Fail - Unable to verify`←[0m Location: ←[35mcli\src\cmd\forge\verify.rs←[0m:←[35m161←[0m Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets. is there a way to add optimizerSteps details to foundry.toml? I can only find optimizer_runs as a configuration key so maybe all the fuzz I genered helped to discover something 😄 my contracts don't get compiled when i run forge build, i think it has something to do with me oz contracts. Has anyone else faced the same issue? What are your remappings? File not found means either lib modules are not downloaded or path is wrong Or not configured how do i configure them, i'm still new Remappings section in book i get this when i run remappings $ forge remappings ds-test/=lib\ds-test\src/ openzeppelin-contracts/=lib\openzeppelin-contracts/ sighs, okay thanks you’re importing with an “@“ sign infront, but the remapping for the oz contracts is missing it https://github.com/storming0x/foundry_strategy_mix Example with @ in front Look at toml Adjust to your path lmao, i added remappings = [""@openzeppelin/=lib/openzeppelin-contracts/""] # a list of remappings to foundary.toml and it works now Thanks man, works now Oh, so that's why This should not be needed in Foundry repos btw cc @patrickalphac i saw you use custom remappings in your foundry tutorial Yep! In our starter kit we used the old dapptools way with remappings.txt.",483
477,foundry-support.txt,"I’ll have to update to use foundry.TOML https://github.com/smartcontractkit/foundry-starter-kit/blob/main/remappings.txt But yeah, ideally you’d do it like this: https://github.com/PatrickAlphaC/foundry-play/blob/0191fcee1d31ab532e1fff1960305b35b13c22e1/foundry.toml#L6 Then how should I have done it ? Yeah, I got that method from his video ah word yeah you need that when `forge install`'ing but for `npm install`ed openzeppelin contracts you dont need a remapping You could do import openzeppelin-contracts/... instead of import @openzeppelin/contracts if you want to avoid the remapping and you're not in a shared hardhat repo Okay, i'll try it and get back to you nested remappings.txt files in submodules were still giving me issues. the remappings in my submodules were still pathing from root-level, even after i added root = “.” to their foundry.toml - ended up having to put @openzeppelin/contracts/=lib/mySubmodule/lib/openzeppelin/contracts in the root-level remappings.txt to get it to work correctly but this wouldn’t work if my root-level needed the same OZ dependency --> C:\Users\HP PAVILION GAMING\Desktop\projects\erc721a\src\CustomNFT.sol:5:1: | 5 | import ""@openzeppelin-contracts/access/Ownable.sol""; | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ It did not work tried it without the @ too, like you said here. still did not work sighs, hey guys another error brought me back i can't verify my contract Error: 0: ←[91mContract verification failed: Response: NOTOK Details: `Fail - Unable to verify`←[0m Location: ←[35mcli\src\cmd\forge\verify.rs←[0m:←[35m161←[0m Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets.",469
478,foundry-support.txt,"[⠆] installing solc version ""0.8.10"" I think I've noticed that too gas report command isn't providing a ton of info joey:xTRIBE @ master * u= origin/master$ forge test --gas-report --match-contract Gas [⠢] Compiling... No files changed, compilation skipped Running 1 test for src/test/gas/xTRIBEGas.t.sol:xTRIBEGasTest [PASS] testDeposit() (gas: 48763) Test result: ok. 1 passed; 0 failed; finished in 6.37ms expecting something like this https://book.getfoundry.sh/forge/gas-reports.html Hi all. I’m confused about something. Does Foundry itself contain an EVM? If not, what EVM is it using? It does contain an EVM! https://github.com/bluealloy/revm This should work unless the test contains no external calls I think this should no longer happen per the latest nightly release Q to foundry contributors: what coding setup do you use? Trying to be vanilla (VS Code with rust-analyzer), but I’m having hard time with foundry CI: 1. rustfmt is used from nightly-2022-03-20 - is that a hardcoded version? how do I keep my local setup in sync with CI? 2. how do I get the doc tests working locally? tried cargo test --locked --workspace --all-features --doc (same command CI uses), but it just ignores all doc tests (while CI complains for good reasons). 1. I usually do rustup update nightly; rustup override set nightly and then copy the command being used in the CI 2. not familiar, haven’t tried maybe try with +nightly as with all other like fmt and clippy? anyone has a repo that structures foundry tests in line with best practices? Hey guys has any one met this error while first running forge build? [⠊] Compiling...",416
479,foundry-support.txt,"[⠒] installing solc version ""0.8.10"" [⠢] Failed to install solc 0.8.10: error sending request for url (https://github.com/roynalnaruto/solc-builds/raw/465839dcbb23fd4e60c16e8cae32513cd5627ca0/macosx/aarch64/list.json): operation timed out Error: 0: error sending request for url (https://github.com/roynalnaruto/solc-builds/raw/465839dcbb23fd4e60c16e8cae32513cd5627ca0/macosx/aarch64/list.json): operation timed out 1: operation timed out when I try this cargo install --git https://github.com/roynalnaruto/svm-rs && svm install 0.8.10, I also met similar error. Could anyone help me please? hi guys I cannot update my forge version correctly it said has installed 0.2.0 but I still can only see my version as 0.1.0 You have to delete the old files first, same problem happened before > do rm ~/.cargo/bin/forge & rm ~/.cargo/bin/cast Seems like —target-contract became a necessary param even for files with single contracts, otherwise panics with out of bounds hey guys where are the versions of forge dependencies pinned? if we do forge install in CI will it always use the same version as local? they should be, yes it is not directly visible in the source root, should be stored in the git db somewher do i have to do anything in the github CI setup to guarantee that? i dont think so, forge install just recursively updates the submodules Ok seeing some issues where ci is behaving different than local thanks bro.",380
480,foundry-support.txt,Thanks for your great work! does anyone know if there is a solmate erc721 enumerable.sol? tryingto get tokenIdByOwnerIndex.,29
481,foundry-support.txt,.,1
482,foundry-support.txt,"^0.8.0 `src/WETH9.sol (^0.7.0)` is the offender in this case in my schedule to finally improve this message in the next days hey guys when the test contract gets sent back ETH it just fails no matter what I have payable receive and fallback functions guys I know it's not foundry related but I can't find info anywhere😅 I'm struggling with Error: Returned error: VM Exception while processing transaction: Transaction's maxFeePerGas (1) is less than the block's baseFeePerGas (1602) (vm hf=london -> block -> tx) running some truffle tests, any ways I can solve this? you gotta set a higher max fee per gas on your transaction, i think it’s done via contract.foo(1, 2, 3, { gasPrice : 1234 }) (may need to replace gasPrice with `maxFeePerGas`) is there a way to do spyOn behavior for unit tests? my contract is using an external contract’s interface to make a call and i don’t want that external contract to actually make a call in my test check mockCall maybe or expectCall Thanks, this works but alters the balance of the callers and I'd need them to not be influenced by fees yeah this, it just always reverts strange working on the docker tutorial for foundry book. Noticed that when running forge create, the command fails if I pass --constructor-args after --private-key. Possible I am going crazy or missed something in the documentation. Gist here: https://gist.github.com/dmfxyz/b8468bae2b2a1a60a33f02445b1b7f90 No this is right Ahh so it’s intentional that private key has to provided last? it is a limitation from the CLI lib we use iirc it was brought up in a github issue around forge create Ahh my bad. Searched the issues but not deep enough I’ve tried raising it to 0.8 but I still get the error probably it’s a mix WETH + uniswap v2? I can try to push the repo if you want to give a try ok it’s a mix of both WETH9 + univ2 core + univ2 pherifery also, adding those openzeppelin has started to throwing warning on forge build all like this Warning: Unreachable code.",495
483,foundry-support.txt,"--> /Users/stermi/dev/web3/workbench/forge-template-mvp/lib/openzeppelin-contracts/contracts/token/ERC20/ERC20.sol:203:9:  | 203 |   return true;  |   ^^^^^^^^^^^ @mattsse @gakonst if you want to give a try I’ve created a new branch: https://github.com/StErMi/forge-damn-vulnerable-defi/tree/puppet-v2 the file you need to look after is src/test/puppet/PuppetTest.t.sol if you try to uncomment WETH9 or PuppetV2Pool portions from the test the build fail with those compatibility errors also migrating from ^0.7 -> ^0.8 for WETH9 “fix” that problem but I would not like to do that because 1) you are moving to 0.8 where you have safe math 2) I need to modify WETH9 code to make it build I’m migrating damn-vulnerable-defi and I’m tryting to use the same lib versions tincho is using so it should work or at least, hardhat would not complain about it if I can help you out in anyway let me know Do we have a guide in the book yet for deploying incompatible contract versions with getCode/deployCode? https://twitter.com/0xBoobavelli/status/1509731855179956226?s=20&t=ofzYSisZkFyM8bV-7AlIlA this also seems to come up frequently and we should add to the book @gakonst note that the problem remain if in the test file I linked I uncomment the PuppetV2Pool code part that inside import univ2 perifery.",360
484,foundry-support.txt,"If I do that I get the incompatibility error I'd recommend opening an issue which aggregates all the feedback you shared above and the solutions tried And we can track and respond there Because this seems non trivial? https://github.com/gakonst/v3-periphery-foundry/blob/main/contracts/foundry-tests/utils/Deploy.sol#L32 See here for deploying contracts with incompatible versions You use this pattern it make sense if they are just one, but how about the whole univ2 core and periphery? See the codebase I shared anyway I’ll make the change using deployCode for WETH9 and I’ll create the issue going to do some test and let you know Yep Thank you appreciate it Hi, i have a question. How to mint an upgradeable token (ex USDC)? I call tip function but I got error ""index out of bounds"" Ah I thought we fixed that in latest forge-std? @brockelmore uhm the problem could be that PuppetV2Pool is a pragma solidity ^0.6.0; and I can’t do nothing about that (it’s part of the CTF). just out of curiosity, is this a foundry limitation? why is hardhat able to build without compaining? as I said I’m just an user so my knowledge is really at the beginning, sorry for asking this kind of question but I’m starting to being interested to know how it works at low level to be able to help fixing this 😄 Because you're testing in Solidity the contracts you import must be compatible Whereas in hardhat you deploy in js so there's no connection when I open the issue is it bug/support or feature? but as far as I get it’s impossible to fix this? I mean having the CTF contract being pragma solidity ^0.6.0; I haven't checked the contracts you import so idk Just the ctf contract should be able.to compile Yes, you are right. I didnt update it. Thank you @gakonst here you go https://github.com/gakonst/foundry/issues/1163 let me know if I need to add more info The call trace sometimes not correctly decode the method name and event, but after i perform forge clean it behaves normal.",463
485,foundry-support.txt,"Is it a known issue ? For some reason console logs never actually sprintf when used in foundry Like it still shows the %s i dont think interpolation is implemented it just tries to convert hardhat console.log’s to ds-test’s log_string events i think mind opening an issue for that? there's no sprintf but probably nice to have? gm sers. I am trying to implement Etherhack in Foundry. I found a solution online that uses web3.eth.getStorageAt() to get a private variable in a contract. I tried doing vm.load() here: https://github.com/bblanc42/etherhack-foundry/blob/main/src/test/PrivateRyan.t.sol#L69 but kept returning me 0 for whatever location of the storage i try to load. i wonder if anyone is kind enough to take a look and lemme know what's wrong? Thanks! Will do It's possible you had an old cache version Does it keep happening? context: forge snapshot --check has been my go-to ci script for running tests. now that it doesn't run fuzz tests anymore, how can i run forge test just for fuzz tests (without name matching)? It can still run fuzz tests with a flag no? but then it will check the median gas and it will fail So do forge test! And snapshot in a separate step yes, that's what i want. but to do that i need to rely on test name matching.",289
486,foundry-support.txt,"forge test could have a flag for just running fuzz tests I'm not following :P Why do you not run Forge test to get all tests To ensure things pass And separately run Forge snapshot check to ensure that unit test gas is the same is RUST_LOG=evm-adapters=trace forge test no longer the right syntax in 0.2.0? I'm not getting any extra logging this way (trying to see what inputs the fuzzer is using) Yeah need foundry-evm=trace I think The adapters package doesn't exist anymore hm RUST_LOG=foundry-evm=trace wasn't it either @onbjerg have u got it to work? Try foundry_evm? ah yep that did it, RUST_LOG=foundry_evm=trace forge test thanks! yes, it works, but non-fuzz tests will run twice how long does that take on CI? I'd expect it to be negligible hi im getting this error when running forge brew install libusb, check the README on the repo is the version 0.2 already out ? when running foundryup my version is still 0.1 0.2 is out, try steps 2 and 3 in the pinned message any examples of passing different argument types to `cast`ed function calls? Hello there! I'm working on the tests for a contract that uses a linked library. According to this https://book.getfoundry.sh/reference/config.html?highlight=libraries#libraries , I can specify an array of libraries to be linked, but what address should I use if I'm testing locally? When testing locally the libraries get auto deployed and linked So you don't need to do anything 😍 Any examples of how to encode struct args when using forge create? Constructor needs multiple structs, but I haven't seen any docs or examples on how to do this properly. Migrating from 0.6 to 0.8 and using OZ lib so locations of contracts have changed when importing. This output just tells me something is wrong but no indications of where the import issue is. I can grep it myself but seems like there should be more info here. after fixing the above, running this a second time to catch the next error it tells me where the issue is Hello. I'm trying to verify a contract on ftm.",476
487,foundry-support.txt,"I'm using something like: forge verify-contract --chain-id 250 --compiler-version v0.8.13+commit.abaa5c0e 0xContract src/Contract.sol:Contract KEY but am running into a error: Error:  0: Failed to submit contract verification: error decoding response body: expected value at line 2 column 1 Any thoughts on how to debug further? RUST_BACKTRACE=full doesn't show anything useful @gakonst would it be possible to load libraries like we do with deployCode/getCode? I don’t think so right? Also for libs like SafeMath. To avoid those solidity compilation errors that I get What tool to use to compile .sol to bin? Forge .. they’re in out/ folder im having some issues while building a project with other foundry projects dependencies when they have further remappings. for example: projA -> lib/projB -> lib/solmate is there a better rather than adding to my remapping.txt solmate:lib/projetB/lib/solmate/src ? hi trying to follow the intro on the website the dir you are trying to install the lib in is probably not git initialized yet which i assume is the case going off the cwd being Desktop yup no git just ran the line in Desktop so should i make a new dir and cd, then run the forge install? worked thanks @meetmangukiya Hello, how to run debugger on function with arguments. For example on --sig ""store(uint256)"" ? since forge doesnt really run a node with rpc etc but just runs the vm, is it still possible to run a local network somehow to test your front end against for example? i guess not so its better to just run local hardhat for that use case? Any tips on managing tests that involve forking on multiple networks? Not something that we've thought about a lot - there's an open Issue on it I think? Ah I see. Ty for the info! For hevm there is --arg flag. Is there sth similar for Forge debugger? Write a test and debug that Yeah it would work. Although my intention was to avoid that Yeah it’s the only way I know unfortunately Kk, thx.",456
488,foundry-support.txt,"Will go with your suggestion https://github.com/onbjerg/foundry-book/blob/7a8295e0e9a4ed7a2269790dc55a1fd57a1cb425/src/forge/cheatcodes.md?plain=1#L89 im a bit confused here following the book, it says using ´testFail´ is considered an anti pattern, but i have a test that expects a revert and if i dont add testFail to the name it doesnt work also its smth i figured out but want to confirm, i cannot run both a test that has a revert scenario along with a success right? say 1 line i expect to revert but next lines will execute, like calling in same test an onlyOwner method w random user and then w owner, guessing these need to become separate tests right? im guessing i never reach line 266 here although its valid, test seems to work, but this is not correct pattern of tests ? https://book.getfoundry.sh/reference/cheatcodes.html vm.expectRevert() yeah but if i use expectREvert execution ends in that point right? whereas in hardhat or brownie i can expect a call to revert but keep going No Execution continues i c, still if i remove fail from test name it does not work it seems, so i guess i can do tests that mix revert cases w successful calls, but i need to put Fail in the testName? You’re probably not catching the error correctly you do not need to put fail in the test name to use expectRevert Srry what i mean by this is that a revert returns some data, and expectRevet will fail if you don’t tell it what data to expect Does the revert happen in an internal call? Like testing a library? i c, i think it's a vyper artifact issue it seems.",380
489,foundry-support.txt,"Vyper has a revert reason assert _locked.amount == 0, ""Withdraw old tokens first"" if i do // ""Withdraw old tokens first"" vm_std_cheats.expectRevert(bytes(""Withdraw old tokens first"")); veYFI.create_lock_for(doggie, _amount, block.timestamp + 2 weeks); it fails vm_std_cheats.expectRevert(bytes("""")); veYFI.create_lock_for(doggie, _amount, block.timestamp + 2 weeks); empty string revert reason works im testing a vyper contract so that could be the reason my daily life starting with foundryup Does anyone have examples of testing EIP-712 signatures with foundry? (is there a VM hack to even do this?) Ermm you could prolly use sign() and addr() lol my VM is way out of date, ty ty yea you use the sign cheatcode check solmate https://github.com/Rari-Capital/solmate/blob/7c34ed021cfeeefb1a4bff7e511a25ce8a68806b/src/test/ERC20.t.sol#L89-L103 we should add this pattern to the Book Tutorials related, what's the best way to have VM.sol automatically update? Can it be made into a submodule? That would be very valuable https://github.com/onbjerg/foundry-book/issues/159 hmm i think forge-std as a submodule makes sense most of the time I can make that update later today (or probably tomorrow when I've cleaned up https://github.com/ourzora/v3/pull/160) > The module includes tests written for Foundry 🔥 in the checklist is there an easy way to assert that something will be false? (I mean, ofc there's assertEq(false, whatever), was hoping for something like assertTrue) I think that the tx fail because the user has not enoguh funds should be more explict.",396
490,foundry-support.txt,"should vm.prank also override the tx.origin in case the pranker is an EOA? or how should I write the test to not make it fail because of this? hey guys would there be any reason to have different builds (i.e. bytecode) depending on what platform youre building on? our addresses dont seem to be deterministic between local (i.e. Mac) and CI (ubuntu) platforms hi is there a way to ""reset all remappings""? been working with a repo that contains two more foundry-powered git submodules. we've been running into a lot of remapping resolution errors recently and can't figure out an easy way to debug the same. A common approach for this is write a helper contract called something like DSTestPlus, have it inherit from DSTest, add your own assertEq overloads, then have all your tests inherit from DSTestPlus. Here's how solmate does this: https://github.com/Rari-Capital/solmate/blob/25015a1d18e75921f8cb1bacd4beb9f364e788a9/src/test/utils/DSTestPlus.sol#L38-L44 ok we see that it seems like the absolutePath key within the built forge artifacts changes across envs and that seems to affect the deployed address? the only hack for testing selfdestruct right now is: if you know a contract should self destruct after a call, you can do something like the following before your next call to remove the code and forward all ETH: vm.etch(address(myContract), """") vm.deal(address(selfdestructEthRecipient), address(myContract).balance + address(selfdestructEthRecipient).balance) vm.deal(address(myContract), 0) vm.prank(address,address) where first arg is new msg.sender, second is new tx.origin (same for `vm.startPrank`) the solmate repo definitely has a neater approach, but here's a quick & dirty one that could also help — assertTrue(bool) and assertTrue(!bool) for true and false bool checks respectively what do you mean exactly? can you just delete any custom remappings you've defined? I'm not certain if this is the cause, but different machines/paths result in different metadata bytecode hashes being appended to the contract—perhaps this is affecting your deployment addresses somehow e.g.",473
491,foundry-support.txt,"with create2? (though I don't think it should) sorry could you expand on how that'd work? wouldn't that break all imports. i've made sure to add all dependencies via forge install, does that also create a remapping by itself? yea it would break imports and you'd have to fix that, I may not have totally understood the question forge attempts to auto-detect remappings by default forge remappings should show the auto-detected remappings sorry for being vague, tl;dr we might have borked our remappings and aren't quite sure what's causing these dependency-not-found errors because all remappings.txt files look fine got it now, gonna try this out and see if we can get it working. thanks for the response Matt! no problem! also forge config shows you everything currently configured, the remappings field shows you all the remappings that will be applied any idea why this would be? the path of the artifact should have no affect ont he deployment i think The only case where it might impact deployment address is create2: the resulting address is a function of bytecode hash, and the metadata hash (appended to bytecode) varies by machine so that could affect it—but I'm not 100% certain it does affect it. One thing to try would be disabling the metadata hash when compiling, but I'll defer to @mattsse on how to do that / what other possible causes are Yeah this happens due to paths, @mattsse shojld we remove the Metadata hash? I haven't seen metadata hashes ever being useful, so I'd support removing them by default. But I think doing so means when verifying on sourcify you can only get ""partial match"" instead of ""full match"", though would need to confirm that (would be nice if foundry defaults to verifying on both etherscan and sourcify in the future). Not sure if there's any other downsides to removing it indeed we do use create2 and this certainly explains what we are seeing how can we disable metadata hash? Not possible rn because the metadata field is not populated for the solc input and default is always ipfs metadata hash, but can add this shortly, will make this a config option same as solc: none, ipfs,bzzr1 this would be amazing! please let us know! perhaps there’s a way to make paths consistent across all platforms.",488
492,foundry-support.txt,"But working with paths is quite painful we discovered… right i cant see how that wouldnt always be an issue... I have a todo for making some improvements to verify, and can have a look at sourcify do you want me to put in an issue about this? I don't think there is since it's absolute paths that are part of the metadata, which is why uniswap and others that rely on create2 turn off the bytecode hash: https://github.com/Uniswap/v3-core/blob/ed88be38ab2032d82bf10ac6f8d03aa631889d48/hardhat.config.ts#L57-L62 That’d be great! Thanks this is a blocker for our test envs so we would love to see this available soon! looks like it shouldnt be too difficult since it's supported in solidity compiler anyways? That’s good to know Adding this should be very simple , will add tonight Exactly we only need the option in the config file and then set the matadata object in the settings Yeah https://github.com/gakonst/foundry/issues/1177 issue here, lmk if you guys need anything else! anyone know a lib to generate merkle proofs with solidity? usually i would generate the proof with js and then pass to the test.. i think u can use ffi cheat code Yeah you can use the FFI cheatcode to get around that, but ideally there should be a lib for generating merkle proofs in solidity from a dataset hm i guess there is not much use cases to it besides testing in solidity? in any case i can write one if there is none yet.",337
493,foundry-support.txt,"would it make sense to add that to forge std as a utility or something? Yeah most ppl would only write Merkle Proof Verifiers in Solidity iirc there’s a js lib that supports generating them in js and verify in sol ya there’s a ton of utils for generating the proofs in just about every language yeah would rather have no js in my project though how do I properly use an expectRevert without arguments? hi all this is my setUp function and this the error I am getting when I run test with traces I did the forge t -vvvvv and I got this strategy part is the failing part btw I couldnt figured out whats wrong there any ideas? Figured it out: if the revert has a message, you HAVE to use that message as an argument to the expectRevert, otherwise it won’t work @gakonst is the migration of Uniswaps V3 periphery contracts to foundry a self documenting journey throgh the commits or is there a writeup on choices made when migrating a mature project? The former but would welcome a writeup :) Yeah for sure, I gotta complete my migration first heh. It's very useful, I (we) appreciate it! Der Sers What's the difference between cast call and cast send? using a different shell would help - those weird 31m things are ansi escape codes. looks like u r on some windows machine. there is a way to turn on ansi but im not a windows user so not entirely sure then the colors will help u figure out what failed and what didnt Using openzeppelin-contracts and openzeppelin-contracts-upgradeable, is there any way to set a remapping for both as @openzeppelin/contracts and @openzeppelin/contracts-upgradeable like with Node, or do I have to set one of them differently? Im getting a revert for some reason that I cant quite get. Alice is basically a factory contract that generates Bobs. Are you on latest version? forge 0.2.0 (a0db055 2022-04-03T00:03:29.428834426+00:00) u didn't new Bob ? It's odd that the trace isn't decoded just ran foundryup again.",465
494,foundry-support.txt,"I cant really new Bob because he has required parameters given to him by alice Is it against a fork? And you're maybe not passing --rpc-url? Thats probably it honestly Ive not set up RPC on this. so thats likely the culprit. Thank you. Oh no I know what it is If a test depends on another test completing, should they only be done under one test? Is there any concept of sub-tests? Test value doesn't initialize Bob Meaning I'd need a new there for initalization? I think i get you but not 100% sure the trace shows that bob's address is zero address That pattern seems like it will work from what i get. Thanks again. You should put the create friend and setting Bob's address step to the setUp This kind of relates to what I asked, is the only way to test a state across different tests is to set it up every time? For example, I have a minting test and a transfer test. I want to test the transfer based on the state minted by the mint test You can refactor the test so that they use the same setup state That's what I figured, thanks which is the correct way to assert a negation? for example`assertFalse` or assertNotEq? I tried to look in both the foundry book and ds-test github but haven’t find anything about it For typechain artifacts i use this: https://gist.github.com/sambacha/fa6c6a1c2ad7de88fad284ab363ab501 I updated this morning Foundry with foundryup and I now get the error The application panicked (crashed).",332
495,foundry-support.txt,"Message: No target contract Location: utils/src/lib.rs:217 Every time I try to run forge test, any reasons why? i would say using a local testnet is actually worse than using a public testnet like goerli which version of foundryup are you using? i know they rewrote it recently That one: forge 0.2.0 (a279d2e 2022-04-04T08:36:05.133962670+00:00) no, its not necessary based on recommended config for publishing verified source try installing off master Lemme try https://github.com/kendricktan/etherscan-verification-horrors I ran foundryup -b master which gave me forge 0.2.0 (a279d2e 2022-04-04T09:09:07.143542929+00:00), but I still have the issue do you u have a repo? It's currently private, but let me check if I can make it public My CI also crashed with onbjerg/foundry-toolchain@v1 so something is definitely up with the newest release What repo / what command? I made a very ugly copy/paste of the repo, but it should give the same error: https://github.com/FrenchyPeanut/NFT-with-Foundry/tree/master/packages/hardhat I was on a previous version of foundry (can't remember which one exactly), but since the morning, after a foundryup, the command forge test doesn't work anymore (forge build does though). I also have the same issue on GitHub CI, with the `onbjerg/foundry-toolchain@v1` image which cannot `forge test` the repo as well. Will investigate, cc @onbjerg In the meantime, is there a way to downgrade foundry @gakonst ? How can I clear the dependency index? > already exists in the index, you can update it using forge update Looks like forge clean deletes only contract-relates stuff, not dependencies Also, a second question. I tried deleting my dependency, but this didn't work either: > fatal: not removing '...' recursively without -r how can I solve this error? I browsed the issues on GitHub and didn't find anything This is git related unsure what you did Look up Git modules errorsmaybe? Okay, will do.",493
496,foundry-support.txt,"I'm fairly new to submodules How does Foundry remember what tag to use for a given dependency? I know that I can pass the tag name after ""@"", as in ""forge install repo/dependency@v2.0.0"", but I don't see where ""v2.0.0"" is kept track of in version control. Specifically I don't see it referenced in .gitmodules. If somebody else pulls my repository, will they get the same tag or the latest HEAD from main/master? (sorry if these are git-specific questions - I just don't know what is git and what is foundry yet when it comes to dependencies) @gakonst -san, do you know how to downgrade foundry to 0.1.0 ? 👉👈 Is there anything resembling Mocha.Js' ""describe"" or ""context"" functionality in DSTest? I'd like to group my tests like this: https://twitter.com/PaulRBerg/status/1467253188797423619 I believe Brock mentioned table tests would be added in future, which should give you this functionality if I’m not mistaken i cant reproduce the panic at all oh, interesting just did foundryup and now i can so its very very recent like last day or so Exactly, the project was working fine last friday night, and it's just until this morning, when I did foundryup that it got stuck yea im currently trying to find out where it was broken in the meantime, update foundryup and then try to pick a commit that you know works and do foundryup -C <commit> e.g. foundryup -C abcdef requires that you have cargo installed since it will build from source this version works for me: foundryup -C a0db055a6873bd8819a1b9e1a9ad3f3046ca772f Thank you so much @onbjerg , you are a lifesaver 🙏 it was broken in https://github.com/gakonst/foundry/pull/978 cc @mattsse: running forge test before #978 was merged works fine, but as soon as #978 is merged then running forge test in https://github.com/FrenchyPeanut/NFT-with-Foundry/tree/master/packages/hardhat panics: The application panicked (crashed).",488
497,foundry-support.txt,"Message: No target contract Location: utils/src/lib.rs:217 Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets. fish: Job 1, 'forge test' terminated by signal SIGABRT (Abort) checking oh this happened because I forgot about libraries when implementing sparse mode @CharlesBEYER until we fixed this properly you can make your library (WhiteListingstandardutils) functions internal Noted, thanks 👍 is it possible to have a trunk branch where commits land and a master or release branch that is branch protected by passing CI status it would be in your .git worktree git modules just points to the repo, .git/ holds module specific info foundry uses the latest commit on the origin branch, you can define a commit or git tag specifically if you want to When I select a branch foundryup -C 22323e21c3e00d9eccc5914589c23f2a0115413b I keep getting failed to load source for dependency evm has anyone had this before? Switch to mac seen the traces and fixed the error thanks! It would be good to find out how to open traces with windows aswell. Seems like my windows can’t install foundryup says : unsupported r u like windows on arm or something? No , vanilla windows ser 🤒 maybe you need to git clean -xf . && git reset —hard $commit if your going back far enough in commits you can do this: export tag=$(git describe --tags `git rev-list --tags --max-count=1`) && git checkout $tag -b $tag For installing at the latest tag do you have UTF8 enabled? I only have the issue using 0.1.0 but 0.2.0 makes some tests fail.",382
498,foundry-support.txt,"I was working with USDC forgot it is 6 decimals tried to do 18 and it got reverted. Thanks a lot ! It's saying my contract isn't verified even when it is https://rinkeby.etherscan.io/address/0x98028ebaa468b5fbc7cd25007f6215a35aa43538#readContract Can you please open an issue for this, perhaps this queries the wrong network I just ran foundryup and added gas_reports = [""*""] to my foundry.toml but cant get gas reports. to show up when I run forge test --gas-report Does anyone know how I can get this to work? do your tests make external calls? traces/gas reports do not work yet with internal calls Any idea why when i run ""forge test"", sometimes everything passes and other times everything will fail? No changes to any code, just simply reexecuting the coomand Yes, my test makes an external call to my contract. It was working before I did foundryup not sure why it wouldnt be working now. pls open an issue for this -maybe we missed something unit tests ro fuzz tests? unit test Is there an easy way to revert to an earlier version? That way I can confirm that there wasnt a change I made to cause it. If it works in the previous verison ill open up an issue maybe i'm not using the right test- just trying to call a contract and see if the call succeeds foundrup -C commit-hash Thank you, ill revert and see if the issue persists what is the equivalent to brownie's chaine.mine(1)? must have been something with my local env, I basically reverted and then did foundryup again and its working, sorry for the mixup! vm.roll(block.number+1) good to know! is there a way to hint/label function selectors the same way we can hint/label addresses? Good day tried using foundry to test for functions with custom errors, and going through the docs I discovered i need to generate the function selector, but solidity isn't seeing the error as a custom type, but it works with require. Please how can I solve this so it can work for custom errors Requires aren't supported in custom errors in Solidity yet Gotcha I just opened an issue about this toady, it's a bug in Solidity.",487
499,foundry-support.txt,"https://github.com/ethereum/solidity/issues/12896 Thank you! For now you can do this: cheats.expectRevert(YourCustomError.selector) Optionally prefix this with your interface/ contract if you defined the custom errors inside one Alright, thanks What I meant was I tried carrioit the same check using require and it worked, but on using custom errors it didn't work Is there a way to have custom events appear as logs? Trying to log an array, can see it with -vvvv. Was thinking of writing a function that would loop and concat a string with '[', ... ']', but maybe I'm missing something? have you tried console.log? are you talking about logging them individually? I couldn't find a function that takes in uint256[] ah i see - might need a helper funciton then indeed all my tests pass but snapshot fails? if tests are run with fork-url does snapshot need to as well? yes snapshot just runs your tests and produces a snapshot file with just testname and gas usage looks like just one test ran Is it possible to setup aave and uniswap environment to test in foundry? I just trying to get an idea of what it would be like to setup different project with which contract is in different version and test them together. https://github.com/gakonst/v3-periphery-foundry georgios migrated the periphery contracts not entirely sure i understand what you mean If I want to test my new contract (solidity version 0.8.11) which interact with uniswap (solidity 0.5.16) and aave (solidity 0.6.12). is it possible to setup that test environment in a single .t.sol file. Hey all, did the cheat codes that enable access to the blockhash ever make it in? I saw Georgios had a version but looks like it got deleted what are you looking for exactly? when testing locally blockhash is deterministic based on the block number, when testing against a fork it uses the blockhashes from the live network is the rpc cache removed whenever the rpc changes? Ah okay, it does look like it has the behavior I'm looking for! I just ran a test and logged it out, and it does seem like the blockhashes update as you described. I think the documents on the 8.4.",484
500,foundry-support.txt,"Forking Mode in the Foundry book might be out of date? Wouldn't this imply blockhash should be on the list of values that are updated based on the forking? ah yes that does seem out of date, if you wanted to submit a PR to fix it that would be awesome! 🙂 this is the file to edit: https://github.com/onbjerg/foundry-book/blob/master/src/forge/forking-mode.md To use custom errors you must invert the logic, so if you initially had require(someCondition, ""revert reason"") now you should do if (!someCondition) revert CustomError() see this post in the Solidity blog: https://blog.soliditylang.org/2021/04/21/custom-errors/ I'm writing a test to call the call and delegate functions from an Implementation contract. This call is made by the owner of the Proxy (who is also the msg.sender). The test I wrote keeps failing. Can someone please have a look, if there is something I missed...I'm new to Foundry. What kinda proxy is it , some have a fallback that reverts if the owner try’s to use the impl It has a fallback and receive function. It's suppose to allow the owner of the Proxy make calls from the Implementation, which I was expecting to pass. It's a factory clone. The owners can make calls to their proxy from the implementation Heya folks! Wonderful job with Foundry! Thank you for open sourcing this tool! Not sure what you’re trying to do (or what implementation actually does) but if you want to interact with this type of proxy , you call the proxy not the implementation Is there a way for gas report to include eth price for some fixed gwei value (say 100)? and when running fuzz-tests, are the numbers average gas usage or time spent? [PASS] testChoice(uint256,uint256,uint256) (runs: 1280, μ: 112837, ~: 67238) Here's the implementation contract for context I'm having the error The application panicked (crashed).",427
501,foundry-support.txt,"Message: No target contract Location: utils/src/lib.rs:217 So I tried foundryup -C 94bfdb239006d46ae0a0fa1ca5714323223a623c but I got foundryup: internal error: -C do I need an assert / expect in a test for it to be counted as a test in the test summary? I have a testFailFoo that ""passes"" but it doesn't seem to be counted that's gas, mean and avg can you try installing the latest nightly, there was an issue related to that, if that still happens please open an issue, this looks lib linking related after installing the latest nightly I was still getting the same error, looks like running forge clean helped fixing the problem Oh thanks for sharing I think I know what was happening and how to prevent this in the future No assertions needed, not sure why it's not passing. Could be a bug Has anyone successfully used getCode cheatcode with path to json file as the param? I'm getting this error: Setup failed: No such file or directory (os error 2) even after trying forge clean and placing the file at different places I’ll post some examples in an hour.",247
502,foundry-support.txt,"you have to build from source. see the readme ah I see, is there a reason as to why not to support 2.28? it’s just what our release platform’s OS uses. if you’re on ubuntu it uses an old glibc but main linux kernel uses 2.29, so blame ubuntu heh 😅 it's debian lol but yeah on cloud so probably behind sadge ye sorry maybe able to update our releases in the future but it’s added complexity to the build system tho it is working for ubuntu tho but yeah I'll try to build it myself why cant we specificy it btw will coverage reports be added soon? justfile not sure what you mean for soon but it’s a top priority like months? or more like 1 year? just curious more like weeks no pressure oh great! As part of my contract deployment, I need to load a bunch of data on-chain by calling various contract methods. What's the right way to do this as part of a Forge test setup? In Hardhat, there was a script that generated a JSON with all the data, and then a bunch of JS code would read it and loop through loading it as part of the test suite I guess I could have the script output a .sol file with a string array containing all the data, and then import that variable in my test setup loading methods? you can just fork mainnet 🙂 https://book.getfoundry.sh/forge/forking-mode.html I haven’t actually deployed to mainnet yet though and am still adjusting, so I was hoping to find a local-only solution. I guess deploying to Rinkeby would be an option though i dont understand then - i was under the assumption that you wanted some mainnet state in your tests, and previously that was in a json file can you try rephrasing the question? You don’t need to have deployed to mainnet to use the fork. Just provide the RPC url and forge will fork the state at that moment in time to your local environment Yes Hi! Is there a way to pass parameters into ""forge test"" that I can then use in a test contract? Or maybe read in env variables in my test contract? Via the FFI cheatcode you can make a native call to echo an env var Cool, thanks! I'll try that! Not quite sure how this works though...",478
503,foundry-support.txt,"Found example code at github, but with: string[] memory command = new string[](2); command[0] = ""/usr/bin/echo""; command[1] = ""test""; bytes memory ret = vm.ffi(command); I get: ├─ [0] VM::ffi([""/usr/bin/echo"", ""test""]) │ └─ ← ""Odd number of digits"" is there a way to use expectRevert with multiple revert messages e.g. I expect this function to revert with one of the following revert messages Hi, I have a library contract. Is there a way to deploy it explcitly from the Solidity test file (and not as part of another contract deployment)? I tried it using new but it failed. Hi, when I run forge test its installing solc everytime, is this expected behaviour? probably a bug if you're on latest nightly, can you open an issue? if you add the --offline flag this should also go away In the context of gas profiling/snapshots: is there a cheatcode or another neat trick to perform actions without having them count in the gas usage? Fe in my case I'm looking to get the gas usage of a 'externalcontract.func(uint256, address[]..) ' call. For the inputs of the call, I would need to either read them from storage or make them in memory. Normally these would be inputs fetched/given by a front end. I'm looking for something that can ""ignore"" the gas costs of those preparation steps so I get the net gas usage of the function I like to profile. One option would be to create a testcontract per call you would like to profile, and do all prep in the setup/constructor. Feels a bit cumbersome though. And even then, some read/memory gascosts of preparing stuff are still unavoidable is there a way to persist state between test? Nevermind. There's a working example at: https://github.com/gakonst/foundry/blob/33f1df0ec7e17799342ee78e5e1ffb07e9ea086d/testdata/cheats/Ffi.t.sol There is a modifier (logs_gas) or something that you can add to your function.",458
504,foundry-support.txt,"Also, I think external calls should be counted individually? Meaning your setup costs shouldnt be counted Thanks for the tip on the modifier! External calls' gas usage can be profiled through the gas traces, but don't show separately in the snapshots. Those snapshots are our main quick check to see how changes affect gas usage i'm not seeing the expected lib/@balancer-labs when i run forge install @balancer-labs/v2-pool-weighted forge install should put the contracts under the lib directory correct? I think you should get a lib/v2-pool-weighted directory. is there a way to remove compiler warnings from libraries? we should probably filter out errors from files located in lib cc @mattsse @gakonst I think it's important to see them at least once, but if you know it's nothing important you could removed them OZ has "" Warning: Visibility for constructor is ignored. If you want the contract to be non-deployable, making it ""abstract"" is sufficient."" but which file does that emit from? i doubt its the actual lib emitting that? or is it if it is, disregard my opinion above /@openzeppelin/contracts/utils/Pausable.sol:32:5: ah ok Hi - I've got an issue with CI testing if the bindings are generated correctly (by regenerating them, taken from https://github.com/gakonst/foundry-rust-template) - I doubled checked and (1) forge versions are the same on CI and on my machine forge 0.2.0 (6130af7 2022-04-06T00:03:48.094239707+00:00) and (2) forge correctly builds with 0.8.13 on my machine and on CI (both print [⠑] Compiling 19 files with 0.8.13) But forge bind .. exits with an error saying the files are not the same on CI. I've had this issue already before but it was my fault because of a mismatch of solc versions and I've made it work later on, but recently it doesn't anymore. 1. Any idea what could be the cause ? 2.",455
505,foundry-support.txt,"Any ways we can stick specific versions of solc/forge so this problem doesn't happen ? (any example?) Thank you 🙏 I actually have a bunch of pixel images I’m serializing and adding as bytes to a contract. It’s part of my new contract suite and not existing mainnet state, so I need to (a) deploy my contract (b) call the contract to add a bunch of bytes. I’m trying to include (b) as part of my testing, but I’m not sure the best way to get the bytes into my .sol test. Yes! Challenge is that the state I’m adding here is not already on mainnet — it’s being added to my contract. Some more details above. Thank you both for taking a look! Hope this is more clear Hi- I'm having an installation issue (I believe I've checked all docs/PRs/issues and couldn't find a similar issue). I run the curl scripts, run foundryup, add the source line in the terminal for the path and everything works fine in that terminal: forge, cast, foundryup etc. However if I switch to a new terminal, from anywhere including inside the project, none of the commands can be found. Sounds like it might be a path issue, but not sure why the edited path isnt sticking around. Just checking if anyone has had a similar issue. thanks👍 Two other things: the bytes (images) here are changing frequently, and there’s a ton of them. If it was just a couple static, I’d just add them as a variable. But part of what I’m trying to test is everything works as these bytes (images) change. what are you setting your source to? i.e. source ~/.bashrc, etc? most likely your shell is loading a different config at start up so your updated path is getting lost try making hte command “echo -ne test"" h i how do you run forge tests on a testnet? do you specifiy a testnet fork_url? yep I got that part to work, but it won't evaluate the env variable, but return the string ""$myenvvar"".",444
506,foundry-support.txt,"function testFfi() public { string[] memory inputs = new string[](3); inputs[0] = ""echo""; inputs[1] = ""-ne""; inputs[2] = ""0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000032466700000000000000000000000000000000000000000000000000000000000""; bytes memory res = vm.ffi(inputs); string memory output = abi.decode(res, (string)); console.log(output); } And I get: Logs: $fp ah hm maybe we need to add this explicitly as a cheatcode Would be even cooler to add the option to pass ""name=hex_value"" pairs on the forge command line and be able to access those through a cheatcode. I could then use forge for simulations from my golang backend, instead of using ganache in blindfolded mode. Can you open an issue with the ideal UX? Sure. Thanks! how can you tell foundry to use different solidity versions for different libraries? anyone having trouble verifying rinkeby contracts? same old deploy scripts, and old test contract which has been verified via this script many times, not working all of a sudden (no change on my end) @onbjerg are you actively working on this? https://github.com/onbjerg/foundry-book/issues/159 I have a spare cycle to work on it if you'd like go for it Etherscan has been having problems with their rinkeby nodes lately. We received many support requests about this and forwareded to them. Try contacting them here https://etherscan.io/contactus what's the default behavior with forge test? does it not run all of the tests by default? what's the point of —run-all? also I am having the issue where not all of the tests are ran both with and without —run-all some test files seem to be completely ignored as if they weren't there is naming test files with .t.sol an issue? and thanks again guys, the speed increase by using forge and foundry just blows my mind every time.",456
507,foundry-support.txt,"I really do love it! Your functions need to start with ""test"" Im pretty sure they all do but lemme double check hello sers, is there a way to retrieve which block number was forked when running tests against mainnet forks? context - we have a ci pipeline with ~100 fuzzed tests and are encountering what seem to be flaky errors since we're unable to reproduce them locally. we want to start logging the block number to try and reproduce the error locally by pinning the run to that block the only way i could think of is to add an emit log (block.number) to a setup func, but not sure if this is the right way yeah for some reasons there are some tests for which it starts with test and it still doesn't run that contract also ""is DSTest"" HOw to change the workspace settings? https://github.com/supernovahs/Foundry-Starter-Kit The contracts for test are in a different folder I think you set the settings in the foundry.toml file for the record this is the same issue im having with verifying on etherscan, hoping its just a temp etherscan issue Unable to resolve import: ""../interfaces/IERC20Minimal.sol"" with remappings: THis error means I have to set the remappings for this right? last thing on this - i would really appreciate it if anyone could try verifying *any* contract on rinkeby etherscan via forge and let me know if it works. would help me diagnose what is your forge --version? Has it been fixed ? Failed tests: [FAIL. Reason: Too many global rejects] any idea what this error means? seeing it on fuzzing when i second arg that fuzzes for timestamp values if remove the duration arg, tests run OK with just amount being fuzzed trace are not superhelpful, seems its failing before even running console log maybe the fuzzer argument doesnt like as tight range on the arg? 🤔 nvm, got it working by doing the calcs outside assume wait, did that actually make this work reliably? feels like a coincendence, I'd expect an assume condition this tight to hit the max rejections pretty often.",447
508,foundry-support.txt,"some options to fix it: - bump up fuzz_max_global_rejects (more rejects = slower tests, though) - change the type to something smaller than a uint256, such as a uint24 - keep uint256 and manually wrap the value into the desired range with module (solmate has bound to help with this: https://github.com/Rari-Capital/solmate/blob/main/src/test/utils/DSTestPlus.sol#L116-L137) you're correct, the path varirable is temporary and resets on reload then foundry disappears. Not sure why. I tried export PATH=$PATH:/Users/<myname>/.foundry/bin to manually set it, but no luck. Hello, is there a way how to deploy a contract from within tests using bytecode? I need to use a contract written in Vyper in my test environment and I wounder how to best approach this. Thank you https://github.com/storming0x/foundry_strategy_mix/blob/1648b3dbe4c4d9c4e4441c84349db7012b12f3b9/src/test/utils/StrategyFixture.sol#L116 check the repo, yearn's vault is in vyper just to really beat dead horse here, the correct path is showing in .bashrc, the .foundry file is at that path, but if I echo $PATH the path doesn't show up. defcon 5!!! anyway idea how to fix would be quite fantastic, thanks Thank you, that's what I needed 👍 turned out it needed to be in .bash-profile to be added to PATHs, not bashrc for whatever my situation is. wow. beer time. I have a config contract that all my tests inherit. Each test will share many of the addresses, methods, structs etc but most will only use some of the inherited contract. I'm sure this causes each test contract to be considerably larger than it should be. Is this slower than only putting exactly what each test contract needs in the test? I'm still having trouble getting underpriced replacement transactions on Polygon when trying to deploy (and not any other network) -- anyone had this issue? Increase the gas Price in hardhat config.js I am soooooo happy right now.",464
509,foundry-support.txt,"I hope you don't mind me sharing 😊 https://twitter.com/EricForgy/status/1511943526988218372 I don't think I could have done this without Foundry 🙌 The contract development was actually the easier part. The front end was the real b&^%h 😅 My first honest to goodness dapp from frontend to backend 🐣 there is no hardhat config! it's just foundry. But increasing gas price doesn't seem to change anything hey Forge team! im dealing with a unique use case. i want to basically use forge as a dependency manager for a forge-based contracts repo. so i have an SDK repo which does not have any contract code but has a forge config to forge install my contracts repo. now i want to build the dependency so that i have access to the build artifacts to use within the sdk (ABIs, bytecode, etc). however since i have no contracts, forge doesnt want to build it is there a way around this? or is it expected to have to build inside submodules sometimes try this 65000000000 really?? I thought price ranges were more like 50-150 gwei? are we talking about the same thing? this is 65 gwei in wei https://polygonscan.com/gastracker ahhh Currently its 60 gwei for fast so for safety try 65 worked, ty :) so to my understanding u mean nothing in src but contracts in lib? We've got a branch that spins on compile, but I don't have the time to dig into why if anyone is interested in looking. CPU goes to 100% and memory appears to grow. You can reproduce with this branch: https://github.com/makerdao/spells-goerli/pull/66, run dapp update and make test-forge. It should hang. Sorry for the dapp update that's another issue we're working on. Does anyone know how to deal with errors that don't revert the entire transaction in forge tests? For example I'm working with minting fTokens from different Rari Fuse Pools using ETH and on Etherscan I see a lot of txs that succeeded but had a revert somewhere in the stack. This is using mainnet forking that's usually a try/catch or a call that is ignoring the revert.",475
510,foundry-support.txt,"Ok should I have a try/catch in my contract as well or in my test? Oh, is it causing your test to fail? I've not seen that before, are you using the expectRevert pattern in your tests? Actually I think the issue might actually be out of gas... lol what forge version? I was not using expectRevert $ forge --version forge 0.2.0 (6130af7 2022-04-06T00:08:59.835901+00:00) and dapp update works as expected? yeah make test-dev works fine too *using dapp* you might run RUST_LOG=trace forge test and see what it hangs at deploying at the moment, will test after that Just hangs on the compile, with the last trace input being the 75 sources it was going to pass to solc. I need to strace this or use a binary with more debugging compiled in, and I just don't have the time to tool up and work on that at the moment. We're trying to transition over to forge though, so this will eventually become a blocker I can look into. 75 sources is hefty. wonder if it’s cuz of optimizer chugging away dapp just grinds thru it? do u have a sense on compile time? i can take a look eventually. maybe today but may have to be next week i may forget so ping me if u don’t hear from me oh, interesting thought. Our mainnet repo is $ make test-forge ./scripts/test-dssspell-forge.sh match="""" block="""" Using DssExecLib at: 0x8De6DDbCd5053d32292AAA0D2105A32d108484a6 [⠒] Compiling... [⠔] Compiling 8 files with 0.6.12 [⠒] Solc finished in 1.78s only 8 sources there oh, I have dapp optimizations off... let me see if I turn them off for forge... Yeah @hexonaut has shared that he builds without optimizations @brockelmore yup, it's the optimizer. I turned it off with forge and now it compiles. ye okay cool.",461
511,foundry-support.txt,"we plan to allow for disabling optimizer for specific files at some point We just didn't backport that change from our mainnet repo thanks guys Q: is there any way to easily switch between private key accounts / rpc urls for deployment? I see there's ETH_RPC_URL env variable, but no way to pass in different .envs? is there a quick way to mint yourself a lot of tokens (like USDC) on a mainnet fork? tip from https://github.com/brockelmore/forge-std/ works on fork ohh so ovveride the balance slot of the token I guess yes yep ye u can checkout src/test/stdCheats.t.sol line 59 for example usage Hey people! I have a little problem. I am trying to call secret function from this contract. I want to do it from the bytecode in this json so I am using the ""getCode"" and then ""etch"" to associate the code to a contract. Then I call the function but the result is not 42 as expected but a giant number. when I attached the image it removed the links contract = https://github.com/gakonst/foundry/blob/master/testdata/fixtures/GetCode/WorkingContract.sol json = https://github.com/gakonst/foundry/blob/master/testdata/fixtures/GetCode/WorkingContract.json @onbjerg because this is not correct. if you just etch it calling it will run the constructor sec see here on how u should do it: https://github.com/brockelmore/forge-std/blob/d880879a97cea1857688c13a6ceb869ef48d715f/src/stdlib.sol#L81-L89 is this broken for anyone else? https://github.com/FrankieIsLost/forge-template test on  master is 📦 v1.0.0 via  v14.18.3 ❯ forge test compiling... no files changed, compilation skippped. Running 1 test for ""ContractTest.json"":ContractTest [FAIL. Reason: Invalid data] testExample() (gas: 1465) Error: 0: Encountered a total of 1 failing tests, 0 tests succeeded wdym broken after a fresh install Anyone here has a implementation of ERC4626? can you run with -vvv as well ❯ forge test -vvv compiling... no files changed, compilation skippped.",499
512,foundry-support.txt,"Running 1 test for ""ContractTest.json"":ContractTest [FAIL.",15
513,foundry-support.txt,"Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets. (base) I think its the vm.label line that makes this fail that would be weird, it's not broken for me whats ur forge version? foundry-cli 0.1.0 you're wayyy outdated probably, we're on 0.2.0, run foundryup Hi, Suppose I install forge install openzeppelin/openzeppelin-contracts@v4.5.0 in a repo. .gitmodules file doesn't indicate the version. So does this mean that when someone else runs forge install, they'll install the latest version? How can we pin it to the same version? Hi, I use ‘vm.prank(a)’ before calling ‘function x’, but ‘msg.sender’ in the ‘function x’ is not ‘a’, did I do anything wrong? whats ur forge version + what does your contract look like? pls check bulletpoint 3 on pinned msgs the pinning happens via the submodule commit, not in the gitmodules , just how git works Hi, does mockCall works with methods that does not return any value? Seems to be working ok in all cases except when mocking an external call for a method that doesn't return anything Hi, guys! I'm trying to install Foundry, but I'm facing loads of issues. Can someone help me, please? By now, the latest problem is error: failed to run custom build command for 'ring v0.16.20' can you please open an issue with the error, your OS etc? Sure! The error was ""failed to run custom build command for ring v0.16.20"". I'm running Windows 10 Do you want me to send a print of the error? What version are you on? Stable Rust should work I've recently installed Rust, so I'm using the lastest version do u have msvc build tools installed https://docs.microsoft.com/en-us/windows/dev-environment/rust/setup#install-visual-studio-recommended-or-the-microsoft-c-build-tools I've installed Visual Studio with C++ build tools today Foundry Support But I have not installed any Rust extensions on VS Code ring docs say: ""On Windows, ring supports the x86_64-pc-windows-msvc and i686-pc-windows-msvc targets best.",492
514,foundry-support.txt,"These targets require the “Visual C++ Build Tools 2015” package or Visual Studio 2015 Update 3 or later to be installed. "" do you have that? Yes! can you paste a gist with the error? sorry, what is a gist? gist.github.com or a pastebin or similar just somewhere not here so its readable 😄 sure! thanks 😆 Is there anything else perhaps to watch out for when verifying? Trying to verify Frankies Test Contract using forge create .. with --optimize --optimize-runs 200 (transaction shows up in rinkeby) and then verify with forge verify --chain-id 4 --num-of-optimizations 200 --compiler-version v0.8.13+commit.abaa5c0e (checked in ~/.svm), but it always returns a Error: 0: Contract verification failed: Response: NOTOK Details: Fail - Unable to verify are you passing in the etherscan key, constructor args (if any) and the path to the contract? see here https://book.getfoundry.sh/forge/deploying.html#verifying https://gist.github.com/Leutwiler/313a7a39fd13956adae48889ea759370 this is the link of my git yes, etherscan key is in and it's just the simple Contract, no constructor args try rustup set default-host x86_64-pc-windows-msvc looks like rust is trying to use gnu i assume u mean https://github.com/FrankieIsLost/forge-template? are you passing the contract address and src/Contract.sol:Contract? yes, so here's the complete commands without the keys forge create src/Contract.sol:Contract --private-key 0x8c...df470 --rpc-url https://eth-rinkeby.alchemyapi.io/v2/fl...qpmMJ forge verify-contract --chain-id 4 --num-of-optimizations 200 0x826738...cd8f811 --compiler-version v0.8.13+commit.abaa5c0e src/Contract.sol:Contract NZSDF...ZP7YJ been trying for hours also with --optimize --optimize-runs 200 on create and setting different compiler versions (also deleted all compilers in ~/.svm) ok, I've just tried it, but it returned the same error whats the output of rustup show hmm, not sure..",496
515,foundry-support.txt,"whats the output of `forge flatten src/Contract.sol? as it's a short output, I'm gonna paste it here Default host: x86_64-pc-windows-msvc rustup home: C:\Users\andrey\.rustup installed toolchains -------------------- stable-x86_64-pc-windows-gnu (default) stable-x86_64-pc-windows-msvc active toolchain ---------------- stable-x86_64-pc-windows-gnu (default) rustc 1.59.0 (9d1b2106e 2022-02-23) // SPDX-License-Identifier: Unlicense pragma solidity >=0.8.0; contract Contract { string public greet = ""Hello World!""; } rustup default stable-x86_64-pc-windows-msvc really strange - what version are u on? forge 0.2.0 (6130af7 2022-04-07T00:06:13.404059+00:00) should be the latest done! info: using existing install for 'stable-x86_64-pc-windows-msvc' info: default toolchain set to 'stable-x86_64-pc-windows-msvc' stable-x86_64-pc-windows-msvc unchanged - rustc 1.59.0 (9d1b2106e 2022-02-23) does it work now? yeah it is. pass, i don't know on this one - maybe @brockelmore or @mattsse knows? Hey been using foundry for a bit and have to say that I love it and use it in addition to hardhat. I was wondering why running 'forge test' with the --fork <url> feature flag takes longer than running a vanilla forge test thanks nonetheless probably because it's not running on your machine, but running on the nodes that you connect to for mainnet forking Interesting when I run the entire test battery from start to finish it seems to get through tests that don't involve fuzzing qiuckly while getting stuck on other tasks that involve fuzzing only when using the --fork-url flag tho locally it works fine hmm i had some issue recently with verifying a contract on a testnet.",454
516,foundry-support.txt,"i’m not entirely sure what the problem was unfortunately i thought it was likely an etherscan issue tbh Using an alchemy api btw I uninstalled and reinstalled forge through cargo so don't think that is an issue I'll try it on hardhat and report back I don't want to jinx it, but the installation is on the step 798/805, so it's working aparently hahaha. Wait a second and I can tell for sure if it truly worked @tom2o17 it pulls state from the RPC url you pass in, however, if you also pass --fork-block-number then the state is cached, so only the first run is slow more here: https://book.getfoundry.sh/forge/forking-mode.html#caching works with hardhat :/ @onbjerg Thanks makes sense. 🙂 I assume it worked? 😄 I've just tested it and it worked 😀 Thanks a lot Oliver, you're very good at it! Great! Happy it worked. At some point I will come back to re-enabling Windows builds so it's easier in the future hmm.. after further playing around, I tried verifying the contract deployed by hardhat (with same settings) and verifying it via forge. Now forge says that it has successfully verified the contract and if I type the command again, it shows this forge verify-contract --chain-id 4 --num-of-optimizations 200 0xDA726...e00d9 --compiler-version v0.8.13+commit.abaa5c0e src/Contract.sol:Contract NZSDF...HZP7YJ Error: 0: Encountered an error verifying this contract: Response: NOTOK Details: Contract source code already verified However, etherscan is still showing up as unverified Nvm, was the incorrect address, it shows up as verified... That's awesome! 🙂 does anyone know if its possible to prepare a ledger-approved transaction with cast, but not broadcast it immediately? just sign it? maybe we should add —sign-only flag to cast send shoudl i use cast sign first or? possible to console log structs? i think there is still an issue with pranking and tx.origin in the latest nightly.",454
517,foundry-support.txt,"made a minimal repo for the behavior https://github.com/stevennevins/origin-minimal-example dont think there’s a cast sign command ah yeah i meant cast wallet sign which is message signing Is there any way to read in an external file as part of the tests? Yeah via the FFI cheatcode whats the best thing i can read about deploying w foundry Fabulous! I didn't internalize that was the use. I'll do some research. Thanks. getting this gas error 0: (code: -32000, message: gas required exceeds allowance (0), data: None) even though i'm setting --gas-price 20 in my forge create call possibly an alchemy issue ? not really sure is forge getting the etherscan key from env? Do we have option like this in forge DAPP_LINK_TEST_LIBRARIES? I’m trying to find a way to use deployCode with artifact that need to link libraries yes try having a file .dapprc where you do ETHERSCAN_TOKEN=<YOUR_KEY> and then do source .dapprc so just throw in .env file yeah hey guys, having some trouble understanding how the caching works exactly. if I execute state changes via forge test --fork-url {URL} --fork-block-number {NUMBER}, with caching on, does that mean that further forge test runs with the same parameters would take those new state updates into account? Or does it just cache storage retrievals for speed improvements? hevm has 'state diffs' afaik, does it work similarly? probably missed it, any good example repos integrated w hardhat? what is ""NotFound""? some method? occurs when using tip anyone have a rec for how i can further debug this? RUST_BACKTRACE doesn't really show anything Hi...a dumb question is there a way to make the sign() cheatcode get its priv key from an env var? this is resolved.",389
518,foundry-support.txt,"rpc_url was pointing to rinkeby but was trying to deploy on ropsten 🤦 is there a way to debug which is the instruction in my contracts code that triggered the revert when executing the code? try forge test -vvvv does not change, I think the additional v is only for all the tests and not only failing one ah sorry yeah only need 3 -- if you were doing that shouldn't the tx that reverted have been red? or is it that you're just looking to dig in a level deeper? you can try forge test --debug {test} It just caches the responses so you don't need to make the same network request twice across runs @brockelmore? not having much luck w contract verification now unf -- seems like it might be broken based on the gh issues? any good guides out there to adding hh into a forge repo specifically for verification purposes? (am on the latest via foundryup) Mainnet? no ropsten btw rest of foundry is absolutely banger I know coverage is not yet supported by Foundry/ Forge, but what is the current best solution for this? Use the solidity-coverage npm package? ANyone here wants another hand to test there contracts using foundry, send me the contract git link. I would be glad to test them . I’m trying to test a function that is pretty chunky and I’m running into gas limit issues. When I update the gas_limit value in foundry.toml to anything larger than the default value (9223372036854775807) I get this error: invalid number at line 9 column 13 in Backwards compat provider What's the best way to test really large functions (e.g. something simulating minting 10k nfts)? im assuming ETH here but what’s with trying to mint over the 30m gas limit? Basically i need to simulate how the contract behaves on the 10,000th interaction Doesn't seem to be a way to simulate that without running a for loop and minting 10k, which hits the gas limit Suggestion: Space between warnings needed for better UI you mean new lines? There is no space between the yellow warnings sorry can't follow, mind opening an issue with a sample format you have in mind? I'm just saying there needs to be a gap between the warning.",477
519,foundry-support.txt,"Lorem Lorem To Lorem Lorem How does fuzzing with multiple parameters work exactly? Imagine a 'func(uint256, uint256, uint256)' and 200 fuzz passes are needed. It probably starts with (0, 0, 0, 0). Will the fuzzing then start with combinations of (1, 0, 0, 0), (2, 0, 0, 0), ... (uint.max, 0, 0, 0) until it finds 200 good runs? Or will it randomize the combinations of the different inputs? I think it randomizes can you have the 10k parameter adjustable and reduce it for tests as a workaround? Unfortunately not, need to actually mint the tokens Actually there are 2 things - it would be good to be able to mock view functions via “call” semantics rather than “send” semantics such that it doesn’t cost any gas Function I’m calling is a view function But separately, seems like setting gas_limit larger than the default breaks something Setting in foundry.toml I think gas is counted the same way in view functions. You can still hit the limit. Theres also .callstatic which enforces a “view” call, but doesn’t sound like thats what you’re really looking for. can you clarify? yep, we try to be as close to rl as possible so we're most likely not going to change how gas is counted for view functions Referencing this post above: I’m trying to test a function that is pretty chunky and I’m running into gas limit issues.",323
520,foundry-support.txt,"When I update the gas_limit value in foundry.toml to anything larger than the default value (9223372036854775807) I get this error: invalid number at line 9 column 13 in Backwards compat provider can you post your foundry.toml? Hmm, I just installed v0.2.0 and am getting something very similar: “expected newline, found a period at line 7 column 19 in Backwards compat provider” can you post your foundry.toml as well? Sure, pretty minimal: [default] src = 'src' out = 'out' libs = ['lib'] remappings = ['ds-test/=lib/ds-test/src/'] fuzz_runs = 100 solc_version = 0.8.10 solc version has to be in quotes so solc_version = ""0.8.10"" there's a limitation in the rust's toml library which only supports i64 numbers ... lol oops! thanks Urgh that’s probably it Thanks if you pass --gas-limit (i think) on forge test with a number larger than the default, does it work then? that *should* bypass the toml limitation hmmm so does it work in a concrete case? not found means it didnt find the storage slot for ""balanceOf"" I think people don't use coverage as much as they should, so the answer might be ""they don't"" Maybe you can override a storage slot(s) with vm.store and trick the contract into thinking there's 9999 tokens minted? Randomizes, uses value around the edges (0, 1, 2, uint256max etc) and also used any values that were produced during the transaction as inputs (eg any storage variable changes) Is there a best practice on the amount of fuzzy test inputs vs the amount of fuzzy runs? eg testing 10 fuzzed input variables on 100 fuzz runs seems not to be a good approach 😅 Just throw 256 at it locally and 10k on CI As a strawman I can see that someone of you have discussed this yesterday, there seems to be something wrong with forge verify-check, if I'll try to verify the exact same contract from hardhat and from foundry it'll only succeed on hardhat.",465
521,foundry-support.txt,"This is on rinkeby and ropsten btw sexy stack trace output everyone! We'll investigate, confirming that this started happening recently is it a known issue that foundry is producing slightly different bytecode from dapp? This assert fails when we deploy our code with dapp and test it with forge (optimizations off in both cases): https://github.com/makerdao/spells-mainnet/blob/master/src/DssSpell.t.sol#L189-L197 this code compares the bytecode of a deployed contract with that of the same contract created with new (and the check passes with dapp). happening in this branch if one runs make forge-test: https://github.com/makerdao/spells-mainnet/pull/237 @hexonaut have you come across this yet? Is it maybe the bytecode hash? Not including metadata I wonder if that's it I haven't come across this yea pretty sure that must be it, it was a recent change and if you use a version of forge from before that change I'd guess they match well, we can pull that PR at block 14545962 to reproduce if we need to. No more changes are going to be made to it. I can test if you give me a version to check (and how to switch to that version) relevant PR if it helps https://github.com/gakonst/foundry/pull/1180 assume you have the latest foundryup you can do foundryup -C <commit>, one sec I'll get a hash for you foundryup -C eda26cae4a186ec6d5e35579f7df1664f9b04a10 (this one includes bytecode hash) foundryup -C 83436e873bdd1a8442a6a27e40a62e5f812ea006 has no bytecode hash, using latest master should give the same result at this is there a new version of foundryup? foundryup -C 83436e873bdd1a8442a6a27e40a62e5f812ea006 foundryup: internal error: -C yea you can update with curl -L https://foundry.paradigm.xyz | bash new flags were added so you can directly switch to commits by hash and PRs by number Compiler doesn't ignore commented out imports.",481
522,foundry-support.txt,"Anyone seen this before? ""Unable to resolve import: ""@rari-capital/solmate/src/tokens/ERC721.sol"" with remappings: [...]"" @msolomon4 you rust guys have a quick fix for this $ foundryup -C 83436e873bdd1a8442a6a27e40a62e5f812ea006 Previous HEAD position was 83436e8 feat(config): make bytecode_hash = 'none' the default value (#1180) HEAD is now at 29d2efb chore: disable ETH_RPC_URL env var (#1238) foundryup: installing at commit 83436e873bdd1a8442a6a27e40a62e5f812ea006 Previous HEAD position was 29d2efb chore: disable ETH_RPC_URL env var (#1238) HEAD is now at 83436e8 feat(config): make bytecode_hash = 'none' the default value (#1180) error: failed to parse manifest at `/Users/godsflaw/.foundry/gakonst/foundry/Cargo.toml` Caused by: feature `strip` is required The package requires the Cargo feature called `strip`, but that feature is not stabilized in this version of Cargo (1.57.0). Consider adding `cargo-features = [""strip""]` to the top of Cargo.toml (above the [package] table) to tell Cargo you are opting in to use this unstable feature. See https://doc.rust-lang.org/nightly/cargo/reference/unstable.html#profile-strip-option for more information about the status of this feature. foundryup: command failed: cargo install --path ./cli --bins --locked --force --root /Users/godsflaw/.foundry Oh boy for me it's a staple, when I test a function with Hardhat I always check coverage to see what branches I missed.",397
523,foundry-support.txt,"Anyway - I know this is a collaborative initiative, I'll see whether I can help to speed things up in this regard I think rustup update should do it what version are you on? make sure you're on the latest and try forge clean && forge build there was some nightly specific issue recently iirc, @brockelmore lmk if I got the fix wrong here installing rustup (you guys just turning us all into rust programmers) forge 0.2.0 (865bc46 2022-03-28T00:08:15.310912+00:00) Sorry to be clear, it still builds. It gives those warnings though heh slowly trying to become a real rust programmer myself (I am certainly not one currently) I did a shallow dive back in 2015 when they were removing native event driven nonblocking I/O support (or having some fight over it), and walked away back then. rustup update will fix it, you need 1.59 @mattsse is there a bug here? it did indeed fix it, installing the older foundry commit hash now nice this probably happened because the solidity parser failed to parse it in which case we fall back to regex. can you share the contract in an issue so we can check whether the solidity parser lacks some rules? +1000 what do you mean? by manually sending assets to the address? fuzz = non-concrete -> concrete is non-parameterized test i think We are going to prioritize it to be clear oh, lmc honestly i wish i could help -- if i had a little more flexibility in my schedule these days i'd be going thru the rust book and trying to get involved unf .. not the case atm But remember: Seitz is on the Node Brock is on the Scripting Bjerg is on the Docs Once these are in, we turn it up turbo for coverage, fmt, flamegraphs etc @msolomon4 $ forge --version forge 0.2.0 (eda26ca 2022-04-08T16:03:27.734717+00:00 Running 1 test for src/DssSpell.t.sol:DssSpellTest [PASS] testSpellIsCast_GENERAL() (gas: 12792929) Test result: ok.",466
524,foundry-support.txt,"1 passed; 0 failed; finished in 8.57s There’s a lot going on and it’s impt to prioritize what’s the issue here? it was does scripting include verification? i’m referring to new features here, bugfixes are part of the daily flow we want to add forge deploy —verify so you never need to do forge verify-contract again ah yes ofc -- i also didn't specify well i was thinking of the multi-file verification (although maybe that's already deployed? i dont quite recall from the gh issues where it shook out) @gakonst @msolomon4 so, if we start deploying with foundry, I think the bytecode will match. I'm not sure what this does to etherscan verification though. @brockelmore yeah doesn't pass with concrete either, still the not found error if you need to reenable the metadata hash you should be able to do it, not sure of the syntax offhand but @mattsse should know for etherscan verification it shouldn't affect anything uniswap turns off the metadata hash because it affects create2 addresses and all their contracts are verified This would be useful it might affect sourcify's partial vs. full match but since full relies on metadata matching, but I don't use sourcify enough to know for sure @hexonaut for context when we start retooling☝️ this is certainly the ideal ux cant wait can someone remind me how to rerun the last failed fuzz with the same inputs? Hi all, when I start the debugger from a rinkeby fork it's crashing at debugger.rs line 178 .expect(""no instruction counter map"") this line to be specific, not quite sure what that means tho Goes without saying, but don't trust random DMs off telegram. Scammer impersonating brock thanks for flagging yes for suicide, but this is not the only use case for selfdestruct, the one I am describing is using it to transfer ETH yikes thanks Hi guys. I'm having some problems running my tests i have this function in my original contract im doing a fuzzing test, at least trying to... but my console says this: [FAIL. Reason: call failed.",453
525,foundry-support.txt,"Counterexample: calldata=0xa7d144f80000000000000000000000000000000000000000000000000000000000000000, args=[0]] testHouseWithdrawn(uint8) (runs: 0, μ: 0, ~: 0) Failed tests: [FAIL. Reason: call failed. Counterexample: calldata=0xa7d144f80000000000000000000000000000000000000000000000000000000000000000, args=[0]] testHouseWithdrawn(uint8) (runs: 0, μ: 0, ~: 0) can you add -vvv to the forge test [PASS] testFailHouseWithdrawn(uint256) (runs: 256, μ: 9246, ~: 12111) [PASS] testHouseBalaceIsDefined() (gas: 2301) [FAIL. Reason: call failed. Counterexample: calldata=0xa7d144f80000000000000000000000000000000000000000000000000000000000000000, args=[0]] testHouseWithdrawn(uint8) (runs: 0, μ: 0, ~: 0) Traces: [12507] ContractTest::testHouseWithdrawn(0) ├─ [5152] Contract::houseWithdrawn(0) │ ├─ [46] ContractTest::fallback() │ │ └─ ← () │ └─ ← ""call failed"" └─ ← ""call failed"" Failed tests: [FAIL. Reason: call failed.",338
526,foundry-support.txt,"Counterexample: calldata=0xa7d144f80000000000000000000000000000000000000000000000000000000000000000, args=[0]] testHouseWithdrawn(uint8) (runs: 0, μ: 0, ~: 0) Encountered a total of 1 failing tests, 2 tests succeeded oh well does the test contract (`address(this)`) accept eth?? probably not probably need to add a receive function the ContractTest contract makes sense Brock where is the most complete guide on testing? I found little in the foundry's book hmmm do you mean like best practices and such? yes you can watch this https://www.youtube.com/watch?v=Rp_V7bYiTCM&ab_channel=Spearbit which may be your best bet. i havent seen much in the way of written guides tks! Is there any way to specify a different number of optimizer_runs for different contracts within a project when compiling? not currently, but likely in the future there will be some specification available (but may be on/off) Got it thank you! Would definitely be a valuable feature to have especially when dealing with contracts that are close to the max contract size to maximize optimize runs. when updating deps w forge update what does the dirty tag mean on commits? e.g. Subproject commit 46e9adc3b1a729de60edacd6ba10e0494d262f6b-dirty I am using cast to sign a message. cast wallet sign --mnemonic-path <> --password <> ""msg"". and it complains The following required arguments were not provided:  --keystore <KEYSTORE_PATH> shouldn't the fields I am passing be the only required fields? nm figurd it out Is there a recommended way to do chainlink mock with foundry? you can use vm.prank to impersonate any address sender is there any trick to running slither . on a foundry repo? actually.. might just be an issue for me locally Hey all! I don't know what's going on but I can't get foundry to build and run my tests anymore, I always get some output like this: forge test -vvv [⠢] Compiling...",464
527,foundry-support.txt,"[⠆] Compiling 72 files with 0.8.7 [⠰] Solc finished in 39.99ms No files changed, compilation skipped Even though I definitely have changed files. I added some assert(false) in my contracts, which should definitely blow up some tests, but I'm still getting the same. I am on this version, just `foundryup`'ed: forge --version forge 0.2.0 (9c24694 2022-04-08T00:20:01.154330+00:00) Some things I've tried: - removing cache/ - removing out/, but there is no out/ folder even after forge build - forge test --force, same thing - forge test --run-all, same thing --- Update: I think I know what's happening actually, I believe this happens because I had a symlink in src/ pointing to a folder in one of the submodules in lib/. I removed the symlink, and now I can build and run tests again. Should I open an issue? The context for the symlink is that I was trying to find a way to import a dependency that would work for both hardhat and foundry. I was able to deploy using hardhat with the symlink, but that turned out to break my foundry build/tests. I can go back to using the remapping, but that breaks hardhat deploys... Yep please open an issue, this sounds like a legit edge case Thanks for pointing out. there ya go: https://github.com/gakonst/foundry/issues/1244 I tried to repro on a simpler repo but I can't get it to repro so far, very odd I'm trying to read in a string using vm.ffi cheatcode, but I'm getting an ""Invalid character at position 0"" error. This is using cat <file> as the command.",392
528,foundry-support.txt,"Any advice? you need to abi encode the output of the file Ahhh okay meh we should add this as a cheatcode, @mattsse your file system codes + maybe read json / csv fields could be a fit here What is the exact use case? I have some data that I need as part of my contract deployment, so I'm including reading in a file as part of my test setup Having a way to easily read this from a JSON would be excellent For the old Hardhat tests, we output a JSON with all the data and read it in and added it to the contract during deployment. I was actually going through the steps of changing the JSON-building script to output some serialized byte format and then setting up the ffi pieces to read that in to forge for deployment. i am running some fuzz test which fails, but for some reason it doesn't say why. should there be a reason printed? PS C:\Users\Ben\Documents\GitHub\mempool-relay\contracts> forge test -m ""testPaymentsDisabled"" -vvvvv [⠒] Compiling... Compiler run successful Running 1 test for src\test\SnowsightManager.t.sol:SnowsightManagerTest [FAIL.",251
529,foundry-support.txt,"Counterexample: calldata=0xd74c31b000000000000000000000000000000000000000000000000000000000000000210000000000000000000000000000000000000000000000000000000000000001, args=[0x0000000000000000000000000000000000000021, 1]] testPaymentsDisabled(address,uint256) (r uns: 4, μ: 18028, ~: 19703) Traces: [609471] SnowsightManagerTest::setUp()  ├─ [571601] → new SnowsightManager@0xce71065d4017f316ec606fe4422e11eb2c47c246  │ └─ ← 2402 bytes of code  └─ ← () [0] SnowsightManagerTest::testPaymentsDisabled(0x0000000000000000000000000000000000000021, 1)  ├─ [5989] SnowsightManager::setPaymentsEnabled(false)  │ └─ ← ()  ├─ [0] VM::assume(true)  │ └─ ← ()  ├─ [0] VM::startPrank(0x0000000000000000000000000000000000000021)  │ └─ ← ()  ├─ [0] VM::expectRevert(ERROR_PAYMENTS_DISABLED)  │ └─ ← ()  ├─ [19265] SnowsightManager::pay{value: 1}()  │ └─ ← ()  └─ ← () Test result: FAILED. 0 passed; 1 failed; finished in 420.21ms Failed tests: [FAIL.",366
530,foundry-support.txt,"Counterexample: calldata=0xd74c31b000000000000000000000000000000000000000000000000000000000000000210000000000000000000000000000000000000000000000000000000000000001, args=[0x0000000000000000000000000000000000000021, 1]] testPaymentsDisabled(address,uint256) (r uns: 4, μ: 18028, ~: 19703) Encountered a total of 1 failing tests, 0 tests succeeded Isn't the counter example calldata/args the output you'd want from the fuzzer? it looks like it returned without a revert though :D hey does foundryup -C <hash> stall / take a really long time to build for anyone else? also not sure if this is expected behavior: Running 1 test for src\test\SnowsightManager.t.sol:SnowsightManagerTest [FAIL.",205
531,foundry-support.txt,"Reason: You have an active prank already.] testPaymentsManual() (gas: 22915) Traces: [629371] SnowsightManagerTest::setUp()  ├─ [591501] → new SnowsightManager@0xce71065d4017f316ec606fe4422e11eb2c47c246  │ └─ ← 2402 bytes of code  └─ ← () [0] SnowsightManagerTest::testPaymentsManual()  ├─ [7453] SnowsightManager::setPaymentPerBlock(33)  │ └─ ← ()  ├─ [0] VM::prank(0x0000000000000000000000000000000000000001)  │ └─ ← ()  ├─ [22915] SnowsightManager::70617928{value: 333333}(29)  │ └─ ← 0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000021596f75206861766520616e20616374697665207072616e6b20616c72656164792e000000000000000000000000000000000000000000000000000000000 00000  ├─ [0] VM::prank(0x0000000000000000000000000000000000000003)  │ └─ ← ""You have an active prank already.""  └─ ← () Test result: FAILED. 0 passed; 1 failed; finished in 733.80µs Failed tests: [FAIL. Reason: You have an active prank already.] testPaymentsManual() (gas: 22915) but i do make calls() between pranks  function testPaymentsManual() public  {   manager.setPaymentPerBlock(33);   cheats.prank(address(1));   address(manager).call{value: 333333}(""pay()"");   cheats.prank(address(3));   address(manager).call{value: 333333}(""pay()"");   cheats.prank(address(2));   address(manager).call{value: 333333}(""pay()"");  } it did when i tried it tonight, just assumed..",496
532,foundry-support.txt,"it was bad luck or some kind of cache miss locally or something (dont have too much experience w foundryup, was first time using with -C) which commit and what os ? Can forge generate artifacts for me? What are (if any) the limitations with verify-contract at the moment? I was able to call the verify cli against polygon's testnet, retrieve a successful GUID, but the status result shows failure from the testnet. is there any workflow that replaces hardhat-deploy? I am really used to that and would like to replicate it with foundry at least I was having major issues, spent almost an entire day trying to play around with compiler settings. Was able to verify contracts using forge that were deployed with hardhat, but unable to using forge create. I think there was some talk about them looking into it. ^but not deployed using forge Thanks for the info. My test is failing Mock ERC contract file I note in github there's a very recent fix for verify contract which uses the standard json input. It now works for me. I'm trying to use expectEmit for a test. I'm calling a function on an external contract (the event signature I've defined in the test file identical to the external contract) with the event taking three indexed values and my call is vm.expectEmit(true, true, true, false); but it fails with [FAIL. Reason: Log != expected log] What am I missing? im trying to implement a contract that rewards users who bet correctly on the direction of price of ETH. currently im implementing getting price based on PriceFeedConsumer here: https://github.com/smartcontractkit/chainlink-mix/blob/main/contracts/PriceFeedConsumer.sol. this should work when i deploy but im not sure how can i go about testing it. should i set ETH's price and do vm.warp(7 days); and set the ETH's price again? do i need a mock token to help me out? do forge test -vvv. prob need more info ETH is not token sorry weth* you would use WETH to mock can i control the WETH's price? https://github.com/ogDAO/Optino/blob/master/contracts/MakerDAOPricefeedSimulator.sol there is an example but using makerdao price feed oh lol exactly what i needed I used 4 v's but this is what I got thank you 😅 Hi.",495
533,foundry-support.txt,"I also bumped into this, but foundryup -b master gives:  Compiling ui v0.2.0 (/home/eric/.foundry/gakonst/foundry/ui) error: could not compile `foundry-cli` This is on Windows 10 via WSL2 (Ubuntu).",64
534,foundry-support.txt,"error: failed to compile `foundry-cli v0.2.0 (/home/eric/.foundry/gakonst/foundry/cli)`, intermediate artifacts can be found at `/home/eric/.foundry/gakonst/foundry/target` Caused by: build failed It's been a while since I worked with forge, so I'm trying rustup update and will try again 🙏 looks like libusb , maybe? could be https://github.com/gakonst/foundry#troubleshooting-installation Will try. Thanks 🙏 Ah. rustup update followed by another foundryup -b master seems to have done the trick 👍 Wishful thinking: % forge node error: Found argument 'node' which wasn't expected, or isn't valid in this context USAGE:  forge <SUBCOMMAND> For more information try --help Can't wait 😊 Hi, curious if there's any plan to display the full addresses in traces and debug window? this is being worked on i think is there a way to ""skip"" test contracts / functions or some equivalent to the ""only"" keyword for mocha tests? You can use -m to supply a specific test name pattern search eg: https://github.com/sambacha/foundry-scripts/blob/c63ae26d7ad7b4bcded5834a8d321de1efb99b3e/justfile#L50 macos & the commit was the recent multifile one 600067a593e19722158d5a49dfaa7880254a4106 haven't been able to verify forge-deployed contracts yet myself haven't had luck w this myself yet but going to try it again tn or tomorrow (might try redeploying the contract first ig) there’s no way to get the output of forge create to print as json correct? (as you can with cast output) I, too, am unable to verify the contract (deployed via forge create) on etherscan, both by forge verify-contract and from etherscan website. I am not sure what's going wrong. I have checked optimizer settings, compiler version... feature request: add an option in forge create to verify the contract as well.",461
535,foundry-support.txt,"Can you share a repo ? hard to help with verification without being on the same page are there any example of how to use libraries = [] with deployCode from forge-stdlib Hey quick rust question, we use figment crate to merge our config + cli inputs, say config and cli have a common key, config has Some(value) while cli is None, while merging cli into config, will the Some(value) be over-written to None? I assumed if the value is None it won't overwrite, but seeing the opp behaviour. is there a convenient way of importing uni v2 contracts for example, kind like how we can add solmate with forge install rari-capital/solmate nvm i'm an idiot, the param after install is literaly the repo 🤦‍♂️ nvm me Thanks, the only problem there is that sometimes its more convenient to do it through the editor, because I already have a key binding to run the tests. And sometimes I want a -vvvv output for a single test “test_func1” without “test_func1_failx”.",222
536,foundry-support.txt,"Is there a way to have the matches be exact? It’s not regex right? when i import a contract with older version, like uni v2 0.5.16 but my main contract is 0.8.10 what's the best way to handle this? I'm thinking that changing the uni v2 version is a no go because i cant do that in production, and lowering the version of my contract not great either right because then I lose some newer solidity features how do people usually go about this? you can use the artifacts instead the already compiled output oh sweet how do I do that? You need to use deployCode(artifact) What would be the worst thing if you import the interface with 0.8.10 solidity version? first time trying out forge create: Error:  0: (code: -32016, message: The execution failed due to an exception., data: Some(String(""Reverted""))) Location: cli/src/cmd/forge/create.rs:151 Any words of wisdom? compiling seems to work fine, seems to be something with the actual deploy? Looks like the contract call is reverting — perhaps something in your constructor is reverting? hmmm I'll start with that is there any good repo to take a peak at for invariant tests (these are already supported, but just not in the docs, right?) sorry invariant tests are only available on a specific branch of foundry and are in alpha ah, I see thanks Is it possible to do setups for a *subset* of the functions in your contract? Equivalent to the logic in a describe() in js tests? Could just write your own functions for that, or even sprinkle on some modifiers Oh, you're right How is .gas-snapshot (for example in solmate) created? It's not just forge test > .gas-snapshot ah..",375
537,foundry-support.txt,"it's forge snapshot Hello is there a way to mine empty blocks ? guys I had to move to hardhat because of that issue but I retried now to check if something changed and I still get the same behavior, I think the issue may be on your side, can someone look at it? to reproduce: I ran forge init, I moved the utils folder to src/test I ran forge install brockelmore/forge-std moved the safemoon.sol and its contract.t.sol forge test --fork-url https://speedy-nodes-nyc.moralis.io/APIKEY/bsc/mainnet/archive --fork-block-number 16487124 -vv result: shown in the image, tests run very slow https://anonymous.4open.science/r/FoundryExample-240F/ files referenced can be seen here Anyone known support group for echinda? @mattsse vm.warp I'll take a look - thank you for sharing only if the Option<> value will be serialized, it's common to ignore None by adding #[serde(skip_serializing_if = ""Option::is_none"")] Thanks! how to make linked library work. If I have to deploy with deployCode. Hey guys! pls point me out how to deploy the contract with foundry and get address? Ah okay got it, thanks! forge create! thanks! Hello. I am getting no ABI for contract error when trying to debug. I am using forge 0.2.0 (95857c9 2022-04-10T17:27:38.887273300+00:00) (updated just a moment ago), built from source. Running in Windows 11. The path looks correct. Any idea what can be the problem? Thanks in advance. Can you do ""forge clean"", just in case didn't work Can you do ""forge test --debug testExample""? same error Rip cc @onbjerg @mattsse this might be a windows path canonicalization bug Fix should be simple, give us a bit to find where the bug is Forge test works right? Great, thank you. Yes, test works well Ack seems like this is run specific, likely paths -.- will check Be careful to use the correct solc version (including commit string suffix) and explicitly specified optimisation level, as noted in the handbook- that almost caught me out.",481
538,foundry-support.txt,"something changed recently, I wasn't able to verify even manually using forge flatten and going through the etherscan UI. Somehow the bytecode is slightly different. had to deploy with hardhat and verify what chu need pls ser scripting first ye ive switched to working on that i think bjerg is gonna pickup invariants at some point soon hey! having fun with Foundry.. encountering some unexpected behaviour with expectEmit My test: function testMint(uint256 amount) public {   cheats.assume(amount > 0);   exampleERC1155P.createToken(name, symbol, decimals, 1, uri);   cheats.expectEmit(true, true, false, true);   emit Transfer(address(0), testAddress, amount);   cheats.expectEmit(true, true, false, true);   emit TransferSingle(address(this), address(0), testAddress, 1, amount);   exampleERC1155P.mint(testAddress, 1, amount);   assertEq(exampleERC1155P.balanceOf(testAddress, 1), amount);  } My trace in the attached image. The Events are emitted in the order specified by the test, but the test fails. The test passes if I remove the first expectEmit (for the Transfer event). I wonder if the fact that one is emitted by a child contract is having an impact? edit: initially pasted the wrong image with emissions flipped as a test Was there any guidance on this? Specifically how cast handles passing in and returning structs and how we should format the function signature? wut ser no need to I do not remember specifically but i think i had figured out a workaround. Can you try something(a(uint256,int256,bytes))? We should add this to the cast reference @onbjerg Abi v2 cast call/send If i remember correctly encoding structs was still not possible.",375
539,foundry-support.txt,"Has that changed? 😅 idk why it's so slow, if you aren't able to reproduce it feel free to ask any question to help debug this issue ? https://github.com/0xSplits/splits-vesting is the repo -- just tried deploy & verify from scratch on the latest nightly and no luck any tips on how to proceed w debugging are greatly appreciated would rather figure this out w forge than spin up hh on this repo just for the verifications https://github.com/sambacha/bsc-forge-latency.git your anon github link was awful cant clone it How to install a specific version of openzepplin? For example, I want to install 0.6.12 I used `forge install openzeppelin/openzeppelin-contracts@0.6.12`. But it shows ""pragma solidity ^0.8.0;"" in openzepplein contract code. semver does not correspond to pragma version https://github.com/gakonst/foundry/issues/1046#issuecomment-1081369551 3.4.1. I think is for 6.12 Try `forge install openzeppelin/openzeppelin-contracts@3.4.1`. I'm currently using echinda, wanted to know if someone knew of any group dedicated to it. Re on this subject, is it possible to cast abi-encode a function with struct args? i am using it alot recently currently there is no way to build single or multiple specified files right? it builds the whole project only? i dont think so i have been using ethabi-cli for now https://github.com/rust-ethereum/ethabi thanks!! if you want something that will provide you a menu of all possible encodings try npm i -g solidity-gencall hi , in my usual tests at brownie I was using chain.sleep and it was working.",387
540,foundry-support.txt,"Now I migrated the code to foundry and doing skip() but it's not working any ideas why it can be ? hey, it is possible to hide the remappings from the contract verification? Because now when I deploy a contract it shows up on etherscan like this with the full path from my local machine What is not working? Oh this shows up on etherscan? @mattsse should we make remappings relative paths? yes exactly, under settings here https://rinkeby.etherscan.io/address/0xe86c9157912f2ffd5fa38314b4479986579f6acd#code I have strategy that I migrated to foundy when I skip(86400*5) and harvest nothing changes no profit no loss just the same amount remains Do you have a minimal repro of the issue? 5 days Did you try more days :))))) Desperate harvest moments 🥺 Is the strategy block based or timestamp based? Time based but how can I mine empty blocks in foundry I want to try that aswell https://book.getfoundry.sh/cheatcodes/warp.html?highlight=Warp#warp forge std skip calls ""roll"" which modifies the block number but not the timestamp Warp modifies the timestamp Oh that seems to be it I will try using warp thanks ! Ok next time I'll use another system, I didn't think it was a huge problem being just a couple of files to copy in a forge initted repo... Btw does it behave the same also on your end? Can and should definitely strip them when we include them for verification anyone succeeded verifying contracts on arbitrum via forge cli? when forge verify-check i get a message returned “Verification is pending…” forever it still not worked with warp(block.timestamp + 86400) , thats what my skip function looks like btw in the cheats lib is there away to assert fail reasons? vm.expectRevert('message'), or vm.expectRevert(MyError.selector) cheers what are the arguments for using testFail in name instead of an expect revert assertion? Maybe if its just a revert without any error message.",430
541,foundry-support.txt,"Generally you should use expectRevert 👍 yeah was thinking the same but then seeing it in solmate where its used for reverts with messages wonder why as it seems can be asserting the wrong failing reason because those tests are old, t11 recently mentioned that on twitter 🙌 what is the recommended way to do assertEq for an enum? i tried doing asertEq but i got No matching declaration. assert( == ) works tho You could could cast your enums to a uint first. Alternative a common pattern (and my preference) is ading a file/contract DSTestPlus is DSTest in test/utils, having all test contracts inherit DSTestPlus, and assing your own assertEq overloads for your own types such as: function assertEq(MyEnum a, MyEnum b) internal {  // logic here } how to delete cache in forge? I am initializing a contract in setUp( ) but forge says it is already been initialized I have called floatcapitalcontract.initialize() only 1 time Tried forge clean also The only reason testFail exists is for dapptools compatibility. We encourage using expect Revert so you can test reasons and more than 1 failures per test T11s has been trying to keep it dapptools compatible because forge was very unstable until a month ago, but you'll see some tests use new cheatcodes now Got it . I have to use a proxy for these. The contracts were initializing automatically so one thing I've noticed is that I sometimes have problem with deploying, and then when deleting the cache and out folder it works also the same happens to my tests sometimes and they won't run until I delete said folders yeah i was also wondering this too. This wasn't made clear in the verify-contract function and it unknowingly lets users upload the full filepath of their local machine got it thanks! we probably should, having user's full directories on etherscan by default doesn't seem great oh looks like its already being worked on, thanks @mattsse https://github.com/gakonst/ethers-rs/pull/1136 king seitz always on top of things Hey, guys! I’m trying to create my first test contract using Foundry, but I have some doubts. I’ve already looked at Foundry Book, but I couldn’t find the answer for my questions.",474
542,foundry-support.txt,"First: I’m trying to test my latest project, which you can see in this Github link: https://github.com/Leutwiler/RPG-Character-Sheet-and-Dice-Roller This is the code I’m trying to use to test my project: https://gist.github.com/Leutwiler/bb8a006b1536818cd8d01f65af03bd53 I’m facing some issues because I’m not so sure about how I can test my levelUp and levelDown functions, which change the level (from a struct) based on the _characterId of the character array. How am I supposed to do it? I tried to create the testLevel function using Foundry, but I wasn’t successful. My second problem is: as I’m also trying to roll dice (as you can see in the first Github link), I’m using _numberOfDice and _numberOfFaces to select the number of dice and number of faces that should be rolled. With that in mind, as I’m using an uint8 for both, the maximum value of _numberOfDice * _numberOfFaces should not greater than 255, so that’s what I’m trying to tell Foundry to do during the tests. But even with the written code, the test is still failing. Can someone help me on how stipulate a ceiling/max value that Foundry should go for during the tests in order for them to pass? I’ve already tried to use assume and require, but without success. Thanks! :) what's the failure reason? Running 2 tests for src\test\RPGCharacter.t.sol:RPGTest [FAIL. Reason: Index out of bounds. Counterexample: calldata=0xb3e5626f0000000000000000000000000000000000000000000000000000000000000000, args=[0]] testLevel(uint256) (runs: 0, μ: 0, ~: 0) [FAIL.",407
543,foundry-support.txt,"Counterexample: calldata=0x3a551a2a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000, args=[0, 0]] testRollDice(uint8,uint8) (runs: 0, μ: 0, ~: 0) the first failure is because you just access the character array with the index provided by the fuzzer: no characters actually exist in your array, so the length of the array is 0. second failure, not sure. can you try running with -vvvv on forge test? also, what version of forge are you on? yes! but what is a good solution to this? should I code manually some characters to test it? if so, what's the best procedure? I'm using forge 0.2.0 yes, you should manually add some characters. since you're just testing the level up function, you could take in uint startingLevel and make sure you can increment it. make sure startingLevel is less than type(uint256).max though so you don't overflow the reason you'd want to only take in a starting level is because that's all you're really testing: the property you are testing for is that when you call levelUp the level of the character increases all other properties are irrelevant for this test case thanks for the tip! Running 2 tests for src\test\RPGCharacter.t.sol:RPGTest [FAIL. Reason: Index out of bounds. Counterexample: calldata=0xb3e5626f0000000000000000000000000000000000000000000000000000000000000000, args=[0]] testLevel(uint256) (runs: 0, μ: 0, ~: 0) Traces: [621584] RPGTest::setUp() ├─ [583619] → new RPG@0xce71065d4017f316ec606fe4422e11eb2c47c246 │ └─ ← 2915 bytes of code └─ ← () [2410] RPGTest::testLevel(0) └─ ← ""Index out of bounds"" [FAIL.",475
544,foundry-support.txt,"Counterexample: calldata=0x3a551a2a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000, args=[0, 0]] testRollDice(uint8,uint8) (runs: 0, μ: 0, ~:Traces: [621584] RPGTest::setUp() ├─ [583619] → new RPG@0xce71065d4017f316ec606fe4422e11eb2c47c246 │ └─ ← 2915 bytes of code └─ ← () [5318] RPGTest::testRollDice(0, 0) └─ ← () Test result: FAILED. 0 passed; 2 failed; finished in 55.49ms these are the errors using -vvvv ah, u dont assign cheats. it should be Cheats public cheats = Cheats(HEVM_ADDRESS) Great! Thanks for the advice The test is still failing though try posting the new traces should I post here or is it better to post on my gist? just post it here Running 2 tests for src\test\RPGCharacter.t.sol:RPGTest [FAIL. Reason: Index out of bounds. Counterexample: calldata=0xb3e5626f0000000000000000000000000000000000000000000000000000000000000000, args=[0]] testLevel(uint256) (runs: 0, μ: 0, ~: 0) Traces: [621584] RPGTest::setUp() ├─ [583619] → new RPG@0xce71065d4017f316ec606fe4422e11eb2c47c246 │ └─ ← 2915 bytes of code └─ ← () [2410] RPGTest::testLevel(0) └─ ← ""Index out of bounds"" [FAIL. Reason: Arithmetic over/underflow.",433
545,foundry-support.txt,"Counterexample: calldata=0x3a551a2a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000080, args=[2, 128]] testRollDice(uint8,uint8) (runs: 6, μ: 6769, ~: 6769) Traces: [621584] RPGTest::setUp() ├─ [583619] → new RPG@0xce71065d4017f316ec606fe4422e11eb2c47c246 │ └─ ← 2915 bytes of code └─ ← () [2738] RPGTest::testRollDice(2, 128) └─ ← ""Arithmetic over/underflow"" Test result: FAILED. 0 passed; 2 failed; finished in 32.53ms i think its because you are doing _numberOfDice * _numberOfFaces where both of those are uint8s u should convert it to a uint() first so like uint(_numberOfDice) * uint(_numberOfFaces) wow! it fixed my problem can you explain me why this was the right fix for the issue? you can see that the fuzzer tried the inputs 2 and 128. when you multiply these it will result in 256, which is outside of the bounds of uint8.",300
546,foundry-support.txt,"since solidity 0.8.0 all arithmetic is safe by default, so the overflow will cause solidity to revert for you since it overflowed casting it to uint changes the values from uint8 to uint256 - 256 is well within the bounds of a uint256 Is this a footgun we should document? dont think so, it requires some knowledge of the type system in solidity which i think is outside of the scope of the book we should make that ""learn solidity with foundry"" book at some point tho ohh, I see, and nobody may overflow this function anymore because a _numberOfDice = 255 * _numberOfFaces = 255 isn't greater than the max uint256 value it makes total sense to me now thanks for saving me again, Oliver! 😃 yep np! gl with ur project :) Yep planning for it anyone have experience or examples running slither/mythril w foundry? assuming there's some remapping arg i need to add - name: Install Foundry  uses: onbjerg/foundry-toolchain@v1  with:   version: nightly  - name: Run Slither  uses: crytic/slither-action@v0.1.0  continue-on-error: true  id: slither  with:   node-version: 16   sarif: results.sarif Try this we have a frankenstein repo (still using hardhat for deploy) that has it: https://github.com/thirdweb-dev/contracts/blob/main/.github/workflows/slither.yml https://github.com/thirdweb-dev/contracts/blob/main/.github/workflows/forge_test.yml thanks will try it out 🙏 Hey, I'm trying to use Foundry's Forge to deploy a rudimentary smart contract on Acala EVM+, but I need to overwrite the gas limit and gas price of the transaction in order to do so. Our eth_estimateGas RPC call returns too low of an estimate for the deployment. I've tried looking for a way of overwriting this, but couldn't find one. Even specifying the gas_limit and gas_price in foundry.toml doesn't help.",435
547,foundry-support.txt,"Is there another way of doing it, or is this and incompatibility issue that I won't be able to bypass? forge create —gas-price should work, no? That worked, thank you! I can see the progress, but now I see that the gas limit isn't being picked up as well from the toml file. Is there a way to overwrite this parameter as well? I think we might not be allowing the gas limit / gas price to be overriden via the config, which makes sense, they are expected to change depending on onchain gas prices and the contract you’re deploying --gas-limit should work hi there, how is it possible to assert negation? For example assertNotEq or assertFalse? still haven't been able to get this figured out, tho @mattsse said in gh issues the verification worked for him any ideas how i might debug further? have tried cleaning & redeploying / reverifying w bytecodehash as ipfs & as none still can't seem to figure it out trying to deploy these contracts to mainnet later this week so any help is greatly appreciated It does, but on Acala EVM+, we also have storage limit in addition tto the gas limit and gas price and it is encoded within the two. Everything works fine for normal trancactions (those that just change some states), but for the smart contract deployments, which change a lot of states, we need to manually override both values. Is there a special reason the gas_limit from the foundry.toml isn't used? I want to contribute to foundry for adding new cheatcodes What's the process? I don't know rust btw I forked a foundry repo and no matter what I do I can't seem to build. It always says no files changed compilation skipped but actually I am changing the code. I see @karmacoma_eth had the same issue and fixed but I didn't really get what to delete. (I did forge clean forge build —force and everything not working) Doesn’t seem like this is in the standard test lib. You can easily extend it though Does it make sense to have it in the standard lib or is there a way to negate it circumnavigating the problem ? Could always use assertTrue(a != b).",461
548,foundry-support.txt,"I also had some cases where a assertNeq would have been nice link to rrepo? did you try —force ? would it too much data if all of 4bytes data was shipped along with forge / cast? all local, no api calls. and nightly releases are released with synced up db. yes its quite large Well , ~9mb for both the events and functions idk thats pretty small if we ever do forked traces with 4byte decoding support, could be a significant boost for speed to have a local db although it would make forge 2x larger at that size too yeap tried clean , delete cache then forge build —force but not working still. I guess @karmacoma_eth was also having this issue I checked here in the previous chats but couldnt really figure out how did he handle it https://github.com/tapired/FoundryStrategyBOO Generally you need to delete the cache and out folders if you want to start from scratch (aside from using --force) is there a way to deploy code to a specific address? You can use create2 utility of openzeppelin to know the address where your smart contract will be deployed before it actually deploys Don't know if you can deploy to any specific address of your choice I see. I still trying to link library with contract deployed using deployCode. still not successful :(.",278
549,foundry-support.txt,"this would be really cool Which repo is that? right now I just did this (to try to deploy saddle using deployCode) https://gist.github.com/thasarito/0bf176b394d30f1d8ee01bff9120a805 can forge generate a contract template implementing an interface? is it possible to get / see the output json that's being submitted to etherscan w verify-contract? in general also does forge have something like -vvv for showing more information while it runs? that could be very large, it would contain all source code for the contract in question including all imports it will be printed via RUST_LOG=forge=trace though thank you! yesssss finally able to get this verified although the ordering of files is odd to say the least it's alphabetically sorted I believe, but I guess we could make it that the target contract appears first, mind opening an issue for that? Did the contract verification command get changed to JSON 👀? will do yes standard-json is the default now, but --flatten is an option submitted https://github.com/gakonst/foundry/issues/1283 I was trying to reproduce this gas optimizations and checking them in Foundry and got an unexpected result after caching the array length (lines 9 and 10) The gas reported is higher. Testing it in Remix gives me a slight decrease sorry, forgot the link: https://solidity-by-example.org/gas-golf/ use ""& 2"" instead of ""% 2"" if you wanna go golfing might be solc version differences / optimizer settings? likely optimizer runs yeah testing install on fish shell I get this error fish: Unsupported use of '='. In fish, please use 'set FOUNDRY_DIR ${FOUNDRY_DIR-""$HOME/.foundry""}'. should hardhat artifacts and foundry produce the same output bytecode providing the same code & solc settings are used? What command did you type? Foundry works with fish. What is the recommended way to read private variables of another contract off a hardhad forked mainnet? I was going to use etch() to force-deploy an updated contract at the target contract address, where everything is marked public. Or, I can use the functions in ForgeStd to find the storage slots and read them that way (seems way more painful).",481
550,foundry-support.txt,"Comments? The same one to install foundry up Maybe I’m passing the fish param wrong Because by default it detects zag &1 is the equivalent of %2, not &2. using create2, you can ""mine"" vanity addresses by brute forcing the salt value until you get an address that looks good to you. A popular use case is addresses that start with a bunch of 0s: https://github.com/karmacoma-eth/yolo-evm#create2py Everyone goes for leading 0s, but it's actually zero bytes that matter and they can be anywhere. And it's easier to find them anywhere than all at the front Can you use cast to get balance of account on BSC or Polygon? Yes How to specify the other chain's RPC? Hi, I’m back with yet another gas issue. Is it expected that the gas consumption of these 2 functions are different? try1 and try2 are exactly the same except the name, and if I tried swapping the 2 functions around the gas consumption doesn’t change Much thanks! you just pass a different url to --rpc-url That’s not the same. I was thinking of hardhat’s “setCodeAt” (might be called differently) where you set the code at an address. This allows for a more seamless step towards production if you already have a bunch of contracts deployed at certain addresses Function selector sorting perhaps? Interesting, might be. Do you have any docs for me to read more about this? I remember there were a few articles and even some tool for function selector ordering. Can’t find it however atm.. Still thanks a lot! https://twitter.com/Jeyffre/status/1506286755515088899 https://github.com/gakonst/foundry/issues/1290 Was actually going to ask something similar. Forge blocknumbers start at 0. And I think in order to get a blockhash, you cant get it at the current blocknum, but have to go -1. But this will throw an error if its 0. Had to rewrite some functions just so tests could pass.",427
551,foundry-support.txt,"This creates some discrepancy between testing and deployment am I being stupid or isn't row 8, 9 and 10 doing the exact same thing? row 9 and 10 are compiling but row 8 gives me this error msg the contract compiles with row 8 in remix btw henlo, If I have a bytes32[] type for the constructor input, and whenever I tried input [0xblabla, 0xblabla] and different variations it always considers it a uint256. What is the right way of converting them to bytes32? Without the 0x, if I recall considers it a uint Are you sure they're 64 characters ? 🤔 Failed to resolve: use of undeclared crate or module ethers. I keep getting that error when I try to install Foundry. Anyone know why? yes can you share it? when i do it locally over cast it works [0x666f6f0000000000000000000000000000000000000000000000000000000000, 0x6261720000000000000000000000000000000000000000000000000000000000] disregard the revert message, whats important is that he decoded/encoded it correctly when i try yours without the '0x' it tells me odd digits, which means its not 64 characters, which should be ooh no spaces oh, sorry before i thought you meant passing the args through cast/forge. but thats a solidity thing missed the first 0x yes, but I’m trying to test through foundry I’m writing a Foundry test in any other tool it works let me try externally feeding it interesting, since it clearly says its a compiler error there 🤔 I’m super weirded out by it myself anyway thanks for trying to help im weirded out myself now, since it shouldnt work with other tools, let me know how it goes :D did you ensure the other tools were using the same compiler versions? that’s the only way something different would happen between tools now it worked if I declare them separately as variables ye idk i guess just weird type inference things.",441
552,foundry-support.txt,"what solc version? 0.8.13 you could also do [bytes32(0x…), bytes32(0x…)] I tried that didn’t work? weird let me just do it again so that I verify that I’m not retarded somehow ok it worked I guess I was just being dumb thanks for the help Compiling https://github.com/Mean-Finance/dca-v2-core with forge build —hh fails with  0: Compiler run failed  InternalCompilerError: No return param name given: _usedPools but same when compiled with hardhat yarn hardhat compile compiles fine also can we get the compiler errors tell which file actually got the compile error? hi, is there a way to suppress warnings for test files exceeding the 24kb limit? thanks for this, was able to identify some solidity parser issues and get them fixed and an ethers-solc issue as well can you push a branch that fails? so I check if the error actually contains the source info main branch of https://github.com/Mean-Finance/dca-v2-core fails, can check that Whats the proper way to expectRevert of a custom defined error? https://github.com/gakonst/foundry/issues/1007#issuecomment-1092067054 It's a bit ugly: vm.expectRevert(abi.encodePacked(bytes4(keccak256(""NotOwner()"")))); Ah… I seee … I was trying to get the bytes to match but didn’t use abi.encodePacked() Hmm I think that should be added and more clear in the docs xD yeah personally would use abi.encodeWithSelector instead: VM.expectRevert( abi.encodeWithSelector( ImportedContract.CustomError.selector, arg1 ) ); ImportedContract.customErrorFail(); https://book.getfoundry.sh/cheatcodes/expect-revert.html#examples looks like they have it here @xBeans I'm bumping this in hopes of getting another suggestion as it got overflown oh I see, i guess I didnt read that part LOL Great article here: https://medium.com/coinmonks/deploy-an-efficient-address-contract-a-walkthrough-cb4be4ffbc70 In forge's gas report table, is it possible to report gas used by the fallback() method? Nvm, I didn't notice that traces report gas used by internal calls.",488
553,foundry-support.txt,"So it can be calculated from that Gas reports are basically a different view over traces Hevm.sol has this, might be what you're looking for?  // Sets an address' code, (who, newCode)  function etch(address, bytes calldata) external; can you give an example of how you expected it to work vs how it works? yeah as Karma wrote above, setCodeAt is etch in Foundry yeah you need to do libs = [“lib”, “node_modules”] i guess forge install should do that for you if you install something possible Hey foundry heros (0.2.0 looks super super great! Are you aware that https://onbjerg.github.io/foundry-book/ is down? try book.getfoundry.sh Yes, this works. Still the other is linked in your paradgim blogpost and in this channel. I am converting a hardhat repo to forge. We use a complex pipeline for deploying, so I was thinking to keep the file structure the same. how folks install libraries ? E.g I saw that forge-std does not “officially” exist in npm Just wondering if there are any best practices here from longtime HH users Have you looked at the forge install docs? https://book.getfoundry.sh/reference/forge/forge-install.html You should be able to point your remappings at the npm installed libs when you've made the jump from hardhat Missed opportunity on making foundry installation as curl -L https://getfoundry.sh | bash yy, I know all this.",317
554,foundry-support.txt,"Just wondering what people who use that in prod actaully do Thanks @dbinder I couldn't find the answer in the docs -- does expectRevert only checks if the next top level call reverts? Is it possible to have expectRevert look for the error to be raised anywhere in the call tree? With pseudo code:   hevm.expectRevert(""some error"");   forwarder.execute(req, sig);   // forwarder calls:   // (success,ret) = req.to.call{gas : req.gas, value : req.value}(callData); -> fails with ""some error""   // return (success,ret) Currently, the test fails with Call did not revert as expected Does execute reverts if req.to.call reverts? I remember there are some assembly magic that can call functions without failing on revert Also, I am battling here with remappings, and everything works except for this:   /Users/odys/code/odyslam/monorepo/packages/contracts-core/../../node_modules/@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol:5:1: ParserError: Source ""/Users/odys/code/odyslam/monorepo/packages/contracts-core/../../node_modules/@openzeppelin/contracts-upgradeable/utils/ContextUpgradeable.sol"" not found: File outside of allowed directories.  import ""../utils/ContextUpgradeable.sol"";  ^---------------------------------------^ should I recreate the state variables in my test contract and use the functions of the other contract to change them? Or use the functions of the main contract, through the test contract, and change the state variables in the original contract? It’s funny, cause the top-level lib is added to remappings and it works, but for some reason the relevant paths inside the openzeppelin lib fail to be resolved just the next top level. not sure if we want to catch non-top levels since expectRevert essentially ""inverts"" successes to reverts and reverts to successes. if an underlying contract uses try/catch that would mess things up Got it, makes sense. I found it initially surprising because expectEmit works anywhere in the call tree. Should we make a note of it in the Foundry book? if u feel like what is in the book is unclear do feel free to open up a PR with an improvement 😄 No, unfortunately it just returns success=false.",494
555,foundry-support.txt,"I think it may actually be nice if it could rethrow the error Thats the issue. btw, since it returns that you can just use if then to manually revert or check for return value (assert) instead of expectRevert Oliver, in the last few days I've been trying to create the characters properly for my test. I've already tried to code character.push inside the testLevel function and inside the setUp, I've also tried to create a new character using the function createCharacter of my original contract, but I still wasn't able to pass my test using Foundry. When I type forge test, the error returned is: Reason: Index out of bounds. Counterexample: calldata=0xb3e5626f0000000000000000000000000000000000000000000000000000000000000000, args=[0]] My original contract is working fine, I can create characters easily there, but I'm having issues in coding some character samples for the test. Do you have any ideia of what I'm doing wrong? Thanks! :) This is my latest Gist: https://gist.github.com/Leutwiler/bb8a006b1536818cd8d01f65af03bd53 Original Project: https://github.com/Leutwiler/RPG-Character-Sheet-and-Dice-Roller It's all hapening inside the testLevel function of my test contract can u log the length of character and _characterId? looks right to me although i would not use assume to constrain a 256 bit integer to 1 value 😄 I thought the problem would be related to the lack of characters in the array, that's why I assumed _characterId <= 1 hahaha has anyone run into receipt not found when polling pending tx. was the transaction dropped from the mempool? when trying to use cast send? on rinkeby for context do you want me to do it in the test contract or in the original contract? in the test contract I think the problem is that you are pushing your character in the test contract. You need to call the function create in your original contract.",440
556,foundry-support.txt,"character.push(Character(""Andrey"", Classes(0), Races(4),1,0,0,msg.sender)); character.push(Character(""Gomes"", Classes(3), Races(2),1,0,0,msg.sender)); What do you think @onbjerg ? Bc you are pushing a character in the test contract. But you need to call createcharacter in your original contract ah. right thats it good catch instead of character.push you would want to call rpg.createCharacter 🙂 yeah, I've already tried it, but it's not working. I tried to apply the same syntax as I was using for character.push, but it's not working, but I still couldn't figure out why rpg.createCharacter(""Andrey"", Classes(0), Races(4)); the error is on Classes(0) and Races(4), VS Code says: Invalid type for argument in function call. Invalid implicit conversion from enum RPGTest.Classes to enum RPG.Classes requested. try RPG.Classes and RPG.Races its a solidity type thing oh, it worked! I was relying on the state variables, struct and enum that I copied from my base contract to my test contract, that's why it wasn't working interesting Oliver. How do I call a state variable of other contract? contract.nameofthestatevariable does not work oopsie, nevermind 😅 function testLevel(uint _characterId) public { cheats.assume(_characterId <= 1); rpg.createCharacter(""Andrey"", rpg.Classes(0), rpg.Races(2)); rpg.createCharacter(""Gomes"", rpg.Classes(1), rpg.Races(3)); assertEq(rpg.getLevel(_characterId), 1); rpg.levelUp(_characterId); assertEq(rpg.getLevel(_characterId), 2); rpg.levelDown(_characterId); assertEq(rpg.getLevel(_characterId), 1); } I worked on it a little bit and rpg.Classes now is resulting in an error Member ""Classes"" not found or not visible after argument-dependent lookup in contract RPG. For people that encounter Foundryup issues like gzip: stdin: not in gzip format tar: Child returned status 1 tar: Error is not recoverable: exiting now We just migrated the Foundry repos to a Github org, https://github.com/foundry-rs/, which may have broken some links.",489
557,foundry-support.txt,"If you encounter this error, try updating foundryup: curl -L https://foundry.paradigm.xyz | sh I guess Bruno's question also solves my issue I had the idea of creating an interface and inherit it and it worked! now my test passed Details is an interface for my enum and struct contract RPGTest is DSTest, Details { RPG public rpg; Cheats public cheats = Cheats(HEVM_ADDRESS); function setUp() public { rpg = new RPG(); } function testLevel(uint _characterId) public { cheats.assume(_characterId <= 1); rpg.createCharacter(""Andrey"", Classes.Archer, Races.Dwarf); rpg.createCharacter(""Gomes"", Classes.Bard, Races.Human); assertEq(rpg.getLevel(_characterId), 1); rpg.levelUp(_characterId); assertEq(rpg.getLevel(_characterId), 2); rpg.levelDown(_characterId); assertEq(rpg.getLevel(_characterId), 1); } thanks, Oliver! 😀 ^^ You will get this yeah that's a great point. I actually get the revert data in the form of return data instead of a proper revert, so I can actually write my test like this instead of an expectRevert:  (bool success, bytes memory ret) = forwarder.execute(req, sig);  assertTrue(!success);  assertEq0(ret, abi.encodeWithSignature(""CustomError(address)"", walletAddress)); 👌 So i have a state variable in my contract that i'm manually incrementing every fuzz run. I am using the mod of this to swap two variables for extra coverage. Is this something i can do? Does evm state get wiped after ever test? or does it persist? not really sure how to debug this, so clearly the frist call after pranking causes the error... but other than that I'm not sure how to read this I'm trying to run https://etherscan.io/address/0x5A98FcBEA516Cf06857215779Fd812CA3beF1B32#writeContract generateTokens to pass LDO (non erc20) to an address.",446
558,foundry-support.txt,"Relevent part of contract is this with an etherscan key set up? if not, set it so you can decode traces and get a better sense of what’s going on yeah, I run `source .env && forge test -vvv --fork-url ${ETH_RPC_URL}`, rpc url and etherscan token are both defined in env it gets wiped Gotcha, thanks! HI, I am running forge test -vv to see the emitted logs but I can't see any logs if the tests are successful. Is it possible to see logs when tests are successfull? Add more v’s? I.e. -vvv should print logs as well Btw, is it alright for me to start writing invariant tests on alpha branch? Or should I rather wait, because things might change a lot for beta / not stable enough? Why source and not cat .env | xargs ? not working even with -vvvv i am using forge version 0.2.0 Are you sure? Did you try creating a minimal example that just emits a log, or perhaps uses console.log Hello Hi is there any good way to trace these errors ? I don’t really get what’s the reason for reverts please look at the pinned messaged in this chat notably book.getfoundry.sh ok I did try that, i wrote an empty function with just an emit statement but no output in the terminal. @kwcoil can also help how to run all tests in a folder? i pass in --match-path /contracts/tests/mydir/*.t.sol but this error Found argument 'contracts/test/mydir/MyTest.t.sol' which wasn't expected, or isn't valid in this context Never tried match patch, but you can try —match-contract ContractName. For sanity checks I would just run ‘forge test’ however Hey everyone, Is there a way to get coverage rn? [FAIL. Reason: You have an active prank already..",391
559,foundry-support.txt,"Counterexample: calldata=0x5dcd4dfe00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002, args=[1, 2]] testPlayJackpotWithoutTheMoney(uint256,uint256) (runs: 0, μ: 0, ~: 0) hey guys, is it normal that a test done in forked mainnet takes 180 seconds? Can I use multiple pranks in the same test function? just to get name() symbol() and totSupply the docs are incorrect at places for example it says You can run tests in filenames that match a glob pattern with --match-path. but glob patterns do not work here Yep. But you probably need to end a running prank. how can I do that? cheat.stopPrank() Former is simpler. tks when making rpc calls to optimism kovan with cast getting error Error: 0: custom error: EIP-1559 not activated this issue known? Why when I remove that second cheats.prank gives error? Since I didn't stop the first cheats.prank, It should keep the prank as msg.sender — legacy flag did the trick all good! still unable to verify contracts via forge on optimism though, when verifying im getting: Error: 0: Contract verification failed: Response: NOTOK Details: Fail - Unable to verify anyone encountering this ? .prank() only does the next call. you're thinking about startPrank Did we fix this? I kind of go over everything in the book and the pinned message overall. I can’t see the reason which is odd or I am missing something I guess ? I had sth similar. In my case it was mixing the test contract with normal contracts that happened to have functions that started with ""test"" Some of them has the error as arithmetic overflow and some of them just says calldata.....",409
560,foundry-support.txt,"Hmm I will definitely check it Don't think so is there a way to write tasks, like in hardhat, where you have longer form deployment scripts i see in the gitbook examples of how to use the CLI for deployment but often times you have a series of dependencies on that deployment, and so having a deployment pipeline would be much easier i see you can use this to get artifacts: https://github.com/foundry-rs/foundry/blob/master/cli/src/cmd/utils.rs#L19 friends is there a way to output the hex conversion from this We should dump this as hex probably? Or a logHex call maybe i think we should always dump as hex hm, we use .to_string() which should use the formatting from the Display trait for Bytes which should log it as hex any way to inspect the generated HardhatConsoleCalls from abigen @mattsse? nvm used cargo-expand i have a question why is erc constructor arguments not passed as bytes ? it saves more gas i'm not sure what u are referring to? when creating an erc20 contract, and you are probably using libary (i used solmate) you pass name and symbol and decimal, name and symbols are strings why ? although, the name and symbol of your contract will be be returned as hexadecimals 🤔 You could do everything in bytes. Readability is a trade off. Not everything needs to be optimized. The cost difference taking string args vs parsing a bytes constructor is negligible and any users you have will prob be turned off by the obfuscation. There’s a PR in progress right now that adds scripting: https://github.com/foundry-rs/foundry/pull/1208 Personally I use a combo of shell scripts and docker images to make pipelines for now.",364
561,foundry-support.txt,"How to run tests in a particular file? —match-path i believe will do this We need to pass in the file path right? It doesn't runs the tests forge verify-contract --chain-id 250 --compiler-version 0.8.9+commit.e5eed63a 0x010eD825A318074e00e9CBf7b87C084443A2A854 --num-of-optimizations 200 contracts/Greeter.sol:Greeter <KEY_HERE> ""Error: 0: Failed to submit contract verification 1: error decoding response body: expected value at line 2 column 1 2: expected value at line 2 column 1"" No matter what I do I get that response back, tried all kinds of ways, really no idea what that error means, and haven't been able to get the verification to work. Also, cast abi-encode ""constructor(string)"" Hello, Hardhat! The , comma breaks the encoding, I end up with Hello, as the output.",214
562,foundry-support.txt,"but the value for that needs to be abi-encoded. for example, here is how i verified a contract on ropsten that takes an argument in the constructor: forge verify-contract --chain-id ropsten --constructor-args (cast abi-encode ""constructor(string)"" ""geek"") --compiler-version ""v0.8.10+commit.fc410830"" --optimizer-runs 200 0x30b8add9d1c2c c440b33561b5e38a535680c5131 src/Domains.sol:Domains it's all in here as well: https://book.getfoundry.sh/forge/deploying.html forge verify-contract --chain-id 250 --constructor-args (cast abi-encode ""constructor(string)"" ""Hello, Hardhat!"") --compiler-version ""0.8.9+commit.e5eed63a"" --optimizer-runs 200 0x30b8add9d1c2c c440b33561b5e38a535680c5131 contracts/Greeter.sol:Greeter So my version would be this. Yeah, been reading that to figure it out and google too. Came here as last resort 😅 yes, but there is 1 small error in your thing: 0.8.9+commit.e5eed63a is on the list as ""v0.8.9+commit.e5eed63a"" so you're missing the v OK got it. I'll put this all together and see what I can come up with Thanks so much for the help fingers crossed - the UX is still not quite where we want it, still a work in progress :) ideally you'd be able to just pass --verify to forge create All in good time, still so much QUICKER than hardhat compile times like a ferrari, but it's 'beta' or is it? It's all ok for now, just tinkering 🙂 Currently trying to install forge by building from source. Once I run the cargo install command, everything seems to install correctly. However, when I run ""foundryup"", i get ""command not found"". Any ideas on what I'm missing? Are you doing it in the terminal outside of vscode or another code editor? It did the same for me so I had to move to the main terminal OSX When you build from source you do not have foundryup available rugged for the workshop.",498
563,foundry-support.txt,"forge run didn’t work either. Will try to find a workaround @brockelmore’s repo worked. I assume it has to do with non-dapptools style dir structure true true you have export ENV_VAR_NAME i guess ? yes etherscan requires the v prefix console.log in foundry using hardhat or any other way also? same way as hardhat Sameish, not fully equivalent like no format strings 👍 Hi everyone, I started using foundry not long ago. Very nice tool 👍 I'm still wondering how to do failing test I try: vm.expectRevert(); contract.call(); It seams to work in the sense where it do not create a error, but since it's a failing test, it still make my github workflow fail... how to make a failing test pass the test? can you paste the snippet of the test function? function test_CollageOfMyself_cant_mint_if_paused() public { assertEq(collageOfMyself.balanceOf(address(this)), 0); assertEq(collageOfMyself.totalSupply(), 0); vm.expectRevert(abi.encode(string(""Minting is paused""))); collageOfMyself.mint(1); } expectRevert should receive the bytecode e.g. cheats.expectRevert(abi.encodeWithSignature(""Panic(uint256)"", 0x11)); thanks :) this page gives good examples, https://book.getfoundry.sh/cheatcodes/expect-revert.html see the end section Thank you very much 🙏 Getting this error No target contract. I am importing a contract file and instantiating it with new keyword. what is your folder structure and what's the content in Contract.sol? can you also send the content of ContractTest.sol? anyone know why I get, ""No matching declaration found after argument-dependent lookup."" here? Hi, I specified path for libs like this libs = ['contracts/lib'] in foundry.toml but when I ran forge install OpenZeppelin/openzeppelin-contracts, the dependency is still installed in lib/ folder instead of contracts/lib/ folder. Am I doing this correct? why do you want to change the installation location? i can compile and run your contracts fine, the error might be to do your project installation/configuration Ah ok, perhaps I misunderstand how it works.",470
564,foundry-support.txt,"So libs param in foundry.toml is the list of libraries and it is for easier remapping? I updated forge and then ran forge init.I'll check thanks I had an existing repo with a lib folder so if I don't want foundry dependencies being mixed with my original files in the folder, I will have to move the original files to somewhere else or rename the lib folder to something else? how i understand it is libs tells forge where to look for the installed packages. for more info about remapping, check the ""Remapping"" section in README.md in the forge folder of the foundry repo ye, i am not sure how to tell forge to change the installation path, so you might need to rename lib first to move your original files there thanks! Anyone proficient in assembly lang, Can I ask you some questions ? Need some help in understanding concept of offset are there cases when deal doesn't work? (for erc20s) ooof $ foundryup % Total % Received % Xferd Average Speed Time Time  Time Current         Dload Upload Total Spent Left Speed 100 166 100 166 0  0 318  0 --:--:-- --:--:-- --:--:-- 321 100  9 100  9 0  0  12  0 --:--:-- --:--:-- --:--:-- 12 tar: Error opening archive: Unrecognized archive format [⠃] Compiling...2022-04-17T09:15:15.901251Z ERROR ethers_solc::resolver: failed to resolve versions [⠊] Compiling... Error: 0: Discovered incompatible solidity versions in following : src/Fallout.sol (^0.6.0) imports: lib/openzeppelin-contracts/contracts/utils/math/SafeMath.sol (^0.8.0) Location: cli/src/compile.rs:38 Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets. exit 1 Is there a way to use multiple solidity version with foundry? add in foundry.toml auto_detect_solc = true and remove if present solc_version line Getting same error.",476
565,foundry-support.txt,"foundry.toml file: [default] src = 'src' out = 'out' libs = ['lib'] auto_detect_solc = true everything within a single flattened solidity file should be able to compile by a compatible solidity version, dont think there's any workaround you can have independent files that can use different versions if they dont depend on each other is there a way to cache forked data after the first run so subsequent runs are faster? Its mentioned in the doc that - ""If both --fork-url and --fork-block-number are specified, then data for that block is cached for future test runs. The data is cached in ~/.foundry/cache/<chain id>/<block number>. To clear the cache, simply remove the directory."" not running on a forked block, guess will just use the latest block number with a public archive node, thanks! block number should take latest but it doesnt 😕 yeah haha tried that would be good if block number latest would get the latest state and then use that for all future runs, but it wont be ""latest"" if cached i suppose $ forge build [⠊] Compiling... [⠒] installing solc version ""0.6.12"" [⠢] Successfully installed solc 0.6.12 [⠆] installing solc version ""0.6.12"" [⠰] Successfully installed solc 0.6.12 Error: 0: ""/Users/user1/.svm/0.6.12/solc-0.6.12"": Bad CPU type in executable (os error 86) Location: cli/src/compile.rs:38 Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets. exit 1 Anyone experienced this : Bad CPU type in executable (os error 86) Problem solved by installing ""rosetta"". Thanks Is there a cheatcode for setting a user balance in some erc20 token? not a cheatcode, but if you inherit forge-std/Test.sol:Test, you can do deal(erc20, user, amount) is via-ir compilation usually slower? Yes, noticeably so Yeah, feels like i am back on hardhat with that thats the default.",472
566,foundry-support.txt,"we can't cache that though, because the latest block is updated every 15 secs on mainnet, and faster on other networks Technically if you leave the field null it should return latest according to rpc spec yea, thats the compiler trying to unfuck the mess it made originally Waaaay i think we are using the “cache” really as just a arbitrary block to work with and mock against then choose an arbitrary block to fork from? 😄we can't cache the latest block for reason above forge create --private-key <private-key> --rpc-url http://127.0.0.1:8545/ src/CoinFlip.sol:CoinFlip [⠒] Compiling... No files changed, compilation skipped Error: 0: No artifact found for /Users/user1/Desktop/ctf/ethernaut/ethernaut/src/CoinFlip.sol:CoinFlip Location: cli/src/cmd/utils.rs:81 Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets. exit 1 What i am doing wrong? I am trying to deploy this contract on local hardhat blockchain try -t CoinFlip ? also remove the private key from the message Thanks, thats a hardhat private key With latest foundry i am not able to deploy contract with above command. Below command worked. Not sure why the command from foundry book didnt worked. $ forge create --private-key <private-key> --rpc-url http://127.0.0.1:8545/ -c src/CoinFlip.sol CoinFlip what's the error message? I have noticed that my deployments go through kinda randomly while getting ""Error: 0: Contract was not deployed"".",358
567,foundry-support.txt,"Usually works at least every fourth time or so so not really a big problem your command line arguments are not in order I tried with exact order given in foundry book but was getting same error This was a error message: Error: 0: No artifact found for /Users/user1/Desktop/ctf/ethernaut/ethernaut/src/CoinFlip.sol:CoinFlip Location: cli/src/cmd/utils.rs:81 Try forge create —chain —rpc-url —private-key —from ContractName with the options entered ofc uhhh waaaaat More info pls ser yes I just get this but then keep trying to deploy until it works lol, I guess it's just what happens if the transaction fails for whatever reason whats the output of forge --version forge 0.2.0 (90617a5 2022-04-12T00:13:04.257461+00:00) but as I said, not a problem for me personally since it usually deploys on the third/fourth try or whatever hmmmm that panic is not found anywhere on master so a bit confused and dont see how line 194 can fail maybe foundryup and try again? pretty weird, look at this example. the exact same command three times, only deploys on one of them what chain rinkeby is this after running foundryup? yeah, just did panicking at line 194 makes no sense i dont understand this could it have to do with the rinkeby RPC I use? basically works all the time on ropsten probably the rpc ye but i still dont understand how it ould panic at line 194 its ethers-rs throwing the error https://github.com/gakonst/ethers-rs/blob/master/ethers-contract/src/factory.rs#L162-L167 try with RUST_LOG=ethers-providers=trace maybe something useful in the logs there i think the path needs quotes ""src...:..."" Hi guys, I just switched from hardhat to foundry. I'm currently rewriting some test for my contract.",421
568,foundry-support.txt,"How do you guys approach testing (complex) contract interactions (e.g., Uniswap v2/v3 swaps)? Foundry Support Would you advise forking? or creating these within setUp() With the latter i'm already stuck with does not give me any logs no its not a syntax error, it works sometimes on rinkeby and all the time on ropsten so probably have to do with the rpc hmmm try RUST_LOG=ethers_providers=trace ? yeah this gives me tons of stuff yeah you can decrease the verbosity with debug, info, warn, error etc def suggest forking or you can | grep <relevant string> yeah that too And then overwrite state to make it reproducible? if you fork specific block it should always the same and reproducible https://github.com/gakonst/v3-periphery-foundry/blob/main/contracts/foundry-tests/utils/Deploy.sol#L35 Check this Thanks! that looks exactlly what is was looking for haha On a forked network, how we can execute multiple transaction in a test function so that we will get different block.number on each transaction. I tried for loop, but i guess that complete for loop is getting executed in a single transaction. so all those functions inside for loop will be sharing same block.number. If you want, making a PR to the book with how to do this would go a long way Yeah you need to use the Warp cheatcode If I have something, I will have a look! There are uniswap v2 updated contracts for using ^0.8 or you can just use the compiled output how can I deploy local testnet? Hi , when I run forge test --vv —fork-url rpcurl , forge compiles but not runs the test.",358
569,foundry-support.txt,"Is there any spesific reason for this ? using forge 0.2.0 hey folks has anyone tried using slither yet? it can't seem to find my external dependencies I installed like OZ have you tried running ‘forge clean’ yet? sometimes cached gets messed up i’ve noticed check out https://github.com/0xSplits/splits-vesting/blob/ef4e38fb76d75afdc107c957b53a713e9cef46c5/slither.config.json Hi guys, Is there any sort of info out yet about potential test coverage support with foundry? It might not be possible just asking generally thanks mate, all good now 🙏 anyone has got error dyld[48338]: symbol not found in flat namespace '_libusb_claim_interface' when executing the target binary from the repo (e.g. cargo build && ./target/debug/forge —version) directly on M1 Mac? if not, i will open an issue do you have libusb installed? yes How we can set value of mapping(address, uint256) from different contract which is at slot 0. There is a store cheatcode, but i am not able to set it. Is it correct? vm.store(address(obj), bytes32(keccak256(abi.encode(msg.sender, 0))), bytes32(uint256(20))); that looks like an incorrect slot calculation to me is the mapping public? no nvm the slot calc looks correct FYR other contract: contract DemoContract { mapping(address => uint) balances; } is it a simple mapping of address => uint? ok Test contract: contract DemoTest is DSTest { DemoContract obj; Vm vm = Vm(HEVM_ADDRESS); function setUp() public { obj = new DemoContract(); vm.store(address(obj), bytes32(keccak256(abi.encode(msg.sender, 0))), bytes32(uint256(20))); } [...] } you could break out records cheatcode and call a function that reads it then use accesses cheatcode to see all the slots Sure, let me try it. Thanks Is there a way to get console.log to work even if the test pass? currently it seams to only work on failing test...",452
570,foundry-support.txt,"and gm everyone ☀️ what's the reason for vm.roll() not to advance the block timestamp accordingly? have you tried it with -vv flag Hey! Since coverage is not yet supported by Foundry/forge, what is the alternative for generating codecov compatible coverage reports? (json, xml, txt) Thank you, I just try, I don't see any difference... with -vv it should work. can you send a snippet for a test where that is not the case? no alternatives i think, unless dapp coverage works w those tools Ahh! Dapp tools doesn't work with codecov formats afaik Thanks though! fair enough! fwiw i'm going to work on coverage now I am sending 1 ether to another contract .But the balance is not updating See the console.log also asserEq is not satisfied Thank you, by setting up a example on the pc I use for tg, I realized I had not such issue, make me realize my work pc was not running the latest version of forge 👍 Thank you again :) Cool! Glad it worked 😄 what does reentrant look like? does depositorOne have any eth? OOo No How can I do that vm.deal(depositorOne, amount); here: https://book.getfoundry.sh/cheatcodes/deal.html Big thanks . I am testing whether forge tester warns the user of a reentrancy bug is there in the contract. Forge is not giving warning for reentrancy forge doesn’t have any linting/slither capabilities built in I have a feature request for a VM.random() function. it would be really usefull to have some type of randomness for testing contracts that is seperate from the random inputs given in fuzz tests wanna open an issue with motivation + example use cases? Hi 👋 We are planning to port our Protocol from hardhat to forge. Do you guys have any resources that helps in porting the testcases? Also please let me know how to setup a compilation benchmark between hardhat and foundry. Curios if there are any tools for that! Thank you 😊 Also this link is broken.",434
571,foundry-support.txt,"Kindly update the pinned message to point - https://book.getfoundry.sh/ fixed.- thx i just run hyperfine https://github.com/gakonst/v3-periphery-foundry/tree/main/contracts/foundry-tests/ try this Thank you! Will check 'em out 👍 startPrank cheatcode is not working. I set it using vm.startPrank(<address>); I see msg.sender != <address> It's only set for subcalls, so msg.sender will not change if you do stuff like: vm.startPrank(address); console.log(msg.sender); check the docs: https://book.getfoundry.sh/cheatcodes/start-prank.html Its saying - Sets msg.sender for all subsequent calls until stopPrank is called. yes where is msg.sender not set correctly? can you provide more context on your snippet, e.g. what call do you make after startPrank where msg.sender is not set as you expect it to be? contract TokenTest is DSTest { Token obj; Vm vm = Vm(HEVM_ADDRESS); function setUp() public { obj = Token(<on-chain-address>); } function testUnderflow() public { vm.startPrank(<address>); console.log(""msg.sender ="", msg.sender); } } yep, so that's what I said - it's for all subsequent calls, and the access to msg.sender here is not a call if you made a contract and called a function on it, where that function logs msg.sender, then you should see that it works as expected Thanks, its working now Trying to output state from tests to a txt file using ffi: js  function test_ffi_file_writing() public {   string memory line = string(abi.encodePacked(""Value"", _convertUintToString(1)));   string memory file = string(abi.encodePacked(""sim_"", _convertUintToString(2), "".txt""));   string[] memory inputs = new string[](4);   inputs[0] = ""echo"";   inputs[1] = line;   inputs[2] = "">>"";   inputs[3] = file;   bytes memory res = vm.ffi(inputs);  } Getting this error: [FAIL.",457
572,foundry-support.txt,"If not, perhaps a regex in the Config file could be implemented kind of reminds me of the rust ignore pattern; wonder if it could be ported with a cheatcode & maybe a modifier? 👍🏾 more test example by Foundry I can follow? This is quite complicated tbh so like hevm git commits this is actually how github pages deployments use to work but for branches* Soon^TM, once we have coverage implemented. What do you think is hard to understand here? (Actual question) Running into tar: Error opening archive: Unrecognized archive format on foundryup . Anyone has the same issue? Update your foundryup With the same curl command You used to install it what would be the best way to extend ds-test / foundry-test with more test function? like assertFalse and assertNotEq? I'd write a test contract that inherits from forge-std/Test And inherit from that Or PR it into forge-std/Test.sol would those type of tests useful? I'm trying to understand why they are not already there. Are those not common? Maybe they weren't needed? Idk @brockelmore @transmissions11 any ideas https://github.com/akropolisio/vortex/blob/main/src/BasisArb.t.sol https://github.com/supernovahs/Foundry-Starter-Kit Hey frens. Running into Error: stream did not contain valid UTF-8 in Remapping Provider, everytime I run forge test. Any help? how do I format an array if I want to pass it as an argument to the constructor? Anyone had issues with remapping in GitHub actions? I have this weird hair-pulling bug where tests are running fine locally (even if I just pasted contracts and forge installed in a brand new forge project) but fail on CI (with a file not found/check your remapping). I’m using the same CI as the one in example in the repo (weirdest part is, if I clone the repo, it works locally too)… :confusionTriggered: this is quite straight forward. I can compare with the Solidity file to the .t.sol file to know how to learn writing test file in Foundry. Your previous example is good with UniV3 is great, but it's too hard for me at first. I have had this experience as well.",479
573,foundry-support.txt,"I ended up committing the remappings after dumping and fixing build errors after doing forge remappings > remappings.txt. Also you'd want to make the remappings relative path, the dump will be absolute paths on your fs which will fail elsewhere yh, never tried non-relative ones actually':) I'm already using a remappings.txt, which is pretty basic imo locally/on cloned repo/in new forge init CI :wtf: (other collab who cloned the repo -> works too, so no relative/absolute path dependency I'd say) What would the correct path be? Also verify the remappings that forge is using by adding another command forge remappings in the pipeline and compare? oh yh, good idea The path looks fine to me i think.. are you fetching the lib submodules in the CI? so same/correct remapping in CI I... think so 😄 I'm using the same CI as the one in the foundry book (https://book.getfoundry.sh/config/continous-integration.html) Okay that looks like that should be fetching the submodules (was previously using git submodules --init, without difference, but it should be fine with checkout, right?) ok, should be Ah I see the problem You're on apfs on Mac right? hahaha, now I'm expecting the unexpected 😄 yes I am just guessing. But that is case insensitive so uniswap-V3-core worked But ci is linux case sensitive V3 would be invalid Do v3 Also guessing Dear ser, I'm now having some kind of planetary-scale facepalm 😄 Indeed, case-(un)sensitiveness issue':) Thank you a lot:D Haha bearish on case insensitive filesystems Collaborator also on mac yh! Usually I'm on ubuntu, but away from home so on mac, wouldn't have thought mac is case-insensitive... I mean...",385
574,foundry-support.txt,"wtf';)? Thanks a lot, we'll burn our mac or something now switch to windows xp? Win3.11 ftw! How to set up a project with a self-defined Pragma Solidity version? hey all, having a foundryup issue, usually runs fine - anything to be aware of updating prior to foundryup? Just update foundryup disable auto detect in foundry toml file Windows is also case insensitive I am not sure thank you yw We were looking at markdown/html documentation generation based of natspec and were wondering if there was any feature like that planned to be included in foundry, if not and within scope for this project definitely willing to contribute somehow Wait so what was the issue? You can set solc_version in foundry toml or pass it as a cli argument Not there yet but I think there might be an issue for it. If not feel free to open it, imo the ideal UX looks like docs.rs Wrong uppercase in remapping.txt (because pebcak) -> test without issues on macOS/apfs but failed on Ubuntu/GitHub CI Ah maybe I worded my question/suggestion wrong. I was talking about solidity docgen :p Of course foundry itself needs good docs.rs docs too so I'm the guy having problem with the contract deployments, were the contract only gets deployed like 20% of the tries. Having the same problem rn with cast, where my transactions only go through like 20% of the time. The error msg I get is ""receipt not found when polling pending tx. was the transaction dropped from the mempool?"" which is the same I get if I run forge create with ethers-rs traces on. Also I don't think it as an RPC issue anymore, if I just write a JS script and deploy with ethers-js, it works 100% of the time hmm interesting, did you find anything relevant in the logs? this message ""receipt not found when polling pending tx.",402
575,foundry-support.txt,"was the transaction dropped from the mempool?"" is always the last log if I run the deployment with ethers-rs tracing on do you see the tx go through and visible as pending on testnet's etherscan? yeah, so the issue must be around finding the receipt but it doesn't confirm? I just get the mempool message back in the terminal but does it confirm on the chain? yeah the transaction goes through what rpc are you using can you share the tx link? alchemy, rinkeby https://rinkeby.etherscan.io/tx/0x6b82ef7210cf9cef7d58d30910c8f81e7917b99b10fb5565e949f14d904e53f7 i know rinkeby has awfully long block times nevermind, doesn't seem like it on etherscan maybe it was some other testnet wait, it looks like the contracts have been getting deployed every time aswell even when I get this error msg lol No I meant solidity generates docs from natspec which get formatted similar to docs rs 😅 I just assumed they were not deployed because of the message but when I check my address, they have been getting deployed all this time lol Mhm this has to do with the pending transaction poller on ethers..I'm surprised more people haven't reported this yet.",279
576,foundry-support.txt,"i hate that geth attach wont work on alchemy rpcs We can figure it out :) mhmm alright The most useful thing you can do would be to open an issue we can repro with Might be trivial, eg forge init and then forge create But need exact settings to pin it down yes, will do that fwiw, this is hideous wdym? https://docs.racket-lang.org/scribble/index.html much better UX, yes this is just subjective this can be also post processed with templates eg handlebar templates just need the json devdoc output Hey guys if I want to call a function with another address in my tests how what do i do? I saw this in the docs // Sets the *next* call's msg.sender to be the input address function prank(address) external; but where do i get the address from dont you know what address you want to call the function as? No, does foundry generate addresses like hardhat or truffle? you can use any address you like just say address alice = 0x1; in your solidity or whatever and then do vm.prank(alice) Okay, thanks man https://gist.github.com/Perelyn-sama/b7f41591d7ee7372c754c98be1c02b1a Hey man, i tried to run it and came across some errors I copied the error to the end of the file Hey I am tring to fuzz over a small rand of values keep getting the error [FAIL.",305
577,foundry-support.txt,"Reason: Too many global rejects] is there any way around this error? Thanks in advance Ah I should probably just be using a loop ^ Are using ‘assume’? If so, try a smaller type for your fuzzed var (ie not uint256 if you only pick values <100 for instance -> uint8 is enough) the addrs you're pranking don't have ETH—make sure to give ETH to the pranked address with vm.deal, or use hoax from forge-std to prank/deal with one method yep, and see here for more options: https://book.getfoundry.sh/cheatcodes/assume.html#assume Hi, is it possible to run tests from a forge project on a ganache-cli instance? Hi trying Foundry for the first time, I installed the pancake swap code just to try some basic tests, but I keep getting an Discovered incompatible solidity versions in following I see that the pancake swap is using multiple solidity versions, but shouldn't this be dealt with? or what might I be doing wrong? thank you Yes you need compatible versions to be able to run forge test if I run hardhat on the https://github.com/pancakeswap/pancake-smart-contracts/tree/master/projects/exchange-protocol I was expecting it to work out of the box I see solidity versions 0.5.* and 0.8.* which would be incompatible No, that's related to how the sol compiler works: to be able to build a project, the solidity versions must be compatible. The workaround is to first build and deploy the 0.5.*, then the 0.8.* They probably have a deployment script or test script for that hi! I'm having an issue where I'm not seeing the gas reports when I run forge test --gas-report I'm on the latest version of forge. My tests are making external calls oh, is there a way of separating the build process, and the test running process to do tha tin foundry? https://github.com/nayms/contracts/tree/kp/forge_tests ignore the ugly code, but here's the repo if that makes a difference Well my q is related to that: you could run ganache-cli, pre-deploy the first contracts, and then test against that.",467
578,foundry-support.txt,"Idk if there's a simpler solution? ganache? is that whatis running the EVM druing the foundry tests? No in foundry it's called hevm but it's basically the same thing oh, ok, but how would foundry know about ganache-cli? Because like hevm it runs on one of your local ports on your computer. The pb with hevm in forge test is afaik, you can't make the state persistent Btw I answer my own q lol, you can do: forge test --fork-url http://127.0.0.1:8545 After launching a ganache instance oh cool just need to read on how to deploy de c ontracts in separate your suggestion is to compile the contracts by manually calling solc instead of using forge, and just use forge to run the tests Yes, maybe there's a simpler way, but I'm not aware of it ok, cool, thank you for the help just learning about foundry Oh thanks, I'll add to my setup function When attempting to run 'forge update' I'm getting errors ""error: Your local changes to the following files would be overwritten by checkout"" about files in my dependencies that I haven't changed... Foundryup is returning tar error opening archive: unrecognized archive format I'm also getting an error updating foundryup: gzip: stdin: not in gzip format [FAIL. Reason: Arithmetic over/underflow. can I pass the test with vm.expectRevert ? Hey guys, I'm in a bit of a pickle. I'm stuck trying to programmatically verify my contract on Kovan and am not sure where I might be going wrong. - Able to deploy contract via foundry. - Able to manually verify deployed contract via the website [Compiler: v0.8.13+commit.abaa5c0e, Optimizer runs: 200].",384
579,foundry-support.txt,"Command used for verification: forge verify-contract --chain-id 42 --num-of-optimizations 200 --compiler-version v0.8.13+commit.abaa5c0e 0x3377ca7cbad67eb6700e0bc4c05ff83bf2e11a34 src/SimpleNameRegister.sol:SimpleNameRegister I5CK8CJ7FZ6BWQ6YGFD4U3E7CFTNWQJ3A3 where, Contract address: 0x3377ca7cbad67eb6700e0bc4c05ff83bf2e11a34 Etherscan token: I5CK8CJ7FZ6BWQ6YGFD4U3E7CFTNWQJ3A3 ::Verification failed:: Contract verification failed: Response: NOTOK Details: Fail - Unable to verify I used compiler-version v0.8.13+commit.abaa5c0e and 200 for optimizer runs when manually verifying, so I don't believe the error to related to either flags I don't suppose there are any gotchas with regards to using a windows system? Nooooooo Not even close my guy https://github.com/dapphub/dapptools/blob/master/src/hevm/README.md Ganache simulates a network, hevm simulates the EVM thats like the difference between JSON RPC and Solidity Contracts Ganache has ethereumjs-vm , if you modified that you can start getting closer to how hevm works (cheatcodes not symbolic exec) Hi all fellow devs! I have a use case where I need to build a set of contracts with forge but deploying/verifying them at a later date with a different stack. Is there a way to generate at build time the artifacts that I would later need for verify, possibily compatible with ""standard-json-input""? Thanks! ye checkout forge-std/stdlib.sol it has stdError and gives u all builtin panics like overflow If forge build is used With different optimize runs, shouldnt it create different sizes? depends on your contract and number of runs—there may not be much to optimize, and you get diminishing returns as you increase optimizer runs really high, both of which could result in identical code for different optimizer runs But shouldnt it recompile when optimize use different number of runs? Somehow i have the feeling optimizer does not work for me..",499
580,foundry-support.txt,"forge build contractname --optimize --optimize-runs numofruns that info should be included in the cache, can you please check the settings object there Hey guys for (uint256 i = 0; i < 3; ++i) { emit log_named_uint( string(abi.encodePacked(""Winner "", i, ""Balance"")) , lottery.winners(i).balance ); } I'm trying to log the balances of the addresses in an array with log_named_uint and make it so the index of each address shows when i log it but it does not work It gives me instead WinnerBalance: 79228162513264337593543950335 WinnerBalance: 0 WinnerBalance: 0 ignoring the ""i"" in string(abi.encodePacked(""Winner "", i, ""Balance"")) Hey all, what is the best way to go about installing contract dependencies in a monorepo that separately depend on node_modules? Repo: https://github.com/superfluid-finance/protocol-monorepo Directory for contracts: ./packages/ethereum-contracts/ Depends on OpenZeppelin contracts in node_modules. --- There are mentions of hardhat/node_modules compatibility in the foundry book, but I'm not finding much in terms of how to set this up. Can I just add a package.json and npm install deps to an existing project created with forge init _? Thank you. Will check it out Apologies for cross-post to discord, but looks like this group is more active - is there a foundry equivalent of hardhat_reset ? has anyone seen tar: Error opening archive: Unrecognized archive format from running foundryup? ive never had this problem before sorry just searched the chat - i see the solution if you install deps with npm you can set forge to also include those using foundry.toml by adding node_modules to the libs part: https://book.getfoundry.sh/reference/config.html#libs not currently, there's an open issue discussing it but it's hard to implement - whats ur use case for it? its some weird thing with solidity, i dont exactly recall - u probably need to use a utility function that converts a uint to a string (e.g.",442
581,foundry-support.txt,"openzeppelin's strings library) update foundryup, same for u Tyler can u try with --flatten? (i think thats the flag at least) Thanks @onbjerg, do you know how to fix this? Or will an updated forge fix this? forge deps are managed using submodules and git wont update your submodules if your working directory is not clean - either commit your changes, discard them or stash them (`git stash` and after updating you can do git stash pop to get your changes back) I'll have to check when I get back to my computer but all my files were commited, it was saying there were modifications inside the deps, but I didn't make them. Unless I just need to commit the lib/ and somehow didn't.. you might have accidentally changed a file inside of the deps without knowing, not sure. if thats the case you can do git submodule update --force i think It's doing it for every single file in lib/ I'll try your suggestions tho and come back when I'm actually at my terminal, thanks! Dude, you're the best. Thanks man I'm doing some research on nonstandard erc20 tokens, and I'm trying to simulate transactions on the tokens.",249
582,foundry-support.txt,"in setUp) and just pretend that its weth sec let me find u something since its uniswap ah, just use a mock of a ERC20 or something thanks! yea oh nice, i can do that thank you! if ur interested in some foundry tests for uniswap itself check this repo: https://github.com/gakonst/v3-periphery-foundry/tree/main/contracts/foundry-tests maybe there are some ideas u can reuse 🙂 oh nice, yeah these will be great reference, tyvm Does anyone know if Forge can flatten vyper contracts? it cannot vyper support is wip but its a longer term project because it requires some new abstractions and some restructuring of the existing code OK just cause I've started aping into it But understand, it's not priority stuff 🙂 yo guys, I want to decode the return input from getReserves() Is there any straightforward way to to it with cast? This seemed to have worked, wonder why regular update wasn't working I've been trying cast --abi-decode uint112,uint112,uint32 0x000000.. nvm got it to work with cast --abi-decode 'getReserves() public view returns (uint112 _reserve0, uint112 _reserve1, uint32 _blockTimestampLast)' 0000000000000000000000000... (: Actually some deps still didn't update...should I just delete them and reinstall? `cast --abi-decode 'getReserves()(uint112, uint112, uint32)' also works fyi you need to make sure the deps working trees are clean. you can try to go into the directory of the dependency and run git status - if its unclean, do git reset --hard HEAD given they are not changes in the dependency that you want to keep of course Yeah I didn't make any changes.",379
583,foundry-support.txt,"Even ds-test is having issues HEAD detached at 2c7dbcc nothing to commit, working tree clean did you install dstest at a specific commit you're not on a specific branch Nope, this is from forge init forge init checks out master, so it should not be in a detached state i would just reinstall the deps rm -rf the folders or is there a more proper way? forge remove path/to/dep Thanks, hopefully this is just a one time thing :) WETH9 is not entirely erc20 compliant yes trust me nuke the submodules and just start clean yea if you have screwed up git modules w/o being comfortable with fixing it via git i think nuking and retrying is best you will have to submodules deinit Then remove the modules dir in .git/ also, is it possible to explicitly set a compiler cache directory Yo guys, is it possible to debug/trace a transaction with foundry? a tx from a live network? if so coming very soon thanks to @joshiedo, you can try it out now with foundryup -P 1358 https://github.com/foundry-rs/foundry/pull/1358 anyone played around much yet w via-ir: true ? don't .. think it's working for me? sorry to be clear, foundry is indeed building the contracts but they go from passing the tests to producing some failures that i'm not yet able to reason about other than ""maybe via-ir doesn't work with something i'm doing"" (tho using solc 0.8.13 so believe it was taken off experimental status) gonna reread the sol lang docs page on it to see if i can figure this out ig really cool! also the compiling via-ir is...",364
584,foundry-support.txt,"v slow (but guessing that's a solc thing) can't seem to get console or console2 from forge-std to appear in the trace (with or without `via-ir`) is it possible to only apply via-ir to some contract builds? wondering if there's some optimization that's messing up the warp cheat code what appears to be happening: i save down block.timestamp into memory at the beginning of the fn; then i warp & later reference it but the reference appears to have warped fwd i think maybe the via-ir optimizer is trying to save me gas by assuming a block.timestamp saved to memory is a waste of gas & just pulling it directly each time its referenced? is there a foundry exntension that will log out the opcodes for my tests? going to open up an issue try --debug when running a specific test forge test -c contract -m specifTest --debug ? ye Compiling... No files changed, compilation skipped Running 1 test for test:test [PASS] test() (gas: 1221818) no outputs, maybe -vvv too? are you on latest version? forge —version / foundryup ah possibly not, i havent updated in a couple weeks fuck tar error, probably m1 issue I gotta fix first https://github.com/foundry-rs/foundry/issues/1365 nah just gotta update foundryup ohhh fancy fancy a little boggled why cacheing calldata (initially thought it was mem) in mem is cheaper than accessing the calldata directly this is gonna be helpful lol hehe nice I'm on the latest version of foundry (built from source) on Macbook M1. When I run forge test -m test/Test.t.sol, aka running the tests in Test.t.sol, I get the following message: [⠢] Compiling... No files changed, compilation skipped When I run the normal forge test command, everything executes fine.",398
585,foundry-support.txt,"What am I missing here? They currently don’t show up in the traces, intentionally, but they will after https://github.com/foundry-rs/foundry/pull/1367 -m matches the test function name and (afaik) is deprecated, u probably want --match-patch (-mp for short?) Cheya Bro where have you been Traveling in Portugal with no service :’) I’ve missed so much apparently LOL Biggest change: new logo Other than that, nm yup, included in the tests but fuzzing test failed with stdlib error standalone test with stdlib: passed when forge build installs solc, where is the solc installed? https://github.com/foundry-rs/foundry/issues/1374 also didnt see multiple console.log output with fuzzing? erc20 mint without assert - 29639 (marked with yellow) erc20 mint with assert - 27639 (marked red) can explain, why diff gas for the same implementation erc20 mint fn?? with and without assert ? is it so difficult to take a screenshot? it’s ok 🙂 we prefer screenshots but maybe they dont have telegram on their computer for any reason There is always a web version but screenshot is clear They would be, but your pics aren't) let’s not argue about screenshots or not..",269
586,foundry-support.txt,"The panic message is ""No Target Contract"" and the back trace points here: https://github.com/foundry-rs/foundry/blob/36a66c857ff148f6ed007cdcd3402077de3595cf/utils/src/lib.rs#L217 ^ I've added the 'file_path:lib_name:addr' bit to the foundry.toml file as well, where 'addr' is the address I tried etching to. Ended up using this workaround for now // use impl to find the storage slot uint256 slot = stdstore  .target(address(handlerImpl))  .sig(handlerImpl.methodA.selector)  .with_key(id)  .find(); // update the proxy storage  vm.store(address(handler), bytes32(slot), bytes32(value)); Hi everyone, I have been successful using the cheatcodes.sign to test a function using eip712, but I have a other function that take in a full signature (bytes) instead of a split signature. So how can I generate a unsplit signature or how can I take the v,r,s and get the unsplit? Thank you :) You can do concatenation Abi.encode them in order You can see the exact order of the values in the ecdsa library of open zeppelin So you create a bytes array of length 68 Thank you very much 🙏 i recentrly downloaded foundry and whenever i create a project i have no git moduls? is this normal or am i doing something wrong only the test contract itself is called by 0x00a329c0648769a73afac7f9381e08fb43dbea72, contracts called by the test contract will always be called by the test contract's address :) your git modules are in lib and you can see that ds-test was added. if you mean the .gitmodules file i'm sure it's there, it's probably just hidden by your editor. try cat .gitmodules in your project folder cat .gitmodules ? I just installed from GitHub n everything went smoothly, downloaded to lib but still cant see gitmodules to confirm it was added @gakonst I want to PR the foundry book on How to test in foundry in existing hardhat project. What would be the right approach? I am thinking of demoing using another repo, Write all the steps I followed to make the tests working.",490
587,foundry-support.txt,"So, Foundry.toml configuration => make a new foundry tests folder=> and then some demo test. What else should I do to make it better? Thanks That sounds good! 🔥 see this issue: https://github.com/foundry-rs/book/issues/103 i'm not sure i understand - you're saying there are no git submodules? if you open the hidden file called .gitmodules in your project folder, you should see that lib/ds-test is in fact a submodule and i'm not sure what u mean by installed from github, can u elaborate? what did u install from github? He installed a template There is a makefile and default.nix i would say its perhaps a template for migrating from dapp tools to foundry he clicked the button on github where it says “use template” those are in lib/ds-test, also i don't think he installed from a template, there is no top-level readme and the structure exactly matches forge init I'm looking into this to test specific reverts, but could use a little more hand holding. I'm new to cheats 🙏 I have a line: cheats.expectRevert(  abi.encodeWithSelector(Pool.InsufficientAllowance.selector,0,pay1Asset) ); but cheats is an undeclared identifier. How do I declare cheats? 🤦‍♂️ hey! so, if you use DSTest, you would first add this interface somewhere: https://book.getfoundry.sh/cheatcodes/index.html#cheatcodes-interface then in your test, you would create a constant like so: CheatCodes constant cheats = CheatCodes(HEVM_ADDRESS); also, you're not using the cheatcode correctly: it only takes 1 argument. see the examples here (the 3rd one is what you want): https://book.getfoundry.sh/cheatcodes/expect-revert.html#examples (HEVM_ADDRESS is from DSTest) Thanks Oliver.",404
588,foundry-support.txt,"Will give it a shot (and I was missing the abi.encodeWithSelector 🤦‍♂️) i'd suggest checking out forge-std https://github.com/foundry-rs/forge-std import it to the contract (instead of ds-test`), then have your test contract inherit `Test (instead of ds-test`) and then you can just use `vm.expectRevert Got it to work! Thanks again 😊🙌 forge-std definitely looks like something I should check out, but I want to cut my teeth on this a little more for learning 🙏 rip Thanks man, I did not know that Hi! I'm trying to supress solc warnings for contract size for my tests. Is there a known way of doing that? I couldn't find a list of solc error codes to put in my foundry.toml https://github.com/foundry-rs/foundry/pull/399 looked at this issue and searched gh for foundry.toml ignored_error_codes to see if anyone else found success and couldn't find anything great Warning: Contract code size is 70799 bytes and exceeds 24576 bytes (a limit introduced in Spurious Dragon). This contract may not be deployable on mainnet. Consider enabling the optimizer (with a low ""runs"" value!), turning off revert strings, or using libraries. ^ is the specific warning i'm trying to suppress if anyone happens to know the error code to ignore Is it possible to do Solc standard JSON input for verifications? That’s the default now What’s the error code for this error? Ok great cause I just cannot get hardhat to verify with fantom. Now need to try forge Different network have different quirks, if you have trouble with that please open an issue and we can have a look Hey guys, question on building state in tests using inheritance. When my child test contract is executed, the tests from the parent contract are also executed within it - which means they fail since the state has changed.",413
589,foundry-support.txt,"How do i prevent the parent test functions from being executed within the child test contract? forge verify-contract --chain-id 250 --compiler-version ""0.8.9+commit.e5eed63a"" --optimizer-runs 200 0x688a7559a1cBaA850d6993CEaf3CeB59839d4407 contracts/Greeter.sol:Greeter KEY_HERE Thought I might just note that i've not been able to verify a contract with Forge, I am not sure if there is something I am doing wrong, but different code bases, different API keys, not been successful yet 🙃 same issue as well you using windows by any chance? I tried everything, at this point i reckon it could be a windows thing, since my friend could verify my repo with his linux environment Good old fashioned OSX And trust me, I've tried every flavour of combination and doc, aswell as what I asked the other day, the only reason could be that I am stupid at this point This is definitely a parsing issue What chain is that? Fantom Oh that’s fantom Mind opening an issue preferably with a repro so we can have a look Give away my code base the next UNISWAP? Never! Yeah, sure. 🙂 What I think is happening here is that the response is slightly different which trips up the json parser Thanks DW too much about it, it fails manual and it also fails hardhat, pretty sure it's etherscan itself, different code bases have been tried btw Interesting Does etherscan support manual verification for fantom? I mean on the website, ftmscan.com etc Oh right that’s separate Then that makes sense that there’s a parsing issue Will have a look I am just doing a hardhat run to see too Might not be you, might just be fantom, let me try bsc whats ur forge version? also you need to add ""v"" in front of the compiler version here One moment it has to match a version on here *exactly*: https://ftmscan.com/solcversions Just to answer that first, added V same thing.",435
590,foundry-support.txt,"forge 0.2.0 (a84a281 2022-04-16T00:15:54.385011+00:00) also I think it's --num-of-optimizations, not --optimizer-runs :D Ok let me do that Did you mean '--num-of-optimizations'? It says this, then same dice BRB trying BNB so when you pass --num-of-optimizations it says ""Did you mean"" the exact same flag? No dice on BNB, think was the same the other day too seems like a node issue given it can't find the code is it the correct address? I just did a deploy using the same RPC, 1 minute before the verification if that helps yeah, I said --num-of-optimizations not --number-of-optimizations Silly me, but yeah I have num now, get that reply from BNB and fantom? Fantom gives the complete red throw, BNB the NOTOK thing, was the same the other day, sadly I cannot tell you why 🙁 i think u should open up an issue, preferably with an example we can try to deploy that you cannot out of curiosity - are u on windows? if so, can you try to add --flatten to the verify command I am on M1 max latest OSX I use forge flatten everyday to do the manual verifications not sure, seems like their api is slightly different somehow but there are no docs on their version of etherscan, so it's hard to tell Yeah, dw too much about it, I can keep testing then document an issue something if I pick up what it is. Yes their API is different as Aurora was also different. It's a bad API.",355
591,foundry-support.txt,"Setting --gas-price 100000000000 with forge test doesn't seem to change tx.gasprice in the contract, anyone have any idea why? ah i think someone else reported this but didn’t get opened as a bug so wasn’t fixed can you open an issue? cc @mattsse it was opened afaik https://github.com/foundry-rs/foundry/issues/1143 if this is the same ack Will fix ah okay just hasn’t been tackled ye was low prio since the use case is very limited imo but feel free to tackle It is limited but I'm sure I'm not the only one that used tx.gasprice to do some on-chain calculation Either way noting urgent from my side, just playing around with foundry on the codebase I mainly test with hh Really good experience so far, gj to people involved 👏 didn't work for me. (Using a windows 10 64bit machine) tried both when deploying to kovan: 1) forge verify-contract --chain-id 42 --compiler-version v0.8.13+commit.abaa5c0e 0xafe5686bafef35a9678d1470727d0371bfe300de src/SimpleNameRegister.sol:SimpleNameRegister I5CK8CJ7FZ6BWQ6YGFD4U3E7CFTNWQJ3A3 --flatten 2) forge verify-contract --chain-id 42 --compiler-version v0.8.13+commit.abaa5c0e 0xafe5686bafef35a9678d1470727d0371bfe300de src/SimpleNameRegister.sol:SimpleNameRegister I5CK8CJ7FZ6BWQ6YGFD4U3E7CFTNWQJ3A3 --flatten --num-of-optimizations 200 GM Sirs Quick question: would it be possible to use Foundry to run a local chain, forking Mainnet and deploying some local contracts? I find it super-easy to write the local deployment in Solidity instead of a bunch of JS and TS you might be intrested in this https://github.com/foundry-rs/foundry/pull/1037 deployment is also wip https://github.com/foundry-rs/foundry/pull/1208 and here is the scripting PR.",499
592,foundry-support.txt,"i’ve gotten it to mvp stage, and had a script (which included a deployment) run on live testnets i’ve also used it in combination with matts PR linked above Amazing, thanks everybody I thought chain id was string hmmm did not immediately find an issue on gh I'll be making one, would you recon it fits more under forge or under cast? great, ty! fits more under forge it's both, --chain-id is now an alias for chain we support (most) chains by their name not sure if fantom is included, if not please open an issue Hi, is the goal of foundry for framework users to do all their coding in solidity? Or is it also intended to be used as a rust library? I’m trying to evaluate using the framework and I’m curious about the long term direction Hi does hevm.sign produce the same cryptographic signature that metamask's eth_signTypedData_v4's uses? (https://docs.metamask.io/guide/signing-data.html#sign-typed-data-v4) I'm having a bit of trouble replicating a signature produced with metamask using foundry. Any differences I should be aware of or any documentation I should read? Much appreciated! how would you guys go about emit a test log of type int24 ? feel like the conversion of all these types to log is a bit of a hindrance while developing Hey all! Wondering if there is a way for the forge create ... --constructor-args to accept an array argument for the constructor. Anyone have any tips? i ran into this issue too but i wrote a small lib for it for my use case at least...but it should work for yours too the issue isn't with the sign cheatcode its with your message hash i think it'll be better if you checked the lib can't really share code here...it isn't on gh too can i send via dm? yes please! my handle is @jeremytwei not 100% sure but I suspect ""[..,..]"" could work? Thanks - Nevermind. Just needed to update Foundry ofc lol 😅 is there a way to inject data from env variable into foundry testing? Yeah.",448
593,foundry-support.txt,"I didn't see any specific error codes in the output from forge build what's a quick and easy way to find address of the test contract that is currently running, the address that shows up as msg.sender from the point of view of the called contracts or even better can I set which address that should be? right, wanted to check this for another error as well and emit the error code which is not part of the default msg, will add Amazing! ty ty 🙏🏾 nvm i should use vm.prank I guess hey, I'm just trying to learn to use forge, but I keep getting errors when I try to run commands. Like forge init --force I get the error Error: ’init’ is not a Forge command. Run forge --help to see the full list of available commands. when I run version, it returns 4.0.0 @ZrowGz 4.0.0 doesn’t make sense for forge, that’s a different program entirely I was going to say this person is time traveling Yeah, that's what I thought... I tried finding what the heck could possibly be using it, but when I run help, I get reasonable results... what’s which forge output oh what the heck... /Users/zrowgz/.nvm/versions/node/v16.13.2/bin/forge @ZrowGz Atlassian has a Node based CLI called forge Used it in my web2 days.",296
594,foundry-support.txt,"Possible you have it installed? looks like it I'm only seeing things to uninstall atlassian apps, but not the atlassian forge itself can always just rm it Or should this do it: npm uninstall -g @forge/cli ye yeee awww yeeee boi lol @brockelmore simultaneously yee’ing 😂 this looks more reasonable for --version forge 0.2.0 (92427e7 2022-04-22T00:07:40.637242+00:00) when i use —fork-url with the test suite, do the transactions that i submit get 'mined' by the url that i'm forking from? no, your literally on a fork, read: remote, write: local 👍thanks hai, Is this implemented ? has anyone experienced vs code solidity extension red-underlining all imports with error message ""File import callback not supported"" and successfully fixed it in a way that plays nice with foundry? so far ive made sure my solidity extension is using right compiler version and ive also added the extension settings for packageDefaultDependenciesDirectory, packageDefaultDependenciesContractsDirectory and remappings to match up with my project. still no luck. and cmd+shift+P > Solidity: Compile All also gives me that same error for all imports even though forge build doesnt. i believe this is addressed in the foundry repos readme ah will check ABIs are fetched and used in traces, but not yet source code for debugging. ideally Etherscan will expose the info we need from their API, otherwise we have to compile all contracts which would be tedious but doable. @joshiedo might have more recent info here yeah, already was doing all of the recommended things. no idea why im still getting this issue It's working on cast run But not forge run and/or forge test I think There was a comment there alluding to waiting for something, so I thought there was a reasoning to be inactive there 🤔 I checked it's on forge test, but not forge run wait sorry what is on forge test but not forge run? using etherscan ABIs in traces? or for the debugger? Hey! did you ever get this working? running into same problem. Want to stick to monorepo structure if possible.",464
595,foundry-support.txt,"Yeah check GitHub.com/odyslam/monorepo Debugger still doesn’t work but haven’t found the time to debug great - thank you! this is a cool way to do this, nice the foundry.toml I see this is a fork of nomad's monorepo appraoach—did you make any changes, or just generalize it? mainly just wondering if these are two different monorepo approaches or mostly the same Hey I'm getting an odd issue when attempting to deploy using forge create `The application panicked (crashed). Message: failed to extract from provider: Error { tag: Tag(Default, 2), profile: Some(Profile(Uncased { string: ""default"" })), metadata: Some(Metadata { name: ""Backwards compat provider"", source: None, provide_location: Some(Location { file: ""config/src/lib.rs"", line: 807, col: 14 }), interpolater: }), path: [], kind: Message(""expected an equals, found an identifier at line 8 column 7""), prev: Some(Error { tag: Tag(Default, 2), profile: Some(Profile(Uncased { string: ""default"" })), metadata: Some(Metadata { name: ""Backwards compat provider"", source: None, provide_location: Some(Location { file: ""config/src/lib.rs"", line: 807, col: 14 }), interpolater: }), path: [], kind: Message(""expected an equals, found an identifier at line 8 column 7""), prev: None }) }` I'm passing in a valid RPC URL and pk Error is instant as well, doesn't take any time to process. Immediately responds. Ah, figured it out! If anyone has a similar issue, I had a broken foundry.toml file using etherscan ABIs in traces oh huh wonder why forge run doesnt have them by default https://github.com/foundry-rs/foundry/blob/92427e73b75e41c50d1d0afef85ae32454cd1cfe/cli/src/cmd/forge/run.rs#L164 im not sure i understand either hi can i set the submodule path for forge update you mean update a particular dependency? the default path is under lib how can i set it to other folder.",468
596,foundry-support.txt,"so that the packages are downloaded in other folder you could use git manually but it’s not supported by forge update right now ok thank! i will just use git to set the paths manually Hello! @ any other VS Code users, is there a handy way to get Juan Blanco's extension to use 120 print width without setting up my repo to also be an npm package? I keep hitting auto format and it reduces lines to 80 chars. I know I can setup prettier etc. but I'd really rather leave JS/TS out of this repo. I did also try having a .solhint.json file in my root and that doesn't seem to take affect either. Or, do we need to wait for forge fmt? 😄 Thanks! How do I pass solc version as a command line argument when doing forge init? I tried using export FOUNDRY_SOLC_VERSION=0.6.6 But when I did forge init, the project still is using 0.8.10 oh I believe this is missing, try FOUNDRY_SOLC, alternatively forge test --use 0.6.6 should work thanks for raising, this var will be added as an additional alias Anyone experienced something like this? I use vm.getCode to load bytecode from the abi and deploy it. However, sometimes bytecode at the deployed address is 0. Sometimes it works though. Oh.. seems like bytecode in the abi is literally empty.. 🤔 Ok, I found out. It is because I have a contract and interface with the same name. So sometimes interface’s abi gen after contract’s abi so it get replaced. do you know why i got this error? while trying to fork that’s an invalid rpc url you have to have a project id at the end of the infura http what is a project id? im a newbie yeah i used a bsc url and it worked infura rpcs have an id in the end. it's not a generic RPC for everyone $INFURA/30493249adfgadfg that you need to sign up for https://docs.infura.io/infura/getting-started oh okay thx can someone help me understand: what’s up check out how 2s complement works with forge do u can fork a blockchain like u do with truffle cli ? yes. recommend working thru the foundry book (see pinned comment) okay my bad. and thanks.",492
597,foundry-support.txt,"👋 hello sers, I was wondering whether the cheatcode expectCall is ""watching"" for staticCalls as-well or only call/delegatecall etc I am trying to ""expect"" a static call to a contract for `supportsInterface` but it does not seem to pick it up: `cheats.expectCall(mockToken, abi.encodeWithSignature('supportsInterface(bytes4)', 0x01ffc9a7));` I've traced the execution and it indeed called the mockToken with the specified calldata can you post the trace? shouldn’t be filtered out iirc can you screenshot for me the actual expect is: `cheats.expectCall(mockERC4400, abi.encodeWithSignature('supportsInterface(bytes4)', 0x2a55205a));` and in the sol file I am testing, I am calling: `bool hasRoyalties = token.supportsInterface(NFT_ROYALTY_INTERFACE_ID);` where `NFT_ROYALTY_INTERFACE_ID` is `0x2a55205a` and it still fails https://github.com/sambacha/foundry-scripts/blob/master/justfile https://web3js.readthedocs.io/en/v1.7.3/web3-utils.html#totwoscomplement Is there something special to set to set the optimizer runs on build command? I use forge build --optimize --optimize-runs xx But in cache it stills defaults to 200 Also tried with --force and deleting cache.. but same thanks for raising, can confirm, fixing rn Thank you hahaha Was trying everything oops we renamed var @onbjerg putting optimizer_runs = xx in the toml should work though, but cli will be fixed Ok thx! Yes working. Thx! Thank you very much 🙏 do you know why my remapping are with backslashes with the wrong direction ? who i think cause me an error of import. i already tried to create a remapping.txt as said the foundry book in the file root without success. hey! im working with the v3-periphery contracts (installed as submodule) & was running into issues when importing contracts as the submodule’s contracts’ dependencies are not resolving correctly.",450
598,foundry-support.txt,"I'm trying to use https://github.com/gakonst/ethers-rs/blob/master/examples/watch_blocks.rs, but I'm getting failed to resolve: use of undeclared type `Ws not found in this scope`. Did that get moved somewhere? better asked in https://t.me/ethers_rs :) @gakonst the image at ghcr.io/gakonst/foundry got (re)moved? ahh got it working again, solved Don't know how but I have opened a repo having some forge tests and the tests are now showing remappings error of all the openzeppelin files.Earlier it was working and I have double checked the remappings , but the errors are not going away. I have tried forge clean I have opened the repo after like 15 days is it expected that a test will exit post vm.expectRevert? e.g. execution will stop after the revert is registered, this would mean testing at most one revert per test? assuming this is because foundry can't continue the test with potentially invalid state? Might be a bug due to console log usage this test also passes had to do some wonky remappings for dependencies of submodules You have to npm install you can’t resolve dependencies without installing them via NPM wait whaaaaaaaaaat someone is using weth10 👍 Is there a foundry discord server? Yo @onbjerg and @mattsse sorry for delay re: dynamic linking https://github.com/foundry-rs/foundry/issues/1338 forge config is outputting correctly and ye ChainlinkTWAP is a library is there a way I can see which solidity file it is complaining about? could you attach the cache file to the issue? bytecode not necessarily required uploaded there now thanks, checking Is it possible to link an external library in a testing environment without forking a public network where the library is already deployed? i think so, but if you think it’s not, can you expand a bit on how your project is set up? I think I might have found a fix for now.",422
599,foundry-support.txt,"The project layout is as forge init <name> generates it, here is the src/ layout src ├── MyContract.sol ├── MyLibrary.sol └── test └── MyContract.t.sol In my foundry.toml file, I had: [default] src = 'src' out = 'out' libs = ['lib'] libraries = [  'src/MyContract.sol:MyLibrary:0x0101010101010101010101010101010101010101' ] Then in the test I used the Vm.sol to etch the library's bytecode into 0x0101010101010101010101010101010101010101.   vm.etch(    address(0x0101010101010101010101010101010101010101),    bytes(     hex""_placeholder_""    )   ); Running forge test with this setup, I would get a panick: The application panicked (crashed). Message: No target contract Location: utils/src/lib.rs:113 The backtrace pointed to the function that recursively links libraries to contracts in forge. --- However, I tried also running: forge test --libraries src/MyContract.sol:MyLibrary:0x0101010101010101010101010101010101010101 And since then, I have not gotten the panick, even when I subsequently just run forge test. Very odd. --- Now that I've run it with the --libraries command, I am unable to reproduce the panick, but if I manage to in the future, I'll look more into the forge source code and open an issue as appropriate. yeah thank you, mind putting this in an issue if ti keeps happening? hey all might have missed a change, but foundryup is still the way to update forge? trying to update, and getting this weird error w tar format Update foundryup curl -L https://foundry.paradigm.xyz | bash it will update you to the latest foundry up script and fix the issue for you ty, that was it im having trouble with expectRevert when what im expecting is a declared solidity error statement. I believe what's making it tricky is that I'm testing a contract i wrote, which is a contract that it imports, and that imported contract declares error statements outside of the contract. quick example: contract A is ERC721AUpgradeable.",484
600,foundry-support.txt,"in ERC721AUpgradeable.sol, error TransferCallerNotOwnerNorApproved(); is declared above (outside of) contract ERC721AUpgradeable. this is the error im getting: Error:  0: Compiler run failed  TypeError: Member ""TransferCallerNotOwnerNorApproved"" not found or not visible after argument-dependent lookup in contract ERC721Drop.   --> /Users/james/zora/zora-drops-contracts/contracts/test/ERC721Drop.t.sol:419:25:   |  419 |   vm.expectRevert(zoraNFTBase.TransferCallerNotOwnerNorApproved);   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ when I import the error and pass it in directly like vm.expectRevert(TransferCallerNotOwnerNorApproved), i then get Member ""expectRevert"" not found or not visible after argument-dependent lookup in contract Vm hey can you try: `vm.expectRevert(TransferCallerNotOwnerNorApproved.selector)` @wminshew worked! gigabullish 0xsplits 👀 Hello sers, i have a question in regards to FFI, I need to test a contract that receives quotes from the 0x api, which i fetch using a JS file, how do i pass these values over to a test in foundry using FFI? You log the output abi encoded to stdout Without newline Thanks! Not sure tho how to abi encode the API response, I was reading this file https://github.com/gakonst/lootloose/blob/master/scripts/metadata.js , i have to create an ABI for the structure of the response json? and then the stdout should also be process.stout.write(""0x"" + encoded.slice(10))? maybe there’s an easier way to abi encode just a bunch of types but that’s the one i used at the time I'll look into it, thanks a lot! Is it possible to generate private keys from a mnemonic in forge tests? is there a standard practice for ensuring the address that deploys the contract in testing is the same as the address that calls functions in tests? I'm also looking for a way to generate a signTypedData signature in my tests.",452
601,foundry-support.txt,"Any chance I can see your library? oh looks like this can do what I'm looking for https://github.com/Nipol/bean-contracts/blob/main/contracts/library/EIP712.sol Does your data involve a DOMAIN_TYPEHASH() yes - I think that library I linked to should work Awesome I think you can just use the normal sign cheatcode @jeremytwei did the exact same thing Great tool btw, much appreciate the work. New to ethdev, for developing locally - deploying to local ethereum and signing txs from metamask - is there support from foundry? I see there the usual approach is forking mainnet into a local hardhat node and forge create a contract to it. I see on github that devs are removing dependency on hardhat, but I am not sure what devs now do to run a local ethereum node with just foundry. https://github.com/abigger87/femplate/commit/17031b0bdc07734fcf76cbba9c23e095aa19ace3#diff-76ed074a9305c04054cdebb9e9aad2d818052b07091de1f20cad0bbac34ffb52L28 ty https://github.com/foundry-rs/foundry/pull/1037 my bad found it by ctrl-f - there is work in progress to make it are they any metrics/resources that point to differences in forking performance between hardhat and foundry? Has anyone run a stress test on hardhat forking? https://github.com/mds1/convex-shutdown-simulation check here Hi guys, I am writing a guide to migrate hardhat to foundry, which repo would you want me to convert and write the article on it? https://github.com/foundry-rs/book/ here please! With console.logBytes, bytes data is printed on console in this form : Bytes(b""\xac\x96P\xd8\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0""). How we can print it in hex form? hi i get an error when compile by forge. ❯ forge build [⠢] Compiling...",495
602,foundry-support.txt,"[⠆] Compiling 21 files with 0.8.13 [⠔] Solc finished in 1.07s Error: 0: Compiler run failed CompilerError: Stack too deep when compiling inline assembly: Variable pos is 3 slot(s) too deep inside the stack. how i can solve this pr, guys? i can't solve this even by forge build --optimize. Do you get it with hardhat? no with forge hey I'm trying to use the cast interface command, is this the right way? `cast interface ""./out/ERC20.sol/ERC20.json"". @odyslam since you implemented this @sushivj yeah that sounds about right I remember it auto detected if it was etherscan or local fei I usually solved it by changing my code split functions into multiple ones etd I'm getting this error: if i try a different path like this, I think it thinks it's etherscan Yeah it tries etherscan because the file doesn’t exist basically it tests if the string is a valid path to a valid file that is Can you share the abi? I knw that we don’t fully support abi v2 but it should work it's solmate's ERC20 This might sound dumb, but with the data=true field, what are we checking exactly? to reproduce: install solmate and import ERC20, build and check Can you open a GH issue with the abi so I can debug. it’s hard to do it without testing it mysef also to keep track of it can you quickly check it out locally? before i open an issue, maybe something stupid on my part all the non-indexed params that get emitted But it passed with hh. interesting, I beleive @wilsoncusack had a similar issue that I wasn't able to pin down, could you perhaps share the solc settings of the hh cache file and open an issue, ideally with a way to reproduce this? ah, so the 3 bools are for indexed. Didn’t know that you ca have up to 3 indexed fields in an event interesitng Thanks Matt <2 no problem! for more details: https://book.getfoundry.sh/forge/cheatcodes.html i wrote the expectEmit part 😅 duh, how did I miss this.",475
603,foundry-support.txt,"Thanks @bblanc42 🙂 your cast interface is failing because the path you are specifying starts at the root of your drive you are specifying /out/, you probably want ./out/? it passed with --via-ir parameter. this should not be the case anymore, is forge up to date? I'm having a weird issue with expectRevert: when I comment out expectRevert in the above test then the test fails with the correct error being thrown, and when I add expectRevert for that same error, it throws ""Call did not revert as expected"". I've just started using foundry so I'm unsure how to debug this sort of behaviour. I'm using forge 0.2.0 and solidity 0.8.13 I have expectRevert() in another test in the same file and there it works as expected interesitng - this shouldn’t be happening, which date is forge from? forge —version forge 0.2.0 (5490c4a 2022-04-25T00:08:36.009305+00:00) Thanks, After update its working. Hi foundry community I am having issue when I run forge build. It returns error message belon on picture. Can someone help me please? pls share an example repo which reproduces the issue or provide more context if possible 🙂 Just use the default mnemonic hardhat uses How? Is it possible to get the private keys within the forge tests, like for creating signatures? You can use vm.sign to sign with any arbitrary privkey And generate accounts with any privkey of choice with vm.addr Ok thanks 🙏 For fuzzing, can I set a max value for the entire contract instead of requiring using assume? For example I have a test that mints ERC20 tokens, and I don't want the fuzz value to go above this for any tests as it will try to transfer more tokens than accounts have requiring using assume for every test* anyone have any suggestion on how to trouble shoot this? is it because the underlying contracts are trying to import the same libs? Error:  0: Compiler run failed  DeclarationError: Identifier already declared.",442
604,foundry-support.txt,"  --> /Users/ericdavis/bin/maltIndex/test/MaltIndex.t.sol:21:1:   |  21 | import ""@maltprotocol/contracts/libraries/uniswap/UniswapV2Factory.sol"";   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^  Note: The previous declaration is here:  --> /Users/ericdavis/bin/maltIndex/lib/openzeppelin-contracts/contracts/token/ERC20/IERC20.sol:9:1:   |  9 | interface IERC20 {   | ^ (Relevant source part starts here and spans across multiple lines).    DeclarationError: Identifier already declared.   --> /Users/ericdavis/bin/maltIndex/test/MaltIndex.t.sol:21:1:   |  21 | import ""@maltprotocol/contracts/libraries/uniswap/UniswapV2Factory.sol"";   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^  Note: The previous declaration is here:   --> /Users/ericdavis/bin/maltIndex/lib/openzeppelin-contracts/contracts/utils/math/SafeMath.sol:16:1:   |  16 | library SafeMath {   | ^ (Relevant source part starts here and spans across multiple lines). is there any more context i can provide to help explain my issue? Redeclaring IERC20 and SafeMath twice by not using selective imports. Try using replacing those imports with import {X} from ""./Y.sol""; where X is the constant, library, interface, or contract you need and Y.sol is the file that it is declared. will do thanks! i think i found the root cause is the updated version of uniswapv2 we ported has all the OZ files locally so just need to sort out those imports yep that was it, thanks! but yay were finally compiling and writing tests! @onbjerg I tried that first, getting this error: hello, just wondering if its possible to use foundry, or one of its crates to interact with smart contracts via backend services similar to the way you can use the Golang ethclient package, and abigen. I didnt see anything in the documentation explicitly mentioning some sort of rpc client.",484
605,foundry-support.txt,"you're looking for cast https://github.com/foundry-rs/foundry/tree/master/cast ah yea i didnt realize that could be sued as a library as well. thanks Hey guys 👋 I got a couple of questions regarding a specific ""testing"" scenario So I'd like to create a specific testing setup, which requires me to deploy different contracts, which are using different Solidity versions, is this possible somehow? Also I'm not entirely sure about what is happening but I'm importing 2 contracts which are themselves inheriting from contracts that have the same name but different implementations, looks like the compiler is complaining about that :( you can also use ethers-rs directly https://github.com/gakonst/ethers-rs/ did anyone get to the bottom of this? Having the same issue. Version is today's ccdfd3a trying to use it with a custom error (did I dream or did previous versions allow me to catch the text in a require statement?) you can use for both the text and for errors did it work in the past and it broke now? can you open an issue with this repro? we’ll investigate Sirs, what am I doing wrong with console.log formatting? My code is console.log(""approve and createstream sigs: %s %s"", signatures[0], signatures[2]); and output is approve and createstream sigs: %s %s, approve(address,uint256), createStream(address,uint256,address,uint256,uint256) we dont support string formatting..no issue to track it either, so worth opening it oh I thought I saw it somewhere in the foundry book... alright, will open, thanks. yes, it worked previously (version 0.1), now I'm unable to get any custom errors or text errors to return correctly. Will open an issue. Thank you.",376
606,foundry-support.txt,"This is working for every other token, it might be due the different nature of weth vs other tokens Maybe due to the fact that it returns uint rather than uint256 Those are equivalent Hey so for some reason I'm getting this error when trying to deploy a contract with an external library: Dynamic linking not supported in create command - deploy the library contract first, then provide the address to link at compile time The issue is that I have already successfully deployed the library and when attempting to deploy the main contract my command looks like this: forge create ContractName —libraries path/to/lib.sol:LibName:0xaddress Any thoughts about what may be going wrong? Can anyone replicate this? this shoudl be working hmm, can you open an issue with a repro uint = uint256 so shouldnt be that - would help if you opened an issue with a repro as well It looks like it wanted the complete path to the library, it didn't work with any relative paths still something we should fix I can open up an issue later today yep sgtm thx! anyone have any ideas why my tests aren't running? Its like the test param in foundry.toml is getting ignored. (forge-tests is in the /protocol dir) Is forge test --force working by any chance? no same result hmm will try to reproduce this is weird, it looks like the toml isn't picked up and I see you're in the sub dir can you check that your settings are included if you run forge config in the protocol folder and its parent folder? Yep it prints out the settings. However I ended up putting the test dir inside of /contracts and have that working now. Thank you for taking a look! Hi Guys, has anything changed with regard to console.log? They no longer show up for me in tests. forge 0.2.0 (2df70d2 2022-04-17T00:06:12.199987310+00:00) personally have seen this before & iirc forge clean fixed it for me but ymmv nvm, I am a idiot.",429
607,foundry-support.txt,"I was calling a external contract by forking but thought it was local 🥸 isnt the path supposed to be to the contract that uses the library, not the library itself? also there is already an issue open for this, i thought it was just a one off though https://github.com/foundry-rs/foundry/issues/1338 Foundry Support Interesting, that may be the case but it worked the way I did it o wow, no ur correct however i dont think it should need the absolute path? For whatever reason that's the only way it worked running spells-mainnet at least used to work fine, and they dont use an absolute path what was the path relatively and absolutely? feel free to censor details or w/e, just curious on the structure That's interesting, I used both styles of relative paths too, both lib/src/Lib.sol and ./lib/src/Lib.sol didn't work but /home/me/dev/project/lib/src/Lib.sol did the trick thats weird, spells-mainnet uses the first format what platform are you on? I'm on linux ok so its not that either (open issue uses m1) @mattsse maybe u know if we changed something re: paths for libraries in the last ~2 weeks? it definitely used to be that you could use the first path format (`relative/path/to/Lib.sol`) since I ran spells-mainnet when we added forking to the REVM port, but it seems to not work anymore 🤔 hi guys how would you run multiple tests in separate files? Is the only through the —match-contract flag? wdym? by default, all test contracts are run and they can be in multiple files --match-contract is if u only want to run 1 specific test contract hmm it only seems to be running my first test file does your second test file have functions that start with test? you're totally right lol I forgot I commented it out thanks great! np 😄 Is there a way to run tests programmatically? As in, write a test that takes some arguments and then pass arguments via CLI or something. im not sure i understand the use case, but yeah, you can use forge run to run a specific function in a contract.",455
608,foundry-support.txt,"it will also run setUp, so it can run your tests as well however, if you write a test function that takes inputs, the fuzzer will provide inputs if you use forge test I want to provide foundry fork over REST api. Currently, I generate and recompile the contract based on the query. I was wondering if I could provide simulate tx data as function params of the test. any reason you wouldn't just use anvil? https://github.com/foundry-rs/foundry/pull/1037 Don’t know much about anvil. Will it require setting up a node? anvil is basically hardhat node but faster still a few things missing so it hasnt been merged yet Ah cool will take a closer look. I had an impression it’s more like erigon.",162
609,foundry-support.txt,"```// SPDX-License-Identifier: UNLICENSED pragma solidity ^0.8.13; import ""ds-test/test.sol""; interface Vm { function prank(address) external; function warp(uint256) external; } interface Dai { function balanceOf(address) external view returns (uint256); } contract ContractTest is DSTest { Vm vm = Vm(0x7cFA93148B0B13d88c1DcE8880bd4e175fb0DeDF); Dai dai = Dai(0x6B175474E89094C44Da98b954EedeAC495271d0F); address constant myAddress = ""FIXME your eth address""; address constant swapDai = 0x68b3465833fb72A70ecDF485E0e4C7bD8665Fc45; function testSwap() public { emit log_named_uint(""Current ether balance of myAddress"", myAddress.balance); emit log_named_uint(""Dai balance of myAddress before"", dai.balanceOf(myAddress)); bytes memory data = hex""FIXME COPIED FROM METAMASK""; vm.prank(myAddress); (bool sent, ) = address(swapDai).call{value: 1 ether}(data); require(sent, ""failed :(""); emit log_named_uint(""Dai balance of myAddress after"", dai.balanceOf(myAddress)); } }``` hey guys just trying out forge, anyone know why this is reverting? trying a basic uniswap swap ah cheatcode address wrong for one I'd assume it reverts because you are sending ""FIXME COPIED FROM METAMASK"" as the calldata? Unless this is just for copypasting purposes has anyone else seen this. its been a while since i foundry'd. i can't get my tests to run, but it seems like the files that contain them compile. forge test --fork-url http://127.0.0.1:8545 [⠢] Compiling... [⠒] Compiling 7 files with 0.8.10 [⠢] Solc finished in 1.00s try forge clean agh same result one file wasn't compiling, found it by just doing solc —input-file ""test.sol"" :) oh interesting, so a file wasnt compiling but forge said it was? well.. it didn't say it didn't..",498
610,foundry-support.txt,"i fixed that file but now forge test says this ha Error: 0: Compiler run failed  CompilerError: Stack too deep when compiling inline assembly: Variable value0 is 1 slot(s) too deep inside the stack. :O thats a solc error, try upping the optimizer runs weird, didnt seem to help. wish i knew what file it was are you using via-ir i'm not strangely it seems all my files compile individually ha looking ad this, this concers the --libraries argument, right? Hi! It seems like I cannot get a gas report for the constructor only without making any calls, right? i dont know why but we seem to get stack too deep errors in certain projects when they are not occuring otherwise (i have not seen this myself) Is there someway to specify to fork within config file? Or is cmd line fork-url mandatory? How can I catch an overflow/underflow in my tests? use vm.expectRevert and import the overflow error code from forge-std! I'm on Win WSL with the latest forge. I'm unable to verify even simple contracts on mumbai and kovan right now...Anyone else having issues? Unable means NOTOK / Fail - Unable to verify What is the exact command you are using? Is it working on Linux? forge verify-contract --chain-id 42 --compiler-version v0.8.13+commit.abaa5c0e <DEPLOYED-ADDR> --constructor-args 0x0000000000000000000000000000000000000000000000000000000000000064 src/HelloWorld.sol:HelloWorld <API-KEY> Don't have a Linux box around right now The contract btw // SPDX-License-Identifier: GPL-3.0-or-later pragma solidity ^0.8.13; contract HelloWorld {  uint256 public value;   constructor(uint256 _value) {   require(_value != 0);   value = _value;  } } I think I found the issue... removing bytecode_hash = ""none"" does the trick ah - yes. we made it work w/o it recently becasue there were issues now uses standard json It’s weird cuz I don’t think I changed my solidity files that have the assembly in them since I used foundry last I was wanting to use foundry with an existing repository that only uses hardhat.",490
611,foundry-support.txt,"Is there a way I can be in the project and then add foundry? Tried running forge init from within the correct directory, but it wasn’t ok with that not being an empty directory. Or could I initialize a new directory with forge init 'git@github…ssh path'? https://github.com/wighawag/template-ethereum-contracts you can use this repo as inspiration for a hardhat + forge implementation Hmm thank you, I think I got it. Although the existing project uses node modules to store the dependencies and foundry uses lib. Tried remapping it so that it would look in node modules, but when I reinstall ds-test it just recreates the lib directory. Maybe I didn’t change the settings right? Which would redirect where deps are installed? Hello! Is there any support for mockCall to allow the mocking of library functions? Haven't had luck making it work. I noticed https://github.com/foundry-rs/foundry/issues/432 in which internal calls are not mockable, but its not clear if a library call is considered internal, since they live at a seperate address. Figured this out - for any1 curious library functions marked internal use JUMP (same problem as issue 432) whereas public ones use DELEGATECALL and can be mocked. 👋. I recently downloaded foundry and keep getting ""Source ""ds-test/teset.sol"" not found: file import callback not supported"" and was wondering if anyone knew how to fix it it should be ds-test/test.sol thats what it is i just mistyped this error also pops up can you check that your artifacts folder is gitignored? i dont understand what your asking, sorry echo out/ >> .gitignore your artifacts output directory should be in your .gitignore I’m trying to integrate an existing repo that uses hardhat to work with foundry. So, the existing project uses node modules to store the dependencies and foundry uses lib. Tried remapping it so that it would look in node modules, but when I reinstall ds-test it just recreates the lib directory. Maybe I didn’t change the settings right? Which would redirect where deps are installed? Also, it is not seeing the dependencies stored in node_modules as being present. forge install’ed deps go to lib/, that’s how they should be npm deps go to node_modules Ah, so I'll just have to install them into both... like the @openzeppelin ..",497
612,foundry-support.txt,"I did set it up in the foundry.toml & created a remappings.txt to be certain, but no joy haha Why install into both? If you already have hardhat tests, you shouldnt need to use ds-test in them? And your openzeppelin installation for use in hardhat should be usable in forge as import @openzeppelin/contracts like normal I wouldn't want to install into both. But it doesn't recognize it: you dont need to use remappings.txt in latest forge are you in latest? I'll update to make sure yeah, no joy is foundry contract verification working now or still broken? should be working now is the repo open source? can you create a minimal repro? forge verify-contract --compiler-version 0.8.0 address src/contract.sol:contract API_KEY ? yes but you might need the long name for the compiler-version (e.g. v0.8.13+commit.abaa5c0e`); also don't forget `--num-of-optimizations and --chain-id (or maybe its just --chain now not sure) also my tests were all finally working w bytecode_hash = 'ipfs', not sure if it works without that still? haven't tested without it yet anywy Just sent you a dm :) 🙏 Thanks!! Hi, we are trying the new slither github action on our foundry repo and it's failing on FileNotFoundError: [Errno 2] No such file or directory: 'forge' https://github.com/ditto-lab/ditto/runs/6218097714?check_suite_focus=true PR: https://github.com/ditto-lab/ditto/pull/16/files any idea why? https://github.com/foundry-rs/forge-template/pull/49/files#diff-107e910e9f2ebfb9a741fa10b2aa7100cc1fc4f5f3aca2dfe78b905cbd73c0d2R30-R33 if i want to do an assert-not-equal is there some clever thing im not seeing with assertEq() or should i just use require()? thanks, tried it.",448
613,foundry-support.txt,"I think I am hitting this issue you created https://github.com/crytic/crytic-compile/issues/262 https://github.com/ditto-lab/ditto/runs/6218410249?check_suite_focus=true ERROR:CryticCompile:Unknown file: /home/runner/work/ditto/ditto/src/test/BidderWithEjector.sol Yeah unsure why. Have pinged the maintainers Ok, I'm being dumb but idk why exactly. I'm trying to use cask w/ ankr's public avax endpoint. (this should work right?) cast storage --rpc-url=https://rpc.ankr.com/avalanche-c 0x068e297e8FF74115C9E1C4b5B83B700FdA5aFdEB 0 gives me Error: 0: (code: -32000, message: rpc: service/method request ill-formed: ""eth_getStorageAt"", data: None) Does anyone know how to pass an array of addresses from a test file to JS land using ffi? I'm getting this same error, how did you solve it? Turned out to be an issue w/ ankr. Pokt's rpc works fine. Solidity: abi.encode(addr1, addr2) JS const { AbiCoder } = require(""@ethersproject/abi""); abiCoder = new AbiCoder(); const abiEncoded = abiCoder.encode([‘address[]’], [[addr1, addr2]); process.stdout.write(abiEncoded); TRACE rpc{method=""eth_getStorageAt"" params=""[\""0x068e297e8ff74115c9e1c4b5b83b700fda5afdeb\"",\""0x0000000000000000000000000000000000000000000000000000000000000000\"",\""latest\""]""} looks correct and given that this is an internal err, I'd say it's on their end Yeah, you're right. Pokt works fine. how did you get this trace? this was actually missing in cast: https://github.com/foundry-rs/foundry/pull/1446 -.- after this PR you can enable all ethers traces by prefixing cast with RUST_LOG=ethers=trace cast ... Did a forge create on goerli (chain id 5) [⠢] Compiling...",492
614,foundry-support.txt,"[⠰] Compiling 1 files with 0.8.13 [⠔] Solc finished in 78.13ms Compiler run successful I try to verify forge verify-contract --compiler-version v0.8.13+commit.abaa5c0e 0xaddress Contract.sol:Contract API_KEY --chain 5 but I keep getting back Contract verification failed: Response: `NOTOK` Details: `Fail - Unable to verify` Doing a ls ~/.svm gives me 0.5.17 0.8.10 0.8.12 0.8.13 so i believe its 0.8.13 but its still not verifying I suspect its a compiler version problem but with all this guessing its hard... checking the cache, the version is v0.8.13+commit.abaa5c0e so not quite sure what Im doing wrong for verification... pass —optimize-runs 200? will try, but curious why this would be necessary? because it’s not automatically picked up unfortunately, need to get that done and i assume you built/created with 200 optimizer runs Thanks! The problem is that the array is of variable lenght, and i'm still getting the nul byte error passed in --num-of-optimizations 200 fingers crossed sorry the screenshot is a bit messy, are you doing abi.encode(addrArray) then? oh my bad yes, i tried using that function but got the nul bytes Got it, can you please open an issue with a repro and we'll figure it out Sure hmm explicity passed in optimization runs for both forge create and forge verify-contract but still no luck...",344
615,foundry-support.txt,"Ill look into it more later :c kk pls open an issue if ti persists with the exact steps followed! will do ser! fyi, looks like scammers are trying to impersonate @gakonst in dms from this chat hey quickly following up here -- you made sure to set the bytecode metadata too on deploy & verification right? https://t.me/foundry_support/10374 this ( i believe the default is none which i think doesn't work w etherscan ) also triple check you're on the absolute latest version of foundry some fixes were merged as recently as last week iirc foundryup -b master guys watch out for @gakonst impersonators Had asked a question in chat, the scammer reached out via dm, with the correct technical answer and explanation - very convincing given the manner in which he handled the conversation. Ended up requesting 0.5 ETH for a ""reintegration process"" to assess use of vm.expectRevert for over/underflow after compilation in bytecode - some along those lines.",213
616,foundry-support.txt,"Anyone comfortable with vm store() ? I’d like to deal forked erc20s to my mocks Seems relatively simple but if there’s anything unexpected I need to know that would be cool I'm trying to deploy a contract that selfdestructs at construction but it keeps reverting why is this? // SPDX-License-Identifier: MIT pragma solidity ^0.8.10; contract ForceHack { constructor(address payable target) payable { require(msg.value > 0); selfdestruct(target); } } $ forge create src/Force/ForceHack.sol:ForceHack --rpc-url=$RPC_URL --private-key=$PRIVATE_KEY --constructor-args 0x4F609eD27d46B37E25bffB5E5C95EAE20E000000 --value 1wei Error: 0: (code: -32000, message: execution reverted, data: None) Location: cli/src/cmd/forge/create.rs:199 Thanks for flagging! Stay safe folks, ill never ask you for $ 🙂 check forge-std’s helper methods on tokens 🚀 is the address at 0x4f609 a contract? does it Have a payable fallback function? I obfuscated the target address here is a target address I just minted from ethernaut it still fails 0x412076657279207374726f6e67207365637265742070617373776f7264203a29 But works using remix which level is this again Level 7 force https://github.com/ciaranmcveigh5/ethernaut-x-foundry/tree/main/src/Force have you seen this / https://eval.hashnode.dev/ethernaut-x-foundry-0x0-hello-ethernaut Yes I have I'm using the repo currently. I think their is a limitation in foundry when deploying a contract that contains a selfdestruct function in the constructor.",386
617,foundry-support.txt,"What do you think? cast calldata “transfer(address[], uint256)”， how shoud I set params in address[] Hey guys! what is the proper way to assert for string value? function testExample() public {   console.log(aToken.name());   require(aToken.name() == tokenName);  } You need to hash it @satanworker generally, solidity doesn’t allow for string comparison aha got it, will dig in! thank you! actually, I think you need keccak256(abi.encodePacked(‘string’)) https://ethereum.stackexchange.com/questions/30912/how-to-compare-strings-in-solidity worked like a charm! 👍👍 Foundry support 🤝 responses within 5 minutes faster than my teammates 😄 Did you try passing multiple arguments separated by space? Or by comma? I forget how this is done, maybe it's in the cast reference in the book, if not we should add it. Maybe need to do ""addr1, addr2"", or ""[addr1, addr2]"" yesir ,it is ""[addr1, addr2]"" thx Are internal remappings of dependencies picked up? If I have src='core' in ./lib/dep/foundry.toml, and a ./lib/dep/core directory, running forge config gives me dep/=lib/dep/. If I mv lib/dep/core lib/dep/src, then running forge config gives me dep/=lib/dep/src/ Are there any tools / plugins to help do gas + cost analysis across L1 and different L2s? not exactly the best question for this channel but not sure where else to ask when increment index in a loop do you go for i++ i+=1 or ++i and why? Maybe, ++i since we don't want to use old value with i++ Are there examples of foundry repos to pick up techniques? Also I notice that the solmate and forge-std repos have test inside src, the foundry book says forge expects them to be next to each other, which one is better? anyone run into trouble when calling functions of contracts when wrapping it in interface? e.g., IERC721(collection).balanceOf(bob) is reverting in my test.",461
618,foundry-support.txt,"(collection and bob are both of type address) pls put bot ser CAS bot etc: eg https://combot.org/ this is a recent change having test outside src is probably better wrt deploying as less likely to include unnecessary contracts on your deployments Hello, I am having some strange behavior when attempting to deploy a contract using a mainnet tx I have instantiated an Executor with a CacheDB, Env::default(), InspectorConfig::default() and u64::MAX.into() Then I deploy the contract by taking the creation_tx.input and U256::zero() But the EVM Reverts How could this be if the transaction was taken from an actual mainnet contract creation? I made sure to create the AccountInfo for the sender of the onchain transaction and insert_cache into the db and subsequently commit the db with state changeset It's working for the greeter contract, I can validate everything correctly But when I try a more complicated contract for the purpose I intend, I get the Revert Error Hey forge community, how I can change the storage values with forge? you can use store cheatcode: https://book.getfoundry.sh/cheatcodes/store.html was working on PR #48 and was testing changing logic from testFail to expectRevert and for some reason the test always fails, have done a hard reinstall of foundry with forge and cast both v 0.2.0 and still have the same results @gakonst was wondering if you have any input on what might be happening here seems to happen with any of the expectRevert tests in forge-std happens with vm.assume tests as well was able to resolve this btw :) I'm having trouble fixing this nix-env error when installing solc in our make file, looks like karmabadger may have had this issue but i'm not seeing how they solved it Forge-std has stdStore library in Test.sol that helps a lot with the store cheat code.",393
619,foundry-support.txt,"It also has cool ass helper methods for stuff like erc20 dealing I learned ln Am a noob at foundry here and was wondering if anyone has any resources for converting hardhat to foundry deployment script? is it possible or more efficent to migrate deployment script from hardhat to foundry? Can I get foundry to just set up a forked mainnet without running any tests, the way hardhat will just sit there and respond to RPC requests if I do ""npx hardhat node""? It’s in the works: https://github.com/foundry-rs/foundry/pull/1037 I assume since the branch is failing tests I shouldn't just check it out locally and build I haven’t tried 🤷‍♂️ it’s not ready obviously but it seems like most features are done how do you guys like to write your deployment scripts for more complex deployments? I'm thinking of just shell scripting chain forge create calls but wondering if theres a more elegant approach @gakonst if I clone https://github.com/foundry-rs/forge-template and run forge build I get Unable to resolve import: ""forge-std/Test.sol"" with remappings you need to do forge init --template repo project_name Can I manually install the solc version for svm-rs? I tried to use ""svm install <version>"" or ""forge build"" to let it download. But maybe my network is pretty slow it failed every time. I manually download 0.8.13 from https://github.com/roynalnaruto/solc-builds/tree/master/macosx/aarch64 but forge can not detect that I am using MacBook with M1Pro please do 🙂 the failing test is unrelated here are some instructions for how to run it https://github.com/foundry-rs/foundry/pull/1037#issuecomment-1108798712 if you have svm installed the simpl y`svm install ""0.8.13""` should do it if you downloaded it manually you can point to that solc file via the --use ""path to solc"" argument did you also update the submodules? git submodule update --init --recursive I download from github and put it inside ~/.svm.",460
620,foundry-support.txt,"But forge still can not find this version what forge --version are you on? @rohitnarurkar seems to be an M1 issue? oh can you try to reinstall svm? perhaps outdated and doesn't know 8.13 yet Thanks a lot ! I reinstall svm and config my proxy settings. finally make it What was the issue? If it was confusing maybe worth adding to the book? This is dapptools, you want forge probably? didn't did that because it was not on the template. probably worth update the README of the main template? When running a test, is the setUp function called before every test function or not? Similar to beforeEach for example yes ""forge install "" also does the same Is anyone familiar with this error? error[2614]: TypeError: Indexed expression has to be a type, mapping or array (is function (uint256) view returns (address)) I'm not getting it when running tests but getting it in github actions git submodule sync --recursive && git submodule update --init --recursive just in case upstream url changes sync will match that forge test being killed. is this an issue with a test i have setup. i have one fuzz test and when i add it to my test suite, the test is killed. when i remove it, the tests run through fine hey guys, did something a bit silly and accidentally sent some ETH via a mainnet tx to a contract address that was created by a foundry test EOA. wondering if it is possible to recover these funds If anyone is able to easily run a Uniswap v2 transaction with forge, what is the typical gas costs for a swap? Staking? Unstaking? i am not sure if this exists, is there any way to grab verified contract source(s) and download into some local directory from etherscan? how do you guys deploy? hardhat or forge create did you find the anwer to this @jd_gc I ended up writing a shell script.",399
621,foundry-support.txt,"couldn't find a better way to manage multiple deploys with dependent args, proxy contracts etc I used forge create and cast in the script to manage it all that way dont have to introudce the hardhat stuff thanks for sharing! do you have an example excluding the confidential stuff? sure yeah I can share it with you if you want is the cast a shell command? just this https://book.getfoundry.sh/cast/index.html Is it possible to use Vm.deal to supply any arbitrary token to receipient. I want to transfer weth No, it just gives out ETH. You can then deposit that ETH into the wETH contract to get wETH does anyone know which cast command can be used for setting a initialization instruction like this keep getting this error when i use cast send, anyone knows how to resolve it ^ How to add a particular param in a test function ? --legacy You're in a chain without eip1559 So gotta pass that argument Which chain is this? cast send 0xYourContract ""setMinter(address)"" 0xTheAddress --rpc-url <..> --private-key <..> Check the tip cheatcode from forge-std FYI I DM'd you a bunch of issues I ran into with anvil What may be causing this error on forge build ? Compiling… Installing solc version “0.8.10” Successfully installed solc 0.8.10 Error: 0: Solc Error: Location: Cli/src/compile.rs:99 Does anyone else get this error when trying to install foundry? Same thing if I clone the repo and then try to install Might be a crates issue I am seeing stack too deep error on test contracts; 0.8.13 version. This is mitigated by using --via-ir. I guess the only solution is to write smaller tests? Optimizing the tests would be another way, but that would hurt readability. can also use scoped variables {} that's what I ended up doing once is there a foundry equivalent for hevm exec --debug oh derp it's under forge run.",428
622,foundry-support.txt,"was expecting cast Optimism So is it cast send 0xYourContract ""setMinter(address)"" 0xTheAddress --rpc-url <..> --private-key <..> --legacy Added legacy flag here Thank you sir Hey everyone! Potentially stupid question, but if your contract stops interactions from other contracts, is there any way for your tests to get round this? Configure ur msg.sender and prank to that? To set ur msg.sender see here: https://book.getfoundry.sh/reference/config.html You can also the use vm.store cheatcode, to manipulate storage such that it allows you to call the contract, but that depends on how your contact is setup Ah thanks guys! Hadn't made it to the cheatcodes yet ❤️ How to get the full address string from the stack trace when using forge test Hello! I am trying to upgrade to the latest forge. I am getting this error: ""gzip: stdin: not in gzip format"" My current version is: forge 0.1.0 (26b2256 2022-02-20T00:30:56.994435845+00:00) Any advice would be appreciated reinstall foundryup brother how can we deploy using foundry locally with forge create? You mean to localhost? rn you cannot just with Foundry, (foundry node 'Anvil' will be available soon) , you can use hardhat/dapptools to spin up a local node and deploy to that thank you! seems like optimism is lacking foundry support on test net as well. chain id 69 couldnt get cast send to work with optimism network.",334
623,foundry-support.txt,"does anyone know if this is an issue bc optimism does not work with foundry? seems like optimism kovan is supported, are you on latest version? Can someone comment on this? There is no other error message other than this, it’s very confusing I was able to deploy, send and call to optimism kovan, what issue do you have specifically? any code I can take a look at? do you have contracts with different solidity versions? are you sure the input arguments are right? it's a input parsing problem cast send 0xYourContract ""setMinter(address)"" 0xTheAddress --rpc-url <..> --private-key <..> --legacy Was trying to use this but it says that eip 1559 not supported add --legacy flag Do you have a sample code for this! Would really help greatly! Yeah but usually I get an error if it’s a versioning issue. This one has no error and no traces You're right, I'll give it a check, if you share minimal eg to reproduce that would be helpful Dm’ing you. hmm don't know why it's not working with the flag even adding legacy flag, it says Failed to resolve ENS name: ens name not found: 0x03a167aa03f65b2b80fc80813c01f6129c312c04 even tho contract has been deployed https://kovan-optimistic.etherscan.io/address/0x03a167aa03f65b2b80fc80813c01f6129c312c04 did you have to set -chain=69 for optism kovan to work? No need, we get that from the rpc url which of the inputs is this? : 0x03a167aa03f65b2b80fc80813c01f6129c312c04 has test coverage already been added to forge? Is there a way to deploy a contract at a specific address in tests? Say, I want to deploy an ERC20 at the same address WETH is deployed on the mainnet. This is the token address that I have deployed.",440
624,foundry-support.txt,"Calling the function setMinter for token cast send 0xYourContract ""setMinter(address)"" 0xTheAddress --rpc-url <..> --private-key <..> --legacy Using this template Bjerg is on it https://github.com/foundry-rs/foundry/issues/99#issuecomment-1114013860 It's trickier than you think to get it done ""right"", don't think any other project has taken this approach, so obvi taking a bit longer vm.etch lets you overwrite the bytecode at an address with the bytecode of your choice, similar to hardhat_setCode For some reason it maybe is treating 0x03 as an ens name instead of an address..try wrapping the address in quotation marks? I haven't seen this before Did you folks figure it out? We've seen this before when people's solc/svm installation is corrupt or the network connection is slow. Try nuking ~/.svm? Yeah, a restart solved the issue Maybe worth adding to the book if there's a reason identified that's beyond ""turning it on and off""? @DA any additional info to diagnose the real problem? can I expectRevert with a CustomError using forge-std ? am trying to find out if if statement + revert CustomError() is cheaper than require(condition, ""string"") Yeah, you can check it out here https://github.com/dsam82/unifap-v2/blob/main/src/test/UnifapV2Pair.t.sol#L148 it's basically expectRevert(abi.encodeWithSignature(""CustomError()"")) hero 💪 related question, when I use logs_gas modifier for a function that reverts I dont get the gas log, any way to work around that? anyone running into this when trying to update to latest version with foundryup? tar: Error opening archive: Unrecognized archive format Update foundryup You need to forge test -vv but ser, I am 😭 Hey, is there any way to update store variable by variable name? I tried to use this library https://github.com/foundry-rs/forge-std#stdstorage but it seems it only update public variable. not sure how I can update private variables.",456
625,foundry-support.txt,"Do I need to do anything special to mock an external function that doesn't return anything with cheatcodes? I'm seeing the right address being mocked with the right calldata, but it fails somehow I'm just setting abi.encode() for the return data worked thanks check out cast etherscan-source @supernovahs444 just noting tip is deprecated in favor of deal, which has some overloads you can use the same method for supplying ETH and tokens: https://github.com/foundry-rs/forge-std/blob/409465b6992822a91318142dd269660aad9e30ee/src/Test.sol#L86-L123 for using this with private variables the options are: - add a getter method for the private variable and forge-std can use that - make the var public instead of private - if you don't want to edit your contract, create a harness contract for tests that inherits your main contract which adds the getter, and use that in tests Tldr you need to expose the var in some way heh yes 😛 How would i go about doing this? We are going to test against the mainnet token addresses and any of the solutions work for us. any other solution? since it's deployed on mainnet you know the storage slot won't change, so you can just find the slot manually (e.g. with solc's storage-layout flag) and use vm.store alternatively use vm.etch to place a modified version of the contract code that exposes the private variables, but that feels like overkill hello. hope you are hazing a great day. Now, any idea as to why forge test --gas-report doesn't print the gas report? I added the contract name to the .toml, no luck. Also, in —gas-report description (help) there's this env variable [FORGE_GAS_REPORT]... what's that about? Hey, I've been testing with Foundry for some days now, and I love it, but now I'm running into an issue with which I am blocked. I'm working with AaveV3 contracts on the Kovan testnet. I can supply WETH and borrow DAI, but I can't repay it, the transaction reverts. I came here because I don't know if it's Foundry related. The same test runs correctly on hardhat.",479
626,foundry-support.txt,"I hope you can enlighten me on what I might be doing wrong :) reinstalled, works Just to be sure, remappings of installed dependencies are _not_ taken into account, right? (specifically if I edit ./lib/myDependency/remappings.txt, does forge build in ./ take that into account?) try to turn on traces (-vvv) to gain better visibility I did, but i get lost with so many hex traces set an etherscan api key and it will decode live contracts using etherscan :) also recommend setting a fork block number if you havent so forge can cache the state for you Even if the contract (Aave) is not verified on etherscan? no not if its not verified is your test contract payable? When I'm using this library (https://github.com/foundry-rs/forge-std) I'm getting an error that says Failed to resolve file: ""/Volumes/Data/project/midasCapital/contracts/lib/forge-std/src/stdlib.sol"": No such file or directory (os error 2).. idk if aave sends you eth when you repay, i dont know much about aave anyone has experience on getting rid of this? thats because there is no stdlib.sol file I’ll try this. Thanks for the help Oliver :) Yes, but I don't see any usage for stdlib.sol in the library. so you're not importing it stdlib.sol anywhere? forge-std used to have a contract called stdlib.sol but it was deleted as part of a refactor a few weeks ago: https://github.com/foundry-rs/forge-std/pull/36 import “forge-std/Test.sol” -> contract MyTest is Test is the new pattern hmm, it's still getting me same error. forge update 🙂 yes, I did forge update several times. but no changes. no worries, it's working now. what did you change? removed all previous reference for stdlib.sol. makes sense:) I keep getting a Deserialization Error when deploying contracts using femplate.",415
627,foundry-support.txt,"Has anyone else ran into this error/has a solution? check pinned msg in case you’re on older forge version? hmmm - nope everything is up to date looking at the response, it seems like your endpoint is not valid? would that be the server URL that is not valid? I've used this same url to deploy contracts successfully before that's what I'd assume, given the error: unauthorized response, does cast storage --rpc-url <addr> <slot> work? or basically any rpc endpoint? Ok that works - I switched endpoints and now its all good 👍 - thanks! I’m trying to debug a call to another contract (forking mode, test). Stack trace is giving my bytecode — do any of you have a tool for decompiling this bytecode into something legible? hey @gakonst currently facing an issue that forge test only runs one testing file even if not specify the test name with --match-contract. any idea? Would need more context if possible Ideally pls open an issue I am trying to test transferring ETH from a user to a contract. I wrote a function function depositWeth1() external payable {  address staker = msg.sender;  uint256 amount = msg.value;  SafeTransferLib.safeTransferETH(address(this), amount);  emit Deposit(staker, amount); } and tested it by doing function testCanDepositWeth() public {  assertEq(address(bob).balance, START_BALANCE);  vm.deal(address(wethVault), 0);  uint256 amount = 4.2 ether;  vm.prank(bob);  wethVault.depositWeth1{value: amount}();  assertEq(address(wethVault).balance, amount);  assertEq(address(bob).balance, START_BALANCE - amount); } i then changed my function to function depositWeth2() external payable {  address staker = msg.sender;  uint256 amount = msg.value;  emit Deposit(staker, amount); } function testCanDepositWeth() public {  ...  wethVault.depositWeth2{value: amount}();  ... } and the test testCanDepositWeth still passes. Am I understanding sth wrongly here? Thanks! no worries, just figured out by --force I also see this often, but couldn’t reproduce in a separate project. Will try more. hey everyone...",493
628,foundry-support.txt,"i am getting a thread 'main' has overflowed its stack error which seems to be related to having too many 'deployed' libraries (w external functions) here im running a test where i have a number of such libraries. seems to be a treshold where if i add one more, the test will run just once, and then throw that error on the second run Hey guys, question on running CI w/ github actions. I'm operating off a windows machine locally. To that end I specified running on a windows contained in my .yml file. However, github actions runs into an 'Error: Unexpected HTTP response: 404' when trying to install foundry (appears to be specific to using windows container. am i perhaps missing some fields in yml?) I've also attempted onbjerg/foundry-toolchain@v1 for install Foundry. Which does not work update: im getting the same issue with just a single library with an external function. --gas-report also was previously showing the external library deployment, but no longer Can you please open an issue with steps to reproduce? happy to open an issue... want to make sure im not doing something silly though ... here's code to reproduce. i get thread 'main' has overflowed its stack here. if i switch _either_ f or g on A to internal, no more error is that expected behavior ? Panics are generally not expected here, so sounds like a bug! It makes sense though You're trying to dynamically link One into the other ohh so even though the calls don't recurse, the linking does ... Yeah I suspect we aren't handling that ok will open an issue ! i have explicitly thought about this before but there is no logical way to do this correctly and shouldn’t be done if A needs a deployed version of B and B needs a deployed version of A you have to deploy 3 contracts either A B A or B A B welll not technically true you can precalculate which maybe we should do makes sense... why is it in this case that switching A.g to internal solves the problem ? because libraries with public functions get deployed as their own contract then delegate called to vs internal, they get combined into the contract that uses the library so it doesn't matter then that A has a public function.",466
629,foundry-support.txt,"just that the one B needs, A.g can be inlined (if A.g is internal) i think thats my main point of confusion bc i thought the behavior of libraries was all or nothing, either it has a public function or it doesnt. but here it seems like it matters also the specific visibility of A.g (the only function B uses) similarly i can make A.f internal and A.g external, and call A.f(). which i would assume means it inlines A.f to the test contract, and dynamically links A.g to B (indeed in that case, there are only two delegate calls) Hi does anyone know if this guy is for real the real founder Has been acting as a support pming me Fake yeah I got also contacted by a fake Brock (Brick XD) fake - that's the right profile (@gakonst) Ugh Not sure what we can do here PSA there's people imitating me and @brockelmore, needless to say we'll never try to ask you for money :) Be careful because they imitate support messages, in a reasonably convincing manner. anyone knows of any tool out there to automatically remove safemath and convert all those operations like x.add(y) into x + y? Hey everyone I have a question, Is there a way to do something like console.log() in foundry, I have a function that is returning a value and I just want to know what value is returned Yes, please check the book:) book.getfoundry.sh It's also pinned Thanks is there an easy way to pull up a solidity repl? does forge support it? i checked the man and didnt see an option not yet Is there a way to get only the logs when I run forge test ? hmmmm sort of yes https://github.com/comby-tools/comby-reducer#transformations the example provided is for Solidity https://comby.dev/blog/2021/03/26/comby-reducer blog post detailing it ^^ @brockelmore @gakonst I was doing some gas testing and I don't get way, calling 2 different test file that call the same identical contract function produce two different gas result. what could that be? Needs more context sir I can create a github repo to showcase it. I was testing it yesterday to prove that require(i>0) use the same gas as require(i!=0) and I got different gas report.",493
630,foundry-support.txt,"gimme 5 min Don't think they generate the same gas mmm has something changed with the latest nightly? does it always apply the fuzzing even if the test does not has a param? No? oh no I get it, it's also executing test for /src because my contract file have the function name testSomething 😄 @gakonst https://github.com/StErMi/forge-gas-problem here you go [⠢] Compiling... No files changed, compilation skipped Running 1 test for test/Contract2.t.sol:TestContract2 [PASS] test2() (gas: 6222) Test result: ok. 1 passed; 0 failed; finished in 1.88ms Running 1 test for test/Contract.t.sol:TestContract [PASS] test1() (gas: 6200) Test result: ok. 1 passed; 0 failed; finished in 1.88ms maybe I'm getting it wrong, but as far as I get that gas (6222/6200) is the gas used to execute f1 and f2 right? one function is called test1() and the other is test2(), so the order of function dispatch is probably different (because there's two functions in each contract) forge version: forge 0.2.0 (cf89811 2022-05-03T00:05:49.066858+00:00) solidity 0.8.13 try giving them both the same name same result I don't know how forge is executing tests but I was thinking that function dispatcher would not have been a problem tbh looks like you're also calling different functions in Contract.sol also so to have the correct result for gas estimation (want to see the difference in 2 different implementation) I need to replicate those files in c1 and c2 and call them? if both TestContract and TestContract2 have a test called test which calls c.f1(1) they give the same results the gas differences you're seeing are from different function names, resulting in extra solidity execution to find the function you called ok so the gas that I see is not the gas to execute the function but to execute the test? yes and no—that gas number is the cost to execute your test function, excluding the 21k intrinsic gas for ethereum txs, and also excluding the cost of calldata to call that tx.",500
631,foundry-support.txt,"but it does include the cost to find your test function, then execute the contract's method you can also use forge test --gas-report to see the cost of executing that particular method Thanks for the explanation I'm still having issues setting up foundry. I got an error when I'm trying to install from source. It says 'build failed' What error? Which platform? Error: failed to compile 'foundry-cli v0.2.0(http://github.com/foundry-rs/foundry#3dfa6e1a)'. The platform is Visual studio code. Hi, am running into a weird issue where foundry running locally initially thinks block.timestamp is 0--which is the expected behavior. But foundry running on github workflows seems to think block.timestamp initally is 1 (without any calls to hevm.warp). We had foundry in our github workflows CI that ran yesterday that ran successfully, so this issue seems to be popping up today somehow. Wondering if you guys know anything about this. we made a breakign change which changed the default timestamp to 1 we should have communicated it is it breaking your tests / making it hard to fix them? it did break one of our tests but not hard to fix! jc why? Is there a way to make forge update ignore a package? you can select a package to updat eby doing forge update <name> Is there an easy way to get the combined json of a set of contracts? Hey guys, any one knows why cast call 0x418bc3ff0ba33ad64931160a91c92fa26b35acb0 ""oracleData()"" returns different output from a Tenderly simulation? I know that the contract is a minimal proxy, just curious about the difference Is there a command to turn strings to bytes ? perhaps the msg.sender? cast call -f <....> Hum no doesn't change a bit first time trying expectEmit for testing an event but not successful so far.",407
632,foundry-support.txt,"this is the event: event CreatedArtist(uint256 artistId, string name, string symbol, address indexed artistAddress); given only the 4th argument is indexed, does that mean I should be doing vm.expectEmit(true, false, false, true)? and do I need to make the indexed param go first in the test event I compare to? so I have struct Voter { uint256 weight; // weight is accumulated by delegation bool voted; // if true, that person already voted address delegate; // person delegated to uint256 vote; // index of the voted proposal uint256 startTime; } and its passed as mapping(address => Voter) public voters; and in my tests, I'm trying to do this: log_named_uint(""start time"", ballot.voters(addr1).start); but i keep on getting this Member ""start"" not found or not visible after argument-dependent lookup in tuple(uint256,bool,address,uint256,uint256). And yes you guessed it, its from the ballot contract in the solidity docs. I'm trying to add a feature and I'm testing it with foundry but i cant get the value of startTime from the mapping uh try startTime instead of start? 😅😅 I just renamed that for clarification just now, it's the same error 😅 Besides startTime, I can't get any value from the Voter struct I'll send a screenshot in a bit for my project that uses forge-std, does everyone cloning it have to manually have to install it? or is there a requirements.txt equivalent in foundry ? Just forge install foundry-rs/forge-std No need for requirements txt Maybe need a getter method that returns a Voter memory Newcomer to foundry here, I can't seem to get the --match-path filter to work. Lets say I only want to run the tests in src/test/Attack.t.sol.",377
633,foundry-support.txt,"Can someone tell what the terminal command to run would be? What's the name of the test contract? I use forge test --match-contract <testcontract> Attack.t.sol I mean the contract in that file I tried this but all I get is ""No files changed, compilation skipped"" oh Works for me, I'm using it rn Works now? worked thanks! I know this noob of me to say but ser I don't know how to do that 😅 Do I declare another voter struct in my test contract and work with it somehow Pls look up how to get a solidity struct from another contract :) On it, thanks for the help. sorry for the annoying question create a dummy contract that just imports the ones you want is what i have done I'm trying to run some differential fuzz tests to check the correctness of a couple of functions and have the reference implementations in rust but I haven't been able to get any meaningful inputs using the ffi cheatcode, do all inputs have to be in abi form? Like even just an ls command fails with [FAIL. Reason: Invalid character 'h' at position 3] Yea the output has to be abi encoded Ah that makes sense, thanks One other question I have is what would be the best way to structure this? It seems like it would be similar to the rust-foundry template you created, but the other way around, like installing the rust project as a submodule in the solidity project And then use solc directly? Was thinking it would be nice to have a forge command that took a bunch of globs as args and then spit out a combined JSON file to stdout including all the contracts that the globs matched. This would be useful for composing forge with other tools that use combined JSON for things, like geth abigen Do you mind opening an issue with the desired UX? is there a way we can get all these messages on stack overflow or smth haha feels like theres alot of repeat but its hard to search thru That's why I always ask people to open issues and make PRs to the book :) @msolomon4 I was thinking about the ""problem"" I was looking for yesterday to understand gas optimization/gas testing. The only correct way to avoid ""function dispatch"" problem is to have C1.sol with f1 implementation, C2.sol with f1 implementation but ALSO have two different test file that will call only C1.f1 and the other will call C2.f1.",501
634,foundry-support.txt,"Otherwise the test would be ""poisoned"" by function dispatch cost for both selecting the tet function and selecting the contract function? Is default block num changed as well? Soon: https://github.com/foundry-rs/foundry/pull/1037 two shakes of a lambs tail yeh, same as with forge, you can try it out before it gets merged with these instructions https://github.com/foundry-rs/foundry/pull/1037#issuecomment-1108798712 there will be bugs, so the sooner we discover them the sooner we can get them fixed :) Hi, is it possible to create tests in solidity with foundry and deploy on local using hardhat? Thanks Installing deps that redefine libs seems broken. If my dependency has libs=['unusualLibDir], I can't build in the parent folder... hmm, would need a bit more context, mind opening an issue with an example layout of your workspace? sure! https://github.com/foundry-rs/foundry/issues/1486 soon ser very soon Yes Also is there some rough timeline on upcoming features somewhere? Check the pinned open issue Hey! is there a way to install dependencies to already exisiting foundry project? if I do forge install @aave/contract-helpers it gives me an error I think you donot need to include @ just try aave/contract-helpers Also if the submodule is already inside the lib directory try running forge update hmm didn’t work for some reason :( but I think the issue with url itself is there a way to use https://github.com/dethcrypto/TypeChain with foundry, btw? Yeah it's supported Just point it to the Foundry artifacts and this way I can generate interfaces for the contrat? my bad, I think I’ve misunderstood what I can do with typechain Does the deployer address used in foundry tests have any ether balance by default? Or do I need to vm.deal it some before I can play around with payable stuff Yeah it has But if you prank as another address it won't Right, thanks Hey guys, is there a way to call forge install but for gitlab repos ? I’m trying to call external contract inside foundry.",455
635,foundry-support.txt,"If I get it right I need to do - Define contract interface - address to interface and call a method and after that I suppose to be able to call a method like this governance.getGovernanceStrategy(); yep - and run it with forge test —rpc-url <...> ya but need to pass the full URL, forge install https://gitlab.com/… Thx my bad, RPC url was incorrect 😄 npx typechain --discriminate-types --target ethers-v5 \""out/**/*.json\"" https://gist.github.com/sambacha/fa6c6a1c2ad7de88fad284ab363ab501 try git submodule sync --recursive && git submodule update --init --recursive I'm currently generating pseudorandom addresses and trying to _safeMint an ERC721 on them - the test then fails because the addresses don't implement ERC721Receiver. Is this expected behaviour? As far as I understand safeMint should work fine on an address, unless it has any code/is a contract. Is there something I'm missing? The same approach worked fine in hardhat by the way, so this got me slightly confused hello, guys I can't install foundary correctly either from command or packages Both error !!!!!!!!!! is there a way to display the storage of a contract while debugging? I’ve used StdStorage + Logging programmatically, but afaik storage isn’t available in debug window ok, can i see how many storage slots my contract occupies with this approach? what OS? Thanks a lot for fixing, I put a new, related issue up https://github.com/foundry-rs/foundry/issues/1492 When using vm.expectEmit, does the test event need to be emitted before the contract call? That seems to be the case. If I do vm.expectEmit(false, false, false, false) and emit the test event before the contract call I'm testing, the test passes. But if I move the test emit after, it fails. The reason I ask is I'm trying to test an event in a function that deploys a proxy, emits the proxy's address in the test, and returns the proxy's address from the function. So I need to make the contract call before the test's emit so I can pass the returned address to the test event.",473
636,foundry-support.txt,"🤔 I guess I can adjust the nonce and deploy the proxy within my test so I don't need to rely on the contract call for any information, but feels kinda janky Well, what exactly are you trying to do? Function dispatch cost is constant (per method), and typically you're trying to optimize a given function's gas cost. In that case it doesn't matter how much constant overhead there is from function dispatch, because the gas deltas from code changes are unaffected Forge crashing on a new repo. Just set up foundry.toml src and contract.t.sol file . it crashes on every call Is there a reason why there isn't a setCoinbase cheat code? helping is much easier when there is code / repo / reproducible stuff ya try the latest version, then there should be a better error message Still getting some issues with ffi, I'm able to pull an address out of a file but when I try running a program which returns the same address I get a FAIL. Reason: Odd number of digits The program I'm trying to run with ffi is just a rust executable which println's this address just for the sake of getting everything to work nicely not really, should be simple to add you need to abi encode the output I am doing that but I saw that the reason was that my function was returning Ok(()) and that was messing the output up. I removed that and then there was an issue with println! because of the trailing \n but now after I got both of those things sorted it's working ah yes needs to be without \n, we should prob documetn this better.. Heyo! Thought I'd start here instead of poluting github. Just getting into foundry and have 2 hrs in trying to get the default imports happy. best ideas? thnx! inside yarn workspaces managed monorep have remappings via --vscode flag for forge init m1 mac cuz its setEtherBase :0 I think you have to hoist your workspace so dependencies are flat added it here btw https://github.com/foundry-rs/foundry/pull/1493 So I don’t think yarn is really doing anything to this package because it’s not js? All the js deps are hoisted is ur repo public? im not clear on the expected behavior of forge test --gas-report, when using in conjunction with --match-contract, i am only seeing the gas for calls from inside of setUp().",497
637,foundry-support.txt,"should i expect to see gas costs of calls from the test functions? i figured it out... my test i was expecting to see gas reports for was a fuzz test. fuzz tests don't show up in gas reports linux It's latest ... cannot compile the foundry cli what was the build command you used? cargo install --path ./cli --bins --locked --force I had clone the project to my local then I want to install it on my local Hey, is there any way of using foundry so that the contract create tx is submitted to flashbot? Nvm, found the --flashbots flag you can also just set the rpc-url to your endpoint why not use foundryup ? I'm getting in a seemingly infinite loop runnig forge config (or forge build). What's the best way to investigate? (note: this happens with a very large dependency, but running forge config inside the dependency itself works fine) hmm this should have printed better errors, but your issue was that your config had src = [..] but it only accepts a string run again with RUST_LOG=ethers=trace forge build So I want to the bundle the contract creation and call to an existing contract in a single bundle and submit to flashbot. (need to guarantee that both tx are in the same block). Is there any foundry way of doing it? no output, still looping (afaict) I installed with cargo install --path ./cli --bins --locked --force if that changes anything -- I don't know rust It looks like forge config is scanning all files in all subdirectories? Does it need to do that? is the repo public? there is a way in solidity of doing it just think of it as a bundle really and have it revert You mean calling the external contract in constructor? having two transactions included in the same block or having two transactions being atomic ? Same block, not atomic. Second one can fail but the contract should be deployed regardless. is there a way to check for equality between two structs of the same type? I get ""No matching declaration found after argument-dependent lookup"" when doing assertEq(struct1, struct2) maybe abi.encode them first thanks but does not change anything its not, but i could make a public one that mocks the repo structure if need be. Currently blocked forsure.",472
638,foundry-support.txt,"well i mean it builds but those red squiggles 😅 For testing in foundry, is there a hook that does the same thing as setUp(), but which state is preserved across every test run? Or is this the only option got this error on forge test: Library not loaded: /usr/local/opt/libusb/lib/libusb-1.0.0.dylib is there a certain way to load this library it needs? read the readme in the repo it details how to fix that k ty Hey guys, is there a foundry × hardhat template ? I thought about this a bit, and without shipping binaries without Libusb we are unable to get rid of the error If Libusb isn't installed And given how common of a lib it is I think I feel good with our current solution yeah agreed, was an easy fix up and running Hype Search that up on github there are several ones up there for sure were building a Scaffold-Eth version now What are some big open-source projects that are using Forge? I need many test contracts to benchmark compiler optimizations. https://github.com/maple-labs https://github.com/ourzora do you guys use forge just to write unit test or functional tests as well? Yeah, they seems messed up. I made mine hey guys, when running forge build i face this error: I have a number of solidity contracts in my src folder of different versions: ^0.8.13; ^0.4.18; ^0.6.0; How can I forge build all of them? made a clone of basic structure https://github.com/carllippert/web3_template what windows version is this? win 10 pro, 64 bit ahh digging into this more. Does remappings.txt have some relationship with gitmodules? Have been using --no-git because I'm adding foundry to an existing repo yes its non deterministic you can use the compiled output Could you please elaborate? whats the convention for functional test to name the testing contract after if the functional test interacts with various contracts ? with unit tests i name the test contract after the source contract which is unit tested any example repo with some fu crional tests would be nice if u have any here do you not have auto detection enabled in your config? i do what happened I'm guessing its some error downloading the compiler.",473
639,foundry-support.txt,"not sure why it would not work for older versions i have a question regarding abi decoding on forked mainnet tests is there a way to manually bind an abi json to a contract address? i am running some tests via forked mainnet on a proxy(of an erc20 token)...but all stack traces show encoded calldata...would be awesome to see the decoded types is this because i am interacting with a proxy? since i think forge pulls the abi from etherscan(if its verified) nvm...i'll just log it with the type itself does the trick are there any cheatcodes to change the chainid? Yes It's called..chainId 😂 this is so embarassing 😅 hi, does anyone know how to use forge install for a specific version? What's the use of cast --hash-zero command ? I see 0x00.. in o/p Does anvil do caching like hardhat/ganache do? i believe so, letting @mattsse confirm. we re-use the same cache we use when froking on forge test Perfect. Let's see how much this speeds up my 8 hour ganache test run lol 1:20 with hot caches holy f lol let us know how fast it is after the switch FYI: So been running through the solc versions that work for windows. Turns out only 0.8 and above allow for compilation.",283
640,foundry-support.txt,"Anything lower, (0.6 - 0.7) return a invalid win32 application error (surprising since this was not an issue in brownie) tried running the command i saw on https://twitter.com/gakonst/status/1522282339073597440 but i got this npx hardhat --network anvil test Error HH100: Network anvil doesn't exist any idea why? i have updated and could run anvil its not supported out of the box, theres some setup u need to do hey yall, are there any rust bindings to anvil? like to fork the node on a certain block and send it commands? u should be able to use the anvil crate from the foundry repo thx, ill take a look! okay! will look at the docs or something to find the setup! is there any links or leads you could provide me? wanna try using anvil for local deployment instead of hardhat haha not yet no, been a while since i've used hardhat so i couldn't tell you what u need to do cc @mattsse / @gakonst what is the right syntax for parameters address[] memory, uint[] memory cant seem to get this to work cast send $minter \ --rpc-url $rpc_url \ --private-key $private_key \ --legacy \ ""initialize(address[] memory, uint[] memory,   uint)"" [""0xB02DC28Af7AC5EC52C2abd69354FeC040443ea78""] [9070472000000000000000000] 100000000000000000000000000 due to 0: Failed to resolve ENS name: ens name not found: initialize(address[] memory, uint[] memory try w/o memory keyword anyone have experience using OZ's AccessControl within a test? I can't seem to get the right perms.",385
641,foundry-support.txt,"is there any way to do the equivalent of something like contract.connect(address(this)) in sol? im so used to hardhat, maybe i need to change my way or thinking hi, can someone send a link for supported rpc methods for anvil pls? what is the right syntax for parameters address[] memory, uint[] memory? cant seem to get this to work cast send $minter \ --rpc-url $rpc_url \ --private-key $private_key \ --legacy \ ""initialize(address[] memory, uint[] memory,   uint)"" [""0xB02DC28Af7AC5EC52C2abd69354FeC040443ea78""] [9070472000000000000000000] 100000000000000000000000000 attempt 0: removed memory doesnt work even without the memory keyword. suspect its the brackets. trying without the brackets attempt 1: got this error without brackets Error:  0: Failed to parse tokens 1: Invalid data attempt 2: tried using circle bracket but failed as well with same error as above arr=(0xB02DC28Af7AC5EC52C2abd69354FeC040443ea78) What are you missing? is it possible to impersonate_account via anvil rpc? Hello, have a question: can I mix rust code & foundry solidity code to implement tests ? Or call solidity code from rust ? im currently simulating buy/sell of erc20 tokens on uniswap to find out if a token is a honeypot/has high taxes/blacklists with hardhat node on different blocks, its so slow.. looking to migrate my code to foundry is there any way to make these rust backtraces actually work? installed via cargo: λ RUST_BACKTRACE=full make deploy-ropsten contract=VestingModuleFactory [⠒] Compiling...",384
642,foundry-support.txt,"No files changed, compilation skipped Error: 0: Dynamic linking not supported in `create` command - deploy the library contract first, then provide the address to link at compile time Location: cli/src/cmd/forge/create.rs:122 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ BACKTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1: __mh_execute_header<unknown>  at <unknown source file>:<unknown line> 2: __mh_execute_header<unknown>  at <unknown source file>:<unknown line> 3: __mh_execute_header<unknown>  at <unknown source file>:<unknown line> 4: __mh_execute_header<unknown>  at <unknown source file>:<unknown line> 5: __mh_execute_header<unknown>  at <unknown source file>:<unknown line> 6: __mh_execute_header<unknown>  at <unknown source file>:<unknown line> 7: __mh_execute_header<unknown>  at <unknown source file>:<unknown line> 8: __mh_execute_header<unknown>  at <unknown source file>:<unknown line> Run with COLORBT_SHOW_HIDDEN=1 environment variable to disable frame filtering. make: *** [deploy-ropsten] Error 1 seems like this must've been ~recently introduced as a bug (on the latest forge; had no problems deploying this repo ~two weeks ago.. hasn't changed since then) to the best of my knowledge it doesn't even use dynamic linking? maybe one of the submodules? idk there should be an rpc end point that lets you send an unsigned tx and it go thru would need to check docs something is definitely using a library that has a public function if you’re getting this if open source feel free to drop link here any tips on how to get a better debug message? https://github.com/0xSplits/splits-vesting digging thru myself rn.. clone with immutables is a library with an external function which you use for address in the factory so you would need to deploy (or link to existing implementation on chain) ah..",456
643,foundry-support.txt,"not sure when that got fucked up but those should be internal fns 🙏 i couldn't find anything besides vm.prank which is solidity based code anyone having problems with expectRevert? if i do a simple expectRevert or an expectRevert with the revert string reason it doesnt seem to take effect and makes my test fail anyway what is the right syntax for parameters with list [] for cast send? anyway to manage and commit deployments to source? include exact source, deployment address, etc.? On mainnet fork testing, when we vm.warp or roll into the past to some time t, does the test access historical state at that time t? Or is it just changing one value (the timestamp / block number), and using current state? (I’m assuming it’s like Hardhat where you pin a block, and it uses the chain state at that block?) Yes, anvil_impersonateAccount + your address, or use the standard hardhat api It hooks on external calls, is it an internal one failing? We haven't got there yet..when you roll to a different block it keeps the same state as the one you forked at and only modifies the block number There's an issue tracking cheatcode improvements and that's there just checking if the syntax for cast send parameter having list is supported? vm.expectRevert(); position.ownerOf(0); test fails: Failed tests: [FAIL.",287
644,foundry-support.txt,"Reason: ERC721: owner query for nonexistent token] Position Contract::ownerOf(0) [staticcall] maybe cause its a view method? as in a static call there doesn’t hook? You gotta give it the right reason did that same thing Mm cc @onbjerg Hi, in hardhat I can just run npx hardhat run scripts/scripts.js and a local eth network will spin up automatically And that's different from npx hardhat node Is there a way with anvil to do the same? I mean this: https://hardhat.org/getting-started/#connecting-a-wallet-or-dapp-to-hardhat-network @mattsse got a plug-in in the works which abstracts that Niiice Go @mattsse gooooo 😄 there's a pretty rough version of the plugin https://github.com/mattsse/hardhat-anvil more like a poc, but it lets you test against anvil with --network anvil not available on npm yet though missing the error traces on reverting txs in anvil Ah @mattsse iirc hardhat loads the compiled abi and bytecode to the node via an API call And uses that to decode from the node debug traces we got in tests is pretty good too, if that can be reused i tried the -vvvv flag but i think it is not being used or not written to stdout Ya maybe we can load the abis directly from artifacts path using foundry toml instead of loading over RPC adding to todos it's super strange. in the tests, the imports are all underlined in red, with the error that the file cannot be found, whether I hardcode the path in or use like ds-test/test.sol BUT it's able to forge build successfully... what ide are you using? you have to supply the remappings to it somehow i think vscode has an easy way to do it.. haven't had success with e.g. emacs myself yet dapptools feature parity question.",401
645,foundry-support.txt,"Do we want the results of cast latest to be returned as hex or should cast decode them? $ seth block latest number 14725155 $ cast block latest number 0xe0b023 $ cast --to-dec $(cast block latest number) 14725155 Random question but is there a way to specify a folder of tests to run in github CI --match-path to the file path seems to work locally but does not actually run anything in CI, I made sure to specify the proper working directory in the action. If there's a good reason to leave these responses as hex, that's fine. I'm going to need to fix some scripts if this is the intended behavior. I don't think it's intended behavior, they should be decoded - https://github.com/foundry-rs/foundry/issues/1193 - https://github.com/foundry-rs/foundry/pull/1253 looks like that issue was closed a bit prematurely 😅 gm, I'm having an issue with running the debugger. For some reason forge doesn't run into a problem when running a specific test (forge test --match-test testSomething), but when I try running the debugger for said test forge --debug testSomething) it crashed an returns The application panicked (crashed).",262
646,foundry-support.txt,"you need to give context sorry i got some env variable to run but it can only work for linux or mac os .bashrc cant be ran on windows i think did this get printed when you installed foundryup: foundryup: could not detect shell, manually add ${FOUNDRY_BIN_DIR} to your PATH. the command line gives you a decent amount of info. no i got this Detected your preferred shell is bash and added foundryup to PATH. Run 'source /home/user/.bashrc' or start a new terminal session to use foundryup. Then, simply run 'foundryup' to install Foundry. sorry how do i format in tele? It has remappings in the config that are there by default. It's just when trying to import the contract needing testing performed on it. It's strange that build works, but that it shows as not being correct... I'm using vscode on a mac haha gotcha, so we probably detected the wrong shell for you because you had a file someplace that made it think u used a particular shell? not sure. but foundryup exists someplace, but you can manually add $HOME/.foundry/foundryup to your $PATH and that should fix everything for you @tyneslol fix was merged, foundryup tmrw for the update just tested, working great! 👌 vscode doesn't pick up remappings directly from foundry or foundry.toml. Not sure if this is up to date (@transmissions11 ) but see https://twitter.com/transmissions11/status/1434963080971124737?s=20&t=y0cfALofjpjc1YErLF44eA Yup still works! See the vscode config we use in solmate weird, it works for all the files outside of the test directory... it's only within test that it doesn't work (even though it was working fine yesterday)...",393
647,foundry-support.txt,"but I'll take a look at the post there! if you think something's not right, I'd appreciate an issue, we did some work on remappings last few days, so perhaps we missed something @brockelmore thanks man i got it working Ah, dope, that let's me create a list of both [""lib"", ""node_modules""] instead of just one :) all set! Figures it is a vscode thing All set, thank you! is there any doc for anvil other than this github page? https://github.com/foundry-rs/foundry/tree/master/anvil trying to setup a test environment nvm got wat am looking for can you provide the code snippet + trace Have been playing around with anvil today. God tier work. Would anyone have advice for the best way to script an anvil node beginning + contract deployment + tx execution in one .sh file? Am a bit unsure how to handle the anvil process overtaking the terminal My current method is doing anvil --fork-url $ALCHEMY_HTTP_URL --fork-block-number $HACK_BLOCK_NUMBER & which I believe spawns the process in the background, and I later use pkill anvil to clean it up. Wondering if there's a better way tmux/new terminal process is what i would recommend :) ye this is the backup plan. ty for validating that method Hi folks, just wanted to ask if I'm missing a way to enforce the code size limit in tests, running into a case where a contract of arbitrary size would be deployed and I'm expecting it to revert at a specific point but I realized that I can go over the size limit in contracts deployed from my test i think you’ll have to manage it manually and check addr.code.length because most test contracts will get over the limit kk makes sense tyty which solc version that foundry uses to compile the contract? I use the svm to manage solc versions, and the global is 0.8.10 => svm use 0.8.10 But when Foundry compiles, it shows [⠒] Compiling 20 files with 0.8.13 Where is this version 0.8.13? It auto detects default to the latest possible You can change it from default in the toml file.",465
648,foundry-support.txt,"thanks, so even if the svm global version is 0.8.10, it still detect that my computer has version 0.8.13 and it uses that instead? Or forge does not use the solc on my computer and it has an independant version? Unless its =0.8.10 it will use latest solidity uses npm semver conventions the reference section > the whole book finally got it setup Should we push any of the pages in the reference higher in the book? imo the basic commands for forge and cast should be at the top i didnt even realize that section was there when i read the book last week just realized it this morning some of the book was overwhelming to read for me when i just wanted to run some basic commands Good feedback Can you maybe share some extra ideas on your ideal structure? Book still early and can be improved btw am a newb at solidity dev, so my opinion might not matter. I just wanted something quick to show me how to build, run and deploy quickly without the headache of reading the detail parts of the framework just yet maybe have a nice 1 pager with a demo project showing the main commands working and then link to the reference sections with all the commands or a link to in-depth sections https://hexdocs.pm/phoenix/up_and_running.html something like this that shows all the main commands abstractly and if the viewer wants they can go indepth Somhow remappings does not work anymore Import ds-test/test.sol does not work.. had to change it to ../../lib/ds-test/src That's unexpected Are you sure you dont have any remappings set in foundry toml? Hmm i think i have to reset everything Ok created a new project seems to work 👍👍 Found the error. Strange project structure All good 🙌🙌 Hi, How we can display console.log in proper format with variables. Everytime we use variables it prints , before its value. Ex. console2.log(""Balance of"", message, "":"", obj.balanceOf(addr)); Prints: Balance of, deployer, :, 3 Hey ! Is it possible to write yul contracts + sol tests in a foundry project. Seems yul doesn't like settings.remappings and can't find a way to remove them completely (removed config file, tried empty array, empty string as cli arg, empty env var).",480
649,foundry-support.txt,"Is foundry suited for yul dev and has anyone done it before ? ok after a quick msg search, seems yul is not supported yet ! Did someone of you ever had the error that vs code does not show any errors (syntax e.g.)? ""Enabled as you type compilatoon error check"" = enabled Got it. Should someone ever face the same issue -> remove specific compiler version from extension & set it to latest(default), remote Hi everyone, is it possible to deploy an independent Library that contains external/public functions which other contracts will delegatecall in forge test? I get the following error if I try “library = new SomeLibrary();”: error[1130]: TypeError: Invalid use of a library name.",145
650,foundry-support.txt,"For dependencies in lib/, forge should be able to auto resolve the path right? Havent some issues with forge not being able to find the libs Do I still need a direct remapping? For example, forge should be able to resolve OZ and DRIP20, however, it still fails to find them I have to explicitly remap the path with the src directory for it to work DRIP20/=lib/DRIP20/src/ is this the expected? created an issue https://github.com/foundry-rs/foundry/issues/1552 let me know if you need anything else this should work vm.expectRevert(bytes(""ERC721: owner query for nonexistent token"")); according to the docs that conversion should be implicit “Implicitly, strings get converted to bytes except when shorter than 4, in which case you will need to cast explicitly to bytes” also a simple exceptRevert() without any arg should work i think its not taking effect for some other reason as I see in the docs (and as I got it to work) it's taking bytes, the one without argument I believe is for if the call should revert without msg https://book.getfoundry.sh/cheatcodes/expect-revert.html Hi, are anvil verbosity options ignored right now? I would love to see why my call reverted, but can't get anything more than eth_call in console you should get a better idea of when/where it fail with -vvv nope, no change right without any args expect no message at all didnt know that thought it would expect any reason but still casting to bytes doesnt work either this snippet is from the readme https://github.com/foundry-rs/foundry/tree/master/forge#cheat-codes just make sure “lib” is in “libs” in foundry.toml generally usage of library is via “using MyLibrary for address;”. but otherwise you do inline “MyLibrary.someFunc();” It definitely is, its able to find forge-std but isnt able to find DRIP20 or OZ unless I specify src in the remapping just wanted to make sure this is expected behavior? what’s the structure of drip20 are contracts in src or contracts? or something else the contracts are in src I see - ok I was hoping to simulate a case where we deploy Library independently and call one of the functions via delegatecall from other contracts.",488
651,foundry-support.txt,"Thanks for clarifying! MyLibrary.someFunc will be delegate called its the same structure as forge-std but... i dont get why it cant find it 😂 what’s the command line output? okay this is weird... it used to be ParserError: Source ""path/lib/DRIP20.sol"" not found: File not found. Searched the following locations: """". but now i just removed the mapping... remapping and its resolving properly now... right - my contract does “libAddresses[i].delegatecall(payloadFromArg);” so needed the library to be deployed and addressable (the idea is that libraries can be extended over time post contract deploy) ye manually adjusting remappings is kinda an antipattern but sometimes needed so I just needed to manually adjust it and now even without it foundry jsut.. knows now? LOL https://github.com/foundry-rs/foundry/issues/814 ah ull have to manually do it i know this was the output cause its still in my tab interesting - is there an example you can point me to in terms of how to do this manually? change them to normal contracts, then add the new MyLibrary() back and do libAddresses[i].delegatecall(data) (sorry, not abstract, just normal contract) be careful with this pattern though, delegate call has some sharp edges I see - ok I’ll try that and also explore different patterns. appreciate your help! btw I just migrated from hardhat to foundry and love the simplicity/no abstraction does cast not work for fns with struct or tuple params? e.g.",322
652,foundry-support.txt,"The dependencies use pragma solidity 0.4.23 (in my case it’s ProjectWyvern/wyvern-ethereum and there is no version that is compatible with ^0.8.0 available) * when I run the test I get an error “Discovered incompatible solidity versions in following” Is there a resolution/workaround for this, e.g., compiling the dependency separate with a different version? I guess the right way to do it is to use mainnet fork or local testnet and separately deploy the dependencies instead of using forge install/importing in the test file for my specific case. It's probably a PEBKAC error but do the traces pick up from matching compiled interfaces abi that exist in foundry out dir? Running in forked mode and just seeing the bytes4 for most function calls. λ cat out/IDeployer/IDeployer.json | jq '.abi[] | select( .name == ""removeAuthorizedAddress"")' { ""inputs"": [  {  ""internalType"": ""address"",  ""name"": ""target"",  ""type"": ""address""  } ], ""name"": ""removeAuthorizedAddress"", ""outputs"": [], ""stateMutability"": ""nonpayable"", ""type"": ""function"" }  λ cast sig 'removeAuthorizedAddress(address)' 0x70712939  ... ├─ [10413] Deployer::70712939(000000000000000000 ... Do you mind opening an issue about this? Normally no.",307
653,foundry-support.txt,"Are you on latest? This shoild work - if not, it's a bug on our fuzzy matching of bytecode on forge 0.2.0 (85f69d9 2022-05-09T00:04:25.613861+00:00) right now I can confirm that the bytes4 gets matched if I do the following: * convert interface to stubbed contract * deploy this stubbed contract in setUp After this the events and function calls are matched Ok worth opening an issue - seems like an edge case If you have a repro this helps a lot The more minimal the better got one coming your way done https://github.com/foundry-rs/foundry/issues/1563, hopefully that's clear Is there a @it.skip equivalent in Foundry (short of pattern matching/adding a skip prefix to test names)? this are they in a separate directory ? Nope, within the same test i think you should be able to keep them in a separate directory, then symlink that directory into src/test or wherever. Then when you want to disable them just do git config --global core.symlinks false maybe 🤔 since foundry uses git , disabling symlink following may work this would be whole test files tho Hi! Is there a way to run a local fork on foundry and get parity traces? Hey guys, not sure if this is the right place to ask this question but just curious to know if there any better way of dealing with token decimals ? When I try to convert a 18 decimal value to a token with lower decimals (like USDC) I lose precision resulting in some dust. Is this dust negligible? I've been using https://docs.rs/rust_decimal/latest/rust_decimal/ but I want to do some benchmarks Thank you but this is wrt Solidity... Oh I thought you meant in rust. In solidity everything is ints and you just have to be careful with how you do your math I think some contracts have been bricked by off by one errors. That's why things like MasterChef have an emergencyWithdraw Some contracts shift everything by 1e9 and then do the math and then shift back Maker uses ""ray"" for that math instead of ""wad"" (If I remember the glossary correctly) Yeah it's kinda tricky to integrate tokens with different decimals I think aave uses the same ... Will look into this.",486
654,foundry-support.txt,"Thanks Bryan 🙌 Hey all! I've tried dapp.tools recently and I love it. But I find it a bit hard to find docs for testing contracts. I thought that foundry had a similar syntax, do you know where I can find good examples ? Thanks ! @franfransparkies ru looking for example tests? This repo has a ton of tests that use foundry functionality and should be a good intro. https://github.com/fei-protocol/tribe-turbo/tree/main/src/test you do get reduced cost cause its not leaving a zero balance fwiw ds math is dapphub library Yoooooooooo you're rocking dude ! Now I'm wondering what's the difference between foundry and dapp.tools Thanks its a reimplementation of the dapptools suite So, better ? Its a reimplementation of dapptools 🤔 Wow there is console.log That rocks I'm switching very soon ! Pilling D: How do you feel being such a Chad ? no my name is sam im not from Chad ser syria I can feel it, my Chad detector is extremely high here Hey folks, this error makes it seem like there is a *new* code generator that in fact does support this feature— is that the case? 👀 UnimplementedFeatureError: Copying nested calldata dynamic arrays to storage is not implemented in the old code generator. Are you using viaIR ? I am not, but I can Gotta read up on intermediate yul rep Try enabling it yes addmod and mulmod are treated differently Great thanks @sambacha, how are they treated with IR? I don't see any explicit mention on the solidity docs It looks like the book is down I'm trying to test some ethless functions, I need a sigh hash but not a split signature, so I concatenated the split signature provided by vm.sign, but I do not get the right signer when I recover it, however, my hardhat test does work just fine...",405
655,foundry-support.txt,"Any idea what I'm doing wrong? Does validation expect a EIP-191 signed message prefix? @onbjerg Why can't we use vm.prank() on the first contract instance we deploy in a test? Was there some type of change to warp and or numbers in a recent foundry update? had some tests come up failing all of a sudden with no actual code changes involves warp Block number/timestamp was 0 Now is 1 by default yes it's expecting the usual, \x19Ethereum Signed Message:\n32 does vm.sign is including that prefix? No it does not You need to add it Thanks :) Thank you very mush 🙏 this is exactly what I was missing 😊 ser did you resolve this? i am now running into the same issue with a tenderly fork try passing --legacy, i have an impression that happens when the chain does not support eip1559 txes like ganache that worked, ur a hero. tx so much thx g has anyone encountered this error while trying to us ffi ← ""Odd number of digits"" Hey guys, is there any update on what the best practice is for having contracts with different versions of solidity? I believe this issue relates: https://github.com/foundry-rs/foundry/issues/1163 Imo it should be possible to explicity map contract -> solidity version if the user desires. This use case seems to be super common for anyone trying to build in 0.8.x on top of uniswap (which has <0.8.0 specified explicity due to reliance on overflows) I like to see that my issue is hot 😂 Did it different way, but nice to see that with --legacy works Hi everyone, Is there something similar to the scripts folder in Hardhat? I mean we can have a script to play around with the contract without deploying it? Forge run or forge test Usually means that you're not passing a valid hex string somewhere you can combine both if you want. For instance in my scripts folder of my HH/Foundry starter I have multiple bash scripts that flatten, verify, deploy etc. (https://github.com/pcaversaccio/hardhat-project-template-ts/tree/main/scripts). You just need to make them executable before (simply run make scripts). @joshiedo @pcaversaccio : I mean, a script to interact with the contract to verify if it works or not.",497
656,foundry-support.txt,"It will play around with the local blockchain on our computer. Something like this: // scripts/withdraw.js const hre = require(""hardhat""); const abi = require(""../artifacts/contracts/BuyMeACoffee.sol/BuyMeACoffee.json""); async function getBalance(provider, address) { const balanceBigInt = await provider.getBalance(address); return hre.ethers.utils.formatEther(balanceBigInt); } async function main() { // Get the contract that has been deployed to Goerli. const contractAddress=""0xDBa03676a2fBb6711CB652beF5B7416A53c1421D""; const contractABI = abi.abi; // Get the node connection and wallet connection. const provider = new hre.ethers.providers.AlchemyProvider(""goerli"", process.env.GOERLI_API_KEY); // Ensure that signer is the SAME address as the original contract deployer, // or else this script will fail with an error. const signer = new hre.ethers.Wallet(process.env.PRIVATE_KEY, provider); // Instantiate connected contract. const buyMeACoffee = new hre.ethers.Contract(contractAddress, contractABI, signer); // Check starting balances. console.log(""current balance of owner: "", await getBalance(provider, signer.address), ""ETH""); const contractBalance = await getBalance(provider, buyMeACoffee.address); console.log(""current balance of contract: "", await getBalance(provider, buyMeACoffee.address), ""ETH""); // Withdraw funds if there are funds to withdraw. if (contractBalance !== ""0.0"") {  console.log(""withdrawing funds.."")  const withdrawTxn = await buyMeACoffee.withdrawTips();  await withdrawTxn.wait(); } else {  console.log(""no funds to withdraw!""); } // Check ending balance. console.log(""current balance of owner: "", await getBalance(provider, signer.address), ""ETH""); } // We recommend this pattern to be able to use async/await everywhere // and properly handle errors. main() .then(() => process.exit(0)) .catch((error) => {  console.error(error);  process.exit(1); }); probably want to look into forge run: https://book.getfoundry.sh/reference/forge/forge-run.html#forge-run.",473
657,foundry-support.txt,"FYI, there is currently an open issue open from me regarding the output values https://github.com/foundry-rs/foundry/issues/1475 Is it possible to see slot values in debug mode using forge run --debug bro the docs are the last place to look for info https://github.com/sambacha/foundry-scripts which version of uniswap? Specifically the twap oracle V3* how do i call foundry contracts from ethers-rs without deployment any smart contract on any network? hey there, new foundry user here How to pass multiple arguments to --extra-output in forge build. For example, I want to have evm.methodIdentifiers and evm.gasEstimates as extra outputs. not sure what u mean? Your best move this month 😂 I'll paste the code in a gist and send it in a bit currently reading https://book.getfoundry.sh/, it’s really well explained thanks ser thanks ser :) https://gist.github.com/Perelyn-sama/429bdce3f239eb461a104a5467e8175c I've noticed if you want to deploy instances of contracts from a file, the first contract instance you deploy has to be from address(this) I've tried to use prank(addr) to change it but it kept failing I ended up doing something like this address alice = address(this); thats weird. what forge version are you on? and what do the traces say? (run with -vvvvv to get a setup trace as well) Forge 0.2.0, I've not updated in a while I can't check right now but I'll give you feedback when I do Btw does anyone have resources that really go indept on writing solidity tests in general?👀 i'd recommend updating first, i'm not sure how out of date you are but there might have been fixes related to it i'd also recommend updating foundryup (just run the installer script again at getfoundry.sh) so you get the latest tools etc Thanks man I noticed there's nothing on anvil in the book. Need help with that?👀 Is there a way to not redeploy a contract on each test case, I want 'test A' to test adding of element to storage and later 'test B' to work from that state.",476
658,foundry-support.txt,"But it seems the contract I create is always redeployed on each test case I think the cheatcode 'record' helps with this but I've never tried it though https://book.getfoundry.sh/cheatcodes/record.html https://github.com/onbjerg/foundry-test/blob/master/src/cheats/Record.t.sol @onbjerg using it @onbjerg is it okay that I reference this repo for using test 💀 theres an issue for it, feel free to claim it sure but dont expect the repo to be around. those tests have been migrated to foundry-rs/foundry in the testdata directory thinking adding a way to get a debug trace for eth_call ’s would be good hey folks. I opened an issue before realizing this group exists. happy to close it if it turns out to be a quick answer here (https://github.com/foundry-rs/foundry/issues/1573) so TLDR: forge init --force on an existing hardhat repo sets out = 'artifacts' by default. but that's actually incompatible with hardhat, because the dir structure of those artifacts is flattened. trying to run both test suites results in typechain errors when it finds duplicate artifacts is this a known problem? am I missing something? has anyone hacked together an easy way to drop anvil inside of hardhat yet for js/ts memers? WIP Will share once done I created a helper contract to add a few helper function, initialize and such, then each test contract inherite this helper contract. I notice that if my helper contract hit the stack too deep error, nothing is reported by foundry, after compiling it simply do not run the test...",345
659,foundry-support.txt,"Not a big issue however Hey folks, was wondering whether deploying contract in setUp() function is a stylistic choice, or not Out of curiosity I tried putting my contract deployment straight where I declare it, like SomeContract someContract = new SomeContract(); And it seemingly still behaves the same when I run tests, as in the contract is redeployed for each test case instead of only being deployed once yeah i’d say at this point it’s possible setUp is only stylistic unless i misremember smth @brockelmore nope since we merged a change recently that will print traces for a failed constructor its entirely stylistic previously if a constructor failed, there was no way to get a trace for why it failed but we fixed that recently thus why people preferred setUp should we start soft deprecating it? to simplify things hmmmm maybe? Thanks, I see what the reason was initially I'd argue that stylistically current way it is with setUp() makes more sense, since we know from the docs that this hook is called before every test case Whereas when I deploy or set something in constructor I would intuitively expect this to be a one-time action to happen only before the first test Cant You can start here: https://gist.github.com/sambacha/c30960d6455a32b1a06aa3004ced26a7 there are a few more i didnt get im sure Thanks man Good know, I'll check it out does this not work? we should be able to get fixed if you open an issue Hey all! Trying a basic contract, I'm expecting it to revert but I won't.",328
660,foundry-support.txt,"is there any obvious (yes) reason please ? I've read the docs though 🤔 you have a nested call after your expectRevert, so it's expecting c.gm() to revert, not c.setGm() Damn Thanks my bro keep pilling So like that right ? Damn I had to use bytes(gn) yep this should work Thanks sir Why using require instead of asserting here ? : https://github.com/fei-protocol/tribe-turbo/blob/a00e800a9dfe60358f85c68803c37f33a1ddb0d4/src/test/TurboRouter.t.sol And how to cleanly test for a balance change, do I need to calculate gas price ? check address(x).balance before/after Yes but if it's the transaction sender it removes the gas amount in ETH 🤔 Bro I don't get it, I did the exact same thing right ? Also the console.log doesn't appear to work fuckin' typo! Any way to debug this easily ? What is the first argument for the bound cheat code for? you can turn up the verbosity for tx traces, check the foundry book for more info the value to wrap into the range specified by the second and third args Hello friends I’m so happy this group exists haha Not exactly a foundry support request. But can anyone suggest / know of ways£ to account for multiple rewards token against single vault token / share such that the user only gets the proportional rewards only for the time they have joined and held tokens for? Example contracts? Basically trying to create a 4626 like vaults with shares representing multiple tokens and not just the underlying. Thought of using oracles to implement shares minted based on the value of the asset deposited, but would like to avoid oracles if this could be solved simply mathematically this makes a few assumptions, mainly that you are not dealing with rebasing / fee on transfer tokens Also you have to distinguish between push and pull rewards: • in push rewards, the rewards are sent to holders without their input. • in pull rewards, holders must actively claim their rewards. ref: https://github.com/makerdao/dss-crop-join Actually had a similar problem for building a product but I think you're slightly different. If you want to follow the 4626 paradigm, then I would think all the tokens would have to be able to be equated to each other.",498
661,foundry-support.txt,"For example if there are 100 underlying and 50 rewards, a deposit of 10 underlying means that burning the shares should either return 10 underlying or 4.5 rewards Unless you are simply talking about accruing rewards that don't require burning shares. Also you should want rewards to be distributed over time rather than immediately, otherwise you can frontrun the distribution and get rewarded more than you should have been (this is the case with the MasterChefV1 reward contract with sushi as an example) yes, acruing rewards, something like LPing on curve you’d get CRV rewards + whatever protocol placed rewards on the gauge like LDO. Now, as 4626 vault, users will enter the vault by the curve LP token, but their share should represent 3 different token amounts. Cannot scale them as rewardTokenBalance * shares / totalShares because reward rate varies, also early entrant is legible for more rewards than late entrant I would stop viewing it as 4626, as what you're describing isn't that similar IMO and since you can't conform to the single underlying you can't conform to the standard at all. Trust me I went through the same process of thinking that way. If the rewards are separate rates, why can't you do the standard of tracking value per share for each individual reward token? value per share would require needing oracles which i’d like to avoid if math can solve it You have the total amount of reward accrued by the vault right? So you just update an index by the amount of reward earned by each share can do that, but in that case you cannot determine the number of shares to mint solely on the basis of tokens deposited otherwise you are giving each deposit the same value You should be minting based on the proportion of underlying right? Each holder keeps track of how much of each reward token he has earned. I may be misunderstanding the mechanism you want though. If you aren't doing the burning redemption mechanism similar to 4626 I think what I am describing is what you want yes, it is burning redemption mechanisms. The vault itself is not emitting any rewards, deposit, earn, withdraw. On deposit, vault deposits the tokens further into other protocols and claims rewards from those protocols. Now these claimed rewards need to be given back to the users when they withdraw, so need to figure out a way to tell how much rewards a user has earnt.",489
662,foundry-support.txt,"Need a time factor somewhere, shares alone on the basis of amount deposited won’t work well. Yeah I think the mechanism I described is what you want. Globally for each token you need to keep track of the last know amount of reward the vault had accrued and an index that is a cumulative value of amount earned per share sort of similar to Uniswap cumulative values for TWAPs. So when you update the global state, the index is += (reward balance - lastKnownBalance) / total supply Then for each user, you keep track of each rewards last index. Then you update their earned reward amount by (index - lastIndex) * balance. You add this number to their earned reward and then update their lastIndex to the current index. This means on every transfer/minting you have to update these numbers interesting, yeah, this sounds right, thanks!l Sure thing! Yes of course thanks sir Yo! what is the proper way to verify if returned type from function is number? just > 0? How can't you be sure that a returned type is a number in solidity ? It's typed Hey are there any examples of reading a csv file using ffi? I dont think so - we were contemplating if this deserves a native cheatcode Yeah I made an issue for writing: https://github.com/foundry-rs/foundry/issues/1359 We actually ended up making a CSVWriter contract to handle this, but haven't been able to get reading working quite yet Pushing the limits of Solidity.. We actually hit the default gas limit in one of our simulations 😂 But yeah I'll let you guys know if we can get a csv read working, if not I'll make another issue Hello guys I need help with Foundry It bugs and compiles stuff that should not compile I put up an issue on github. Can anyone help this? https://github.com/smartcontractkit/foundry-starter-kit/issues/17 Thanks for flagging Will check Thanks, its been blocking my development for a while I cant use forge test when not using my project source code I dont want to ever go back to hardhat :( Is there a best practice for accounting for gas usage in a very particular codepath? The execution requires a bunch of setup, thinking of logging gasleft() differences to get a ballpark.",470
663,foundry-support.txt,"I feel like people have previously asked for a cheatcode to start/stop gas counting unfortunately with revm the cheatcode is technically impossible without significant refactoring of the evm if making external calls, gas-report is pretty good what is in the gas snapshot, does that include setUp ? i think so how does anvil work with foundry? i tried adding localhost:8545 to the —rpc-url flag for the forge create command but it did not work Am i doing something wrong? what do you get on the logs from both forge and anvil So I just tried it again and added the first private key from anvil and it worked my bad What if ""forge deploy"" sets localhost as the rpc url by default? https://github.com/foundry-rs/book/pull/298 Lmao, I tried my best 😬 @onbjerg Boys I know the market is bad but look on the bright side ETH contract deployment will be cheaper Also is it intended behaviour that the gas report flag doesn’t do anything when fuzzing is on? wat? No not with stupid ice age coming Probably the dumbest decision made did u try http:// Does vm.deal() internally uses selfdestruct to transfer ether to the recepient? In my test case I have mock contract with no receive or fallback but still vm.deal could transfer eth. I didn't use the private key from anvil, it's all good now Are tests and contracts in different folders ? Or are my eyes playing with me When you run 'forge init' i have a case where i pass Foo.sol in a preprocessor and it generates FooPatched.sol. is there a way to tell forge to use FooPatched.sol when i call build? i decided to do forge flatten src/Foo.sol then pass it to preprocessor and then to ethers_solc::Solc Is it possible to use ffi to read output that isn't UTF-8 encoded? Like reading binary files for instance. They are They could be in the same but we separated them recently for more clarity You can do either the vm cheatcodes don't follow evm rules, it literally just changes your eth balance what do you want to do with a binary file in solidity? right now ffi requires that the return data is abi-encoded I want to load in alot of dynamic data that I would use in my tests, and I was just curious if it's possible to use a more efficient/compressed format.",495
664,foundry-support.txt,"wondering how folks structure their mainnet tests vs. regular/mocked ones. right now i am using a script, something like: forge test -vvvv —match-test testLocal* forge test —fork-url [url] —fork-block-number 123 -vvvv —match-test testMainnet* is there a cleaner way ppl have found to separate local vs. mainnet testing Can maybe put them under a folder and use match path? we use .fork.t.sol with --match-path and --no-match-path, @gakonst folder idea works too hai following up from the foundry channel: just cloned ethers-rs, running cargo test inside ethers-solc I get: failures: ---- compile::tests::can_compile_with_remapped_links_temp_dir stdout ---- thread 'compile::tests::can_compile_with_remapped_links_temp_dir' panicked at 'called `Option::unwrap()` on a `None` value', ethers-solc/src/compile/mod.rs:712:53 note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace ---- compile::tests::can_compile_with_remapped_links stdout ---- thread 'compile::tests::can_compile_with_remapped_links' panicked at 'called `Option::unwrap()` on a `None` value', ethers-solc/src/compile/mod.rs:700:53 failures:  compile::tests::can_compile_with_remapped_links  compile::tests::can_compile_with_remapped_links_temp_dir Hey! is it possible to deal custom erc20 tokens same way vm.deal(AAVE_WHALE, 1 ether); I like, thanks This would be cool Maybe you could fork mainnet Or create a mock token ships built in if you’re using a newer version of forge init.",363
665,foundry-support.txt,"it’s inside forge-std, it has a deal for a token awesome! don’t see it yet, will try to install fresh foundry github.com/foundry-rs/forge-std if your tests have contract Contract is Test (not DSTest) you should be good You still have to instantiate the token yourself first right? That’s what I’ve done on mine but I don’t see how to deal custom ERC20 token there, am I missing something? https://github.com/foundry-rs/forge-std/blob/37a3fe48c3a4d8239cda93445f0b5e76b1507436/src/Test.sol#L93 You can deal custom ERC20 by referring to the address You actually have to instantiate it first though I think yep Ok yeah that’s the bit that wasn’t in the docs lol Use OZ or Solmate and create an ERC20 first then use address(yourToken) as the input for deal Hello, can I set the folding level of a tx trace? For example, I only want to see a tx call with a depth of 4, and no matter how deep it is, it will not be displayed. we dont have folding Well, if trace is too deep, there's too much annoying information. hmm so we should only filter for traces that are N depth deep? just a advice... if we can folder the trace depth, it will make the console log really concise and clear like this , depth 1 call is all my code do in my contrat So I can immediately see how far my contract has been executed if there is a error this should be doable ~easily, do you mind opening an issue? cool, realy helpful. https://github.com/sambacha/foundry-scripts/blob/master/justfile So I'm trying to compile forge locally from my fork, but something weird is happening. Compiling the vanilla version is fine. When I change cli/Cargo.toml to use my fork of ethers-rs which I *literally* just forked, I get a bunch of dependency version problems #ethers = { git = ""https://github.com/gakonst/ethers-rs"", default-features = false } ethers = { git = ""https://github.com/leonardoalt/ethers-rs"", default-features = false } error: failed to select a version for `unicode-xid`.",499
666,foundry-support.txt," ... required by package `ethers-core v0.6.0 (https://github.com/leonardoalt/ethers-rs#4ba8adf8)`  ... which satisfies git dependency `ethers-core` of package `ethers v0.6.0 (https://github.com/leonardoalt/ethers-rs#4ba8adf8)`  ... which satisfies git dependency `ethers` of package `foundry-cli v0.2.0 (/home/leo/devel/foundry/cli)` versions that meet the requirements `^0.2.3` are: 0.2.3 all possible versions conflict with previously selected packages. previously selected package `unicode-xid v0.2.2`  ... which satisfies dependency `unicode-xid = ""^0.2.2""` (locked to 0.2.2) of package `proc-macro2 v1.0.37`  ... which satisfies dependency `proc-macro2 = ""^1.0""` (locked to 1.0.37) of package `async-trait v0.1.53`  ... which satisfies dependency `async-trait = ""^0.1.53""` (locked to 0.1.53) of package `anvil v0.1.0 (/home/leo/devel/foundry/anvil)` failed to select a version for `unicode-xid` which could resolve this conflict any ideas? you need to do a patch instead of a replace because mutliple crates inside the repo reference ethers so u have both gakonst and ur ethers package I saw that in the root's Cargo.toml, but got other errors.",352
667,foundry-support.txt,"Let me see #[patch.""https://github.com/gakonst/ethers-rs""] #ethers = { git = ...} #ethers-core = { git = ...} #ethers-providers ={ git = ...} #ethers-signers = { git = ...} #ethers-etherscan = { git = ...} #ethers-solc = { git = ...} and maybe try a cargo clean should the patch command point to gakonst or my git? patch.xxx < the x should be gakonst its saying ""patch all cargo.tomls in the workspace that use that path/git with the following crates instead"" Awesome, must have done something wrong before. Thanks! File import callback function problem I am trying to build a scaffolding workflow for dapps that have a smartcontracts workspace and a frontend workspace in the same project. When I build a foundry project in a nested empty workspace directory—I get file import callback errors on my dependencies i.e. openzeppelin, forge-std etc. I am assuming that this is a path resolution (base-path and include-path ) problem. Is there a way to globally (solcrc file?)set the path resolution for all lib an src files and remappings? scammer version of me That's what the scammer would say ^real brock - got shared history (think the room shows who is admin/owner? so should be easy to tell who the real ones are) Hey guys! I'm getting a remappings error when running github actions (CI) but locally the tests run fine.",326
668,foundry-support.txt,"| Check configured remappings. | | Location: | cli/src/compile.rs:99 | | Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. | Run with RUST_BACKTRACE=full to include source snippets. oh it also doesnt compile locally? this is because the remappings are working correctly, semi related to this: https://github.com/foundry-rs/foundry/issues/1508 locally it runs fine its a mix of hardhat + forge issue i believe. can you add these lines to your remappings in foundry.toml:  'ds-test/=lib/forge-std/lib/ds-test/src/',  'forge-std/=lib/forge-std/src/', still no luck. it's the same error when running the CI dms error: The argument '--match-path <PATH_PATTERN>' cannot be used with '--match <PATTERN>' is there a particular reason for this? what if we need to run for a particular file and for a particular test How would this work? Seems like exactly what I need for my tests (Re: testing against Uniswap v2 from Solidity 0.8.x) Hmm, I'm guessing you mean the getCode cheatcode Hi, I’m running Anvil in fork mode. What is the order of transactions in the miner block? Can I configure it? For example, hardhat mempool configuration allows to order transactions by gasfees or fifo etc mined* block @mattsse FFI chads, how would you recommend to update contract storage on a roll'd state? Using vm.roll() and a test function to execute what were multiple transactions on mainnet inside of a forked chain. I have ideas to use cast storage $address $slot -B $newblock -r $ALCHEMY_HTTP_URL and afterwards using vm.store() to update the state of the contract in the vm.roll'd block based on that result. Is this sane? Is there a better way? Error:    0: (code: -32603, message: EVM error CreateCollision, data: None) I keep getting this error when I try to deploy to anvil while forking rinkeby In testing, how can one call an external function that was inherited from the base contract into the test contract? The external function in question is setExchangeRate() which exists on FractionalWrapper. The test contract inherits FractionalWrapper.",497
669,foundry-support.txt,"I tried: vm.prank(deployer); setExchangeRate(0.5e27); Compiler run failed DeclarationError: Undeclared identifier. --> D:\mentorship2022\4. Fractional Wrapper\test\FractionalWrapper.t.sol:157:9: 157 | setExchangeRate(0.5e27); Works when I don't fork How too debug in foundry to know why the tests are failing? Not able to understand what is going on in the --debug page https://book.getfoundry.sh/reference/forge/forge-run.html Maybe this can help Look at example 2 Following the forgebook example about testing event emission I see this example: vm.expectEmit(true, true, false, true, address(myToken)); emit MyToken.Transfer(address(this), address(1), 10); if I try to do so I get error[9582]: TypeError: Member ""MinterUpdated"" not found or not visible after argument-dependent lookup in type(contract Exp). are events not exposed? From the forgebook > If the event is not available in the current scope (e.g. if we are using an interface, or an external smart contract), we can define the event ourselves with an identical event signature. https://book.getfoundry.sh/cheatcodes/expect-emit.html oh gotcha, missed that part @stermi heh me too..",285
670,foundry-support.txt,"i just figured out how to solve it yesterday Anyway to get vm.ffi() to utilize environment variables? VM::ffi([""cast"", ""storage"", ""0xdc59ac4fefa32293a95889dc396682858d52e5db"", ""0"", ""-B"", ""14602789"", ""-r"", ""$ALCHEMY_HTTP_URL""]) This won't source the rpc url from the env Looks like this is actively being worked on with a vm.env() type cheatcode :) rn it's fifo, but can easily be adjusted to fees, mind opening an issue for that? so we can make this configureable as well got around this by abi-encoding my rpc url and using ffi with head function getForkRPC() public returns (string memory forkRPC) { /* I've abi encoded the fork url*/ string] memory cmds = new string[; cmds[0] = ""head""; cmds[1] = ""-n""; cmds[2] = ""1""; cmds[3] = ""../.forkrpc""; bytes memory result = vm.ffi(cmds); forkRPC = abi.decode(result, (string)); } Great, thanks Mat:) will do just created https://github.com/foundry-rs/foundry/issues/1599 please add any additional context you think is useful 🙂 Cool Lol create collision interesting, cc @mattsse Unfortunately not. You can redeclare them, this is a known solidity limitation interesting this is an evm error that gets thrown when revm tries to create a new contract address but this address already exists, unfortunatelly revm doesn't log the address otherwise we could check if that address really exxists already Hello Guys! I am doing Ethernaut challenge and trying to debug using Foundry but no idea how to do it (in mainnet fork hardhat) Actually my contrat call another contract but when im debugging the debugger is not jumping inside the others contract any idea? PS: If anyone want to tryhard some challenge and make some ethernaut (Any ctfs let's go on discord!) :) it’s doing a code size check and it’s coming back as 0 so it’s reverting i.e.",445
671,foundry-support.txt,"target isn’t a contract What do you mean by target is not a contract? in the highlighted line https://rinkeby.etherscan.io/address/0x4fFE34FDBDd11C02aF476DcA3a43D41206BF9Ada#code That a real contract deployed on Rinkeby. I forked the rinkeby using hardhat either you put the address in wrong in ur code, there is a bug in your code, or your fork rpc didn’t get passed correctly Hmm really intersting thx! How can i know if my foundry debug is connected to my hardhat local node? you have to provide -f fork_url to the command I am using forge run but i think you are right because when i am checking my node there is no call... you might also just want to do a trace before hopping into the debugger did the foudry use funcSig database？ I will try it out really fast this tools seems to be pure dope!! It's works perfectly! Just one thing again sorry but I am trying to check in docs but seems bit hard for the begining ahah Any Idea how to map an existing address to sol contract? I've asked this before but didn't get an answer, so will try once more 😄 To VS Code users, is there a handy way to get Juan Blanco's extension to use 120 print width without setting up my repo to also be a npm package? I keep hitting auto format and it reduces lines to 80 chars. I know I can setup prettier etc. but I'd really rather leave JS/TS out of this repo. I did also try having a .solhint.json file in my root and that doesn't seem to take affect either. Or, do we need to wait for forge fmt? 😄 Thanks! no good answer from me maybe helpful to get Juan here, if anyone has a contact, else i can reach out No prob, appreciate the response! I guess with Hardhat having their own VS Code extension now and dapptools... fading, it might be best for him to focus on some forge support Hi, I'm trying to get anvil_reset to work but its failing me.",455
672,foundry-support.txt,"Trying to reset to Block 14000000 using this command : curl -X POST localhost:8544 --data '{""jsonrpc"":""2.0"",""method"":""anvil_reset"",""params"":[{""forking"":{""jsonRpcUrl"": ""http://localhost:8545"", ""blockNumber"": 14000000}}],""id"":1}' --header 'Content-Type: application/json' It returns {""jsonrpc"":""2.0"",""id"":1,""result"":null} And then when I query eth_blockNumber, it returns 14000007 which was the block Anvil was at, prior to the reset call. What am I doing wrong in calling anvil_reset? oh nice catch, that's actually a bug where we only reset the fork but don't reflect the changes in the evm metadata, which are accessed by eth_blockNumber Is it only limited to metadata? Im calling evm_mine after resetting, and expect that the mined block be applied on top of the state after block 14000000, not block 14000007 So, say I want to experiment a bunch of different transaction sequences on top of block 14000000. Here's what I'm trying: anvil_reset(14000000) send_transaction(tx1), send_transaction(tx2) evm_mine() # block 14000001 mined anvil_reset(14000000) send_transaction(tx3), send_transaction(tx4) evm_mine() # this should mine on top of block 14000000, and not 14000001 Now if I try to get_balance, it should return the balance after application of tx3 and tx4 and not have to do anything with tx1 and tx2 Quick q - why re you not doing this in Forge? I wasnt aware of similar forking functionality in Forge Does forge have a node with (forking) rpc exposed? what's the relevant command? I'm not running any tests as such seems like you're actually looking for ganache's evm_snapshot and evm_revert which are also supported Still anyone has an idea how to add the source code? When forking we dont have the sourcemaps 🙁 https://github.com/foundry-rs/foundry/pull/1413 This is @joshiedo’s WIP PR If I recall , I left it at a working stage if you want to give it a try Ah, I see, let me try this, thanks.",501
673,foundry-support.txt,"Does anvil_reset functionally differ from snapshot/revert in any way? or even in terms of efficiency Oh sorry I am new to foundry but that really nice thanks a lot! If you guys could make discord to share and maybe make some vocal for CTF etc could be nice to tryhayd :) Although it doesnt really solve my problem, because how do I take the snapshot of 14000000 if I'm not able to reset to it? hardhat_reset allows me to jump to arbitrary blocks, cant do that with snapshot/revert I'm experiencing weird block.number issue in some of my test, in a function in contract A that get call by a other function in contract A, that itself get call by a function in contract B, I query some data like get(block.number - 1). and these test on foundry sometime fail for querying a block that did not get minted. so I vm.roll(10) right before the call, but I see in the stack trace that it try to get(11) as if it was on block 12 when it did the call... how could this happen? and even if it was on block 12, the get() always query block.number -1 so it should never be a issue... Are you forking? no Mmm I’m not sure I fully understand, can you open an issue with the repro? it's still a private repo as we are still in dev and haven't yet done the audit on it, and I don't have the authority to make it public, but I'll try to mock a repo with the same issue over the weekend. Thank you filed a bug report : https://github.com/foundry-rs/foundry/issues/1613. Happy to be involved in testing it out further, thanks:) thanks, should be fixed here https://github.com/foundry-rs/foundry/pull/1614 merged rapidfire wow, thanks Matt and Georgios 🙂 will report back after trying it out Well, that's alot How do I fix it, if you don't mind me asking Is the contract public? would love to debug this You could try deploying a contract to the anvil node while forking rinkeby This doesnt seem to be fixed, I'm querying eth_blockNumber after anvil_reset, doesnt give back the right number.",477
674,foundry-support.txt,"Binaries built at cb0c5af can you please open an issue with a repro? sure, thanks there was actually another bug at the rpc layer that failed to decode the forking params but went undetected because it deserialized successfully... fixed now here https://github.com/foundry-rs/foundry/pull/1617 Could this potentially be an anvil issue? This occurs when I send two TX with the same nonce at almost the same time Lmao Is this on latest master? What command are you running exactly? brrrrrrrr any way to reproduce this? updating everything now one sec Yes Send two tx with the same nonce at the same time Happens about 1 in 5 times anvil 0.1.0 (0fc3532 2022-05-14T00:18:13.05822Z) oh I have an idea what's causing this, will check you just run anvil without a blocktime set? yeah I just run anvil then use cast/forge to deploy contracts 👍 i am here for moral support. i am the one cursing in the video lmfao 😄 Just got in. Was exploring Dapp Tools but found out this is the better move. Looking forward to write contracts with foundry 🤝 Great, thanks, will try it out. I suspected this was the issue because there were already tests written for it (without the rpc layer) and there was no error when I tried different parameter names in the rpc call hey friends - qq - console.logBytes32 does not seem to get decoded in traces 👍 Hi guys...is there a way to tell anvil to reset the chain to the previous state(when it was forked) after executing some tests? this would allow same tests to be ran on cached state without forking gain just configure prettierrc in ur repo local env will override the default Hello guys still newbie would like to know if anyone has an idea why my code is not executed just after the call i got a STOP opcode. And the next instruction is a STOP. Struggling for the moment with Solidity Opcode... hope will be like x86 in my head soon ahaha I think it's coming from my call function which but seems to have all the right param..",470
675,foundry-support.txt,@mattsse how did it go? Maybe you should run forge test -f <fork_url> instead of anvil https://book.getfoundry.sh/reference/forge/forge-test.html Start at forking As an npm package or how? I'm trying to avoid making my forge repos also npm packages.,62
676,foundry-support.txt,"I tried to rebuild the fork of Rinkeby at the last block still the exact same error. Hmm Mind opening an issue for that? https://github.com/NomicFoundation/hardhat/issues/2230 long standing hardhat issue, they dont follow spec correctly (that foundry surfaced) oh looks like it was fixed but issue never was closed. u should update ur hardhat node to a newer version: https://github.com/NomicFoundation/hardhat/pull/2581 Here's the setup we ended up using: Regular test contract names end with ""Test"" Tests where mainnet is forked: ""TestEth"" Tests where Avalanche is forked: ""TestAvax"" And so on https://gist.github.com/ChiTimesChi/a2d16ece1ac67d8797e386ca32cde997 All the RPC urls are stored in the .env for local testing, specified as env variables for CI (either using secrets for private nodes or plaintext for public nodes) - name: Run tests run: ./scripts/foundry.sh Now, for local testing ./scripts/tests.sh launches all tests, while ./scripts/tests.sh Uniswap launches all test contracts containing Uniswap. Latter is handy, when you add a new test and can run it with a simple command, whether it's forked chain or not. Might be overcomplicated and unnecessary, but works well, when you have to set up tests for a lot of different EVM chains. thanks for the detailed response! Have a question myself. I'm setting up a gazillion tests, and need to deploy some contracts in these tests. What's the best solution for storing contract names and their args for test deployment? For hardhat tests I ended up using external JSON file, that can be imported for deploys both in test and prod. Best thing I was able to come up with in my head (haven't actually done this, that's why I'm asking) is writing an external script that would parse the JSON, extract needed contract's name and deploy args, abi.encode that, and use then ffi magic to load name/args into Foundry test. Wdym test deployment? I mean that in the tests (whether forked chain or not) I'm running, I'm deploying a few contracts that I'm currently testing. E.g.",477
677,foundry-support.txt,"typical Foundry test setup for me is to deploy a bunch of contracts (here is the part where I need to load the contract names/agrs), see how they interact with one another. Assuming all good, I can then use the same params in prod revert in fallback function is not working as expected for tests. contract Mock { fallback() external payable { revert(); } } function testFallbackRevert() public { Mock mock = new Mock(); address(mock).call(""""); } [PASS] testFallbackRevert() (gas: 45193) Test result: ok. 1 passed; 0 failed; finished in 416.17µs Though revert functionality works as expected, the tests pass. If this is valid issue, I can create the issue Test passes cause it starts with testFall Rename the testing function to testRevert ;) So I wrote a couple contract to mimic my issue, and I saw that the issue is in my code 🤦‍♂️😂 That been said, I see that the stack tracing seams to skip a few function, this is what lead me to believe the issue was with foundry at first... https://github.com/marc-aurele-besner/foundry-edge-case-testing/runs/6436387986?check_suite_focus=true#step:6:37 In test_ContractB_getFunctionB1, I'm expecting the stack trace to show getFunctionB2, then getFunctionA2, then getFunctionA3. But getFunctionB2 and getFunctionA3 are not in the stack trace... Anyway, thank you, I found the issue in my code, and I still love foundry and the support here 🙏 Still passes .call is a low level call, you need to handle the result (This is not right, the test is not called testFail) That was a sampler..I had arithmetic underflow operation in mock contract fallback. Though the txn reverted for underflow condition, the test actually passed.. And then I moved the same code inside function, reverted and test failed..so looks like it's a bug for fallback It's not a bug You're not handling the revert (bool success, bytes memory res) = X.call(...) require(success, string(res)) Were u able to reproduce? Yes, the test now fails after I check the return values from call.",483
678,foundry-support.txt,"For the regular function, I was using mock.dummy() and hence it was reverting. Thanks I am trying to test transferring ETH from a user to a contract. I wrote a function function depositWeth1() external payable {  address staker = msg.sender;  uint256 amount = msg.value;  SafeTransferLib.safeTransferETH(address(this), amount);  emit Deposit(staker, amount); } and tested it by doing function testCanDepositWeth() public {  assertEq(address(bob).balance, START_BALANCE);  vm.deal(address(wethVault), 0);  uint256 amount = 4.2 ether;  vm.prank(bob);  wethVault.depositWeth1{value: amount}();  assertEq(address(wethVault).balance, amount);  assertEq(address(bob).balance, START_BALANCE - amount); } i then changed my function to function depositWeth2() external payable {  address staker = msg.sender;  uint256 amount = msg.value;  emit Deposit(staker, amount); } function testCanDepositWeth() public { ... wethVault.depositWeth2{value: amount}(); ... } and the test testCanDepositWeth still passes. Am I understanding sth wrongly here? Thanks! Hey folks quick question! Is there an automine option for Anvil (so it creates blocks every X time) my bad, just saw it 😅. Answer is passing the flag ‘-b <seconds>’ Adding to this ^, is it possible or will it be to see the mempool? 👀 Thanks you a lot I am still discovering thanks!! I am now using Anvil which is really nice too Benoit avec un prenom comme ca t'es francais toi :p Guys the debugger is just amazing! but some feature are missing :) 1) Breakpoint 2) Storage windows could be useful (toggle on/off maybe?) 3) Jump to instruction (for example want to jump to SSTORE) like GDB-PEDA/PwnDBG really used by pwner to make binary exploitations :) Really that a super nice work unfortunaly I am really bad in Rust cannot PR this project...",458
679,foundry-support.txt,"Super nice work !! it's actually a character name from my fav movie - knives out 😂 Ont semblent être quelque francophone dans le groupe 🤣 Go faire un discord instant les gars ahah :) Groupe de tryhard le soir je suis chaud :) Nice movie! With ana de armas wooow 😍 Perfection anyone used foundry w/ diamond standard contracts? Could we use forge —debug flag with a real tx (from a real chain for example?) would like to use the debugger If you know how to do it (I only succeed via —debug on fork chain using anvil) cast run <hash> --debug Wow so simple and nice! Thanks! Do you know if we could add some sources inside cast run —debug ? Anyway that perfect thanks lot ! How can I unlock an address like forking mainnet? I want to get access to a address while forking Vm.prank? That's actually a great suggestion I'll try it Thanks What do you mean by get access to a address? ^^ Because vm.prank will do it :) You could also use vm.startPrank(addr,addr) Yeah, I know to use it. I just didn't think about it 👍 Good luck ;) I can’t seem to get forge to use anvil to sign transactions, any ideas? I’m setting ETH_FROM to the default address (0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266) but I still get  0: error accessing local wallet, did you set a private key, mnemonic or keystore? Run `cast send --help` or `forge create --help` and use the corresponding CLI flag to set your key via --private-key, --mnemonic-path, --interactive, --trezor or --ledger. Alternatively, if you're using a local node with unlocked accounts, set the `ETH_FROM` environment variable to the address of the account you want to use What version are you in / what command are you running? https://github.com/foundry-rs/foundry/pull/1413 this is WIP but right direction How can I have some ETH running a local testnet using anvil sir ? Please help me. I am using ds-test. But I got an issues on console logging.",475
680,foundry-support.txt,"Please help me if someone has knowledge One second maxim I got you thank you I hope to know console log on this framework https://github.com/foundry-rs/foundry/tree/master/forge#consolelog Please read this section of the readme. It explains setting the verbosity level to see your logs super! thank you If that doesn’t work def post again oh it's about hardhat. I am working on foundry. There is no way with this? It’s about hardhat style logging in foundry Use the default accounts how to let the forge test decode function selector when print the trace ? I imported the console.sol. but console is not working sir lets compile all the contracts oh it is working now your importing it from within another contract and not separate? Can you show the output of running forge test -vv as shown in the readme yes it is working under the command YeH this is also weird Thank you everyone no thx u u helped urself dear sir, is it possible to let the trace deocde the function selector like tranferFrom() and approve() ? is it me or does foundry just sometimes... not run your tests ?xD What kind of repo is this? foundry init repo Can you share the codebase which repros this? i have to manually make a change in a test file for changes to be picked up rarely though but yeah its a little annoying when this happens like hmm its not a public repo right now but it will be soon should I share then? Its a little messy right now haha typical foundry dir structure @gakonst https://twitter.com/velvet_shark/status/1525696891446603776?s=20&t=l2XokyiFSEkT6g6HLXNQGA Sounds like a cache bug is there a way to manually clear the cache forge clean ah yeah removes all build artificats too Thanks sir Hello foundry frens, I would like to make an implementation of Ethernaut challenges in Foundry to introduce myself to this pilled chads framework and also help people. I would like to make a wizard on which we could choose the level, and it would start anvil, deploy necessary contracts and a single command would run all tests.",458
681,foundry-support.txt,"How should I write this, in rust or what ? are you on macos? these are the same defaults that hardhat uses FYI test test test … junk is the mnemonic Yeah I've noticed that Thanks sir yw ser hello, Compiling ff v0.11.0 error: could not compile ff error: unknown --json option future-incompat Anyone got this issue from compiling forge? what is the rustc version do we use to compile the app now? does foundry prefills an access list in tests? I’m seeing staticalls not cost much and I wonder if its because the address is marked as warm https://eips.ethereum.org/EIPS/eip-2929 Im familiar with this, but was wondering if forge tests will generate an access list or not when measuring gas Hello there! Anyone knows how to use the a selected version using openzepplin? 1.59? Try rustup update Hi, anvil_reset doesnt seem to be completely fixed, opened an issue here : https://github.com/foundry-rs/foundry/issues/1626 for resetting account nonces I have done both.. no luck I have tried to run the curl -L https://foundry.paradigm.xyz | bash link to set up foundry and it's says foundry was added to PATH( I'm using git bash) and I ran the source /c/Users /myusername/.bashrc then proceed to install foundry and it says foundryup: unsupported platform: MINGW64_NT-10.0-22000. Anyone knows what the issue might be? No idea, but MINGW always hard why not using WSL? Going to try that way instead.",349
682,foundry-support.txt,"Foundryup doesnt support windows it should noop on attempted install So how else can I get foundry installed? linux gnu or macos or build from source for win32 Ok sry :( https://github.com/foundry-rs/foundry/issues/1046#issuecomment-1081369551 3.4.1 i think covers that version Hi, I'm trying to go through the creating an NFT with solmate tutorial (https://book.getfoundry.sh/tutorials/solmate-nft.html) but after running forge install Rari-Capital/solmate Openzeppelin/openzeppelin-contracts foundry-rs/forge-std, I get the error 0: ""lib/forge-std"" already exists in the index, you can update it using forge update. When I try to run forge update, I get this error: Submodule path 'lib/forge-std/lib/ds-test': checked out 'c7a36fb236f298e04edf28e2fee385b80f53945f' fatal: Needed a single revision Unable to find current origin/master revision in submodule path 'lib/solmate' Any ideas? @mattsse regarding the infinite loop on anvil, the tx were same nonce but different data, forgot to mention nvm, I figured it out. There's no need to add foundry-rs/forge-std in the forge install command because it already exists in the .gitmodules when you do forge init hello_foundry can reproduce now with different data, thanks! fixing rn Is there a way to batch multiple transactions in a single block inside a foundry test? I'd like to compare some time/block based logic and assure it's the same between tokens, but when doing the deposit in sequence there will always be a dust difference as the deposit was on different blocks. fixed here https://github.com/foundry-rs/foundry/pull/1632 Hello there, I have something weird, using test from foundry I got a function call testpwn() it works in the past.",430
683,foundry-support.txt,"I had to add _mint() to do so i had to pass the contract has abstract i think it coming from that but i don't know how to deal without if anyone has a path ? ;) solc does not generate bytecode for abstract contracts because they're rather interfaces that can have default implementaions and state vars Remove the ""abstract"" 💪 nice! ty https://ethereum.stackexchange.com/questions/128329/how-do-i-set-the-allowance-for-erc20-tokens-in-foundry small question around setting the allowance of ERC20 tokens to transfer them from user wallet to smart contract. Maybe I'm conceptually not understanding who msg.sender is in the test case scenario? 🙂 Thanks for explication it's clear, i tried cause the compiler said so ahah But anyway i will try to figure another way you are right ^^ you need to add constructor() ERC20(“TOKEN”, “TKN”) {} which calls the parent constructor given you inherit erc20 is there typechain integration with foundry? yep typechain works with foundry artifacts Works perfectly thanks again! Don't fully understand yet ahah but thanks!!! https://www.bitdegree.org/learn/solidity-inheritance#:~:text=Solidity%20inheritance%20is%20a%20process,contracts%20have%20a%20default%20constructor. Hello,everyone How could I ignore some file when i run hardhat compile command ? can I call forge/cast from rust? has anyone tried this? I'm getting tired of writing overly complex bash scripts for deployment/onchain txs? try out the scripting branch yeah, basically was hoping to replace my deployment/contract init bash scripts with a rust program. I saw there's some work being done to support solidity scripting too. I'll check out that branch, thanks! ye we are in testing phase rn so let us know of any issues.",389
684,foundry-support.txt,"currently one known issue remains of slightly underestimated gas otherwise should be good to go and will be shipped soon if your going for ethers-v5 output define environment as undefined so it wont output hardhat codegen stuff https://github.com/dethcrypto/TypeChain/blob/b53dd7f745ba165feda4e8bcfabdc0f77fecb460/packages/typechain/src/typechain/types.ts#L26 link? What is the proper syntax for calling a constructor with a struct as its argument? I tried passing struct members individually as --constructor-args value1 value2 but this is failing with Error:  0: Failed to parse tokens 1: Invalid data uh not sure, you’re doing forge run? forge create When trying to dowload from the github repo using foundry via the command ""forge install LayerZero-Labs/LayerZero"" I get the following error message: Installing LayerZero in ""lib\\LayerZero"", (url: https://github.com/LayerZero-Labs/LayerZero, tag: None) Error: 0: ""https://github.com/LayerZero-Labs/LayerZero"" is not a git repository Location: cli\src\cmd\forge\install.rs:145 Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets. Is anyone else trying to use Layer 0 + foundry and ran into the same issue? forge 0.2.0 (35f60f1 2022-05-16T00:08:46.177161Z) forge —version Version is: forge 0.2.0 (0544afd 2022-03-29T19:04:25.585957100+00:00) foundryup it should work though yep, did that, could install from other repos too, oz and chainlink worked fine are you on windows? yes maybe some bug due to the dash? am not sure hmm might be I tried full URL too, as expected same result though Installing LayerZero in ""lib\\LayerZero"", (url: https://github.com/LayerZero-Labs/LayerZero, tag: None) Error: 0: ""https://github.com/LayerZero-Labs/LayerZero"" is not a git repository Location: cli\src\cmd\forge\install.rs:145 Backtrace omitted.",500
685,foundry-support.txt,"Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets. forge install LayerZero-Labs/LayerZero —no-commit I think installation is OK. 🤔 Won't work for me though 🤔 I cloned it into lib and edited the .gitmodules manually now, should be fine as a workaround, right? does git submodule add <…> not work either? is there a well made article that (until the deployment/verify feature is released) I can follow to have both forge (build/test) + hardhat (deploy/verify)? is there a way to support multiple solidity versiosn in a single project? if they don't conflict yes do I just use an array for solc=""something""? You can create multiple profile in foundry.toml. no one single compilation I mean like in hardhat you can have multiple versions and use them at once well idk if hardhat is actually doing all of the managment for you or something but yeah I have legacy code that I'm using with my new code (well integrating uniswap-v2 things) perhaps I should open a feature requrest for this? is it possible to use multiple solidity compiler versions in one project? looking for it in the docs, but not finding it yup, that's supported what's the format? feel free to link to the Book by default auto_detect_solc is true, so it downloads and compiles using required solc versions. But if you want to specify it manually set solc_version, but it only accepts a single version no. huh - I was getting errors using autodetect does a docker image for anvil exist? Thanks! I am trying to test transferring ETH from a user to a contract.",364
686,foundry-support.txt,"I wrote a function function depositWeth1() external payable {  address staker = msg.sender;  uint256 amount = msg.value;  SafeTransferLib.safeTransferETH(address(this), amount);  emit Deposit(staker, amount); } and tested it by doing function testCanDepositWeth() public {  assertEq(address(bob).balance, START_BALANCE);  vm.deal(address(wethVault), 0);  uint256 amount = 4.2 ether;  vm.prank(bob);  wethVault.depositWeth1{value: amount}();  assertEq(address(wethVault).balance, amount);  assertEq(address(bob).balance, START_BALANCE - amount); } i then changed my function to function depositWeth2() external payable {  address staker = msg.sender;  uint256 amount = msg.value;  emit Deposit(staker, amount); } function testCanDepositWeth() public { ... wethVault.depositWeth2{value: amount}(); ... } and the test testCanDepositWeth still passes. Am I understanding sth wrongly here? Thanks! I 👍 this question as well ! Is there a way to reset the storage on multiple contracts to a savepoint within a forge test(or even too the start again in the same test case)? Ex scenario: fuzzy input 1. setup everything 2. save the storage of every contract 3. perform actions 4. reload all the storage of every contract (except the test contract itself) to the save point 5. perform actions in slightly different way(that should yield you the same result if it works correctly) 6. check if steps 3 and 5 got the same result. ——————————————————————————————- This time i did manually patch storage variables on the places that were needed(it was cumbersome though and it took alot longer for me to trust my test). Is there an easy way to do this that ive just somehow missed? Also thanks for making foundry.",415
687,foundry-support.txt,"its a really awesome tool 😁 it should be included in this package https://github.com/foundry-rs/foundry/pkgs/container/foundry Refactor your tests so that the state you want is in a helper function, and each of the scenarios call it and proceed with a different set of actions after the shared setup is done? Yeah that can be done but then i need to spawn two equal contract as within the test function i want to test 2 different sets of actions(that if my contract works should result in the same output.). Already had the setup done in another contract so it was easier to manually patch in this case. Anyway thanks then ik that this isn't really possible and il plan for that in the future(it was a far shot anyway) that's pretty much exactly what I was asking same hey ok so if you remove solc_version = '0.8.13' apparently it's going to auto detect but is there a way to force it to only use specific versions like in hardhat? some contracts the pragma is set for a wide range for instance also I keep getting error[6275]: ParserError: Source ""hardhat/console.sol"" not found: File not found. Searched the following locations: """". do I need to add that library somewhere? How can I read the event emitted by a transaction? I know I can expect one, by providing the event and argument I'm expecting, but how to simply read one? you can't really read events inside Solidity unless they've done some hectic hack using their cheats which they may have Yeah that is what I imagine, I was just wondering if there was a foundry tool to do just that, but anyway I found a other way to solve the issue I had! Thank you for your answer 💪 if you have libs = [""lib"", ""node_modules""] and hardhat packae is yarn installed it should get picked up by default, but you can ofc add the remapping manually Hello, is there a way in Forge to run parametrized tests? That is, I would like to run a test whose input would be an address from a predefined set of addresses. Thank you It would be fairly straightforward to implement this on my own.",455
688,foundry-support.txt,"I just wonder whether this functionality is natively included not natively included Ok, thanks 👍 Hello there, anyone know how to call mapping using cast call? i tried that ? balances is not public on your contract Gosh bit tired sorry... Thanks for quick help.. sorry again! is there a way to run a specific file of tests (and not the rest)? —match-test or —match-path https://book.getfoundry.sh/reference/forge/forge-test.html thanks - should have thought to look there, was looking in the tests section anyone run into this trying to use stdstore? TypeError: Member ""target"" not found or not visible after argument-dependent lookup in struct StdStorage storage ref. Is there a built in way to get the contract address that emitted a log event, when using foundry_evm? RawLog only contains the logs, not the sender I check the doc but no way to find an argument to ""force"" transaction would like to send a tx using cast even if she is reverted to debug the tx ^^ i can see part of your privatekey Oups ahah actually she is test account if it leak more about privacy issue ^^ you need to add a using StdStorage for stdstore; i believe it’s odd because i’m inheriting from this https://github.com/foundry-rs/forge-std/blob/master/src/Test.sol unfortunately inheritance doesnt work on using for syntax https://ethereum.stackexchange.com/a/98923 oh! thank you just run whatever test your running with -vvvv up the verbosity ah I can try that thanks I just implemented the feature in my tests by simply looping over the array and I realized that it's not parallelized and hence is very slow. Do you think this would be something worth implementing? If yes I can submit an official feature request. Thank you this does work thanks thanks :) wouldn't that require you to run solidity in a sort of multi thread/context mode or at least async mode? I think perhaps if there could be a way to write sort of like fuzz tests but letting the dev list out a list of predefined inputs in a file could solve this tho? I was also having this in mind.",440
689,foundry-support.txt,"Or maybe just having some standardized ""comment format"" of the line before the test by which we could defined what values to pass to the test Does anvil support web sockets at the moment? It should What's the point with pranking someone that has ethers ? What's the utility ? I would just like to call prank without having to setup vm address if that's fine by inheriting forge-std Test.sol Also, I'm not very familiar with the 1 « 128 is that a byte shift ? Same port as http? Anyone knows a good place to chat about deep evm stuff? Damn I was just a dumb ass I'm doing experiments and it feels so far the way to go is (1) npm init —yes, (2) npm install hardhat (3) npx hardhat (then select your options) then (4) forge init —force (5) tweak the foundry.toml (src = contracts, out = artifacts, libs = [""node_modules"",""lib""]) - that ""seems "" to work Note (a) step (4) bugs I think and stalls (never finish) with Auto packing the repository in background for optimum performance. If you need to build then you do forge build --hardhat. If you figured out how to setup hardhat + foundry from scratch with a better process, please share 🙏 ! yeah someone should make an npm package to help with setting up both lol with thing that does suck with hardhat rn is the lack of a support chat like here lol been having issues, missing features and overall just being super slow compared to forge The only thing I need to use it for is to make a JS / TS library that interacts with the smart contract (and be able to test it). If I could avoid all this shenanigan I would be glad lol ah the typings? does foundry not support that? but ngl foundry does seem like a hidden gem Maybe ? I dont know. But I'd like the typings AND the testing - like the testing in hardhat for JS/TS is good because it's native. I wouldn't know how to test my JS with forge.",438
690,foundry-support.txt,"ah yes but those are mostly good when it comes to integration and end to end test I find that solidity tests are better for unit tests tho I'm not sure how forge can compile that much faster when they're both using solc no? black magic to me ngl Does anyone have recommendations / advice on how to add scripting for frequently used commands? I've seen repos using makefiles and package.json. I'm currently using a makefile to make running specifics tests a little quicker ""make debug-file FILE=<fileName>"" instead of ""forge test --fork-url https://eth-mainnet.alchemyapi.io/v2/$ALCHEMY_API_KEY --match-path src/test/<fileName> -vvv"" Open to any thoughts / ideas Makefiles or bash scripts cool ty I also have been using makefiles and bash scripts, some emacs helper functions to glue things together today I tried using the output of forge bind in rust and got compile errors but if/when I figure that out I plan on using the rust bindings for all the contracts via ethers-rs for scripting nice, I would be interested to check it out if it's a public repo i am installing some contracts that make use of the openzeppelin @openzeppelin import, so i am finding it hard to use ? would remapping fix this ? and is there not a way for it to try and fetch npm version of the package too ? Im trying to get a keccak256(abi.encodePacked(...)) from bash without using javascript. I came up with this using forge run. Am I crazy? https://gist.github.com/0xJohnnyGault/ce510f71c3d0815570f610832d1db574 Used in this script to test out how to do deploys from bash https://gist.github.com/0xJohnnyGault/383276f597ab12d8c256074e1d704bdc Ha this is kinda wild Did you check the scripting PR.? No. I will look for it. use cast If I can delete package.json I will be forever grateful not sure if we can do packed encoding though dont think we can just to be double sure.",438
691,foundry-support.txt,"When I try to deploy my contract with forge create only the RPC can be specified in .env? the private key must always be passed as an input or can it also be specified in the .env? ok it's not .env but when you say ""env"" you mean foundry.toml wouldn't this be a ""security"" problem having the rpc url visible given that the foundry.toml will be added to git? another question: https://github.com/foundry-rs/foundry/pull/1574 how would this pick up the chainID? because when you do forge creat I think (I'm guessing) that the chain ID is took from the RPC? Can I ignore certain file when compiling my project. For example, I have Contract.sol and other contracts in my src/ dir, can I ignore Contract.sol when using forge build Can cast abi-encode or cast calldata be used to encode structs? If not, do you have any suggestion for calling contract functions with struct params? Do we have a tricks or an arg to force the tx to be send using cast ? cast send 0x8df1e906b3c1c07ad0eaef061ba6141b2893d771 ""testpwn()"" --privatekey example Because My contract works on my archive node but when deployed on ropsten I got a reverted, without the tx i don't know how to debug. because cast run need the tx to use —debug flag Thanks guys! Actually i take it back - I dont have full compatibility, I can test with forge but I can't test with hardhat because the libs are not installed in the right place (forge search in node modules and lib correctly, but hardhat doesn't, so hardhat doesn't know about forge-std). hello everyone I am newer, is there any document that I can start with Appreciate Hi. I’m having difficulties installing foundry. Getting this error When I try the first command, I get the error, `.zshrc: Permission denied` can you try this https://github.com/foundry-rs/foundry#libusb-error-when-running-forgecast (last update on this promise :D ) I end up using this repo which works out of the box (just do a npm install after cloning) - that will do fine for me.",481
692,foundry-support.txt,"https://github.com/gaslimitreached/foundry-hardhat-template It doesn’t work. Can’t use Docker either. Probably because I’m on M1 Your error is permission deny. It not the foundry’s fault. Do you know how I can fix it? Done. Doesn't work Wired. I installed through cargo in M1. if you're refering to this error, perhaps you didn't have a .zshrc before and need to chmod +x ~/.zshrc and try source ~/.zshrc you'd need both node modules and git modules wow ok lemme star this one hey I'm having trouble with verifying on etherscan forge verify-contract --compiler-version v0.8.5+commit.a4f2e591 --chain 42161 --num-of-optimizations 200 --constructor-args $(cast abi-encode ""constructor(address,address)"" 0x09986B4e255B3c548041a30A2Ee312Fe176731c2 0x539bde0d7dbd336b79148aa742883198bbf60342) 0x6a235824f54859A6215296CC456D5499bb6dF4e9 /home/wenxuan27/projects/smolsweep/contracts/src/flattened/TreasureSmolSweeper.flattened.sol:TreasureSmolSweeper J4RJBG71F5X6Q74ZCFAKXI82FE71DU7RBB Encountered an error verifying this contract: Response: NOTOK Details: Invalid API Key now I'm having this issue...",344
693,foundry-support.txt,"weird Ah we should add a ""cast send --simulate"" flag, which prints the trace etc for a TX and maybe doesn't send it (or prompts you to confirm?) book.getfoundry.sh Oh gosh yep should be so nice! with the flag —debug to check what could happen :) First foundryup to latest, will improve the UX a bunch Second maybe your API key for etherscan is wrong? thanks, just did that https://api.etherscan.io/api?module=account&action=balance&address=0xde0b295669a9fd93d5f28d9ec85e40f4cb697bae&tag=latest&apikey=QBRXQUFW241XSQIWTD1IF6TEPSDQCV2KAQ this command here seems to work fine but the exact same api key seems to not work here here maybe I'm formatting the command wrong? also is it possible to verify without an api key? and this is on arbitrum so perhaps that's the problem? tho I did indicate the chain but are they all using the same endpoint? I think etherscan might have different api keys required for arbitrum vs mainnet? Not sure Did you do --chain arbitrum? I did —chain 42161 should I do —chain arbitrum? —chain arb1? This also works yeah that's what I did Anyone seen this before when trying to run forge flatten? The application panicked (crashed).",303
694,foundry-support.txt,"Message: slice index starts at 18446744073709551587 but ends at 0 Location: /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/alloc/src/vec/mod.rs:1848 hmm what tests are you running? Not running tests, just trying to flatten a .sol file from my project there's an import that causes this (simple .sol files with no imports flatten correctly) but I haven't pinned down which import is to blame yet does anvil need an archive node to be able to simulate transactions sir? perhaps the order of the args are not correct? I'm following this: USAGE: forge verify-contract --compiler-version <COMPILER_VERSION> --chain <CHAIN> --num-of-optimizations <NUM_OF_OPTIMIZATIONS> --constructor-args <CONSTRUCTOR_ARGS> <ADDRESS> <CONTRACT> <ETHERSCAN_KEY> Hey there, quick q. When forking with anvil, does block.timestamp still start at 0? That seems to be the case or else I have an error somewhere it should use the fork’s timestamp/block number, but maybe there’s a bug - cc @mattsse nope, only if you want to simulate against state that is more than 256 blocks in the past Can you share the code? cc @rkrasiuk re: flatten Okay, let me foundryup and double check So, I actually just updated everything and now the anvil node seems to not mine transactions sometimes... Anyone else getting this today? In relation to my first issue, I think that was fixed anyway: https://github.com/foundry-rs/foundry/issues/1593 Can confirm block.timestamp is now set correctly when forking, but with the latest anvil version it seems to break sometimes when it gets a simulation that reverts. Haven't dug into it too much but restarting and not simulating any reverting txs works for now. Please open an issue With expected behavior + repro and we track / fix Will do, was a weird one, trying to repro now. If I do will of course open an issue.",448
695,foundry-support.txt,"If not, it's because I was the issue 😄 Okay, unfortunately reproed it and tracked my steps here: https://github.com/foundry-rs/foundry/issues/1661 https://github.com/z80dev/NFTYeeter trying to run forge flatten src/policies/LZNFTBridge.sol for example my guy https://github.com/sambacha/layerzero-contracts justfile the dependencies are now published* https://github.com/sambacha/foundry-scripts/blob/master/justfile lots of this justfile taken from this repo 🙏 👏 https://github.com/sense-finance/sense-v1/blob/dev/justfile you can use hardhat preprocess to rewrite the foundry remappings when using hardhat. Add this to your export in hardhat config preprocess: {  eachLine: (hre) => ({  transform: (line: string) => {   if (line.match(/^\s*import /i)) {   getRemappings().forEach(([find, replace]) => {    if (line.match('""' + find)) {    line = line.replace('""' + find, '""' + replace);    }   });   }   return line;  },  }), }, define this somewhere function getRemappings() { return fs  .readFileSync(""remappings.txt"", ""utf8"")  .split(""\n"")  .map((line) => line.trim().split(""="")); } random question since im not 100% sure, if we are combining foundry and hardhat, we cannot remove lib folder from git source control and expect CI to work right? .gitmodules is included but i always see the lib folder in git source control e.g https://github.com/ZeframLou/foundry-template/tree/main/lib i think the answer is we must include lib into source control, but wanted to be sure Why do you not want lib in git? Hi guys, I have a question: how can I deploy my contract to a specific address in tests? I have been looking through the cheatcodes, can't find a cheatcode can achieve this function. I tried use ""etch"" cheatcode to copy the deployed contract's code to my target address, but this doesn't copy the storage values.",461
696,foundry-support.txt,"could you share a sample repo pls? would be much appreciated Got asked this by other devs if it was possible to ignore in git hey guys is there a way to add solidity formatting to the foundry toolchain (i.e. on compile)? Hi there, may I ask how to change the signer of tx on testing? on hardhat it easier using .connect, how to do it using foundry? vm.prank ohw great, so its part of HEVM? thanks @rhlsthrm Edited my issue out because it turns out it's not on Foundry's side haha is there a way to use the DS-test style loggin in a library? you want it ran before compile right yes Does —gas-report report accurate gas costs in mainnet fork testing when external contracts are called? e.g. if a function does a trade on Uniswap, will it include the full gas cost of that trade? I’m seeing gas reports that look a little too good to be true whats the latest guide on replacing ganache w anvil i can read, preferably in a hardhat project? is it in the foundry book? Hi there! Is there a way to mock to which address a contract gets deployed in the setup() function in the Tests? Asking mainly from the context of interacting with other contracts that have a whitelisted set of addresses that can interact with them. So I want to mock my contract to be one of those whitelisted addresses. is there anything similar to hardhat's size-contracts? forge build —sizes doesn't appear to be accurate What is not accurate about it? Can you open an issue with the expected behavior? Check vm.etch Or the right way to do this would be to overwrite the white list With vm.store / forge-std Yeah I was just exploring vm.etch. But it seemed counterintuitive to do that. The overwriting of whitelist might actually make sense. Thanks @gakonst !! How are people managing avoiding pushing lib dependencies code to repo? Use .gitignore @garythung unless you mean something else Hmm yeah figured. Was curious if ppl were doing anything else Ty I'm trying to verify a cotnract with verify-contract. I get this error Encountered an error verifying this contract: Response: `NOTOK` Details: `Invalid constructor arguments provided.",478
697,foundry-support.txt,"Please verify that they are in ABI-encoded format` the --constructor-args that I'm passing is the same one that I'm passing to the create command but it fails when I try to verify it can i use cast within a script? I'm getting Fail - Unable to verify when trying to use verify-contract, is anyone available to help? urgent I'm also getting tar: Error opening archive: Unrecognized archive format when trying to use foundryup Foundry Support nvm figured both out lol, had to reinstall foundryup so did you solved updating it? Bash script, sure tried to update foundry but still getting the same verify error ok I'm an idiot I had to use cast abi-encode but the question now is, did I had to use it also when I executed forge create? No only verify for some reason can't wait to have the broadcast option ❤️ @joshiedo follow up to broadcast could be to automatically verify newly deployed contracts Is there any plan to have an interactive console in the future ? There is a stale PR called forge shell Which had some early work Nice :) But we never fully integrated Arf ok Also I am wondering something I have some contract designed to produce some results based on math Is there a way to use foundry to get the data somewhere to plot it ? Like I implemented a bonding curve and want to look at the behavior Plot a time series from a datafeed We have talked about a write_csv cheat code 🥹👀 @lucasmanuel_eth has an approach for using ffi to write the output data to the file, I don't have a link to it right now but he might be able to share that https://github.com/z80dev/NFTYeeter trying to run forge flatten src/policies/LZNFTBridge.sol here for example Does anyone know why only one of my contracts are producing gas reports? I have two separate contracts in one file but the gas report is only showing for one contract Internal calls don't get caught Disregard my last message, figured it out, thanks! What does this mean thanks for reporting the issue! just tested it, in ethers-rs we do an assumption that the solidity version pragma is declared after the imports. the temporary fix would be to move the version above the imports in the target file and all imported ones.",471
698,foundry-support.txt,"meanwhile, i'll work on a proper fix wow, I don’t know at what point I even started doing that, but thanks so much for looking into it this makes my life much easier Hello there! Would like to know if you guys know how to get the name of the function cause I only got the keccak ^^ Have you set an etherscan api key? Oh it's local contract, i will give a try using API Key. Still curious about this one :). Any ideas? it does not include costs like calldata gas, intrinsic gas of 21k hey all, I'm having some issues with mockCall since a couple of days (where previously not causing issues/tests where passing, while crashing Forge now). For instance: vm.mockCall(address(myShitCoin), abi.encodeWithSelector(IERC20.balanceOf.selector, address(this)), abi.encode(initialBalance)); is now causing an index out of slice panick crash (while removing the address(this) from the selector fixes it) -> in other tests, I noticed I can still use args to abi.encodeWithSelector, but only 1-2 Any clue on what happened? I'm fully foundryup'd btw maybe a new bug, run with RUST_BACKTRACE=1? Sure: The application panicked (crashed).",263
699,foundry-support.txt,"Maybe something is missing inside my config You can also just checkout previous release I got it to work if you explicity set it in the flag --etherscan-api-key <API-KEY> but can't figure out how to activate it with .env @mattsse if there are any emacs users here, I've written some elisp helper functions for basic forge commands, if anyone thinks they would use it I can maybe package and publish it as I keep extending it https://gist.github.com/z80dev/cbdfc0d9ebcad57d52ec84e292e26975 Hey tried out onbjerg's WIP test coverage branch and was able to get a report but it says 0 lines hit for every file. Has anyone run into the same issue? Based on the PR the branch is working pretty well. Curious if there's something obvious to try. https://github.com/foundry-rs/foundry/pull/1576 any way to get better output on why a certain function is reverting? I'm using -vvv on the test command I must be missing something for sure try -vvvvv done, same output on the reverting function still the same issue ^^ Is this a live contract you're testing? Use debug I'm encountering the following error when deploying and I don't know where it's coming from, does anyone know? I'm trying to deploy the contract with ethernaut Token code, and I've seen the same with other levels of code in ethernaut. Error: 0: Deserialization Error: expected value at line 1 column 1. Response: error code: 1020 Location: cli/src/cmd/forge/create.rs:145 Probably bc the wrong value is being copied into the RPC url field. I ran into the same issue a while back. Have you tried using the Femplate deploy scripts? Much smoother UI than just going witht the raw Foundry deploy script. https://github.com/abigger87/femplate Any friend knows why the test fails please ? https://github.com/iFrostizz/fether/runs/6527657906?check_suite_focus=true Obviously, it doesn't finds the Test.sol but why so ? I seems like I cannot reach the forge-std library from github removed and installed again, and it works ! foundry is top notch ❤️ @bigsky7 Thank you so much. I will try the femplate deploy script.",498
700,foundry-support.txt,"I don't really understand how forge snapshot's is useful, if I don't modify my tests why would it change ? hey guys! so if the setUp changes the state of a boolean to true, is there anyway to again change the boolean to false in a test method? vm.assume does not change the state. even tried rewind from std-cheats, didn't work Instructions unclear, am down 50% What about if you change the actual contract being tested and save some sweeet sweet gas? That's the whole point of the snapshot, tracking gas costs across commits admin ban pls @gakonst Thank you - done hello! New here :) Been having a blast setting up CI/CD using forge, slither, mythril, all with docker I'm now trying to add support for deploying/upgrading proxies (UUPS) and then I'll try other types I tried searching for any utils or support messages regarding the deployment of proxies with the hope of seeing something like hardhat upgrades from openzep, but didn't find much before I jump in and try to build it myself, does anyone know if there is anything out there already so I don't have to reinvent the wheel? :) care to share 👀🫂 happily! nothing is ready yet, just hacking pieces together right now :) the openzeppelin plugin is specific to their contracts , thats what you are looking for correct? Not a generic solution yeah, basically checking the memory layout of the deployed implementation and the new one to make sure its not broken, deploying and upgrading the implementation, etc... i'm going to start writing something but I'm new to rust so i'll probably suck at it :P I guess it can just be a mix of forge/cast commands Alright, but the forge snapshot --check is blocking for the ci script, is that intended as contracts could vary between commits ? What's the issue here please ? I've done as in the docs... https://docs.soliditylang.org/en/v0.6.3/control-structures.html#creating-contracts-via-new Of course, you need to update your snapshot everytime the gas consumption changes.",435
701,foundry-support.txt,"The CI blocks it so that people don't commit things which change gas cost without it being transparent i am installing some contracts that make use of the openzeppelin @openzeppelin import, so i am finding it hard to use ? would remapping fix this ? and is there not a way for it to try and fetch npm version of the package too ? that doesn't look like the syntax try King king = new King{value: 1 ether}(); or post the contract code, really hard to see that You can use forge install, check the docs I just stored to an address, how would that be different ? 🤔 Hey, how can I mock the function so that it returns specific value? https://book.getfoundry.sh/cheatcodes/mock-call.html thanks rahul this is a solc issue, so double check the solc version you're using i am not asking how to install lol i installed a package that is using the @opz import, but foundry doesnt import that way, i cannot change it because it is a git submodule and it isnt getting pushed Okay my bad I guess that you can do a remapping yeah in this example King king = new King{value: 1 ether}(); king should store an address or the contract deployment king not King 👑 An instance of the contract, isn't it ? yah, i looked at remapping but how do i do it ? i cannot change the import statement of the gitsubmodule, i tried and foundry does even realise i changed it locally so i assume it is pulling it from github idk, but basically a fix would be installing the contracts the npm way and making the package detect it yes, which if you cast into and address and return it it should be the contract address let me paste the errors Compiler run failed  ParserError: Source ""@openzeppelin/contracts/token/ERC777/IERC777.sol"" not found: File not found. Searched the following locations: """".",408
702,foundry-support.txt," --> /Users/praise/Documents/EthglobalHackMoney2022/Fractionless/fraction-contracts/lib/ethereum-contracts/packages/ethereum-contracts/contracts/interfaces/superfluid/ISuperToken.sol:7:1:   |  7 | import { IERC777 } from ""@openzeppelin/contracts/token/ERC777/IERC777.sol"";   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^    ParserError: Source ""@openzeppelin/contracts/token/ERC20/IERC20.sol"" not found: File not found. Searched the following locations: """".  --> /Users/praise/Documents/EthglobalHackMoney2022/Fractionless/fraction-contracts/lib/ethereum-contracts/packages/ethereum-contracts/contracts/interfaces/superfluid/ISuperToken.sol:8:1:   |  8 | import { IERC20 } from ""@openzeppelin/contracts/token/ERC20/IERC20.sol"";   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ i have already changed it locally what are your remappings? usually remappings prefixed with @ need to be added manually because they're not autodetected like that oh, dont mind me, it working when i change it locally, but then i cannot push the changes which means other people installing my contracts will get the error before perhaps you're just missing an additinal node_modules entry in the libs = [""lib"", ""node_modules""] config value that is all good locally, i thought outside the box lol oh yes, maybe that if there's node_modules/@openzeppelin the imports should get resolved ok, well it was a hack but it fixed most of it which CI are you referring to? now if you want to install you run npm i and forge install but it works (i think) Git push —recurse=check can that push code to a git submodule repo ? are you wanting to make changes to the submodule? yes Continuous Integration. That guy was asking about jt your on your own with that 🫡 yea i was asking what CI provider? No idea lol, ask him I guess GitHub with the default forge actions the default workflow template doesn’t prevent concurrent workflows Not what I said at all.",478
703,foundry-support.txt,"I was helping him understand forge snapshot --check 🫂 didnt read —check No prob Yes but my point is that if anybody commit, we can see it as there should be differences, or am I not getting something ? @mattsse Was right, I had to to that instead: Exactly, if anybody commits and your CI runs forge snapshot --check you'll see who increased / decreased gas usage. Now, am I understanding your question correctly? 😁 Yeah I think that it answers my question thanks ! So at the end of the day this is preventing all the upcoming CI to pass right ? Let's say that I wan't to add more stuff in my contract running cargo test test_fork_reset (one of the anvil fork test) shows test fork::test_fork_reset has been running for over 60 seconds. And the test seems to be halted. Any idea what might be the problem here? If you make changes to the gas consumption of your tests or contracts you need to run forge snapshot before committing Understood :) thanks No prob! Shit that reverts 🤔 Anybody has an idea ? 0 bytes of code so the contract is not deployed correctly if I remove the value it deploys correctly ooooops I had no ETH lol Weird error though, isn't it ? mind opening an issue with a brieg description of what you ran into? Sure! will do that likely related to rate limited endpoint couldn't reproduce on master this happens in ci or locally? locally we're working on adding proper backoff support so we can wait out these errors when getting rate limited While using foundry I have still to know some JavaScript or not? Not sure if using ether or web3 means that I still have to know some JavaScript for tests oh you might be right, checking rn Was trying to work on api key rotation https://github.com/0xYYY/foundry/commit/8e04cd952da9a19a4a16e743107c6849f999efdc When testing I encountered the problem above, suspecting that it might be caused by my change But just tried on a fresh master branch and still have the same issue test_fork_timestamp test_fork_snapshotting These 2 tests seem to have the same issue Hi, how do I impersonate an account on anvil? a separate question: I am using forge create to deploy to a local node using an impersonated account set in ETH_FROM.",498
704,foundry-support.txt,"Still forge create complains error accessing local wallet, did you set a private key, mnemonic or keystore? Run `cast send --help` or `forge create --help` and use the corresponding CLI flag to set your key via --private-key, --mnemonic-path, --interactive, --trezor or --ledger. Alternatively, if you're using a local node with unlocked accounts, set the `ETH_FROM` environment variable to the address of the account you want to use I have also tried using --from flag forge -h displays the correct address in ETH_FROM in --from description. Not sure if the latest npm release of @foundry/hardhat is up to date or not, but it doesn't seem to output hardhat style artifacts for me, was expecting it to create an artifacts directory like mentioned here: https://hardhat.org/guides/compile-contracts.html#directory-structure This is useful for us because then our forge setup can be used with hardhat deploy and hardhat tasks, which we already have a ton of tooling for finally found the issue https://github.com/foundry-rs/foundry/issues/1688 I also like hardhat deploy / tasks so recently got it setup with a foundry project. Follow this to get setup https://t.me/foundry_support/12328 Need to install the hardhat-preprocess package (called something like that, on mobile rn) Make sure remappings.txt is up to date forge remappings > remappings.txt Only thing is that it of course recompiles the contracts, so you'll also probably want to configure hardhats paths but you can do that out of the box, check hardhars config docs Hope that helps Thank you! Welcome! Do foundry mainnet integration tests work on arbitrum? what this is how i find out there is an npm package? @foundry-rs/hardhat https://github.com/foundry-rs/hardhat this probably has a ton of bugs so please report issues as they appear why do i have to set ETHERSCAN_API_KEY when im just doing a call? I cannot set msg.sender with vm.prank… Is there any example…? ah i needed 0x prefix... which command? maybe we can improve the error message cast call, i think it must thing i want to decode it as a function signature or something by calling an etherscan api or something...",494
705,foundry-support.txt,"hi team - thank you for the project it has literraly changed my dev experience with solidity 180 degrees i’m stuck on the vm.expectRevert test contract - anybody have a clue why this is not working? update: it has to come BEFORE the expected fail call - sorry about that1 Hi everyone, it is my understanding of prank, external call and msg.sender. Is there any error? function testPrank2() public { assertEq(msg.sender, 0xB42faBF7BCAE8bc5E368716B568a6f8Fdf3F84ec); //[PASS] assertEq(DEPLOYER_ADDRESS, address(this)); //[PASS] assertEq(DEPLOYER_ADDRESS, farm.owner()); //[PASS] vm.prank(DEPLOYER_ADDRESS); assertEq(DEPLOYER_ADDRESS, msg.sender); //[Failed] // Because ""assertEq()"" is not external call } I'm getting some weird error when I try to foundryup gzip: stdin: not in gzip format apologies if this is a standard OS issue I should know about, but anyone know what this is/how to resolve it? while I'm at it, anyone recognize an error like this when trying to deploy? 0: (code: -32016, message: The execution failed due to an exception., data: Some(String(""Reverted""))) can you check whether you have the latest foundryup or reinstall directly? I'll try reinstalling directly looks like the deploy transaction reverted? yeah, I _think_ I figured out why in that one, already on the next mishap - now it's telling me I'm not providing <CONTRACT> even though I am ok, reinstall worked for foundryup hi, is there a way to install dependencies by using the SSH keys? I don't want to enter my github uname/pwd everytime haha. EDIT: this is what happens when I use an SSH github url forge install git@github.com/Uniswap/core-v3 Installing core-v3 in ""/home/lulwat/Development/solidity/easylp-sol/lib/core-v3"" (url: Some(""https://github.com/Uniswap/core-v3""), tag: None) Username for 'https://github.com': I looked in the book but didn't find There's a git config you can use to rewrite github to using ssh.",481
706,foundry-support.txt,"One sec https://www.jvt.me/posts/2019/03/20/git-rewrite-url-https-ssh/ You should probably also turn on 2FA But it's weird because it doesn't do this on for instance the solmate repo Yes I have it Oh ok so not related to foundry you think? Is there a simple way to use the broadcast output from the forge script branch for verifying the contracts on Etherscan? why we need to set these 2 lines at first: `address alice = address(0x1337); address bob = address(0x133702);` Is there any way to expectEmit for an event that isn't the first one and is from an external contract? GitHub will be requiring 2FA pretty soon for any user https://github.com/foundry-rs/foundry/issues/924 any idea what this could mean? Error:  0: Compiler run failed  YulException: Cannot swap Variable _1 with Slot RET[abi_encode_address_uint256_uint256]: too deep in the stack by 1 slots in [ var_remainingVST var_firstRedemptionHint _1 _2 expr_mpos param_1 _42 expr_13 _1 expr_10 var_currentTroveuser expr_mpos expr_address_2 _2 expr_13 _7 param_2 _41 TMP[iszero, 0] RET[abi_encode_address_uint256_uint256] ]  memoryguard was present.",302
707,foundry-support.txt,"  0: Hey, does anyone here know if it's possible to verify a contract with a linked library through forge? Means your stack was too deap doesnt even mention the file, also tried commenting everything about this said dep, still the error happens, cant isolate seems to only happen with —via-ir var_remainingVST var_firstRedemptionHint -> are these not var names in some of your contracts? no, its from one of the libs I guess it must be an issue with the yul pipeline though, so i guess reduce stack size or don't use yul ir hm, well that kind of sucks then and i am not even using it though, just for interfaces Hey, does anyone here know if it's possible to verify a contract with a linked library through forge? I didn't see any such parameters documented for verify-contract Hello guys, I would like to learn why did you made foundry in rust and not in go ? Hi! I have a vyper contract I want to test in foundry. How do I create a compatible json artifact file from the vyper code that I can use in foundry with deployCode(artifactFileName)? I had seen this issue and looked at its PR, I'll try the git+https ty! Found it: vyper -f combined_json contract.vy Do you have ViaIR enabled? no the real question is why not C#? wtf It happens when the compiler can not generate a optimization solution pretty sure i think Working on a Haskell port watch this space C# Async spec is superior to Rust 👀😬 Is the contract doing naked imports? But serious question i saw everywhere people building inside this ecosystem using go I thought rust was more oriented for Solana etc Just want to know ahaha This is going to devolve into a Language bashing session . I would advise that you Google the go v rust articles does foundry offer a tool to calculate the total memory of a contract? because it's fast as fuck Ok..",406
708,foundry-support.txt,"thanks anyway ahah forge install git+https://github.com/Uniswap/v3-core/ did work, thanks for the help! Should I add this in the book maybe? try forge install Uniswap/v3-core oh it worked immediately in a test repo lol every time I ask a question it's dumb I'm sorry thank you ^^ Hi there - Can ""cast"" sign and send simple transfers ? I didn't manage to find this, but maybe it's hidden in the more complex examples Of course, cast send --value 1ether <to-address> --private-key <private key> Check out cast send --help for more. Of course you probably don't want to put your private key in the terminal, so can also add -i instead and it will prompt anyone has an example repo with slither? Why would you want to set msg.sender for the prank? The test contract should already be msg.sender so no need to set it. is there a way to remove the absolutePath from the generated artifacts? its annoying how it generates a diff for different envs Yes set it from ipfs to none in config Hello here! Anyone has a idea why everytime the constructor revert even if i am passing the value?! Looks like the msg.value stay at zero.. using version 0.8.0 seems cannot use the msg.value inside the constructor doesn't make any sense... i get this error at the beginning every time i run forge test -w it doesnt seem to affect anything though.",304
709,foundry-support.txt,"does it mean anything to anyone? oh we watch the test dir by default, and it looks like the watcher prints an error if the dir does not exist could you please open an issue so we can track and fix this? working on making this relative, should land shortly does anyone have any idea what this could be from when running —verify Are you sure the construct is reverting because of that? Is there a way to print variable value to trace? How are you deploying ? https://book.getfoundry.sh/faq.html?highlight=Console.log#how-do-i-use-consolelog guys when I add via_ir I get this error Error: 0: Compiler run failed Unknown key ""viaIR"" Unknown key ""viaIR"" not sure why? isn't it supposed to be —via-ir? what command? can I reproduce this somehow? what are the constructor arguments? anything that's not utf8? foundry.toml: [default] src = 'src' out = 'fout' # output directory conflicts with dapptools libs = ['lib', ""node_modules""] auto_detect_solc = true # solc_version = '0.8.14' remappings = [ '@openzeppelin/contracts-upgradeable/=lib/openzeppelin-contracts-upgradeable/', 'openzeppelin/contracts-upgradeable/=lib/openzeppelin-contracts-upgradeable/', '@contracts/=src/contracts/', '@openzeppelin/=lib/openzeppelin-contracts/', 'ds-test/=lib/ds-test/src/', 'openzeppelin-contracts/=lib/openzeppelin-contracts/', ] optimizer = true optimizer_runs = 10 via_ir = true and then I run forge build viaIR is in fact the correct key, what solc version does forge pick? actually not sure if we remove viaIR for older versions correctly ahh is it possible that since I have multiple solc version it sends viaIR to all of them cause I have uniswapRouterv2 which obviously isn't latest solc just addresses probably, but we should remove viaIR for older ones maybe a check? we have this already but we're not checking for viaIR https://github.com/gakonst/ethers-rs/blob/master/ethers-solc/src/artifacts/mod.rs#L104 will add this in a bit are you able to share them? This question might seems weird but I'll ask.",492
710,foundry-support.txt,"Is it possible to view mempool that anvil transactions go to? we just merged support for these https://geth.ethereum.org/docs/rpc/ns-txpool Dumb question, but how do I find the RPC_URL for my locally hosted anvil forknet? It's local host http://localhost:8544/ When you run anvil, you should see it ah, perfect thank you! Oh okay, so I just need call txpool.content in my tests like msg.sender ? ah you mean from within solidity? Yes, sorry for not clarifying thanks that's actually a neat, idea. mind opening an issue for that with a short description of your use case? writing a web3 provider cheatcode contract could be useful I guess. Okay, I will but my usecase isn't all that great totally fine, just to track this and a discussion going, perhaps someone will even take this on I'm trying to simulate a front run attack For this https://github.com/Perelyn-sama/solidity-hacks/tree/master/src Okay, Will do 0x82A0F5F531F9ce0df1DF5619f74a0d3fA31FF561 0xE592427A0AEce92De3Edee1F18E0157C05861564 0x1717A0D5C8705EE89A8aD6E808268D6A826C97A4 0xc778417E063141139Fce010982780140Aa0cD5Ab Weird cause deploying using remix works... looks like this come from forge create any idea? https://github.com/foundry-rs/foundry/blob/master/cli/src/cmd/forge/create.rs#L241-L243 this is odd, should be correct can you try --value 1ether Hello matthias the same issue... Weird right? just to be sure, this happens with latest forge? checking the version right now ^^ try nightly Ok sir! I will do it thanks for the help i will do it this night :) Btw, if not within solidity how else can we do something like that? Hey friendz, got a little confusion today. The tx.origin from the Test is not the same as in the contract that is called.",471
711,foundry-support.txt,"Is that intended ? Feels weird Well yes it's I think the one who deployed the test ? any findings ser tx origin is the caller of the original function msg.sender is the caller of the current function May well be that behind the scenes something is calling something that calls your function (especially in test contracts there is a setup function so something is invoking is that is not the test contract itself) Not sure if this would work if you want a specific tx origin perhaps you could start a prank during the constructor? I have no idea if that would work hey how you doing? ive trying to install foundry in windows 10 for almost an hour and i can not found what else to do. im installing from source and everything goes right until it throws 'failed to compile foundry-cli' error E0061 from rustc can you paste the entire error? fixed here https://github.com/foundry-rs/foundry/pull/1711 looks like we merged breaking changes with the latest ethers bump should be fixed here https://github.com/foundry-rs/foundry/pull/1702 @meetmangukiya oops sorry should be fixed soon great. thanks! does forge run not auto deploy and link libraries like forge test does ? already fixed! thank you! still having issues on windows. im unable to config remappings. i literally copied the example from the docs and is not recognized. windows file system uses \ instead of /. maybe it has something to do with it i tried changing the slashes completely and partially and no success i also tried with a custom remapping => oz/=lib/openzeppelin-contracts-upgradeable/contracts/ you should look at Besu’s RPC for txpool stuff, its pretty useful https://besu.hyperledger.org/en/stable/Reference/API-Methods/#txpool_besupendingtransactions ooo I hope I'm not being annoying lol. I'm trying to test a uups proxy with foundry. How can I initialize an implementation contract through a test? shipoor, ty sir I'm getting a checksum not available error when I am trying to build with 0.8.14 Yes, So I understood my error and I was using prank(msg.sender, tx.origin) but only setting a msg.sender.",462
712,foundry-support.txt,"Thanks sir Good to hear ser when do these new updates get deployed btw? just update throught installation guide pretty sure it's not in yet https://github.com/foundry-rs/foundry/issues/1648 Try updating foundry? Does forge now support compiling multiple versions of solidity? Has done so for a long time I love Foundry and I love Solidity in general If only I knew rust I could make changes and make PRs, good reason to learn it tbh https://doc.rust-lang.org/book/ Start here :) Thank you ser Looking forward to becoming a crab 🦀 Kindest RTFM I’ve seen tbh What are your thoughts on changing default hoax / prank value to 2^256-1 as opposed to the current 2^128 (already uint256 sized number) That and building in a default assume address is not a precompile Updating one of my libs, do I forge install the lib again to pull updates? Didnt see a forge update in the docs forge update exists forge-update Update one or multiple dependencies. If no arguments are provided, then all dependencies are updated. USAGE:  forge update [LIB] ARGS:  <LIB>    The path to the dependency you want to update. OPTIONS:  -h, --help    Print help information does anvil support polygon forking? and is anvil forking pretty reliable? have been having trouble with hardhat forking node's unresponsiveness (after hitting it with a bunch of requests) and wondering if anvil would be any better regarding that I haven't tried it but don't see why it wouldn't work Would recommend giving it a shot and letting us know alright, i'll touch base Yea... Pretty fast too Hello Matthias! Exact same bug with the latest version of foundry with hardhat or remix this is deploying fine! Moving this to the right channel hey guys. I'm trying to use Anvil on a fork of my local Erigon node, with the uniswap smart-order-router.",410
713,foundry-support.txt,"The example call to be used in that repo fails at the following:  Error: division-by-zero [ See: https://links.ethers.org/v5-errors-NUMERIC_FAULT-division-by-zero ] (fault=""division-by-zero"", operation=""div"", code=NUMERIC_FAULT, version=bignumber/5.6.0)  Code: NUMERIC_FAULT These are the last lines In the Anvil logs: Listening on 127.0.0.1:8545 eth_blockNumber eth_chainId eth_chainId eth_call eth_call eth_feeHistory Anvil is being run like so: anvil --fork-url http://localhost:8546 The same call executes sucessfully when pointed at my node directly. Any ideas? hey team, great tooling to work with! I was wondering if there have been any thoughts on integrating the CLI interface with VS studio? -- it would be more like a nice UX for the tool, CLI is totally fine Is there a way to skip traces in libs in the debugger? Ideally only expand them on demand to anyone who has been trying forge script, it would be amazing if you could pull the latest branch changes and try your scripts from scratch 🙏 there's this https://github.com/crisgarner/VSCodeForgeSnippets but no vscode commands atm, but would be useful, I don't think we have an issue for that yet, perhaps someone wants to build it there are already typescript bindings here https://github.com/foundry-rs/hardhat/tree/develop/packages/hardhat-forge I was thinking more of an integration between debugger and VSCode, I like the terminal feeling but some might be afraid touching it Hey folks, anyone had experience recreating off chain message signatures in solidity? I am writing tests for a contract that requires verifying signature, and previously I did it easily with hardhat - I would generate a random string and use ethers.signMessage() to sign with hardcoded pk.",398
714,foundry-support.txt,"Is there a way to obtain create those signatures in solidity? I am struggling to find any concrete info unfortunately I also see that forge has a sign cheatcode - but I am unsure how to use it properly on a string value if I wanna be signing strings Do I just have to get the keccak256 of a string and feed it to vm.sign()? https://github.com/foundry-rs/book/pull/252 there’s the eip712 docs, but not merge yet What a beauty thanks How can we play with multiple accounts in forge test? .prank(address) is it possible to give anvil a forkrpc with a websocket instead of http? it's on the roadmap, but currently block because we need to refactor some ethers-rs types first Hello guys, is it possible to import anvil into my project as a library and use it at runtime in order to fork when necessary? I have a full node at my localhost, so latency won't be an issue have a look at the fork integration tests https://github.com/foundry-rs/foundry/blob/master/anvil/tests/it/fork.rs the EthApi type should allow you to do that is there a way to get logs etc from doing cast call? like if it reverted and logs etc nvm i was on wrong network 😅 only recently started getting libusb errors, used to build fine before, did anything change? Best community out there, you guys are amazing ! Any well done implementation of deployment scripts out there ? did something change w/ startPrank? this test fails for me Continues to fail when I change address(this) to msg.sender as well startPrank only works for the next calls - your assertion is not in a new call (subcall), it is in the main test call oh, that explains that if u feel like it was unclear in the documentation feel free to suggest alternative wording in the book :) i see that a lot of people stumble over this thing but i'm not sure how to rephrase It seems there was a change in foundry and now the block reward is added to the balance of block.coinbase.",433
715,foundry-support.txt,"Is there a variable to read to find out how much coinbase got? Or is this a fixed amount? Also we observed a performance regression in ws Does foundry/forge look for .env files before deploying by any chance? Can't find it in the docs It looks at foundry.toml and certain environment variables, but no "".env files"" afaik thanks, I get that it looks for ETH_RPC_URL but not for eg PRIVATE_KEY you can set up a keystore interesting, let me find docs for this https://github.com/CodeChain-io/foundry-keystore-cli this one? here's a tweet with steps listed https://twitter.com/devtooligan/status/1523716952421584899?s=20&t=nBw5YACsifQgdnH_gt981A I'm trying to run forge test on a contract of mine I've upgraded to v0.8.14 yet get these dependency errors. I've successfully tested with v0.8.9-v0.8.13 Could this be a bug or am I missing something obvious? are you on the latest version? Ah, that was all it was. Figures. 🙃 Hey guys!!! So, I am working my way to make foundry my default tool. Everything works great so far and I love the cheat codes.",273
716,foundry-support.txt,"Is there any way to write deployment scripts like we used to do with hardhat or brownie ? soon, if you want to help out, you can try it out from this PR https://github.com/foundry-rs/foundry/pull/1208 any testing is welcome! https://github.com/foundry-rs/foundry/pull/1711 is the nightly in for this? oh nvm not yet 👍 what is the proper way to use --from with forge create and anvil ? tried forge create --from $ADDRESS $PATH:$NAME but getting ""error accessing local wallet"" i tried setting ETH_FROM as well, which is what the error suggests all den keys should be unlocked They’re displayed when you start anvil thats what im using is it possible to fuzzy enum inputs instead of uint8? which CLI interface would you want exposed in vscode? my gawd this never is going to end Nope What is the error? Did you brew install Libusb? Primarily the debugger interface, I think the vs code interface for debugging is worth extending to do work on smart contracts Hey team! Does Anvil support cheatcodes (Vm)? It seems it doesn't. It does Some of them Which ones are supported? I tried deal and checked balance but it was a no-op. is there a way in foundry.toml to set unlimited gas limit? setting gas_limit = ""18446744073709551615"" should work, that's u64 max as string, setting this as string is unfortunately necessary because of some toml encoding limitations for those using foundry + hardhat, How do you get HH to resolve the libs/ dependencies ? In my config, I point sources to src/ for my contracts, but it cant resolve libs This gets asked pretty often lately, anyone think it's worth adding to the book? I am happy to do so pliss hardhat docs unhelpful https://t.me/foundry_support/12575 Please read from there and follow back the thread a bit, requires another package and changes to your hardhat config file thank you! will read Okay, did a thing: https://github.com/foundry-rs/book/pull/325 I know it's basically a competitor, but I think there are valid use cases anyway for having a nice Hardhat + Foundry setup, at least while Foundry still develops more.",486
717,foundry-support.txt,"Thank you :) I am getting this same error, forge build and forge test exit with 'No files changed...' Is there a fix for this? I have no symlinks Non foundry q if it may be entertained: what's a good performance laptop that's not M1 and for running linux at the best performance it could? Razer im trying to run seaport test locally using foundry but im getting $ forge test Contract code size is 24952 bytes and exceeds 24576 bytes (a limit introduced in Spurious Dragon). ... can someone pls help me out? It means your contract size has exceeded the 24.5kb limit Try to shorten your error codes, use constants or remove functions you don't need thanks. but seaport should work in foundry based on the readme here: https://github.com/ProjectOpenSea/seaport#foundry-tests Oh... That's what you're running? Try enabling optimization if it isn't how do i do it? i tried doing FOUNDRY_PROFILE=test forge test but it didnt work too $ FOUNDRY_PROFILE=optimized forge build Compiling... Compiling 34 files with 0.8.13 Compiler run successful (with warnings) Warning: Contract code size is 24952 bytes and exceeds 24576 bytes (a limit introduced in Spurious Dragon). This contract may not be deployable on mainnet. Consider enabling the optimizer (with a low ""runs"" value!), turning off revert strings, or using libraries. Weird... Default profile sets optimizer runs to 15k yea im wondering if my local setting is messed up 🙁 Ooo? It's a warning tho... So wouldn't be concerned yet... till deployment time but i couldnt see the test output when i do forge test Amazing!!! will do so.",371
718,foundry-support.txt,"Thanks are you on mac? what why? system76 is good https://github.com/brockelmore/foundry_seminar/blob/6ea20a6d97988882419d43191d19dac823d90fa6/src/test/Contract.t.sol#L22 These are two literal address for test is there possibility to pass ipc path to the anvil for forking? working on supporting different connections, this is currently blocked due to some type limitations in ethers-rs which is currently being rewritten It's in the toml file is anyone using slither with foundry? I found that even with slither . --compile-force-framework foundry , slither is still looking for files in the wrong places ""No contract were found in None, check the correct compilation"" does anyone have an idea what I'm doing wrong? is there any ways to stop anvil fork node without killing main process? I'm using anvil as lib in my project I don't think that drop(node_handle) will work properly for this case No I’m on windows nvm, i tried 1. running forge flatten on the .sol files from my src folder 2. pointing slither to the flattened files instead Switching from fork to local only is not yet implemented see set_forking But should be possible to implement this now, so feel free to open a PR or an issue so we can track what’s currently missing so slither works out of the box? Mind opening an issue for that? https://github.com/crytic/slither/issues/1214 Thanks I think it would make sense to have some slither tests in foundry to check that everything’s compatible also there was a slither related fix that landed couple of days ago so if you haven’t done it, try with latest nightly Hello, is somewhere some example how to make Foundry remappings work with Hardhat? I would like to be project to be compilable both with hardhat and forge.",402
719,foundry-support.txt,"Thank you 👍 Hey does anyone know how to pass a struct as a constructor-arg to forge create ? Primitive types are fine, but couldn’t find anywhere documenting how to pass a struct whats the easiest way to display forge create calldata? Yes, I've a PR open here for the book with details on it: https://github.com/foundry-rs/book/pull/325 Cc @gakonst in the words of DJ Khaled, another one LOOOL The hero we need Lmao Hello! I've defined all my test functions in an abstract class. I want to create subclasses that inherit from the abstract class, and for each subclass to run all tests defined in the abstract class. So far I've had no success. It looks like the tests arent running at all. What's the best practice for this? Ah my apologies. was using the wrong class name. everything works. I was wondering how does forge goes about running test, I separated my tests in multiple files, by topic, I see the outcome is grouped by files, but not in alphabetic order. Is it running all the tests in each file in parallel and outputting the result as soon as all the test in a given file are done? I have some very ressource intensive tests and I was wondering what is the best practice? Thank you 🙏 Any idea if foundry supports importing through a symlink? I'm working with a typescript monorepo that automatically creates symlinks and forge doesn't seem to be following the symlink im trying to run seaport test locally using foundry but im getting $ FOUNDRY_PROFILE=test forge test Contract code size is 24952 bytes and exceeds 24576 bytes (a limit introduced in Spurious Dragon). ... can someone pls help me out? seaport should work in foundry based on the readme here: https://github.com/ProjectOpenSea/seaport#foundry-tests Yes it runs everything in parallel, so I would not worry about one slow test slowing the entire suite This should be silenced, cc @0age @mattsse thank you 🙏 thanks Georgios! hey 0age, it would be great if you can share how can i run the test in foundry.",463
720,foundry-support.txt,"thanks 🙂 Ok so remappings will follow symlinks, but the symlink goes outside of the --allow-paths and there isn't a way to pass in an additional allow path. If I could pass in an additional allow path or if the resolved symlink path is automatically added to the allow paths, this would let me use foundry in a JS monorepo where one of the dependencies is a different package Ah this is due to the node modules packages being at the top level package vs under the local node modules? The packages look like this: packages/ |- contracts/ |- contracts-bedrock/ And contracts-bedrock imports contracts, and the JS monorepo set up a symlink in contracts-bedrock/node_modules that points to packages/contracts I used the nohoist property to ensure that the deps didn't get hoisted to the top level node_modules For other deps like solmate Hmm maybe we should have detection for that Js Monorepos like that seem to be the final edge case Would super appreciate this kind of support I am getting error Failed tests: [FAIL. Reason: Setup failed: No such file or directory (os error 2)] setUp() (gas: 0) [FAIL. Reason: Setup failed: No such file or directory (os error 2)] setUp() (gas: 0) [FAIL. Reason: Setup failed: No such file or directory (os error 2)] setUp() (gas: 0) [FAIL. Reason: Setup failed: No such file or directory (os error 2)] setUp() (gas: 0) [FAIL. Reason: Setup failed: No such file or directory (os error 2)] setUp() (gas: 0) [FAIL. Reason: Setup failed: No such file or directory (os error 2)] setUp() (gas: 0) [FAIL. Reason: Setup failed: No such file or directory (os error 2)] setUp() (gas: 0) [FAIL. Reason: Setup failed: No such file or directory (os error 2)] setUp() (gas: 0) [FAIL. Reason: Setup failed: No such file or directory (os error 2)] setUp() (gas: 0) [FAIL. Reason: Setup failed: No such file or directory (os error 2)] setUp() (gas: 0) [FAIL.",486
721,foundry-support.txt,Reason: Setup failed: No such file or directory (os error 2)] setUp() (gas: 0) [FAIL.,27
722,foundry-support.txt,"I was running this in docker and I realized I had to override the host when running anvil —host 0.0.0.0 Is there a good GET endpoint to do a ""health check"" on anvil? altought this framework is super pilled chaddy, we cannot log bytes in solidity ? Ohhh I should use emit What's the best practice ? i am not able to update foundry & getting the error as seen in the screenshot. Does anybody have clue on why is this happening? Was able to solve this by pulling in the latest script by calling: curl -L https://foundry.paradigm.xyz | bash In case anyone else needs to pass a struct as a param in constructor-args, the format is: “(a,b,c)” where a, b and c are the values of the struct in the order the struct members appear. e.g. forge create MyContract -- contract ./MyContract.sol —contructor-args “(0x0d..,0xe3..,0x43..)” “another param” “etc. etc.” Make sure you don’t put whitespace after the commas as this is treated as a character value in the param, not a separator. Has anyone solved the Unknown Contract (0x…) issue in the Debugger? Tried importing the mainnet contract’s code manually for the interface, but it runs on solidity 0.4, so I’m getting a „Incompatible solidity versions“ error when compiling. Would be nice to see where exactly the mainnet forked contract reverts (similar to how it works with tenderly). can i encode a contract deployment with arguments easily? forge create but i dont wanna broadcast the transaction, just get the calldata If you can open an issue in ethers-rs that would help We could add a dryrun option I guess Hello, I tried running forge build --extra-output abi --extra-output userdoc --extra-output devdoc --extra-output evm.methodIdentifiers --force to generate artifacts for scanning by slither, but the generated json files are missing ""AST"" in the artifacts. my forge version is 0.2.0.",439
723,foundry-support.txt,"I tried to rerun foundryup to see if I can update it but it's saying ""tar: Error opening archive: Unrecognized archive format"" Hi guys, I'm running anvil and for some reason I'm getting ""A Tokio 1.x context was found, but timers are disabled. Call enable_time on the runtime builder to enable timers"" - any ideas how to solve this issue? How are you running Anvil? Currently using a nightly build (4fcd7e0) with a fork url What's the exact command you're running? anvil --fork-url ""$1"" --port ""$2"" Hmm This shouldn't be happe Ning The enable_timer part, right? As a matter of fact, on another computer I have it runs smoothly but on this particular one it shows this error Different OS? Nope, Macs but a one is more updated then the other, not sure if that makes a lot of different (different minor of the OS) try reinstalling foundryup Hey frends! I'm trying to make user friendly the solving of Ethernaut puzzles locally thanks to this BLAZINGLY FAST frameword called foundry. Is there a way to programatically tell if wether or not an assertion passed in a test please ? I'm trying to return the bool value in the _checkTest() function Is that ""clean"" if I just add operations as a return boolean ? because the assertions help debug yeah looks okay, if you guys have any suggestions ... I'm gonna push the code and clean it later if needed https://github.com/iFrostizz/fether if you are curious Hi is there a way to get the privatekey of address(this) which is the Test contract? nope why would you need it ? tried to call (uint8 v, bytes32 r, bytes32 s) = vm.sign(privatekey, hash); Can't you store a random key and compute the address instead ? https://book.getfoundry.sh/cheatcodes/sign.html#sign In this case a uint256 is used yes. that's what I do now.",429
724,foundry-support.txt,"my work around now is to gen a new wallet : ```   uint256 privatekey = 1227;   wallet = vm.addr(privatekey);   bytes32 hash = keccak256(""Signed by Wallet"");   (uint8 v, bytes32 r, bytes32 s) = vm.sign(privatekey, hash); ``` I am successfully being able to run forge build But on forge test, the compilation process is running and there is no result coming what could be the reason? Any chances to silent this specific compiler warning please ? Or I can do some dirty shit but I wanted to know if I could do it better ... Hmm this is not the warning you want to be silencing There is ignored_error_codes In foundry toml Maybe you need some context... I'm showing u Which let's you do it Yeah I wouldn't want to silent all of these warnings But I don't remember the error code for this This is odd - try ""forge clean"" This is why it's complaining And then foundryup This function is intended to be overriden for Levels, but as a default I would like to return false Had the same issue, forge clean solves it for me everytime Not working for me I can’t remember/figure out exactly when it happens but often I’d notice that only changed/recompiled test files are being run Are you on latest? yes Tried restarting the terminal session? Sounds odd How is your test called? So as said I could do it the shitty way, by reading from the storage in this function but not the best ... Mhm. Try making the contract ""abstract contract""? Looks like that made it!!! thanks :) As I read the abstract contracts documentation this morning, I thought that it wasn't used for that I have tried running these tests in a separate forge init repo also but error is same Lol, no I couldn't see it ahah anyway I'm gonna read from storage thanks sir I am using unchecked in the code , is this because of that Problem is in this function Whenever I add unchecked to this function. Foundry does not return the tests I was writing the wrong function ? Wdym It's also a bit of an anti pattern I guess to do that But can understand the use case here What's the expected behavior of expectEmit? I thought it was ""look for event in the next call"" but it seems to actually be ""look for expected event before the end of the test"".",492
725,foundry-support.txt,"And the docs are contradictory here—one part says it must be the ""next event"", another says ""before the end of the current function"" I personally think it should be ""look in the next call"" (same for expectCall, which I haven't checked yet to see if theyr're consistent) Could be a bug Maybe we dont clear expected events Don't know , removing unchecked works At the end of a call This can't be the case Pls open an issue with a repro That showcases the issue yea I think this is the case I'll check expectCall too and open an issue How to inherit from the console2 library the same way I would do for a contract ? Like I would like to make my base contract import the console2.sol library and being able to inherit the base contract and just call console2.log without having to import it again in the child contract hmm, has there been any load testing for anvil? For context: we have a huge e2e test suite that makes a crap ton of RPC calls, we're currently running hardhat. We were having issues with hardhat basically hanging, so we were investigating anvil. Anvil also seems to have some issues with read timeouts though or is there a way to hit the endpoint through POST? like getting latest block number through POSTing ` b'{""jsonrpc"": ""2.0"", ""method"": ""eth_getBlockByNumber"", ""params"": [""latest"", false], ""id"": 19}'` not sure if i'm doing something wrong here If I try to curl -X POST http://localhost:8545 -d ""{\""jsonrpc\"":\""2.0\"",\""id\"":416973983,\""method\"":\""evm_setNextBlockTimestamp\"",\""params\"":[""$(date '+%s')""]}"", I just get a {""jsonrpc"":""2.0"",""id"":null,""error"":{""code"":-32600,""message"":""Invalid request""}}% back is there a way to overwrite foundry config inside a given test file? or the best route is to make a script that filter the test file and pass in the config require for each test || test file? What's the best practice when 2 librairies have incompatible solidity pragmas? Modifying the pragma ""in library"" seems dirty.",463
726,foundry-support.txt,"Same question for instance with uniswap-v3-periphery which uses outdated openzeppelin directory structure I'm having import trouble(but it works) setting up vscode in monorepo configuration, anyone know how to do this? Official : https://book.getfoundry.sh/config/vscode.html github: https://github.com/sintaro/dapp-starter-NextJS-Foundry/blob/7f82c7d0ed1e812c01cb08a5d4b568cefd8cd48c/.vscode/settings.json#L5 Hello All, I am running tests with foundry and the console logs are not showing. Any tips? Are you importing forge-std/console.sol? yes Try console2.log() For this solution you need to: 1) import ""forge-std/Test.sol""; or 2) directly import it using: import ""forge-std/console.sol""; Same outcome, I am getting the console log in certain test functions, but not the one iterating through the runs. I want to interface a python bot with a network ran with anvil. Is there a way to run my test file on startup to setup relevant contracts and e.g deal() how do i run tests defined in here https://github.com/foundry-rs/foundry/tree/master/testdata? i think just forge test ? okay no, i think it is executed as part of tests written in forge crate but should be directly executable too, the crate tests just invoke forge internally on those tests Seem there no log in console when I use console2.log in test case and case passed It seems like my remappings are not being used. forge remappings does not show the remappings from my remappings.txt , but they are still listed in forge config hmm I just foundryup'd and a couple of my tests that involve keccak256(block_values, etc) and bit shifting completely fail... havent upgraded foundry in a few weeks did something drastic change regarding hashing or something? is there some foundry integration with tenderly to easily verify contracts? is your git configured for following symlinks ? that is sometimes disabled because it can be an attack vector when git cloning You havent set your content encoding to json call web3_version has anyone found the correct message/...",468
727,foundry-support.txt,"in vm.expectRevert() when you're expecting an arithmetic under/overflow? when we call initialize() from malicious contract, it should get deleted due to self destruct. But when i checked bytecode before and after calling, its showing same bytecode. Do i have to use anvil to test such scenario? saw the issue, on it thanks for flagging this, should be fixed by https://github.com/foundry-rs/foundry/pull/1750 wdym with read timeouts? `evm_setNextBlockTimestamp` expects an integer iirc, looks like you're sending a string? should we be accepting string|number ? forge remappings only prints auto detected remappings which is useful when initializing a remappings.txt if they're included in forge config then they'll be used for solc that's odd, mind opening an issue with a description of the error? Is there any tutorial on how to interact with anvil. I started it using - anvil --fork-url $rpc --fork-block-number $block_num -v. How we can run forge test on local forked mainnet Is this command is correct to test it - forge test --fork-url http://127.0.0.1:8545 -v check the book https://book.getfoundry.sh/forge/forking-mode.html? you don't need a running node instance in order to use forking mode in test but that setup should work as well I am trying to test one of the protocol bug by forking mainnet state at particular block number i.e., selfDestruct using delegate call with foundry. When i am testing it with forge test, its not working but when i tested it on remix, it worked. Looks like with normal forge test, blocks are not mined, it simply run on forked state. Thats why i was trying to run it on local forked node. you can warp and roll though if that helps the default chain ID changed to 31337, and the default block number and timestamp changed from 0 to 1 Use forge-std arithmeticError, i.e. vm.expectRevert(stdError.arithmeticError) https://book.getfoundry.sh/reference/forge-std/arithmeticError.html With roll also didnt help. Am i doing it right? yeah looks right. roll only just changes the global block.number. what exactly do you need for it to do? I am trying to test it on local node.",499
728,foundry-support.txt,"where it will run testSelfDestruct() which deploys malicious contract and print bytecode and when we call initialize() on it, it will selfdestruct malicious contract and then bytecode of malicous contract should display 0x. I am able to test it on remix, but trying to achieve it via foundry why does that need a different block though? okay hmm, seems like it might be a bug although i dont think you need a new block for testing this Since blockchain is immutable. After selfdestruct the current state will not refer the destucted smart contract it is like if you want to free an array you use delete this means that the next state(kind of snapshot) will change but the previous value still exists in blockchain history. I think without having new block number with updated state, it wont work we dont need new blocks to commit new state in our tests, it just changes the state of evm Yeah but just not able to understand why this code is not working which is working on remix but not in foundry. Might be an bug I started writing the Anvil documentation yesterday! I'm gonna send a message in this group when I submit my PR 😃 Thanks :) Is it like everything is mutable in foundry test but bytecode 😄 looked into this, i think we need a new cheatcode transact for committing state, selfdesutruct is in fact not getting committed until the end of transaction rip i should've searched issues before diving into code https://github.com/foundry-rs/foundry/issues/1543 So selfdestruct support is not there. Can we test this kind of scenario using local blockchain node with anvil. I am not sure if we can mimic such kind of transactions on that node. imo anvil should work if it is not currently i dont know how to run forge test on anvil node. i am trying with some forge test commands where i am getting some logs on anvil's console. But contract is deploying another contract for which i think some eth_create* function logs should pop up but all i can see is just eth_get* function logs you run tests in forked mode i tried both with fork and without fork 1. start anvil 2.",450
729,foundry-support.txt,"forge test --fork-url <anvil_url> still not working ah yeah nevermind actually doesnt matter what you are forking, this is not gonna work the evm is still the same and the tx is still only committed at the end of test forking just means using a different starting db, the evm is still the same Thanks for your help @meetmangukiya In this video(https://www.youtube.com/watch?v=Rp_V7bYiTCM&t=4905s), brock mentioned about vm.broadcast() cheatcode. Is it not commited yet? Have installed Foundry, but Forge is not working. Steps done: - curl -L https://foundry.paradigm.xyz | bash - foundryup - forge init test Then I get this error I resolved the issue by running brew install libusb I then run forge build and I get this error This is what my dir looks like I resolved it with forge install foundry-rs/forge-std hmmmmmm uhh why does it say gitmodules twice? One is the gitmodules of the forge-std package I think It didn’t install it in lib by default And one is my gitmodules this is not as straightforward as you would hope you should only have one git modules file Exactly 1 does anvil support state overrides in eth_call? https://geth.ethereum.org/docs/rpc/ns-eth#3-object---state-override-set i think theres cheat codes to do it, but i dont think the rpc uses them https://github.com/gakonst/v3-periphery-foundry/blob/main/contracts/foundry-tests/utils/Deploy.sol#L32 with the deployCode cheat Please open an issue with a repro! forge test -vv? You need verbosity on to show logs Is there a way to test contracts that inherit existing contracts. Trying to test a contract that inherits uniV3, would I have to deploy all the Uni contracts, and the ERC20 contracts that I want to use, as well as create a pool in the setUp() function in order to complete this testing? or would I use forking mode for this? Thanks a lot will look into it is there a way to set immutable variables in tests? king, many thanks! It seems that if I vm.warp(), it adds enough entropy to make my tests pass again.",480
730,foundry-support.txt,"This is the issue https://github.com/foundry-rs/foundry/issues/1753 its still strange behavior and not sure if this was intended espeically since it passes in hardhat and not foundry ^ If you inherit from contract, the children contract code should be in your contract too Hey foundry fam, I have been recently struggling with expectRevert. According book.getfoundry.sh , I have to do vm.expectRevert(bytes(""msg"")). And then call the function that is suppose to fail but its not working for me. I am pretty sure of by test as it worked when I was testing with testFail but I want to test it properly with reason to revert. Can someone help me on this ? For some reason this line isn't working. Trying to set my balance on USDC contract to 1000000000. using --fork-url. Is this possible? has anyone gotten this before `Error: 0: Failed to parse tokens 1: Uint parse error: InvalidCharacter` when deploying a contract first time it's happend to me before. the contracts build fine so i am almost certain i am doing something wrong in my deploy script this time can you please share the command that you used? forge create --rpc-url https://rinkeby.infura.io/v3/api_key \ --constructor-args ""MRT"" ""MRT"" 18 1000000000000000000000 \ --private-key <redacted> src/Token.sol:MRT \ --verify i removed the private key and infura api key just for since it's sensitive info this should work on latest cast/forge oh gotcha that's just foundry up yeah? to pull in updates? ye forge 0.2.0 (4fcd7e0 2022-05-27T00:04:39.67082Z) ah i see just pulled it in thank you! is it possible to use stdstore to change storage value of a private data type? For Anvil, I want to run the setup of a test file on launch. If not then perhaps a separate file (it contains deployments and deal cheatcodes).",443
731,foundry-support.txt,"What is the best way to do this? you are correct, thanks a lot! just following up here, the issue was because I didn't set the content type to be json can you elaborate here? I just wanna hit any endpoint with a GET that returns a 200 so I know the service is alive and running you want a /healthcheck web3_version is the response of version that node client is running https://web3-rpc-debug.vercel.app put in any rpc url do web3_version web3_version will always respond (assuming its exposed) with something, as opposed to other RPC methods that are dependent on state etc but its not a liveness check which is maybe what you are looking for? I have a function where forge is reporting 13k gas usage but hardhat is reporting 90k gas usage... can I assume forge is more accurate 😂 hi, can I somehow enable debug_traceTransaction method on anvil? Hey guys. how do I set blocknumber with foundary. is there something like hardhats mine N blocks function? vm.roll oh ty I get a No srcmap index sometimes while debugging in contract call section. What does that mean? Is creating a contract with new like Contract c = new Contract() inside a test contract is different from creating it with forge create command when doing it on anvil node? Hi together, i have a questions regarding gas estimation for a specific transaction within forge test. If i measure the used gas for a specific call i'm following this pattern uint256 _before = gasleft(); (bool s, ) = address(contract).call{value: value}(calldata); uint256 _after = gasleft(); emit log_uint(_before - _after); Do i need to add on top of this gas estimation the intrinsic cost of a transaction (21k gas + calldata cost) if i want to get the full gas costs for this transaction? Not available yet.",393
732,foundry-support.txt,"https://github.com/foundry-rs/foundry/issues/1737 yes that's correct pretty sure this is solidity internal logic that's not directly mapped to your contract code is there a way to set immutable variables in forge tests? How's that possible? You mean some code that is related to foundry's working but not the code I wrote? like solidity itself managing the stack/memory, @brockelmore could probably explain better if it's not about code coming from an onchain contract during a fork debug, then it's related to generatedSources: ye so the compiler generates yul code for things like abi encoding/decoding, reverts, etc. these are called generated sources they don’t emit a sourcemap by default. eventually we should be able to support source maps for them but not currently Running cargo test test_cheats will pass even with the assert!(false), seems like no forge tests were run, related to https://github.com/foundry-rs/foundry/issues/1666? wow this really help me to speed up the contract development progress! thank you foundry! Can I reproduce this somehow? Its on rocket speed development and production speed 100x. no doubt. Can anyone help this？ do you have a remappings.txt ? Aaah. Gotcha. Thank you. Could someone please help me figure out what would be the command to deploy my contract to anvil? Cannot figure out which flag I use Yes.I made this by forge remappings > remappings.txt openzeppelin-contracts/=lib/openzeppelin-contracts/ ds-test/=lib/ds-test/src/ safe-contracts/=lib/safe-contracts/contracts/ forge-std/=lib/forge-std/src/ —rpc — rpc anvil? or what would be the url localhost:8545? yeah, it should be the last line of the console output when you launch it i think you have an extra forward slash in your remappings for openzeppelin-contracts/=lib/openzeppelin-contracts/ should be openzeppelin-contracts/=lib/openzeppelin-contracts because your import has a /contracts already Good point.Im gonna try. cool lmk how it goes Mmm.It doesn't work.Maybe I have to know .vscode/extension bc forge command like forge test is work openzeppelin-contracts=lib/openzeppelin-contracts correction to my previous text there was an extra slash on boths sides.",499
733,foundry-support.txt,"maybe remiving both so when you say import ""openzeppelin-contracts/contracts/... it would be like saying lib/openzeppeling-contracts/contracts/... my b missed the other slash in the first text take care with how you import in your contracts, doing “./@openzeppelin” vs “@openzeppelin” are not the same/not equivalent How can I troubleshoot why my gas reports are not generating? They work in another project but attempting to do so in a differnt one just runs the test without generating the report. I have gas_report in foundry.toml set. My only test is a fuzzing test if that matters. 2) Also help with my question above would be useful. Can I deploy my test files that include cheatcodes such as deal() to anvil fine? Or should I be doing different deployment compared to whats ran in forge test? Actually just saw the following issue for my first question, second could still use some input :) https://github.com/foundry-rs/foundry/issues/1023 When testing, If I need to test a private/internal variable do i need to use vm.load for that storage slot manually as there is no getter generated? Yes Thanks : ) when's the next nightly build getting released? really wanna try out this retry logic https://github.com/foundry-rs/foundry/pull/1741 merging scripting and then will trigger a release Is there a way to log the message from a require when it fails in a function? Hey @gakonst I hope this isn’t a dumb question but is it recommended to use assert over revert statements with reasons in our tests? Is there some error bubbling / actual reason why I would use assert over revert(“reason for error”) in a testing contract? Lmao my question answered yours Revert(“text”) Require you can do it too I think it’s different syntax check the docs, I think it’s require(statement,”error message”) Thanks man, I'll check it out guys, is transaction simulation in last blocks requires archive node or full node is okay? with simulation on my fullnode i'm getting results that don't match real transaction execution right after simulation.",453
734,foundry-support.txt,"Do we have to use roll cheatcode to update it in foundry test. targetContracts() targetSenders() excludeContracts() targetSelectors() maybe a couple more Yea, was just taking a look at the PR. Nice! HI guys. I'm trying to use expectRevert but have some issues. I've searched and read articles on the net, as well as this forum. Didn't find my issue, so let me ask. I'm reverting an error, like function hmm() public { revert WrongParam(""param1""); } and then trying to catch it in function called testFn(): expectRevert(""param1""); hmm(); The error I've got: [FAIL. Reason: WrongParam(""param1"")] I've tried: expectRevert(""param1""); expectRevert('WrongParam(""param1"")'); expectRevert(WrongParam.selector); None worked. The only way to get it working is to revert an error without params, like revert WrongParam();, then expectRevert(WrongParam.selector); works. Any thoughts? What am I doing wrong? I will appreciate your help, cheers. https://github.com/foundry-rs/foundry/issues/1007#issuecomment-1092067054 🙏 https://book.getfoundry.sh/config/hardhat.html Why should I add hardhat to my foundry project? I think console.log could be the main reason, but we can log now also with foundry...so maybe I am noob a I don't understand :D https://github.com/foundry-rs/foundry/issues/1666#issuecomment-1140423108 left a comment under the issue with an example guessing that we missed catching compilation failures, and in those cases, no tests were ran Oh - @joshiedo is this a bug? Should we upstream this to the book? Some people run both tools side by side! Worth doing it imo, considering the ""popularity"" of custom errors should be increasing. Where will it increase the block.number? On anvil? Because it doesn't increase elsewhere During a ""forge script/test"" block.number is not affected at all, unless you roll Wanna open an issue for it so we track? Or take the Issue response you linked and make it a page? I think this is expected behavior because it depends on the fork block number specified in your test command.",491
735,foundry-support.txt,"@pratraut can you clarify why you expect forge script --broadcast to affect forge test? maybe I am misunderstanding Ok but why? https://github.com/foundry-rs/book/issues/333 English in not my native tongue, so I would leave the actual writing to more skilled people :) Maybe they were hardhat users and are incrementally migrating Yeah i tried it on anvil, it was increasing there but when we check inside test contract, it wont get updated. I checked block.number after every transaction, it was showing same block number But, when/where are you checking ? During the script ? Or inbetween script calls? Can anvil be ran to enable cheatcode transactions? If not are there ways to: 1) deal() an ERC20 2) warp the time of the chain I just used forge init xxx and always receive this error. Foundry is the latest version, I am on windows. What should I do to fix this? Thanks does ""forge build"" work on cli? yes @gakonst I think this is the vcode remappings issue then https://book.getfoundry.sh/config/vscode.html Thanks! I did not read about that Can Anvil be run from code? For example, in one of my projects i run ganache to fork a network when a user clicks a button. Would i be able to run Anvil programmatically? I don't see why not, just write a script Im the docs all i see is how to run anvil from cli App would be packaged and distributed out, so users might not have rust installed. Wouldnt be able to run cli commands in that case I was checking during the script run. Just to be cleared what i tried : 1. anvil -a 1 2. > forge script ./test/Demo.t.sol --tc DemoContract --sig ""testSelfDestruct()"" -vvvv --fork-url http://127.0.0.1:8545 --broadcast --private-key $PK It increasing block number as shown But script log is showing: == Logs == Block number, 0 Block number, 0 0x608060405234801561001057600080fd5b506004 Block number, 0 0x608060405234801561001057600080fd5b506004 Size = , 584 Ah, okay so.",486
736,foundry-support.txt,"To give context, forge script is not actually sending the transactions right after each vm.broadcast(). it collects all the transactions and in the end of running the script: sends all of them so if you depend on the block number, you have to roll, but keep in mind, that it's never certain on what blocks the txes will end up, even if they're sent all at the same time. They might end up on the same block, or diff ones ohh i see. so if we have a case depending on block number, we can write separate test function for each broadcast transaction? In that case, it will get block number in sequence after each test function finished even if we write a separate test function for each broadcast transaction then how we can ensure those test function will execute in certain order. i thought of calling those different broadcast tx functions in one test function in required order. but in this case also it will collect all those transactions and execute at once after function ends. Again back to the same problem Tx order is ensured in one script run. If you want them to be in different blocks, you can pass a --slow flag, and it will wait for a tx to be mined, before sending the next. But can't ensure that they will be released in block 1001 1002 1003 Not sure how to fix this... I think the project is old and so must be upgraded with the latest foundry changes but I do not know how... That's the original project: https://github.com/ciaranmcveigh5/ethernaut-x-foundry forge run deprecated ? forge debug instead fo forge run now sorry about that ok no worries when would i want to use forge script over forge debug ? oh you literally just tweeted about this. let me read up on it ! hehe @brockelmore 😄 Hello, I'm wondering if there is a way within Forge to continue your tests sequentially, starting from the end state of the last test without repasting the prior tests code as setup. Obviously I could just make one massive test, however, i would lose the ux i would receive from individual tests.",434
737,foundry-support.txt,"Thank you in advance to anyone who can help 🙂 one other question relevant to forge script / forge debug i had a couple cases where i needed to get a return value from forge run my solution was to log the value in the script and extract from the output is that the best way to do it ? i assume there's not a way to get the actual return value of the script function ? forge script will print the return values if your script has any forge debug has become an alias for forge script —debug effectively ok thats fantastic, thank you have you considered a --json flag like forge create has ? really just for convenience, but i think i still will need to extract the value from stdout with a regex ? but perhaps its not obvious what would even be in the json sure - we can make that more pipe-able if you wanna open an issue with what you want and potential ways to do oit and we can discuss there when did we get a forge script is there a newsletter for new foundry features or something? we tweet them out and here/the main foundry chat forge script was released today Nice, I'll go check your tweets i noticed that the ""WALLET OPTIONS - REMOTE"" flags for forge script and forge debug are different from the flags for forge create in script/debug it's -a, --froms <FROMS> and in create it's -f, --from <ADDRESS> in both cases it says you can set the env var ETH_FROM i've never been able to get -f or --from to work with forge create and anvil is this a known issue ? (i also was not able to set ETH_FROM using forge create with anvil ) to be clear, anvil prints the 10 funded accounts both private keys and public addresses. I tried using one of the public addresses with the wallet options flags. using private keys works fine If an arithmetic error occurs is there away to get the line number in forge? Obvs with out stepping through with the debugger Sorry for the ping @gakonst but been trying to get an answer to this. dealing an erc20 is not really a cheatcode only dealing ether is Well I guess changing storage then: https://github.com/foundry-rs/forge-std/blob/master/src/Test.sol#L101 rn dont see any cheatcodes other than impersonating accounts hh style. forge cheatcodes are not exposed.",487
738,foundry-support.txt,"So what are my options for giving myself an ERC20 on a fork then? And warping the chain? Does the latter requires many blocks to be mined? there's anvil_setStorageAt and evm_mine / evm_automine https://github.com/foundry-rs/foundry/blob/master/anvil/core/src/eth/mod.rs#L28 i am looking at the current API here Hmm alright thanks. Seems there would be some tooling around doing this stuff but maybe I'm mistaken idk if there are libs that can help you find a storage slot like forge-std does, but can try to copy that logic or do you mean like an sdk that can make these api requests? for that there's hardhat-anvil package https://github.com/foundry-rs/hardhat/tree/develop/packages/hardhat-anvil not sure if it exposes functions that can make the relevant requests though I guess just like the anvil node accepting the type of changes cheatcodes do without validation. But that probably doesn't make sense, the links you've given have definitely helped thank you! yeah forge-like cheatcodes is not there yet, but i suppose its possible to implement them Hi guys, how to best run forge script with local fork? Do we need to run a separate anvil and use localhost:8545 as the rpc url? or is it just --fork-url i think --debug should provide you the traces against a forked state Applied for the fellowship Wish me luck boys 🍀 nope that triggers the debugger just --rpc-url would run the simulation against the chain forge script ./scripts/DeployContract.sol --rpc-url xxxx -vvvv What if we want to test run it first in local fork? Is there an easy way? against anvil? yea use the anvil rpc url there i see. so it needs a separate spin of anvil i was imagining there can be auto-spinning like in brownie which invokes ganache it doesn't need another spin of anvil, it doesnt send out txs unless you run it with --broadcast wait. so without --broadcast what does it do? it runs the script against a forked state, collects necessary txs and write them out to a json file i see. let me try it out I've read the whole twitter thread about the script+deployment functionality but I'm not understanding it very well.",487
739,foundry-support.txt,"Is there a full working guide the explain the best practice to do the whole process? So the vm.startBroadcast is the cheatcode to post transaction onchain, you have to run the script with --broadcast to specify which chain post that to? Another question that I have is about the example made by Georgios about deployment+script. In the example the Script is deploying the contract, calling a function and then checking the state with a require. What would be the meaning of TestScript? Could you make me an example? Because the TestScript is just running the MyScript deploy contract and vefying the same thing (`require`). Also, should the test script use assertEq instead of require? We'll add a proper doc to the book Assert and require doesn't really matter here Same principle as when testing TestScript is just a name I chose.. Any calls that follow a broadcast cheatcode get collected and dumped to a json, if in addition the --broadcast flag is provided they also get submitted to whatever chain your rpc url is sorry maybe I explained wrong, the meaning of that. I didn't understood because the TestScript is doing the same thing that is doing the MyScript file 😄 thanks for the explanation, not I get it! Please help me 😞 Read the error :) you don't need to redeclare Vm Just remove it from your contract and let it be accessible via the inheritance Foundry Support It seems that calling create2 in a forge script depends on the 'DEFAULT_CREATE2_DEPLOYER' already being on-chain. Any idea how to set this up with a blank anvil node? I have tried to create contract with TransparentUpgradeableProxy in the SetUp call in a Test contract and the contract does not deploy. What is the reason for this? However this does work in a regular test function.",368
740,foundry-support.txt,"Hi, quick question I'd like to compare the execution of my contract with some input and expected output pairs This is of course possible by hardcoding the checks in the code, but would it be possible, from Solidity to load the content of a file, parse it to dynamically fill local variables so that I can run the comparison within a loop? Also, the ""stack too deep"" kind of errors (also when you put too many variables inside a struct) are a bit annoying (they make sense for the Solidity production code that will actually run on the blockchain only, so not the testing and deployment Solidity code) so are there any cheats to overcome that kind of issue? I guess no (or not yet) but worth asking, in the end this is just annoying but not a blocker ... the proxy being used is this one: https://github.com/Arachnid/deterministic-deployment-proxy so if you just replay that tx (i think you have to fund it first), you should have th eproxy abailable an alternative is just to fork anvil in one of the N chains which have that proxy is a forge script --broadcast compatible with --verify? there's no --verify flag, yet Yes I noticed the error. But how can I specify that address on my contract? error[6675]: TypeError: Member ""expectRevert"" not unique after argument-dependent lookup in contract Vm. function testSwapInsufficientLiquidity() public { ... vm.expectRevert(""EC04""); pair.swap(3 ether, 0 ether, address(user), """"); } mmm anyone got this error w revert? its like you cannot test the same expected revert in two different tests 🤔 some other people seem to hit same issue ( https://github.com/mattgstevens/forge-test-solidity-errors/blob/master/src/test/ContractErrors.t.sol#L42 ) You can just etch the code like so https://github.com/evmgolf/foundry-create2-deployer/blob/master/src/Create2Deployer.sol after upgrading foundry, no 'out' folder is being made after compilation. No tests/... are thus found in my project.",444
741,foundry-support.txt,"Anyone seeing the same behavior? updated mine just now, seems to work (out is created, and tests pass) strange, I can't get it to work Also nothing with a ""forge build"" in between I'll put up an issue Hey, anybody knows how to add liquidity to contracts that don't have an addLiquidity function but rely on liquidity to work could be a windows issue, please open an issue, with your project layout and forge config Will do in a sec, reinstalling foundry atm to see what that gives Hey guys, is there a reason to use vm.expectRevert over testFail ? You add directly from uniswap Do you know guys if it's possible to debug a ""cast call"" ? no flag debug for the call would like to simulate the call to understand why it revert? ^^ what's the node you're calling? sure you're calling the right address? there's generally nothing we can do in call because that happens in the node Oh pitty it's fork of rinkeby using Anvil -f And here my bad is a fork using hardhat. But no idea how can i debug that. I am trying to debug assembly code when a call is made... you can always make a small script, call it inside, and run with forge script I guess the same happens we you call the remote rpc endpoint directly? Yep unfortunalety ^^ Never made that will check now vm.prank(address) YourContract(addr).ee() and dont forget to pass --rpc-url $url -vvvvv and/or debug if you want Oh like that yep i using `cast call`but yes will try using forge ^^ is it possible to specify multiple solc-version in forge projects? You can test the call of failure, as well as specify what revert message to expect gm hey guys, any idea about this error I'm trying to run some tests, but for some reason I'm getting a rever on some of them im using macos so I was checking the version, just in case, but got this my mate was able to run them without any inconvenient and all of them passed. He's using linux i have a tauri app, i want to be able to allow a user from the front-end to click a button and run a local fork of a network (ex. BSC) im able to do this with ganache via javascript code.",488
742,foundry-support.txt,"is the same possible here? Is there a way to account for tests that rely on mainnet forking (to pass) in the CI? @msolomon4 @joshiedo heh you called it forge clean No good ser Testing the revert message Very weird - pls open issue w repro Just use HEVM_ADDRESS? But you shouldn't need to ever access it, so this is a red flag to me Update foundryup #1776, Matthias had a look at it already! What do you mean? Set the RPC url on CI as a secret Is there a good way to test internal or private functions without creating a getter function? Not really..you could inherit cool, just wanted to make sure I was missing something. Thanks Oh, that's rather straightforward, isn't it. heh yea IMO anvil should include that as a predeploy cause I suspect this will be common, but @evmgolf for now you can work around it with vm.etch(0x4e59b44847b379578588920cA78FbF26c0B4956C, hex""7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe03601600081602082378035828234f58015156039578182fd5b8082525050506014600cf3""); precompilessssssss yep, its nice having a flexible vm https://github.com/pcaversaccio/create2deployer#deployments-create2deployersol @pcaversaccio is in here as well hes the only person i know that has more deployments than sushiswap 🤣 lmaooo 🤣 You can use this via my Hardhat plugin directly https://github.com/pcaversaccio/xdeployer Weird question but some PCs can't install rust, is there an alternative for them ? What pcs? 4GB RAM, 500GB ROM, Intel Pentium, 2.4GHz. Sorry is Rust not installed? Or is your friend trying to install Foundry from.source no With anvil and broadcast, is it possible to simulate selfdestruct? windows 8 Hi. I'm the person in question. Rust installed perfectly, running ""rustc"" on command line does exactly what it's supposed to do. But installing foundry, it froze my PC at 817/819. Good evening from here Georgios.",488
743,foundry-support.txt,"What is 817/819? Does it freeze or does it show some meaningful error? Pls share more context :) It's also possible your machine is old and runs out of memory After it downloads all these, then tries to ""unpack and install"" (I've forgotten the terms exactly) like 819 items. It froze on 817. 👀 I'd open an issue and we can track / fix there Do you want to contribute to the tool or use it? If you want to use it we have binaries I want to use it 🥺. How do I get the binaries? Check foundryup Foundryup? Didn't see anything like that. https://book.getfoundry.sh/getting-started/installation.html Thank you so much for this. I'll start here. How can I test that a transaction fails do to a require statement? https://book.getfoundry.sh/cheatcodes/expect-revert.html Yea, there is something I'm missing... Probably something simple as I've been writing tests with expects for the last 3 days. Doesn't work with internal calls Needs a call pfffft yep You can use testFail in that case as well Ok thanks, ill look into that. gonnat play with forge scripting today, have a lot of contracts to deploy Quick question though In 1 script, if I do vm.broadcast() a = new ContractA(); b = new ContractB(); Will both contracts be completely deployed separately without deploying eachother? For example, in hardhat, if I had 4 different deploys in 1 script, hardhat would just deploy every single file for every contract. Which is why I have to separate all of them into separate scripts or subtasks I don't understand the question, you can put everything in one file And you need startBroadcast For multiple calls didn't work weird, just did foundry up and getting Source ""forge-std/Script.sol"" cannot be found guess I need to update also forge std Sorry I shortened the example for telegram, playing with it right now. Hardhat has weird behavior if you deploy multiple separate contracts in a single deploy script , will report back haha forge update I just tried forge init and i did not see a scripts folder Didn’t work and yes i've updated foundry Will try deleting and installing again try forge update Hey man, I saw some of the content you made for foundry.",492
744,foundry-support.txt,"Great stuff I moved my deployment to a script, and call new Script() from my setUp in my test file. But when I attempt to return the address of a contract deployed in the script (in vm.startBroadcast()) it returns the 0 address Thanks Thought .run() was automatically ran on construction, my bad. are we going to have a Contract.s.sol convention for scripts?😅 @gakonst Is it expected behavior for a TX sent with Cast to an Anvil node to return a status 0 as opposed to a revert? status 0 is a revert, status 1 is success Cool thx was expecting the usual red text Seems this is how to jump forward https://github.com/foundry-rs/foundry/blob/master/anvil/core/src/eth/mod.rs#L283 Is a second ‚forge create‘ command replacing the old pending Tx or sending the tx with a increased Nonce? The latter by default Thanks so I’m going to specify the nonce myself? you would have to purge the tx on the node side to do this what do you mean? theoretically, i can replace the previous tx with a higher gas price and the same nonce, can’t I? i mean for the first one you can always replace a tx same nonce higher pricing or you can make an rpc request to the node if it supports the method of eviction Ah yes, maybe a tag like —replace and then the nonce will be retrieved via getTransactionCount without the ‚pending‘ tag By default it takes the getTransactionCount with ‚pending‘ tag right? https://eips.ethereum.org/EIPS/eip-2831 hardhat_dropTransaction i would imagine anvil has the same or will have the same eventually ""One small note to all forge run users: It was renamed to forge debug! No other changes required beyond changing run to debug (we'll update the docs)."" (https://twitter.com/gakonst/status/1531057690423746560) I don't see how this works... ""forge run"" previously simply ran a function from a contract and returned, while ""forge debug"" starts the interactive debugger.",437
745,foundry-support.txt,"finally got a passing gitlab pipeline testing an upgradeable contract deployment 😐 took me long enough a couple of useful snippets: select solc from foundry.toml in a dockerfile cat foundry.toml| grep solc_version | awk -F= '{ print $2 }' | sed s/\'//g | xargs solc-select use removing the .Linux.g++ from the compiler version SOLC_VERSION=$(solc --version | grep Version | awk -F' ' '{print $2 }' | sed 's/.Linux.g++//g' | xargs) and one that rugged my time for a while... I didn't know that cast abi-decode didn't include the function signature so I had to do this: DATA=""$(cast sig ""$INITIALIZER_SIGNATURE"")""""$(cast abi-encode ""$INITIALIZER_SIGNATURE"" ""$INITIALIZER_ARGS"" | awk -Fx '{ print $2 }')"" I'm not a bash expert but will hack my way through this lol How come forge script has to build every time? Even when I put the script in src/ and run forge build first. how are you calling it ? if you just call the file, he kinda assumes its a standalone script and builds it. if you call the contract, he assumes its part of a project Nice, that works. Is there a flag that skips the compile check entirely? I'm not sure I get it... even a standalone script you need to compile stuff Say you know the project is already built, and you just want to run test/script faster without having to check for compilation. ie just immediately load the files from out/ It would shave some time off the process. Guys, any update on coverage support? Posting here in case since I can't find info in docs and I'm new to using foundry.",371
746,foundry-support.txt,"Does foundry provide a means to generate an ABI? If so, could someone point me to it, please? run forge build, then the abi is stored in out/File.sol/Contract.json:abi Getting this error when trying to deploy stuff on anvil node, any ideas what's wrong with provided rpc url? should not be https:// W/o https it gives this instead lol i mean it should be http://, not https:// Hello There! Anyone has an idea how to change the version of Test.sol ? My contract who i am working is using the solidity version 0.5.0 So there is incompatible solidity version but no idea how to change the version of Test My question is dumb... I removed the contract import and using an Interface for it so i could keep the version right version sorry guys for the question :) Two good points, mind opening an issue for that? Are you passing http://127....? oh I like this idea, wdyt @gakonst? I have a test that is reverting. How can I find which is the line that is reverting? Try increasing the verbosity by passing -vvv, it’d print traces for failing tests Woops, sorry, that fixed things, massive thank you Hey, I'm getting this error on forge test. any idea? thanks for reporting, 1020 is a rate limit error code, we'll include backoff/retry for this as well this looks like a cloudflare error, it would be helpful if you could try to send a request via curl and with -v to get all headers and status code and open an issue with that output, assuming your api key is currently rate limited I tried it in a repo I want to use for a foundry article https://github.com/Perelyn-sama/hey-foundry/tree/master/scripts thank you This question is a bit off topic but I have to ask. When are we supposed to use unit tests and when are supposed to use fuzzing.",402
747,foundry-support.txt,"I love the fact that foundry has fuzzing but I need to know, when am I supposed to fuzzing and when am I not ? sorry this was kind of a mistake: forge script is forge run and forge debug is an alias for forge run --debug can you share what you had to do? what was the issue? does forge scripting not solve this? some progress here by @onbjerg https://github.com/foundry-rs/foundry/pull/1576 how to update forge + cast? foundryup kk I don't really have an opinion here Awesome, thanks a lot man Hey folks. just spent about 2h debugging an issue with remappings in a repo I'm trying to port from brownie to foundry. It's a rather complicated setup for a few reasons: - it depends on @openzeppelin & @uniswap (those are easy remappings) - it also depends on another internal repo, let's call it @myOrg/myOtherRepo - that myOtherRepo actually has it's own copy&pasted version of openzeppelin & uniswap (old stuff, badly structured but already live, so I don't want to open the rabbit whole of fixing it) I'm not sure if the last point is the reason for the weird error I was getting:   error[6275]: lib/openzeppelin-contracts/contracts/access/Ownable.sol:5:1: ParserError: Source ""lib/myOtherRepo/contracts/lib/openzeppelin-contracts/contracts/utils/Context.sol"" not found: File not found.  import ""../utils/Context.sol"";  ^----------------------------^    error[6275]: lib/uniswap/v3-core/contracts/interfaces/IUniswapV3Pool.sol:4:1: ParserError: Source ""lib/myOtherRepo/contracts/lib/uniswap/v3-core/contracts/interfaces/pool/IUniswapV3PoolImmutables.sol"" not found: File not found.",406
748,foundry-support.txt," import './pool/IUniswapV3PoolImmutables.sol';  ^-------------------------------------------^ These were the remappings I had: ds-test/=lib/forge-std/lib/ds-test/src/ forge-std/=lib/forge-std/src/ @openzeppelin/=lib/openzeppelin-contracts/ @uniswap/=lib/uniswap/ @myOrg/myOtherRepo/=lib/my-other-repo/ Also, forge remappings suggested a couple of weird extra entries, I have no clue why: lib/=lib/my-other-repo/contracts/lib/ contracts/=lib/my-other-repo/contracts/_uniswap/lib/contracts/ Now, after 2h hours a friend randomly figured out the fix, which was to add this extra remapping: lib/=lib/ I can't for the life of me understand this. Is it a problem of how this otherRepo is structured? (I conceded that this is likely) or something else? (sorry for the wall of text, I can move this to a gh issue if you feel it's confusing here) Hi everyone 👋 So, I was lucky to start building my first dapp around the time Foundry was announced so I'm spoiled. Now, I have deployed it on Ropsten and kicking it around before considering mainnet. Of course, it is tempting to consider zkSync. Is there any hope of getting Foundry and zkSync working together. I've only just started looking into it and thought I'd ask when I saw zkSync docs suggesting a HH SDK. Hey everyone, ran into some unexpected behavior while running tests across arbitrum — A block.number call within an arbi contract is expected to return the L1 block number from when the sequencer received the txn, but calling block.number in a foundry test against an arbi mainnet fork actually returns the L2 block number instead.",385
749,foundry-support.txt,"Is this expected behavior / is there a way around this? Ive been trying to update forge-std using forge update , however it doesnt seem to be working its not able to find forge-std/Script.sol can confirm my remappings are correct because I can console.log() Ive ran forge update as well as forge update lib/forge-std also dont get many outputs after running them as well do you have a .gitmodules in the root folder [submodule ""lib/ds-test""] path = lib/ds-test url = https://github.com/dapphub/ds-test [submodule ""lib/openzeppelin-contracts""] path = lib/openzeppelin-contracts url = https://github.com/openzeppelin/openzeppelin-contracts [submodule ""lib/forge-std""] path = lib/forge-std url = https://github.com/brockelmore/forge-std [submodule ""lib/DRIP20""] path = lib/DRIP20 url = https://github.com/0xBeans/DRIP20 maybe do a forge remove then forge install What could be the reason of this error? try ./src/PrivateVars.sol:Secret Same error Hey folks, is there a way to write gas reports to a file instead of terminal output? I think it is a more accurate measure of gas compared to snapshotting the tests got it - pls open an issue with exact steps to repro yeah ppl have asked for defaulting to gas reports instead of snapshots and maybe having easier ways to format/parse them, open minded / supportive to any of these Sweet happy to hear it's something people are interested in bruh just inherit from the solc dockerfile how do you get the address of the deployer in a script? FROM ethereum/solc FROM yourshit here seems lke msg.sender is giving me the default value not reading the --mnemonic-paths ./mnemonic.txt waaaaaaaaaat I’m encountering the exact same issue, and can confirm adding lib/=lib/ fixes it. Here’s a repo that reproduces it (if you remove the extra remapping): https://github.com/timeless-fi/swapper cc @mattsse @zeframl can you try on foundryup -b master if it still occurs? trying this now i think i reported this bug sounds similar they just fixed it still occurs lib=lib is indeed weird mmm This is weird yeah.",488
750,foundry-support.txt,"Cc @mattsse maybe either bc no auto solc detect or bc the libs have both src and hardhat style layouts https://github.com/sambacha/foundry-scripts/blob/f4fc0073f87b4af032da848515e82a0893288109/scripts/git/submodules.sh#L13 Get to know the repo is open sourced in dev channel before the announcement, nice try libs = ['lib'] thats suppose to be a field in the toml file by itself not within the remapping part doesn’t work 🙁 the forge script --mnemonic-paths $PATH not working wdym not working? documentation says --mnemonic-path and cli says --mnemonic-pathS also if I use the mnemonic and call msg.sender, still shows the default from address wanna open an issue some parts fo the feature are better tested than others sure, wanted to make sure first I wasn't doing something wrong Is there a directory for scripts yet? @gakonst When you run forge init nope should there be? Yeah, I think so. A script folder with a file named Contract.s.sol containing a script boilerplate would not hurt. I'll move this to GitHub. Will also try to investigate a bit more myself, since now it's clear I wasn't just going crazy one thing both my repo and @zeframl 's have in common is that both are failing at imports that use relative paths from inside a lib module, and foundry seems to replace that with a weird final path e.g.: ""import {NegativeYieldToken} from ""./NegativeYieldToken.sol"" in the error msg becomes: lib/timeless/src/lib/timeless/src/NegativeYieldToken.sol where it should just be lib/timeless/src/NegativeYeldToken.sol yep and the lib/timeless/src/ prefix is added even to the uniswap libraries which are not used in the timeless repo from what I'm seeing, the culprit is that forge remappings shows this: lib/=lib/timeless/src/lib/ and from a look at the code, the remappings file extends, not overwrites, the default ones so by adding lib/=lib/ we're essentially removing that one both your repo and mine have a lib folder somewhere in the dependency repo.",464
751,foundry-support.txt,"so maybe forge is getting confused with that? moved here: https://github.com/foundry-rs/foundry/issues/1797 bump thanks for reporting, will look into this there's an open issue for that https://github.com/foundry-rs/foundry/issues/1649 working on support for that for what it's worth, I'm looking into it right now. seems to be in the // use auto detection for all libs part of the remappings logic. in the case it helps you narrow it down got it. will follow this issue instead, thanks for the response! found the issue and fixed it getting ""transaction underpriced"" with forge script on polygon regardless of --gas-price, is this a bug? EDIT: solved adding --legacy flag I cloned and modified the forge-template and when I do asserts that should fail they seems to pass. but if I run the test with -vvv I see that they are not satisfied. Have I done something wrong or it's a bug in forge? ok no it's an even strangier behaviour, if I have a failing assertEq in setUp forge will mark all tests as PASS even if the is the same assert in the test (that should fail) https://github.com/sambacha/forge-scope I'm making my custom template from hardhat-foundry-template...anda when using VSCode anda the Solidity+hardhat plugging it errors in imports (e.g imports from ""solmate/..."")...does anyone has any workaround to solve it? I guess using complete paths or assume the warning/error of the plugging.",327
752,foundry-support.txt,"Thanks in advance 🛠️🔥 Make sure you check your remappings are correct? Especially with hardhat/foundry templates there could be tricky variations of where your submodules go and how they should be accessed in remappings I've got solmate/=lib/solmate/src/ but seems not enough for the plugging 🤔maybe some config in hardhat.config.ts > paths (?) is the feature to automatically verify the contract is in the current version of foundry? To verify on deploy you need to specify your etherscan api key in .toml, and supply —verify with forge create Also the problem affects trying to run solidity-coverage 😅 Unfortunately the hardhat VSCode plugin does not respect remappings.txt - when using foundry best to stick with Juan Blanco's VSCode plugin We didn't put too much in the hardhat/foundry template on purpose, but let me see if I can get Solidity coverage running. I'm guessing you've made no changes to the template? Yes, I made some...here's my custom template (right now coverage is working bc I used complete path in imports): https://github.com/gperezalba/hardhat-foundry-template EDIT: but regarding coverage I think everthing is unmodified from your template Okey, I'll try...thanks;) For an exercise I am trying to read the secretPassword var Where am I wrong? My sig is wrong, but I am not sure what it should be Is the file with the secrets called PrivateVars.sol ? yes You answer is in the comments.",320
753,foundry-support.txt,"the variable is private and you can't call it from the test contract IIRC you also need a deploy step in the tests but I havent used forge std so this might be different now signature should be Secret.getSecretPassword.selector I am trying to reproduce this: https://medium.com/coinmonks/a-quick-guide-to-hack-private-variables-in-solidity-b45d5acb89c0 likely need to make it an instantiated version so Secret(address(0))… sigh i mean Secret(address(0)).getSecretPassword.selector oh wait maybe not needed go back to what i said before this When i add read I have errors :( I mean if it is not clear, I just want to read the content of that private var look at the last function here in this test https://github.com/foundry-rs/forge-std/blob/master/src/test/StdStorage.t.sol line 241 the issue is it’s a string which isn’t really support unless it’s less than 32 bytes or you get more technical you would do read_bytes32() not just read yes I am doing that now Is there any way to get anvil to hold onto events from blocks earlier than the latest head block? Same also using a uint and not a string. It seems to not see storage correctly. wait it looks like u don’t actually create the other contract.",276
754,foundry-support.txt,"i think you need to do some more fundamental learning of how solidity works before trying to read private variables in my opinion Why are you saying that I did not create the other contract? forge create src/PrivateVars/PrivateVars.sol:Secret --rpc-url XXX --private-key XXX --constructor-args ""12345"" https://rinkeby.etherscan.io/bytecode-decompiler?a=0xb671baeeea2734988d49f2ae31ed44a5ed5baf12 events are stored as part of the transaction object so they should be available for all blocks so if you're unable to retrieve some, perhaps we have a bug or the query is suboptimal @mattsse My setup has a total of 23 txs (so anvil is sitting at block height 23) and when I run: curl --location --request POST 'localhost:8545' \ --header 'Content-Type: application/json' \ --data-raw '{ ""jsonrpc"":""2.0"", ""method"":""eth_getLogs"", ""params"":[{  ""fromBlock"": ""earliest"",  ""topics"": [] }], ""id"":75 }' which should get all events from genesis, I only get the events from the most recent block oooh you deployed it sorry @brockelmore r u providing an rpc for the forge test command Mmm nope...",284
755,foundry-support.txt,":D However, just tried if I launch like this using the same rpc url used for the create I have the same error: forge test --rpc-url XXX why don’t u switch everything to just local and test like that I tried with anvil and it is the same will be less complicated and remove variables i mean just as a standard test setup no anvil What do you mean? How should I launch forge create? book.getfoundry.sh < just go look at how to write a test and use the setUp function no forge create needed Yeah I have to just use forge test I know, but this does not change Unless you mean something different it puts everything in one place and i can see more easily what you are doing wrong Not sure what you mean @brockelmore oh thanks for reporting this, there was indeed a bug with the ""earliest"" from field fixed here https://github.com/foundry-rs/foundry/pull/1806 thanks for the quick fix! keep up the good work 💪 @laurence_e_day you can ask your question here Ayyyy Right so, henlo everyone [redacted, I am an idiot] ... I think I'm dumb, I just have to override the tokens held in the vault to edit this [deleting] We were just your rubber ducks @laurence_e_day, is okay. I was literally about to type that lmao quack Re this, solidity-coverage doesn't use hardhat's normal compile task (it can't really because it needs to instrument). So, I think you'd need to also preprocess the imports in solidity-coverage using their onPreCompile hook here: https://github.com/sc-forks/solidity-coverage/blob/master/docs/advanced.md#workflow-hooks If there's interest in this I can try it out. We could also extend the template, but I can't stress enough that hardhat projects can bloat so much and we wanted to keep the template succinct. is there some way to have forge test -w skip fuzz tests? i remember @transmissions11 tweeting something about this a while ago but not sure that feat ever landed Hey guys, how exactly does Foundy multi solc version support work? I have a project with 0.6.x AND 0.8.x.",467
756,foundry-support.txt,"Whenever I try to run forge build, I get the following error: > Discovered incompatible solidity versions in following forge snapshot skips fuzz tests don’t remember if u can via test idts Unless u prefix all ur fuzz tests with Fuzz or something and no-match them good naming conventions helps here King of pilling chads is in the town Hello hey, Harry! Does forge script support sending transactions to Arbitrum's testnet? There's some idiosyncrasies with how arbitrum validators handle gas not sure, what are the idiosyncracies? opcode gas pricing Arbitrum gas units are different: opcodes are priced differently, so swaps as an example, cost different amounts. Arbitrum has 2 separate gas meters- one for compute and one for storage On Arb its not clear if we capture everything we need by querying eth_gasPrice (also unclear if we need to capture both when estimating gas) A much better explanation that I would have given, thank you! an outstanding issue actually 😅 https://github.com/sambacha/gas-reporting/issues/10 I've tried at least 50 permutations of --gas-limit and --gas-price arguments with forge script, and tried both the arbitrum provided and alchemy provided rpc end points and haven't been able to get anywhere what kind of tx are you trying to price? Eg uniswapv2 swap tx, normal transfer, etc I'm trying to deploy a contract with a forge script estimated gas cost of ~700k you would probably need to also price storage as well can you open an issue and we can track down how to make it work? I've managed to deploy this contract a few times using hardhat, but only when manually specifying all the gas related params because hardhat can't figure it out either. On which repo? the foundry-rs one? yea that way everyone benefits not just ethers-rs users 🤣 funny u should suggest that, i do prefix all fuzz tests with testFuzz and that is exactly what i did forge test -w --no-match-test Fuzz shouldn't test Fuzz be testFuzz? Wondering this: gm frens, is it true that foundry's abi output is incompatible for geth's abigen? Always getting unmarshal errors. Any ideas on how to generate go bindings otherwise (compiling with abigen directly is tricky because the imports can not be resolved).",488
757,foundry-support.txt,"Thx I'm trying deploy and verify a contract with, forge script --broadcast --verify, it's not working I've tried using a different outcome but still the same outcome Error: 0: [""(code: -32000, message: already known, data: None)""] hey how to run Nonce issue - cc @joshiedo, can you share your script? if I have an existing hardhat project and I want to ""inject"" foundry what should I do? I'm already following the book for the hardhat part but I don't understand how to setup foundry for an existing hardhat project what should be the procedure to init forge on an existing hardhat project? first step, just see if forge build works out of the box it likely will so I don't need to have all in libs like I usually have to have solidity testing? you don’t need that. You can add foundry.toml to map it ti node_modules likely will be autodetected, if not, then will need to add to lib if forge build works, then you can run forge install whatever which should automatically update libs again for you make sure u r on latest master Seems to me that the first time you run it, the transaction got stuck in the pool for whatever reason, but still, we should handle that error better probably What RPC are you using can’t deploy when I use —verify without it, it works like a charm my foundry.toml has the etherscan key my docker image is very basic Infura rinkeby Yeah, I think that's it https://github.com/Perelyn-sama/hey-foundry/blob/master/scripts/MyToken.s.sol Got any ideas on how I could fix it ? Is it still stuck there ? it seems that my problem come from the docker image which is probably not the most recent version of foundry when I use my local foundry which is the latest version everything works as expected I wanted to check the size implication of a lib, but as soon as I use the lib the contract disappears from the list. Any idea why forge build --sizes --force would exclude a contract / report a list containing all contracts, but the one I'm interested in? Build/test still work. @gakonst does foundry support verifications on blockscout related explorer? because there is no ETHERSCAN_API_KEY offered from them.",486
758,foundry-support.txt,"this looks etherscan compatible https://blockscout.com/xdai/mainnet/api-docs ? did you find any apikeys offering? probably in your profile settings? that sounds like it could be a bug, mind opening an issue for that? what are the possible issues from deploying a contract with getting this errors: [⠢] Compiling... [⠘] Compiling 4 files with 0.6.12 [⠒] Solc 0.6.12 finished in 566.71ms Compiler run successful Error: 0: custom error: EIP-1559 not activated What chain is this ? In ethers.rs you might have to use the .legacy method and think this might apply here using --legacy from the command ? this is a new custom chain just like testnet https://github.com/foundry-rs/foundry/blob/c38f71bad23d7724e782119a78fd50da7d0b5ec1/cli/src/cmd/forge/create.rs#L53-#L61 according to the comments, you shouldnt have to pass that flag , but I would try passing it How can I check the balance of a specific token at a specific address?  Easiest way using forge or cast Let's say Dai token at 0x000xxx (Polygon network) are there any ways to exclude some the compiling sources in side the src folder? Are there any plans to add stack traces to transactions in anvil? I can see see the verbosity options (-vvvv, etc) under EvmOpts when running ""anvil --help"" but it doesn't look like it hooked up to anything in code.",346
759,foundry-support.txt,"hope to have time in the next future to learn rust and give some help back feel so ashemed to not know rust and being useless always requesting and never giving 🙁 omg guys, I cannot emphasize how happy I am about :::anvil::: !!! So great! you are the best 🙂 What’s the best pattern to use forge to deploy a contract outside of your project? I tried to install GnosisSafe and deploy it staight from lib but that didn’t work Is there any way to retrieve the revert message when using anvil with a fork url and eth_sendTransaction when the transaction that was sent reverted? I'm either not seeing straight anymore, but a vm.startBroadcast(); Contract newContr = new Contract(); uses a CREATE to create the new contract, with the nonce of the sender as uniqueness, right? I'm trying to play around a bit for issue #1816, and when I script --broadcast the same script more than once, it seems to deploy a new contract, but then doesn't pick up the newly created contract address and uses the contract address created on a previous --broadcast session 🤯 mood atm example: https://rinkeby.etherscan.io/tx/0xd26b3e21a3b9093312f70d92dafe30668e887234a8cb56ebeb7e713b0bf6766f is the first line, https://rinkeby.etherscan.io/tx/0xd26b3e21a3b9093312f70d92dafe30668e887234a8cb56ebeb7e713b0bf6766f is the second line. Should go to the newly created contract, which it doesn't do. If you check the contract the second tx calls, it's from a previous script --broadcast session I'll put it in a new issue, just thought I'd do some thinking out loud here first 😅 hm when you run the second time has the previous one been confirmed/mined already? yeah, it's about an hour difference between the the two ""broadcast sessions"". Same exact code though that gets redeployed Hello there, Anyone has an idea how this is possible => So normally INVALID OPCODE and doesn't refund the gas. So when i am calling the last function that's expected that the gas value is 0.",484
760,foundry-support.txt,"But look at Etherscan screen he said that the last call is executed with 2300 GAS. How this is possible?! e.env the verification does not work for blockscout. Compiler run successful Deployer: 0x8a45b720cf7251921b114e5d49812f634742f85c Deployed to: 0xfef8168cc773827b97ade30eb82ad117e8f1da31 Transaction hash: 0xf2f1a039d9cf783579d3dbd5dcfb0fa10d24afdad21b51d8dd3af4cfe11bb2e5 Starting contract verification... Waiting for etherscan to detect contract deployment... Error: 0: Failed to parse chain: 26863 got this error here.. @rkrasiuk ^ prob just a matter of adding new chain can take a look in 40min yeh, looks like blockscout's api is same as etherscan any chance you can share the script ;_; ? or the trace log. it'd be interesting to see what the trace from the script shows, and what the onchain transaction simulation shows I can invite you to our private repo if you'd like. Or share the trace log, whatever works best it'd be great my ip just got banned, from trying out sending 500 txes all the time to avalanche testnet rpc lol for which network is that chain id tho? can't find it on chainlist What is the prefered way to deploy fixtures (like: deploy a NFT contract, mint some NFTs to different addresses) to anvil? Yeah, I tried using a different private key but I got the same error. Even ran forge clean and deleted the broadcast folder. I'm thinking of changing the rpc url next oasis https://scan.oasischain.io/ https://rpc1.oasischain.io chain id: 26863 Hi all! Foundry newb here. I’ve followed all the steps in the pinned message. (For example, I’ve read the whole Book front to back twice now, I promise I'm trying! Hahahah) I am having trouble setting up a basic Foundry project, and am wondering what I am misunderstanding. I am trying to start a Foundry project that uses ConsenSys’s ERC1400 reference implementation as a base.",492
761,foundry-support.txt,"(contract FooBar is ERC1400, is the idea, but I haven't even gotten that far yet.) I think I’m having trouble grokking how to properly set up the project dependencies. I installed foundry with foundryup, then confirmed I could forge build and forge test successfully. Then, I used forge install ConsenSys/UniversalToken (the ERC1400 reference implementation I'm using) and forge install OpenZeppelin/openzeppelin-contracts to install the dependencies. When I tried to forge build, though, the compiler failed in UniversalToken when it is unable to find the openzeppelin-contracts. It seems it’s not searching anywhere, maybe I need to update remappings? The failure output includes error[6275]: ParserError: Source ""@openzeppelin/contracts/utils/math/SafeMath.sol"" not found: File not found. Searched the following locations: """". I’m starting to wonder if the way UniversalToken is set up is incompatible with its use as a dependency in a Foundry project, but I think it’s likelier I just misunderstood how to correctly set up the project. Let me know if this is too much context for the Telegram and I’ll open an issue instead. (If anyone knows of good alternate implementations for ERC1400, btw, let me know, maybe I’m having an XY Problem and should just use a different implementation?) Haha, rip Hello, is there a way to delete an installed repo using forge install? I keep getting this error, but the stargate repo isn't in my lib folder.",321
762,foundry-support.txt,"Want to try deleting and re-installing but this error won't let me Try https://gist.github.com/myusuf3/7f645819ded92bda6677 to remove it Makes me wonder if we should add aliases to Foundry for easily unscrewing Git modules That would certainly be useful I also sometimes have to remove it completely, add it through git submodule add and drag&drop the folder to lib/ to get it to work hevm.startPrank() is scoped to an individual function, right? no it’s scoped to a contract So you should always end a function with hevm.stopPrank() then, right? i.e.: startPrank() myInternalFunc() all calls in myInternalFunc will be pranked Ah yes, ofc you can add modifiers as needed to make sure no pranks are occurring for an internal function Was thinking: test1() { startPrank(address1) func1() } test2() { startPrank(address2) func2() } Assumed that the prank is scoped to its outer function Across tests I ran forge script scripts/MyToken.s.sol --rpc-url $RPC_URL --private-key $PRIVATE_KEY_SPARE --broadcast --verify --etherscan-api-key $ETHERSCAN_KEY -vvvv but it only deploys the contracts and not verify them on etherscan https://rinkeby.etherscan.io/address/0x68df7639ef63fA25D618cdEEBbdd1093d37c8e18 @joshiedo Notice the last three transactions Love how people are stress testing scripting :) Any feedback on the UX beyond reliability of verification and nonced? What was the output? No each test has a different prank, literally different evm instance, there's no leakage from one test to the other The contract is deployed but not verified sighs, I just want it to work so I can move to my next article Is it just verification? Yeah Maybe i should just stick to the old way and publish but it doesnt show any error? or thats the exact error ? ""The contract is deployed but not verified"" not at all I'll try it again and take a screenshot 🙏 https://rinkeby.etherscan.io/token/0xe9221b5406dea89dcc4f4c43ff3bfe9405834ba2#readContract can you try calling it like forge script MyScript ...",496
763,foundry-support.txt,"instead ? sure wait scripts/MyToken.s.sol I should rename MyToken to MyScript? by the name of the Contract i thought it was MyScript It is The first time I ran the script, I used the old method to verify the contract. Could that be where the issue came from? It was before the --verify update was made Could this be related to what I'm seeing as well: a forge script often compiles some files again, even after running forge scripts sequentially, ie maybe some issue with moving artifacts to /out on a forge script? it’s worth the stress test, so pls keep it coming 🙂 if the script is not part of the project (which compiling every time its run, leads me to believe), then the verify feature has some issues which should be more verbose to be honest should we document these? we could, but i think the best would be to give out an error if its a standalone script + verify flag present sometimes when im running forge test -w tests disappear, usually they disappear an entire test contract at a time. in this example i fixed the top failing test (tradeUSDC04) and after it recompiled, it is no longer reporting on the YearnVault tests the solution for me is to control-c and rerun forge test -w. is this a known thing or shall i make a ticket? is this is a known issue where foundry fails to resolve the version? As you could see the solidity versions are not fixed in any of the contracts so ideally it should just go ahead and use the top most version and compile.",320
764,foundry-support.txt,"I am on the latest forge version forge 0.2.0 (0342bc2 2022-06-03T00:04:00.330112Z) status on forge deploy? have you seen forge create? i guess bash+forge create is the best option forge scripts are better where can I see docs? Missed the last 1.5 months of Forge updates and am back jumping in - what other big changes like scripting have been added since? 🙏 So pumped to wrap everything under Forge finally end to end no docs yet, just the tweet and some examples i think send link https://twitter.com/gakonst/status/1531056739470016512?s=20&t=ehycnMEzrcSsGn0VjQbR2A Would appreciate an issue, can you reliably reproduce this or describe when this happens? Hi guys, is it possible to point a package to the parent folder in remappings config? I tried this but not working hmm this should work, mind opening an issue with your project layout for that? Sure, will create the issue on GitHub, thanks! just updated forge after almost 2 months and am getting [FAIL. Reason: You have an active prank already.] for almost all my tests - what's the obvious culprit? i've faced this issue a couple of times, it's usually caused by running startPrank and not closing it with a stopPrank. or running a prank after using startPrank without stopping it. As Ruvaag said: in previous versions you could do a prank while another was still running. That changed in 0.2.0. So look for any pranks you haven't stopped they also run over functions, so if your top function calls a subfunction which has a startPrank() but no stopPrank(), the prank continues in the rest of the top function What’s the correct way to pass a bytes value into a function in my test contract? All three intuitive methods seem not to work lets not embed the house fire that is git submodules pls does bytes(uint(0)) works ? This worked @aar0xyz hex”00000000”? Yea this is the solution, thanks. It’s called hexadecimal literals.",461
765,foundry-support.txt,"@joshiedo is forge script --verify working now? if you issue the verification to the contract it should work fine, even yesterday it's just the case where you issue a verification with the path of the script which has issues, if it doesn't belong to the foundry project which i havent gotten the time to tackle yet, but it will just throw an error in that case 😅 Hi there, Can anyone help me to resolve “[FAIL. Reason: Revert] test1() (gas: 2970)” for such simple Test? you need to deploy c 🙂 C c1 = new C() thanks) nahh so far it seems intermittent. i will submit issue 😄 @romantica88 new chains that have blockscout support were added and should be available with the next release https://github.com/gakonst/ethers-rs/pull/1343 Does anyone has experience (example of project) with Foundry with test coverage gathering? we dont have coverage done yet Is it in the roadmap? Going to be integrated somewhen soon? can https://github.com/sc-forks/solidity-coverage be somehow used? yep - https://github.com/foundry-rs/foundry/pull/1576 @onbjerg is on it Are there docs on forge script somewhere? especially a cookbook or example script But it still didn't work yesterday even when I used the name instead of the path.",294
766,foundry-support.txt,"Possibly I did something wrong, I'll try again and update you https://book.getfoundry.sh/reference/forge/forge-script.html main docs but no examples yet check the unit tests Thanks, I'll check the tests there's an example at the bottom of the page forge script ./test/Broadcast.t.sol --tc BroadcastTest --sig ""deploy()"" \    -vvv --fork-url $GOERLI_RPC_URL @joshiedo still does not work @perelyn_sama Please share what is the name of your script contract MyScript I think it's not compiling forge clean in general, please try to provide some more debugging information I just ran forge build and could not find the abis in the out folder done that a million times did you open an issue? if you see something is not easily resolved in 1-2 messages, opening an issue with exact steps to reproduce is the way to go Okay, I'll do that Thanks thank you https://github.com/foundry-rs/hardhat-foundry-template could we convert this repo into a gh template? Yes on it - sorry forgot about it Thanks 🙏 done is there a general convention for where we should keep our scripts yet? scripts/ subdir I'm not able to get the verification working with the --verify option when running forge script (although I am able to get it deployed!). It seems like it's not even trying as it doesn't throw an error or acknowledge the verification was submitted. Is there an easy way to grab the info from the compiler outputs and other cache info to just make a normal forge verify-contract call? What are the instructions to do a clean reinstall of foundry & forgeup? rm -rf ~/.foundry What's the purpose of an assert() within a forge script? Since it can't roll back the previous transactions is it possible to have only one test that rely on a fork when I run forge test ? there'll be fork cheatcodes shortly that will allow you to do exactly that cool! and as far as I can see from the book foundry now support full fork caching? so if I run the test again with the same block number it should not make any call to the RPC? @mattsse as far as I get foundry does not support .env variables right? for example for params like fork-url and fork-block-number.",478
767,foundry-support.txt,"Or at least I didn't find anything about it on the book correct not yet, but we just merged env cheatcodes just to double check, I should see no more increase in the Alchemy TOTAL REQUESTS (24H) right? probably there will be some request for chain id I think hey guys, i'm trying to write a foundry script to do address mining (use create 2 to deploy contracts with leading 0s) for deployment. But seems like the the computation I do in the solidity script is also counted as gas and the script will stop after like 100K of iterations. Is there any way to by pass this? Script failed. Gas used: 9223372036854733679 Error: 0: Script failed. P.s. --block-gas-limit won't let me increase more than the limit. Also smaller iterations (finding 4 leading zeros) works perfectly and the gas cost is counted correctly (only deployment is counted) Script ran successfully. Gas used: 43958913 == Logs == salt found:, 31582 oracle, 0x0000fdcb397be34a3e970235ba2a024cc58a87a It's incredible how after I run into some missing feature, it takes <2 days for someone to show up here and go ""yeah, actually here's the PR for that, will be done soon"" 👏 What to do if the compilation hangs ? I have already done forge clean sounds like a bug, mind opening an issue? Ideally with a way to reproduce and logs you get when you run with RUST_LOG=ethers=trace forge build —force Should I put RUST_LOG=ethers=trace forge build --force in the forge.toml ? @mattsse There is a parsing error but the solidity file syntax looks correct Solmate vs openzeppelin...any opinion about that? 🙂 the one that uses foundry as testsuite 🙄 Yeah but I mean, I knew that openzeppelin was more security oriented while solmate more gas oriented...it is still true? As security is really important I think.",432
768,foundry-support.txt,"I will open an issue i dont think its fair to characterize something as security oriented all smart contract software should be security oriented i'd say the difference between solmate and OZ from a security front is that openzeppelin prioritizes not letting the user of their contracts do anything stupid while solmate lets you do stupid stuff because it assumes you have read the contracts and know what you're doing but when used with minimal changes or by someone who is well versed in the codebase, the libraries themselves should both be of a very high security standard solmate takes off the safeguards and training wheels i'd say u could characterize openzeppelin software as ""baby proofed"" while solmate has sharp edges that's very different from something being insecure ofc— tho in practice for a beginner maybe not haha Thanks! You are the creator of solmate, right? So would you think oz is better for a beginner maybe? i'd say so, if u want to deploy something in prod quickly and are new to this stuff, go with OZ Thanks! Maybe I will do some comparison.",218
769,foundry-support.txt,"this is a good repo benchmarking solmate vs OZ vs others if you were also curious https://github.com/alephao/solidity-benchmarks yeah this one's dope tho fwiw i put very little thought into optimizing the tokens/ folder they're just designed to be beautiful & minimal token impls cuz the OZ ones were so bloated most of the highly optimized stuff is in the libs/ folder where things are more encapsulated so i feel safer fucking around hehe id argue that for token standards which are so widely used, by literally everyone, its good that solmate tokens are also quite readable yup exactly and considering they're stateful its just much harder to get correctness guarantees on optimizations inside them where as with a lib that uses no storage and is just 1 input 1 output u can fuzz or symbolically execute that pretty thoroughly with ease I feel you, I have a playground dir thats just a bunch of libs doing some fucked up stuff 😂 If I ever accidentally commit it tp GH, i shall be jobless and publically shamed lmaoooo Is there a good way to automatically write gas reports to a file? I guess there's just --gas-report >> filename yeah i typically do that or just screen shot lmao but i believe theres an issue opened for a flag to this lemme see if i can find it hmm cant find it but pretty sure it was a feature request 😂 We first run a simulation before submitting onchain So it'd fail there Deployments to Arbitrum testnet (using a forge script) doesn't seem to work for me, I'm assuming it'd be similar on Arbitrum mainnet Ugh must be the non standard gas accounting Does forge create work? Does anyone have some resources on how to fetch prices for different swaps on Curve.fi? I have a script running on brownie, but I would like to migrate everything to foundry. ummm, why this issuse? yup forge create still works are you including forge-std or console.sol ? I'm setupping the CI to run forge tests. In package.json I'm running forge test and I would like to pass the env variable RPC_URL.",442
770,foundry-support.txt,"Do you know how it's passed to it or if it's possible to do it? shoul be picked up if ETH_RPC_URL var is set or via cli argument You can using something like Justfile as your runner @perelyn_sama https://github.com/foundry-rs/foundry/pull/1841 if you want to give it a go. I'm not sure it will solve your issue, but i fixed a couple issues declare it at the beginning of the script ""ETH_RPC_URL='https://url' forge …"" 🫥 can anvil always sync with latest block? or it is fixed upon launch? Via the cli is it possible to eval github ci vars? You can echo then in a run action .. or set the ETH_RPC_URL as a secret Then access it by {{secrets.ETH_RPC_URL}} you can reset the block that's forked via anvil_reset same as hardhat_reset it would automatically sync to latest block? you mean updating as soon as a new block is mined on main? Do you have any guide about that ? https://github.community/t/running-a-bash-script/141584 Instead of the path to the bash script , just echo the url variable Here is how you would set up git action secrets : https://github.com/Azure/actions-workflow-samples/blob/master/assets/create-secrets-for-GitHub-workflows.md uhm so the problem is that I cannot ""pass"" the variable down to the script I have defined in the package.json as far as I get I'll manage to setup the env variable used by forge in someone but now I get this error on CI warning[3628]: Warning: This contract has a payable fallback function, but no receive ether function. Consider adding a receive ether function. The application panicked (crashed). --> src/mocks/WETHMock.sol:8:1: Message: Failed to establish provider to | 8 | contract WETHMock is ERC20(""Wrapped ETH"", ""WETH"") { | ^ (Relevant source part starts here and spans across multiple lines). Note: The payable fallback function is defined here. --> src/mocks/WETHMock.sol:13:5: | 13 |  fallback() external payable { |  ^ (Relevant source part starts here and spans across multiple lines). Location: evm/src/executor/opts.rs:110 Backtrace omitted.",489
771,foundry-support.txt,"Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets. Aborted (core dumped) Error: Process completed with exit code 134. could that be that it's failing because it gets some ""output""? Is there a way to say ""ignore warning""? yeah Can you share a snippet of your yaml file? name: CI on: push:  branches:  - main pull_request: env: FOUNDRY_PROFILE: ci jobs: run-ci:  runs-on: ubuntu-latest  steps:  - uses: actions/checkout@v2  - name: Install Foundry   uses: foundry-rs/foundry-toolchain@v1   with:   version: nightly  - name: Install deps   run: forge install  - name: Run tests   env:   FOUNDRY_ETH_RPC_URL: ${{ secrets.RPC_URL }}   run: npm run test I removed the snapshot check because I don't know how to make it works correctly with the fork I think the env should come under the run I'll try it https://docs.github.com/en/actions/learn-github-actions/environment-variables nope does not work anyway the repo it's this https://github.com/StErMi/forge-sol-challenge This might be the issue : https://stackoverflow.com/questions/61117865/how-to-set-environment-variable-in-node-js-process-when-deploying-with-github-ac @SamuelDare if I only use the `FOUNDRY_ETH_RPC_URL` difining it in the toml file the command should be forge test --match-contract HodlChallenge --fork-url --fork-block-number 14850000 or do I need to remove the --fork-url at all? forked and fixed it, will pr to you.",379
772,foundry-support.txt,"There is another bug there though but the intial tests are passing move to DMs if you need more help https://github.com/Genysys/forge-sol-challenge/blob/main/package.json#L9 ah just seeing this , you need to pass the RPC_URL as the --fork-url do not echo them in your workflow file set it as a repo secret It’s a secret but you need to echo it or for some funny reason , npm doesn’t pick it up When you run the echo, the secret isn’t printed on screen It’s hidden tbh he probably didnt need to echo it , root cause was that he wasnt passing the the --fork-url parameter. Would probably just tried that with the $RPC-URL i.e. include --fork-url $RPC-URL in the npm command i opened a PR fixing the CI workflow gonna check it! yeah I saw that from stackoverflow, was not so confident to create an env on the fly with those info 😄 still not working 🙁 i'm pretty sure it's failing because there are warning print Is there a trick to make slither work with foundry contracts with lib refs, it says it can't find ""openzepellin-contracts/contracts"" that lives in foundry lib/ (upgrading slither to 0.8.2 -> 0.8.3 with pip removed some errors so far, will keep digging) slither . is trying to do 'npx hardhat compile --force' running since I have both hh and foundry in the folder hmm slither has a force compile framework do slither —help and look at the compile options u can do something like force-compile-framework foundry i tried both sadly, from the root slither ./contracts --compile-force-framework foundry same with just .",369
773,foundry-support.txt,"for the path hmm NotADirectoryError: [Errno 20] Not a directory: './contracts/FastLaneAuction.sol' is what I get it triggers 'forge build --extra-output abi --extra-output userdoc --extra-output devdoc --extra-output evm.methodIdentifiers --force' running yeah I retried from a *barebone* project with just foundry and the force-compile: - solc builds - but then slither chokes on oz files looking for it everywhere except at lib/ root ValueError: lib/openzeppelin-contracts/contracts/interfaces/IERC20.sol does not exist in ['/Users/me/Sites/foundslither/test/Contract.t.sol', '/Users/me/Sites/foundslither/Contract.t.sol',...etc all the files from lib/whatever.sol If I run without the force framework slither src its: Error: Source ""openzeppelin-contracts/contracts/access/Ownable.sol"" not found: File not found. Searched the following locations: """". ok not all the lib imports are rekt, only the ones with ../ inside the file itself.",230
774,foundry-support.txt,"so import ""openzeppelin-contracts/contracts/access/Ownable.sol""; works, Address.sol as well since self-sufficient, but import ""openzeppelin-contracts/contracts/interfaces/IERC20.sol""; ruins it and slither chokes can you please open an issue with your findings so we can track this? shoot I opened on slither repo https://github.com/crytic/slither/issues/1226 Running a forge script with --slow, shouldn't this give me different block numbers in each iteration?:   AutoFlipper autoFlipper = new AutoFlipper(flip);   for (uint256 i = 0; i < 10; ++i) {    console.log(block.number);    autoFlipper.flip();   } or do I need to explicitly trigger something to advance? currently prints the same number twice (and fails then because this tx doesn't allow running in the same block) the script is executed locally in one go, and unless you vm.roll, the block number will be the same --slow only affects the actual broadcasting part When running a Forge script on Optimism mainnet, I get ""no gas price"" as an error just to confirm, transaction is submitted, and its when getting the receipt ? Hi folks! Absolutely loving Foundry - thank you for building it! I'm looking to make external contract calls from my contract when testing locally - is there a particular pattern that I should be following? I've been able to test my contract successfully up until this point! (obv. my external contract call fails, as I have not passed any rpc ...",325
775,foundry-support.txt,"I imagine I should be doing this somehow?) I can confirm that my external call works when using cast on the command line Is it just running forge test with `--rpc-url=$RPC_URL`? (after setting the var, of course) ^^ Works! is it possible to get operands value and operator used in arithemtic over/underflow errors? Can I get some help to understand why my foundry CI is failing https://github.com/StErMi/forge-sol-challenge/runs/6752695813?check_suite_focus=true ? seems like an rpc error but it fails in the task where no RPC is used dont think you have set your rpc url secret doesnt matter if you provide fork-url it will connect and then run the test, its not lazy connected so it tries to connect even if the task is not runned yet? it connects before any test is ran yeah it seems that the problem is when I do FOUNDRY_ETH_RPC_URL: ${{ secrets.RPC_URL }} it has just failed because I have that specific line from what i can tell you havent set your secret i.e. it is equivalent to running forge test —fork-url “” if I set globally would that be used by every task? yes you maybe able to run filtering and run only tests that require forking with fork url and others without a fork url well, has someone done it with github actions? because I should have correctly setup the RPC url did you set the secret in your repo settings? yes I should have done correctly in my experience if you have a secret, it gets rendered as *** in the logs which i am not seeing, so i think you should double check don't know where to bang my head anymore 🙁 correct for comparison, on my own repo thats right ^^ @naps62 is it public? could you share it? this one is not, unfortunately I personally don't even have access to the private settings myself 😬 yeah now it works but I don't know why 😆 ok, so it seems that it was ""not setup"" just because I'm using Environment secrets and I'm not understand why it's not working...",440
776,foundry-support.txt,"not sure I understand what you mean you have 3 types of secrets -> repo, env, org In my case, i asked the repo owner to set it on ""Repo settings > Secrets > Actions secrets > Environment secrets"" do you use the same syntax FOUNDRY_ETH_RPC_URL: ${{ secrets.RPC_URL }} ? yes   - run: just test-mainnet   env:   ETH_MAINNET_URL: ${{ secrets.ETH_MAINNET_URL }} ok, sorry to keep asking, how do you declare your env name for the task? I think that I got confused and I thought that the name on top of the file was the env https://gist.github.com/naps62/aefdaea153dc2116d57b81fccde661db this is my full workflow I'm pretty sure they added those secrets at repository level could be something as simple as having an extra whitespace on the secret name 😅 ok just realized I misspoke above it's not ""Environment secrets"". it's directly on the ""New repository secret button"" if you create an environment, you need to explicitly use it with environment: my-env on the workflow yep, just as I thought that was ALL the issue Hey! what do you guys use to point foundry to avalanche network? I was only using alchemy before, but it does not support AVAX https://api.avax.network/ext/bc/C/rpc Thank you! @mattsse I saw that there's this issue https://github.com/foundry-rs/foundry/issues/1457 opened.",319
777,foundry-support.txt,"Would make sense to make forge autoload a .env file? For example by default it will load .env otherwise it will try to load .env and merge the profile used to run it what is the proper way to console.log array in foundry? also, if I set FOUNDRY_ETH_RPC_URL as an env variable, should I be able to avoid to add --fork-url $FOUNDRY_ETH_RPC_URL? because it seems that it fails anyway (don't knw if the problem is that I also have `--fork-block-number 14850000`) I think we should be able to load env files via dotenv crate, worth discussing this in the issue For now you can of course just source .env I was trying to find a way to have the same way to setup local test and ci test Could be that this overload is missing, could you check console.sol feel free to open an issue for that is it even possible to have oveload for struct? I thought it would require to have overload for each struct type Would appreciate if you could describe the issues you ran into? so we can add some CI infos to the book would you like me to do it here or on the github issue linked? On gh please :) easier to track ok any expert know how to solve this? 🥺 Hey, I’m trying to test a write to a packed storage slot, but stdstore is playing difficult, I get this error: FAIL. Reason: stdStorage find(StdStorage): Packed slot. This would cause dangerous overwriting and currently isnt supported.",320
778,foundry-support.txt,"Counterexample: calldata=0x0a9e6a6d0000000000000000000000000000000000000000000000000000000000000001, args=[1]] And my contract looks like this: Contract { uint128 public a; uint128 public b;  function setB(uint128 _b) public {  b = _b; }  The test looks like this: import ""forge-std/Test.sol""; import ""src/Contract.sol""; contract ContractTest is Test {  using stdStorage for StdStorage;  Contract internal myContract;   function setUp() public {   myContract = new Contract();    }  function testBChange(uint128 newB) public {   book.setB(newB);   uint128 realB = uint128(    stdstore     .target(address(myContract))     .sig(myContract.b.selector)     .read_uint()   );   assertEq(realB, newB, “b should be updated"");  } } Hey folks probably better done outside of evm? done: https://github.com/foundry-rs/foundry/issues/1457 Just curious if there's a way to do it with foundry script, since rust runs so much faster and i can merge it into a single deployment script 🥲 Hey guys Can anyone help me Im trying to set up the balancer V1 contracts in a foundary repo everything is compiling but then Compiler run successful The application panicked (crashed). Message: No target contract Location: utils/src/lib.rs:217 it says the application paniced Nvm just has to recompile I think :) Hey everyone, I come here to seek your help. For some reason my foundry setup that have been using for quite a long time, suddenly became very (very) slow. After a deep investigation, I found that foundry is working normally when not provided a RPC, but is un-usable when given one. Here is a screen of basic tests not requiring an access to the blockchain, with infura key commented in the first run & not commented in the second, run time are 8.92ms vs 164.27s for the exact same tests. My whole test suite takes now more than half an hour to run, and I'm really unable to figure out why...",475
779,foundry-support.txt,"This next screen puzzles me, if anyone has a clue of what's going on I would be very thankful! could be the backoff, but it shouldn’t be backing off if no rate limits were rate or requests didn’t fail, you ever had rate limit issues previously? I tested with several keys from Alchemy as well as Infura and didn’t run into any limitations… easy way to test would be: foundryup -C 63394fd9cf1304f1d880b0968fa4aed359c50ddd this is before the retry client merge and foundryup -C d27472bb111e06850de000d89029039a7cbfc451 the commit right after where the retry client was merged and see if the later is slower and the earlier is faster alchemy did however fix some accounting logic on their end which i think triggerred the issue in the CI and for other people in the first place, so if you havent ran these tests recently, it could be that too Yeah maybe our backoff is too intense by default @meetmangukiya yeh exp backoff based on the queued requests is a bit problematic here I think, perhaps exp with retries only + offset based on num requests? https://github.com/gakonst/ethers-rs/blob/f56146025a943d06b9989d3fba86634099831934/ethers-providers/src/transports/retry.rs#L148-L149 Thank you very much for your answer! However, I may be missing something but neither of them seems to be helping. And I have no idea why suddenly this issue appeared, I can’t think of something I changed… Anything else I should be trying? so even the earlier version took this long? After having double checked, I confirm that being at commit 63394fd doesn't help sadly. @mattsse I remember this coming up before—but this this 9223372036854733679 value max possible gas limit because of the data type, or can it be worked around? I also ran into this issue while trying to mine a create2 address in my deploy script (could use ffi as a workaround, but not needing to is kinda nice) since both vars are uint128s, solidity packs them into the same slot.",474
780,foundry-support.txt,"stdStore doesn't know the contract's storage layout but it can tell that it's packed, so it errors so you don't overwrite other data @brockelmore wdyt about a find(bool) overload which allows packed slots if true, then a checked_write(..., uint256 bits, uint256 offset) overload so you can specify exactly which bits to write? it's a manual workaround to this issue, but seems like a good short term solution in the config? try as string for large values: ""9223372036854733679"" thanks! — @antonasso lmk if this works, otherwise I can test it out later today hi guys, where should I place my scripts so that I can verify them on etherscan? i’m a fan cool, I can PR that in sometime this week, probably in the next day or two https://github.com/ProjectOpenSea/seaport/blob/main/test/foundry/FulfillBasicOrderTest.sol how come this seaport test doesnt have the .t.sol extension? Hello everybody I am trying to send a transaction via cast to the local node but I have the error: ""Error: 0: specified chain_id is different than the signer's chain_id"" it works for other calls with the same rpc local node what does it mean that error? Soooo... I went drastic & used this opportunity to switch to Ubuntu 22.04. On a fresh linux, just cloned my repo & the same exact issue reproduced. I'm stuck and can't things done, any suggestions on other things to try? Thanks in advance specifying with """" still give me the error: Error: 0: number too large to fit in target type the biggest number seems to fit is around 18023372036854754743 ah, I'd guess internally the gas limit is a u64 so the max value you can use is 18446744073709551615.",391
781,foundry-support.txt,"it might be possible to change to a u256 (deferring to @mattsse again here), but I'd guess your deploy script will be faster anyway if you use ffi to call out to a rust script which returns the salt the extension is just a convention that most people use, but not a requirement But they have both extensions in their test repo, which seems odd? ah, not sure then, you’d have to ask them—could be oversight or could be some other convention they’re using Ah I see, does this affect forge snapshot at all? Seems like some tests without the .t.sol aren’t getting picked up I’ll probs dm them I don't think it should, iirc it looks in the test dir for any contracts with a function that starts with test let us know if there's any interesting conventions they may be using! Hi there, can forge print gas usage for nested functions (functions called by a contract of interest, e.g. imported functions)? So far, I couldn't figure out ways to distinguish gas usage in nested functions 🙁 you can increase verbosity to get the trace which will show gas usage of each call -vvvv Thanks, I’m using -vvvv but I only see top level function calls not internal calls to library functions… oh i dont think there is any way to see gas usage of internal jumps, not sure though Gotcha. I guess I can temporarily copy the internal functions over the contract top level for analytics purposes for now. Thanks 🙏 any help on this please? Hmm is 0.8.4 compatible with 0.5.x? Please open an issue with a repro And we can investigate Try minimizing the example ok Any idea? Is it possible to export a single json file of deployed contracts with forge like we do with hardhat deploy ?? I mean it makes sense, but I blocking it on read is counterproductive imho it saves us from the occasional write to a packed slot in tests, but prevents me from testing real writes to packed slots can you have multiple vm.expectRevert in one test? +1 here, same q but for expectRevert Hi, What's the ETA for coverage support? I am describing the issue what I am facing right now. So there is a function with a revert case. On top of this case, there is a function which requires mockCall. But if I use expectRevert, mockCall doesn't work.",492
782,foundry-support.txt,"so I can't get the result what I want. Anyone can help me? Is this a bug or I did something wrong? After calling expectRevert, calls to other cheatcodes before the reverting call are ignored. Actually I don't like this because there are so many cases to keep both at the same time. it looks like seaport just forgot to put the extension 😂 Also, does forge snapshot include tests with fuzzing? > Also, does forge snapshot include tests with fuzzing? Yup it does. Just verified 👍 Is there a way to use cast non-interactively? I don't want to have to type in my password every time. On dapp.tools I could set an ETH_PASSWORD variable with the path of the password file. Foundry doesn't look like it supports this. I tried to set the CAST_PASSWORD env var, however it seems like it's not picking it up. can anyone explain why i am getting 'missing implementation' errors? my interface has been working just fine, then i added two functions to main contract and the signature is not working in interface.. racking my brain.. i have newest version of foundry works fine in remix.. can post 2nd function but is there any reason i should be getting error? Oh I didn't know that,we can easily add this. Can you open an issue so we track? Sure It seems like you're missing the function implementations? Please open an issue with what you'd like to do. I'm not exactly following You want to mock a subcall so that the top level call reverts? Yes - please check the Foundry book page on expectRevert i posted one here is the other: We don't have that yet. All transactions go to the broadcast folder. But it is easy to implement, so feel free to open an issue and we can discuss what the right way to do this is Sorry this will get lost thru the cracks, always open an issue with an example that reproduces the problem. Provide as much context as possible :) -- Not to be pedantic but there's hundreds of messages in this chat every day and we need to be able to triage them on Github if they are not simple fixes/obvious things. Appreciate everyone's understanding :) ok will do, i thought it might be an easy answer for u guyz yep! for sure.",482
783,foundry-support.txt,"created an issue on repo https://github.com/foundry-rs/forge-std/issues/84 @gakonst related issue, you can modify the provided code to see expectRevert's behavior and leave a comment: https://github.com/foundry-rs/foundry/issues/1745 is there a way to send an arbitrary message with cast send? fuzz tests are excluding from snapshots because their gas can vary based on the generated fuzz inputs. a pattern I like is: function test_MyFunction() public { // concrete value for gas snapshots testFuzz_MyFunction(100); } function testFuzz_MyFunction(uint256 a) { // fuzz implementation here } https://github.com/foundry-rs/foundry/issues/1862 thanks https://github.com/sambacha/forge-nix/blob/master/src/forge2nix you mean here? https://book.getfoundry.sh/cheatcodes/expect-revert.html?highlight=expectRevert#expectrevert I don’t think there’s an example with 2 or more expectRevert calls in the same fn I wasn’t clear when asking the question, I meant per function call / test, not in the whole test contract nvm I think I figured it out.",260
784,foundry-support.txt,"something like: cast send --from 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 --private-key 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 0x3c44cdddb6a900fa2b585dd299e03d12fa4293bc $(cast --from-utf8 ""hello world"") --rpc-url http://127.0.0.1:8545/ Something like this? Yes you can Wanna add a PR to the Foundry book with this? If we didn't have it documented Yeah let's add an example for this too in the book Sure will create a pr 👍 thanks! https://twitter.com/0xulquiorra/status/1534186497586642944?s=21&t=tr4yIxO5Xb0nMVgCzRlOiw A little off topic but I made a new Foundry logo! There are like 5 logos in the GitHub if you don’t like that specific one this is nice 🙂 we’re working on one with our research designer Achal, so we’ll most likely go with that. always exciting to see new ideas though Ok awesome excited to see what you guys come up with! sorry for all the questions but I’m doing a deep dive today lol is it possible to only have a fuzzed input take on a set of pre-specified values? like function testIt(address a) public { vm.assume(a == someAddress || a == someOtherAddress); } I tried this, but keep getting [FAIL. Reason: Too many global rejects] Ah parameterized tests, why not do: testIt() public { testItParam(someAddress); testItParam(someOtherAddress) } Im having some trouble verifying while deploying via script forge script script/scrip2.sol --broadcast --verify --rpc-url <URL> --etherscan-api-key {<EY> --chain-id 4 --sender <ADDRESS> -i 1 And getting the error 0: You can only verify deployments from inside a project! Make sure it exists with forge tree.",471
785,foundry-support.txt,"All my contracts reside in src/ and my script is in script/ i can remove the --verify and etherscan API key and deploy + verify separately but unable to do it in one command I just updated foundry and ran into this too. Is there an issue which tracks this? Been having to resume a lot more recently as well, I used to be able to send 13 txns without having to resume, now I have to resume a few times non issue, but something I noticed. maybe itll resolve by itself haha Might have to do with how we poll for receipts @joshiedo, I.e. Maybe we need to wait a bit? Not sure Thanks for stress testing Do you mean 'stressing you out' 😂 I feel all I do is bring up issues LOOL Moved 99% of my workflow over to foundry tho , so things bound to come up haha I don't think so, I can make one. fwiw, nightly-1616380f254f7c0d83ac75c7d4056f0401b5e417 from a few days ago doesn't have the issue So it seems I am not the only one having this issue. Should I open it on GitHub? is it possible to sign a message in solidity with a private key? For one of my tests im trying to sign a message with a private key from a certain wallet and send it as a parameter in a functoin [ testing a multi-sig wallet contract ] Issues = Source of truth for anything we dont immediately fix.",317
786,foundry-support.txt,"So please always open an issue 😄 yes, vm.sign bringing up issues is good 😉 amazing ser thank you Just opened the issue: https://github.com/foundry-rs/foundry/issues/1866 Hmm I do feel the same, and I think it might have to do with the fee estimation I'm having the impression they're taking longer time in the pool than before Does it show on forge tree ? Is the repo public ? yep all the contracts in my src dir show with forge tree repo will be public soon not the biggest deal right now but ill link when I make it public thanks! 🧎‍♂ does the script also show with forge tree? oh yeah the script doesnt show the script dir doesnt show should script/ be inside src? When i first saw the merge of forge scripting i assumed having the scripts outside of src made the most sense That’d be ideal Are we not picking the external script folder up @joshiedo ? Graph::resolve(project_paths) im using this to check if the file belongs to the project beforeEach : snapshotId = await ethers.provider.send('evm_snapshot'); afterEach : await ethers.provider.send('evm_revert', [snapshotId]); what's the foundry equivalent? snapshot search from doc seem to only be about gas not sure how to deploy WMATIC (^0.4.18) (0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270) using getCode either yet thanks, that’s indeed an issue due to a missinf anvil/hardhat chain I’d variant lel fixed here https://github.com/gakonst/ethers-rs/pull/1356 There you go https://github.com/foundry-rs/foundry/issues/1869 anyone has an example of using deployCode with an ext library? I want to deploy a solmate ERC20 in a test gm frens. I'm using forge test --gas-report and either I'm doing something wrong, or the things you do in setUp() may influence the gas report. Here's a small gist that reproduces the issue I'm having: https://gist.github.com/ChiTimesChi/ea61e78f34215a4492428cc33a350f93 In the first test setup nothing is done with queue.",485
787,foundry-support.txt,"As a result, three add() calls have following gas costs: 44569, 22669, 22669 in the second test setup there's a storage write in the queue. As a result, first add() call is now cheaper: 27469, 22669, 22669 Is there a way around this? Or do I just use the median gas usage for benchmarking? hi yall! is there any way to expect an event to not be emitted 🤔 Nope There's a cheatcodes meta issue which has a vm.not cheat proposed But we didn't get to a design we like Does anvil work with graphql? Nope Hi guys....having a serious issue with ffi the outputted data is of type bytes ""Invalid character 'G' at position 0"" but i get this error while running the script via ffi i am following @gakonst 's lootloose impl are there any other repos that use ffi extensively? Hello, I have a question, can you help me? what I can understand is that the assertEq would be the equivalent of .to.equals in HartHad What I'm looking for is the Foundry equivalent of to.be.revertedWith. Could someone guide me how to do this? we dont have an assertNeq but some ppl ahve made the arguemnt that we should isn't that vm.expectRevert Get started with Foundry today. I'll keep trying are you trying to expect a call to fail with a certain message? Correct. this works I am going to try Thanks! I'm getting this error when running forge build while my project includes a .yul contract. Is Yul compilation unsupported or do I need to change my configuration? Error:  0: Compiler run failed  Field ""settings.remappings"" cannot be used for Yul. 0: what's the best way to pass in a large array of objects into a foundry test function as a parameter? Is hardcoding them in solidity then passing them in the only way the output of the command that ffi runs needs to be in ABI encoded format https://book.getfoundry.sh/cheatcodes/ffi.html#tips Yea... I was sure to encode with the function..",455
788,foundry-support.txt,"Then rip out the selector Also prefixed with 0x Is it a problem if I define functions in the script? hey i'm trying to write a deploy script w/ forge and am getting the following error `error[9582]: TypeError: Member ""startBroadcast"" not found or not visible after argument-dependent lookup in contract Vm.` ``` forge --version forge 0.2.0 (2d22d51 2022-06-08T00:09:08.354041Z) ``` does this version of forge have startBroadcast available? could you provide a concrete (minimal) example please? can i dm? or should i send it here? i modified the local lib/forge-std/src/Vm.sol to include https://github.com/foundry-rs/foundry/blob/12921e29405d34568129fa613decd3837854d87d/testdata/cheats/Cheats.sol#L79-L87 and my script builds is it possible to have forge snapshot to use fork only when needed? wdym I wanted to have a single snapshot file but some of my tests are run with a fork options and some not. as far as I get if you run tests with fork options all of them will use the fork right? would that impact the gas reporting? now I have 2 script to launch test, one for ""local only"" one for tests that need the fork. should I just run the test (and snapshot) with the fork option or should I keep those two script separated? if I need to have them separated I would need two different snapshot script but after that I would like to merge the result of them in a single file debug is super cool, would be possible to send him some opcodes/bytecode and debug them via their GUI. don't need to have any contract involved, I just wanted to use the GUI to play/learn with EVM opcodes and debug them Hello, I am working on a deployment script for a few contracts I need to deploy. But i am having some trouble regarding solidity versions on different contracts. The problem is that in the same deploy script I need to deploy contracts that are on 0.7.5 and 0.8.0, and its breaking on compile time with incompatible solidity versions error. I specifically need those versions.",478
789,foundry-support.txt,"Is there a way to use different compiler versions for the deployment script? Does it work with forge build or forge test ? Nop, I guess its the same problem. Foundry Support How does their prsgma look like? = or ^? We should add a section to the book called ""Testing incompatible Solidity versions"" which explains the deployCode pattern from forge-std On the script contract its pragma solidity ^0.7.5; and then it deploys some that are ^0.8.0, and others that are exact 0.7.5 Oko looks like using the deployCode for the deployment of the contracts that use the 0.7.5 version builds. thx :) To run on the script on a fork would be with this command right? forge run ./src/deploy/deploy.sol --fork-url https://rpc.flashbots.net --private-key <private key here> -vvvv ya `forge script`* and if you want to actually send them onchain you add —broadcast was a foundry disc considered? 🤔 could pipe TG there aswell when running forge script ./src/deploy/deploy.sol --fork-url https://rpc.flashbots.net --private-key <private key here> -vvvv i am getting Error 0: Artifact has no source. It is building correctly though. Am I missing some flags on the command maybe? Yeah I don't want it, unable to follow everything honestly I like the fact that everything is in one place And forces people to open github issues There are foundry rooms in a bunch of discords that I've seen Uh what is in deploy.sol? Maybe some bug in how we detect the artifact I have a similar issue with --resume in a monorepo. Will open an issue I use src, test in a FOUNDRY_PROFILE, to manage different subdirectories in forge test Yeah I think that is the problem, i was trying to get the artifact by just passing the name of the contract deployCode(""ProposalPayloadLong.sol"") but looking at this example https://github.com/gakonst/v3-periphery-foundry/blob/main/contracts/foundry-tests/utils/Deploy.sol#L17 I guess I need to pass the path to the .json? also tried it, but still without exit, as it can't find it.",477
790,foundry-support.txt,"If you can open a repro that would help hm, i havent used deployCode before, so if it's creating an artifact without any kind of source, its normal. pushing a fix Is it just the deployCode causing it? Does it work without I guess I don't understand if it's a bug with forge not finding the artifact for deploy.sol Or deployCode not finding the artifact you passed this seems a different issue. does it still happen after you clear the cache? there was a change to the artifacts inbetween versions, so if you didnt rebuild it after the change, i can see this happening Oko the problem was on the artifacts path I was using. Needed to use from root instead of creating it from the where the deploy contract is. Fixed it and works fine now. Thanks a lot for your help :) !! Can you show here what you changed? yup, went from using string constant proposalPayloadLongArtifact = ""../../out/ProposalPayloadLong.sol/ProposalPayloadLong.json""; to string constant proposalPayloadLongArtifact = ""out/ProposalPayloadLong.sol/ProposalPayloadLong.json""; gotcha - this makes sense, let’s document that it works from the project root? yy ran forge clean multiple times. It's my goto https://github.com/foundry-rs/foundry/pull/1880#issuecomment-1149841240 is this related by any chance @sendrax ? Could it be that --resume uses the broadcast folder which will be placed in the dir that forge script is ran from and due to the monorepo structure it can't find it again I think in my case it was correct to have the error, as this way i was able to debug and find that the path to the artifact was wrong. So i think issue not directly related to my case is your repo public ? I would like to reproduce it, because I cannot. If i pass an invalid path, i get ""No such file or directory"" instead 🤔 its not public yet sorry.",406
791,foundry-support.txt,"But yeah the error was ""No such file or directory (os error 2)"" on the artifact path I was using on the deployCode but this happens after building and during execution, while the ""no source"" error happens during building, so i'm wondering what exactly was happening before repo ? 🥺 @joshiedo I was playing with env variables in an effort to be idempotent, in case the script breaks down while deploying, so I can resume from where I left off. In essence, if a contract creation was succesful, I would save the address in a env variable. From the source code, I understand that this is covered by --resume, correct? yes it should as long as you don't use any of the signers between --broadcast and --resume timeframes, so nonces stay the same right, thanks! I think it's the only way tbh, as setEnv doesn't set it for the parent process, so it's not super easy to use. Still experimenting on the best way forward Can someone please help me out with this source code https://gist.github.com/Perelyn-sama/70b4ade9f61c31a4de191bd787ce566b Yep exactly that's my question Hey Georgios, don't you think the solmate tutorial is a bit outdated? the nft test still imports 'ds-test' directly. I'm trying to make an updated version here but I'm getting an error Maybe :) Let's make it use forge std I'm trying but I'm getting something wrong will provably os the repo tomorrow, or friday hopefully. will post here when its public thank you! 🙏 is there a way to add retryies when verifying for etherscan? I am seeing this error: Submitted contract for verification: Response: OK GUID: gmqqir8z3cd86ru11vnqwuibungzpdsqvrfkak7mr1hs3mxdev URL: https://goerli.etherscan.io/address/0x845de02a52d5a3c3e834e2dee77e0e2b09ad5221 Waiting for verification result... Transactions saved to: broadcast/deploy.sol/5/run-latest.json Error: 0: Checking verification result failed: 1: Verification is still pending... It ends verifying, but as it stops, it doesnt verify the next contracts that where on the deploy script.",498
792,foundry-support.txt,"Wondering if there is a way to add retries so it can continue to verify the other contracts that where deployed What command do you run? forge script ./src/deploy/deploy.sol --private-key $PRIVATE_KEY --broadcast --fork-url $FORK_URL --verify --optimize --optimizer-runs 200 -vvvv Hi! When trying to test something and use some UniswapV2 contract I get Error: Discovered incompatible solidity versions... Seems forge-sted/src/Test.sol imports solc (>=0.6.0 <0.9.0) and UniswapV2 needs >=0.5.0. Any help is appreciated, thanks in advance 😉 if you just call --verify, without the --broadcast, he will sometimes etherscan really just takes forever to verify tho, i'm not sure if increasing the wait time is the answer here but need the broadcast to actually deploy right? Yeah manually (with forge verify-contract) have been able to verify all contracts. I don't know maybe would be good to add a flag for retries and then execute a retry (here I mean forge verify-check) every 15 sec or so. > but need the broadcast to actually deploy right? yes, but if you just want to verify an already deployed script, then --verify by itself will do --broadcast --verify: deploy and verify --resume --verify: resume deployment and verify --verify: resume verifications Is it intended that forge fmt removes single line comments starting with // ? Hi, guys I am integrating ci https://book.getfoundry.sh/config/continous-integration.html but I get a openzepplin remapping erron but in my .toml I do have the remapping defined am I missing anything ? Please provide more context on how you installed the openzep lib and your remappings Used yarn instead of a submodule and remappings in .toml have the remapping defined but I did fix this by installing yarn packages in my. yml Hey guys i have a bunch of asset configs and would like to run a few small deployment tests on each of these.",429
793,foundry-support.txt,"Is there any way how to load a json or do you guys have an idea how i can loop over a large amount of addresses? Might be time we add a JSON/CSV parser cheatcode 🙂 Wonder what the best API would be, maybe something like serde_json::Value? Value memory json = vm.readJSON(‘{ “foo”: “bar” }’) -> require(json.get(“foo”) == “bar”)? @brockelmore you had some ideas about in memory mappings right? could we do it recursively? If that’s not possible in solidity alone we could create a a json solidity struct that contains an id and all things json are handled via cheatcodes? discord is insecure by default, you will end up having to worry much more about phishing attempts, configuring bots, etc etc eg Discord Nitro lets you impersonate other users eg Discord API exposes names of all private channels in the server oh what lol your user id # technically cant be taken but no one in reality cross references that number (its the number after your username) this too can be adjusted so long as it doesnt overlap an existing account For now I created a storage contract where I add all the config addresses etc. to storage. Kinda works Yeah smth like that would be fantastic. How would you define types though? I really don't want to define it per variable like abis. Hi, I'm having trouble deploying a contract. I am trying to do it from windows. I do it in the following way. forge create --contracts C:\Users\JEISSON\Documents\PROGRAMACION\PRUEBAS\RENT_Exchange\src\ERC1155\RealEstateERC1155Token.sol --private-key xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx --rpc-url https://rinkeby.infura.io/v3/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx --contracts sets the folder where the contracts exist. you probably dont need it https://book.getfoundry.sh/forge/deploying.html Hi! When trying to test something and use some UniswapV2 contract I get Error: Discovered incompatible solidity versions... Seems forge-sted/src/Test.sol imports solc (>=0.6.0 <0.9.0) and UniswapV2 needs >=0.5.0.",465
794,foundry-support.txt,"Any help is appreciated, thanks in advance 😉 How much of a burden would be to add a state variable value panel to the --debug option? would that make sense to open a feature issue for that? thats probably one of the math libraries is UniswapV2Factory and I've just solved using https://github.com/gakonst/v3-periphery-foundry/blob/main/contracts/foundry-tests/utils/Deploy.sol#L35-L36 thanks anyway Is it possible to use forge test with anvil? can you please open an issue in the book repository about this? or a PR which explains how to use it I think this keeps ocming up https://book.getfoundry.sh/reference/forge-std/deployCode.html?highlight=deployCode#deploycode We have this but is not enough it seems https://book.getfoundry.sh/cheatcodes/get-code.html?highlight=deployCode#see-also ❯ forge remove lib/uniswap/v3-core Removing v3-core in ""lib/v3-core"", (url: Some(""https://github.com/lib/uniswap/v3-core""), tag: None) Error:  0: error: pathspec 'lib/v3-core' did not match any file(s) known to git Is this a bug or was there something wrong with my setup? I had a submodule installed at lib/uniswap/v3-core, but removing it tries to find lib/v3-core meh our submodule management might be suboptimal there's no real need for it since forge test run the same evm you can however use a running anvil instance as a the fork for your tests Thanks that’s a good idea. I would need this to selfdestruct and redeploy on same address with create2 since it’s not working in one single Tx So i will fork with anvil the Mainnet. Run the selfdestruct Tx via cast and then I’m going to run forge test with forking parameters set to the local anvil instance doesnt anyone else feel like failed tests should be showing fully qualified name at the end where the failed summary is shown? there is no way to know which test contract is the failure from if you got similarly named tests are there any docs on the scripting feature by forge? This is a bit in the book at the end ..",471
795,foundry-support.txt,"its just one line but its something hm can you link to it? https://book.getfoundry.sh/reference/forge/forge-script.html#examples thanks! Question -- aplogies if it's been asked before. I have a contract that deploys another contract on the constructor. When I run a script to deploy and verify, it verifies the top level contract but not the second contract deployed on the constructor. How can I deploy _all_ contracts deployed as part of the transaction? Can you open an issue? we're not currently collecting such information (created contracts inside deployments), but could be interesting totally! https://github.com/foundry-rs/foundry/issues/1893 expect sub optimal results from a sub optimal implementation (submodules sucks) https://github.com/foundry-rs/foundry/issues/1694 Like this maybe? Hello, I am having the following problem config error: stream did not contain valid UTF-8 in Remapping Provider The application panicked (crashed).",203
796,foundry-support.txt,"Message: failed to extract foundry config Location: config\src\lib.rs:355 https://github.com/foundry-rs/foundry/issues/1849 I was looking at this, I made some changes to the remappings.txt file but the problem still persists can you check that your remappings file does contain only valid utf8? ds-test/=lib/solmate/lib/ds-test/src/ forge-std/=lib/forge-std/src/ openzeppelin-contracts/=lib/openzeppelin-contracts/ solmate/=lib/solmate/src/ this is the content might not be visible and probably gets stripped in tg so you need to check yourself if the file's content is valid utf8 I have passed it through some online validators, it tells me that everything is fine hmm, iirc text files on windows don't have a format, last try, can you delete it, open notepad and save as utf8 encoding after pasting the remappings? it worked ! The file is generated with UTF-16 encoding, I changed the encoding and it worked I am working from windows, have I failed as a developer? 🤷🏽‍♂️ lol great, I'm sure this will come up again lol I was the first ? no but we previuosly blamed it on \ vs / slashes on windows Thank you very much for the help Matthias @joshiedo 12 txns takes ~5 resumes now 🤨 ok, i'll change one or two things to mitigate that (and wait longer), but im wondering if we should just increase the gas fee Hello, it's me, again :( I am trying to verify an already deployed contract. It does not give me an error, but it does not verify the contract for me either the result: Submitted contract for verification: Response: OK GUID: d93wplevqmu6sirgxrikadgirapbkbfwa2zisi2ma85idztamz URL: https://rinkeby.etherscan.io/address/0x445966631d5b08f677b65b3022c0b178f8373fe2#code what's the remaining of the output ? nothing else I think I know why it is. The contract I am trying to verify inherits from others.",475
797,foundry-support.txt,"Can't do this yet? in this case, i dont think it matters your output is strange here, because it ends abruptly, there's no error or anything lol which command are you using btw? create --verify or script --verify? Create --verify you think its due to gas fee being too low? either that, or we timeout too early hmmm is there a timeout override I can set to test that out? Running into a weird off-by-one error cast tells me the next nonce for an address is X but when I run a tests, forking against the same block that cast queried, and I try to create a contract from that address, the created contract's address matches X-1, not X nevermind, I was actually calling cast with the wrong env variable, and getting the real rinkeby nonce instead of the one from my block. and someone happened to deplyo a new contract through it since 🤦‍♂️ @joshiedo this was the repo we were talking about a couple days ago https://github.com/0xBeans/Mirakai just opensourced it i think its pretty random when i need to resume and when I dont Do we have a command to check the test coverage on foundry? works for javascript no javascript ? I don't understand I’ve spent more than I’d like fighting git submodules after copying over a foundry setup from another project, and not the first time this has happened. Is managing solidity dependencies with npm reasonable? I’m already using npm for things like generating typescript types for contracts. Yup no disagreement Do scripts not hold their state after run() is executed? For example, in run() I setup a contract and save its address in a variable. I have another function do() inside the script that calls a function on that contract. I then call do() from a Test, but the call to the saved contract is to the 0 address. How can I get the desired behavior? Do I have to save the address in the Test and pass it along? I was hoping to have a lot of functionality in a script that can then be called both from tests and deployment. I'm not sure I understand fully but, to hold the state you have to actually broadcast the transactions you can spawn anvil, run the script against it with broadcast, and then, forge test Okay actually I'm an idiot, forgot to manually run run() in my test...",495
798,foundry-support.txt,"i was making a joke about UTF16 Hey guys. Didn't see this issue when I searched so I'll ask: I have a foundry project where I used forge install on some dependencies using --no-git and --no-commit. I did this to avoid using git submodules. Now my team has decided that it would be best to use git submodules. When I try to remove the dependencies using 'forge remove solmate' etc, I get an error from forge.rs:157 saying 'not removing lib/solmate recursively without -r' It appears the -r flag pertains to some command in forge.rs, as it is not a valid flag for the forge remove command. I'd like to be able to remove the dependencies and reinstall them as git submodules using the default 'forge install' command, but it seems like there is a bug preventing me from doing this. We would strongly prefer to fix this without creating a new project from scratch, as we would like to maintain our git history. Any help is greatly appreciated. link to repo? Sorry, it's private. You can reproduce the issue by creating a new project and installing a dependency like solmate using --no-git --no-commit and then trying to remove it When I manually delete the dependencies from /lib, I am unable to install them again because they are still cached somewhere in the 'index' I wonder if there is a way to clear the dependencies from the index cache after manually deleting. Ah! After looking through the source code for forge install, it appears that the 'index' cache belongs to git. So by creating a new branch and manually deleting the dependency, then committing that to the branch, I am now able to install solmate as a git submodule. But yeah you guys might want to consider updating 'forge remove' to work for dependencies installed using forge install --no-git --no-commit Is there anyway to exclude files / directories from the gas report? e.g. using blacksmith for testing generates user contracts that automatically get included in the gas report https://book.getfoundry.sh/forge/forking-mode.html#caching I'm having trouble running mainnet fork tests, hangs for the better part of an hour. Checked the ~/.foundry/cache directory to see chain download progress and that folder doesn't exist Are these docs accurate or should I be looking elsewhere for mainnet fork test progress? There's definitely network activity happening from the forge binary but might be getting ratelimited.",500
799,foundry-support.txt,"Just curious how to see my test progress so I can diagnose the precise problem Nvm, came through and populated the folder eventually. Just had to wait 25 minutes wenn using scripts in formkmode it seems to take send the transactions from an account which is not the the Script contrac how do i access this sender in my script? see https://book.getfoundry.sh/forge/gas-reports.html?highlight=gas%20report#gas-reports : you can gas_reports to specify the reports for which to generate the gas reports or say im in broadcast mode, how do i access the signer acc within my script? also when i broadcast my script transcation to kovan, does it first execute against kovan in fork mode? and then if executed succesfully in fork mode proceeds to broadcasting the transcations to kovan? It sends it from the address corresponding to the --private-key you're supplying, not the script contract address (that's not deployed on chain). I don't think you can access it in your script, in what scenario do you need it? yes, afaik for example if i want to assert that an owner was correctly set to the sending address. yes, but in batch. so first executes everything, and then sends everything it varies, but if you're using only 1 signer, then it should be the msg.sender if you really want to be explicit, you can always use vm.startBroadcast(SIGNER_ADDRESS) or vm.broadcast(SIGNER_ADDRESS) first point when no private key is specified which acc is used and is that accessible yes but its still possible to have success running script in fork mode and then individuaæ broadcasted transactions fail right? if you're passing one private key in the command, then it's accessible through msg.sender. if you're not passing any private key, it will execute with the default foundry one. and once you try to broadcast it will give you an error oh thanks didnt know it acceted an arg right ofc yes, think about a slippage transaction in the middle of 100txes. once it reaches your swap transaction, price might have varied, and it can fail thanks @joshiedo but if you have multiple signers, and are including the msg.sender in your logic, you should definitely use the --sender PUBLIC_KEY flag 1.",476
800,foundry-support.txt,"The manual says forge create can deploy only 1 contract at a time , so if I want to deploy multiple contracts , would I need to create bash script with multiple forge create statements ? 2. How can I know which all chains to which forge can deploy to ? 1. checkout forge scripting 2. all evm chains should work Hi guys, is selfdestruct working for you in Anvil? which option of forge script should be used if I want to deploy on ropsten for example based on this output of forge script —help https://pastebin.com/4CZvcknj —rpc-url should be used to point to any evm rpc, it will deploy to whatever is selected ok you mean to say the command for that would be forge create —rpc-url <rpcurl> , where <rpcurl> = rpc of EVM compatible chain yes, except it has to be forge script … thanks man, can u point me to some doc describes whats the difference between forge create and forge script ' https://twitter.com/gakonst/status/1531056739470016512 thanks , i will study this @meetmangukiya atm , how do you deploy multiple contracts , ie., a project SRC ? since forge create can deploy one 1 contract at a time based on the manual ? as stated here -https://book.getfoundry.sh/forge/deploying.html forge scripts is the way to do it do not embed tweet like that I was already rushing to see the changelog thinking there was a new shiny release 😄 Is there a cheatcode to go from v,r,s to a complete signature? Just concat function getSig( uint8 v, bytes32 r, bytes32 s ) public pure returns (bytes memory sig) { sig = bytes.concat(r, s, bytes1(v)); } the ultimate cheatcode this is for specifying contracts for the report but in my case, I'm looking to exclude contracts from the report and more so a specific directory I'm confused by expectRevert. It seems to both only match the error message (e.g. expectRevert(""my error"")), and the entire bytes (e.g. expectRevert(abi.encodeWithSelector(MyError.selector,""my error""))).",456
801,foundry-support.txt,"Which one is it? this is for custom errors that have values that's not super clear, returndata on revert from solidity is 4bytes|arguments iirc, when you write expectRevert(""my error"") the matching is only on arguments but expectRevert(abi.encodeWithSelector(...)) must match on 4bytes|arguments, right? expectRevert(""my error"") is ultimately for stringed require errors that revert with ""my error"" expectRevert(abi.encodeWithSelector(MyError.selector,""my error"")) are for ciustom errors called MyError that revert with an arg ""my Error"" sure, my question is how does it know to distinguish between the two since both are calls to expectRevert(bytes) guess the final output is just an abi encoded value which i think should differ between normal reverts or customs tho...it just works🤷🏿‍♂️ The cache is populated when the process terminates, not continuously - maybe we should be checkpointing more frequently? @mattsse Should we start deprecating forge create and sending people to script? Should be create is still convenient for standalone contracts perhaps worth considering moving from json caches to something else? or we do a job that flushes, every couple min perhaps? hi, is there any info on what params anvil_reset take im looking to reset blockNumber to latest state mainnet is on whenever i run a script Hey guys, is there any easy way to derive multiple addresses from a mnemonic as part of a script? i.e. without ffi. Thanks! pls do not ser sled? How do you install forge-std? I have initiliased my project with an older version of forge. When I try to forge install forge-std I get an error. this worked: forge install brockelmore/forge-std Oh, no, it didn't. forge install foundry-rs/forge-std did I am really looking forward to seeing more documentation for forge script! Keeping my eyes open for it. Ohhohoho, I found the PR for it: https://github.com/foundry-rs/book/pull/370 What does FFI stand for? Foreign function...... 😂 trying to debug a simple function first time. getting this error . following the same as per docs. i am running forge inside docker container.",480
802,foundry-support.txt,"Is there a clean way to get the compiler to ignore outdated solidity versions when running scripts? As in libraries that are not in scope for that script Strange, it’s not working for me Can you please open an issue? You mean not compiling the entire project and only building the scripts deps? So that it's faster? Does anyone know how the hook the message sender in sol test based on foundry? // SPDX-License-Identifier: GPL-3.0 pragma solidity >=0.4.16 <0.9.0; import ""../lib/forge-std/lib/ds-test/src/test.sol""; import ""../src/Minter.sol""; contract MinterTest is DSTest { Coin coin; address address1 = address(0); address address2 = address(1); function setUp() public { coin = new Coin(); } function testGetInitialValue() public { assertEq(coin.get(address1), 0); coin.mint(address1, 100); assertEq(coin.get(address1), 100); } function testSending() public { assertEq(coin.get(address2), 0); coin.send(address2, 30); assertEq(coin.get(address2), 30); } } pragma solidity >=0.4.16 <0.9.0; contract Coin {  // The keyword ""public"" makes those variables  // readable from outside.  address public minter;  mapping (address => uint) public balances;  // Events allow light clients to react on  // changes efficiently.  event Sent(address from, address to, uint amount);  // This is the constructor whose code is  // run only when the contract is created.",339
803,foundry-support.txt," constructor() {   minter = msg.sender;  }  function mint(address receiver, uint amount) public {   if (msg.sender != minter) return;   balances[receiver] += amount;  }  function send(address receiver, uint amount) public {   if (balances[msg.sender] < amount) return;   balances[msg.sender] -= amount;   balances[receiver] += amount;   emit Sent(msg.sender, receiver, amount);  }  function get(address targetAddress) public view returns (uint retVal) {   return balances[targetAddress];  } } the testingSending always fail may related to the msg.sender not hooked with address1 vm.prank(address1) Hi, is anybody having issues forking Optimism locally? I am running some tests that involve interacting with Protocols deployed on Optimism and the issue is the tests are not fully reproducible: given the same input, sometimes they work and other times I get errors regarding SafeMath: subtraction overflow in the contracts I am interacting with but not every time I am forking using an Alchemy Node using a specific Block Number so everything should be fully reproducible Any idea? Thanks Hi, Is it possible to test a contract with receive() function, where receive() modifies a state variable? Every time I try to test a contract that does this in receive() the transaction is reverted while testing, it works with manual testing on testnet.",288
804,foundry-support.txt,"//SPDX-License-Identifier: GPL-3.0 pragma solidity ^0.8.10; import ""../../lib/forge-std/src/Test.sol""; contract Lottery {  address payable[] public players;  int public count;  receive() payable external {   count++; //  players.push(payable(msg.sender));  }  function getBalance() public view returns(uint){   return address(this).balance;  } } contract LotteryTest is Test {  Lottery lotteryContract;  receive() external payable {}  function setUp() public {   lotteryContract = new Lottery();  }  function testBasicOK() public {   payable(address(lotteryContract)).transfer(0.1 ether);   assertEq(lotteryContract.getBalance(), 0.1 ether);  } } does foundary generate anything analogous to hardhat_contracts.json? which is to say does it have an export all functionality similar to hardhat deploy --export-all this way we could load all contracts definitions into the UI Also another question, is there typechain integration as well? i didn't see anything in the docs about that oh it looks like we need to run typechain manually after foundary generates artifacts 🤔 forge test runs tests in both src and test, is that expected? Yes @gakonst quick q, does foundary generate anything analogous to hardhat_contracts.json? similar to hardhat deploy --export-all So we can load all contracts in front end soon it will https://github.com/foundry-rs/foundry/pull/1891 see here im happy that there is a --json flag for forge script now.",334
805,foundry-support.txt,"https://book.getfoundry.sh/config/hardhat.html?highlight=hardhat#why-does-this-not-work-out-of-the-box @gakonst how do i change the brodcast output directory? —json doesn't seem to do anything for forge script Additionally, it doesn't seem like —mnemonic-path is working. Not sure if i'm doing something wrong. forge script deploy/foundry-deploy/yourcontract.deploy.sol --rpc-url http://127.0.0.1:8545/ --json ./generated/foundry/broadcast/ --broadcast --mnemonic-paths ./mnemonics/mnemonic.secret --mnemonic-indexes 0 i'm trying to integrate foundry with the scaffold-eth-typescript template and setting up a directory for broadcast output would help a lot. hello I added a comment on an issue that I opened a while ago and that was closed. I re tested it and the problem is still there. Should I create a new one with the same problem? https://github.com/foundry-rs/foundry/issues/1866 is there an official documentation for foundry tools? https://book.getfoundry.sh/ hey guys are coverage reports coming soon? sorry to bother with this or is there any ways to use dapp tools as a backwards compatibility thing to do a coverage report? how do you get the json file shown here? https://twitter.com/gakonst/status/1531056762119262208 — adding —json to forge script just gives (logs,gas used,results). edit: nevermind, this is the output after sending the tx to a node / simulating it with a node can I use vm.chainId() to test cross-chain messages? For example in my test I set chainID to 1, deploy a contract, then set chainId to 2 and deploy another contract and then test cross-chain messages between the two? or does the chainId not effect the execution enviroment? Is it possible to get deployment gas cost estimates using the new broadcast cheat code? I am using the foundry rust template (https://github.com/gakonst/foundry-rust-template) and it currently has lib under contracts. However forge install`creates a new `lib folder in the root of the folder . is this as intended i.e.",478
806,foundry-support.txt,"we are meant to handle the layout in foundry.toml ? when i run foundryup it appears that only forge and cast are being updated but there is no reference to anvil is this correct? I've reinstalled foundryup but didn't help Put this anvil --version Whats the output ? anvil 0.1.0 (123ad0a 2022-06-12T00:04:51.712075Z) so ig it updates it but just doesnt display that in the message can you run which foundryup? I'm thinking you might have installed it in a new location and still have an old install I do see an anvil output when I run foundryup but it also seems you have the latest version Hello I was wondering why the newer install of Foundry have you inherit tests from Test and not DSTest? When I inherit my test from Test I recieve an error when trying to declare the vm, but when I inherit from DSTest, everything works smoothly. Any ideas why? No need to declare the vm :€ :) It's already declared for you Great! Thank you!!! has anyone got mnemonic paths working with forge scripts? Should work the same as in any other command? say i deploy a contract with external libraries in a script like so  function run() public returns (address) {   vm.startBroadcast();   return address(new C());  } when i broadcast, I can see the individual deployed contracts, but I don't have a great way to determine their identities is there a forge native way to link the addresses to the contract/library names/files ? (it is true that i can get the deployed bytecode for each contract, and search for a match in the out folder) Hi, Is it possible to test a contract with receive() function, where receive() modifies a state variable? Every time I try to test a contract that does this in receive() the transaction is reverted while testing, it works with manual testing on testnet.",405
807,foundry-support.txt,"``` //SPDX-License-Identifier: GPL-3.0 pragma solidity ^0.8.10; import ""../../lib/forge-std/src/Test.sol""; contract Lottery { address payable[] public players; int public count; receive() payable external { count++; // players.push(payable(msg.sender)); } function getBalance() public view returns(uint){ return address(this).balance; } } contract LotteryTest is Test { Lottery lotteryContract; receive() external payable {} function setUp() public { lotteryContract = new Lottery(); } function testBasicOK() public { payable(address(lotteryContract)).transfer(0.1 ether); assertEq(lotteryContract.getBalance(), 0.1 ether); } } ``` Any etherscan verification magician:)? hey guys, can someone please tell me how to add a struct as constructor args when using forge create to deploy a contract? When you pass --private-key, is that address always msg.sender unless otherwise changed? Hello people! I've installed foundry correctly with foundryup, but forge commands are conflicting with a linux mint package. Any hint ? you probably need to use an alias for forge or configure your PATH accordingly, so that the foundry install dir is found first Yes ! Thanks :) solved hi team, what's the easiest way to git clone a repo and make it run in foundry if the repo doesnt support foundry? for example, i tried to download uniswap v2-periphery repo. to make it use its imports, i tried to 1. forge install Uniswap/solidity-lib 2. add @uniswap/=lib/solidity-lib to remappings.txt 3. forge run but i get Failed to resolve file: ""bblanc/v2-periphery/lib/solidity-lib/lib/contracts/libraries/TransferHelper.sol"": No such file or directory (os error 2).  Check configured remappings. do a ls on your lib directory ``` ""bblanc/v2-periphery/lib/solidity-lib/lib/contracts/libraries/ ``` this is a clue that your remapping is wrong. i.e.",431
808,foundry-support.txt,"you have 2 /lib/ it didn't work :( $ ls lib/solidity-lib/ LICENSE contracts package.json test waffle.json README.md echidna.config.yml slither.config.json tsconfig.json yarn.loc $ ls lib/solidity-lib/contracts/ libraries test thx for the suggestion samuel shouldnt it work out of the box? not sure tbh currently fighting a remapping hell too. Might be useful to update the foundry book with cannonical instructions on this I think it might also have to do with where you lib file is .. is it in the root or under contracts? root that's waht happens when you do forge install Uniswap/solidity-lib I think its a bug , as forge build expects it to be under contracts. Just a hunch though it doesn't seem to work with forge scripts I see two ways of remapping, one is by creating a file, another is updating them in foundry.toml Can someone suggest which one has high precedence foundry.toml is there a way to silence the vscode warning ? The contracts compile but vscode ignores the remappings yea i'll prob try to catch the team around and ask And which one is recommended? I see in foundry book everywhere it is talked about creating a new file Which Solidity VSCode extension are you using? Juan Blanco solidity Check the output in the broadcast/…/run-latest.json, you’ll see in latest foundry release that it shows contract name yes https://book.getfoundry.sh/config/vscode.html already added these cat .vscode/settings.json {  ""solidity.packageDefaultDependenciesContractsDirectory"": ""src"",  ""solidity.packageDefaultDependenciesDirectory"": ""lib"",  ""solidity.compileUsingRemoteVersion"": ""v0.8.10"" } you can try adding this as well to settings.json ""solidity.remappings"": [""forge-std/=lib/forge-std/src/""] Do you have a remappings.txt file? A few days ago I saw a tweet about a repo that builds into a local etherscan, I think it mentioned Anvil as well. Anyone know of such a tool; to create a local block explorer? Maybe Otterscan? yess that might have been it, thanks! Hey , I am seeing that Remix tests gas report and the foundry gas report is not consistent.",481
809,foundry-support.txt,"Any ideas of that situation? it uses sourceify not etherscan foundry gas tests are different search the chat for an in depth explainer hello any news on the status of this? Cool, but I wasn't writing to you haha Lol omg sorry Anyone have examples of how to use getNonce to get the next deployed contract address? is forge bind stable? I am trying to use it but get an error with all my contracts. The main one with it trying to clone a struct that doesnt implement the clone trait. When I try to add clone to the structs definitions  #[derive(Clone)]   pub struct Marketplace<M>(ethers::contract::Contract<M>); , I get this error: conflicting implementations of trait `std::clone::Clone` for type `marketplace::marketplace_mod::Marketplace<_>` i havent used it in a while OkI get why this isnt working , as its manually implementing clone  pub struct Marketplace<M>(ethers::contract::Contract<M>);  impl<M> Clone for Marketplace<M> {   fn clone(&self) -> Self {    Marketplace(self.0.clone())   }  } maybe there’s a bug @mattsse not many ppl use it atm unfort Ill take a look and try to PR it to a usable state @meetmangukiya did submit a PR that might be worth merging can you please open an issue with the abi that generates wrong code? Hello one question. In foundry how sensitive data is handled (private keys and such) in hardhat I do it with .env you can do the same and use a justffile/makefile or if you want to use the toml file is it possible to impersonate many accounts at once? In the same test case? You should be able to call vm.prank() with different addresses at different parts of the test code, within the same test function im using anvil and impersonate_account i mean can i impersonate so many accounts then send transactions from any one of them? Ahhh sorry thought you were talking about forge testing. I'm not familiar with anvil yet. Will let others jump in to answer this this should be possible, was added 2 days ago The issue was with the orignal toml in the bindings folder and the lock files . for dependencies that use git , you need to run cargo update otherwise it stores the version which was used when the crate was created.",494
810,foundry-support.txt,"In the version it references, ContractDeployer does not exist in builders (its throws many similar errors). I was able to solve this by hard coding the main brancn in the Cargo.toml file in the bindings crate . IT also works if you delete the Cargo.lock file in the root additionally , I am not sure its helpful having the bindings folder it would throw an error unless you over write it Hey guys, question regarding ANVIL: I'm running an anvil node (fork): anvil --fork-url $MY_NODE_URL --fork-block-number 14178088 And I get this error coming from go-ethereum ethclient.NetworkID(ctx context.Context): invalid net_version result ""0x1"" I tried to run the same manually: $ curl -X POST -H ""Content-Type: application/json"" --data '{-data '{""jsonrpc"":""2.0"",""method"":""net_version"",""params"":[],""id"":67}' http://localhost:8545 //anvil resp - same as above, fine {""jsonrpc"":""2.0"",""id"":67,""result"":""0x1""} However after I tried hardhat (same nodeUrl and block) I get this and no error: //hardhat resp {""jsonrpc"":""2.0"",""id"":67,""result"":""31337""} Could you kindly clarify if this is a bug with anvil or not? Thanks! Is there any way to export the gas report (similar to the gas snapshot) so that it's possible to compare diffs to previous reports? getting Error: 0: specified chain_id is different than the signer's chain_id when passing an anvil private key to cast send - user error or bug? Are you on latest? yeah, anvil 0.1.0 (6422ea7 2022-06-14T00:07:51.505341Z); cast send $con ""setMintPrice(uint96)"" 0 --private-key=$SECRET.",402
811,foundry-support.txt,"$ETH_RPC_URL set to http://127.0.0.1:8545 forge script works fine with the pk fwiw Getting this error for script subcommand error: Found argument 'script' which wasn't expected, or isn't valid in this context Could it have something to do with this error I got when doing foundryup? foundryup: installing foundry (version nightly, tag nightly-) foundryup: downloading latest forge and cast ############################################################################################################################ 100.0% tar: Error opening archive: Unrecognized archive format foundryup: downloading manpages -#O=# # # tar: Error opening archive: Unrecognized archive format foundryup: installed - forge 0.2.0 (90617a5 2022-04-12T00:13:04.257461+00:00) foundryup: installed - cast 0.2.0 (90617a5 2022-04-12T00:13:04.257461+00:00) foundryup: done you'll have to reinstall foundryup with instructions via the github https://github.com/foundry-rs/foundry Cheers hey all, just curious about best practices when writing tests for owner only functions (since you have to do vm.prank(0xb4c79daB8f259C7Aee6E5b2Aa729821864227e84)) vs non-owner only functions. Is it possible to have multiple setUps in a single test contract? Or do you split them into 2 contracts? You cannot have multiple setUps in a single contact, AFAIK.",341
812,foundry-support.txt,"You can inherit your base test contract to have multiple setUps() I opened a ticket on this issue that has been closed but I still have this problem Here it is I am doing same as you....I use anvil and trying to send a tx by using the first anvil address https://github.com/foundry-rs/foundry/issues/1866 @mattsse seems like we didnt address it i can repro confirming that reverting https://github.com/foundry-rs/foundry/pull/1839 fixes it ah ok found the issue fix incoming should be fixed now please foundryup -b master menox @emo_eth Oh thank you very much I'll try later and let you know I hope in the future when I'll know rust I could be able to fix it by myself eheh https://doc.rust-lang.org/book/ Ehehe I know thanks....I also have programming rust second edition You advise that book too? Hello guys I'm having an issue with my compiler I've removed the enum.sol file from this folder but the compiler is still picking it up and throwing an error I was also working fine b4 I tried to upload on to github any advice ? It's not even the same folder 🤔🤔 try forge clean its my defacto command when things start getting weird Enum dot sol already imports VoterModule I disagree with that because this in principle is a solidity error Not foundry related So you need to not import it twice Read the compiler error 🤗 any good repos suggestions for best practices / inspirations in deployments w foundry? 🙏 Enum doesn't have any imports I copied if from the gnosis contracts and imported it for voter module But I'll keep trying Thank you guys for replying so quickly I appreciate it You can start with this repo: it includes deployment using both forge create as well as scripts https://github.com/PraneshASP/foundry-faucet also : https://github.com/crisgarner/awesome-foundry any ideas? anybody? go-ethereum lib is updated... cc @mattsse Hey everyone, can anyone point me to an article or video tutorial that talks about scripting for deployment in-depth https://book.getfoundry.sh/index.html Hi, I'm running local blockchain using truffle develop.",471
813,foundry-support.txt,"When I tried to deploy using forge script script/Contract.s.sol --rpc-url http://127.0.0.1:9545 -vvvv --broadcast --private-key xxx I got this error: Error:  0: ProviderError(JsonRpcError(JsonRpcError { code: -32700, message: ""The method eth_feeHistory does not exist/is not available"", data: None })) For deployments there is a new section on solidity scripting : https://book.getfoundry.sh/tutorials/solidity-scripting.html truffle is probably out dated. i would recommend using anvil which is packaged in foundry I see, thanks for info! try doing --legacy if you really need it but the reality is you should nevre use truffle develop and you should consider anvil as Brock said legacy works, thanks! Will try anvil 👍 ah eth_networkId returns a string, and chainId hex num -.- fix incoming simple fix ye thx I did foundryup but still couldn't get the Script.sol in my existing project do I have to add it manually? maybe we havent updated the default template to have it yet probably need to update foundryup itself? or maybe we did - i forget ye maybe So how do I go about it? oh we did https://github.com/foundry-rs/foundry/pull/1877/files its under script/Contract.s.sol Got it thanks 👍 why does foundry needs to tests to generate gas reports? I would have though it would be possible to do this via compilation like Remix is it possible to change a state variable of a particular contract by using vm.assume? Nope assume just limits the inputs From the fuzzer ohh cool. is there any other way to do that? for testing? vm.store cool. thank you. In my script I deployed two contacts and it worked, but when I checked Mumbai polygonscan the contracts were not verified.",395
814,foundry-support.txt,"do I have to provide additional tags during deployment? Did you pass --verify? And if so, did you have any error in the end ? We should probably make verify work on an already executed deployment? What do you mean ? Even without passing the flag ? Like I deploy without verify And then I want to verify Ah but that works already Oh does it How - I forget Without the broadcast flag, only the verify flag How does it know which deployment to take? The latest? RPC + latest Yes I did No didn't get any errors Hmm, I'd need a bit more info... Latest forge version ? How did the output look like, how did you call and stuff... Maybe you can try to repeat and make an issue out of it ? forge script script/NoValidator.s.sol:NoValidator --rpc-url $MUMBAI_RPC_URL --private-key $PRIVATE_KEY --broadcast --verify --etherscan-api-key $ETHERSCAN_KEY -vvvv I am using the version 0.2.0 Can you get the rest? + Commit In the past, there were some silent errors with etherscan, wondering if yours is up to date forge 0.2.0 (6422ea7 2022-06-14T00:08:41.410851905Z) Hmm, I don't know. Never used Mumbai, does the stdout show anything meaningful ? Can you run on the same project, this command without the broadcast flag ? It will try and verify the already deployed contracts There was nothing different in the stdout, though I noticed that there isn't any output showing the the contracts are being verified (I have used the script on another contract deployed to rinkeby so I am comparing the output). Tried running it with the same command but without the --broadcast, but I only got ""Start contact Verification"" and nothing else I'm using the fuzzer and need to use the vm.assume cheatcode in such a way that I bound my two inputs by a combined property: function testIncreaseAuthorization__CurrentAuthorizationNonZero(  uint256 firstAuthorization,  uint256 secondAuthorization ) external {  // Bound the sum of the authorization amounts to max uint256 to avoid overflowing.  vm.assume(firstAuthorization + secondAuthorization <= type(uint256.max));  // ... } But this doesn't work - I'm getting an ""Arithmetic over/underflow"" error.",487
815,foundry-support.txt,"Is this doable at all? Is the repo public? I think opening the issue might be the best It's a private repo :( Nevermind, it seems to work when I write the boundary condition like this: vm.assume(firstAuthorization <= type(uint256).max - secondAuthorization); yep - this is the right way to do it can you try adding --chain-id ? working on forge doc proof of concept, what do you folks think of this current output? https://github.com/0xYYY/v3-periphery-foundry/blob/main/docs/base/ERC721Permit.md (still missing events and errors) @rkrasiuk i think it would be good to have the links to all the methods at the top - e.g. ""contents"". then you can just click on one of the methods and it takes you to the relevant part of the doc. would be nice if we can generate automatically an mdbook, similar to how foundry book is https://github.com/foundry-rs/book Maybe exclude all .t.sol files So it seems the issue is coming from my existing repo (already updated to the latest, but don't know why It's not verifying my contracts ). I tried deploying the same contracts on a new project(using forge init projectName) and the contract got verified will take a look at this, with all the markdowns generated, should be easy to serve them with mdbook looks good as a poc, we were considering having the doc parsed into a struct and then rendering it to a template of user’s choosing or a default one i.e. mdbook like So you can't check EXACTLY for the event with specific params? a: 3, b: 'bla', c: 4 ? I'm looking at expectEmit and it's bools only as args ? Yes you can:) Read this: https://book.getfoundry.sh/cheatcodes/expect-emit.html You first expectEmit (the 3 first bools are basically ""check topic 1, 2 , 3"", topic 0 being checked by default, the 4th one being the log data), then emit the event (yes, declare and emit it in your test, with the expected args) Ok but who checks the contents of the data Oh // We emit the event we expect to see.",476
816,foundry-support.txt,"then we call yes:) Thanks it threw me off a bit, maybe there's a better keyword pluggable there or something Now if you have any experience in etherscan debugging, feel free to jump in 😄 https://t.me/foundry_support/14742 I sadly saw it going through my 273 missing messages and did a little prayer for u 🙏 I've never verified / deployed with foundry yet still writing the tests what's weird is I'm now deploying/verifying other contracts (with similar imports etc), without running into issues, just this repo fails... Can you slither it? Does it use any libraries ? Yes, one (repo is here if you wanna peek: https://github.com/jbx-protocol/v1-v2-migration-terminal Deployed another similar contract, with the same library/imports, without verification issues slither? I think I run the vscode plugin, why? or you mean flatten? Yeah, could verify it if flattened':) Are they external or are they deployed with the contract ? I was talking about catching events in Solidity - you can use Foundry's tooling to test events, as is pointed out in the comments Deployed with the contract (structure is “deploying A, which inherit B, which import/deploy/use a lib”) Trying to use vm.envUint but get environment variable not found. Does it not read the .env file and do i have to use setEnv? Odd that I can call functions on FLA but the event is not recognized? rewritting them in the .t.sol is Test feels weird Do I need to separate my events in the main contract and inherit them in the is Test is MyEvents ? yeah unfortunately 😕 or duplicate the function signature np, it worked abstract contract FastLaneEvents { and inherit nah that's too error prone to my taste [FAIL.",379
817,foundry-support.txt,"Reason: You have an active prank already.] wish another active prank would just close the previous one can prob write my own helper for this hmm is there a good project w/ their forge tests up on github? trying to get a sense for best practices Just had to add export in front of the variables in .env and then run source ./.env && forge test I don’t know if we are a “good” project, but at least we try to: https://github.com/jbx-protocol Juicebox V2 is mixed (unit tests were in js then we switched to forge for e2e), and all other peripheral repos going fwd are using forge too (v1v2migration, jbxStaking, extension template, etc) disclosure of me being contributor there - don’t wanna spam, delete this if not appropriate) thank you! this is exactly the kind of thing i was looking for 🙏 Critics are obviously always welcome;) https://github.com/gakonst/v3-periphery-foundry Does forking from Polygon Mainnet work just the same as Ethereum Mainnet? Hitting UniswapV3Router for the factory address when forking from Polygon isn’t returning anything. Works fine when forking Ethereum. Just successfully made the request on Polygon via getlaika.app. Please file an issue with a repro and we can investigate! potentially stupid question: where can i find the abi files if i compile with forge build? my out directory only have .sol files o-o Those aren't files.. They're folders welp, at least i qualified it as a stupid question 🤦‍♂️ I am trying to run a fuzz test on adding liquidity to my CSAMM and I keep hiting an ""Arithmetic over/underflow"" error. I cannot find a solution in the GitHub that worked for me but will open a new issue if needed. I wanted to check on here first though. For context, I am minting 1e18 of each token in my setUp test before the fuzzer.",417
818,foundry-support.txt,"Can anyone take a look? MINT_PRICE is a public constant of 1 ether // passes uint256 balanceBefore = alice.balance; uint256 supplyBefore = nft.totalSupply(); uint256 mintPrice = 1 ether; assertEq(mintPrice, sale.MINT_PRICE()); vm.prank(alice); sale.mint{ value: mintPrice }(0); assertEq(nft.totalSupply(), supplyBefore + 1); assertEq(alice.balance, balanceBefore - mintPrice); // fails [FAIL. Reason: Revert] uint256 balanceBefore = alice.balance; uint256 supplyBefore = nft.totalSupply(); assertEq(1 ether, sale.MINT_PRICE()); vm.prank(alice); sale.mint{ value: sale.MINT_PRICE() }(0); assertEq(nft.totalSupply(), supplyBefore + 1); assertEq(alice.balance, balanceBefore - sale.MINT_PRICE()); Reading from the constant seems to fail the test what's the best way to ""add"" foundry to an existing repository? Hey guys, seems like stdStorage unable to find bool in a map => struct variable. I debug it and found out that the rdata not return hex”1337” if who.staticcall to the bool slot and the whole bytes turn to 00..00 oh this makes sense - i think might have to do with packing can you open an issue with a repro here? https://github.com/foundry-rs/forge-std/ sure, you need the repo/snippet for test as well? of course 🙂 repro = all the steps needed for us to reproduce your issue with 1-2 commands cool Figured it out, After clearing the cache I was able to deploy and verify 👍👍 Hm, since when was this repo using its cached build ? Weeks ? We changed artifacts a couple weeks ago, wondering if it's coming from there What could be a reason for --match patterns not working with ""forge test""? Neither contract, path, nor function regex do work. All tests get loaded. Ah, I think I resolved it myself. Sorry for the noise. You have to set the path, then the contract, then the function for the match patterns to work. I tried fuzzing, but it didn't work. I get why it didn't work but I'm not familiar with those two terms under ""Failed tests"", ""Counterexample"" and ""args"".",493
819,foundry-support.txt,"What do they mean? Your test failed for that input It is a ""counterexample"" because the fuzzer found an example input that counters your claim that the tests pass? yes oh lol sorry I though it was him asking if that was what a counterexample is Is there any way to set default root path for “forge install” command ? I have a mono repo architecture so foundry code is inside packages folder. I updated libs=[“my_path”] in foundry.toml file, when I do “forge install” it installs in root directory. Every time I have to set –root path i want to set the default lib install directory is there anyway. should be already enabled by this PR: https://github.com/foundry-rs/foundry/pull/1858 perhaps try running foundryup? Ohh thanks will check I get that. I made a typo in the initial question. Now I'm confused, are you asking me or telling me? Telling you Hi is there a way to console.log some variables during fuzz test? so the ""counterexample"" is a case where the test actually passes ? No it's where the test failed Have you tried ""log"" and ""console.log"" ? https://book.getfoundry.sh/reference/ds-test.html It assumes the test should pass, the fuzzer tries to break it with different inputs if it finds one that's the counterexample where the tests and by extension your underlying code breaks and is not doing what you expect Oh, thanks. yes I did tried console.log but it doesn't seem to output anything. Can you share a code snippet? function testFuzzTestCase(uint outputVal) public { vm.assume(outputVal >= 0 && outputVal <= Max); (uint outputAmount ) = generateAmount(outputVal); console.log(outputAmount); //continue... } and the command: forge test -vvvv -m testFuzzTestCase I can understand that there would be a bunch outputs from the log, If there is a way to break and log out what's assumed that would be handy too. I tried it on my end too, same result. https://sambacha.github.io/dappspec/ sorry if I ask again but got no answer. I have an existing project repo and I want to ""add"" forge.",470
820,foundry-support.txt,"what's the best way to do that? as far as I can see from the book there's not an example for this use case uh, forgot about require(false); that can break the test and see logs. IF this is the section you are referring to , https://book.getfoundry.sh/projects/working-on-an-existing-project.html, its for projects already using Foundry. I dont think there is a way to automatically integrate these and you would have to move stuff over manually and mindful of the hardhat integrations if any (https://book.getfoundry.sh/config/hardhat.html) gotcha thanks Hey Y'all, I wanted to ask if it's safe to push the broadcast folder to GitHub or it should be ignored Hey! Does foundry support library testing? if I have something like this: struct MyStruct {  uint256 x; } library MyLibrary {  function someMethod(MyStruct storage s) internal view returns (bool) {   return s.x == 0;  } No private keys are leaked if that's what you're worried about same question 🤔 yes it does 🙂 try it out we dont have assertNeq but we could add it - it’s not that hard. see how forge-std has some extra asserts and look for the relevant conversation in the issues Hello, Im trying to interact with a custom local network using cast but am receiving the error Error: 0: specified chain_id is different than the signer's chain_id Is there a way to configure the chain ID when using cast? in short, I've deployed a 5 node Avalanche network locally with this tutorial https://docs.avax.network/quickstart/create-a-local-test-network and am using an RPC provided by the service http://127.0.0.1:61156/ext/bc/C/rpc I have deployed a contract just fine but am unable to interact with it when using cast This only happens with the local test network but works on Avalanche testnet and mainnet note: this also happens when the workflow is done with anvil Nvmd, this was due to an error on my part. Forgot to change the block number from what I was using for Ethereum Mainnet and was probably at a block before Uniswap was deployed to Polygon.",460
821,foundry-support.txt,"Can I use foundry fuzzer for create2 vanity addresses or it's retarded 🙈? cast wallet vanity ah we only do nonce/create addresses i think the right solve is to add create2 to the cast algo it’s for simple nonce grinding tho yeah i want to find salts my rust level probably doesn't allow me to go there but I'll keep it in mind good time to learn 😉 #[derive sorcery] If you reaaally want, you could fuzz private keys, generate the public key, and wrap the create2 with prank or broadcast using that address ... I think it should work 🤔 And/or salt Ok you just want the salt. Then just using broadcast/prank with your public key should work did you figure out how this works with forge script? seems like it does take the mnemonic for the execution of the script it's just the from address that takes another value has this become available yet? did you pass in a from value? i wanted to create a script to run forge to deploy all the contracts based on a seed file close huh https://github.com/0age/create2crunch :))))))) there is a companion medium article detailing how it works etc etc Hey guys! Do you know is etherscan verification functionable of not? I did deployment on rinkeby like that: ``` forge script script/Deploy.s.sol:Deploy --rpc-url $RINKEBY_RPC_URL --private-key $PRIVATE_KEY --broadcast --verify --etherscan-api-key $ETHERSCAN_API_KEY -vvvv ``` and see this output ONCHAIN EXECUTION COMPLETE & SUCCESSFUL.",324
822,foundry-support.txt,"Transaction receipts written to ""broadcast/Deploy.s.sol/4/run-latest.json"" ## Start Contract Verification Transactions saved to: broadcast/Deploy.s.sol/4/run-latest.json but contracts not verified… whats a good way to debug arithmetic overflow / underflow errors? trying to spot where it is originating from and what were the values of operands can you try clearing the cache and deploy/verify again ? gm whats your go to repo for functional and unit tests implemented with forge according to best practice? Is it expected behaviour that lib folder is empty? Just upgraded foundry Magic, works now, thanks Might have been some old cached artifact or was it a brand new project? Yeah i think its because i have multiple projects in same repo hmm Got it fixed with --no-commit & forge update 🤘 awesome is there any helper with forge scripts to check if a contract is already deployed? forge wont build with the latest solidity version https://github.com/foundry-rs/foundry/issues/1991 i want to encode f(uint256,uint32[],bytes10,bytes) with values (0x123, [0x456, 0x789], ""1234567890"", ""Hello, world!"") so i write: cast calldata ""f(uint256,uint32[],bytes10,bytes)"" ""0x123"" ""[0x456, 0x789]"" ""1234567890"" ""Hello, world!"" but something wrong.. need help ;( was released yesterday, should be included in next nightly I believe Is there any place explaining how exactly the auto_detect_solc works? Trying to understand why an specific version is used on my project, particularly if having a hardhat.config.js is taken into account The case is: 0.8.13 is defined as default on the hardhat config, but then on the contracts there is no reference of 0.8.13, ^0.8.13 or any other ""direct"" reference to 0.8.13, mainly just ^0.8.10 And the contracts get compiled with 0.8.13 Actually scratch the hardhat part, it is only in one lib used by the project, nothing on the config of the project itself Just noticed that forge fmt is now available. Is it documented anywhere? I couldn't find it documented in the Foundry book.",479
823,foundry-support.txt,"I'm curious what does it use under the hood? Is it Prettier? it's still in the early stages and being improved, so it hasn't really been announced/documented yet — it's new code, no existing tools like prettier are used https://github.com/foundry-rs/foundry/tree/master/fmt as a result it is super fast, formatting is pretty much instant auto detect defaults tothe most recent supported version based on your pragmas pinging this again this still happens on latest nightly? here are some docs on this https://github.com/gakonst/ethers-rs/blob/master/ethers-solc/src/resolver/mod.rs#L17-L35 i have fuzz runs configured to < 256, how is it possible to hit max global rejects of > that number Would someone have an example of a foundry test where a whale transaction is pranked to simulate a AMM swap rate (Curve, Uniswap, etc.)? Yes it is Could you please open an issue with the cast command you‘re running? hello, can someone pls help me out? when we define a map of map, how do we access the value of the second map from another contract? contract A { mapping(uint => uint) ab; mapping(uint => mapping(uint => uint)) xyz; } contract B { function hello() {  uint val1 = A.ab(1); // works!  uint val2 = A.xyz(1)(2); // how to do this? } } thanks! 🙂 Error:  0: specified chain_id is different than the signer's chain_id Seeing this when using cast send with anvil. Clues? Shouldn't be happening on latest oops lol my bad (yes works on latest) is individual assumes for each condition detrimental to fuzzer performance? should i && all the conditions? thank you, do you have the companion article? I'll try to fork this for a specific prefix We simulated some whale behaviour here: https://github.com/akropolisio/vortex/blob/main/src/BasisArb.t.sol#L181-L197 , but it was more to check deposits , withdrawals , and accounting although uniswao was invovled.",454
824,foundry-support.txt,"I hope it helps Hi, I am trying to interact with the contracts of Perp Protocol on Optimism using Foundry and an Alchemy node to fork always at a specific block number the chain locally Sometimes, so not every time, running the same tests that usually pass, I see them failing inside the forked Perp contracts (so I do not have the source code line) with a SafeMath issue [FAIL. Reason: SafeMath: subtraction overflow] So I'd like to know if anybody using the same setup consisting of Foundry, Alchemy and Optimism has ever observed something similar Thanks I completely removed foundry from my machine and reinstalled using foundryup and it worked weird case: - I'm deploying some contracts on anvil using forge script - then I call a few cast send which mostly work. Two of them should either fail or have logs. Both succeed but one of them (the last one) has no logs, but the tx goes through. - then I run cast run to replay the tx, which then actually reverts. Why didn't the cast send call fail prior to that? Interesting Just in case, most probably not, but anyway. Is it possible to use hardware wallet with foundry? 😄 of course 🙂 --ledger / —trezor ah, nice, thank you! So cool, found in script docs already One, hopefully last, question. how to call forge script to pass param to run method from outside, ie: ``` contract Deploy is Script { function run(address proxyAdmin) external { ``` hmm seems like fuzz_max_global_rejects might actually be input that get rejected by all the assume statements, why would i want my tests to fail for a very constraint fuzz test? how to put, which exact wallet address I want to use, via --hd-paths “m/44'/60’/999’/0/0”, right? Thank you very much team Really enjoying the product great job! @gakonst said batching assumes is more performant but I actually am not convinced why that's true 😅 fuzz_max_global_rejects is a bad name and I think this should be changed (https://github.com/gakonst/foundry/issues/1202) — basically, that name is leakage from the underlying fuzzer lib that's used.",473
825,foundry-support.txt,"for foundry, that limit just applies per-test: - the local-rejects flag does nothing for us - the global-rejects flag is a per-test limit, so if it's set 100 a test fails after 100 assume rejections why does global-rejects exist? seems like if i am running a more constrained input fuzz test it ends up hitting this limit and as a result test fails Might be the same you mean? yea I think performance is the same correct, that will happen. if you set a really high reject limit (or if it was unlimited) and your assume condition is too tight, tests will never complete because the fuzzer can't figure out how to meet your requirements a better workaround for strict assumes is to use forge-std's bound gm, not sure if it is appropriate to ask this here. Any idea what could cause hevm.roll(1) to revert? I'm using DSTestPlus from solmate. doesnt seem like that’s a filter / doesnt return bool, how can i use this with vm.assume? oh hmm i see this can be used to convert fuzz input into a bounded input instead of rejecting fuzz inputs we transform them to a bounded input yep exactly! it lets you take a value and reshape it into the desired range GitHub Actions error, seems like 2 things might be off here: 1) the directory seems really odd, could someone confirm that everything before engine/contracts/Diamond.sol in the path is correct? 2) the first letter in Diamond.sol is not capitalized. I checked the repo and the repo has it correctly. Can someone help take a look? Relevant link: https://book.getfoundry.sh/config/continous-integration.html?highlight=github%20action#github-actions Is there any variable that I can put in my foundry.toml to use a specific rpc endpoint by default ? back to forge script: I'm running forge script script/Contract.s.sol:Contract --rpc-url=$RPC_URL --broadcast --sender=$ETH_FROM --slow --password=$ETH_PASSWD --keystores=$ETH_KEYSTORE but I'm getting Error:  0: IO: Is a directory (os error 21) any idea what I'm doing wrong? need to make sure that $ETH_KEYSTORE is a path to the file and not the keystore directory ohhh I see.",485
826,foundry-support.txt,"That was it, thanks!! bumping this as I'm running into the same issue, was there ever a resolution? Do console.logs get silenced in fuzz tests? simple question: what does `(runs: 256, μ: 676529, ~: 680380)` mean in the context of fuzz testing median / mean yes, but not in failing fuzz tests when exactly do you get this error? I've deployed to optimism with an alchemy RPC, and aside from inaccurate gas estimation by foundry it did work make sure you're on the latest foundry version too update fix this lol, thanks median and mean for what? it was fuzzing a variety of different types For each fuzz test's total gas consumption across all.the inputs hey! super new to Foundry but loving it so far. I'm trying to figure out my workflow for deployments, and also for things I would have previously used hardhat scripts for the first thing I'm doing is trying to interact with one of our contracts so I don't have to use Etherscan - setupDropsContract here https://rinkeby.etherscan.io/writecontract/index.html?m=normal&v=21.10.1.1&a=0xf2162d53e31019f0e964290f68c5e38e27c4e173&n=rinkeby&p=#collapse5 I'm like…99% sure I have everything right here, but it's just failing with no useful error and I can't figure out how to debug further. possible that there's a datatype error or something, but like…the contract is compiling? I've tried -vvvv and RUST_BACKTRACE=full but they're not giving me anything I can understand how to read lmk what else I can do to figure out why it's breaking - I also tried using the debugger but it goes way over my head also, wondering if there's a way to use environment variables (for things like contract addresses in different environments) in forge scripts - we'd usually have .env.rinkeby, .env.mainnet etc and use dotenv to load them in a JS context and I can't figure out what the forgey way of doing that is what does -vvvv show tho ? Is it possible to extract light client proofs or otherwise dump the account / state tries from Anvil? hm, can you update forge to the latest? doesnt seem to be the case...",497
827,foundry-support.txt,"or is it? if you had that on a forge test, do you think it would work/pass? I just updated - I thought I updated yesterday but just in case :) same error tho and hmmm, not sure - brand new to forge testing so I'm trying to figure out what the test would be when i see the two ()s in a revert it's because the function selector doesn't exist at that address - is CREATOR_CONTRACT_ADDRESS correct for the network? and/or could the function signature have been updated since deploying/the ABI otherwise changed? also i think a little strange that selector isn't auto-populated with function name (unless address isn't contract?) oh my god i'm DECEASED. wow. yes. I was using an old deployment address. tfw you've been coding since the 90s and feel like an intern 😅 forge really should make it clearer - took me a whiiiiile to pick up on that ah awesome thanks makes sense 🙏 ok another dummy question - when y'all talk about ""broadcasting"" - that just means ""actually run this on my RPC node"", so the default state is ~= a dry run? yeah, passing in --broadcast will actually submit tx to chain, otherwise it will simulate against a fork from rpc url (if provided), otherwise a fresh local chain if you figure out a better way to handle the .envs lmk.. currently using one big file with a bunch of MAINNET_ and ROPSTEN_ etc prefixes (sad face) can you pass custom args into run()? not super familiar w scripts but maybe could try something like source .env.ropsten && ... definitely doesn't feel optimal but will play around w that flow on my next foundry project Yes, but you also need to change the function signature.",368
828,foundry-support.txt,"Example here: https://github.com/memester-xyz/lens-protocol/blob/foundry/scripts/Deploy.sol#L40 Something like forge script <OPTIONS> -s ""run(address,address)"" <ARGS> perfect, thank you! is starting anvil a fast process? i'm going to be processing a bunch of transactions on forks and am not sure if i'm going to need some sort of connection pooling or thread pool or if i can just make a forked anvil as needed real nice you can use cheat codes like vm.envString to grab environment variables https://book.getfoundry.sh/cheatcodes/index.html?highlight=cheatcodes%20reference#cheatcodes-reference 🤠 👀👀👀👀👀👀👀 Shoutout to the crypto mississippian median and mean gas usage of the individual runs What would the prerequisites for a Ledger tx be? Ledger Live open? Hello there, There is way to compute automatically the keccak256 from the source here even if the contract is not verified on etherscan ^^ ? Not necessary. Just pass --ledger with it connected and pin entered Is this a script or test ? Scripts should show on the latest version (if they're present on Sam's external dB) Strange. When running a script with my Ledger, I get ""Error getting api_mutex: Hid(InitializationError)"" It's a test and i am using forge run, i will check it out with the script seems to be nice but didn't test yet! Thanks mate§ heya, don't know if it's worth an issue but I'm a bit curious: the broadcast json contractAddress always point to a 0x0x prefixed address (ig 0x0xB00B5ffffff...), is there a reason why? Needs a bit of work on frontend (since we npm it for latest deployment) (what would be really cool is to have a ""all in one"" json, à la hardhat, with the latest deployment address + abi:) Is ledger live open ? Sometimes having it open (or chrome with it connected) leads to some issues where they take ownership of the device and don't let go ? Try closing it, and reconnect the device 0x0x was fixed yesterday...",471
829,foundry-support.txt,"Should be on the latest version noice Feel like it would be ""crowded"" personally, and you can always find the abi other ways eg. Out/ folder But just my opinion @joshiedo Thanks it's works perfectly! yh yh, that's what we're doing now, broadcast and out that's a big json, indeed, but kinda work for hh tho You can also vm.label the addresses if I recall Thanks, I have Ledger Live and Frame open. Will close those two Hi. Why is it that if I try to send ETH in test constructor it will fail, but if I try to do the same thing on a test it will succeed? ``` pragma solidity 0.7.6; import ""forge-std/Test.sol""; contract TransferTest is Test { function send() private { (bool sent, ) = address(0x1).call{value: 1}(""""); if(!sent) { revert(""failed to send""); } } constructor() { send(); // will revert } function test001() public { //send(); // success } } ``` what command are you using for that? neither cast run or forge test show those for me Hi, quick update on this I have done more research on the issue and I have a candidate for where it could potentially happen, which is here   uint256 timestamp = marketOpen ? _blockTimestamp() : IBaseToken(baseToken).getPausedTimestamp(); https://github.com/perpetual-protocol/perp-curie-contract/blob/main/contracts/Exchange.sol#L577 and    uint32 deltaTimestamp = timestamp.sub(_firstTradedTimestampMap[baseToken]).toUint32(); https://github.com/perpetual-protocol/perp-curie-contract/blob/main/contracts/Exchange.sol#L581-L588 So the issue could be in the block.timestamp that is not correct So my questions are - is anybody aware of Foundry having this kind of issues with L2s and specifically Optimism Block Timestamp? - is it possible Alchemy somehow can return a wrong block.timestamp for a block in the past? Thanks I can't get the selector to show no matter which foundry branch I'm on or how trivial the selector (e.g.",453
830,foundry-support.txt,"balanceOf(address) is hELLO optimism doesnt have blocks its a transaction list Sure but the point is I am forking at a specific point in time (whatever the way the state(time) function is represented) with Foundry using --block-number 14935705 Does it guarantee reproducibility? And even if the answer would be no, and I am forking the most recent state all the time, then there is still an issue as Perp in its code does not check that subtraction can underflow because by construction the first term > second term What’s the difference? Is “cast run” a script? Anyway to replay a transaction in a “script” to get the function singatures transformed? OK, I have checked the block.number and block.timestamp and I have seen the block.number passed via CLI is completely ignored so I think I am probably getting the most recent state of the chain (values are always increasing) I think it could be nice to have some kind of automatic check in Foundry to check block.number (whatever block means on the specific chain we are working on) with the block number specified via CLI Anyway, there is still the issue of the mismatched timestamps making that code in Perp fail (I do not have the final proof it is that code because I can't check the second term of the subtraction because it is internal, however, I am pretty sure since it is the most reasonable explanation so far) block timestamp can drift as much as 12-14 seconds https://github.com/ethereum/go-ethereum/blob/01e5e9c2c3fa1cf7a9747148dca22d59ff9839b6/consensus/ethash/consensus.go#L46 block.timestamp returns timestamp at the time at which the sequencer receives the tx.",369
831,foundry-support.txt,- It may not actually correspond to a particular L1 block - this is for Abritrium https://github.com/perpetual-protocol/perp-curie-contract/blob/13e28b3286c2fddff5421564168929891a9d73fd/contracts/base/BlockContext.sol#L5 block timestamp is not monotonically increasing i think on L2 I was aware of this for Arbitrum and Perp devs were also aware // SPDX-License-Identifier: GPL-3.0-or-later pragma solidity 0.7.6; abstract contract BlockContext {  function _blockTimestamp() internal view virtual returns (uint256) {   // Reply from Arbitrum   // block.timestamp returns timestamp at the time at which the sequencer receives the tx.,162
832,foundry-support.txt,"  // It may not actually correspond to a particular L1 block   return block.timestamp;  }  function _blockNumber() internal view virtual returns (uint256) {   return block.number;  } } https://github.com/perpetual-protocol/perp-curie-contract/blob/main/contracts/base/BlockContext.sol Still on Optimism they use block.timestamp in their computations apparently with no particular checks about this drift (I have not audited the protocol myself but they have been audited and this is a pretty big thing) block timestamp comes from the block producers host yeah not gonna work 1:1 in fork mode or normal?, because --block-number should be picked up forge config --block-number 1337 | grep block_number for fork mode we have fork-block-number Hi.,I am trying to debug a specific test function using cmd forge test --debug test_f_mload().,.Idk why Asm_ttl contract didn't get loaded in debugger mode..,is there any other way to debug ? does it work if you rename the file to *.t.sol? perhaps we're skipping script files here @joshiedo ? Hi, sorry to writing again, do you have any example of how to do scripting with ledger? :'( trying something like: forge script script/DeployFactory.s.sol:Deploy \ --rpc-url $RPC_URL \ --ledger --hd-paths ""m/44'/60'/3'/0'/0"" \ --etherscan-api-key $ETHERSCAN_API_KEY \ --broadcast -vvvv receiving this error Error:  0: hidapi error: hid_error is not implemented yet Hello there! The most of time im testing payload in forked environment before sending in mainnet (Using Forge script/run). Here it's work perfectly inside the forked environnement but when im passing to the mainnet, it revert instantly and i would like to debug but cast doesn't support the —debug how to do debug or force the transaction to make a tx and then debug it ? what os linux(ubuntu) can you check whether libusb is installed? @joshiedo looks like a hidapi error, have you seen this before? I installed libusb-1.0-0-dev, nothing changed.",457
833,foundry-support.txt,"But even before, when ledger was disconnected it was knowing that, which means that it can at least detect device More detailed trace Error:  0: hidapi error: hid_error is not implemented yet Location: cli/src/opts/multi_wallet.rs:340 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ BACKTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1: __libc_start_call_main<unknown>  at ./csu/../sysdeps/nptl/libc_start_call_main.h:58 2: __libc_start_main_impl<unknown>  at ./csu/../csu/libc-start.c:392 OK so the --fork-block-number solved the issue apparently So the reason is a block in the past is not affected by the jitter mentioned here, right? https://t.me/foundry_support/15287 However, does this mean that block.timestamp on the real Optimism Chain (so no local fork) is seen by the Solidity code as not monotonically increasing? Btw, just noticed, that --mnemonic-indexes is also applicable to hardware wallets, but it's not mentioned in the book https://github.com/foundry-rs/foundry/blob/master/cli/src/opts/multi_wallet.rs#L337 in this case, command for the most common case (LedgerLive derivation path + index (ie 3)) will be (if drivers will work ofc :D) forge script script/DeployFactory.s.sol:Deploy \ ... --ledger --mnemonic-indexes ""3"" \ ... i'm foundry-pilled greetings Mr. nader dabit block is currently pinned to the network that's being forked currently in the process of adding cheatcodes to customize this for L2/L1 solidity doesnt generate the timestamp, that data is embedded during block construction.",390
834,foundry-support.txt,"All it does is pop it out of the block for you what is monotonically increasing is block number however eth2 semantics change some of this stuff so ymmv after merge Does script files always mandatory That was also my understanding, so does it actually mean on Optimism the block.timestamp we see in Solidity is actually non-monotonic? If this is the case, all the protocols using it for the computation need to take this into account on L1, block.timestamp is monotnically increasing and blocks are rejected if the timestamp is not greater than the previous block my understanding is that on arbitrum and optimism the block.timestamp value matches the L1 timestmap of the current block (probably with some lag), which means multiple ""blocks"" (each block is really just 1 tx) can have the same timstamp Well, that's basically the same UX on an L1 as also in this case the block.timestamp would be monotonic but here https://t.me/foundry_support/15287 the thinking is they are not monotonic Can anybody here who is also in the Optimism Support TG Chan (I am not in it) ask Optimism Devs if that's the case? I think it is the fastest way to solve this Is there a way to set gas price? I saw a way to set basefee, but I want to experiment with gasprice of a transaction Specifically tx.gasprice sorry what are you trying to solve? on L1, every block must have a higher timestamp than the previous block. on optimism/arbitrum there isn't a real concecpt of blocks, and multiple txs can have the same timestamp.",336
835,foundry-support.txt,"this means some ""blocks"" (transactions) can have the same timestamp, but it will never decrease forge run/script using -vvvv more equals more verbose really useful to debug ! Well, I am trying to understand if block.timestamp are on Optimism are actually monotonic You are saying ""yes"" because the fact no new ""block"" has a timestamp lesser than all the previous ones is the definition of monotonic Here https://t.me/foundry_support/15287 this dev said he does not think so and actually I have observed an issue in forking Perp Protocol on Optimism locally that is compatible with what he is saying, details here https://t.me/foundry_support/15272 perhps you are running into a similar issue to what's described here? https://github.com/foundry-rs/foundry/issues/748 For the deploy functionality, is it possible to wait x block confirmation before you put the next transaction in the same function? sounds like you can use vm.roll to wait for blocks: https://t.me/foundry_support/14168 but muh EVM equivalence i am no dev ser i am kebob *kebab you just answered your own question; whether or not monotonically its increasing is irrelevant because your contract has arbitrum semantics and your forking it onto in optimism. Arbtirum and optimism are different. you cant expect correct results hi everyone, I am installing foundry on windows, but facing some issues, Anyone have experienced it hope kind help. what issues? 🙂 Will post cmd screenshot, just sec fellas.",323
836,foundry-support.txt,"could you take look at above screenshots? try upping your memory I think 16GB is not sufficient? hmm should be hey y'all, what is the universal name in development that you guys use when referring to ERC1155s and ERC721s as a group? NFT doesn't seem applicable because ERC1155s are semi fungible, and asset doesn't seem applicable because that also encompasses ERC20s I am forking Optimism locally and interacting with Perp Protocol deployed on it, why do you mention Arbitrum? is there a guide on how to make tests faster? hello, more of a vscode question, how do i remove the import warning? i set everything in remappings.txt and compile etc works, just the import error bugs me a bit afaik expectRevert doesnt work with 8.8 primitive typecasting? Hi, Evergreen! I've ran into the same issue the first time I installed Foundry One simple fix is: install wsl, it's a way for windows to run Linux commands +1 same question This way you can run the Linux command to download Foundry, which usually doesn't show any problems If you don't wanna install wsl, wait a second, I'm gonna try to find the solution I've used to fix the problem Here Can you follow this message @yuta901 ? this kind of problems are caused by your vscode extensions might wanna use a new extension in this case using the juan blanco one which feels pretty standard followed instructions here: https://book.getfoundry.sh/config/vscode.html have you tried the new hardhat one? Also tried doing this in settings.json  ""solidity.remappings"": [""forge-std/=lib/forge-std/src/"", ""@openzeppelin/=lib/openzeppelin-contracts/""] But the list is basically 1) Make sure to have rust installed 2) Msvc build tools installed https://docs.microsoft.com/en-us/windows/dev-environment/rust/setup#install-visual-studio-recommended-or-the-microsoft-c-build-tools 3) Try the following command: rustup set default-host x86_64-pc-windows-msvc 4) Try the following command: rustup default stable-x86_64-pc-windows-msvc no does that work for you? saw in another thread in here someone recommended not to use the hardhat one I'm surprised the extensions for solidity aren't nearly as sophisticated tbh.",497
837,foundry-support.txt,"This is for @yuta901 's problem doesn't even have a refactor or rename variables functionality well I've heard it was crappy but that was like 6 months ago dunno if things have changed ngl ever since I've started using forge, never again went back to hardhat the speed difference is just too insane This 'ring' issue seems common for windows users, it happened to me and also for Evergreen, but it's pretty possible it has happened to many other users. What do you think it's the best approach to solve this problem @gakonst @onbjerg ? Should we change something on Foundry's code or is it better to document the possible solutions on a Foundry Book's section? I'm able to do the second solution and submit a PR, but as I don't know Rust (yet), I can't help with the first option If we opt for the first solution, I can at least open an issue lmao For anyone that still sees VSCode import errors after following instructions on Foundry Book, I created a Github issue here. Feel free to follow or +1 https://github.com/foundry-rs/foundry/issues/2019 First time running into this issue, any recommendations? Getting hidapi error: hid_error is not implemented yet when trying to use Ledger on WSL Ubuntu Hi, how do you guys usually deal with ""CompilerError: Stack too deep, try removing local variables."", well other than removing local variables? When writing a unit test, I want it to be readable so I would like to use many variables Tried supplying mnemonic indexes also. Still the same error.",333
838,foundry-support.txt,"because the contract BlockContext specifically mentions arbitrum this is where the timestamp is inherited from https://github.com/perpetual-protocol/perp-curie-contract/blob/13e28b3286c2fddff5421564168929891a9d73fd/contracts/base/BlockContext.sol#L6 Let's move to a github issue explaining the context and the possible solutions? Great! I'm gonna do it today Hi there Need help for contracts that are externally imported outside the source folder to be read while debugging in test currently I cannot debug due to the following error : panicked at 'byte index 3627 is out of bounds of `// SPDX-License-Identifier: MIT OR Apache-2.0 pragma solidity >=0.6.11; // ============ External Imports ============ import {Home} from ""../../nomad-core/contracts/Home.sol""; import {XAppConnectionManager} from ""../../nomad-core/contracts/XAppConnectionM`[...]', library/core/src/str/mod.rs:107:9 Aborted (core dumped) Can you open an issue with a repro? sure ser 🙌 When a test passes, is it possible to still display the console2 logs? -vvv I'm getting traces, but not the log for each fuzz amount You can not import external of the git repo ur in unless this has changed recently Done! By external I meant, out the src folder mentioned in the foundry.toml But the contracts are in the same repo https://github.com/code-423n4/2022-06-connext.git https://github.com/foundry-rs/foundry/issues/2022 Has anyone had verification issues when using deploy scripts? In my case, deployed ~10 contracts and it only verified one before exiting with a success code. Hi, I'm trying to do some tests using expectRevertcon. I have custom errors in a library. Then I import them. import { Error } from ""../src/library/ErrorLibrary.sol""; Now in the tests it is giving me problems. vm.expectRevert(abi.encodeWithSelector(MyContract.MyError.selector, 1, 100)); TypeError: Member ""MyError"" not found or not visible after argument-dependent lookup in type.",456
839,foundry-support.txt,"How can I do these tests? can anvil listen on ipc instead of the network? i think i can just use the EthApi object in this case no ipc server yet but this could easily be added (at least on Unix) by creating a file and listening for new requests via tokio::UnixStream, iirc geth does it like this as well Yeah I think it would be pretty simple. I think I can make due without for now opening an issue for that I think someone should go kill this CI job cause it’s been running for more than 2 hours https://github.com/foundry-rs/foundry/runs/6950320447?check_suite_focus=true#logs Looks like all the x86_64 jobs are just draining CI Yep Something is flaky And we haven't figured out what 🥲 I'm a beginner in rust and would love to contribute, is there room for me in the foundry repo or is that generally too hard for a beginner? there's room, go through any of the issues and if some of them seem interesting to you feel free to open up a pr. we'll help you if you get stuck as well as long as there is a pr open :) some of them are also marked as good first issue or D-easy/D-chore, feel free to take those too should also note (if you didnt know) that you can open up a draft pr.",290
840,foundry-support.txt,"if you open one up it's a lot easier for us to help you through the process Oh yeah those D- are really handy, I'll go through the issues and let you know Thanks u got it - i haven't been super good about adding D- labels though so there are a lot of issues without them https://github.com/foundry-rs/foundry/issues/1962 This one looks interesting Doesn't seems too hard to parse files in rust, isn't it ? it depends on the work here: https://github.com/foundry-rs/foundry/pull/1576/files essentially we probably want to filter out contracts if they have functions starting with test, or they are in any of the folders marked as dependency folders (default lib, but it is configurable) for the first one it would probably need to happen where we walk the AST here: https://github.com/foundry-rs/foundry/pull/1576/files#diff-c9ef96ddeefcc5856a88e23592caeb1080515c5945d707c659ab33afeeac98a2 for the second one it would probably need to happen somewhere here using the config we're given: https://github.com/foundry-rs/foundry/pull/1576/files#diff-c15e2e99cfd989c1c953f9dfdb6e5eb41fea0c4277bf6f1fb1152ad418e74147 cast send —flashbots giving error to anyone else? code: -32601, message: ""The method eth_sendTransaction does not exist/is not available"" You gotta add a private key to your call why not just pipe using | nc localhost $PORT the anvil tests ? the musl Dockerfile doesnt build If you do lsusb do you see it on the list ? I have the impression you have to do some fancy things to get usb devices recognized on wsl Yeah it shows up on the lsusb.",413
841,foundry-support.txt,"I'm using usbipd to use it on WSL I have the same error on the normal Ubuntu, from a browser and ledger live signing works no one using yubikey? im using the most popular solidity one hey all, if I'm using cast send to call a function that takes a bytes array as an arg, but it's empty, is the right format """" or ""0x""? Might be the first what would be the easiest way to check (I'm happy to) - this is for a real tx guess I could fire up a fork, run cast, check effects Yep (only problem is that I'm walking someone else through this, might need to walk them through that too) –I’m not familiar with using foundry, could someone please lend me a hand? When I forge build/Forge test, I cannot continue because of errors This looks like a network connection error Is this apple m1? here is your answer @mattsse still an issue :/ Hey guys I imported openzeppelin...but foundry can't read it when I call forge build I'd like to run a test / script that reads from a stateful precompile on an alt L1. Is there a way to do this? Or, more generally, evaluate the next call using ""eth_call"" instead of going through revm? You likely need to add it to the remappings param in foundry.toml. There are a lot of threads in here you can find through searching. More info here: https://book.getfoundry.sh/projects/dependencies.html?highlight=remappings#remapping-dependencies I did so tho.. but it didn't work still...I will go through the thread and try it again In case it helps, here is what mine looks like: remappings = [ ""forge-std=lib/forge-std/src/"", ""@openzeppelin=protocol/node_modules/@openzeppelin/"", ""@rari-capital/solmate=protocol/node_modules/@rari-capital/solmate/"", ""hardhat=protocol/node_modules/hardhat/"", ] Foundry pros: how confident can I be in forge's gas reports? I'm seeing strange outputs. ex: One test is 10-12m gas, while another that calls the same function being tested in the first test is only reporting 1.6m gas.",478
842,foundry-support.txt,"The first test has a lot of set up involved...does that get included in the gas report? hey! Hi, stox! Welcome 😁 Hello there, i never encoutered this error in past. Cast call works but call send doesn't works with this message if anyone has an idea im stuck.... the cast send is a normal cast send with the -private-key and the —rpc-url args. Thanks for helping me!! anyone here uses VS code? is there an extension that supports syntax errors? i installed solidity extension by Juan Blanco but it doesnt show anything for syntax error yes sam,is m1 It feels a little strange, I tried different VPN or disconnected VPN, still not solved. Then the error message is changed to Figure 2 hello, is there better way to show this in readable string?  0: ProviderError(JsonRpcError(JsonRpcError { code: -32003, message: ""execution reverted: "", data: Some(String(""0x022c0d9f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002710000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb9226600000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000"")) })) I'm using anvil. If i run it on testnet I can see a meaningful fail message. nuke ur ~/.svm folder and update foundryup Foundry Support sometimes the solidity binary server has issues after vm.etch if i do address.code i am not seeing the code change ok，ty sam，i try it No, Sam,it doesn't work, still the tips: Failed to install Solc 0.8.15: Checksum Mismatch for version 0.8.15 Error: 0: Checksum mismatch for version 0.8.15 I would like to know how to operate the nuke ~/.",451
843,foundry-support.txt,"SVM you mentioned? anyone know why ? it means doesn't support the solidity version ? update foundry? foundryup i will try it How do you generate the abi with foundry forge build Equivalent to hardhat compile rm -rf ~/.svm remove folder recursive forge install means install dependencies in remapping ? Hi guys. Having this error on deploy, and doesn't seem related with my rpc Error:  0: ProviderError(JsonRpcError(JsonRpcError { code: -32000, message: ""transaction underpriced"", data: None })) Location: cli/src/cmd/forge/script/broadcast.rs:137 This happens when you already have a tx with that nonce on the mempool. Did you call script --broadcast twice, after the first time gave you an error (and asked you to resume)? Not really. It gave error already first time did you figure it out? yea, enable forge ffi I'm running this already: FOUNDRY_PROFILE=local-ffi forge test I am trying to test some vars that are meant to be mesage .sender. I remeber there is a quirk with using doing this on Foundry , but I can't seem to remember / find it.",247
844,foundry-support.txt,"w create2 I don't think i can do that // Sets an address' code, (who, newCode) function etch(address, bytes calldata) external; i think i might be able to do it w this black magic is the the address an EOA or a contract? If it is a contract and you have code you can just redeploy it. ah havent touched that necromancy yet Vm.etch https://book.getfoundry.sh/cheatcodes/ anyone know what the reason for this error could be? i still get checksum mismatch for 0.8.15 solidity even after nuking .svm folder are you on M1? yea I am having an issue using console(2) even though I have imported it. I get this error : Member ""log"" not found or not visible after argument-dependent lookup in type(library console). what's shasum -a 256 ~/.svm/0.8.15/solc-0.8.15? hmm after nuking svm folder it remains empty, even after attemping to run forge b again and getting same checksum error seems it doesnt download this time confirmed, if i build with 0.8.13 it downloads and is fine but if i try 0.8.15 its checksum fail and nothing ends up in the .svm folder (other than 0.8.13) oh I think I've found the issue lol working on a fix rn thx 🙏 @rohitnarurkar just opened https://github.com/roynalnaruto/svm-rs/pull/45 https://github.com/roynalnaruto/solc-builds/pull/2 which led to this issue adding another test rn so we don't run into this again lol Guys sorry if this is covered but I'm a bit lost reading all the docs.",387
845,foundry-support.txt,"If I want to run complex tests using multiple different contracts, am I expected to deploy every contract or can I mock them ? I couldnt find anything about mocking or stubbing in the docs there is mock support: https://book.getfoundry.sh/cheatcodes/mock-call.html?highlight=mock#description but for complex scenarios, it's sometimes easier to create your own mock version of contracts that are not being tested, implementing the same interface you need I guess I didnt look hard enough, thanks probably you didn't notice, but there's a search button right at the top, and it's pretty powerful here :) Ah yeah, I see it now. Thanks 🙂 add local-ffi in all profiles in foundry.toml, that worked for me, one of the test file in opensea repo creates json pre-compile files Thanks @mattsse so I missed adding the v0.8.15 tag to the releases list 😕 Apologies for that 🙏 Any idea when the paradim ctf 2022 starts? I've re-run the build for the test where it checks whether the latest version can be downloaded.",232
846,foundry-support.txt,"Will merge once passes thanks, works now Although we will also need to update the commit for solc-builds to 7c716cc2f619fee991723c7341d97f58413ab953 @mattsse could you push that? I don't think I can push to your fork bulds or svm-rs? sry can't follow https://github.com/mattsse/svm-rs/blob/matt/add-apple-silicon-download-test/src/releases.rs#L37-L41 should be: static MACOS_AARCH64_URL_PREFIX: &str =  ""https://github.com/roynalnaruto/solc-builds/raw/7c716cc2f619fee991723c7341d97f58413ab953/macosx/aarch64""; static MACOS_AARCH64_RELEASES_URL: &str =  ""https://github.com/roynalnaruto/solc-builds/raw/7c716cc2f619fee991723c7341d97f58413ab953/macosx/aarch64/list.json""; because the solc-builds latest commit was updated after merging your PR ah gotcha then the PR's build on svm-rs should pass pushed, test should pass, ty gm @mattsse https://github.com/gakonst/ethers-rs/pull/1395 I'm quite confused about this behaviour. Why would a test pass if the assertion is false? 🤔 Logs: Error: a == b not satisfied [uint] Expected: 0 Actual: 10 Test result: ok. 1 passed; 0 failed; finished in 2.44ms just found this in docs .. interesting! ""Tests are written in Solidity. If the test function reverts, the test fails, otherwise it passes"" up, is there a way to prevent it from stop the test if I catch the revert? Is there a way to make forge ignore it and re-enable it only when needed? why dont you just comment the failing test out? what the use case? I'm trying to debug a test that relies on rinkeby fork and an ffi command. Running it with: forge debug --ffi --fork-url $ETH_RINKEBY_URL --fork-block-number $ETH_BLOCK_NUMBER --target-contract MyContract but I get an error: The application panicked (crashed).",493
847,foundry-support.txt,"Message: couldn't deploy: Execution { reverted: true, reason: ""FFI disabled: run again with `--ffi` if you want to allow tests to call external scripts"" I made an update to my contract, but my test seems to be running in the context of the contract before I made the update. Anyone know why this is happening? i tried forge clean and it didn't work ^^ forge script ./deploy/_03_CoinFlip_Deploy.sol \ --sig ""deploy()"" \ --sender 0xcbf7E34086C878B9755b08810b4748a3991A6f53 \ --rpc-url <<URL>> \ --chain-id 4 \ -i 1 --broadcast --resume --slow -vvvv is giving me this error You seem to be using Foundry's default sender. Be sure to set your own --sender.  No associated wallet for addresses: {0x00a329c0648769a73afac7f9381e08fb43dbea72}. Unlocked wallets: [0xcbf7e34086c878b9755b08810b4748a3991a6f53] Maybe the sender arg not being recognized in the script command? Is it possible to console.log in a solidity test? yes https://github.com/foundry-rs/forge-std#consolelog Looks like you need the verbose flag in order to see console2.logs? forge test -vvv no clue its not importing for me can anyone please help with this ? https://t.me/foundry_support/15533 Have a code snippet? uint256[] memory regions = new uint256[](3);   console2.log(regions); is this in a test? Have you tried using it indirectly through import ""forge-std/Test.sol""; I'm using console2 right out of the box practically, but I'm not importing it directly.",394
848,foundry-support.txt,"I'm getting it from the Test.sol import Yes I have : Here is a gist the covers the troubled code: https://gist.github.com/Genysys/bf0ac03d5e2c2e5a4eb02d8e36ca401c do you need import ""ds-test/test.sol"";? Not sure if ds-test has a console module in it or not, but it sounds like you're importing a second console module from somewhere and solidity is confused about which to use no I dont tbh but taking it out doesnt fix/ explain why I cant import console. if i follow the intellisense path , console is downloaded by way of import ""forge-std/Test.sol""; any ETA on next nightly? Really wanna try out the fix that closed #1920. https://github.com/foundry-rs/foundry/issues/1920 Ah, it's because console doesn't know how to turn a uint256[] into a string try logging them individually like console.log(regions[0]) Thanks ! it works. weird error now let me now if that prank() call is working for you, cause I can't seem to get mine to work 😡 it does happy to dm so we dont clogg the chat up Could be useful for others though! I always do a quick search to see if anyone has asked my question before Thats how I learned about -vvv to see your console.logs in tests ah no worries 🙂 Lol omg nvm. My test fails regardless of prank() 🤦‍♂️ This might be more of a feature request, but is it possible to organize the out directory to be less flat? I am generating typechain types from the output and I am ignoring test files but there’s a bunch of transitive test dependencies that are still being built by typechain. Feels like it would be easier to tell typechain “build only out/src and its dependencies” vs. having to maintain a specific list of files to build types for (or exclude) the usecase is that I needed to loop a try/catch to get the correct value to use for a test 😄 hi,how unstall foundry on windows? anyone else currently having problem with GitHub actions? also dependabot fails cloudflare as well having issues https://twitter.com/Cloudflare/status/1539140097374793728 I assume that's the issue I am running a forge script.",498
849,foundry-support.txt,"there are 2 gas used numbers. why are they different and what are they representing? I deleted the broadcast folder and when I issue a new script command it is telling me Error:  0: No such file or directory (os error 2) added a change so we only show 1 in the future, since yeah it can be confusing with both. in any case, the first one is the gas estimation of the run() method. (which includes non broadcasted calls) the second one is the sum of all broadcastable transactions including their stipend. Also, for arbitrum, we actually call eth_estimateGas to be closer to the real deal, since we don't have local metering for it. can you show the rest of the error ? there should be a file location or smth. Did you call with --resume? Location: cli/src/cmd/forge/script/sequence.rs:71 Yes the call was with --resume This was the command so two different issues yup 😅 struggling a bit with the script command --resume requires the script to have been called by --broadcast first (which creates a file on the broadcast folder). so if you delete the folder, then he cannot find it at all this one seems a bit trickier. i can see this happening if: * you called the script first with a RPC but no --sender flag (and maybe without even a --broadcast flag). * you then called it again with --resume and --sender flag. did something of the sort happen? --resume just calls the transactions as they are in the broadcast folder. it won't replace any --sender in the existing transactions The first point happened. My issue is that i need to simulate the transactions across multiple blocks which I can't figure out how to do when simulating with rpc This is when im tryna deploy yeah so, if you're calling --resume, you have to make sure that the simulation (calling with RPC) and/or broadcast are using the proper --sender roll into the ""future"" is currently not supported on forge script --rpc. there's an issue about it: https://github.com/foundry-rs/foundry/issues/1902 if you dont necessarily require to roll inside your script, and only need the transactions to be in different blocks, you can call --broadcast --slow A ok.",474
850,foundry-support.txt,"Was gonna suggest me doing it but its marked as hard 🥲 just give it a go! might not be hard i was thinking of checking if it's a fork backend and we're rolling into the future, then just roll locally, without making the RPC request what's a stipend? Is there a way to skip the simulation with the rpc and just broadcast the txes? Cause its failing due to not different blocks Hi everyone! I want to deploy a contract on an anvil mainnet fork. I want to use script and --broadcast to deploy it, but I also need to impresonate an existing admin contract. Can I unlock the address in anvil somehow? Hi , I am trying to use foundry, by docker I have run `docker pull ghcr.io/foundry-rs/foundry:latest ` But, when I try to enter the the container, it always alarm , /bin/sh: -c requires an argument Anybody can help, how to enter the container have a look at the docker section of the book https://book.getfoundry.sh/tutorials/foundry-docker.html but try run -it ... /bin/sh Thanks, reading it. What the $RPC_URL is Per the doc, I think it should be one pre-defined variable https://book.getfoundry.sh/tutorials/foundry-docker.html For the rest of this tutorial, it is assumed that the RPC endpoint of your ethereum node is set like this: export RPC_URL=<YOUR_RPC_URL> But, what this varible will look like? And, I have read the link of https://ethereum.org/en/developers/docs/nodes-and-clients/nodes-as-a-service/ Also, I have one account in infura.io But, still have no any idea, what the variable looks like Something like https://mainnet.infura.io/v3/API_KEY Thanks, I am using https://rpc.ankr.com/eth Then, what this error means, error: Found argument 'latest' which wasn't expected, or isn't valid in this context I'm not too familiar with Docker.",428
851,foundry-support.txt,"Is latest meant for Docker? If so, shouldn't it be outside quotes? https://book.getfoundry.sh/reference/cast/cast-block.html Shouldn't it be ""cast block —rpc-url $RPC_URL —block latest""? Yes, you are right, Doc is wrong I mean the doc of But that's exactly what the documentation says, right? https://book.getfoundry.sh/tutorials/foundry-docker.html No. Aah I see One question regarding deployCode cheat code: if I have a script which uses version 0.8.0 and inside the script i deploy (with deployCode) a contract with 0.7.5, the deployCode will get artifact from the artifacts directory. But when building, what happens if the script has been built before the other contracts that needs to deploy? would it take then an old artifact version?? Thx! dont know if the question was clear enough sorry :) thanks for reporting, that's indeed an issue Hi everyone. I'm facing some problems when it comes to verifying a contract on etherscan through forge script as shown below forge script script/MockDeploy.s.sol --rpc-url $RINKEBY_RPC_URL --private-key $PRIVATE_KEY --broadcast --verify --etherscan-api-key $ETHERSCAN_KEY -vvvv I'm facing a similar problem as someone above in the chat where i get the output below but the contract is not verified on etherscan ONCHAIN EXECUTION COMPLETE & SUCCESSFUL. Transaction receipts written to ""broadcast\\MockDeploy.s.sol\\4\\run-latest.json"" ## Start Contract Verification Transactions saved to: broadcast\MockDeploy.s.sol\4\run-latest.json I have tried to clearing my cache using forge cache clean and running the command again without the —broadcast flag but it doesn't seem to fix the problem. Manually verifying the contract through forge verify-contract works though. Any ideas on how to fix the problem? Anybody know how to utilize below link of 'Source Code' https://github.com/dmfxyz/foundry-docker-tutorial what does this mean? could not calculate block delta thanks for reply And I think, there should be some issue with docker image of foundry, coz there is no way to enter it.",459
852,foundry-support.txt,"docker run -it ghcr.io/foundry-rs/foundry /bin/sh that should work, no? Hello there, Any one know the starting date of the paradigm ctf this year? are there ways to send a warning in Foundry tests? hi i think block base fee isn't working i set it to that and use 50 and im getting this error {'jsonrpc': '2.0', 'id': 1, 'error': {'code': -32003, 'message': 'max fee per gas less than block base fee'}} Is it possible to have ""case send contract "" take struct array as method parameter? for example: slctedItems=[{name:""item1"", qty:2},{name:""item2"", qty:3}] cast send $pool ""testStructArray(Item[])"" $slctedItems This gives me error: 0: Illegal abi `testStructArray(Item[])` In the contract I have the code like this: Item[] public items; function testStructArray(Item[] memory _items) public returns(Item[] memory) {  //code  items = _items;  return items; } hmm I think only way rn would be via console.log and color escape coded message I think checking Having a hard time getting the debugger to work for any of my tests. Anyone recognize what's going on here? EDIT: disregard - worked when I tried in a new terminal How we can use more than 1 EOA in script. I am using 2 EOA in script and provided two PRIVATE KEYS associated with those account in script CLI like, forge script script/Token.s.sol:ContractScript --rpc-url $RPC_URL --private-keys $PRIVATE_KEY_1 $PRIVATE_KEY_2 --broadcast -vvvv Its failing with error: Error:  0: No associated wallet for addresses: {EOA2}. Unlocked wallets: [EOA1] Location:  cli/src/opts/multi_wallet.rs:230 can't reproduce this, can you please open an issue with anvil command and the transaction type and gas params? Is it possible to exclude tests in a particular folder? yep, with the --no-match-path flag Interesting, Thanks Matt.",456
853,foundry-support.txt,"--private-keys $P1 --private-keys $P2 Its not working Is there a way to automatically decode signatures and calldata (like with 4byte-decode) in cast run? should be included in the next nightly is there a difference between cheats. vs vm. when calling cheats within a script or test? I don't think so, cheats were just the older way of doing it. gm, is it possible to deployCode by passing the bytecode directly? Or it should always fetch from artifacts dir? I'm in solidity version hell while dealing with Aave payloads. Atokens are at 0.6 while proposal payload at 0.8 I wanna test the aToken deployments + use them to test the payload proposal in a single test the best (really bad) way I found to solve this was using a tenderly fork and manually deploying the aTokens so I have an address to use in my proposal payload tests so deployCode will have to be how I dig myself out of this hole Is it already in master? If so I’ll just rebuild from source Yes it is btw, where did you see the use of ""cheats""? If it's in the book it probably should be updated. https://github.com/foundry-rs/forge-std/search?q=deployCode you can also look into vm.etch is there a convenient way of ignoring import ""hardhat/console.sol""; of an installed repo? nope ok will make a mock contract and remap thx it worked, thanks where the src code located in container? per the doc, You can see our code was compiled and tested entirely within the container. Also, since we passed the --watch option, the container will recompile the code whenever a change is detected. I want to find the code, make some change https://book.getfoundry.sh/tutorials/foundry-docker.html noticed same error. And what if I just have mnemonic rather than using private-key. Good day frens, I have been trying to install pancake swap BEP20 library but for some weird reasons it's not loading the file from github, please how can I solve this In the tutorial, the code is on your local machine and is mounted into the container. Just edit it normally like you would on your host. I cannot find the location, in container It’s mounted to the /app directory. But again you don’t need to edit it within the container.",495
854,foundry-support.txt,"you mean, the code has been mapped to local driver(volume), right but , I cannot find the app directory The command maps your current directory ($PWD) to the /app directory in the container this is more of a docker question than a foundry question. If you want to read some details on how it works see: https://docs.docker.com/storage/volumes/ Okay, but there is no app folder in the container, too. what exact command did you use to start the container in this example? Hey everyone, does anyone have an idea on how i can go about testing with an erc20 contract(deployed). I am trying to use the amount of the erc20 present in the address to do some testing, I want to be able to add and remove amounts of the token so i can use it to test. do you copy contract structs in the tests when you want to check some values from a function that returns an specific struct? or what's the best practices for that I'm deploying a low level evm contract via yul create. after doing that I get the correct address back but the code size is 0. I'm pretty sure I'm deploying the contract correctly do you know if this is a foundry limitation? code example: https://gist.github.com/StErMi/42e77f3d8b86a675bebaa7af3307eb39 can we using Ganache with anvil at same time? `$ docker run -it foundry /bin/sh` Hey guys, is it possible to use different compiler version with foundry? https://github.com/foundry-rs/foundry/pull/2070 this should solve it i think When testing, is there a way to capture data on emitted event? For example I call c.f() and it emitted SomeEvent(123). I want to capture 123 into a variable Need to mount the volume in the command -v $PWD:/app Anyone have a public Broadcast.t.sol example for forge script? I see it mentioned all throughout forge script docs Did a video on Foundry https://twitter.com/dabit3/status/1539642803852279809 Is there any way to not have to pass environment variables for every call? (i.e. --rpc-url $RINKEBY_RPC_URL or --private-key) Seems like foundry ignores environment variables.",483
855,foundry-support.txt,"Would be great if it could automagically read some .env (or pass that instead) niceeee every config options has a corresponding env var: https://book.getfoundry.sh/reference/config.html?highlight=config#environment-variables that is checked you can either init config values in your foundry.toml or if it's sensitive in an .env and do source .env once tried with rpc url and etherscan key and couldn't get it to work with 'sourcing' tried all possible variants (and those in the docs), can print them out correctly. Yeah, I could put them in the .toml, but would rather keep them in the .env. Also didn't see any possibility of adding the private key to an env going through solidity scripting docs for example solidity-scripting % forge script scripts/NFT.s.sol:MyScript --private-key $PRIVATE_KEY [⠢] Compiling... Nothing to compile Script ran successfully. Gas used: 983611 If you wish to simulate on-chain transactions pass a RPC URL. I guess it's just always required? RPC and private key are always required etherscan key no so then there's no point in the environment variable FOUNDRY_ETH_RPC_URL? I also didn't get --verify to work without explicitly passing the etherscan key Any idea why i got a revert when im deploying this constructor? When im only using the log_msg_value event it works i saw the msg.value inside the constructor But no idea why i got this weird revert.. the require statement enforces you to send at least 1050 ether for the deploy transaction, no? Can we run some code which will bruteforce something with infinite gas for testing purpose? Right now program is failing with OutOfGas if you just call forge script --help and look for the etherscan key...",370
856,foundry-support.txt,"do you see it filled ? did you pass the —value VALUE ? Yep sure forgot to specify ^^ so, no, it doesn't show up Hey, I'm curious if there's a good way to test multiple parameters being passed into the constructor of a contract? Right now, I'm just deploying every valid permutation at the start and then looping through each contract in each test, but it feels a bit dirty you can write a test to check the iniitialization varibales after? i..e  function testInitialization() public {  assertEq(construtctor_arg, contract.constructor_arg());  } Sorry, I don't think I was clear I'm working on a contract that can be initialized with different tokens, such as DAI, USDC, etc. These are passed into the constructor I want to test each possible contract maybe an if in your test might help What I'm doing right now is this – creating an array of assetFixtures and looping through each of them in the test The problem with this is it's a lot of code repitition theres no dataProvider for data driven tests or decorator if thats what you are looking for ive been facing same issues. a dataProvider would be a great addition to the functionalities 😅 https://github.com/storming0x/foundry-yearnV2-gen-lev-lending/blob/21231f86c45ad8e31e64be1b9fc318d2561d7168/src/test/utils/StrategyFixture.sol#L223 some examples of handling these cases are here, but not sure if there's a less verbose way.",329
857,foundry-support.txt,"Now i finally have an excuse to dig into it 🙂 Thanks! I am having trouble deploying my contract on the Arbitrum RInkeby testnet. I am running the standard forge script command with --rpc-url $INFURA_ARBITRUM_RINKEBY_RPC_URL and I keep getting an error about forking? All my variables are in a .env file and I am running ""source .env"" before trying to deploy asking for ""fork-url"" have you tried echoing the env variables to be sure they are available? Thank you! So I feel like a bone head but the issue was I had spaces between the equal signs in my .env variables so I needed to change RPC_URL = ""https:// ...."" to RPC_URL=""htttps://"" nader to the rescue 😌 btw I am watching your video right now! Just got hired at as a Web3 engineer and the company are switching from Hardhat to Foundry so I am trying to learn up! couldnt have been more perfect timing for a release! 😄 has anyone seen this issue when deploying? failed to read from ""broadcast/deployMinter.sol/5/run-latest.json"": No such file or directory (os error 2) that's awesome, glad you figured it out! Hi, regarding foundry scripting. If I run a script and get the following log: Simulated On-chain Traces:, does that mean the script is run on a fork/simulation? I am using the following command: forge script --rpc-url https://rinkeby.arbitrum.io/rpc \ scripts/Stargate.s.sol:StargateScriptArbitrum \ --private-key ${PRIVATE_KEY} \ --broadcast \ -vvvv But it does not look like some of my transactions are making it to the arbitrum testnet - wondering if anyone knows why? Turns out trying to stage multiple broadcasts was the issue what do you mean? Some of my later broadcasts reverted because of the earlier ones not having been actually processed.",408
858,foundry-support.txt,"Example: Broadcast 2 is conditional on Broadcast 1 (erc20 approve required for transfer) It looks like I needed to first process Broadcast 1, and actually send the Tx to the network Then Broadcast 2 could go through It looks like foundry (helpfully) reverts the TX if the simulation suggests it will not succeed I need to investigate more how to chain transactions in a single script are you sure your forge is up to date? that was happening on arbitrum (only), but should have been fixed 1 or 2 nightlies ago Getting a strange bug. Running a test and one of the contracts I instantiate in setup ends up having the same address as a real EOA on the chain I'm forking. Has anyone else experienced this? Possibly not, I built it from an AUR package is there a forge build option to compile all the contracts except some specific ones? Yeah I had to fork with mnemonics I created anvi -m <mnemonics> -f <fork-url> whats the best way of checking a storage slot is unitialized? If the value is default I guess doesn’t work, forge complains the slot is not found When I run forge snapshot regularly it will work fine. However, when I add the --fork-url arg with a mainnet rpc, it ""hangs"" after a few tests and the command never finishes or terminates. Has anyone else encountered this? can you try reproducing this with RUST_LOG=ethers=trace set? perhaps this is some ratelimit issue, if you don't need the latest state then I'd recommend setting a specific block, because we cache rpc storage on a per block basis while this is possible, until yesterday we used random addresses when deploying test contracts, not sure how likely that this address already exists lol, makes we wonder if there's something else going on however, with next nightly the test contracts will be deployed with a constant address Same behavior (it still hangs) except I can see the traces. can you dump them in an issue? The traces? They appear too long for that. I guess I can maybe provide a snippet.",435
859,foundry-support.txt,"worth noting though that if there's fuzz runs (which there may not be for snapshots) you don't get much benefit from caching since the fuzzer generates different values each time so your RPC kinda gets hammered when fuzzing with a fork URL, until there's deterministic fuzzing could also paste them in a gist and link to the gist An issue should probably suffice or pipe them to a file and attach to the issue https://github.com/foundry-rs/foundry/issues/2094 is there anyway to pass an environment variable to a forge test contract? like some config i can specify on the command line when running the test, and then have the setup respond to it check the envXYZ cheatcodes https://book.getfoundry.sh/cheatcodes/#cheatcodes-interface awesome thank you 🙏 That's a nice feature, are those actually env variables stored in the system or just locally in foundry ? Hey guys, wondering if i have something in my config set up wrong or if i am using the forge wrong. I am trying to debug a function that makes multiple external calls. The debug says no src map index, any ways to get around this? I lost my way, after docker started, correctly... what's next step, Hello... When i try to use source .env it's not work for me (vs code Windows) then when i deploy the script i have an error! An help? is it possible to drop all pending transactions from anvil mempool without passing them? I used 'docker run -v $PWD:/app -it foundry /bin/sh ' to enter the container But, after exit from container, and enter again, everything has lost I mean, the vim, git , these tool, I ever installed, lost Looks, I have used the -v to solid the container Minutes before, I have installed the vim whats the rust crate for cast? also, I cannot find the volume, per docker volume ls you can pass that as an argument when you docker run -b foundry:/opt/usr/home etc etc Docker volumes are independent of the container thats why they show up as a separate instance when you do docker ls -all yea you should create a volume on your local machine and mount that way you can keep ur workspace independent of the container runtime I'm pretty sure that with the nightly build (updated this morning) the --debug function is not working anymore.",489
860,foundry-support.txt,"In the Contract call tab now I see only Unknown contract at address 0x....... been running into this problem on Github actions, would love some help tests pass on local machine has anyone incorporated Git actions with tests that run with the —ffi flag? My tets pass locally but on Git action it keeps saying SetUp failed, and I suspect its an issue with — ffi in that environment Repo? @sambacha fixed the one you replied on, now this one - run: ${{ github.action_path }}/forge test —whateverflags github action configures the working directory like this: git config --global --add safe.directory /github/workspace if you are unsure about your action configuration file, you can use this to check it: https://rhysd.github.io/actionlint/ Is there a way to specify network configuration for deployment through forge (rpc, priv_key), similar to hardhat.config? Hey guys Has anyone gotten this error I don't understand.. I copied and pasted my private key as required Hello! Could someone tell me how is the value of priority fee decided when using cast send ? Currently, it exposes only --gas-price which is supposed to be equivalent to the max fee per gas for EIP1559 transactions. u sure this was a windows issue, should have been fixed here https://github.com/foundry-rs/foundry/pull/2099 Hello I have an issue when I run the forge build —sizes command it reads the deploy script as well and the size of the script is <24kb How can I ignore the deploy.s.sol so it doesn't give me this error anymore as the deploy script will not be deployed with the contract Thanks! I have an small list over here, still need to add more projects https://github.com/crisgarner/awesome-foundry by far one of the best resources on foundry Has anyone else encountered forge verify-contract to return an OK status but the contract not being verified on the block explorer? It occured to me once on the kovan testnet Super nice and thanks for the feature! Hey there! I couldn't find it in the docs, but is there a way through forge to deploy via CREATE 2? It would just be super nice for my workflow (ie. to setup a proxy) just create a contract with a simple function Maybe i'm misunderstanding! How would you use the forge cli to use that to deploy? You can create a script that: 1.",497
861,foundry-support.txt,"deploys the contract with this create2 function 2. calls the create2 function to deploy new contract You can do this with forge script Perfect!! Thank you 😄 Is there a way to get forge to only print console.log, but not any of forge's logs? Or alternatively, make the console.logs print after forge's? I can't debug something because the fuzz test I'm running breaks with a high value, and forge's logs fill up my terminal with unhelpful info. Reducing verbosity silences my console.log. 🤔 Hey, I'm moving from Hardhat to Foundry after some headaches with HH, pretty dope so far! I have question: Is there a way to travel to a blockNumber during a test? I tried to call the vm.roll() function to set the blockNumber but it's not what I want, I want to do something like —fork-url and --fork-block-number but inside the test. I've found my answer here https://t.me/foundry_support/11063 there'll be more cheatcodes soon that allow you to fork/change fork on the fly Thanks. Awesome job.",231
862,foundry-support.txt,"https://github.com/foundry-rs/foundry/issues/939 How to solve ""unknown contract at 0x<address> "" issue while debugging??? getting this bug when doing a cast run <tx-hash> --rpc-url=<rpc> same command worked before i did a foundryup Is this on current nightly? cast 0.2.0 (d89f6af 2022-06-24T00:13:35.614846Z) forge 0.2.0 (d89f6af 2022-06-24T00:13:35.614846Z) What provider? anvil anvil 0.1.0 (d89f6af 2022-06-24T00:13:35.69103Z) which anvil && which cast && which forge /Users/nuhhtyy/.foundry/bin/anvil /Users/nuhhtyy/.foundry/bin/cast /Users/nuhhtyy/.foundry/bin/forge thanks this does not make any sense because nonce should be returned like ""nonce"": ""0x0000000000000000"", 🤔 Can you please open an issue with how you started anvil and cast run command? sure gotchu will also try to recreate on another machine Ok I was able to recreate Ok i fixed it lmao I didnt restart anvil after the foundryup thx 😄 receive/fallback function always revert I forked from mainnet, and when the contract received transfer, it always revert, even for some simple code like below. Error: Transaction reverted and Hardhat couldn't infer the reason.",343
863,foundry-support.txt,"https://github.com/foundry-rs/foundry/issues/2116 anvil randomly exited with this error: thread 'tokio-runtime-worker' panicked at 'index out of bounds: the len is 2 but the index is 2', anvil/src/eth/backend/mem/mod.rs:1173:27 note: run with RUST_BACKTRACE=1 environment variable to display a backtrace Took a bunch of the commands and apis that I was using the most and complied them into a repo, then decided to make it more of a resource for other people since I was finding it useful as well and it was already open source https://github.com/dabit3/foundry-cheatsheet prs and feedback welcome would also be happy to transfer this to the foundry github org how do we test specific method call and not all calls in the test sol file? Oooo welcome @big_tech_sux wen vyper support ser 👋 Yes, wen!! Don't think anything is needed on our end actually? Lmk if there is tho i am just humble kebab ser over my pay grade yes hi guys are there any guides on foundry anvil id like to trace a mempool transaction on latest block https://book.getfoundry.sh/reference/anvil/ The txpool RPC methods may be of help https://github.com/0xKitsune/Foundry-Vyper Thought this was a sick repo so have are there plans to support inheritance? it’s used pretty heavily for testing, not sure what vyper support would look like without it Can I use external dependencies in contracts, such as @uniswap (that offer an npm package) without having to restructure my project following hardhat? It's possible to just forge install <org name>/<repo name> and then set up a remapping (via either the toml config or remappings.txt ). If it's uniswap v2 core for example, you can do forge install Uniswap/v2-core and then add something like uniswap-v2-core/=lib/v2-core/contracts/ to your remappings Extremely cool, thanks! Hi, how do I expect revert but I don't care what the message is? (can be """", can be any other string) Foundry has a but,if you selfdestrut a contract and use create2 deploy at same address will make error we're implementing a module system, but it won't have inheritance.",500
864,foundry-support.txt,"i think it might still be able to support foundry scripting, but maybe some details need to be thought through — do you want to chat about this offline? don't want to hijack this group chat Hi all, when I build on Windows, I'm getting Error[2333] Identifier already declared. GameManager.sol imports PlayerManager.sol and vice versa. However, when I build on Linux or MacOS, everything works fine. Pulling from same github repo, exact configs. on Linux VM. I primarily use Windows to develop, so I'd like to avoid using a VM to build my smart contracts after every change I've tried adding 2333 to ignored_error_codes in foundry.toml to no avail Ya you cannot ignore a compiler error 😅 This is a solidity issue you're having. You're importing the same file more than once across all your paths Per the error Hey All! How can I show logs in a run despite the run having errors? @gakonts Msging me from this chat ^ I have issue about forge command Os doesnot recognize forge commands Is it standard practice in Foundry to commit or gitignore the lib directory? Commit @gakonst you have an imposter ser, this bot is phishing users st > ts Is there a way to detect if a contract has already been deployed using forge scripts? E.g. if the exact contract has been deployed I would like to skip the deployment like hardhat-deploy does maybe this isn't possible, but can I test private functions in foundry somehow? why is it private instead of internal? if you make it internal you can inherit the contract in a test contract and test it that way is it possible simulate 2 eth_calls in an order without having to send transactions ? ah yeah I guess that works internal + inherit is a common pattern used and private for the most part is useless restriction anyway (not always but generally) you may be looking for cast call? or do you mean inside forge? im using anvil, i guess its not possible since eth_call does not modify the state eth_call doesn’t modify state, what is your end goal? to set storage and keeping the nonce of the sending account at 0 or something? so it's common to have like Contract.sol and ContractTest.t.sol where ContractTest inherits Contract? That's nice ig since you get access to all the internal funcs, structs, events etc.",488
865,foundry-support.txt,"Have mostly seen that people instantiate the Contract in the setUp function and then play with it that way. Is it recommended to do a combo (inherit for being able to call internal fns etc, while also creating an instance of the contract in the setUp), or just inherit Contract and use it that way for everything? im trying get a revert status of a 2nd transaction that happened in same block of 1st transaction using eth_call Has anyone migrated the Optimism bedrock contracts to use Foundry and not Hardhat? Or is there a general guide to do this? My naive ""migrate hardhat to foundry"" google search didn't return anything There is no address assertions in foundry ? As far as I can see it's only for bool, bytes, arrays of int and uint ? Oh my bad it's in the DSTest reference Hello again! I posted this question two days ago but didn't get a reply. I double checked the channel history and didnt find anything related. So here is another try 😅 Could someone tell me how is the value of priority fee decided when using cast send ? Currently, it exposes only --gas-price which is supposed to be equivalent to the max fee per gas for EIP1559 transactions. Digging through code it seems that the priority fee is set equal to the gas price but that would be a very high amount right? Maybe we dont have that option exposed Should be pretty easy to add! hey guys, im trying to do local testing but when i do forge script ... i run into ProviderError(JsonRpcError(JsonRpcError { code: -32003, message: ""Out of gas: required gas exceeds allowance: 0"", data: None })) can someone pls help me out? your account needs to have eth 🙂 thank you ser. i was doing forge script script/Contract.s.sol:ContractScript \ --fork-url http://localhost:8545 \ --private-key $ADMIN_KEY \ --broadcast and the ADMIN_KEY is the private key i got from forking the net after calling anvil -f $INFURA_URL and the CLI shows it has 1000 ETH.",433
866,foundry-support.txt,"am i doing sth wrong here? also, may i know is --sender the -u foundry equivalent of ganache-cli -f $INFURA_URL -u $PUBLIC_ADDRESS? if you echo $ADMIN_KEY from your terminal does the variable show up? ok thx, lemme try yea, it does show up.",68
867,foundry-support.txt,"im putting everything in a bash script and i did echo $PRIVATE_KEY before i ran forge script noticed that forge coverage is shipped ? shipped but not fully ready 🙂 how do i do cast call on a function that takes two variables? i did cast call ERC_20_ADDR balanceOf() SENDER and i see 26703374414135971229154 but when i call cast call ERC_20_ADDR ""transfer(address,uint256)(bool)"" RECIPIENT 6703374414135971229154 i get (code: 3, message: execution reverted: ERC20: transfer amount exceeds allowance, data: Some(String(""0x08c379a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000002845524332303a207472616e7366657220616d6f756e74206578636565647320616c6c6f77616e6365000000000000000000000000000000000000000000000000""))) does it mean i need to do sth to my RECIPIENT and 6703374414135971229154 like abi encode pack it? i did anvil -f --sender SENDER previously (which i assume i can control SENDER) you need to do cast call —from SENDER otherwise how will cast know which sender to use? Has anyone ran into this issue while running the verify script? Think it may have something to do with the versioning got it, thanks! 😅 Re: im trying to do local testing but when i do forge script script/Contract.s.sol:ContractScript \ --fork-url http://localhost:8545 \ --private-key $ADMIN_KEY \ --broadcast i run into ProviderError(JsonRpcError(JsonRpcError { code: -32003, message: ""Out of gas: required gas exceeds allowance: 0"", data: None })) i verified that when i do echo i see the admin key and the ADMIN_KEY is the private key i got from forking the net after calling anvil -f $INFURA_URL and the CLI shows it has 1000 ETH.",460
868,foundry-support.txt,"could it be because i forked arbitrum net and the while i try to deploy my contract from ADMIN_KEY, it has ETH on mainnet but not on arbitrum? if that's the case how do i send some arbitrum ETH to my ADMIN_KEY? Please open an issue with the steps to reproduce sent a PR to add --priority-gas-price https://github.com/foundry-rs/foundry/pull/2134 I guess not? if the address is deterministic you can try checking the codesize before deploying just set it to 1.5-2 api.txprice.com Quick Q In the documentation it says: ""If you deploy a contract within your test, then 0xb4c79daB8f259C7Aee6E5b2Aa729821864227e84 will be its deployer"" But in tests I see my deployer address is 0xce71065d4017f316ec606fe4422e11eb2c47c246 The address appears to be real on-chain, so I'm guessing it's a legit default address in Foundry (as people always accidentally send funds to default addresses) Another Q How can I use Foundy cast, or another tool to get the same effect as ethers-js ethers.utils.defaultAbiCoder.encode([""bytes""], [artifact.bytecode])? Essentially I'm trying to use Foundry cheat codes to compile Yul directly in the contract runtime, but I'm having trouble as Solc does not compile into an ABI friendly format For example this fails As the solc output is not ABI format I noticed the legacy Yul+ Foundry repo example uses the Javascript directive above to transform the solc output into a format Foundry can work with, I'd like to achive the same effect with a single command line so I can use a cheat code to compile and deploy my Yul in the middle of tests (sorry for all the newb questions, new to Foundry and trying to port over a bunch of Yul stuff) Missed the release of coverage 😅 am I correct to state that contracts that get inherited aren't covered in the coverage check? As in: contract ABC inherits contract A and B, but tests only run on instances of ABC. This yields 0% coverage for A and B.",472
869,foundry-support.txt,"perhaps use cast abi-encode ""f(bytes)"" BYTECODE to encode the final output? https://github.com/foundry-rs/foundry/issues/2137 I verified that running locally anvil --hardfork latest and anvil --fork-url https://mainnet.infura.io/v3/$APT_KEY worked. I tried to look at the repo but i've no idea what changes i should make. it'd be great if you could point me to the file and i'll try to submit a PR if i can figure out. Thanks! 🙂 This feels like it's really close to working, but the output is a few characters different to the correct bytecode from the working Javascript example That was using the command `cast abi-encode ""f(bytes)"" $(solc --yul yul/Example.yul --bin | tail -1)` as per your suggestion I can't test solidity ^0.5.0 version, how to solve this problem Is there a cheatcode for expecting the ERC-20 balance of an address to increase or decrease after running a test? I am trying to work with uniswap v2 contracts and their safemath library uses solc v0.6.6 , can I specifiy multiple solc versions in foundry?  0: Compiler run failed  error[5333]: ParserError: Source file requires different compiler version (current compiler is 0.8.10+commit.fc410830.Darwin.appleclang) - note that nightly builds are considered to be strictly less than the released version  --> lib/v2-periphery/contracts/libraries/SafeMath.sol:1:1:   |  1 | pragma solidity =0.6.6;   | ^^^^^^^^^^^^^^^^^^^^^^^ beforeBal = IERC20(token).balanceOf(address); func(); afterBal = IERC20(token).balanceOf(address); assertFalse(assertEq(beforeBal, afterBal)); does this not work? Yeah that's what I did, my question was whether there's any cheatcode in forge-std that can do this in fewer lines of code. E.g. ""vm.expectERC20Transfer(token, account, beforeBal, actualBal)"" got ZOE ERROR (from forge): zoeParseOptions: unknown option (--help) i installed foundry and run foundryup but still getting this error.",483
870,foundry-support.txt,"dont think so https://github.com/foundry-rs/forge-std/blob/master/src/Vm.sol there may be another program named forge in you PATH you can run which forge to check yeh I've seen this before there's likely another forge in your path %1 is not a valid Win32 application there was an issue with older solc on windows because older versions get shipped as zip files lol but this should be fixed in nightly Yup, I ended up suggesting this as a feature request. https://github.com/foundry-rs/forge-std/issues/96 ah interesting, curious to hear more about that. are you in the other foundry telegram channel? could move the discussion there Sure so how can do i resolve this? that path is /usr/bin/forge add export PATH=""$HOME/.foundry/bin:$PATH"" to your .bashrc or equivalent then foundry forge should have precedence over the other forge program will need to restart the shell for that to take effect btw There's a second Foundry Telegram channel? it didnot work after setting the path of the cargo bin it show me the forge —help command running, but when i close the terminal it gives me the error again. yea this one is for support, the other is more around contributing/development—you can find the link in the foundry readme again and again i have to set this and forge working fine. export PATH=/home/waqas/.cargo/bin:$PATH how to set the path permanently? add it to .bashrc file or other equivalent of the shell you're running Is there a reason why there is no []string implementation of assertEq or log_array ? check out cast run if the tx is on some chain but its already added. see this.",357
871,foundry-support.txt,"need to put $PATH at the end, like the following export PATH=""$HOME/.foundry/bin:$PATH"" Hey guys I’m using foundry/forge to test some stuff but I have to use my private key to make some signatures, I don’t really know how to configure forge tests to use a specific account, or if there is any way to get private key of the randomly generated test account still not worked 😔 I’m essentially trying to do mainnet forking and use an account of my choice I can use the VM/Cheatcodes interface to prank it to an address whose private key I know but I don’t know if that is a good solution, and would like to be able the change the address of the test account 1. make sure to restart the terminal/shell after the modification 2. what's the output of ps -p $$, printenv PATH and ls ~/.foundry, respectively? yes restarted terminal here is the output seems like /usr/bin is still before .foundry/bin another workaround is to set alias forge=""$HOME/.foundry/forge"" in .bashrc it also did not work sorry to bother you again, no worries, but i'm kind of out of tricks here 😅 😂 (did you also either restart the terminal or use source on the .bashrc after adding the alias tho?) Yes already tried What's the suggested way to write e2e tests using a fork of mainnet while impersonating specific addresses? anyone else having issues with forge debugger not showing source maps for contracts? normal settings, latest nightly (5385486 2022-06-27T00:04:55.418541Z) but was having issues on personal laptop last night as well Nathan, did you end up figuring it out? was this working before? is this on local only, or in forking mode? Starting learning rust to PR in foundry . Where should I ask for doubts in rust ?any discord group? This is the group 🙂 haven’t tried it on these specific contracts before, local tests In the end I wrote a JS script to compile the Yul file and output the ABI encoded bytecode, then I called the JS script from Foundry using FFI. This allows me to achieve the desired result of re-compiling and reloading Yul files inside of Foundry tests, but I consider it a hacky solution because it requires Javascript.",488
872,foundry-support.txt,"Ideally I would do this from FFI without invovling anything except for Solc and Cast Here is a Gist of a working JS script https://gist.github.com/CodeForcer/dc6f05f7ea33c796e8aeb7c8031d1ce0 Which I call like this Works perfectly, but I feel a little dirty coming across to Foundry and then bringing all this JS with me 🙂 Right - it shouldn’t need the JS. Can you open an issue with the steps you shared above, and we can look into it in more detail? It should be possible, may just be a non-obvious misuse or a bug on our end I think the only thing required to make this work is a way for Cast to turn Solc output bytecode into ABI encoded bytes which can be parsed by FFI. Sure I'll create an issue! As a side issue unrelated to Foundry, it would be nice if Solc could output a bytecode string and not force us to do manipulations on the output 🙂 does it not via —bin? How can I pass an address[] arg to a function with cast call ? It gives you a bunch of additional stuff ======= yul/Example.yul (EVM) ======= Binary representation: 600a600d600039600a6000f3fe600035608052366080f3 So you end up having to trim the last line and add 0x on the front, with something like solc --yul yul/Example --bin | tail -1 | (echo -n 0x && cat) Is forge coverage supposed to work with --ffi? ah yikes Curious if anyone knows if the Uniswap V2-Core tests might have been rewritten using foundry as an example ever in the past. What would be the purpose? V3 periphery is already ported to foundry Thought it could be a good example. I am working on something to repurpose v2-core and started by rewriting the tests, just was curious if anyone else had done that prior.",423
873,foundry-support.txt,"https://github.com/gakonst/v3-periphery-foundry/tree/main/contracts/foundry-tests/ https://github.com/supernovahs/Foundry-Starter-Kit I am trying to debug a failing test with by running the following command: forge test --debug ""testSafeMintWithRio"" I am able to follow calls on the stack until it gets to a point and emits this error: panicked at 'byte index 6994 is out of bounds of `// SPDX-License-Identifier: MIT // OpenZeppelin Contracts v4.4.1 (security/Pausable.sol) pragma solidity ^0.8.0; import ""../utils/Context.sol""; /** * @dev Contract module which allows children to implement an emergency stop * mechanism that can be tri`[...]', library/core/src/str/mod.rs:107:9 Abort trap: 6 not sure why it is throwing this error. has anyone encountered it? Think there's an open bug rn where we show the wrong place in the source and it crashes Can you open an issue w a repro https://github.com/foundry-rs/foundry/issues/2143 can you please link the issue? I upgraded foundry when i was opening the issue and debugger seems to have regressed. I cant see any outout in the contract calls anymore is there a way to expect any arbitrary reverts without specifying exact reason? i see a no arg vm.expectRevert() in the interface however, not specifying the reason and using that one always fails my test tried to give the forge coverage command a go but i get Compiler run failed YulException: Variable expr_135_address is 2 slot(s) too deep inside the stack. is this an issue on my end? all compilation + tests run fine otherwise I think forge coverage builds the contracts without optimizations which results in the 'stack too deep' error. Maybe you can try setting the via_ir flag to true in your config file Ugh yeah because the source maps get screwed up when compiling optimized i think i mentioned this in the PR, but we really should at least try to let the user keep optimizations on if it fails to compile wdym? if compilation fails with optimizations turned off, we should at least turn them on to get some info and not just gate the entire feature because it should still partially work i.e.",480
874,foundry-support.txt,"try compile without ops -> stack too deep fail -> reenable foundry.toml based compiler settings -> do coverage stuff maybe add a print warning is it possible to get a tx revert reason without having to replay it with eth_call ? tried running forge coverage with via_ir=true, and get this error: UnimplementedFeatureError: Modifiers not implemented yet. does it have something to do with coverage not working with modifiers? what solidity version are you using?? should be able to get tx receipt 0.7.6 i can only see logs, gas parameters in tx receipt oh right sorry forge build works btw, just seems to arise with coverage yul ir backend only stabilized in 0.8.13 So, any other way to get the forge coverage command working apart from setting via_ir = true, if I am getting CompilerError: Stack too deep when compiling inline assembly: Variable headStart is 1 slot(s) too deep inside the stack. when running coverage command? To make it work, you need to resolve the 'stack too deep' issue either via block scoping or splitting into smaller functions if you don't wanna use viaIR as coverage cannot run with optimizer=true Got it, thanks. ??? optimizer should be disabled when via ir is enabled the “legacy” optimizer is there a way to ""suppress"" forge test to stop the test if the exception has been catched in the test function? Hello, how is the test contract address computed? Are there some cheatcodes in use? Is there a way to exclude tests contracts from bindings generation? Hi, how does ‘—resume’ works under the hood? it just looks at the broadcast log, and pushes the remaining transactions. it does not execute anything locally u mean like failing fast? not currently but makes sense to add i guess, feel free to open up an issue anyone using foundry and huff together? trying to deploy a SimpleStorage huff contract on anvil and interact with it through cast, but it doesn't seem to be working > cast send 0xc9952fc93fa9be383ccb39008c786b9f94eac95d ""setNumber(uint256)"" 123 --rpc-url http://127.0.0.1:8545 --private-key ...",460
875,foundry-support.txt,"f80""` tx sent successful > cast call 0xc9952fc93fa9be383ccb39008c786b9f94eac95d ""getNumber()uint256"" --rpc-url http://127.0.0.1:8545 --private-key ... 0x using this https://github.com/huff-language/foundry-huff Hi any idea what this error means? Error: ProviderError(JsonRpcError(JsonRpcError { code: -32603, message: ""EVM error CreateContractLimit"", data: None })) ur contract is too big to be deployed, turn on the optimizer :) Thanks, how do I do that? i think its supposed to be ""getNumber()(uint256)""? see the example here: https://book.getfoundry.sh/config/index.html using that instead errors with > cast call 0xc9952fc93fa9be383ccb39008c786b9f94eac95d ""getNumber()(uint256)"" --rpc-url http://127.0.0.1:8545 --private-key ... Error: could not decode output. did you specify the wrong function return data type perhaps? Context: - Invalid name: please ensure the contract and method you're calling exist! failed to decode empty bytes. if you're using jsonrpc this is likely due to jsonrpc returning `0x` in case cont ract or method don't exist i guess the method doesnt exist erhh i guess it does i have no clue how huff works cc @andreaslb it should though https://github.com/huff-language/foundry-huff/blob/main/src/test/contracts/Number.huff #define function setNumber(uint256) nonpayable returns () #define function getNumber() view returns (uint256) ...  dup1 0x3fb5c1cb eq set jumpi  dup1 0xf2c9ecd8 eq get jumpi  set:   SET_NUMBER()  get:   GET_NUMBER() even the signatures match something has to be specific to huff here, because doing the exact same things with a solidity-deployed contract and cast works Getting the same error: forge create ./src/contracts/core/Vault.sol:Vault --rpc-url http://localhost:8545 --private-key $PRIVATE_KEY0 --constructor-args ""gov"" [⠃] Compiling...",492
876,foundry-support.txt,"[⠆] Compiling 2 files with 0.6.12 [⠘] Solc 0.6.12 finished in 272.80ms Compiler run successful Error: ProviderError(JsonRpcError(JsonRpcError { code: -32603, message: ""EVM error CreateContractLimit"", data: None })) Its the —constructor arguments that are probably the problem, constructor() public { gov = msg.sender; } let me reproduce ok your constructor doesn't take any arguments, so you shouldn't pass it any forge create ./src/contracts/core/Vault.sol:Vault --rpc-url http://localhost:8545 --private-key $PRIVATE_KEY0 [⠊] Compiling... [⠒] Compiling 10 files with 0.8.15 [⠔] Compiling 120 files with 0.6.12 [⠔] Solc 0.8.15 finished in 3.59s [⠢] Solc 0.6.12 finished in 7.07s Compiler run successful Error: ProviderError(JsonRpcError(JsonRpcError { code: -32603, message: ""EVM error CreateContractLimit"", data: None })) Hits same error minus arguments i mean it's still over the contract size limit not sure how big your contract is but there's a limit if it's still over the limit with the optimizer on there's nothing else u can do but reduce the size by cutting code Okay, I tested with smaller contract, you are right. Is there any guide in size limits or optimizing parameters for large contracts? size limit depends on what chain you are deploying to but generally its 24KB for most evm chains you can use forge build --sizes to check out how big ur contracts are as for optimizing for size i'm not sure if there's a clever way but generally you would split your contract out into multiple contracts Thanks, appreciate the feedback you could try the diamond pattern ( https://eips.ethereum.org/EIPS/eip-2535 ) there are a bunch of posts about this technique ( https://soliditydeveloper.com/eip-2535/ ) bump how did you deploy the huff contract? forge c Number iirc and the other rpc and private key options gotcha - reproducing rn Hey guys, I'm evaluating using anvil instead of hardhat node in our hardhat project.",494
877,foundry-support.txt,"I'm running the hardhat tests and it fails somewhere (it works with hardhat node) and I don't get any helpful failure reasons like require strings etc printed in the output. Tried passing -vvvv when launching anvil but it doesn't seem to do anything. Any ideas for how I can debug? are you on the latest version? you should be getting revert messages I only installed it today, so I assume so I guess if no revert messages that would indicate it's not failing at a require statement And when I try to run debug_traceTransaction I get ""method not found"" which is weird The documentation says debug_traceTransaction is supported 🤷‍♂️ can you run anvil --version I've left work now but I'll try it and get back to you this evening, thanks Can I use hardhat-deploy to deploy contracts to anvil? Yes that's incorrect, rn only parity traces are supported, geth traces need some type conversion first when doing forge mainnet forking, is there any simple way to diagnose or debug what’s going on in external calls, something debugger like, some trace I could get? traces should work with external contracts, i think the debugger does too.",247
878,foundry-support.txt,"if you mean figuring out what the JSONRPC calls are u have to run with RUST_LOG=trace i think ok thanks, — I’m reading the foundry debugger page and I’m looking at the command $ forge test --debug $FUNC and the example provided: $ forge test --debug ""testSomething"" I suppose testSomething is one of the tests however upon providing a very similar command I get said response ``` contract source info format must be `<path>:<contractname>` or `<contractname>` ``` what platform I’m not sure? windows? oh mac m1 and u r passing it to forge test --debug not forge debug? here is my command ``` forge test --fork-url $ETH_RPC_URL --debug ""testMyTest” -vv ``` ok that's weird, can you open up an issue? something must have broken ok I figured it out if I’m not at the root folder of the project it fails as in if I am in the test folder it fails however at the root/base it works, 👍 — ``` panicked at 'index out of bounds: the len is 12 but the index is 12', ui/src/lib.rs:193:21 ``` has this been reported on github? I had this yesterday with the debugger ; upgrade to the lastest foundry version , this version has a bug where the bugger isnt reading contract names though I believe there a fix for that that will be published tonight , so foundryup tomorrow https://github.com/foundry-rs/foundry/pull/2146 Whenever I try to run forge test I get this error with one of the files I've imported.",333
879,foundry-support.txt,"In this case UniswapV3Oracle.sol imports IUniswapV3PoolImmutable.sol whats the error? Is it not showing the picture I sent? Oh yeah you're right, not sure why I thought I saw it in the anvil reference is there any way to get the log_named_xyz events and the console.log s if I’m debugging? despite the fact that I have the verbosity at 2, if I debug something I don’t get my logs anymore (after I finish debugging) try verbosity at 3 Hi, how do I cast call a function like this; function signalApprove(address _token, address _spender, uint256 _amount) external nonReentrant onlyAdmin { actionsNonce++; cast call 0x948b3c65b89df0b4894abe91e6d02fe579834f8f ""signersLength()"" --rpc-url http://localhost:8545, works sup frens =) is there a way to write to storage directly, if I know the slot? stdstore.target().sig().checked_write() doesn't work since I'm trying to override a private uint from a parent contract. specifically the _currentIndex attr of an ERC721A mmmh, as I typed dis I found vm.store, which is exactly what I needed =) enable via_ir your alternative is generating optimizer steps or rewrite in lll or vyper 🫡 are there any production vaults built on solmate’s ERC4626? Should be @transmissions11 Rari-Capital/vaults I think? don’t think any of these are based off that contract https://docs.rari.capital/contracts/#rari-yield-pool ? Does anyone know why I am getting this error when testing an event emmission on my contract [FAIL.",370
880,foundry-support.txt,"Reason: Log != expected log] I am looking at the test and the two event logs seem to match up https://github.com/timeless-fi/yield-daddy this probably? is there a way to reset evm to initial state or forked state(whatever was started with) with a cheatcode? I went through all the issues and couldn't figure this out, how to make anvil fork from a url, but have a different chainId? The command that I am passing is anvil --chain-id 8177 -f https://polygon-mainnet.g.alchemy.com/v2/xxx --fork-block-number 3 --gas-price 10 --hardfork berlin -b 1 The chainId I'm getting is 137 where as it should be 8177 If you think this is a bug I’ll file an issue in GitHub Hi guys I'm reverting with a string via assembly and the hevm.expectRevert in this test seems not to catch it Here's a snippet: [FAIL. Reason: NOT_MINTED.",213
881,foundry-support.txt,"Counterexample: calldata=0xc368c36a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000, args=[0x0000000000000000000000000000000000000000, 0]] testBurn(address,uint256) (runs: 0, μ: 0, ~: 0) Traces: [50289] ERC721Test::testBurn(0x0000000000000000000000000000000000000000, 0)  ├─ [46897] MockERC721::mint(0x000000000000000000000000000000000000beef, 0)  │ ├─ emit Transfer(from: 0x0000000000000000000000000000000000000000, to: 0x000000000000000000000000000000000000beef, id: 0)  │ └─ ← ()  ├─ [4239] MockERC721::burn(0)  │ ├─ emit Transfer(from: 0x000000000000000000000000000000000000beef, to: 0x0000000000000000000000000000000000000000, id: 0)  │ └─ ← ()  ├─ [598] MockERC721::balanceOf(0x000000000000000000000000000000000000beef) [staticcall]  │ └─ ← 0  ├─ [0] VM::expectRevert(NOT_MINTED)  │ └─ ← ()  ├─ [464] MockERC721::ownerOf(0) [staticcall]  │ └─ ← ""NOT_MINTED""  └─ ← ""NOT_MINTED"" So the terminal appears to be reading the correct revert string How does this work? Right now if I run hardhat node and have the hardhat-deploy plugin, it will automatically deploy my deploy scripts.",447
882,foundry-support.txt,"How do I configure anvil (or use a plugin) to do the same thing? try using https://github.com/foundry-rs/hardhat replaces hardhat node w anvil Yea there’s some in the Fei org (tribe-turbo, fuse-flywheel, etc) , and zefram has made a number of them in yield-daddy for timeless I’ll link em tmrw about to sleep https://github.com/timeless-fi/yield-daddy Hey guys I'm trying to interact with Uniswap v3...but I'm getting an error of different compiler versions...is there any solution to this? UniswapV3 uses solidity 0.7.6 so make sure your contracts support those version in the pragma statements I'm trying to test the Single Swap contract....it's on 0.7.6 when I run forge build...it shows an error that the various imports in the contract have different solidity versions it should show you in the error message which contracts are not compatible. A common problem is that the default test and script contracts are 0.8.13 so check that those aren't the issue I made a simular Uni repo for hoping and you can check out how I set things up https://github.com/K-G-J/foundry-uniswap-hop How do I print the log under the script 0.1.0, 5279f69 Can I import the console library under script? I have ""function has no kind"" error in ""forge coverage"", any ideas on how to resolve this? For context (maybe helpful): the contract files I have has two solidity versions 0.4.23 and 0.8.13 I read that anvil is supposed to be useable as a drop in replacement for hardhat node or ganache, but so far I'm having to make quite a lot of changes to my hardhat tests to get them to work with anvil. Should I create issues in github for these or are there some things which are supposed to be different? I'm writing a test in which I want to fuzz a private key, and then I want to use the vm.addr cheatcode to obtain an address from the private key: address owner = vm.addr(privateKey); However, the test reverts with this error: > signature error The execution stops at`vm.addr`.",484
883,foundry-support.txt,"This is the fuzzed private key value that causes the revert: 115792089237316195423570985008687907852837564279074904382605163141518161494337 Anyone knows what this is about? Is there a way to filter what gets reported on using forge coverage? I would like to exclude testing utility contracts and libraries for example Is there a way to install ERC721A with forge in my foundry project or do I have to create the file manually? forge install https://github.com/chiru-labs/ERC721A if you could open an issue with issues you ran into, that'd be great! forge install https://github.com/chiru-labs/ERC721A --no-commit Installing ERC721A in ""/Users/samueldare/Code/realio/realioverse-contracts/lib/ERC721A"" (url: Some(""https://github.com/chiru-labs/ERC721A""), tag: None)  Installed ERC721A Thanks 👍 is there a way from a script (javascript) run with ffi to call the contracts run by forge test? Need to run this script in the middle of two tests, but can't find any test rpc or other way to do this. Any help will be helpful Published a Foundry + Yul example template https://github.com/CodeForcer/foundry-yul Got a little stuck setting up the dev flow so this should help anyone in the future who walks down my path using something like this should work for your use case: https://github.com/CodeForcer/foundry-yul/blob/main/test/lib/YulDeployer.sol#L12-L19 the max possible value of a private key is a little below unit256, dependent on the order of the elliptic curve. this is the order of the secp256k1 curve that ethereum and bitcoin use: https://github.com/RustCrypto/elliptic-curves/blob/c878f0bb814f760c75707919d693d965a4849f70/k256/src/lib.rs#L54. you'll see your value is exactly equal to the curve order so one les than the order is the maximum private key you can use.",457
884,foundry-support.txt,"you can use a uint248 as the input type or vm.assume / bound Good day everyone, please I just switched to manjaro, after installing foundry I discovered that if I open a new terminal session, I will have to install foundry all over again. Please is there a better option for going about it hey, can one pass msg.data through call send? so just ""call send [options] address data"" I try it, but get error can you post a code snippet along with the error? so this is it @SamuelDare https://paste.ofcode.org/6WepPjwc2Y6XPkPmnjhFnu but am basically just trying to send a tx with custom data (and value attached to the tx) do I need to zero-pad the bytes to 32 or something? ah nvm I've got it - there was no payable function lol Hi, I update my foundry version for the coverage update but wen I used it some of the contracts did not get covered at all and ones that got covered it showed lines in the constructor as uncovered I am assuming this is feature is still under active development can anyone confirm? Is it expected that forge build will pick one contract if there are two contracts with the same name? (I would have expected a warning) How do you write test for testing array of struct?? struct CreateGame {   uint256 gameId;   uint32 totalSpots;   uint256 totalRewardPool;   uint32 entryFee;   uint256 gameDurationSeconds;  } function createGameList(CreateGame[] calldata _createGame) public onlyOwner {} Contract.createGameList([1, 2,3,4,5]) should work kek.. CoPilot finished it. Okay. I am getting error identifier not found or not unique. But if it is inherited from main contract it should directly work right? Do not trust CoPilot not to make mistakes.",399
885,foundry-support.txt,"If you can paste a reproducile version I can take a look Check your the contract you are testing to ensure that you havent made a typo It seems like forge script does not check/warn for contract size before deployment, it would be a nice add Here is the fake code: struct AddNewGameRequest {   uint256 gameId;   uint32 totalSpots;   uint256 totalPool;   uint32 entryFee;  } function createGameList(AddNewGameRequest[] calldata _createGameData) public onlyOwner {   for (uint256 i = 0; i < _createGameData.length; i++) {    createGame(_createGameData[i].gameId, _createGameData[i].totalSpots, _createGameData[i].totalRewardPool, _createGameData[i].entryFee);   }  } And how to make test sleep for 5 seconds. Is it possible to write something like that? function testSomething() external { contract.thisFunction(); // sleep contract.otherFunction(); } You can use vm.wrap() to fast forward block.timestamp Docs website down for anyone else? Yep Will look into it the name of the struct in your test is wrong Can you unpack that? its up 4 me in europe whats ur guyses dns might be cache idk Today I learned! Thanks so much for explaining. i use 1.1.1.1 fwiw and it looks fine to me, if i dig @1.1.1.1 it resolves to the same ip as well, so not cache on my end most likely @msolomon4 would it make sense to make the privateKey input argument to vm.addr a uint248? Happy to open a GitHub issue about this, if yes nvm it was cache its down now, will check seems host is down Or at least throw a more sugestive error when the input is bigger than the order? ah sorry I could have been more clear—the max uint248 is smaller than the max private key value, so we do have to keep it as uint256. possible UX improvements are: - clarify the error message and suggest bound/assume (this would be my preference) - automatically use the input % n (n is curve order).",455
886,foundry-support.txt,"this introduce veryyyy tiny bias in that some private keys show up twice (like, negligibly small) seems to be a larger outage - their website is down (fleek.co) and i wanted to check up on just using ipns but docs.ipfs.io is down too lol a lot of libs that generate random values do have this bias, and in practice with true random values it’s not an issue (maybe like 1e-37% of vals wrap iirc? can calculate later when not afk), but since foundry biases towards extremes I don’t love wrapping implicitly might be doable to access book here in the meantime: https://gateway.ipfs.io/ipfs/QmdhnxVzXz8oHNEoDdyREtxStxzFopowt5U9S9oi4ioKoa/ decentralized but jeez ipfs gateways remain as slow as ever yeah, not sure if theres a nice way to autopin the new cids dont think its doable w/o ipns? idk wow, didn't know the book is on IPFS unfortunately, it times out for me just keep refreshing lmao at some point it will have found the files its just rly slow in the mean time, gh repo clone foundry-rs/book cd book mdbook serve and it should be accessible at http://localhost:3000/ that too they woke up https://twitter.com/FleekHQ/status/1542163010621407234 Yeah I agree, I'm in favor of displaying a clearer error message. Ultimately testing smart contracts should be a very precise exercise - implicitly wrapping inputs around some modulo goes against that. Is the bound function in forge-std equivalent to vm.assume? agreed, thanks for opening the issue it's not, bound would explicitly wrap the inputs, whereas assume would reject them and generate new ones Sure, forge init mkdir -p src/a && echo ""contract C { function f1() public {} }"" > src/a/C.sol mkdir -p src/b && echo ""contract C { function f2() public {} }"" > src/b/C.sol forge build # no error, b/C.sol silently erases a/C.sol in artifacts oh what - this shouldnt be happening cc @mattsse i tohught we had this fixed, both artifacts should exist? .",480
887,foundry-support.txt,"My bad need to double check that will give this another pass and impl this https://github.com/foundry-rs/foundry/issues/2079 as well Seems book.foundry.sh is not accessible currently can someone else check it out . Oh thanks 👍 Book site is 502 . Oh. known issue: https://twitter.com/gakonst/status/1542175547731480583 Hello I have an issue when I run the forge build —sizes command it reads the deploy script as well and the size of the script is <24kb How can I ignore the deploy.s.sol so it doesn't give me this error anymore as the deploy script will not be deployed with the contract Thanks! I want to ignore some files when I run forge build —sizes command hi, i've been trying out Foundry for a few days now, and it's great! the only issue I'm having is I don't get source maps while debugging. have I missed anything? shouldn't Forge build source maps while compiling? I'm using solc 0.6.11 since this project is already based on that solc version, maybe thats the issue Foundryup The fix should have gone live in this nightly At least I'm not the only one that didn't read 😂 Good point - should we ignore the deploy and test sizes? @msolomon4 mentioned that before Yeah that would make sense since we won't deploy them on chain so we don't actually care about their size Curious if there are any plans for versioned releases? We’re regularly encountering issues that end up being fixed by running foundryup, so we’d like to be able to pin to a given version. That said, it seems like foundryup -C abcdef builds from scratch and takes 6+ minutes, which will be rough in CI. I found and commented on the relevant issue: https://github.com/foundry-rs/foundry/issues/872 easiest way is have your script inherit from forge-std’s Script contract, this adds an IS_SCRIPT state var which foundry uses to ignore it when checking sizes Works, thanks! Hi all, Does anyone able to run ""forge coverage"" to get coverage report ? Saw a post on medium using that argument, but when I tried, it got command not found.",471
888,foundry-support.txt,"Wondering if forge has removed that options or moved to somewhere else in some updates ? Or forge is no longer supporting ""forge coverage"" ? Thanks It works I made a quick tutorial on that , see this Twitter post https://twitter.com/m0ham3dxx/status/1542249931540697089?t=s8G8AHb89q5rhFipchxqUw&s=19 foundryup Thank you very much for clarifying the issues. So the coverage tool is outside from the default forge package that I got via ""foundryup"" ? I tried to run it, but it seems get me some errors ""curl(3) bad range in URL position # "" 😥 My version is on 0.2.0 (not sure if thats the latest or not ) # is 67. check #3 item on pinned msg about your path forge 0.2.0 (5279f69 2022-06-29T00:04:38.931752Z) latest^ Hey, can you pls share what are some benefits of using Huff? As far as I know, you can use Huff to optimize smart contracts more and write more efficient code. It helps you get more familiar with how the EVM works too. It's similar to Yul but allegedly better, I haven't really used it much yet. Is there a way to use vm.deal for other tokens? not just eth is there a cheatcode that lets me call the _mint function on a solmate ERC20? check deal on forge-std same answer to both Thank you ser I get this error when using cast to call a contract on a local node: cast call 0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9 computeL2Timestamp 20 Error: resolving via etherscan requires a known chain Context: - Failed to parse chain: 900 Whereas cast balance works fine. Is there a way to disable ‘resolving via etherscan’? I could not find one. my guess is because you pass the sig as just computeL2Timestamp it tries to use etherscan to find the full sig (if so, pretty cool, didn't know that was a feature).",467
889,foundry-support.txt,"try passing the sig as computeL2Timestamp(uint256)(uint256)"" (or whatever it should be) ah of course correct does forge build --extra-output evm.bytecode.opcodes work for people? modifications to evm.bytecode outputs dont currently work :( not sure if there is an open issue or not cc @mattsse Thank you very much for the information. After I tried couple times via foundryup, (getting curl syntax errors). I installed it directly from the source which I'm now on the latest version now :) Thanks ! I'm able to execute ""forge coverage"" command. But I went into another errors ""could not find anchor: no matching instructions in range <contract file name>"" But it didn't print any other logs, and there is not much info on website when I tried to search the error message. Wondering if anyone has seen this error before ? Thanks ! Coverage is not ready fully yet So these are expected I see. But if there is some quick workaround to make it have some basic report then that will be perfect. Or that function is currently not working at this moment 🤔 Thanks! Pls open an issue with more context so we can fix over time as we improve coverage Thank, will do. Any help? is there a way to disable writing of broadcast/ files? Want to run some scripts as part of an e2e test but don't want to write any broadcast files thanks mattsse@ for fixing this so promptly: https://github.com/foundry-rs/foundry/pull/2155. it works now! 🎉 Ok, so, if we are getting this stack too deep error when running forge coverage.. is there a way to figure out exactly where we are having the stack too deep issue in the contracts? CompilerError: Stack too deep when compiling inline assembly: Variable headStart is 1 slot(s) too deep inside the stack. writing Yul more securely? Since Yul is kinda ""dangerous"" to deal with 😅 ok diving into the hardhat-anvil and hardhat-deploy code - you can't configure hardhat-anvil to work automatically with hardhat-deploy. We'll have to update hardhat-anvil with a new task that achieves this or create a new plugin.",465
890,foundry-support.txt,"I've anyways got to do this for my work - happy to see if I can take it on - what's the process to contribute? is there any repos for testing contracts in order to find honeypot/high tax/malicious erc20 tokens? at the moment im just simulating buy/sell tx on univ2 using anvil that isn't foolproof since sometimes scammers have a disabled blacklist which they enable later in order to work inside transfer function something like this: blacklist[address] = 1; if (blacklistEnabled && blacklist[address]) { revert(); } that would fool it gm is this expected behaviour? uint256 a = block.timestamp; console2.log(a); vm.warp(a+1); console2.log(a); prints 1 and 2 to the console would have expected “a” to be stored on stack an not change? created an issue here https://github.com/foundry-rs/foundry/issues/2167 Maybe it's the optimiser The optimiser at compile time spots an opportunity to save a memory allocation, so it replaces a with block.timestamp in both places Any good optimiser should always do this replacement, since memory is expensive to allocate and block.timestamp is never expected to change in the middle of execution I am trying to install foundry on WSL Ubuntu. But the following error shows up. does someone know whats wrong? Thanks for your time... oh you're right, will add this yeah it compiles to the timestamp opcode didnt know hey guys, trying to run cast call on the contract i created on a forked network but i run into ``` Error: (code: 3, message: execution reverted, data: Some(String(""0x""))) ``` for one of the functions.",357
891,foundry-support.txt,"does anyone have any idea on how can i debug it? i managed to cast call a different function, which i assume my contract is working as intended turns out that i was calling an internal function 🤦 except it’s literally cheaper to not do any stack manipulations on it and just add it to the stack every time you need it it’s a bug in the optimizer on windows, you need to build from source to get foundry instead of using foundryup book.getfoundry.sh/getting-started/installation.html#building-from-source hey, is there any way to utilise an ABI for contracts you're interacting with to help debugging during testing? i.e something more readable than all of the calldata for internal calls How to do testing on mapping? struct GameData {   address gameOwnerAddress;   uint32 totalSpots;   uint256 totalRewardPool;   uint32 entryFee;   GameStatus gameStatus;   uint256 gameDurationSeconds;  } mapping(uint256 => GameData) public gameList; Did foundry implement its own fuzzer or does it use someone else's? GameData g = new GameData({totalSpots: 1, ...)}; gameList[0] = g; assertEq(gameList(0) == g.totalSports) Can anyone suggest how to navigate round this error I'm getting whilst trying to install? I've been trying to fix this for a long time now without any success :( what commands should i use from anvil or cast to send an account created by anvil when i fork a blockchain some $DAI tokens? more specifically, how do i impersonate a sender who has $DAI? i tried doing cast call $DAI_TOKEN \ --from $DAI_OWNER \ ""transfer(address,uint256)(bool)"" \ $ALICE_PUBLIC \ 123456 but the balance didnt change Foundry Support Trying to use foundry to drive javascript tests. Am spawning anvil from node. Then calling forge script ... --broadcast --rpc-url localhost:8545 to setup the state. Default sender is not working. Setting as additional forge script params --sender <1st anvil account does not help. Related, I don't understand the meaning of the --sender option on anvil. error is No associated wallet for addresses: {0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266}.",493
892,foundry-support.txt,"Unlocked wallets: [] good point, that's indeed redundant, we reused some CLI args from forge for this, but need to roll a custom one it seems Ummmmmm cast version 0.2.0 presumably nightly from foundryup, build 2022-06-27T00:03:53.397337486Z There's no priority-gas-price option in the cast send tool? What, is it just going to send everything as a pre-1159 transaction? Am I missing something? ok :) And is there a way to have forge talk to a local anvil node without giving a --private-key? Donde estas priority-gas-price for deployment, you mean? cc @joshiedo yes, and specifically for the setup ""I want to run a local node and have that node get some populated state through a forge script"", ie terminal1$ anvil terminal2$ forge script deploy.sol --rpc-url localhost:8545 --broadcast terminal2$ ... do some tests with the node... and what's the issue? 😅 you didnt pass a private key, did you ? it for sure works when I pass one :) my question was more ""why do I need to"" (since i assume anvil accounts are unlocked) can anyone suggest me something to try to fix this installation error? currently it requires a private key.",277
893,foundry-support.txt,"i think there's an issue about allowing anvil_impersonate transaction to be made, but havent gotten that in yet this option is just added recently, please run foundryup guys what's the best way to use UUPS with foundry? there's so many problems with Openzeppelin's version as it's so dependent on their own plugins for hardhat I'm having an issue using vm.expectRevert with a custom error (it'll actually send EIP1559 txs if the chain support it, just that priority-gas-price will be set to the same as gas-price) it's not visible I mean your error did you put it just in the same file or in that actual contract? if not in the contract don't use grant.notownererror Its in the contract That's what i did function testFail_notOwner() public { vm.prank(addr1); vm.expectRevert(abi.encodePacked(grant.NotOwnerError.selector)); grant.createGrant(tokens, reciepnt, 100, 10); } try putting it out of the contract and just on top Sounds like a good idea, thanks could someone help with this blz? Ok now it's in the options. By the way forge create uses --priority-fee while cast send uses --priority-gas-price - might want to standardize on language yep, agreed maybe don't compile manually? https://github.com/Timidan/Foundry-Hardhat-Diamonds Maybe this could help what's the standard people use? I do love the diamonds thanks for the reply. How do i not do that? I'm just running the installation script from the github cargo install --git https://github.com/foundry-rs/foundry anvil foundry-cli Worked, thanks. Now I'm wondering why It doesn't work the other way around. yeah just use rustup and then foundryup curl -L https://foundry.paradigm.xyz | bash this the command you want I can't say, I don't really have expertise on the topic. thanks anyways just wanna make sure it's a well known easy and perhaps reviewed implementation so no bugs yeah it's a bit weird perhaps maybe something to do with scoping with custom errors Probably. In the example they used in the foundry repo, the contract was in the file and it worked. Ah, i'm on windows i think that the only way is to build from source.",497
894,foundry-support.txt,"You could get WSL, that's what I did. what's WSL? https://docs.microsoft.com/en-us/windows/wsl/setup/environment#file-storage ok thank you. i'll check that out. UUPS need to use 0.8.2 or newer compiler to compile, I dont think it is the problem to use OZ’s contract. EIP-2535 Diamond contract Does not work when I try it. vm.deal(alice, 1 ether); you’re giving it 3 args when it only takes 2. vm.deal(account, amount) It should be able to take three Check Test.sol https://book.getfoundry.sh/cheatcodes/deal.html?highlight=vm.deal#examples you might be looking for store: https://book.getfoundry.sh/cheatcodes/store.html to store the balance of ERC20 or just call mint They've just not added it yet @mr_abims hey man , in reference to your issue , the hacky way of fixing all your path problems is to download pipx and then issue the command pipx ensurepath , this usually solves weird path errors , otherwise you have look at some documentation , on fixing paths in your OS , - you can locate forge via - whereis forge / locate forge , then examine your path echo $PATH - Then run the pipx ensurepath , then try again , and check echo $PATH - If you still cant fix, it you have to search for your OS , how to fix paths - StackOverflow.com Make a PR to the plug in! Correct - this has been flagged before, @onbjerg u remember the issue? We use the proptest crate Hi, is there a way to config to let forge test only pick the files in the test folder rather than the script folder? Can you not install via foundryup? What's the issue? ""cast send"" :) And you need to impersonate the account when I run forge test, it includes the s.sol file in my script folder which generating fail tests Which I think we don't have natively. So need to do via cast rpc anvil_impersonateAccount 0x1234 How do tests fail because of the script? I'm trying to setup wsl to try We don't have helpers for it yet - need to port the OZ js code to solidity.",481
895,foundry-support.txt,"Is simple Maybe you're not on latest rust And there's an incompatibility Try rustup update Ya let's do that - wanna open a PR to call it priority-gas-price yes, because my xxx.s.sol file has some methods named testXXXX, so it picked that methods. Running 3 tests for script/UniswapV2Pair.s.sol:MyScript [FAIL. Reason: Arithmetic over/underflow] testBurn() (gas: 7843327) [FAIL. Reason: Arithmetic over/underflow] testMint() (gas: 7843395) [FAIL. Reason: Arithmetic over/underflow] testSwapToken0() (gas: 7843306) Test result: FAILED. 0 passed; 3 failed; finished in 4.68ms Just deal when you inherit from forge-std/Test not vm.deal Just wondering if it can be configured to exclude the script folder for forge test. Ah I see Sure can you exclude them with the --no-match-path option? https://book.getfoundry.sh/reference/forge/forge-test.html#options Thanks, this is really helpful DO NOT USE it with WINDOWS windows bad lol use foundry in wsl in its own filesystem. it's going to be so insanely fast trust me yeah I know about the diamond, I was just wondering if I could use it with Openzeppelin's stuff? since they got OwnableUpgradeable and everything done already? is there a guide on that ser? ya i mean figure out how https://github.com/OpenZeppelin/openzeppelin-upgrades works and port it over lmao thanks I'll try to do that then I guess it's the only way don't feel like switching back to hardhat now lol btw how come forge is so much faster than hardhat? like it doesn't even make sense lol. even just to compile solidity, forge is almost instantaneous while hardhat can take over 20 seconds without even runnning any tests https://www.paradigm.xyz/2022/03/foundry-02 read up isn't it just calling the solc compiler? alright ser, I'm just mindblown hehe rust is fasttttt but it's literally just calling the solc compiler lol...",462
896,foundry-support.txt,"even tho nodejs is slow it should still be like max 1 second slower no? @mattsse wanna dump the alpha? dunno, probably some wizardry tldr: the external process calling overhead is smaller, we cache better, prune the dep graph to compile fewer files when not needed currently building my EVM toolkit in rust and its speedy asf newbie question- I got stuff working locally w/ anvil. great. now I try to get it working on testnet (rinkeby?) I am able to deploy with forge create but cast send fails with Out of gas: required gas exceeds allowance: 0 any hints to what I'm doing wrong? I'd think if I was _actually_ out of gas, deploy would fail too. Not sure what allowance of 0 here means either.. you need to specify —from or a private key 🙂 Its disabled by default for some reason yeah I am setting the private key... yeah the caching is defo miles better. recompiling withoout changes is almost instantaneous there's lots of pre and post processing involved, for example, resolving the whole project graph which involves reading/parsing all source files and then eventually writing all contracts to file to name a few the best part of foundry is that I don't even need to fight the rust compiler with any funny borrowing checker business Years of development IPFS cant even do DNS in non retarded ways best of both worlds ya -this is a feature 🙂 for the script itself, not the individual contracts its the second option in the default disable error codes the tool is in rust - but it doesnt need any knowledge of rust exactly! was looking into dapptools but nixOS made it so hard to work with. foundry brings dapptools to the masses! if you want to do it as fast you have some options wrt nodejs. You can start a server and use netcat, you can use a buildtool like nx , etc waaaaaaaaaaat hmm maybe the format is wrong? I just export private key from metamask...",416
897,foundry-support.txt,"are you in windows how many times do we have to tell you nixOS sucks heh except it doesn’t suck mac, but not sure why that would make a difference? also, when evm wasm ? when javascript fastest on EVM? all i know is more people have complained about it than have said good things about it i am certainly not as bright as half the ppl in here and i have zero issues yeah all of that just to call solc lol... but usually most of my nodejs scripts are pretty fast (just not memory efficient) idk why hardhat isn't lulz but it certainly cannot compare with the ease of use of cargo... because it works on windows https://github.com/NomicFoundation/hardhat/pull/2522 if hardhat would drop windows support it would make fs handling much simpler ya but cant do that :0 ntfs is that bad? doesn't nodejs fs handle it automatcially already? Ser , nix is more than cargo install. But i digress I tried to install everything using nix for dapptools initially but it just wouldn't work at all lol. always some hash string problems with something. Then I found foundry lmao problem solve They support nodejs 12+ so yea what os are you using? was mostly using windows but now it's mostly wsl/docker and remote linux server environements Oh. Ser, you deserve better than Redmond soyware playing some windows games so no choice lol and too lazy for dual boots bro linux has native nvidia drivers what's with that? wsl has a full linux kernel tho blasphemous ye but some games like age of empire doesn't work well with win LOL sorry with linux im playing age of empires rn really? steam os? nah im jk Cheese steak Jimmy's :) btw when I do cast wallet address --private-key <PRIVATE_KEY> I get the correct address... :))))))))) ahhh, I'm an idiot, I wasn't setting rpc-url :D and so it was hitting localhost, and since I have anvil running, it was that the account didn't have funds instead of timeout ;) Oh, that's new. Does this apply to everything else? Hi there, I am creating a local fork with anvil based on mainnet's latest block. I am then deploying a contract on my fork.",481
898,foundry-support.txt,"As new blocks appear on mainnet, is there a way to ""hot reload"" state into my fork without cold restarting anvil and having to redeploy my contract? nope not in scope Alright, thanks Georgios. I guess a cold start is the only way to approach it right now. Having a blast with Foundry so far, thanks for starting it team effort 🙂 Hi guys. I a trying to test interactions with Chainlik and I wonder, is it possible to test it in a live network? Or shoud I fork it and mock the response from Chainlink contract? —rpc-url uses real data Great, ty! Is there a standard way to run anvil then run deploy scripts against it when its ready, similiar to how hardhat-deploy runs the files in /deploy in alphabetical order? ie: Can deployment happen in the same terminal? Maybe there is rust tooling for this? Thanks so much for pointing it out. I've been thru the commands and forgot to give it a shot. now I can use this command to get it work perfectly. forge test --match-path ""test/*.sol"" https://twitter.com/grhmc/status/1542307690013147137 @brockelmore @mattsse hello 👋 ...thank you for all the great tools! I'm trying to get my hardhat config working with anvil but it is having problems with launch: true. @foundry-rs/hardhat-anvil is imported, but typescript complains about the launch param not being part of NetworkUserConfig. I ts-ignored it, but I still get Error HH108: Cannot connect to the network anvil so it seems launch doesn't seem to be recognized at all. Any ideas? i last contributed to foundry book when it was under onbjerg/foundry-book now that i wanna contribute a new tutorial, im getting remote: Permission to onbjerg/foundry-book.git denied to bblanc42. fatal: unable to access 'https://github.com/onbjerg/foundry-book/': The requested URL returned error: 403 i tried to fork the new foundry book but it shows that i've already forked it.",446
899,foundry-support.txt,"can someone pls help me out? @tyneslol might have thoughts change your remote to foundry-rs/book can i contribute a tutorial on anvil impersonating? ya hmm mind opening an issue for that with your config? the launch option should be true by default fwiw i gave up on that, deleted and re-forked. 😂 https://github.com/foundry-rs/book/pull/411 much appreciated 🙏 https://github.com/foundry-rs/hardhat/issues/74 how do you assert an error with no message? like trying to call a function on an EOA ? require(true); how do we pass an array to a function in cast call? is it supported? cast call $CONTRACT \ ""a_function(uint256[])"" \ [1,2,3] this should work^ after the end of the function? I can make it work with ""testFail"" but feel dirty 🤮 vm.expectRevert() foo.revertingCall() try this thanks, that works was trying vm.expectRevert(""""); that gets a weird error What are peoples’ favorite Foundry tutorials? What are we missing the most from the docs? https://github.com/SkidsDAO/skidsdao.github.io/issues/1 These r some im going through and or coming back to Ohh guys i had to re-open telegram (it's been so long!) to tell y'all.. LOOOVING FORGE SCRIPTS! ❤️ 🙏 Thanks amazing team Hey folks, our team wants to buld something on top of Uniswap v2-core and started by rewriting the exisiting test using foundry. We really love Foundry and wanted to share what we learned in case it is helpful in anyway.",358
900,foundry-support.txt,"https://twitter.com/ammalgam/status/1542678953730592769?s=20&t=62z7FbnDbP9fXofSE2VrsA fantastic! thanks for sharing 🙂 can someone pls verify that cast abi-encode is working? im running into Error: UnrecognisedToken 0:11 `constructor` ABI-encoded constructor arguments: when i try to verify my contract what's your exact command? i believe this is an issue of ethers-rs not parsing constructor here https://github.com/gakonst/ethers-rs/blob/de1020c91e85ecb78e4c6ea12f61f30d28296602/ethers-core/src/abi/human_readable/lexer.rs#L336 ok thanks 🙂 replacing constructor with f in the signature should get you what you want since cast abi-encode doesn't include the selector anyway bingo, it worked. thank you 🎉 should i open an issue or this is the intended new behavior (so i can update the docs)? i think we can open an issue on foundry and discuss done: https://github.com/foundry-rs/foundry/issues/2176. thanks for helping 🙂 now that i successfully submitted the verification on rinkeby, i got response: OK but when i try to verify it, im geting Contract verification failed. any idea how can i debug it? did you figure this out? uniswap v2 is proved in k framework the dapporg audit nope Hey, can anybody contribute to foundry github repo or is it restricted to only to the team? anyone of course 140+ ppl 🙂 Okay great How do you make test pass for function which has onlyOwner modifier because it gives error Caller is not the owner. vm.prank No I mean I know using vm.prank(notOwner) to call that particular function which makes it fail. So it is red but what should be the assert condition to make it green? Is it possible? Running Solidity scripts generates a ""broadcast"" folder. Should this be kept in git? I suppose that this contains relevant metadata about contract deployment. So I guess that mainnet (and even testnet) deployments should be version controlled, but not local networks (Anvil etc.)? trying to use scripting to deploy on polygon mainnet. Tried multiple times on mumbai testnet and everything works perfectly.",492
901,foundry-support.txt,"For mainnet however I keep on getting this error (tried multiple providers now): ProviderError(JsonRpcError(JsonRpcError { code: -32000, message: ""transaction underpriced"", data: None })) Yep, rename it to testFailCreateGame you must have missed our stated motivations, for sure was not to prove v2, but to repurpose the code and build on top of it, but doing so using Foundry and tests written in Solidity. Thanks How do you test mapping I am confused? You have struct say Struct Data { uint oneData; uint twoData; } mapping(uint => Data) public data; how do you import both of this in test file?? I can do below to import it in test file ContractName.Data[] internal _data; but how can you import the mapping or test it? it's public, so you can access it via public getters and write asserts: assertEq(contract.data(13).oneData, 42); It is giving me error Member data not found or not visible after argument-dependent lookup in type(contract Contract) then it's the wrong contract that you're calling it on? Or it has the wrong contract type Is there a way to run '--ffi' by default during forge test Already added ffi = true in the toml file but it seems not working can someone pls verify that forge verify-contract and forge verify-check are working? i was able to get an OK response after doing verify-contract but it never verified when i opened rinkeby etherscan and also verify-check kept showing failure is there a way to compile a single contract without setting up a project? Would it be easier to just use the solc binary? setting ffi in the toml should definitely enable it by default, what error do you get? rinkeby is always a bit flaky, try goerli instead for single files you'd be better off using solc directly, if you just want to compile a single contract its also being deprecated soon I got the contracts to deploy via solidity scripting, but the verify script failed (because it took too long to confirm). Is there a way to easily verify deployed contracts via scripts without manually encoding constructor args and solc settings etc not sure if this is still an issue but gas estimation on (some?) polygon endpoints is not really reliable see also https://github.com/foundry-rs/foundry/issues/1703 yeah I realised..",493
902,foundry-support.txt,"it had broadcast them with 3gwei.. that's why it took so long. However, now they finally went through and I can't see a way to easily verify them anymore i guess yeah, thanks @joshiedo correct me, but in this case you'd need to verify via forge verify-contract, right? https://book.getfoundry.sh/reference/forge/forge-verify-contract.html not necessary, you can just call the forge script command with the --verify flag and without the --broadcast one :OOO will try, thanks hmm, I just end up getting this and it immediately terminates: [⠒] Compiling... Nothing to compile ## Start Contract Verification Transactions saved to: broadcast/Test.s.sol/137/run-latest.json is it the latest forge? if so, you can try and clear the cache and try again yes, just ran foundryup and forge clean, still the same result Could it be due to having run the script many times in between (with many of them failing) and it not being the latest broadcast run? oh yeah, that could be the reason one thing you can try, a bit hacky, maybe we should allow a log file flag.... but broadcast/Test.s.sol/137/ search on this folder for the log which has your contracts, and rename it to run-latest.json k will try thanks but before that did you call many times with which flags? --broadcast or --resume ? broadcast ok, then definitely try that k and on the safe side, call --resume --verify.",315
903,foundry-support.txt,"i have a feeling you never actually got the receipt so, I found the file that corresponds to the deployed addresses and I tried both, with and without --resume do you mind if I send you a dm with some more info? Don't want to share everything here is there any example of constructing a raw tx with cast? Yeah sure, go ahead How to test a single file if there are numorous files to test? Any examples of repos withwell written tests that you guys have on to of your mind please? you can run specific tests by passing in a filter with --match-path or --match-contract more about it here -> book.getfoundry.sh/forge/tests.html just in case someone else finds themselves in the same spot: I was trying to send a tx with my ledger, but cast kept failing, the reason was that I had Frame Wallet open and it kept a lock on the device while this error is documented with foundry, it is not with Cast, which just fails silently Thanks Good question. We could by default git ignore the 31337 broadcast files maybe? Sounds like a sensible default to add in the forge template Since you can’t pass the test folder as a CLI argument to forge test, how do we run the cheatcodes test suites in the testdata directory of foundry? @onbjerg u just pass --root testdata https://github.com/foundry-rs/foundry/blob/c0b8bb1f4bee4e8136ca870a9120be4d2eb3d819/forge/src/test_helpers.rs#L20-L24 we do that here test folder is cosmetic, any contract with a test* func in it is ran as part of the test suite ya eactly let’s open an issue for posterity, so we dont forget? is there a gas limit for cast-call? if so, can it be increased? Ah right. I also had to pass —contracts cheats for it to work. cast call just sends a request to an ethereum node, gas limit is dictated by the node ok thanks. I’ll take a look at the node Looks like those ERC20 override functions are not detected by the coverage, even if properly tested Thx for flagging - can you open in an issue with full repro Coverage still WIP is there a way to do coverage even if its a bit buggy ? yes it works - forge coverage Hi all, sorry have another question.",494
904,foundry-support.txt,"Does ""forge script"" can take any parameter input ? Like I can have ""run(a,b,c)"" and pass values in when running forge script ? (I think so, but I tried to do the same as forge create, but getting function signatures errors) Thanks! yes it does forge script foo.sol a b c it should work if it doesnt pls open issue and we can look into it for run(a,b,c) with the appropriate types ofc Hmmm let me try again. Maybe I messed up something in the middle. I had two addresses and internet so I command line I made it like forge script a.sol ""0xaddress"" ""0xaddress"" 123 123 But received some errors. But let me try again. Thank you very mcuh ! Hello one question. What versions of solidity are supported? Sure I will create a demo repo forge coverage --report lcov && genhtml lcov.info -o coverage for the interface all Error: 0: ""C:\Users\JEISSON\.svm\0.5.17\solc-0.5.17"": %1 is not a valid Win32 application. (OS error 193)) Location: cli\src\compile.rs:99 what’s your forge --version? forge 0.2.0 ya you gotta update foundryup this? Run foundryup The term 'foundryup' is not recognized as a cmdlet name ah - reinstall from source if you’re on windows Is some syntax needed to to added ? Still getting function signature not found in ABI errors. Or I need to put those parameters in setup() instead of run()? this is source https://github.com/foundry-rs/foundry/tree/master/foundryup ? Hi, anyone else having IndexError: list index out of range error when running static analyzer mythril? Hello 😃 I'm trying to export the abi to a specific file directory. Is there an equivalent to hardhat deploy --export-all ? Hey, when using mainnet-fork, does fork up to date with the mainnet ? Is it using the latest state or some pinned old state? Pinned To the block you chose Hello, as I was running one of my tests that sends ETH and I noticed that the stack traces showed that the fallback function was called. The msg that was sent had a value and no calldata.",483
905,foundry-support.txt,"Do the traces always show fallback regardless if the receive or fallback is invoked? yes, by definition fallback func has no selector or arguments so we will assume no calldata = fallback/receive in the trace Done, ser. https://github.com/foundry-rs/foundry/issues/2190 https://book.getfoundry.sh/getting-started/installation.html#on-windows-build-from-source Why am I getting this error? are you trying to log a struct? IIRC foundry doesnt support this or a u256 array struct yeah. It's a mapping its already imported via Test.sol no? Considering I have this Struct Data { uint oneData; uint twoData; } mapping(uint => Data) public data; If there is no function which accesses the mapping in main contract file like below: function getData(uint dataId) external view returns(Data memory) { return data[dataId]; } Is is possible for me to access data mapping? what is foundry ? https://book.getfoundry.sh/index.html Is a fully automated differential testing feature between two smart contracts feasible? This would be useful in cases where you have one simple to maintain/readable version of a smart contract and one heavily optimized version (like seaport). It would be nice to be able to tell whether two contracts are functionally equivalent. Foundry would run random inputs (like invariant tests) and expect both contracts to revert with equal messages, emit the same events and return the same data on all external functions.",301
906,foundry-support.txt,"Is there a way to ignore/include specific files for the coverage? what is google? how can i allow reverting txs in forge scripts? havent use scripts yet but can you use try catch? not sure, the simulation fails i think simulations are just txs ran on a forked state i added expectRevert to allow reverting tx in run tx that gets used to detect and record txs but i am not seeing any option to skip simulation dont see a way to do it with forge create either even with gas-limit it still fails, i assumed if i specify gas limit, it won’t try to estimate gas and hence wont fail Hi dapper lol Maybe foundryup first You’ve tried expectrevert are you sure the code is correct? I’ve noticed issues with errors not being caught if they’re too deep as well but I’m using a month old version of foundry And I forget the exact causes so foundryup is probably best its not a stack too deep error and i am on quite a recent version when forking mainnet and testing - I have a test which requires two calls to an external contract. In my contract I use an Interface for the external contract/calls. The second call depends on the first call having been mined and an on-chain state having been updated. Will the mainnet forking keep track of this ""on-chain"" state change from the first external contract call? (so far it is reverting as if that state isn't recorded in the forked mainnet) No it’s not it doesn’t manifest as that for me either It just doesn’t low revert and other errors if it too deep anyone got a quick fix for vscode import error? following things tried: 1) set remappings (didnt work) 2) set .vscode/settings.json (also didnt work) compilation works ok nvm i have to open it as my root lol Hey guys, I would like to contribute to this: https://github.com/foundry-rs/foundry/issues/840 But I don't really understand where eth_rpc_url is fetched in the code https://github.com/sambacha/foundry-scripts/blob/master/justfile if you want something portable, extendable and superior Hi I asked this question earlier but still have not gottent to the buttom of it.",473
907,foundry-support.txt,"I have a AMM contract that emits a event Swap(address swapper, address indexed tokenIn, uint indexed amountIn, uint indexed amountOut); when the swap function is completed. I am testing it out and my code is function test__swapEvent() public {   CPAMMContract.addLiquidity(100, 100);   vm.expectEmit(true, true, true, true);   uint amountOut = CPAMMContract.swap(address(token0), 50);   emit Swap(address(this), address(token0), 50, amountOut);  } Yet I am getting the failing tests because Log != expected log. When I look into the logs, they seem to match up, so I don't understand why my test of the event is failing. you have the order switched you do expectemit -> emit Swap -> call u currently have expectemit -> call -> emit can someone pls verify that forge verify-contract and forge verify-check are working? i was able to get an OK response after doing verify-contract but it never verified when i opened rinkeby etherscan and also verify-check kept showing failure. mattsse@ told me to try using goerli test net, i just tried but it didnt work too. Thanks so much! gotcha 😄 Do you know if it's possible to export abis in json format to a specific directory? Similar to how hardhat-deploy library's —export-all? hi Premm :) look in justfile , you can change it in the env setting dor ethers_solc_output is expectCall meant to be used after mockCall, in that it expects the mockcall? no it’s to test in general a particular path was hit in a smart contract that calls another contract i.e. that A calls B.something Is it possible to have anvil fork and reset to an entirely new chain without shutting it down? I was trying to do ""anvil_setRpcUrl"" followed by ""anvil_reset"" but it seemed to keep the state (and chain_id) of the original chain.",419
908,foundry-support.txt,"Not entirely sure if the error was me or anvil tbh Ah, so if I had made an external call to another contract in my test, i could then follow-up with expectCall() to test that the external call returned the correct msg.value and calldata 👋 does anyone know the best way to spin up anvil locally as part of a testing framework in Rust? I'm either just going to call the anvil binary and have Rust monitor it while it runs in the background, or try to import the anvil code and run the main method from the anvil.rs file. Thanks! Had a hard time adding foundry as a crate --> made some minor fixes in this PR: https://github.com/foundry-rs/foundry/pull/2195 What is the reasoning behind changePrank marked as internal? Nothing else uses it , and make it redundant as I would like to switch context in my tests.   function changePrank(address who) internal {   vm.stopPrank();   vm.startPrank(who);  } Unless you plan on carrying the state of the previous chain I would think not, otherwise you would do a transition block but you would have the previous chains history which i think you are not wanting to keep both work ether-rs uses the latter by calling the binary: https://github.com/gakonst/ethers-rs/blob/master/ethers-core/src/utils/anvil.rs but you can spin it up an instance programatically: https://github.com/foundry-rs/foundry/blob/master/anvil/src/lib.rs#L56-L75 see integration tests for more examples Is there a way for me to know where the coverage failed ? could not find anchor: no matching instruction in range *****:3254:17:17 Oof. I really 💙 Foundry ⚒🔥 so I say this with love... Everytime I need to foundryup, I do so in great fear 😅 It hasn't worked for me once 😅 I always need to build from source and this time it seems to be hung. I'm on Windows 10 using WSL. Out of curiosity, is anyone testing for this setup? I would think it is pretty common. It's been like this for the past 10-15 minutes.",471
909,foundry-support.txt,"What doesn't work when using foundryup in WSL? Release builds take a while yeah I just killed it, rebooted and tried again: I ran into this: forge: /lib/x86_64-linux-gnu/libc.so.6: version 'GLIBC_2.29' not found (required by forge) So followed the troubleshooting instructions. Ok. After some time, it just errored: ubuntu rugging u, they have an old linux kernel which ships with an old glibc Ah. I am new to linux and not really tied to Ubuntu. Any suggestion? (""new"" is not exactly right. I should say I haven't used *nix much since 1998 👴) PS C:\Users\ericf> wsl --list --online The following is a list of valid distributions that can be installed. Install using 'wsl --install -d <Distro>'. NAME   FRIENDLY NAME Ubuntu   Ubuntu Debian   Debian GNU/Linux kali-linux  Kali Linux Rolling openSUSE-42  openSUSE Leap 42 SLES-12   SUSE Linux Enterprise Server v12 Ubuntu-16.04 Ubuntu 16.04 LTS Ubuntu-18.04 Ubuntu 18.04 LTS Ubuntu-20.04 Ubuntu 20.04 LTS Which one would probably give the best experience with Foundry? Any way I can roll back? 🙏 I'm screwed 😂 (Trying Debian) I was just about to deploy my contracts to testnet 😭 Debian seems even worse: ericf@DESKTOP-U8C0TH4:~$ forge forge: /lib/x86_64-linux-gnu/libm.so.6: version `GLIBC_2.27' not found (required by forge) forge: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.29' not found (required by forge) forge: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.25' not found (required by forge) forge: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.28' not found (required by forge) try building from scratch again, and if u can increase available memory i could be wrong but there may be a docker build someplace? Yeah. I was just looking at that.",491
910,foundry-support.txt,"I was able to pull the Docker image, but not sure what to do with it. Rebuilding now 🙏 It worked! Don't tell me that from the moment I mentioned the problem until you said this, you pushed a fix? 😂 God level 🙌 haha we did not 😂 ok In any case, I'm back in business. Thank you 😊 🙇🙇🙇 Now that Foundry is working again (🙏), I'm having some noob problems. I have a contract function that returns the state of a pool. The contract compiles fine, but when I call the contract function from a test, I am getting stack too deep errors. Is the source of this error the contract or the test? 🤔 Usually when I see stack too deep errors it is when compiling the contract, not when running a function. This felt dubious and I wasn't sure if it was going to work, but it is a view that returns quite a bit of info:  function pool() public view returns (address, string memory, string memory, uint8, uint256, uint256, Asset[] memory) {   address poolAddress = address(this);   IERC20Metadata poolMetadata = IERC20Metadata(poolAddress);   return (    poolAddress,    poolMetadata.name(),    poolMetadata.symbol(),    poolMetadata.decimals(),    _balance,    _scale,    _assets   );  } Ok. It seems to work if I don't include the last _assets array I have some pre-deployed solidity contracts to implement. The project is to build a front-end exchange dApp that has token bonding, liquidity pools, LP tokens, and NFT token minting to delegate rewards to users. Would Foundry be a useful tool to use for this project? 💯yes Thx. Any advice on other software packages with getting started? Details don't matter. just the general answer to the question: ""Would Foundry be a useful tool to use for this project"" is ""Yes 💯"" 😊 Got it. I'm a noob and working on something not so different than that: https://caval.re/docs Nice, the one I am working on is pretty much a fork of Olympus DAO For which part? I am using foundry for building / testing the smart contracts. I am using React + Moralis for frontend and Mantine for styling.",497
911,foundry-support.txt,"Foundry+Moralis+React+Mantine = 🔥 That answered my question. I did not want to keep previous chain state. Thank you Well what comes to mind is unit testing, deployment of undeployed contracts, connection with front-end, wallet support Check out Moralis Will do. https://moralis.io Foundry Support TG = 🔥 Moralis Discord = 🔥 I suck at styling web pages so Mantine Discord = 🔥 I'm trying to remember where I saw Foundry show up recently. It was a bit surprising. Maybe in Moralis docs. All helpful! 👌 I'm trying to deploy and interact with a contract as part of a test ... trying to parse through the CLI test code. If anyone has any suggestions, that would be much appreciated 🙏 can you configure anvil via a configuration file? apt-get update && apt-get install -qqy --no-install-recommends \ gcc \ libssl-dev \ build-essential \ dpkg-sig \ libcap-dev \ libc6-dev \ librust-pkg-config-dev \ openssl those are the dependencies foundry needs to build on debian/ubuntu for future reference dont use windows, use nix must be using WSL2 Awesome! Thanks Sam. Should I become a contributoooor and submit a doc PR? 🤓 In what circumstances would I need hardhat to be installed in my foundry project? has anyone had problems with vm.ffi reverting during the ffi call?  ├─ emit STR(str: ""42"")  ├─ [0] VM::ffi([""lala"", ""42""])  │ └─ ← ... this is my ffi call, when it reverts the called program is in my path: $ lala 42 42 what's the error message? no msg: [FAIL.",374
912,foundry-support.txt,"Reason: Revert] test_ffi1() (gas: 7832) Traces: [144] ContractTest::setUp()  └─ ← () [7832] ContractTest::test_ffi1()  ├─ emit STR(str: ""42"")  ├─ [0] VM::ffi([""lala"", ""42""])  │ └─ ← 0x0bc445031644df03923eb2ab981d332f4354ceab11a95efce72a938e57beaadf000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000144f6464206e756d626572206f6620646967697473000000000000000000000000  └─ ← 0x0bc445031644df03923eb2ab981d332f4354ceab11a95efce72a938e57beaadf000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000144f6464206e756d626572206f6620646967697473000000000000000000000000 Test result: FAILED. 1 passed; 1 failed; finished in 2.49ms Hi any reason Foundry cant find an atirfact? forge create src/contracts/Contract.sol:Contract --rpc-url http://localhost:8545 --private-key $PRIVATE_KEY [⠆] Compiling...",354
913,foundry-support.txt,"[⠰] Compiling 10 files with 0.8.15 [⠘] Compiling 120 files with 0.6.12 [⠰] Solc 0.8.15 finished in 2.37s [⠑] Solc 0.6.12 finished in 10.89s Compiler run successful Error: could not find artifact: Contract Did you mean Contract? any way to reproduce this? Not really, I just ran forge create on a init that contains project files, it was working before but now error just popped up Created another forge init, and tried on default Contract.sol forge create ./src/Contract.sol:Contract --rpc-url http://localhost:8545 --private-key $PRIVATE_KEY [⠊] Compiling... No files changed, compilation skipped Error: could not find artifact: Contract the msg.sender in setup and in my test case is different is that expected? thanks for rasing this is fixed here https://github.com/foundry-rs/foundry/pull/2202 does anyone have a github action for using vyper w foundry? we are following https://github.com/0xKitsune/Foundry-Vyper What do you mean by specify which topic to check: Call the cheat code, specifying whether we should check the first, second or third topic, and the log data. Topic 0 is always checked. event (uint indexed data1, uint data2, address contractAddress) Topics are the values that are logged when events are emitted. The first topic is a hash of the event signature, the 2nd, 3rd and 4th are the indexed events. okay so the only ones which are indexed I need to put true right? I think that’s correct. I’m pretty sure you could can usually get away with vm.expectEmit(true,true,true,true) even if you don’t have 3 indexed params, they will just match as both are 0. The only situation I can imagine where you wouldn’t want to check all topics is maybe in fuzzing where don’t necessarily know the inputs, and only want to make assertions about some of the params.",450
914,foundry-support.txt,"Thanks, has the commit been merged already? Found it 👍 https://docs.avax.network/dapps/smart-contracts/using-foundry-with-the-avalanche-c-chain Chad chain Is it possible to sign and send a transaction from a test with a private key in foundry ? Check ""cast send"" Deployed my first dapp to Fuji last night 👍 https://testnet.snowtrace.io/tx/0xb3945fc412f1e2cd80fca62fc9dce59f620c836c6926b848188a6642fa069b49 Yea but from a test (tokens there are mock tokens obviously 😅) because of: https://github.com/nicolasgarcia214/damn-vulnerable-defi-foundry/issues/14 You can use vm.broadcast(address) To impersonate an account in a script and sign it with a private key that corresponds to that address, you supply the private key as ""forge script --private-key"" any help? I managed to make it work but still I don't get it, it is not the address of the deployer nor the address that supposed to be specified in the config file Still experiencing this error forge create src/contracts/Contract.sol:Contract --rpc-url http://localhost:8545 --private-key $PRIVATE_KEY [⠃] Compiling... No files changed, compilation skipped Error: could not find artifact: Contract Understand, it was fixed here https://github.com/foundry-rs/foundry/pull/2202 foundryup -b master Thanks, this pops up Cloning into 'foundry'...",337
915,foundry-support.txt,"fatal: the remote end hung up unexpectedly foundryup: command failed: git clone https://github.com/foundry-rs/foundry Are you on windows? Yes, WSL Uh git shouldn't be failing I am using git version 2.25.1 Fixed issue had anvil running in the background Is that going to work in tests the same way as in scripts ? Tests don't broadcast transactions They're tests! They're local Yeh, that won't work Better to use startPrank in the issue as I answered then, ty sir Btw, where can I ask questions about the foundry core in rust ? Cause I'm kinda lost and would love to contribute in order to grow up my skill with Ferris Apologies these maybe basic questions, my laptop unexpectantly shut down during foundryup -b master process, now I am getting HEAD is now at fcf2f31 fix(create): use cached artifacts correctly (#2202) error: process didn't exit successfully: rustc -vV (exit status: 127) --- stderr /home/ubuntu/.rustup/toolchains/1.59-x86_64-unknown-linux-gnu/bin/rustc: error while loading shared libraries: /home/ubuntu/.rustup/toolchains/1.59-x86_64-unknown-linux-gnu/bin/../lib/libstd-a46a068050a12a4b.so: file too short foundryup: command failed: cargo install --path ./cli --bins --locked --force --root /home/ubuntu/.foundry Try cargo clean Is there a way to change networkId on anvil? error: could not find Cargo.toml in /home/ubuntu or any parent directory reinstall foundry? Chain id or networkid? networkId I forget - maybe not.",365
916,foundry-support.txt,"Curious where is this needed? i know for chain id i can use —chain-id I'm trying to run a GSN Relayer on a forked net with anvil When running it, it says that i cannot run it on a local network with network id that matches a real network So i was thinking if there was a way to change networkId from anvil, if not i'll try to find a solution from the GSN side Should be easy to make a PR for it or track in an issue We can fix okok Got a strange error with vm.expecEmit - >Member ""expectEmit"" not found or not visible after argument-dependent lookup in contract Vm. Are you inheriting from forge-std/Test? yessir OH! I know why, i gave 3 bools as params instead of 4. My bad ! early morning retardation 🙃 Not sure it's a issue in foundry or not? I can not read mapping data from slot. but same code logic works on Remix. attached my code for testing. Any help would be much appreciated. If need to submit a issue let me know. Thanks hey everyone, does anybody knows why is this I know it is a silly question, but I still don't understand why is that. I would appreciate if somebody can help me, thanks How to pass array of struct to cast command?? If you have a struct like: struct MyStruct { uint256 a; bool b; } It should be something like: f((uint256,bool)[]) for the signature, and [(100, true), (200, false)] for the arguments seems like a bug, i would report it on the repo itself.",347
917,foundry-support.txt,"afaik the address should be the same any reason why anvil cannot bind to an ip other than localhost? just going off the error message found in hardhat-anvil ""Anvil network only works with localhost"" that might be outdated, u can set ANVIL_IP_ADDR env var or pass --host <ip> when using anvil not sure what the equivalent is for foundry-hardhat ah gotcha thanks! are there any docs on how coverage works with forge? saw the PR got merged no docs because it is not stable yet check the Cmd-forge-coverage tag, lots of bugs and stuff rewriting some of the core logic to squash a ton of bugs it was merged in a non-stable state so we could test more easily Is there anyone else here using the github action for foundry? (https://github.com/foundry-rs/foundry-toolchain) It seems to have stopped working for me a few days ago - even old actions that passed a week ago don't pass when re-run. It is very peculiar. (https://github.com/foundry-rs/foundry-toolchain/issues/9) Haven't been able to a single pipeline to pass since this weekend (or maybe Friday) when was the last time it passed? i forgot to re-ask (i dont think u answered on that) there's a bunch of repos that use the toolchain action so i'd be surprised if it was broken all around i see thanks!! cant wait to use it confirmed - I think the hardhat-anvil repo might need a real update feel free to open up an issue about it or open a PR 😄 it seems that if you install specific versions of dependencies (branches) and then run forge update, it will always check back out to master. Is this intended? for example: forge install rari-capital/solmate@v7 forge update -> now not in v7 branch anymore im happy to do some testing and report back on the coverage stuff is there anything on how to get started on its unstable version? If i have many contracts in a folder /src how i will do to compile one contract instead of all? yes, forge update pulls the latest ref is there a way to fix it to a specific branch? u essentially just run forge coverage. if it breaks plz check coverage issues first and see if it is covered there, otherwise fine to open up an issue.",490
918,foundry-support.txt,"default report is a simple text summary, a more advanced report is lcov (forge coverage --report lcov). if u have lcov tools installed (depends on ur platform what package its in) u can also use genhtml to get a visual report (admittedly a bit ugly cus its old): forge coverage --report lcov && genhtml lcov.info -o report and then open report/index.html not if u use forge update i think. if that's something u want i'd open up a feature request - if you are using forge update as a means to install deps for a new repo u should use forge install (no args) instead k, will do It stopped working on Friday, I'll make a reproduction on a repo that is public. Will probably learn a lot in the process of making the reprodution too. Thanks for the help! interesting, i don't see anything that would immediately be causing issues 🤔 Hi team, what's the easiest way to check the latest version number of forge I want to compare the currently installed version forge --version gives you something like: forge 0.2.0 (<hash> <date>) the latest version will be the commit hash on the nightly tag: https://github.com/foundry-rs/foundry/tree/nightly so if ur version is up to date as of today, the hash should show f016135 Anyone else experience forge crashing on an under flow ? For unchecked blocked , hardhat / remix would bubble up an arithmetic error , but with forge it seems like the application is SIGKILL’d any way to reproduce this? can you open an issue? AFK now but will open one shortly Is there a way in script to make pause of few min before continuing execution ? In what context would you be using it? Keep in mind that the way script works is that executes everything locally, and then sends all transactions at once but if you still want to do that...",397
919,foundry-support.txt,"maybe with ffi + sleep ? Yeah make sense the idea is for sending a first tx to chainlink oracle for requesting data and then once data fulfilled read the data hmm, then i don't think you can accomplish that with just forge script Cheeers Oliver is there a command for flattening a contract? I feel like I've seen it before, but I'm not finding it now ah, nvm it's in the deploy commands, didn't think to look there forge flatten I am trying to add foundry to a hardhat project and getting this weird error.  error[2333]: DeclarationError: Identifier already declared. --> test/foundry/Foo.t.sol:5:1: | 5 | import ""../../contracts/Foo.sol""; | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Note: The previous declaration is here: --> lib/forge-std/src/console.sol:4:1: | 4 | library console { | ^ (Relevant source part starts here and spans across multiple lines) . Here is what my foundry.toml file looks like: [default] src = 'contracts' out = 'out' libs = ['lib', ""node_modules""] remappings = [  'forge-std/=lib/forge-std/src/',  '@openzeppelin/=lib/openzeppelin-contracts/', ] solc_version = ""0.8.15"" gas_reports = [""*""] cache_path = 'forge-cache' test = 'test/foundry' Playing around with forge fmt and came acros an issue with it removing a set of parenthesis are removed, -- (bool) ++ bool leads to the code not compiling. More specifically: Tests pass, then I run forge fmt $ forge test [⠒] Compiling... [⠢] Compiling 4 files with 0.8.13 [⠆] Solc 0.8.13 finished in 484.03ms Error: Compiler run failed error[6444]: TypeError: The second argument to ""abi.decode"" has to be a tuple of types.",427
920,foundry-support.txt,"--> contracts/UniswapV2Pair.sol:61:62: | 61 |    success && (data.length == 0 || abi.decode(data, bool)), |                ^^^^ error[2271]: TypeError: Operator || not compatible with types bool and tuple() --> contracts/UniswapV2Pair.sol:61:25: | 61 |    success && (data.length == 0 || abi.decode(data, bool)), |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ $ git diff diff --git a/contracts/UniswapV2Pair.sol b/contracts/UniswapV2Pair.sol index 842dd44..23ff6df 100644 --- a/contracts/UniswapV2Pair.sol +++ b/contracts/UniswapV2Pair.sol @@ -58,7 +58,7 @@ contract UniswapV2Pair is IUniswapV2Pair, UniswapV2ERC20 {   (bool success, bytes memory data) =    token.call(abi.encodeWithSelector(SELECTOR, to, value));   require( -   success && (data.length == 0 || abi.decode(data, (bool))), +   success && (data.length == 0 || abi.decode(data, bool)),    'UniswapV2: TRANSFER_FAILED'   );  } I'm failing to understand how bound works  function testMyFFI (uint _multiplicand, uint _multiplier, uint _denominator) public {   _multiplicand = bound(_multiplicand, 2, 4);   _multiplier = bound(_multiplier , 1, 2);   _denominator = bound(_denominator , 1, 2); As per docs, this code should bound the parameters to min, max between 1,2,4 its not ready for usage but the output of my fuzz test shows it is using a massive number for the second parameter: Failed tests: [FAIL.",418
921,foundry-support.txt,"Counterexample: calldata=0xed151d6c0000000000000000000000000000000000000000000000000000000000000000038eaa28d34a11e0354500c41e9d23a179b7d90782ca5460a207dadb5952fcd40000000000000000000000000000000000000000000000000000000000000001, args=[0, 1609005226476514923489971647648345366663991759711686205476992763090296831188, 1]] testMyFFI(uint256,uint256,uint256) (runs: 127, μ: 16528, ~: 16528) nivermind, I realized args gets floored or ceild before continuing i think it's saying that Foo.sol contains (or possibly imports) something named console. does that seem right? for anyone else are newly deployed contracts’ calls fail saying there’s no code there? │ │ └─ ← ()  │ └─ ← 0 bytes of code this is a trace from uniswap v2 flashswap, i think when the v2 pair tries to call my contract’s callback it finds no code there and fails or does this mean something else? Hi, quick question: are cheatcodes working on Anvil? I'd like to be able to experiment with a frontend attached my contracts under arbitrary conditions locally, as I do using cheatcodes when testing the contracts only Any suggestions? Thanks gm frens. I am struggling to write the following test code in foundry. Is there any way to write the vm sign freely? I would be very happy to have a reference code or a demo. https://github.com/paperxyz/sample-ERC721-contract/blob/3726067f15b06ff7ddae15b6129a01bbc210e881/test/index.ts#L88 Anything I am missing to console.log in a test? I did: import ""forge-std/console.sol""; console.log('test text'); In the test run forge test -vvv Why does it not output anything I log? Hey. Is it possible for script contracts ""run()"" function to have parameters.",464
922,foundry-support.txt,"I found that you can pass calldata to --sig flag when calling script, but it fails when I am trying to pass even function selector with ""Function selector not found in the ABI"". Is there any example of it? Hello there, Rust question here ahah How did you manage to compile using forge. Im learning rust and would like to know how did you manage to compile solidity using solc? Cause if there is no install path foundry download the solc binary right? And then using the Ethers lib you compile ? The part is missing for me is the solc version downloading or maybe you have another tricks to compile using the version directly in rust? Thanks by advances and thanks for the amazing work! Forge downloads solc throug ethers.rs which uses svm : https://github.com/roynalnaruto/svm-rs Thanks! Hi, I am testing a function that emits an event and I would like to get the data of the event to use it as input for another function. Is this possible? You won’t be able to do that in solidity as log data once emitted isn’t accessible in contracts. But you can have an event listener in native code and then trigger a tx based on event data it will be once this PR is merged https://github.com/foundry-rs/foundry/pull/2161 🥳 thank you out/... Anyone been able to setup GitHub action for testing vyper with foundry, currently getting an error on GitHub and the code is testing perfectly on my local machine have not tried best guess is ur github workflow does not have vyper installed, it's not something foundry officially supports so any deps for your vyper workflow will not be installed by the foundry github action is there a forge command that outputs all opcodes for a function? are there any public examples of upgradeable contracts built with foundry (and no hardhat)? Hey guys.",390
923,foundry-support.txt,"[⠘] Compiling 2 files with 0.6.12 [⠑] Solc 0.6.12 finished in 519.91ms Compiler run successful The application panicked (crashed). Message: could not convert setGov to function Location: utils/src/lib.rs:264 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets. Aborted Testing a debug on a sol file try `--sig ""setGov()"" ? Anybody encountered forge issue request or response body error: operation timed out ? forge debug --debug src/contracts/access/Governable.sol --sig ""setGov()"" [⠰] Compiling... [⠢] Compiling 2 files with 0.6.12 [⠑] Solc 0.6.12 finished in 642.42ms Compiler run successful The application panicked (crashed). Message: Function signature not found in the ABI Location: cli/src/cmd/forge/script/mod.rs:390 I get the above, also when I run full function with params forge debug --debug src/contracts/access/Governable.sol --sig ""setGov(address _gov)"" [⠢] Compiling... [⠒] Compiling 2 files with 0.6.12 [⠰] Solc 0.6.12 finished in 330.44ms Compiler run successful Error: Invalid data try --sig ""setGov(address)"" ""0x1234...abcd"" need to provide the parameters, see the following explanation and examples https://book.getfoundry.sh/reference/forge/forge-debug.html?highlight=forge%20debug#calls https://book.getfoundry.sh/reference/forge/forge-debug.html?highlight=forge%20debug#examples ""0x1234...abcd"" is that the address the contract is loaded to? Okay, got it understand the logic now, thank you Can we block spam accounts? So this was due to my solc version set to 0.8.9. When I changed it to a different one, it works just fine. There is probably some kind of issue donwloading this version.",483
924,foundry-support.txt,"How can I use forge to submit contract verify to Polygonscan? I have tried many ways but failed, and have to submit the verify manually By the way, thanks very much to make so cool tools. forge & cast is very handy very fast I am wrting a oracle project here:https://github.com/tokenInsight/ti-oracle As polygon has cheap gas fee, so I encounter the verification prolbem. I think foundry should work well on Etherscan. is there a way of running the tests automatically on every file save ? https://book.getfoundry.sh/forge/tests.html?highlight=watch#watch-mode 🙏 Try running foundryup again maybe i should've posted in the ethers-rs tg I would open an issue on foundry it's ethers-rs related so ask in ethers-rs tg plz 🙂 today I wanted to understand how blazing fast Rust compilation is and I built Foundry from source. It took me 50mins! There is something wrong here. running the latest rust compiler can someone help me to understand why it took sooo long that's the compiler version I had the same problem building from source, it has to do with proxy setting of cargo the release target is heavily optimized for static builds (size) try the --local profile rust compilation is not fast its notoriously slow in some cases 😄 but as matthias said, the release profile we use is tuned to build a fast and small binary, which involves some super expensive steps that can take a long time depending on ur machine ok thx, that I will keep for the next time lol - don't want to re-try that one right now 😃 yeah I get that and makes also sense was really surprised tho about this extreme long compilation time depends on ur hardware and a lot of other things so not entirely sure how to help you. i compile release mode from scratch (no cache) in about 2 minutes but my system isnt really average i suppose the nightly job finishes it in 20-30 mins but that is on a slow-ish disk and 2 cores and 4-8 gb of ram I would assume that my ThinkPad X1 Carbon 7th isn't that bad - will re-try on another device (razor) another time.",464
925,foundry-support.txt,"maybe too many processes running in the back as well might be, could also be a slow disk, a slow linker (dont know what platform you are on), thermal throttling, low amount of available ram a bajillion things there are some self-profiling tools for rustc and cargo u can try if u wnt (for science) https://fasterthanli.me/articles/why-is-my-rust-build-so-slow for my system over half the time is spent in link time optimization yeah that's why I don't do too much debugging lol any experience with this: https://github.com/mozilla/sccache no experience but i generally dont use external cache tools locally in ci we use swatinem/rust-cache Hi team, Read through past comments for my error to find this. I have a mock contract that wraps and super's an internal method (which I have read cannot be mocked with mockCall at this time https://github.com/foundry-rs/foundry/issues/432)  /// @notice grant access to the internal reducer function  function reducer(   uint16 _srcChainId,   bytes memory _srcAddress,   Message memory message  ) public {   super._reducer(_srcChainId, _srcAddress, message);  } I am passing a value in message which reverts the function. However if I call ``` vm.expectRevert(bytes(""XChainHub::_reducer:UNRECOGNISED ACTION"")); hubMockReducer.reducer( 1, abi.encodePacked(vaultAddr), hubMockReducer.makeMessage(245) ); ``` The test fails because of a failed expected reversion Am i correct in saying this is because the revert happens too far down the stack (inside the inner function) or what might be going on here? ok - thx in any case for the swift feedback! how far down the revert happens does not matter, not super easy to figure out what's going on because of telegrams format would encourage u to open a discussion on the foundry repo (not an issue) Will do mate Thanks ty, will take a look or i should say: depth matters for where the revert bubbles to. so if you have a revert some x amount of levels deep and you catch the revert with a try/catch then expectRevert won't work.",471
926,foundry-support.txt,"and I'm wondering why is the fail function written the way it is? https://github.com/dapphub/ds-test/blob/9310e879db8ba3ea6d5c6489a579118fd264a3f5/src/test.sol#L65-L76 What is the rationale for failing by storing a flag at the bytes32(""failed"") slot in the HEVM_ADDRESS contract rather than just using revert? https://github.com/dapphub/ds-test/pull/30 I see, thanks I have some test failing . trying to impresonate a whale and transfer some erc20 token but the test faile at the transfer instruction Is there a way to test contracts prior to 0.6.0 with foundry? when does foundry generate abis with solidity versions suffixed? I'm getting an error from MultiAbigen saying ""IUniswapV2Pair.0.6.12"" is not a valid Ident / ""IUniswapV2Pair.0.8.10"" is not a valid Ident I can see these two files in the out folder after forge build is it possible to pass arrays as forge script function args? I'm seeing this as well. Brownie tries to make a request to anvil's debug_traceTransaction endpoint, but anvil gives {'jsonrpc': '2.0', 'id': 41, 'error': {'code': -32602, 'message': 'invalid length 104, expected a (both 0x-prefixed or not) hex string with length of 64'}} Here's what brownie's debug_traceTransaction call looks like: web3.provider.make_request( # type: ignore   ""debug_traceTransaction"",   (str(approve[""transactionHash""]), {""disableStorage"": True}),  ) That was a bug in my python code. I put up an issue with the correct error message: https://github.com/foundry-rs/foundry/issues/2238#issue-1297962329 so currently the rust-toolchain file specifies cargo/rustc 1.59, but foundry does not compile for me on 1.59 because deriving default on enums was only stabilized in 1.62. compiling succeeds if I override to 1.62. the CI seems to override to the latest stable as well.",482
927,foundry-support.txt,"Should the rust-toolchain file be updated? what's the offending code? It's in revm, https://github.com/bluealloy/revm/blob/51f3f8feb5625ca39a16492d569f6985e69121a7/crates/revm/src/db/in_memory_db.rs#L46 ah that's in revm, so we need to bump toolchain then tbh I never use toolchain files yea im usually ok with latest stable gm everyone gm gm The application panicked (crashed). Message: no ABI for contract Location: cli\src\cmd\forge\run.rs:97 building a contract deployer. Get this error ^. Haven't been able to find much information on this error unfortunately. I don't believe its an issue on my contract since I had a similar deployment tested with hardhat. Is there a way to run many scripts at once (eg a --all flag) I think that if you run forge test you will run all tests to clarify, i'm running >forge test --debug testDeployment that's not what my question referred to Can share the entire command you are running that produces the error forge test --debug testDeployment ""testDeployment"" your function name? yep You must include parameters for your function see https://book.getfoundry.sh/reference/forge/forge-debug.html#examples try forge test --debug ""testDeployment()"" same thing, I'm providing params to it oh wait, maybe something that I simply forced as input, but how do I get a contract instance address? forge test --debug ""testDeployment(address)"" ""0x1234...abcd"" or forge test --debug ""testDeployment(bool)"" ""true"" run anvil in another terminal contract DeployTest is Test{ Deployer deployer; function setUp() public { deployer = new Deployer(); } } how do i get the deployer address? address(deployer)? You have to deploy address to test net. Open new terminal and run anvil Then using forge create you create the address forge create src/Contract.sol:ContractWithNoConstructor https://book.getfoundry.sh/reference/forge/forge-create.html?highlight=forege%20create#forge-create @brokewhalee Yep, can verify that it's this ^ https://github.com/HilliamT/foundry-vyper/actions 1.",487
928,foundry-support.txt,"Set a session environmental private key (use one of the keys from anvil) PRIV_KEY=0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 echo $PRIV_KEY 2. forge create src/Contract.sol:Contract --fork-url http://localhost:8545 --private-key $PRIV_KEY Hi there! Excited to work more with foundry. What are some protocol github repos that use foundry? I'd like to check them out just to see more examples to better learn how to use the tool! thank you! I added an example in foundry book. Check it out Hi everyone! I’d like to read values from file in a deploy script, is there a way to do it? I have checked the commit history but can't see it https://github.com/foundry-rs/book/commits/master If you mean this old example here https://book.getfoundry.sh/tutorials/testing-on-a-forked-network.html?highlight=anvil_impersonate#transferring-dai This is exactly what I was doing and did not work as described above However, now I have solved it I was puzzled by the fact in the example there was no need to specify gas while I had to in order to have my TX processed, even though with no effects So I have checked the gas config options in Anvil and tried to use anvil --block-base-fee-per-gas 0 and that worked: I was able to submit TXs without specifying --gas-limit and the TX had effect Is it possible to expect a revert on arithmetic overflows? is there a way to allow console.log in the code run by the fuzzer? it seems that all console logs are filtered Coming back on this, I don't want to alter the code, but now im unnecessarily forking just to have WMATIC existing, how do I deploy a ^0.4 alongside a ^0.8 test codebase? can be multiple files at different versions, but cant have multiple versions in same file, your import would have conflicting versions i suggest you just deploy WETH from solamte at WMATIC’s address ah if you want to do it this way.",468
929,foundry-support.txt,"i believe you can use that cheatcode to compile weth separately without importing, hence won’t cause a incompatible version error, and then the bytecode you got, you deploy that to the address you want you can use etch cheatcode for that Is it possible to override the default number of fuzzer runs in a particular function? I would still like to use 256 globally, but just in one function to lower the number had to use both   bytes memory bytecode = abi.encodePacked(vm.getCode(""WMatic.sol""));   address maticAddress;   assembly {    maticAddress := create(0, add(bytecode, 0x20), mload(bytecode))   }   vm.etch(MUMBAI_MATIC, maticAddress.code); couldnt directly etch bytecode :x Couldn't just pass bytecode as argument to etch instead of address.code? nope, crashed also how do you expect 2 events to be emitted from one contract call? looks to me like the first one is ignored vm.expectEmit(bla); emit Bla(); vm.expectEmit(foo); emit Foo(); MyContract.myCall(); <- only checks foo? @msolomon4 Did you get around to a pr/fix? I'm running into this too, I can create an issue on github if you want It should check bla and then foo I never updated anything in forge-std, what I did was just use forge inspect MyContract storage-layout --pretty to find/hardcode the slot, then manually read/overwrite the value with the load and store cheatcodes Would you recommend I follow that approach as well? All I want to do is update a variable through the contract, and use std Storage read to verify if said update works bytes32 data = stdstore .target(address(registry)) .sig(registry.states.selector) .depth(1) .read_bytes32(); No I think it doesn't i had to split it into 2 expect Emit 😕 vm.expectEmit(bla); emit Bla(); MyContract.myCall(); vm.expectEmit(foo); emit Foo(); MyContract.myCall(); Isn't it fine if you make the exact same calls and check for single events ? As it's deterministic you can use that to read the full slot, but since you have multiple vars in the slot you'll need to manually decode the specific value you want to verify.",486
930,foundry-support.txt,"Balancer has a good library you can reference which shows how they manually encode/decode multiple vars into a single slot which you might find helpful: https://github.com/balancer-labs/balancer-v2-monorepo/blob/master/pkg/solidity-utils/contracts/helpers/WordCodec.sol Thanks for the info, altough it'd make for the cleanest solution this is getting too much trouble for what I'm trying to test. Wouldn't you say that the error from the read is a bug/incomplete feature though? -> Hence I should make an issue Because I don't understand the usage for stdStore->read bytes function if it doesnt work there is an issue here to use the contract's storage layout to automatically detect/handle packed slots: https://github.com/foundry-rs/forge-std/issues/32 once https://github.com/foundry-rs/foundry/issues/2153 is implemented (which I believe @odyslam is currently working on), it will become feasible to implement that Hey folks i want to import a test into another test and assert that the underlying test is not failing. Is that possible? The underlying test uses assertEq() cause i quite like the option to use strings in it as error messages. But when i import it into another test it shows me only the error message without actually failing the test. Is there any way to listen to these asserts and error if they fail? Can the fuzzer fuzz arguments of type string memory? does with_key in stdstore apply to arrays as well? Where does the console log logs to? I have an anvil running and git bash on WSL and its not logging anything does anyone know of a repo that has a deploy script with foundry for upgradable proxies? what is the correct way of checking if a mapping key is not set? manually checkign with a struct gives a stdStorage find(StdStorage): Slot(s) not found error I am trying to impersonate an account on anvil mainnet fork.",407
931,foundry-support.txt,"curl -X POST --data '{""jsonrpc"":""2.0"",""method"":""anvil_impersonateAccount"",""params"":[""'""0xcc531095a68a08c983ec900272d1ea2d4fa07525""'""],""id"":67}' $LOCAL_RPC {""jsonrpc"":""2.0"",""id"":null,""error"":{""code"":-32600,""message"":""Invalid request""}} doing the same thing on hardhat fork works (hardhat_impersonate) that's address as String, try losing the inner quotes I checked with different variations curl -X POST --data '{""jsonrpc"":""2.0"",""method"":""anvil_impersonateAccount"",""params"":[0xcc531095a68a08c983ec900272d1ea2d4fa07525],""id"":67}' $LOCAL_RPC curl -X POST --data '{""jsonrpc"":""2.0"",""method"":""anvil_impersonateAccount"",""params"":[""0xcc531095a68a08c983ec900272d1ea2d4fa07525""],""id"":67}' $LOCAL_RPC both fail is the jsonrpc and id correct here? and checked it after foundryup this is how I am forking mainnet anvil --fork-url $ETH_RPC_URL curl -X POST -H ""Content-Type: application/json"" -d '{""jsonrpc"":""2.0"",""method"": ""anvil_impersonateAccount"", ""params"": [""0xcc531095a68a08c983ec900272d1ea2d4fa07525""],""id"":0}' http://localhost:8545 works for me https://github.com/beskay/UUPS_Proxy/blob/main/src/test/Implementation.t.sol that's all i found so far as well, will have to tackle that this weekend probably it's fine but just suboptimal i would expect the expectEmit to queue against the next op how do you guys debug errors? now I'm in WSL and —debug feeds me the entire stack with just the line it reverts. thanks, this worked.",424
932,foundry-support.txt,"hardhat works without -H parameter so that was the difference Indeed But the other emit is considered as an operation ? Guys, what is a good way to print an address? console.log thx plus -vv Hello folks! First of all, nice job with Foundry! Some engineers I work with highly recommended your toolchain and I can see why! I've been getting some reverts on my contracts running on my anvil node, and I was able to get the binary execution logs (and even byte-code level debugging) by running cast run <FALTY_TX> --debug. Is there a way for me to enrich the debugger with the actual solidity code processing that transaction so I can replay it while stepping over solidity code rather than stepping over bytecode? console.log(address) -vv? no you have to run forge test -vv to get the logs to show thank you samuel Any way to see console.logs when tests pass? Adding -vvvv doesn't show logs -vv? works pretty good Doesn't work for me Maybe because I'm using the fuzzer? That'd result in lots of logs - though I'd be fine with that. i actually think its -vvvvv Nope, didn't work either Not sure what's going on there any idea why i get this warning? warning[5740]: Warning: Unreachable code. --> lib/openzeppelin-contracts/contracts/token/ERC20/ERC20.sol:116:9:  | 116 |   return true;  |   ^^^^^^^^^^ ^ This looks reachable to me:  function transfer(address to, uint256 amount) public virtual override returns (bool) {   address owner = _msgSender();   _transfer(owner, to, amount);   return true;  } https://book.getfoundry.sh/reference/ds-test.html I'm using console.log not DSTest. To reiterate - my interest is in displaying console.log results when a test with fuzzed inputs passes. Looks like it's not possible - but that would be okay, just want to confirm that is it not possible. ye fuzz tests don’t show logs you can use a file cheatcode instead if you want to log inside a fuzz test it will write the inputs to file the rationale being it would absolutely crush the terminal if there are a lot of runs/fuzz tests i.e.",477
933,foundry-support.txt,"every time you run forge test -vvv you would get overloaded with logs in your terminal Gotcha Thanks for explaining I'll do this! Can a test contract have a bytecode size greater than 24kb in Forge? IIRC, there was a way to disable that limit in Solidity Hey all, quick q. When I run yarn test, it compiles the contracts and test contract fine, but I do not see any output for the estimated gas and stuff for each function that was run in the test contract. I have tried `forge test -vvv and moving around the test folder, nothing seems to help. Funny thing is I have an old foundry project for a different contract which runs the tests as expected, but there doesn’t seem to be a diff between tthat project and the one that does not seem to be testting. thanks No, 24kb is standard accross most platforms, try optimizer with low runs see https://book.getfoundry.sh/reference/config.html?highlight=forge%20optimizer#configuration-keys hi any example on use hardhat forge plugin? I have this contract deployed by another contract. I only have the contract address. How can I call one of its functions? IInterface(contractAddress).functionToCall() ? neither that or wrapping address with Contract works~ is there a way to submit pre-signed transactions as part of a forge script? does forge script --slow know to wait for tx receipts when using .call() directly on addresses? it doesn't seem to; i'm making a few low-level call()s that depend on each other in a row and the script only runs one of the calls each time the script is run (--slow or not) Import console2 not console yes What is the error? Hello there, I know that not support for RUST question here. But checking the code and trying to learn more foundry.",381
934,foundry-support.txt,"I would like to know if anyone has an idea why when im trying to compile solidity code using ethers::solc got this weird error about the evm ? Ok(CompilerOutput { errors: [Error { source_location: None, secondary_source_locations: [], type: ""JSONError"", component: ""general"", severity: Error, error_code: None, message: ""Invalid EVM version requested."", formatted_message: Some(""Invalid EVM version requested."") }], sources: {}, contracts: {} }) This function return a Solc object then trying to compile code mycontract.sol for example with the right version of solc (here 0.6.6). But got ""Invalid EVM version requested."" no idea how i suppose to add the evm version inside the Solc object.. if anyone has an idea, will be really glad! foundry test and script contracts do not need to be under the size limit—they are never deployed, so they can be as big as you want (I think it slows down compilation when they get too big though), cc @paulrberg try gas_reports = [""*""] in foundry.toml then forge test -v --gas-report I get different bytecode for the same file locally vs github actions. Should I hardcode the bytecode? (wmatic is pragma ^4.) Can forge custom contracts be deployed to anvil and used to simulate transactions onchain without sending transactions? I mean a contract that has vm.prank() and such methods Hi, I just want to use vm.record() in a hardhat project. Can this be done or do I have to migrate? yes you can within the context of a forge test/ script. you can't use it in the hardhat script So, I have a developed hardhat project with tests written in javascript. I want to use vm.record() for independent tests.",377
935,foundry-support.txt,"How can I achieve this https://twitter.com/fjun99/status/1543813450081505280 Its normal solidity code, so as long as you import forge-std/Test.sol , I dont see why not What version of forge are you using ?Are you deploying to Anvil? Maybe this PR broke something https://github.com/foundry-rs/foundry/pull/2249 What's the difference between using foundry normally in forking mode? If you are running tests that require mainnet state (eg a particular pool on uniswap), then you would need to pass a provider's url in order to copy change state locally. Running it without the URL gives an clean blockchain, which might be useful for unit tests. Forking takes considerably longer though. https://book.getfoundry.sh/forge/forking-mode.html Yeah I know that it was more about understanding what SirPampIt wanted to achieve Hi, everyone. Tryna digest an article on how to test events with Foundry. Could you please tell me what these checks mean? As far as I can understand, they are related to the indexed data that are added to the topics part of the transaction log, right? Hey thanks, ya still no luck. Appreciate the help tho yes, the first 3 bool values correspond to whether the first 3 indexed events must be equal, the last value is for all other data I think ok found the issue, total newb mistake but worth relaying. I needed to prefix each test with the word ‘test’ so for example a function called ‘runTx()’ would need to be ‘testRunTx()’ in a test file for it not to be overlooked. Thanks for help @elyx0. Hope everyone is have good weekend :) Great, exactly what I needed to know.",370
936,foundry-support.txt,"Thanks very much for explaining @msolomon4 any way to get to address from private key with cast? most of the time, when scripting, I already have pk bc I need it to sign transactions, seems like a waste to also have the address which can generated from the pk could be cast --to-address fuck it's there sorry there should be something around cast wallet ye cast wallet address if you're wondering 🙂 Hi all, does anyone know why the gas report for my assembly version of remix's 3_ballot is less efficient according to foundry but more efficient according to remix? In remix, the non assembly version costs 33969 gas vs 32188 gas for the assembly version I noticed that if I repeated the function call multiple times, it returns a different gas cost as compared to when it is only called once. I'm literally just copying and pasting the function call multiple times in the same test function. Any ideas why this is the case? and how I should go about getting an accurate gas cost? Appreciate the help! Using hardhat-preprocessor for foundry compatibility as shown here https://book.getfoundry.sh/config/hardhat.html changes the bytecode every time I recompile with hardhat. Maybe I'm doing something else wrong but asking here in case anyone has any ideas! Hey there! Wanted to ask about `modifier`s in `test`s, and had a thought (maybe wrong one) that the [question suits Eth StackExchange](https://ethereum.stackexchange.com/questions/131505/using-modifiers-in-foundry-test). Share your thoughts, pls (here or there). > Is it a good practice to create modifiers in Foundry tests? > > When testing cases, that share significant number of steps, but not that much that you want to create a separate testContract for them, with its own setUp(). (A simplistic situation could be testing a token contract where tests approve steps for testing allowance, transfer and other cases.) > > I couldn't see any use of modifiers in examples linked by Foundry, so it raised this question: is it ""safe"" (in broad sense), is it a good practice at all? (Absence of ""foundry"" tag is disappointing, btw.",453
937,foundry-support.txt,"""Creating the new tag 'foundry' requires at least 150 reputation."") You can use a shared set up : https://book.getfoundry.sh/forge/writing-tests.html#shared-setups I just try to understand are `modifier`s in testContracts evil somehow, or is it a bad practice? The _shared setups_ approach is highly flexible: can be used in one file, or spread in a tree. Still wondering about _why_ `modifier`s are avoided. =) What about fuzzing? _Shared setups_ looks deterministic as setUp() can't take arguments. Hello, how can I run forge script with specific msg.value? do you mean calling a function with value ? yes contract.function{value: yourValue}(args...) should work thank you.",157
938,foundry-support.txt,"Do I have to do anything special to use anvil with a POA chain (i.e. with BNB chain)? I ask because anvil seems to be ignoring my setStorageAt calls what do your remappings look like? currently edited to: ds-test/=lib/forge-std/lib/ds-test/src/ forge-std/=lib/forge-std/src/ @openzeppelin/=lib/openzeppelin/ whats in your lib/openzeppelin folder? I think the project I am working on uses an different version of oppenzepplin import can you please run ls lib/openzeppelin Any way to disable revert tests from affecting the gas report? you have to filter those tests out yourself using the --match and --no-match options https://book.getfoundry.sh/reference/forge/forge-test.html#test-options solid naming convention helps a lot here, i.e. test_revertingMint(), so you can easily filter out anything with test_revert. similarly for fuzz tests (but not for this use case) and lib/openzeppelin/contracts/access/Ownable.sol exists? yes it does ""@openzeppelin/contracts/math/SafeMath.sol"" too? ser for this one plz consider just using 0.8.x version of solidity how would that resolve the import? ahh it wouldn’t it would remove the unnecessary dependency and get better gas optimizations, etc right u mean instead of using safemath ye I am trying to audit an project using Foundry I mean existing project ah shucks try swapping —etherscan-api-key and —constructor-args (i.e. put the key before constructor-args) @onbjerg don’t we have a tree command? yeah would that help diagnosis what version of forge are you on dont think so, think it just displays import tree so if the import is unresolved it wouldnt know how to proceed i think? I usually set the version of forge to the version of the project using solc-selct '0.7.6' Foundry Support no i mean what is the version of forge itself forge --version Apologies, forge 0.2.0 (dd7c88f 2022-07-08T00:06:14.769137084Z) that was solc strange... should work. platform? Ubuntu WSL hm i assume a way to reproduce would be: 1. be on ubuntu wsl 2.",496
939,foundry-support.txt,"have a project with a file that imports e.g. safemath in openzeppelin 3. have same remappings as you (@openzeppelin/=lib/openzeppelin/) i'll try that to make sure we haven't broken something Yes, that is correct. Most projects do not use Foundry and often case I have to 'git clone' and manually import contracts and resolve dependency errors as they areas quick fix would regex and replace with the relative path when you clone a foundry project instead of doing git clone for the dependencies, you should use forge install oh ye this is incorrect, see bjergs statement Yes, I forge install all dependencies at least openzepplin no i mean like if you run forge install w/o any args it installs all the dependencies for you at the correct versions Thanks let me try this Yo hey, in my test for a contract that accepts eth and other tokens, i can send erc20 on contract but somehow cant send eth to the contract not enough info there, who is sending the eth and who is receiving? Some user sending and contract receives does the ""user"" have any eth? does the contract have a fallback that is payable or a receive() function? or is the function that you call when sending eth payable? Yeah so i can do it manually on remix forge and remix are fundamentally different execution environments you need to fund the user account if it is going to send eth does the ""user"" have any eth? and is it a random address or is it a contract? User have more than enough eth what error are you getting? It just reverts can you post any snippets at all? it sounds like either your contract is not payable or the address you are sending eth from does not have eth the test + the signature of the function you are calling would be enough i think I tried calling a payable function with eth value and tried just to do call on contract Okay sending one sec thank you the balance of address(this) is not the same as the balance of owner - you need to send the address owner some eth before calling.",421
940,foundry-support.txt,"when you call vm.prank then address(this) does not change - it only changes msg.sender in the next call does that make sense? not sure if i explained well 😄 oh i guess i got it trying to make it work now lol oh now i really got it thank you so much, been trying to work this out for the whole day Hi sirs! Is there a way to generate a random address in a test? So you don't have to hardcode something like address(100) for a contract for ex did you tried fuzzing? basically it's enough to declare an address argument for the test and limit it to the values you need e.g. vm.assume(addr != address(0)); That *would* work but we would be running a test many times for something that shouldn't matter 256 runs for different addresses I wanted to ask about IDE... Does everybody just use VS Code, and is there a recommended IDE, or set up? https://github.com/nicolasgarcia214/damn-vulnerable-defi-foundry/blob/master/test/utils/Utilities.sol createUsers(n) Will take a look at it thanks! Thanks Samuel! Worked like a charm Yup i understand. Is there a place where i can read more about this? hi guys just starting with foundry when I test ``` // SPDX-License-Identifier: UNLICENSED pragma solidity ^0.8.13; contract Contract { function addOne(uint256 x) external returns (uint256){ return ++x; } }``` with ``` // SPDX-License-Identifier: UNLICENSED pragma solidity ^0.8.13; import ""ds-test/test.sol""; import ""src/Contract.sol""; contract ContractTest is DSTest { Contract myContract; function setUp() public { myContract = new Contract(); } // function testAddOne(uint256 x) public { // assertEq(x+1, myContract.addOne(x)); // } function testAddOne(uint256 x) public { assertEq(x+1, myContract.addOne(x)); } } ``` I get Running 1 test for test/Contract.t.sol:ContractTest [FAIL. Reason: Arithmetic over/underflow.",442
941,foundry-support.txt,"Counterexample: calldata=0xa76d58f5ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff, args=[115792089237316195423570985008687907853269984665640564039457584007913129639935]] testAddOne(uint256) (runs: 337, μ: 5653, ~: 5653) Test result: FAILED. 0 passed; 1 failed; finished in 20.04ms My understanding was current vers of solidity prevented overflow/underflow Yeah it prevents it by reverting ah ok shldnt the fuzz pass then? No, it'll fail because the test is not expecting a revert.",138
942,foundry-support.txt,"so what ur looking at in that screenshot is the state *before* the staticcall is made, the next few opcodes are in the func u call with staticcall, and after that its some ops to resolve the return value and then ur iszero would be great if we could see the address labels in the debugger screen hey guys I just updated foundry and went back on an old repo and I'm getting a failed to resolve file error so I go checking my remaps in foundry.toml and they're indeed correct, but then I notice that foundry is trying to pick it up from node_modules wtf so I ran forge remappings and this is what I see: @rari-capital/=node_modules/@rari-capital/ @rari-capital/solmate=lib/solmate/src/ it looks like forge is picking up the automatically-generated mode modules remap, because I have only this in my foundry.toml: ""@rari-capital/solmate=lib/solmate/src/"", so what's the best way to support both forge and hardhat dependencies? I use forge for testing and hardhat to deploy my contracts kinda dumb i have to use assembly here makes me want to use hardhat so i have javascript at least 🙁 it's because the remappings clash, so an import like @rari-capital/solmate/foo.sol will be rewritten as node_modules/@rari-capital/solmate/foo.sol and then node_modules/lib/solmate/src/ or something to that effect. i don't think we've seen the case where people use overlapping remapping prefixes to point to entirely different paths actually can i use rust in this situation somehow? that's how solidity works, i don't think shipping a built-in utility for every use case makes a lot of sense. i'm sure there's a library out there to pack/unpack.",379
943,foundry-support.txt,"don't think javascript ships with something like that either :) if u want to use hardhat u can still use anvil as a backend to speed up your testing a bit https://github.com/foundry-rs/hardhat I know, they're clashing, but this didn't happen in the past because (I guess?) foundry wasn't picking up mappings automagically from the node_modules directory, so my question would be is there a way to prevent this or to do what I used to do in the past? well even slicing a bytes32 isnt possible in solidity? have to use assembly >.> no, this behavior has existed for a very long time, we don't have a switch for it but u can open up an issue and request it. i guess the flag would be to discard all automagic remappings hmm this is interesting, I developed this code and deployed the dapp in april and it always worked 🤔 it's entirely solveable in solidity, a lot of contracts use packing :) the only thing changed from back then is the foundry version lol function testLoad() public { bytes32 reserves = 0x62cba2a60000000001322840c91baa223c080000000560b4329177724a587e38; bytes memory temp = new bytes(32); assembly { mstore(add(temp, 32), reserves) } bytes memory r0 = temp[38 : 66]; } “Type bytes memory slice is not implicitly convertible to expected type bytes memory. "" the automatic detection of remappings for node_modules has existed for a long time, i wrote up docs for it back when i started the book in feb or march.",348
944,foundry-support.txt,"possible you were just running an old version for a long time if you want a switch to turn off the behavior pls open up an issue I don't understand the debugger, it litteraly goes in every parts of the code even when it shouldn't it does an exact replay of what the test would have done - it runs the test, records where it has been and replays that a slice is a different type ya how do I slice the bytes32 then? Yeah you're right, I thought that it was going in the if condition but it was just evaluating it this is a solidity question so i would ask in a solidity forum or chat channel, but you can take a look at uniswap's library for it: https://github.com/Uniswap/v3-periphery/blob/main/contracts/libraries/BytesLib.sol ya it’s in assembly ill just use assembly sigh thanks what backend do you think tenderly runs? I don't understand why it call the address(0) even though the variable seems to be correct the assertion in the constructor passes hi guys, i'm trying the unstable coverage command, got this message: could not find anchor: no matching instruction in range MyContract:1255:386:25 is there a way for me to debug this myself? is this an abstract contract? no, inherit by another contract, but the contract itself is not abstract https://github.com/foundry-rs/foundry/issues/2162#issuecomment-1173179716 ohh thanks, seems like an problem cause my function being internal and designed to be used by inheriting contract just get it to run, will comment on the thread! here’s a solidity lib https://github.com/balancer-labs/balancer-v2-monorepo/blob/master/pkg/solidity-utils/contracts/helpers/WordCodec.sol You can consider bit shifting or bitwise operations to extract what you want. Bitwise AND specifically.",391
945,foundry-support.txt,"any idea why I get this error on the debugger? panicked at 'byte index 17300 is out of bounds of `// SPDX-License-Identifier: MIT // OpenZeppelin Contracts v4.4.1 (utils/Strings.sol) Hey! Im just trying to setup a new repo with Foundry but i'm getting an error ""No such file or directory (os error 2)"" when doing ""forge install foundry-rs/forge-std"" There is almost nothing in the repo, i just initialized it with ""forge init testRepo"" btw im running it in the default foundry docker. so i ran docker run -it --rm -v $(pwd):/app -w /app ghcr.io/foundry-rs/foundry sh Is there a way to query historical events during forge scripting? is there any way to read revert string of a transaction without having to replay it using eth_call? forge devs, do you have a proper chat to talk about feature development / needing help in doing stuff, or do you only use PRs ? https://t.me/foundry_rs Thanks sir It's the public group I thought that you may have one dedicated for that I got a very weird bug today; Basically, I have an ERC-721 token sale contract and I wanted to write tests to review both direct interactions and proxy calls with delegatcall(). However, even with the same contract address, the forge test seems to not be calling the same contract storage despite using the same address. You can clearly see on the screenshot the caller minting twice the tokenId 0 and 1 through the same contract, yet it should not be able to. Is delegatecall behaving differently in forge-std ? Therre is a bug open for this Oh didn't see it, glad to see I wasn't alone https://github.com/foundry-rs/foundry/issues/824 hmm..",386
946,foundry-support.txt,"this might be different though as the bug is for prank, I do a startHoax() right before the call So that should be it Anybody already got dis ? doing 10 retries doesn't help Check eth_rpc_url You probably have the wrong network set ? having a hard time using slither on foundry repos especially the remappings have you update slither.config.json per : https://book.getfoundry.sh/config/static-analyzers.html#slither after specifying my remaps, it gets error when compiling forge-std because it got its own remaps etc crytic_compile.platform.exceptions.InvalidCompilation: Invalid solc compilation Error: Source ""ds-test/test.sol"" not found: File not found. --> lib/forge-std/src/Test.sol:5:1: | 5 | import ""ds-test/test.sol""; | ^^^^^^^^^^^^^^^^^^^^^^^^^^ you should be filtering out lib so slither doesnt have to parse it e.g. {  ""filter_paths"": ""lib"",  ""solc_remaps"": [   ""forge-std/=lib/forge-std/src/"",   ""@openzeppelin/=lib/openzeppelin-contracts/"",   ""@rari-capital/solmate/=lib/solmate/"",   ""@uniswap/v2-core/=lib/v2-core/"",   ""@uniswap/v2-periphery/=lib/v2-periphery/"",   ""ERC721A/=lib/ERC721A/""  ] }f you are right about it not parsing the lib, but this is it trying to figure out the imports so it can compile, i dont think there’s any escaping that filter-paths just doesnt analyze the filtered files Just got it work and I ran into the same issue.. turns out i was importing `import ""ds-test/test.sol"";` into one of my main contracts while debugging .",374
947,foundry-support.txt,"maybe thats the case https://github.com/0xdapper/slither-foundry-repro repro with no modification from forge-init It's fine because I've been able to deploy before wth the same rpc i assume there has to be some fix, or is no one using foundry using slither lol you are running slither on the test contract which imports forge-std (https://github.com/0xdapper/slither-foundry-repro/blob/master/test/Contract.t.sol#L4) , which is ignored can you provide the contract address here, and the eth_rpc_url that shows when you do forge verify-contract --help ? ignored how slither src/Contract.sol --print evm --solc-remaps ""forge-std=lib/forge-std/src"" --filter-paths lib --filter-paths lib ; this will ignore the libs directory where forge-std is if you mean filter-paths, even without that it is same error this is the compilation error from crytic because it couldn’t find the said import when compiling forge-std’s contracts that gets used in the test contract and there is no escaping needing to compile forge-std’s contracts since they are imported in our tests. did you get it to work without filter-paths ? Well it worked with forge script e.g. this works slither test/Contract.t.sol --print evm --solc-remaps ""forge-std=lib/forge-std/src ds-test/=lib/forge-std/lib/ds-test/src/“ but writing remaps for yourselves and deps and deps of deps and deps of deps of deps is gonna get out of hands pretty quick can't get slither scanning the test/Contract . not sure why you would care about the static analysis of your tests , but I managed to get the main contracts to compile. Keen to know what the workaround is and rooting for you Hi there, I'm having an issue with expectEmit: I've instantiated the contract I'm testing within setup() in my testContract.t.sol and then created a testFunction() where I'm testing to get an expected emitted event (`Deposit`) using vm.expectEmit(). The event ( Deposit ) is defined in the contract where it should be emitted from. I run into an error: error[9582]: TypeError: Member ""Deposit"" not found or not visible after argument-dependent lookup in type(contract Backstop).",491
948,foundry-support.txt,"I've been wrestling with it for the last hour or so and was wondering if anyone had any pointers please and thanks! 🙂 i dont plan on statically analyzing my tests, but doesn’t matter what contract i choose, its all the same for solidity they mention support for foundry in their latest release, not exactly sure what that entails https://github.com/crytic/slither/releases/tag/0.8.3 anyone from slither in here? https://github.com/crytic/slither/issues/1214 A follow-up to this question that may be more succint: When using expectEmit --> when we define the actual expected emitted event, we can only access said event through an interface, or if the event is within the test contract itself eh? I wonder if that is the issue I am running into. AKA: if I have a test contract using foundry, and I instantiate a realContract in which I expect an event to be emitted from, I cannot test in Foundry for that event unless the realContract is instantiated via an interface? I think I figured it out. Basic solidity stuff for anyone who runs into the same issue. When using expectEmit and defining the actual expected emitted event, one has to define the event within the testContract.t.sol and not try and call it using contractToBeTested.EventName because events are not accessible like public or external functions. Any additional thoughts to this is welcome, but this has my test working now Nope, but you can record logs with the vm.recordLogs and vm.getRecordedLogs cheats You can have a contract with all event definitions and inherit from . it in both code and tests Thanks! I'll have to go through our code-base and play with this, but I think I follow! Is it possible to forge debug really old contracts? Like ^0.4.21. what's the workflow to evaluate that functions will revert? expectRevert() before the call that should revert thanks wrap the entire call? vm.expectRevert(); foo.somefunction(arg1, arg2, arg3); thanks is there a way to test for an emitted event but not outline it's expected returned arguments? When I do gas_reports = [""*""] in foundry.toml & run forge test --gas-report, it outputs reports for a seemingly random subset of my contracts, and the contracts I'm testing aren't even included.",485
949,foundry-support.txt,"Any ideas why? If I specify the list of contracts I care about as instructed in the docs, it doesn't output any report. Ya just do expectEmit(everything false) Hmm I did that but ran into issues, good to know I'm on the right track! Another quick question... sorry been wrestling with my first foundry project all day/evening haha. I realized that the block.timestamp was not rolling forward when I used vm.roll to change the block.number (which was changing properly. Is there a cheat code to change the block.timestamp? It's so I can test a cooldown() function Can you try vm.wrap()? geez lol. Thanks. I swear I have the docs open but I think I've been staring at my code editor too long today Appreciate the quick reply! This TG channel is great! yea I’ve noticed some buggy behavior like this too and haven’t had time to investigate or open an issue. do you mind opening an issue about this? hi, how to use --private-keys params in forge script? i just check the docs, it only provides the --private-key params. but how to specify 2 private-keys Is there a hotkey for the search function in the foundry book? Would make it way slicker than using the mouse 😁 Tools like notion offer a hotkey for this with cmd+p @msolomon4 Regarding the stdStore.read limitation of not supporting tighly packed variables: Im trying to read an array of structs containing only uint256.",309
950,foundry-support.txt,"uint256 isn't a packed variable in my understanding, so where does this come from hi, how do I get the test coverage? forge coverage it doesn't work, I get ""error: Found argument 'coverage' which wasn't expected, or isn't valid in this context"" I have installed ""forge 0.2.0 (116f4c2 2022-06-17T00:14:49.495675Z)"" Which version of forge are you using ? Can you try running foundryup again? This a a June release might predate when coverage dropped yeah I updated and I have the command available now thanks can someone help me with this question? --private-keys A --private-keys B but that requires that you explicitly specify the address when calling broadcast: vm.broadcast(addrA) or vm.startBroadcast(addrB) ""s"" Hi, is prank only working for external calls? Im trying to call an internal function which has a onlyRole modifier, and the prank seems like it's not modifying the msg.sender. Is there a way to modify the current msg.sender ? is this internal function part of the test contract or 'real' contract?? trying to figure out what you're actually calling from where part of the ""real"" contract. Im inheriting from it in my test maybe that's not the correct way to do it? I have this: contract ContractTest is MyContract, Test { function setUp() public virtual { ... } function testMyFunction() public { vm.prank(myaddress); myFunction(10); } } Oh yeah, you shouldn't do that. MyContract should be deployed inside the test contract, not inherited. Either in the setUp() or inside testMyFunction() leading eventually to: vm.prank(address) myContract.myFunction(10); Ok I understand, thanks for your answer. Are there any recommandations on how to handle upgradeable contracts? That contract is supposed to be behind a proxy, and it has an initialize function. What's the best way to test that? In your setup function. https://github.com/akropolisio/vortex/blob/main/src/BasisArb.t.sol#L58-L64 Yes, but my contract has constructor() initializer {}. to avoid leaving the implementation uninitialized, so that doesnt work.",465
951,foundry-support.txt,"I guess I have to deploy a proxy over it in my test is there a cheatcode to deal erc20 token to an address? you can use deal looking at this , it seems to only work for Ether and not tokens: https://github.com/foundry-rs/foundry/blob/3f13a986e69c18ea19ce634fea00f4df6b3666b0/testdata/cheats/Deal.t.sol https://github.com/foundry-rs/foundry/blob/3f13a986e69c18ea19ce634fea00f4df6b3666b0/testdata/cheats/Cheats.sol#L32 there's another one // Set the balance of an account for any ERC20 token // Use the alternative signature to update `totalSupply` function deal(address token, address to, uint256 give) public { deal(token, to, give, false); } Is it possible to broadcast calls to the VM in a foundry script? Is the multi-fork support live? on master now, docs not merged yet: https://github.com/foundry-rs/book/pull/442/files new cheatcodes also not yet in forge-std Great thanks how can i modify the value at a specific storage slot in a contract? but the variable for that slot is private. I'm doing stdstore.target(address(mycontract)).depth(0).checked_write(value) for targeting slot 0, but obviously it doesnt work im not sure how to handle that I see what you mean, you want to unit test the ""implementation"" however you're using proxy pattern. Might be confusing, but you do need to deploy the proxy as well as part of the rest scenario, as it's where your storage will be. ok thanks. that's why I asked another question actually :D im trying to overwrite the initialized variable, but i dont know how to do it. any idea? the problem is that it's private so i dont know what to use to overwrite it with checked_write ok i just figured it out. im supposed to use vm.store() and not stdstorage another question then :) anyone knows a tool where i can easily find the slot number for a specific variable? when there is a lot of inheritance, it's sometimes a bit annoying to compute the slot number and one last question, while i'm at it... (sorry 😁).",493
952,foundry-support.txt,"Even when I make a small modification, everything is recompiled. Is there a way to avoid recompiling all the contracts when running tests? Folks, what would you recommend for fuzzing: Foundry or Echidna? thx in advance Probably an easy question, but why am I getting this error, it's come up sometimes, and then I've managed to get rid of it but haven't understood why: error[9582]: TypeError: Member ""expectEmit"" not found or not visible after argument-dependent lookup in contract Vm. also down to add to FAQs or just write a tweetstorm of quick lessons, mainly picked up through this chat and grinding through my first Foundry project, using Foundry if that is helpful to the community 🙂 I’ve encountered this with some cheat codes , it usually happens when you enter the wrong arguments like trying to log a struct with console. Would be nice to have a --script option with anvil that runs some setup at the start. Currently going through a separate forge script means you can't execute cheat codes `were you able to fix this? Encountering the same error ... Nope there is an issue for it, I’m sure the team will get to it in due time sorry, what was the issue again? wasn't able to find it -.- https://github.com/foundry-rs/foundry/issues/2143 thanks for the repro, will try to debug this shortly how do I catch those slippery arithmetic underflows with foundry? vm.expectRevert doesn't seem to work..",318
953,foundry-support.txt,"Should learn to search, thanks Georgios sorry, where does what come from? either way you are correct that uint256 is not packed but this issue may be related https://github.com/foundry-rs/forge-std/issues/101 Hi, I'm trying to install upgradeable contracts and getting this error when running forge install @openzeppelin/contracts-upgradeable fatal: 'lib' already exists and is not a valid git repo Not sure what I've done here as I've not touched the lib directory What does ls lib give you? forge-std openzeppelin-contracts Ah you need to install using the git url ah let me try that Not like npm Weird error though Thanks that worked Cheers @SamuelDare What threw me was that if I change the install command to something like forge install openzeppelin-contracts/contracts-upgradeable the error indicates that it couldn't find the package. Implying it found *something* the first time around Yeh file a bug should be a “good first time issue” yeah please open an issue for that 🙂 $ forge script script/NFT.s.sol:MyScript --rpc-url $RINKEBY_RPC_URL --private-key $PRIVATE_KEY --broadcast --verify --etherscan-api-key $ETHERSCAN_KEY -vvvv error: The argument '--fork-url <URL>' requires a value but none was supplied USAGE:  forge script [OPTIONS] --etherscan-api-key <KEY> <PATH> [--] [ARGS]... For more information try --help Anybody already got this ? does this exist $RINKEBY_RPC_URL? Yes I have followed the scripting introduction to try it out: https://book.getfoundry.sh/tutorials/solidity-scripting.html Okay I did source .env and it worked, weird cause I have modified it yesterday and started a new terminal since cool is there any way to avoid that? will do Anybody has any experience with .t.sol files triggering re-entrancy guard on contracts? I’m deploying something with deployCode and calling on an interface that points to the returned address, thought it might be weird behavior associated with that hey all, can we fuzz in setUp? This would be similar to running your test in the before hook in the JavaScript ..",462
954,foundry-support.txt,"not sure why you would want to do anything but initialise your tests in the set/up function thank u Does forge have a way of saving deployment artifacts for individual contracts? If not how do most people do it? because its going off by github/ FQDN not npm package namespace How to check if there is duplicated element in an array? in solidity k makes sense thx hey, guys! I'm facing a problem. I need to verify a contract on Mumbai testnet, but Polygonscan doesn't provide an API Key for the testnet, just for the mainnet. I want to deploy it using Foundry, but it asks for an API Key anyways. Do you have any suggestion for me? Thanks 😁 in these cases, they share the API key (the mainnet and testnet) same happens with other networks eg snowtrace-avax/fuji Thanks, Joshie! It worked! Does it take some time to verify? The response was ""OK"" on my terminal, but when I use forge verify-check or take a look at Polygon scan, the contract is still not verified It should be instant, make sure that the constructor args are passed correctly is there a tenderly integration? nope what do you want from tenderly? just being able to upload private contracts In my contract, the constructor arguments are hard coded, so I don't need to pass anything, right? it's basically: constructor() ERC721(""Aura Dogs"", ""WOOF"") { owner = payable(msg.sender); } Ok, I could solve this final issue. As I first deployed the contract using Remix, I went to VS Code to use Foundry, but the import urls from my VS Code contract were slightly different than the ones from Remix, probably that's the reason why it wasn't working. So I deployed a new contract using only VS Code and it worked! Thanks for the help guys :D How do i use a struct within an interface that is inherited in a contract w/ tests? It says its not found 0.o Within the Vm.sol, function expectEmit(bool,bool,bool,bool) external; has 4 args, as expected if one uses 3 indexed args in their emitted event - created an expected log with (bool checkTopic1, bool checkTopic2, bool checkTopic3, bool checkData).",473
955,foundry-support.txt,"How do we handle just 1 or 2 indexed args? Would we just falsey the third bool since there is no third indexed arg (or arg for events with only 2 emitted args)? wtf lol I'd love to know the proper answer to this - I tried researching and using import methods appropriately, at the end of the day, I realized that the terminal was telling me that I could take the struct in as a tuple but I don't know if that's proper Oy, I think I answered the event thing by double-backing to the docs again. So if I have an event with only 1 indexed arg - that ultimately creates a topic, and the second arg is not indexed... then I could set it up like below: event NewMinimumTCAP( address indexed _owner, uint256 _minimumTCAP );  vm.expectEmit(true, false, true, false, true); // OR vm.expectEmit(true,true,true,true); // OR vm.expectEmit(true,true,false,true); // OR vm.expectEmit(true,false,false,false); emit NewMinimumTCAP(address(orchestrator), _minimumTCAP); is there a way to do custom deployment scripts? that would be especially useful for proxy contracts also is there a way to loop over the function/selectors of a contract in a test environment? other than FFI ofc yeah pls read docs on forge script you can do that? is it in solidity? how tf does this make sense but here its fine you need a using X for Y I think? ? Like a library ? hey there folks! [FAIL.",327
956,foundry-support.txt,"Reason: Setup failed: not whitelisted address] setUp() (gas: 0) I'm not sure why I'm getting this error 🤔 this is a solidity error iny our code, youre hitting a revert 🙂 perform forge test —vvv to see the trace I know which functions are failing, proposalc.proposePool(yeti, ""Yeti"", 10000, 1); proposalc.reportPool(1); but I'm able to call them in test functions without a problem agree, its a solidity error in your setup, very hard to guess without the code snippet but sounds like the contract you are calling needs a prank from specific addresS? wild guess tho think I got this one, thanks! it was from an imported contract :) how can we get the quardurant layout? Zoom in Hey everyone, trying to run Anvil via Docker with the below command, which works great except that Anvil seems to miss the chain id parameter: sudo docker run --network host -v $PWD foundry ""anvil --chain-id 6075 --fork-url https://eth-mainnet.alchemyapi.io/v2/snip --fork-block-number 15128715"" Upon starting the console shows Chain ID = 1. Anyone seen this before? oh we haven't cut a release that includes that, was fixed very recently Should have a new docker image in 30m That'll work Lmk then Sweet, will give it a try then, thanks! Hey guys, I am new to Foundry and just setup my VSCode for it. However, I can't go to a definition of a function from another contract. This is the error when I press ""Go To Definition"". Can someone help me? seems it thinks ur root is in /src (not ./src/) but this is a bug in the vscode extension.",378
957,foundry-support.txt,"foundry does not feed any info to the extension at all hey guys trying to fork a mainnet archive node anvil --fork-url $ETH_RPC_URL --fork-block-number 15138916 INT 20:03:31 thread 'main' panicked at 'called Result::unwrap() on an Err value: JsonRpcClientError(ProviderError(JsonRpcError(JsonRpcError { code: -32600, message: ""Params must be an array"", data: None })))', /Users/runner/work/foundry/foundry/anvil/src/config.rs:631:61 note: run with RUST_BACKTRACE=1 environment variable to display a backtrace [1] 90445 abort anvil --fork-url $ETH_RPC_URL --fork-block-number 15138916 what does this mean? if i use a full node it says missing trie node so i assume i need archive git:(main) forge test warning: Implied profile [default] found in lib/solmate/foundry.toml. This notation has been deprecated and may result in the profile not being registered in future versions. Please use [profile.default] instead. ^- getting this annoying warning. any workaround ? update when this is merged ig https://github.com/Rari-Capital/solmate/pull/289 hello frens. there are some missing command in forge. what is the issue? what to do for fix this? https://support.ledger.com/hc/en-us/articles/115005165269?utm_source=ledger_live_desktop&utm_medium=self_referral&utm_content=error_cantopendevice&support=true wget -q -O - https://raw.githubusercontent.com/LedgerHQ/udev-rules/master/add_udev_rules.sh | sudo bash Is there an equivalent --match-contract for forge build? Looks like we can't build just one specific contract (or multiple contracts matched by a specific path) with forge build? Hello, does anybody know if there is a way to test that a new implementation deployment in a Proxy would perform the same as the old one? I am aware that this is kind of tricky but it would be a killer feature for Proxy users to be able to test implemenation against older mainnet blocks veryfing that the contract storage is the same. Thank you Hi! Dont know if theres some recommended way to deploy with scripts, you guys are going so fast 🔥🛠.",495
958,foundry-support.txt,"I want to have a script to Deploy in multiple chains (ideally some mainnet, some testnet, some local-fork and a local anvil). Here's my example, I'd handle the choosen network with --rpc-url flag...does anyone have any Improvement/recommendation? Thanks in advance does the warp cheatcode always go from zero or do multiple warps in the same test function chain onto each other? like I first warp(1000) then warp(1000) again, will block.timestamp be 1000 or 2000? Dear Foundry book writers - atm I too am trying to write a technical manual ( albeit something which will be nonsensical and full or grammatical errors) , I have been trying to deploy the RUSTMDBOOK ( which is sooo awesome btw , loved how the foundry manual works) , on fleek ( trying to be all web3'ish) , and its really problematic to run extra build commands , how did you guyz get the foundry book to work with fleek ? Any advice will be appreciated why not forge version bump? 1000, since vm.warp sets the timestamp to what you give it, but forge-std has a skip helper method you can use which would give 2000 if you do skip(1000); skip(1000) Is it possible to use OZ Upgrades with Foundry? Oh I see, do you know any working solution? Any fren already used deployCode with value ? Or should I use deal and etch ? opened Quick one, does anyone have any tools for signing multisig transactions, when the account is locked by a hardware wallet? I've looked at the gnosis recommendations and we have previously been using Ape Safe and Frame: https://safe.ape.tax/signing.html#frame https://docs.gnosis-safe.io/build/other-tools Wondered how one might go about configuring that with foundry? Hi again! I'm searching the best way to handle private keys, env, etc to use in scripts to deploy...I'm trying to use vm.envXYZ cheatcodes but when I use them I always get ""script failed"" without any other reason.",447
959,foundry-support.txt,"Does anyone know the reason? Thanks in advance! Also I found this from @devanonon (https://github.com/foundry-rs/foundry/pull/2299) and I think this would be really nice combined with the deploy script I sent before ☝️ Hello! Is your latest code somewhere on GitHub? Also, that deriveKey function should already be in the latest forge build if you run foundryup but afaik, deriveKey doesnt allow you to actually deploy anything, not until remember is implemented for hardware wallets you can use --trezor --ledger with --hd-path if necessary Sorry but its a private repo... I've run foundryup and I'm not able to use what you used (vm.derive, vm.deriveKey in fact any vm.envXYZ) dont know why...I must be doing smth wrong. EDIT: also...whats that Solenv.config(); you use? Thanks for your attention it would be great if console logs would be identified correctly and value showed in the traces itself. Right now I have to go up and down through the traces to identify the return values ❤️ Sorry I *have checked the docs and I'm unsure how to use the flags I added —trezor to my script, I'm not sure what The derivation path to use with hardware wallets. means and I am getting the error below: Error: Trezor device not found is the trezor connected? No, let me try that Ah it recognises it now Can you explain what the —hd-flags param does? do you know what is a derivation path? no sir https://wiki.trezor.io/Address_path_(BIP32) brief explanation, from your priv/seed key it allows you to have many keys. key(1), -> 0xA1... key(2) -> 0xB2.. and so on Ah fantastic but you dont need to set one, if you dont have a particular address in mind, you can leave it out Thanks for the explanation and forge will use the default one Hello there, Do you know if there is a way to simulate tx (like tenderly) ? I would like lot of txs and also be fast. I don't want to fork the mainnet then simulate and then refork at the next block it will be too slow. Do you know if there others way to simulate faster a tx? Thanks guys.",495
960,foundry-support.txt,"would be appreciative if someone could give some input I just deployed 5 contracts to mainnet, and was able to verify 4 of them. However the fifth one returns this error Compiler version has to be set in `foundry.toml.",50
961,foundry-support.txt,"Can I use a json keystore for my private key? Yeah, you just use the —keystores flag I think we actually need to pass value like the external call can't pull ETH Hi, can I use a forge contract with some cheatcodes and use this contract in hardhat tests integrating with the other existing hardhat contracts. Is this compatible. I've added foundry to my hardhat project. Not sure how to proceed. Is this compatible. No Hello, when using scripts I have an error in one of the transactions during the first simulation phase. The problem is that I am unable to understand what the problem is as there is no details about the error/revert. How can I debug this? So, we can't do it. Is there any way we can achieve this? Are any of you using hardhat (mocha) for testing alongside forge? How are you deciding what to test with hardhat vs. Forge? js succ use revm I'm getting ""error: The argument '--fork-url <URL>' requires a value but none was supplied"" when trying to run a script to deploy on the Rinkeby testnet, running forge 0.2.0 latest update. Anyone had similar issues? The command I'm running is ""forge script script/Name.s.sol:Deploy --rpc-url $RINKEBY_RPC_URL --private-key $PRIVATE_KEY --broadcast --verify --etherscan-api-key $ETHERSCAN_KEY -vvvv"" Did you set the env var? For RINKEBY_RPC_URL? Yeah, all three are set.",322
962,foundry-support.txt,"I'll double check that they're proper echo $RINKEBY_RPC_URL? Returns empty, but I have it set in an .env file Need to source it source .env That was it, thanks for the help Hey guys I'm new to foundry and enjoying the solidity only testing I'm having issues actually deploying any contracts to a local chain i.e ganache, anvil or hardhat Looking for a little assistance in seeing where I am going wrong tyvm What errors are you getting ? Have you read the section of the book about Anvil? forge create --rpc-url http://127.0.0.1:8545 --private-key (privateKey) src/TokenGenerator.sol:TokenGenerator with priv key being the copy pasted account[0] from the local chains yeah dude i have ProviderError(JsonRpcError(JsonRpcError { code: -32603, message: ""EVM error CreateContractLimit"", data: None })) Your contracts might be too large had an array of error messages broken them all down to eventually just this one is returning lol hmmmm I’m not sure if forge has a contract size utility check on remix if they compile Hmm.. but if they are too big then they should compile for your tests either forge build --sizes legend! needing to trim 1.8kb lol whats the optimisations flag for foundry? exactly that i suppose? --optimizer-runs [number]? Any idea? yea What's the proper way of abi encoding a constructor with multiple arrays as parameters? I have absolutely no idea why vm.getCode that is inside deployCode reverts. There is no clue :( If there is no obvious reason I will need to dig the code what are these declarations error MintPriceNotPaid(); error MaxSupply(); error NonExistentTokenURI(); error WithdrawTransfer(); Havent seen that in solidity code ? Custom errors Hey, are mockCalls cleared for every test automatically? Yeah isolated across tests hey @paulrberg thanks for the new library! Hey guys, I have a ERC1967Proxy behind an implementation contract that extends open zeppelins UUPSUpgradeable. Just wondering what's the best approach. I could execute all my transactions through the proxy, but the downside is losing the type safety and need to abi.encode each function call. Alternative would be I guess to just deploy the implementation contract and change the initializer storage variable.",485
963,foundry-support.txt,"Do you know of any other approach/good libraries which handle this case? Glad you like it - very much looking to further developing it, feel free to open discussions for feature requests and any sort of suggestions https://github.com/paulrberg/prb-test/discussions/new I've already created a few discussions for some features I might implement someday - https://github.com/paulrberg/prb-test/discussions/2 - https://github.com/paulrberg/prb-test/discussions/4 Hi, is it possible to see Solidity Logs in Anvil using a verbosity flag like in forge test -vvvvv ? I'll get started on it today, will keep you posted Solved it, dumb of me, I can just deploy the implementation, initialize through the proxy and use the type of the implementation/logic contract! I have contract in which I am using pancakeswap router address but setUp() is failing? Any specific reason like I can't test BSC addresses?? or something else Can you post your set up code here ? MyCryptoProject myCryptoProject;  function setUp() external {  myCryptoProject = new MyCryptoProject();  }  function testName() public {   string memory name = myCryptoProject.name();   assertEq(name, ""MyCryptoProject"");  } The error: ERROR forge::runner: setUp failed reason=""Revert"" contract=0xb4c79dab8f259c7aee6e5b2aa729821864227e84 [FAIL.",310
964,foundry-support.txt,"Reason: Setup failed: Revert] setUp() (gas: 0) Traces: [673142] MyCryptoProjectTest::setUp()  ├─ [637230] → new <Unknown>@""0xce71…c246""  │ ├─ emit OwnershipTransferred(previousOwner: 0x0000000000000000000000000000000000000000, newOwner: MyCryptoProjectTest: [0xb4c79dab8f259c7aee6e5b2aa729821864227e84])  │ ├─ [0] 0x9ac6…e5c3::c45a0155() [staticcall]  │ │ └─ ← ()  │ └─ ← 0 bytes of code  └─ ← () this is the router address of pancakeswap: IUniswapV2Router02 _uniswapV2Router = IUniswapV2Router02(0x9Ac64Cc6e4415144C455BD8E4837Fea55603e5c3); It's a safemoon fork btw Does your contract require some arguments passed into the constructor ? no. not through parameters. because even hardhat is having trouble initalize? without seeing your code its hard to tell but if both hardhat and foundry are having issues, I suspect it might be something to do with how you are deploying it I was using a path, was attending a contract name :/ Maybe that could be a good option for a new cheatcode, but as we cannot send value from the test contract we must remove ETH from sender and then add it internally ? Or maybe that function only could be external Okay. So I was googling about it. There might be some issue with mainnet testnet addresses. But as safemoon is BSC address not sure if it can work with those addresses as foundry support ethereum only ig till now Found this: https://github.com/dapphub/ds-test/blob/master/src/test.sol for equality matchers except for notEqual - what is typically used there? what are you looking for? btw Paul just dropped this https://github.com/paulrberg/prb-test assertNotEq() is what I'm looking for.",470
965,foundry-support.txt,"It's not in the default ds-test I think but I could definitely be wrong it's in that link you shared though, so I guess I could import this submodule into our foundry setup? Right now I have this as a workaround for assertNotEq() assertEq(var1 != var2, true); i haven't tried it, but looks promising 🤣 sweet, thanks! I'll try that later 😄 How do we go about testing for two emitted events within one tx? Tried this kind of syntax but it's not liking it   vm.expectEmit(false, false, false, true);   emit Event1(Arg1);   vm.expectEmit(false, false, false, true);   emit Event2(Arg1, Arg2, Arg3);   contract.tx(); nvm think I figured it out. Gotta double check this but event logs only can have max three indexed args (topics) regardless of how many emitted events there are.",195
966,foundry-support.txt,"So when dealing with a tx that emits two events, we write: vm.expectEmit(false, false, false, true); emit Event1(Arg1); emit Event2(Arg1, Arg2, Arg3); contract.tx(); where there can only be max three topics from Event1 and Event2 How can we have an explicit error message about the specific kind of revert in scripts? Right now I have an error/revert in the first phase(simulation) of the script but there is no explicit error message for tests is there any equivalent to beforeAll? setUp is more like beforeEach right? not that im aware, you can use your own helper method to run on each test ye I want it to run only once for all tests so that values are cached since it's an FFI call ah, had it backwards, i wonder if there's persistance across tests run that can be used for this? not aware if test contract is deployed on each test run if it wasnt you can cache in setup the value and getOR type of method in each tests but i may be completely off on how the runner works gm there everyone how can I import hardhat's console.sol? import ""forge-std/console.sol"" when using cast src <contractaddress> with etherscan_api_key set I get Contract source code not verified , also when i try to open this contract with deth.net or use a scrapper , i get error - Contract source code not verified: 0x1111..., is this a problem with the code not being verified ? yoooo i just discovered rpc_endpoints in the docs! dummy qs: - does this work w/ cast? - how do you specify which network to use? like this is a replacement for --rpc-url? 1) no 2) u use the new cheatcodes https://book.getfoundry.sh/cheatcodes/forking ohhh sweet tysm! also trying to solve for having to set up my rpc urls alll the time when doing quick throwaway cast scripting - should I just set them up as normal env vars in like…~/foundry.toml? [profiles.goerli] etc for cast u can only set ETH_RPC_URL, it does not read the config file for rpc urls ohhhh ok! the docs mention you can use the flag --hh for hardhat support, but they don't specify which command should be passed this flag.",491
967,foundry-support.txt,"is it forge init? not sure if it works for init, but it works for forge build and forge test. most likely you'll want to just configure foundry.toml by setting the paths (src, out and libs) This is probably very simple but I cant figure it out - I am testing an event and getting failing test on logs not matching.  address deployedVault;  vm.expectEmit(false, false, false, true, address(vaultsV1Factory));  emit VaultV1Deployed(deployedVault);  deployedVault = vaultsV1Factory.deployVaultV1(  vaultParams,  1,  true,  address(0x1111),  ""someCID"",  swapTokenAddresses,  address(0x2222),  1  ); I know the issue is that when then event it emitted deployedVault is address(0). Is there a way to wait for foundry to check the event log until after deployedVault has been assigned? what's the deal with the syntax for passing file names AND contract names like forge script script/Purchase.sol:Purchase? seems like it just needs the path - what am I missing?( you can use vm.getLogs() check the book if you just give a name, e.g. ""Token"" then that contract might be defined in multiple files. similarly one file might contain multiple contracts, so sometimes you need both :) thank you!!! thank you! Using forge test --ffi -vv in Git Workflow results in Failed to resolve file: ""<file-path>"": No such file or directory (os error 2). where the file path includes a duplicated directory. Any ideas for fix? Is there a way to use forking mode with only cached data offline? I have a project I'm working out and don't have internet access so I was hoping I could just use the cached info Also, how can I setup the vscode solidity language server to use the downloaded forge solidity compiler for offline use? I guess the question is where is solc located maybe server the directory via netcat Hi Steve, yes indeed PRBTest has support for assertNotEq, and then some. seeing that many other scrapers also are unable to download an unverified contract, i guess no point worrying about why cast doesnt do it as well.",471
968,foundry-support.txt,"Anyway if someone knows why this is the case for unverified contracts, I would be keen to read that Hi, what's the recommended way to use Solidity versions pre 0.5 with Forge? svm-rs's list of builds don't contain 0.4.24 https://github.com/roynalnaruto/svm-rs/tree/master/list I would open an issue on the repo , or better still submit a PR with the updates to include those solc versions on second thoughts , this json contains the old images , the author might have a good reason for sunsetting them: https://github.com/roynalnaruto/svm-rs/blob/master/list/linux-arm64-old.json Looking here: https://github.com/roynalnaruto/svm-rs/blob/master/src/releases.rs#L22-L25 and here: https://github.com/roynalnaruto/svm-rs/blob/master/src/releases.rs#L216-L242 The 0..4.* version would only compile for AMD I see, thanks. also found that that repo points to nikitastupin/solc, where there's an issue indicating that people had trouble compiling 0.4.x versions https://github.com/nikitastupin/solc/issues/5 I have this annoying issue with the imports, in the remappings.txt I have defined the mapping for the lib's I am using in the project. openzeppelin-contracts/=lib/openzeppelin-contracts/ For some reason, my ide (webStorm) occasionally replaces the imported contracts from open zeppelin from this: import ""openzeppelin-contracts/contracts/utils/structs/EnumerableSet.sol""; To this: import ""lib/openzeppelin-contracts/contracts/utils/structs/EnumerableSet.sol""; It's probably an IDE issue, but has anyone experienced anything similar? did you try doing import ""@openzeppelin-contracts/...""? Yes of course I am writing the imports like that: import ""openzeppelin-contracts"". I was compiling the contracts with both hardhat/foundry (I use both in my repo). And it magically appends lib to all my imports after a random time. I suspect it has something with compiling the contracts with hardhat, but I am unable to pinpoint when it happens.",472
969,foundry-support.txt,"using this template: https://github.com/foundry-rs/hardhat-foundry-template Have experienced the same issue What's the minimum Solidity version supported by Forge? i believe 0.4.x but not sure how low in the 4s Thanks Based on this I think it might be 0.5.x. https://t.me/foundry_support/18210 hmmm i believe i tested ds-test in forge with 0.4 Thanks probably reading the code wrong It would be still be good to know the exact minimum supported version, if anyone happens to know it - thank you! it’s managed by svm-rs. it looks like minimum supported is 0.4.0 but it’s labeled as “old” so some platforms may not be supported 0.4.0-0.4.9 look to be somewhat supported, but primarily 0.5+ not exactly sure why 0.4.10-24 aren’t? hey folks, does anyone know of a tool to generate interfaces from contracts? either cli or copy paste contract Sounds like a forge subcommand begging to be built 👀 oh wait seems like there's a command already XD ye cast interface i believe ohhh but it requires an abi i believe you can pass an address and an etherscan api key but i could be wrong i also thought u could pass the contract path/name but again i could be wrong i think there is a way to do it cc @msolomon4 ❤️ thanks thank you for the awesome tool it really makes you think in solidity which is awesome, learned a lot in the past few weeks I'm running into a bug where the deployer address of my contracts in Tests changes from 0xb4c...7e84, to the address of the test contract. Interestingly, this change happens on introducing a single line RoleGranted is assigned to msg.sender, which in this case is the address of my test contract (StateDeployWandTest). However, if I remove some lines from my code, it reverts back to the expected test deployer address of 0xb4c79daB8f259C7Aee6E5b2Aa729821864227e84 The only line I am changing is the fyToken creation.",465
970,foundry-support.txt,"hey team, how do we tell if foundry is on Revm or Sputnik? also, does anyone know why does cast call return hex instead of decimal for array return type? $ cast call $CONTRACT \ --rpc-url $RPC \ ""returnsListOfUint(uint)(uint[])"" ""1"" [6553f100,59682f00] but when i include the return type times the length of expect result, i get 32, 4 $ cast call $CONTRACT \ --rpc-url $RPC \ ""returnsListOfUint(uint)(uint,uint)"" ""1"" 32 4 only when i do return type times the length of expect result + 2, i get the correct result. $ cast call $CONTRACT \ --rpc-url $RPC \ ""returnsListOfUint(uint)(uint,uint,uint,uint)"" ""1"" 32 4 1700000000 1500000000 what do 32 and 4 mean? you sure it's 4 and not 2? check out how solidity encode parameters and dynamic sized variables https://docs.soliditylang.org/en/v0.8.15/abi-spec.html#formal-specification-of-the-encoding https://medium.com/coinmonks/abi-encode-and-decode-using-solidity-2d372a03e110 Hello all, I'm running into the following error on deploy. Has anyone else run into same? Error: ProviderError(JsonRpcError(JsonRpcError { code: -32000, message: ""transaction underpriced"", data: None })) ahhh you're right. i copied the wrong output for that.",334
971,foundry-support.txt,"thank you so much 🙂 did u try adding more gas? Its all revm it was changed like 4 months ago blue alloy maybe because of hisenbug https://github.com/foundry-rs/foundry/issues/1046 OZ earliest relevant pkg is 2.5.1 , which is ^0.5.0 the only large project that uses pre ^0.5.0 is Lido and they use ^0.4.24/26 (that i know of) It worked when I tried —legacy (polygon mainnet) you didnt set the req --priority-gas-price (which is Max priority fee per gas ) then thats why legacy worked fml hi, is there any cheat code that allows me to get the current address from where transactions and deployments are sent? hey there everyone! how can I test for require(tx.origin == msg.sender) using forge? seems like every call isn't made by the msg.sender no matter what. is there a way to not do regex test match function testA() public {} function testAb() public {} function testAbc() public {} function testAbcd() public {} forge test -vvv --match testA how do how i only match testA not the other 3? —match ‘testA$’ like any regex ah thanks, thought there's another command im missing out 🙂 @vinzon yea for local contracts you can do cast interface ./out/MyContract.sol/MyContract.json and for deployed contracts it's cast interface <address> [options] does it autogenerates an abi? cast interface ./src/core/Executor.sol/Executor.json Error: No Etherscan API Key is set. Consider using the ETHERSCAN_API_KEY env var, or setting the -e CLI argument or etherscan-api-key in foundry.toml humm oh maybe we always require an etherscan api key? I thought there was a default (rate-limited) one provided by cast/forge but maybe I'm misremembering etherscan API keys are free so you can create one and set it.",426
972,foundry-support.txt,"personally I define mine in ~/.zshrc so it's always available without needing to pass a CLI flag Has anyone else encountered ""CompilerError: Stack too deep when compiling inline assembly: Variable headStart is 1 slot(s) too deep inside the stack"" when running forge coverage ? I found some stuff online but it seemed hh related thanks! anyone else running into ""Etherscan could not detect the deployment."" error why trying to verify with forge script? seems to be an issue with block pending transaction . does your transaction already complete on etherscan ? oh weird. it was stalling before but now it's working and waits for the result Etherscan has brownouts occasionally still having this issue, can't verify with forge verify-contract either are there any known issues with verifying contracts that deploy contracts themselves? How can I avoid recompiling my contracts everytime I run a command? I noticed that even if I dont modify any code, if i run forge test 2 times in a row, it's going to recompile all my contracts and takes a long time (about 30 seconds). Can this be avoided? that should not be the case, please open up an issue with a reproduction are you on windows by any chance on a mac forge version? forge 0.2.0 pls include the full version forge 0.2.0 (16b4ef6 2022-07-13T00:07:48.15944649Z) seems ok, u should open up an issue with steps to reproduce. dont have this issue on my mac or on linux thanks, i'll do that what version of osx What XCode version do you have installed ? actually i didnt specify, im running all my commands in a docker container on my mac. but there shouldnt be any difference as im running all commands inside the container, not recreating the docker everytime xcode doesnt matter are the out and cache directories present in your docker container? yes, both of them it doesnt matter since its a container yes What storage engine did you enable to mount the container ? how can I deploy a contract with a different solidity pragma from within a script? I remember seeing something about this in the docs but can't locate it now. I can't even import this other file right now.",466
973,foundry-support.txt,"solc-select install <version>, and solc-select use <version> but install solc first if you do not have it $sudo apt-get install solc or follow install instructions from crytic repo gm! Regarding contract verification...when I try to verify deployed contracts in the same cmd I use to run script which deploys the contract (using flag) it makes some tries and finally errors with ""Etherscan could not detect the deployment."", I guess its just because of Goerli delay... But theres another case I think is not supported...if I have a script to call a contract which is a Factory and it deploys a contract, adding --verify doesnt have any effect as it doesnt even try to verify. Is there any way to get this kind of verification? Thanks in advance EDIT: trying with forge verify-contract results in ""Fail - Unable to verify"" please open an issue with a repro! deployCode no sure what you mean. just a basic volume with -v why does the compilation fails? Sounds like old version how to update ? forge update? foundryup still getting this same error what solidity version what is your forge --version? (please check pinned) done https://github.com/foundry-rs/foundry/issues/2361 okay it worked now my foundry was of older version does foundry support read storage slot from variable name? nope, just by storage slot How can we know the slot number of private variable? thats deprecated whats the entire command your running? what? did not know that. where did you see that? here is the command: docker run -it --rm -v $(pwd):/app -w /app <myimage> rm removes the container docker run -it --mount ""type=bind,source=$(pwd)/source_dir,target=/app/target_dir"" img_name sh Any idea why I get ""thread 'tokio-runtime-worker' panicked at 'overflow when subtracting duration from instant', library/std/src/time.rs:424:33 note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace"" When running ""anvil"" anvil version: 0.1.0 (44f3a4b 2022-07-18T00:09:43.363129Z) yes i know, i don't need it to keep running once i quit. i just want to open it, run my tests and thats it.",499
974,foundry-support.txt,"i dont think i need mount. A volume is doing all i need currently since i can read/write into my current directory from the docker couldnt find a solution for that. I've been using vm.record() and then calling public variables to see which slot is used. For private variable, i just manually find the closest public var and then count from that (yes i know, it's terrible) here is a sample code: vm.record(); mycontract.name(); (bytes32[] memory reads, ) = vm.accesses(address(mycontract)); console.log(""slot `name`: "", uint256(reads[0])); you are mounting it already thats what volume does Yes i know. I meant I don't need the mount option. volume is fine If I can’t even import it does that work for me? It's from forge-std! what's a good way to test libraries with forge? if you have slither you can use slither-read-storage: $slither-read-storage usage: To retrieve a single variable's value:   slither-read-storage $TARGET address --variable-name $NAME To retrieve a contract's storage layout:   slither-read-storage $TARGET address --contract-name $NAME --layout To retrieve a contract's storage layout and values:   slither-read-storage $TARGET address --contract-name $NAME --layout --values TARGET can be a contract address or project directory slither-read-storage: error: the following arguments are required: contract_source I can’t import my contracts that have a different pragma. It won’t compile I am doing this last = uint64(block.timestamp) - _frequency; last is uint64 and _frequency is also uint64 Forge says arithmetic underflow What should I do On forked environment mainnet I think forge is considering block.timestamp 's values that are greater than uint64 How to limit the block.timestamp values for testing double check your endpoint, since this one is apparently not valid am i going crazy or should cast calldata ""propose(address[],uint256[],string[],bytes[],string)"" \[0x0000000000000000000000000000000000000000\] \[0\] \[""""\] \[0x\] """" not return the same output as abi.encodeWithSignature(""propose(address[],uint256[],string[],bytes[],string)"", targets, values, signatures, calldatas, """") where in the solidity case each array is initialized with length 1 e.g.",500
975,foundry-support.txt,new address[](1) in fact i can't figure out any combination of single quotes/double quotes/0x/etc.,25
976,foundry-support.txt,"How can I know what revert was raised? maybe try running it with -vvvv I already run it like that It is just that in the output there is no revert message Hi I tried to test by forking mode with --fork-url and --fork-block-number options, but i couldn't do caching. i added --no-storage-caching option, i could do caching. Is it opposite, isn't it? forge test -vv --fork-url https://mainnet.infura.io/v3/${INFURA_KEY} --fork-block-number 15100757 --no-storage-caching Guys, how do u use coverage in foundry? forge coverage Coverage is still pre release and has some know bug (eg abstract contracts don’t work etc) search on GitHub to track the issue Or ctrl F in this chat Ok, thx) do I not need to import? hm for cast, when calling a function taking a struct as an argument, how do I encode that? does the selector look like func((uint256,uint256)) ? yeh its tupled cast send <address> ""func((arg1, arg2, arg3...))"" ""(arg1,arg2,arg3...)"" did forge stop caching forked requests? where are the forked requests stored? i think it may have been ~/.foundry/cache/<chain>/<block> for any new forked tests i run, i do not see those folders created anymore How to mute the docstring parsing error? It says tag @author not valid for contracts Lol there was indeed a bug, sorry about that fixed here https://github.com/foundry-rs/foundry/pull/2385 yeh this was indeed flipped, lol oh wait nvm - deleted the question cause I think I figured it out Hey, im keep getting this error when i try to deploy on polygon mainnet Error: ProviderError(JsonRpcError(JsonRpcError { code: -32000, message: ""transaction underpriced"", data: None })) do you have any idea what might cause this Maybe your gas limit is too low ？ Mm okay letme try that this keeps happening on polygon/mumbai: https://github.com/foundry-rs/foundry/issues/1703 sending as legacy is apparently a workaround Thank you so much for this🙏🏻 🙌🏽🙌🏽🙌🏽 thanks for sharing this solution.",497
977,foundry-support.txt,"I was manually stepping up the gas price and probably overpaid for contract creation in the end My function call reverts with a custom message: ""ERC20: transfer amount exceeds balance"". After I place a vm.expectRevert(bytes(""ERC20: transfer amount exceeds balance"")); above that call I am getting [FAIL. Reason: Call did not revert as expected]. I read in the comments above that someone had a similar issue and the solution was to update foundry. Did that with foundryup but the issue persists. you need to pass the error message as a string , or its its a custom error , ErrorName.selector Hi Team I am getting this error when I run forge build Error: Compiler run failed CompilerError: Stack too deep when compiling inline assembly: Variable dataEnd is 2 slot(s) too deep inside the stack. The contract repo is too big. How do I know which contract is causing this issue? this isnt a forge error but a solidity one. You most likely have a function with more than 16 local variables ..https://soliditydeveloper.com/stacktoodeep Yeah, it is solidity error. But the forge build command doesn’t print the stacktrace, nor does indicate which file is causing this. Note: There are more than 150 contracts in the repository I am doing that with vm.expectRevert(bytes(""ERC20: transfer amount exceeds balance"")); change this to : vm.expectRevert(""ERC20: transfer amount exceeds balance"") Does any one know of any good example test for proxy contracts. New to testing in Foundry, I found this already https://github.com/odyslam/foundry-upgrades ctrl + f in the chat Changed it but the same error persists [FAIL. Reason: Call did not revert as expected] is this being tracked in the github somewhere? I could have sworn this fixed it for me , but leaving it for someone that wont confuse you Another question, after updating forge to the latest version (forge 0.2.0 (114413c 2022-07-19T00:10:05.054704Z)) with foundryup command things are really slow. A couple of tests which usually took a couple of seconds to run now take around 25 seconds. I tried deleting cache and out directories, doesn't work. I am using the same setup as before (mainnet fork with specified block number) but stuff is super slow.",493
978,foundry-support.txt,"I have a simple view function that should revert if I send in an address that is not register function getVault(address _vaultAddress) external view returns (VaultMetadata memory) {  require(vaults[_vaultAddress].vaultAddress != address(0), ""vault address not registered"");  return vaults[_vaultAddress]; } However when I test the revert, I am getting a failure that it reverts without reason but if I remove the reason for the revert I get a failure that it reverts with reason ""vault address not registered"" not quite sure what is going on  function test__view__getVaultAddressNotRegisteredReverts() public {  address deployedVault = helper__deployThroughFactory(true);  address notVault = address(0x7777);  assertTrue(notVault != deployedVault);  vm.expectRevert(""vault address not registered"");  vaultRegistry.getVault(notVault); } @gakonst Wanna open an issue with a repro? somehow I cant reproduce my local bytecode anywhere else (remix and etherscan) I checked cache/ folder and can confirm I'm inputting exactly the same compiler params this is a contract deployment that failed to verify when using script+broadcast and im trying to manually verify the contract has no constructor arguments compiled using --via-ir is via-ir supported for contract verification? how does expectEmit work? does only the order matter, or exact order matters? i imagine there can be side effects and logs from interacted contracts and we may not want our assertions to fail because of them hey whats up yall. are there any good examples of testing a MerkleProof is valid using foundry? thinking specifically of a mint function that requires a proof be validated https://github.com/dmfxyz/murky is a good lib for this Hi, this file https://github.com/ditto-lab/ditto/blob/main/src/DittoMachine.sol is failing on forge fmt with the error: Error: Failed to construct valid Solidity code for src/DittoMachine.sol. Leaving source unchanged.",416
979,foundry-support.txt,"Debug info: [Diagnostic { loc: File(0, 4555, 4559), level: Error, ty: ParserError, message: ""unrecognised token 'name', expected \"")\"", \"",\"", \""]\"""", notes: [] }] but the contract compiles and runs Hey, I have problem with anvil_impersonateAccount I run it, but I see error- HH103: Account 0x1...... is not managed by the node you are connected to The test works fine with hardhat Hey! is there a way to run contract with forge locally? If I want to have a front-end communicating with local “fork” is it possible to do with foundry? Anvil Thank you! Hey Everyone! I have two question regarding forge solidity scripts: 1. Is it possible at all to read logs / events from a previous instruction (within the same script), to then use that as input in subsequent steps of the script ? 2. Is there a way to wait for previous transactions in the script to be included / mined before proceeding with later instructions ? (within one script) I didn't find a way to do either of those so I assume the anwer is no in both cases, but maybe I'm missing something. The closest thing I found for question 1 is vm.expectEmit but that assumes I have expected values for the log topics and just want to check agains that assumption, which is not the case here. 3. Also is there a way to run state changing methods as static call so they don't change state ? (Even methods run without broadcast seem to alter the simulated state inside my script, which I'd like to avoid) could you explain 3 more? Basically I want to execute a non-view method as if it was a view, so that I can get the return value without affecting the state of the contract. In javascript with ethers.js you can do that by using contract.callStatic.METHOD_NAME (See here: https://docs.ethers.io/v5/api/contract/contract/). In solidity there are work arounds by throwing a revert and returning data in the revert code (see here: https://ethereum.stackexchange.com/a/118341/73805) but I thought there might be a cleaner abstraction built into foundry / forge.",472
980,foundry-support.txt,"I'm aware that if I don't broadcast a call in my script that it wont be actually executed in a transaction but it still affects the state of the respective contract for the rest of my script. (which is what I want to avoid) omg there is no guarantee of consecutive transactions being in block to blocks the only way to do tthat is via a block reorg https://github.com/foundry-rs/foundry/issues/2406 err https://github.com/foundry-rs/foundry/issues/2404 would that work? ^^ Maybe I didn't explain point 1 more clearly (assuming that this response implies ""no"" to my first question). I'd like to wait with submitting a later transaction until my previous transaction has been included. Basically I want to reproduce in my forge script what I'd do in JS with the following code: const tx = await contract.method(); const txReceipt = await tx.wait(); const someData = doSomething(txReceipt.logs); await otherCotnract.otherMethod(someData); why cant you include a check on the parent hash in the transaction require(blockhash(block.number - 1) == expectedParentHash, ""tx not mined""); Would this allow me to wait for a transaction from within the same script to be mined ? Maybe some pseudocode helps: contract MyScript is Script {  function run() public {   vm.startBroadcast();   firstContract.stateChangingMethod();   // Here I want to wait for the previous transaction to be mined / included, if it reverts on chain I'd like the whole script to abort and not submit the following call   secondContract.someOtherMethod();   vm.stopBroadcast();  } } I'm running my scripts against an alchemy node not anvil, so not sure if this would help me that much. Also the rpc instruction for this already exists as eth_call. I was just wondering if there is a forge script integration for this. Hello, is there a way to access deployer’s address from within a script or should I handle it manually? isnt address(this) inside of the deployer contract ? (I havent played w scripts a lot) Did you try tx.origin ? It doesn’t seem to be the case no, will give it a try This Cheats where is it coming from? what should I import?? tx.origin was pointing to the deployer.",484
981,foundry-support.txt,"Thank you 👍 This is outdated you can use the vm storage variable from the Test.sol which your contract extends Like this: vm.startPrank(usdcWhale); sorry I didn't get it Hey guys after i update the foundry to latest, my assertEq keep givin me this error Your test contract should extend the forge Test contract and you will have all the cheatcodes available through the vm variable okay got it. thanks Is it possible for me to fork chains other than ethereum which are evm compatible like bsc or avax? You can fork any evm based chains as long as there exists a full node rpc endpoint I see maybe then endpoints are not working properly for me. thanks Btw it happened when i did ‘foundryup’ and then ‘forge config —fix’ on an existing project Can anyone help with integrating foundry into an existing hardhat project? When trying to pull the dependencies from node_modules, it says File outside of allowed directories Ctrl + F in this chat there is a helpful tweet that’s pretty straight forwards https://twitter.com/fjun99/status/1543813450081505280?s=21 this one? If so I’ve already done all these and it didn’t solve the problem strange.. can you run tree -L 2 I don’t have tree command did you add node_modules under foundry.toml / libs? Yuppp hmm.. if you can invite me to the repo I can try to figure out whats wrong as I have set this up recently alternatively, you can open a ticket on the foudnry repo , with an MRE One sec So it's a public repo: https://github.com/owlprotocol/contracts But the error seems to be it isn't allowing relative imports for contracts INSIDE the node_modules what command are you running? forge build Were you able to recreate the error? no can you please the branch where you have this error? it might be quicker.. oh right. branch is called issue-335 btw you might need pnpm to install dependencies yarn doesnt work? haven't tried it but npm doesn't work i'm running forge build in packages/owlprotocol-contracts it works for me and can't recreate it. owlprotocol-contracts $forge build [⠒] Compiling...",461
982,foundry-support.txt,"[⠆] Compiling 137 files with 0.8.15 [⠑] Solc 0.8.15 finished in 13.59s Compiler run successful (with warnings) warning[2519]: Warning: This declaration shadows an existing declaration. --> contracts/plugins/Routers/RouteRandomizer.sol:176:32:  | 176 |  function getRandomContract(uint256 queueIndex, uint256 randomSeed)  |        ^^^^^^^^^^^^^^^^^^ Note: The shadowed declaration is here: --> contracts/plugins/Routers/RouteRandomizer.sol:40:5: | 40 |  uint256 public queueIndex; |  ^^^^^^^^^^^^^^^^^^^^^^^^^ oh what that's so weird I used yarn not pnpm maybe thats the difference what's the command installing with yarn. Just yarn? yup lemme try with yarn did you run yarn in root dir or in packages/owlprotocol-contracts i ran it in the package something weird though , I had to copy over forge-std as the directory was empty Lmao it work with yarn interesting Ok but thanks anyways out of curiosity , does npx hardhat compile work? yes will dm playing around the repo Forgive me if this has been asked previously. Couldn’t find it in previous via cmd+f. Is there a simple one-liner cast command that can produce storage slots such as bytes32(uint256(keccak256('eip1967.proxy.beacon')) - 1) -> 0xa3f0ad74e5423aebfd80d3ef4346578335a9a72aeaee59ff6cb3582b35133d50 Hey guys, I just set up the hardhat plugin for foundry. I installed foundry and installed the plugin, and added `import @foundry-rs/hardhat"" to my hardhat config. Compiling contracts seems to work, and be roughly 10x faster which is great! But when I run tests, the typescript tests don't actually run npx hardhat test just compiles the contracts instead of running the test like it did before I added the foundry plugin. Anyone know what is going on? Edit: Actually compiling contracts isn't working either.",461
983,foundry-support.txt,"It just says nothing to compile Guess that's why it was so fast 😅 Was following the instructions to get the minimal integration of foundry for hardhat, mainly for speed increases and using anvil atm: https://youtu.be/wJnywGB33O4?list=PLhM7rBgpVV-JnmRLUbd10ELntN3LFfmKH&t=1175 Was able to fix the compilation issues by following the instructions in this tweet: https://twitter.com/fjun99/status/1543813450081505280?s=21 However, npx hardhat test can't find my tests anymore still. Does foundry have a twitter? I'd like some news on releases etc. I used hardhat with foundry successfully by starting with this template: https://github.com/foundry-rs/hardhat-foundry-template. I would advise to checkout the config and setup there. Does this replace the compilation pipeline with foundry though when you do npx hardhat compile or run scripts though? Or does this just make them work side by side independently? Because I quite like getting all the benefits of Foundry with the hardhat bindings. Scripts and compilation works. The only thing that doesn't seem to work is typescript tests. I'm assuming I have to use the hardhat compilation for hardhat tests because it creates type chain artifacts. But if there is some way I can override this I would love to be able to do that They work side by side. Foundry also generates abi/bytecode when compiling contracts so you could use that inside your typescript tests. But I guess it's easier to use typechain with hardhat compilation. What is the best way to test underflows and overflow in solidity 0.8.15 using forge? [FAIL. Reason: Arithmetic over/underflow] npm i —legacy-peerdeps https://book.getfoundry.sh/reference/forge-std/arithmeticError I opened an issue here on using the default hardhat functionality for the foundry hardhat plugin. It's great how foundry compiles the contracts and transfers them to artifacts hardhat can understand as that will give a huge performance boost for running hardhat scripts or any time you need to compile contracts.",458
984,foundry-support.txt,"But there are some cases when it feels essential to still be able to access the default hardhat commands: https://github.com/foundry-rs/hardhat/issues/88 If anybody has any ideas here, or if I'm missing some obvious way to do this, I would really appreciate input! There is a command if you just wanna generate typechain types for hardhat That definitely helps, but I still need to be able to run tests. With this plugin, hardhat test only runs forge tests. what if you run the test with mocha instead ? https://github.com/jbx-protocol/juice-contracts-v2/blob/main/package.json those guys have forge & hardhat tests I can't seem to call hardhat typechain. λ › npx hardhat typechain                 indie/contract dr-foundry [⠒] Compiling... No files changed, compilation skipped It seems the hardhat plugin for foundry just totally overwrites the entire hardhat command :/ Not for all of them actually. But in this case for this one. Damn. Running tests with mocha is not a bad idea though. I just need to figure out how to get the typechain. And I think those guys have forge and hardhat tests because it doesn't look like they are using the plugin. Which is totally reasonable, I would just love to get the benefits of the compilation pipeline under the hood for hardhat which it seems only the plugin can do This has been super helpful though. Thank you! I'll add more context to the issue w/ respect to not being able to generate the typechain either. why not using foundry only ? I would like to end up there. The thing is that we have an existing repo with a lot of typescript tests. There are somethings I like about hardhat like being able to script in typescript or using the hardhat console for talking to the node. So this plugin really appeals to me at the moment But yes, eventually I would like to be doing as much as possible in Foundry 🙂 I've seen people doing unit testing with hardhat and end to end tests with foundry, which makes sense because unit testing with foundry would be like doing copy and paste right ? Or my way of testing sucks ass maybe Haha, yeah I think there's a lot of different ways to do it.",481
985,foundry-support.txt,"A few of the things I'm most stoked on with foundry is the fuzz/invariant testing, debugger, and and generally writing as much solidity as possible Why would unit tests be a lot of copy paste though? You mean for internal functions? No, I mean that for calculations and so on you would copy paste them, I think what's the proper way to pass bytes32[] as an argument with cast? I'm having trouble getting it to be recognized correctly Is it possible to do smth like this in foundry... where the fork is denoted in the actual test? I am still having the issue where my tests are expecting a revert with reason and the logs show the call reverting with the expected reason but the test fails. If I remove the reason in the expectRevert the test also fails, but with reason. You should just use typechain directly ""forge-typechain"": ""npx typechain --discriminate-types --target ethers-v5 \""out/**/*.json\"""" https://github.com/ethereum-optimism/optimism/blob/develop/packages/contracts-bedrock/package.json#L34 Thank you! This is really helpful. With this I should be able to generate all the typechains from the forge output directory. Figured it out: create fork cheatcode How do I get env vars from .env to load into the foundry.toml Check foundry book run source .env in the terminal Doesnt work... but isn’t it supposed to work without that. I’m putting the env car in my toml not running it on bash Is it not recognizing the variables? Make sure there’s no spaces between = in your .env Yup no spaces When foundry would be integrated into starknet cant wait for that @gakonst Can u pls share an example of end to end test using foundry Install justfile and use https://github.com/sambacha/foundry-scripts/blob/master/justfile Foundry Support get() { env | sed -n ""s/^$1=\(.*\)/\1/;T;p"" } in ur script u can use that jt should handle it gm folks! I'm expecting a revert message, but it never reaches me and test fails.",452
986,foundry-support.txt,"does anyone know what could be happening? revert message doesn't reach my caller because it reverts to a contract call? not sure if that's a thing Seaport Do i put this in the foundry.toml? is there a way to have forge-fmt be used for format-on-save in vscode? or maybe just add a watch flag to forge fmt too? No No I wouldnt use fmt just yet Where do I put it? its not ready in a bash script? TBH I would install Justfile and use that for running commands How do I make this work? do you have the code somewhere or can you share the full trace? I had something similar happen. It might be that the revert is not bubbling up to the expectRevert Is there a way te reset the gas measurements during a test? Or a way to extend the setup function before running a specific-test? I want to remove data from a contract, and measure the gas cost for that transaction. Before being able to do so, I need to add data in a separate tx which I do not want tracked in the gas measurements It seems like foundry now adds in a Deploy.sol and Script.sol when broadcasting through scripting? Hey guys, any tips on getting remappings.txt to play nice with VSCode Remappings work fine within Foundry but I am still getting red lining in vscode after installing any dependency run this forge remappings > remappings.txt and it should work I did what an error says compiler version mismatch? File import callback not supported I put this in .vscode/settings.json: ""solidity.remappings"": [ ""ds-test/=lib/forge-std/lib/ds-test/src/"", ""forge-std/=lib/forge-std/src/"" ] Tried this as well, doesnt work unfortunately Same error After doing it close ur .sol tab.",372
987,foundry-support.txt,"Fixed it for me Same error I have my .sol in src im not too sure then that’s how it works for me Yeah this is strange Must have to do something with VSCode recognizing the settings Are there any other solidity extension configurations that might be causing it i dont follow this anti pattern Is there a preferred method of deploying contracts that involves something other than command line arguments? I was able to figure it out, turns out it was caused by a rouge git repo that was initialized upstream wdym like in submodules No like trying to run forge init inside of a uncommited repo does the broadcast folder work in the way that if you already deployed same bytecode it skip it ? just wondering if i should push that to the repo so other coworkers can run scripts without pushing again code to a particular chain I guess if not, there is no reason to push it and it should be added to gitignore Does anvil support eth_subscribe? I am getting this error when using eth_subscribe: ""{'jsonrpc': '2.0', 'id': 1, 'error': {'code': -32602, 'message': 'data did not match any variant of untagged enum EthRpcCall'}}"" more info here: https://ethereum.stackexchange.com/questions/132147/eth-subscribe-error-data-did-not-match-any-variant-of-untagged-enum-ethrpccall Bump, can I reset the gas counter during a test OR have a specific setup run before a test which isn't measured in the gas usage of the corresponding test? I could write an abstract contract with setup functions and implement a contract for each specific test with their own setup (which only needs a single paramter differently) but thats kind of a hassle link 404s, but the issue is with deserialization, maybe what you're receiving is missing a field, or has one too much (dont remember exact serde rules off the top of my head) non-standard node provider, or ethers-rs isn't following standard exactly what rpc do you use? i havent played around with anvil so maybe it actually doesnt support subs idk Gm, I need help building foundry for windows. I'm getting this errors any ideas? error: failed to run custom build command for bzip2-sys v0.1.11+1.0.8 error occurred: Failed to find tool.",484
988,foundry-support.txt,"Is gcc.exe installed I've installed the msys2-x86_64-20220603.exe and did all the necessary configs but its still not working any reason why you are buiilding it ? Have you tried downloading the windows binary here? https://github.com/foundry-rs/foundry/releases/tag/nightly-4e141e757986b58159d4e473bb8ca455b4ab5e8e If that fails , WSL should work I'm following the foundry book and it say windows users should build it? I dont have a windows machine to try it out , but IIRC the windows build is always a head. The docs might be out of date. I would use the prebuilt binary does cheats.snapshot() still work? It looks like it's not in forge-std, and when I try to use it directly I'm getting Invalid data you could use wsl and follow the linux installation. being able to use foundryup makes updating foundry easier received unexpected output are you interested in a bug report on it? console The application panicked (crashed). Message: couldn't deploy: Execution { reverted: true, reason: ""Revert"", gas: 101442, stipend: 0, logs: [], traces: None, debug: None, labels: {}, transactions: None, state_changeset: None } Location: cli/src/cmd/forge/script/runner.rs:68 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry is there any way to exclude test files from bindings ? their compilation is significantly increasing our CI time Is there a way to reference .env values in foundry.toml? Seeing conflicting answers online. Do you really need to reference them in the toml file? Because if you just need them in tests / scripts I have to plug https://github.com/memester-xyz/solenv Oh that looks neat. Right now I provide the rpc url as an env variable when running forge test and reference it in the foundry.toml (to use with the new forking cheatcodes) so I was wondering how you might use it from an .env file. But your tool works I think if you just put it directly in the Solidity Im trying to run foundry and hardhat together. forge test works well but when i try to run my hardhat test im having issues.",495
989,foundry-support.txt,"I tried the ""preprocessing"" described here https://book.getfoundry.sh/config/hardhat but it doesnt work. I get an error Error HH411: The library node_modules, imported from contracts/XXX.sol, is not installed. And if i remove the preprocessing I get Error HH411: The library forge-std, imported from test/XXX.t.sol, is not installed. I also looked at Seaport (https://github.com/ProjectOpenSea/seaport) and I dont understand what they do differently for it to work Mayeb this: https://github.com/ProjectOpenSea/seaport/blob/main/package.json#L64 its the default config file, so it's the same. If I try to do that, I get the same error even if i only try to do hardhat compile i get the error about forge-std, which i dont get since it is in ""test"" folder and not ""contracts"" Hi folks is it expected that foundry deploys multiple copies of libraries with external functions instead of doing it once and link every contract to the same instance? I've found a way to hack it to force it to always use the same instance, but is far from ideal why do I need this? for testing, if I wanna mock a library method, I need its address, which can be obtained with address(MyLibrary), but if the test deploys a different instance for itself, then that address is not the one that my prod code is gonna be calling... Define a production profile with tests defined as a empty folder, note you can not use an empty string for this I looked at their foundry folder and it seems like they are all unit tests? any chance you're importing something from test folder into main folder? maybe newer hardhat started trying to compile sol files in test folder? you could try moving foundry tests to another folder Anyone know why forge and hardhat give such different gas costs? Hardhat seems to be the accurate number. Both use same same solc, optimizer runs, function call count, and function params. hardhat: forge: forge removes base tx fees it cant be that simple of a fix lol is it possible to include base tx fee within config? i.e. basically 21k.",460
990,foundry-support.txt,"we chose this because it’s not something the developer can do anything about so we remove it don’t believe so, just add 21k if you need to i guess but you shouldn’t need to hmmm, i wonder why the discrepancy is 31k then? not sure. if i were to guess you likely aren’t matching configuration identically somewhere rad, well i very much appreciate your help, thank you 🙂 hey there gn everyone is it possible to verify a contract on avalanche? How can I create a reorg with forge? a block reorg? yes I am indexing blockchain data, and want to test if my system is robust to reorgs it should be as snowtrace is also build by etherscan team with same api there's an open issue for that https://github.com/foundry-rs/foundry/issues/1799 but there's a way to provide the etherscan API, but not the URL... (I mean, I have the same question but for Arbitrum) Same applies to richer stack-traces when testing on forks, the Etherescan API key only helps on mainnet --chain avalanche should do it, I think it's SNOWTRACE_API_KEY env var for avalanche, or --etherscan-api-key would appreciate an issue with problems you had and how to improve this all right, I'll give it a go btw, I've posted a question yday, would you have any idea about it? @mattsse (and btw, I work with Arbitrum, not Avalanche, will the same apply?) could you please put this in a new issue as well so we can track.",332
991,foundry-support.txt,"sure, didn't wanna raise an issue without checking if it was expected behaviour or not 🙂 are you running in forked mode? arbiscan also has ETHERSCAN_API_KEY env var, but I think you need to provide --chain arbitrum, since default is mainnet yes I am, let me fiddle with my run config and see if it works 🙂 btw I'll have tests soon that will fork both mainnet and arbitrum so that trick would stop working unless forge is smart enough to associate a chain with a fork conf and also allow API keys per chain in case they're different I think all of that should be on the fork config section but I'll try first ans stop speculation rn 😅 I think the might need some work, so if you run into this please report not working forge cmd in wsl2 So there's no --chain flag, I tried with --chain-id 42161 for arbitrum and setting ETHERSCAN_API_KEY=$ARBISCAN_API_KEY but it's not improving the logs in any way this looks like something else, there's apparently another program called forge on snap, check PATH please open an issue I'll do thanks here is the path variable Hey guys can someone please explain to me why things use require(statement,”string”) over revert CustomError() when there are no Params being passed in? Is there any good reason? Not directly foundry related but I see it a lot i would google how to uninstall a snap in ubuntu, then do that. then reload your path var and the correct forge should be there Custom errors are fairly recent, you may be looking at old code or at devs that didn't get the memo yet also the syntax is sometimes a bit clunkier as you need an if statement around it This code isn’t that old maybe they’re just doing it the lazy way Any concerns with require vs revert on a lower level? afaik require calls revert It’s the same thing, but with custom errors you don’t have to store the string which reduces the gas costs https://blog.soliditylang.org/2021/04/21/custom-errors/ Hi all I was looking for examples of implementing a upgradeable contracts in foundry with the UUPS pattern. I couldn't find a ton of examples that didn't use hardhat so I wrote a very minimal repo for my own reference.",477
992,foundry-support.txt,"Sharing here in case it is useful to anyone: https://github.com/jordaniza/OZ_UUPS_Proxy Thanks for this .. is there a reason why you don’t initialise it in the setUp function? No reason, just playing around with different scenarios within the tests I'll refactor it to make it clearer to anyone There, should be more readable now It’s no biggie tbh… I think there would be value in adding a deployment script (the repo says it also deploys ) And add it to the forge book Sure sure Yeah that’s what I thought. Must be old code. What is a custom error storing in state? A 4 byte sig or something? Deploy added Yes, 4byte sig Is there anywhere in particular to add it to the book? read the blog i posted it has everything in it Probably under tutorials huh Hello, I have a quick question, is anvil node published to crates.io as a crate? (not a binary) in other words, can we have anvil as a crate where we can use it for other applications for integration tests? I would love to be able to spawn a anvil node, deploy contracts and intract with the node from there using ethers-rs for example. Alright, I opened a feature request here, for keep traking of this https://github.com/foundry-rs/foundry/issues/2441 Also added more context, if you guys are interested to read more. Thank you. found that you should call forge verify-contract with —chain-id instead of —chain. Is chain okay as well? Does anybody have a favorite template of unit tests for testing ERC721 common test cases with foundry forge coverage --report lcov && genhtml lcov.info -o report --branch-coverage && open report/index.html is delicious 🤩(`brew install lcov` to get genhtml on mac) Will   wrappedProxyV1 = MyContract(address(proxy));   wrappedProxyV1.initialize(100); result in 2 tx or 1 ? aka can .initialize be front-run? (unlikely to be touchy in this case, but curious) Great question actually. It might be that initialize is callable only by the owner, but I have not checked.",456
993,foundry-support.txt,"Because that looks like 2 txs to me, initialize is just a public function after all Unlike a constructor which is run on deploy then stripped out of the bytecode hello ! i have a interesting situation where i am testing certain ffi file i/o functions, but the tests are write to the same temp file and are being run concurrently. each test has the same format: io.write(file, content) and then expectEq(io.read(file), expectedOutput) i guess i can write to a different temp file in each test, but im curious if there is any way to enforce sequential execution of any tests or some sort of locking? @sambacha so what is not working now ? its the picture, its not obvious its an animation that you need to click into.. il.e the preview is a static image ser ya i have no control over that , its the img host @sambacha - I put it here directly what exactly is your issue @m0h4m36xx how come git doesn't allow you to commit changes made to a file installed with forge install no issue , its in response to the person saying forge doesnt work in WSL2 , I am showing it that it DOES WORK , based on chat moved from main chan ah gotcha I mean in general. I changed the solidity version of one of the interfaces im inheriting but git isn't allowing me to commit the changes made to files installed with forge install. Do you know why? lol sorry for the mixup , i was answering Samuel Dare , answered you by mistake 😄 lol I figured, all good ive had this issue too and i had to revert the changes to get it to work.. probably some nonsense related to submodules if you use forge install , then it doesnt add it as a submodule , i use it in general when adding GIT repos to my own Whats the error ur getting ? i dont think he means that... if you change anything in the modules you i.e. blank space in forge-std, it wont let you commit it no error, but I try to run ""git add ."" and everything gets pushed to staging and then I'm able to commit.",434
994,foundry-support.txt,"That is everything EXCEPT changes made to files I installed with forge install i try to use git add <file name> and still doesn't push to staging You can discard all changes and try git reset --hard This will discard all changes that are in staging , but this will remove all changes made to files , maybe before you do that , make another branch Is there a prettier style ignore line or ignore block for forge fmt ? do you guys have any idea why do i get this Because its a submodule To discard changes do: git restore . --recurse-submodules Do you have the last version of forge-std ? Maybe forge update ? Maybe he didn't do forge install --no-commit --no-git <dep> That's why it installed it as a submodule https://book.getfoundry.sh/reference/forge/forge-install?highlight=Forge%20install#forge-install forge create emailVerifier.sol:Verifier [⠑] Compiling... No files changed, compilation skipped Error: could not find artifact: `Verifier`   Did you mean `Verifier`? Hi.,I am facing trouble in connecting remix to anvil.,,while connecting i got foundry-provider set your environment to vm. Did someone face same issue ? how to configure properly ? getting this after forge build, any ideas? resolved, wrong path! getting `ProviderError(JsonRpcError(JsonRpcError { code: -32603, message: ""EVM error CreateContractLimit"", data: None }))` i was working with an old version project, then i did foundryup but still getting the same error after forge update why in order to install chainlink we use chainlink-brownie-contracts 🤔 nvm just found the answer it allows you to install a slimmed down version Might be a very basic question but how to you run a arbitrum fork on anvil? Pass the arbitrum url as the fork url parameter CompilerError: Stack too deep. Try compiling with `--via-ir (cli) or the equivalent` is really the bane of my existence in Foundry (**only in the test files**) given the compile times it implies (like x10 times longer) is there tricks? Sometimes if you scope the variables it can work Or you could break down into multiple functions call to be kinder with the stack Thinking ..",472
995,foundry-support.txt,"since the contract size limits are relaxed for tests , should the stack depth also be ignored ? hi team, if i create a MockERC20 token and i want it to take the address of $sushi, how can i then make the SUSHI_REAL_ADDR.balanceOf(user1) to be an amount i define? tried doing mockSushi = new MockERC20(""sushiswap"", ""sushi"", 18); vm.etch(SUSHI_REAL_ADDR, address(mockSushi).code); IERC20(SUSHI_REAL_ADDR).transfer(user1, INIT_BALANCE); but the transfer shows i dont have enough balance is it possible to make SUSHI_REAL_ADDR.balanceOf(testContract) to be type(uint256).max so that i can transfer user1 some $sushi? etch is for ETH you can impersonate a SUSHI whale or swap or set the storage to modify balanceOf and totalSupply thank you ser. is it possible to impersonate using vm cheatcodes? i neither specified the chain nor did anything related to chains when running tests if it's not a forked environment and just a mock contract, just add a public mint function ser yeah i wanna test staking $random_token of my contract into sushi's contract and sushi's contract has the address of $random_token defined as a constant. so i was trying to create a mock token with max supply and change its address to the address defined in sushi's contract hey hi, what's the common way to perform tests where multiple addresses interact with a contract? since not sure if there is a way to set ""from"" do you create multiple addreses with .addr and then do prank for each one? Hi I'm getting Illegal abi on a cast command: Illegal abi `swapExactTokensForTokens(uint256,uint256,(address,address,bool)[],address,uint256)`.",381
996,foundry-support.txt,"Does anyone see anything wrong this? nvm fixed just by updating foundry Correct, or you define an address of your choice Getting another error with my cast send command: cast send $ROUTER --from $ME --legacy ""swapExactTokensForTokens(uint256,uint256,(address,address,bool)[],address,uint256)"" 1183615728 0 ""[(0xDeadDeAddeAddEAddeadDEaDDEAdDeaDDeAD0000,0xfC76114C5AdeBfa257153eA82b8594C3B25baebe,false)]"" $ADDR 1758634801 getting: Error: Failed to parse tokens Context: - Invalid data Hello, is there a way to configure line length to be used by forge fmt or was the decision made to make it the same for all the foundry projects? (BTW the speed of the formatter is incredible) i think this might be related to incorrect nesting parsing coming from ethabi unfortunately... you can try and accomplish the same with a small forge script https://book.getfoundry.sh/reference/config?highlight=fmt#formatter should help Missed that section. Thank you 👍 0xe05A884D4653289916D54Ce6aE0967707c519879 use this address to impersonate wait are you using MasterChef contract for staking? Hello, when I run forge coverage I get the following error: could not find anchor: no matching instruction in range StakingBridge:3019:2:42 Is it an issue with my project configuration or is it a bug in forge? The repo I am working on is open source so I can give reproductibility details if requested. I am using latest forge release.",360
997,foundry-support.txt,"Thank you this a known limitation of coverage, is still a wip could you please check https://github.com/foundry-rs/foundry/issues/2162 and perhaps provide additional context sure, will report 👍 Any great resources to rewrite hardhat test to foundry? With enough examples to extrapolate from Found a fair guide by chainstack for anyone that needs it https://chainstack.com/foundry-hardhat-differences-performance/ Add [fmt] line-length = 120 To your foundry toml https://github.com/gakonst/v3-periphery-foundry Eg https://github.com/gakonst/v3-periphery-foundry/blob/main/contracts/foundry-tests/utils/Deploy.sol Can a foundry script take in input from the command line? Yes is there an example of this somewhere? ah found this nvm If it’s not documented well enough, can you open an issue in the Foundry Book (or even a PR with your ideal docs)? hi there, does anyone know why opensea didnt go all-in foundry and still has some hardhat tests? more broadly, im wondering what are some tests that can only be done in hardhat but not foundry. cuz it takes time 😅 The objective is for foundry to always be the choice oh thanks! because in my experience, i was able to get most stuff work in foundry but im curious what are the limitations im not aware of (maybe i am not at the level to write super complicated tests / contracts yet) They have hundreds of tests with a lot of setup code i see. gonna study their repo for a bit now 😅 i tried to copy a few addresses of token holders from https://arbiscan.io/token/0x11cdb42b0eb46d95f990bedd4695a6e3fa034978#balances and declared address whale = address(0x8e2bde4c1b7f117270dccf394c32653a32708898); and address whale = 0x8e2bde4c1b7f117270dccf394c32653a32708898; but i got This looks like an address but has an invalid checksum. Correct checksummed address: ""0x8e2bde4c1b7f117270dccf394c32653a32708898"".",490
998,foundry-support.txt,"If this is not used as an address, please prepend '00'. am i doing sth wrong? You must use checked summed addresses in Solidity forge fmt Will fix it for you Hehe damn it works! it's the coolest feature i've come across omg 😂 thanks! >there are changes in your working/staging area. Commit then first it add the ‘—no-commit’ option Is there a fix for this? My staging area is clear hi! this is exactly what i came here to ask about. did u get this working and do u have a link u could share? Add --no-commit Is there a fix for the error message beyond adding --no-commit? You can pass ‘—no-git’ as an argument to forge init has anyone noticed that when fetching big amounts of data in a forge test vs in a cast call the forge test is considerably slower? For example, fetching 250 entries from a mapping takes me around 1 minute in a forge test vs few secs in a cast call back in the days I found a repo / code that use ffi cheatcode to read csv data, anyone have something similar to share ? Hello, is there any other testnet that would require the --legacy flag? If I have an array of address in a txt file, how should I write this file and how should I read it in my ffi testing ? Hi, has anyone had much experience fuzzing? I’m trying to use vm.assume from the forge std library and when I use for example assume(x < 10); for a function that passes the test for any integer less than 10 including 0, it will fail with args=[0] in the output. I’ve had a similar problem using bound in the past too. I think it must be my own misconception but I’m not sure where I’m going wrong. This might be a better explanation than above. As you can see it passes when quantity = 0 but not when fuzzing. Try increasing the verbosity to get a better stack trace forge test -vvvv Should be able to see where this is failing are there any spellcheckers for solidity code? Hi sorry for dumb question.",441
999,foundry-support.txt,"I am trying to set a payable constructor which takes 32 eth I get this error Setup failed reason = revert contract and then (0xb4…) I am calling it using name = new Name{value: 32 ether}(); And it has previously been given that much Seems that all payable constructors are breaking Also is there anything serious I should be worried about regarding security for payable constructors? There’s different syntax, AFAIR. Any docs on this stuff I’m struggling to find it I think you need to put “new Name” in parentheses. Don’t remember where I saw that. In Solidity docs somewhere. Nope, your syntax also works. I just checked it in a fresh Forge project. It seems to be because foundry setup doesn’t support fuzzing and params Is that correct? That’s my conclusion so far Yeah that looks right going off the runner.rs code Shame Does forge coverage not use the settings in foundry.toml? I'm getting stack too deep errors only when compiling with coverage like it's not using IR with optimizations hey friends, how does the deployment process work in tests? for example, why is msg.sender in the setup function different from msg.sender in the test functions? I had the same issue with the msg.sender being different in the setup and in the tests functions I had to force it by prank I think is a bug afaik we compile un optimized for coverage because compiling optimized messes with sourcemaps, right @onbjerg ? @joshiedo we made some changes to the sender, right? is this a sideeffect? yep Ah that makes sense, thanks for the info! I think someone on our team ran into this as well. can you share more on what you're getting and what you'd expect? if there's a sender set when calling forge script it should be the same (just tried it out, and it works) i think op was referring to test framework only (not forge script). at least thats where we saw it. lemme see if i can dig up the slack message.. hmm idk how helpful this is as there are mostly references to our codebase. but basically it looks like he was experiencing some inconsistencies with the deployer address. i've asked him to jump on this channel and provide more details but hes in a different tz You can pass the —sender-address flag to set this hmm i never heard of that and couldnt find it by searching the foundry book.",497
1000,foundry-support.txt,"r u suggesting that we always run all of our tests with forge test --sender-address <desired sender address> ? sorry its --sender :   name: ""--sender"",   description: ""The address which will be executing tests"",   isOptional: true, --sender <ADDRESS>    The address which will be executing tests 👀 thank ser Any tips on debugging what this failure is? I can't seem to get FFI to run (I enabled it fwiw) this is my test: https://gist.github.com/0xalpharush/fbd5b9d41ce44f97ab437e5f3c0f0c0d I get a different error with your gist (tried foundryup, maybe missing something else?) ""error[9582]: TypeError: Member ""toString"" not found or not visible after argument-dependent lookup in contract Vm."" My b I left the import statement out. Just updated the gist This is an example of ffi working : https://github.com/memester-xyz/solenv/blob/master/src/Solenv.sol (i had imported forge-std/Test.sol already), same result. I must have an older std lib.. will check after forge update I now get: [FAIL. Reason: Odd number of digits. Counterexample: calldata=0xa268fc1c0000000000000000000000000000000000000000000000000000000000000000, args=[0]] testFuzzRoundTrip(uint256) (runs: 0, μ: 0, ~: 0) VSCode Waiting with hype fleet by JetBrains It depends on the extension that you use FYI - I get the same 'odd number of digits' error with the example here: https://book.getfoundry.sh/cheatcodes/ffi?highlight=ffi#ffi (I've not used the ffi before anyhow, so likely someone else knows better...) After running foundrup, I get the same error The exact example from the book runs and succeeds (I'd kept the toString for a number before, that failed) also, vm.toString(abi.encode(num)) works fine, but vm.toString(num) seems to generate errors error[6675]: TypeError: Member ""toString"" not unique after argument-dependent lookup in contract Vm.",473
1001,foundry-support.txt,"I can't get your example to work, soz <shrug> what type is num? Same as above ffi example or type 1 there Sorry - that is uint From gist above 👆 Thanks devtooligan - jumping on this to elaborate. @joshiedo In my situation, I encountered this bug while testing. The contracts were initially being deployed by 0xb4c79daB8f259C7Aee6E5b2Aa729821864227e84. This is the expected deployer address as laid out in the foundry book. However, with the introduction of a single arbitrary line, the deployer address changed - to be the address of one of my test contract called StateWandTest. To be clear, when I say test contract, I mean a contract that contains my unit test functions. In my scenario there were 2 of such contracts to simulate different scenarios. Additionally, the line of code that caused this behaviour was the deployment of the fyToken contract as seen in the screenshot. Strangely, on removing this line, foundry defaulted back to normative behaviour and contracts were deployed via the expected address. hey, is there a way to include fuzz tests on gas snapshots? maybe simulating it runs with one input or outputting the average cost? nvm, found the flag --include-fuzz-tests Hi all, how do I get address of contract created with factory pattern? contract Child {} contract Example { Child child; event Born(address baby);  function create() public {   child = new Child();   emit Born(address(child));  } } contract TestExample {  event Born(..);  function TestBirth() public {   vm.expectEmit(true,false,false,true);   emit Born(??);   ...",361
1002,foundry-support.txt,"} } hey there everyone! is it possible to add a helper function to foundry that runs several functions inside setup? Could I ask you how can I do not count assertions conditions as a branches in coverage? Is any way to exclude them? Yeah you can have contract `MyTest is Test, YourCustomTestHelper {` and they should be accessible from setUp Can forge coverage lie on branching? I'm fairly certain that statement is covered in both if(true) and if (false) ways in the tests, so im confused Awesome! Thanks man Getting error could not find anchor: no matching instruction in range MockCToken:2260:34:39 What does this mean and how do I resolve this? used command forge coverage Read the pinned message, this is a known issue. is coverage going to support --optimize --via-ir ? ctrl + f in this chat someone explained why they dont use optimised building for coverage https://t.me/foundry_support/16191 hm thanks setting via_ir=true in your toml or using the --optimize --via-ir flag in the cli is the same no? in any case either of these options takes me to: Compiler run failed YulException: Variable expr_135_address is 2 slot(s) too deep inside the stack. Follow the thread , you need to fix the stack too deep errors ; it’s kind of counter intuitive since the optimiser usually helps with stack too deep damn so using forge coverage means one can not use the full extent of solidity functionality, thats unfortunate forge coverage is still very much WIP and I remain optimistic https://github.com/foundry-rs/foundry/issues/1961 yeah dont get me wrong i love forge. just makes it hard to justify internally to switch fully to forge for tests if using coverage means you have to change your implementations Switch or die .. usually works for me re: --vir-ir , I wonder if its practical to compile with hardhat and pass the bytecode to forge? Hello guys & girls! Im trying to write solidity test with foundry. But in setUp() part I should initialize upgradable contract which does not have constructors. And typical syntax FToken fToken = new FTOken(par1, par2...) doesn`t work.",457
1003,foundry-support.txt,"I would deploy the token , then call the initialise function after in the set up Does someone have idea how to initialize upgradable contract directly in solidity test file that will later on be run by forge test? (Without involving haradhat and generally JavaScript in doing this.) Ctrl +F @jordaniza has an example repo with this Muchos gracias! I will try to find now Bingo! :) Precisely this! Noooo you might be able to get away with setting evm version to before spurious dragon or if their is a stack size option in foundry toml config obviously depends on if your using any newer opcodes Not sure it would change anything, it's the solc compiler that produce the AST used to generate user friendly coverage, the via-ir option completely rewrite the solidity code according to the documentation and from what I observed it mess up the correspondence between opcode and line of code of the compilation unit (aka source file) https://twitter.com/z0age/status/1551903208674660353 Thanks for sharing that. Very relevant! Remember that OZ reserve a storage slot for _ADMIN_SLOT in the heap when you import ERC1967Upgrade.sol, Audius instead set the Admin address at slot 0, which resulted in that particular exploit My bytecode is returning _729739202_ What does this mean? Compiler says invalid bytecode But compiles successfully When I deploy Hi all, does this ring a bell with anyone? I only have this problem in one of my repos Does foundry use its own implementation of solc? Doh, it was in my foundry.toml is there a tg chat for solmate? similar to this wut t11s is in a high stakes D&D game in some dudes basement rn Unknown when it will conclude Going crazy trying to figure this out—possible to have cast use my foundry.toml config? basically don't want to enter --rpc-url every command This? https://book.getfoundry.sh/reference/config#eth_rpc_url Ty. That one eluded me 🧐 I have a question about --no-match-test: I am running forge test --no-match-test Skip$, but it appears that the all the tests are running despite some test method names ending with ""Skip"". Anyone know what I might be doing wrong there? I have also tried the regex ""Skip\b"", but all the tests are still being run.",486
1004,foundry-support.txt,"I added the following lines in my foundry.toml via_ir = true [profile.default.optimizer_details] constantOptimizer = true yul = true [profile.default.optimizer_details.yulDetails] stackAllocation = true  forge test and forge coverage keeps compiling forever. how about ""*Skip"", maybe we should tune regex matching to also check for inclusion would appreciate an issue for this That doesn't work either. I get the following message: repetition operator missing expression Here's the full command I am running: forge test --rpc-url $RPC_URL --block-number $BLOCK_NUMBER --no-match-test ""*Skip"" Try including (and probably escaping) the parentheses. Test case names end with parentheses. Or something like “Skip\(“. This was exactly it - by using ""Skip\(\B"", the regex picked up those tests. I'm testing using a mainet fork, an address is hardcoded in our contracts since it is already live, but it doesn't contain a function I need to call. So, I want to locally deploy the new version *at the same address* so I don't have to mess with the hardcoded parts. Is that possible to do Contract newContract = new Contract(target address to pretend this one is at)? I know I can't just pass it in like that, but that's the general idea... It is unclear what you want to do .. why do you need the address? Have you looked at create2 so determinstically create contract addresses or the etch cheat code to deploy code to an address? https://github.com/foundry-rs/forge-std/blob/27e14b7f2448e5f5ac32719f51fe652aa0b0733e/src/Vm.sol#L64 Oh! etch would allow me to ""overwrite"" an address with another contract locally? I'd pass in the address to overwrite & the abi as bytes? Weird, I only see that in Vm.sol, but not in Test.sol test inherits vm kek where's the best place to store contract addresses using a script such that you can make new scripts, later on, referencing the prev script's deployed result, without manually copying them I've written this: https://github.com/iFrostizz/contract-book Still shitty and need to build the API I'm just going to store it in another contract that interacts with the two scripts.",483
1005,foundry-support.txt,"Thanks tho Anyone prefer symlinks or moving files for complex rempappings that clash? Assuming imports can’t be changed anyone want to shill me on something to replace make for use w foundry? @sambacha i seem to remember you had something else you really liked Is there an easy way to get the address of a previously deployed contract to use in a to-be-deployed contract in a solidity script file so you can chain contract deployments? Something like hardhat deploy getContractAt I believe? Seems like vm.startBroadcast might record this but I don't see a way to get it out in either the same or different subsequent sol script file https://github.com/sambacha/foundry-scripts/blob/master/justfile There is a github actions workflow in that repo as well for reference on how to use it with foundry cont: https://twitter.com/z0age/status/1551951489354145795 has anyone found a work around to casting an address in solidity and it being lowercased ? Im trying to write tests for a merkle proof and the merkle proof check is failing because it wants the checksummed address but when i declare an address in my test it lowercases it by default. I feel like someone has probably ran into this already is there a good way in forge to generate random, dynamic-length arrays (possibly also filled with random data?) separate q, is there a way to incl fuzz tests on gas reports / snapshots? (maybe futile for snapshots,,) Maybe the flag --include-fuzz-tests, saw someone mention the same thing earlier is there a way to get a string literal as bytes32 with cast? equivalent of bytes32 string = “string”; I use the python tool set like moodyeth. It automatically store the addresses in the json file with some key informations all in json format. I found this also supports forge building toolchain as well. forge fmt Hello there guys! Is there a way of getting the event returned from a function in a test? For example: (Line 1) Function call ; (Line 2) Get event parameters vm.expectEmit ( https://book.getfoundry.sh/forge/cheatcodes ) Hello guys, I am trying to run some tests and i am trying to transfer some funds from my test contract to a dummy address, However i keep running into this error PRECOMPILE::ecmul{value: 6500}() , ""EvmError: Revert"".",500
1006,foundry-support.txt,"I tried doing the same thing in previous tests and i had no problem. what seems to be going on? i've done payable(address).transfer(6500); https://book.getfoundry.sh/cheatcodes/record-logs?highlight=Recordlogs#recordlogs Thanks! Can somebody show me some guidelines, as to what constitutes a full and complete unit test? How do I know I'm ""done""? Hello everyone, why I cannot get the address.code? TypeError: Member ""code"" not found or not visible after argument-dependent lookup in contract bytes memory code = address(MY_CONTRACT).code; Any idea? Hi! I keep having issues with compilation. Everytime I run forge test even if i dont modify any contract, it keeps recompiling everything. Any idea what I could do about that? And compilation takes a really long time... About 2 minutes. Im running all the test in the ghcr.io/foundry-rs/foundry docker hi, is there a way to get deployed contract addresses from a solidity script? similar to what hre.deployments achieves in hardhat-deploy. thanks! I noticed that some cache is saved in ~/.foundry. Why is that? Can we change that and use the cache folder specified in foundry.toml ? But anyway it shouldnt change anything because that directory is successfully created in the docker too Forge snapshot only logs stuff without fuzzing is this intended Hey all I’m trying to test my contract (not deployed) that calls contracts that are deployed on arbi - specifically stargate finance if you’re familiar with it. Doing a call to redeemLocal to reclaim my eth from the SGETH LP and it works half way. The dev I’m chatting with on the stargate team mentioned that bc I’m running a local forked mode the transaction won’t be delivered. So I’m attempting to use a combo of anvil and cast to test out this function call. However even after specifying the fork url for anvil wnd attempting my calls it doesn’t seem to be working. Wondering if someone here would know how to get this to work? So basically im able to swap from SGETH, my original deposited eth never makes it back to my contract.",457
1007,foundry-support.txt,"Can you try running it with verbose traces ? -vvvvv ; might help you understand what’s going on The debugger would also be helpful and in stepping through the transactions I did and also specified the etherscan-api-key as well I can see the part of the test in question - and as pictured above the test does pass - but it doesnt do exactly what's needed This is what the dev im chatting with said ""if you are running a local forked node the transaction wont be delivered because there is no relayer"" Their testing is in hardhat but I figure I should be able to get the info i need - if not through forge then by anvil and cast it looks like you might need to deploy this : https://github.com/LayerZero-Labs/solidity-examples/blob/main/test/examples/OmniCounter.test.js#L11 https://github.com/LayerZero-Labs/solidity-examples/blob/main/contracts/mocks/LZEndpointMock.sol Hey, what format does a Tuple take when using cast send? When just using (a,b,c), I get error of syntax rrror near unexpected token ‘(‘ And when just using [a,b,c] I get error of “failed to parse tokens” ah are you saying implement the endpoint like they did here? Yeh do you have a link to the stargate GitHub? I can’t seem to find it anywhere yeah let me check my 1m+ stargate github tabs open rn haha https://github.com/stargate-protocol/stargate I think you should be able to use the same mock endpoiint : https://github.com/stargate-protocol/stargate/blob/main/test/Router.test.js#L7 https://github.com/stargate-protocol/stargate/blob/fba2a57f76f0533f8c3608e682f32d0cd47a8a29/contracts/mocks/LZEndpointMock.sol so maybe I should try and make an interface out of this endpoint? I just found the contract address for it- not 100% sure what I need to do with it as far as forge is concerned.",441
1008,foundry-support.txt,"not sure what your flow is , but can't you jsut copy the contracts and interfaces into your root and deploy it in your setUp() function? like use the endpoint is instantiate a mock bridge or something : https://github.com/stargate-protocol/stargate/blob/main/test/Router.test.js#L27 hey You need to create a mock router I was chatting with the stargate team about this but in the meantime you can use a very simple one I wrote for swaps as a baseline how to downgrade the forge version? https://github.com/pie-dao/auxo-vaults/blob/develop/hub/test/mocks/MockStargateRouter.sol Just be mindful that, on the stargate sgReceive function, _srcAddress is the address of the router on the source chain, so you cannot trust anything in the payload param. I think I may have seen you in the discord lol Yeah im not sure Im following - im just trying to remove liquidity that was added via native eth (I called addLiquidity from routerETH) If you're removing liqudity you'd need to add a mock of the method yeah was wondering about the bridge since it seems like redeemLocal from the router contract calls the bridge contract. Basically everything works fine up until i call the redeemLocal method and Im not sure if I should be directly interacting with the endpoint or the bridge. I have an open ticket with stargate to see if thats even feasible Essentially you deploy a contract that acts as the router and receiver (you could deploy 2 contracts if you wish) inside your tests. In your case, grab the logic from the stargate repo and strip away calls to the actual relayer and oracle, and just handle the removal locally inside your test To test it IRL you'll need to run the integration test on testnets youre just talking about deploying the router right? Not sure Im fully understanding what you mean here. You wouldn't deploy the whole router, you need to deploy a mocked version of the router in your tests, that doesn't require calling the Relayer/Oracle.",427
1009,foundry-support.txt,"If you check out what @SamuelDare sent here, LayerZero do the same in their tests with this mock endpoint The mock endpoint takes your request, forwards it to the destination, and pretends that it has done all the necessary logic in between This means you can unit test without needing the cross chain infrastructure, which on a fork or a test you will not have Feel free to DM me I can send you some examples ah okay i thought you meant to try calling redeemLocal directly in my test as opposed to my contracts function call. Let me look at that again and see if I can figure it out there otherwise ill def send you a dm real quick onthis, do you know how to make this work with forge as opposed to hardhat? https://github.com/pie-dao/auxo-vaults/blob/feature/integration-testing/hub/test/XChainStargateHub.both.t.sol Omeguhh what's the max number of optimizer in forge build? 4294967295 Hi, is there any way to access mapping inside my struct in tests? Example: mapping(string => AAA) public aaa; struct AAA {  uint256 creationTime;  uint256 dealineTime;  mapping(string => uint256) something; } When I'm trying to access aaa mapping in test suite, I'm getting tuple with uints only, without access to something ""Member ""something"" not found or not visible after argument-dependent lookup in tuple..."" thanks! dm'd o awesome can't believe i missed this forked mainnet testing & using rollFork to advance time to test rewards earnings. But it doesn't let it go into the future as a simulation of nothing else changing.",346
1010,foundry-support.txt,"Is there a way to simulate when using forked testing? Or would I need to start by going back in time when I setUp & again when I start a prank? Have you guys seen this Utils.sol? https://github.com/PraneshASP/forge-template/blob/main/src/test/utils/Utils.sol createUsers(numOfUsers) creates an array of testing accounts I think that it was taken from damn vulnerable with foundry repo Correct me if I'm wrong Hey does anyone know if there is a rust implementation to checksum an address? I can't see one in ethers-rs @gakonst , happy to add one if not There is pr in foundry to implement it EDIT: found it https://github.com/foundry-rs/foundry/pull/2371/files hey gm everyone how can I evaluate where my code's stack is too deep? CompilerError: Stack too deep when compiling inline assembly: Variable headStart is 1 slot(s) too deep inside the stack. I want to prank as a contract that requires multisig signing to authorize the transaction. Just putting in the multisig address doesn't execute it. How does one spoof the multisig contract for the prank? This is what I get when I do it: by just using the address of the gnosis safe: with Gnosis Safes you would be pranking as the individual owners of the Safe and capturing enough of their signatures from onchain or offchain signing to pass into the executeTransaction function. the safe itself will never be the one to execute, it will come from one of the EOA owners (unless you have nested safe setup which i assume you don't) Count to 16 I have like 6 contracts working together, this happened after several modifications Do you know of any examples on how to do that? For example: TargetContract - on mainnet - targeted function call: function changeNum(uint num) public onlyOwner... owner is gnosis safe 2/5 - safe owner 1: address 0x1 - safe owner 2: address 0x2 I was also trying to just overwrite the safe using etch, but it isn't having that...",442
1011,foundry-support.txt,"It'd be sweet to run startPrank(safeSigner1, safeSigner2) and it'd just ignore needing to actually sign it haha I'm using anvil to locally fork state over RPC and cast to call/send to it — is there a way in this setup to get all accounts unlocked as signers? i.e. just skip that check entirely hm, is anyone having issues with forge verify-contract ? I'm running: ETHERSCAN_API_KEY=<key> forge verify-contract --compiler-version ""0.8.15+commit.e14f2714"" --chain-id 10 --watch <address> test/utils/MockTrigger.sol:MockTrigger` but it fails: Waiting for verification result... Contract verification failed: Response: `NOTOK` Details: `Fail - Unable to verify` I'm on forge 0.2.0 (a4b04ca 2022-07-27T00:12:36.261849Z) what chain are you on? sometimes testnets can't verify very well and you'll need to try a few times this is for optimism hey, debugger crashes from time to time with: panicked at 'overflow when subtracting durations', library/core/src/time.rs:940:31, any idea why? huh..",263
1012,foundry-support.txt,"can u post a screenshot of the entire error? or is that it? that's it, it aborts after that are u debugging a fork tx or a local test? fork tx question: does the debugger start up at all and then randomly crash for you? i think the issue is this line: https://github.com/foundry-rs/foundry/blob/562d876c02c3e0c5709ed10224dbde1945b660fb/ui/src/lib.rs#L931 if the loop is running too slow this can get messed up where even if we update last_tick, by the time we compare it to tick_rate, 200ms have passed yes, most of the times I use it for like 60 segs before it crashes, sometimes it doesnt crash at all are you on an obscenely slow computer fwiw (will fix regardless just curious) hmm dont think so, running wsl2, 16gb wonder if there is weird time stuff going on in wsl or something my vga is trash tho, maybe just pushed a fixed branch, wanna try it out? dunno how reproducible the panic is Howl can I deploy a contract to a special address like 0x00...01 in local test must by vm.etch? Yes thanks But address.code dont work. What if I wanna change a fork network's deployed contract? TypeError: Member ""code"" not found or not visible after argument-dependent lookup in contract btw i have no idea what happens when you overwrite a precompile with code Do vm.getCode do you know if code takes priority over precompile? Nice! So getCode can get a deployed contract's code and local sol file's code thanks so much NO....I misunderstood Hi, what to do when I encounter this error when running forge coverage? Analysing contracts...",374
1013,foundry-support.txt,"Error: could not find anchor: no matching instruction in range ContractX:14805:71:1 it should should vm.rollFork(blocknumberIwant); be able to go into the future? I get a fail on a fresh genesis network you have to manually activate pre compiles this is somewhat similar, https://github.com/foundry-rs/foundry/issues/2403 What is missing from this potential rpc method that you need for ur use case? ah thanks, I was thinking it would have been a cli switch on anvil or “cast call” well actually what i want is to spoof any sender, when running anvil in fork mode. e.g. become the usdt account or whatever. this proposed rpc seems different Why cant you prank? yes wasnt clear at first hardhat has impersonate account rpc method Hi guys! Has anyone encountered this error before? [FAIL. Reason: EvmError: Revert] setUp() (gas: 0) Traces: [177820] → new <Unknown>@""0xb4c7…7e84"" Any ideas what causes ""Etherscan could not detect the deployment""? Hi guys, how to set --ignored-error-codes to close warning of solc? The etherscan in question is just slow And doesn't pick up the contract in time If you call again the same command without --broadcast, it should work Im trying to make a soulbound 1155 but it doesnt seem that OpenSea likes the removals I made Does anyone know what Opensea requires to show tokens? I have a problem with the gas cost testing a call that is routed through a proxy. There are basically two sets of gas costs foundry reports, one for the Proxy and another for the implementation contract like this. Firstly I don't understand the difference between the two and secondly why when a Proxy delegates directly, i.e. without looking up an implementation address, the Proxy gas cost table is no longer displayed and only implementation costs show? anyone? for forge scripting, is there a method to get the txhash for calls and use the hashes as a variable inside the script? something like bytes32 txhash = address(A).call(??); hey team, i cloned a repo from github and tried to foundry-ify it. now that i run forge build it doesn't output the cache/ and out/ folders.",487
1014,foundry-support.txt,"i tried adding foundry.toml and it goes, ""nothing to compile"" when i do forge build. after removing it, it builds but output to out/ and cache/. does anyone know why? here is the toml file, [profile.default] src = 'src' out = 'artifacts' libs = [  'lib',  'node_modules', ] does anyone know whats the goal of doing this: https://github.com/ProjectOpenSea/seaport/blob/main/test/foundry/conduit/ConduitExecuteWithBatch1155.t.sol#L33-L39? i think it might be some testing pattern im not aware of. pls lemme know! thanks 🙂 What’s good intern brah Heyo, I'm trying to set up a new project repo and would like to set it all up with foundry at the beginning. From recalling the foundry docs I thought I could implement both foundry and hardhat in a way that allowed me to do unit testing wtih foundry, but use the local hardhat node (fork of mainnet) to do further testing with other external contracts, etc. I just read on a subreddit though that anvil could be used to create a local testnet node for deploying and testing smart contracts forking off of other EVM compatible networks.",267
1015,foundry-support.txt,"What is everyone doing nowadays when setting a up a project? Going with hardhat + foundry, or foundry + anvil? Also what is the reasoning for either combo? Thanks so much in advance 🙂 projectopensea/seaport is probably a good reference for a mixed setup there's also a hardhat-plugin that can use anvil https://github.com/foundry-rs/hardhat, and forge init creates a new template project which is covered here https://book.getfoundry.sh/projects/creating-a-new-project is it recommended now / seen in the majority of new projects to use just foundry + anvil? Does connecting to anvil rpc through web3py work as normal? I have done it as normal but it is still fetching mainnet blocks (blocks past my fork block num) when calling get_block can you open an issue for that ideally with a repro Hey guys, got any idea why an extremely simple ffi call would be failing? I'm on windows by the way Okay, well, after updating forge which I hadn't thought of doing I'm now getting 'program not found' does anyone know if the parity rpc methods ``trace_replayTransaction [hash,['trace']]`` and ``trace_transaction [hash]`` are equivalent? https://openethereum.github.io/JSONRPC-trace-module#trace_replaytransactionhttps://openethereum.github.io/JSONRPC-trace-module#trace_replaytransaction and https://openethereum.github.io/JSONRPC-trace-module#trace_transaction Hey everyone how do I use anvil_setBalance ? Just typing it on the terminal does not work also the foundry book doesn't say anything about the arguments/params You need to send anvil_setBalance to the node through an RPC connection I believe the params are [address, value] If your goal is to only change the balance of the accounts, you can also use: anvil --balance <ValueOfTheBalance> thank you 🙂 Anyone? Trying to simulate time passing using forked mainnet name test testFail What's pranking? impersonating.",420
1016,foundry-support.txt,"check foudry book I heard @gakonst mentioned on his ethcc talk that its possible to setup forge to format on save anyone managed to do that in vscode? We prob need it in the Solidity plugin or something Foundry would need to have an ext for vscode Is it the equivalent of doing forge fmt? Any update on some of the forge coverage issues? - or any tips on how I can debug? I am getting a ""could not find anchors for branches: we do not have the bytecode for BullaClaim"" error message. my code builds fine and passes tests. I see a similar message in https://github.com/foundry-rs/foundry/issues/2162 Keep up the good work, and thank you for the love and effort put into this tool 🙂 yep cc @onbjerg ye PR is up, pls test if u can https://github.com/foundry-rs/foundry/pull/2504 still some weird stuff with internal funcs but generally it's more lenient and won't crash if it can't find some info - it will just show up as uncovered can test w foundryup -P 2504 (requires rust) Does calling functions in a viper contract work the same with cast call and send as it does with solidity? Vyper* it should the command runs if I run with this PR. However, I am seeing 0% coverage with my tests. For reference, the logic of my contract is _mostly_ contained within internal functions, and then exposed via a few external functions. should be fine - what kind of contracts are they? any chance you could share a snippet? sure, should I dm? i've noticed one issue in solmate but seems to work as expected in lil-web3. biggest issue in solmate rn is libraries with internal funcs sure Can you use vm.getRecordedLogs() when using vm.startBroadcast()? Thanks for the work you provide ser I am trying to set up a new repo with purely foundry, anvil, and cast (no hardhat).",419
1017,foundry-support.txt,"I am following the docs I think for foundry for using the console.sol from the forge-std submodule, but it is not console.logging anything when I attempt to run tests I am trying to run foundry tests to make sure I understand how to work with local forks of mainnet, and in doing so I would like to troubleshoot what I'm doing by console.logging --> I could just bring in hardhat, but I figured it would be best to learn the ways of the foundryyyy any help is appreciated 😄 try forge test -vvvv Yea you need atleast -vvv to get the logs quick noob question, trying to understand RUST , in this image , are the .rs files under the /src the logic for forge ? Yes man I can't believe I forgot -vv lollll thanks @kesarito and @DevDoggo is there a way to read private variables in a test? You could use vm.load But it's definitely not ideal yea would need to know the storage slot right Yup You can create a getter for now and remove it later There's not a great way other than that as far as I know I was trying to use StdStorage but I can't get the func selector for .sig() because its private https://book.getfoundry.sh/reference/forge-std/std-storage Same I was having scripts outside still an issue somehow? as I get the same error can I tell the remappings to look there or something, moving it to src/ sounds weird ok it's script *NOT PLURAL*, renaming fixed it Hi, I'm trying to send a transaction on a testnet for Moonbeam (polkadot EVM), but I get an ""invalid chain id"" error.",353
1018,foundry-support.txt,"Has anyone encountered this issue before? Here's how I'm formatting my command: cast send --private-key PRIVATE_KEY --rpc-url https://rpc.api.moonbase.moonbeam.network CONTRACT_ADDRESS ""transfer(address,uint256)"" ADDRESS 1 Do we still need to go legacy to submit create to polygon mainnet? yeah even --gas-price 50000000000 did nothing (funny enough it doesn't take ""50gwei"" as input like cast send) --gas-price 50000000000 --with-gas-price 50000000000 made it pass (even if the verify failed tbd) now how to verify that deployment is another foundry mystery (rerunning without --broadcast verified the contract) now on how to verify a contract created from the CREATE2 of that new contract constructor is going to be fun... try with --chain 1287 noticed we're missing named chain support for moonbase will be added, so --chain moonbase will work We still don't know what's causing the problem on Polygon, why pricing is off there, maybe something funny with the gas price API call. I don't think ethers-js has figured that out either... worth reaching out to the polygon team you can do this already just use vscode tasks { ""label"": ""autopep8 current file"", ""type"": ""process"", ""command"": ""${config:python.formatting.autopep8Path}"", ""args"": [""--in-place"", ""${file}""] } there is an example for doing auto format for python {  ""version"": ""2.0.0"",  ""tasks"": [   {    ""label"": ""build"",    ""command"": ""forge"",    ""args"": [     ""build"",     ""--sizes"",     ""--via-ir"",     ""--watch""    ]   }  ] } https://code.visualstudio.com/docs/editor/tasks#_background-watching-tasks Seems off to me Showing about 28% coverage for a file I know I have close to 100% Happy to share more details if needed Also interestingly the lcov html report is missing some files, I am not sure if this is a forge issue or an issue with https://github.com/linux-test-project/lcov, can look at it later bump, hey team, i cloned a repo from github and tried to foundry-ify it. now that i run forge build it doesn't output the cache/ and out/ folders.",497
1019,foundry-support.txt,"i tried adding foundry.toml and it goes, ""nothing to compile"" when i do forge build. after removing it, it builds but output to out/ and cache/. does anyone know why? here is the toml file, [profile.default] src = 'src' out = 'artifacts' libs = [ 'lib', 'node_modules', ] That sounds great! I did try ""--chain 1287"" and ""--chain ""1287"""", but they both came back with ""Invalid value ""1287"" for '--chain <CHAIN_NAME>': Failed to parse chain: 1287"" anyone know why --tx-origin seems to have no impact on forge script or forge debug? example is it using fuzz tests? is there a way to parameterize forge scripts? I am having a hard time debugging things using Foundry. I want to have a console where I can interact with the contracts in real time. Do you guys use cast for this or something else? hey, sent you a DM about this. Thx forge test —debug “testName” --debug <TEST_FUNCTION>    Run a test in the debugger.       The argument passed to this flag is the name of the test function you    want to run, and it works the same as --match-test.       If more than one test matches your specified criteria, you must add    additional filters until only one test is found (see --match-contract    and --match-path).       The matching test will be opened in the debugger regardless of the    outcome of the test.       If the matching test is a fuzz test, then it will open the debugger on    the first failure case. If the fuzz test does not fail, it will open    the debugger on the last fuzz case.",359
1020,foundry-support.txt,"      For more fin you should be able to do run() i think and just step in ? ok - I was looking for a quicker way to interact with the contract but I think that will do for now thanks 🙂 gm everyone, anyone know if there is some forge test template repo for a simple scenario of approving tokens, create and adding liquidity to an uniswap v2, etc., or something like that ? https://github.com/Jeiwan/zuniswapv2 https://github.com/Jeiwan/zuniswapv2/blob/50fb69e95805970e9f0f118fc797b0a02f74f43e/test/ZuniswapV2Router.t.sol#L43 thanks a lot ! totally what i needed https://github.com/dsam82/unifap-v2 Yes In several places fuzz tests are not currently included so my guess is that is why. will work on including it today hey folks! have you ever had problems with dependencies using other versions of currently used dependencies? e.g. - lib |- A @ 2.0 |- B |- lib |- A @ 1.0 I run into problems because forge tries to compile B with A @ 2.0. does anyone have any experience with this? from the way I understand it, anything in B that imports A/ will get overridden by the remappings.txt in the root, so it will then look under lib/A instead of lib/B/lib/A. Possible way to fix would be to change all imports in B of A to A@1.0 and to make the remapping point to the correct lib by either installing a new lib/A@1.0 or renaming lib/B/A@1.0 But I think this is an issue that should be addressed if there's none up yet. Hey, does cast send not work with int256? I get uint parse error thanks! In that case, I'll open an issue later mind opening an issue for this? Is there a cheatcode to read in data from a JSON file for a foundry script? There’s a pending pr for it Got it.",433
1021,foundry-support.txt,"Good to know https://github.com/foundry-rs/foundry/pulls?q=is%3Apr+is%3Aopen+json+ A very odd bug: This passes This fails saying ""Call did not revert as expected"" This fails, with the error message that is in the expectRevert Dear Foundry Book PR Reviewers , What is the proper way to recommend something to be added to the foundry book ? should just an issue be opened for it ? to receive comments ? just read this, tested it for a while, and the debugger hasn't closed. thank you! yeah, issue with suggestion/problem then discuss/make change thanks! would be great if you could isolate this and open an issue so we can debug Yeah sorry I'll file a proper issue I am having an issue with the --ignored-error-codes flag . The book says use ""The parameter is a comma-separated list of error codes"" but when I try to do so I get an error ""invalid digit found in string"" has anyone had luck performing a swap with forking mode? running into a generic EvmError: Revert and can't seem to figure it out oop got it working by using the SwapRouter address and not SwapRouter02 🤦‍♂️ [500,501] Thank you! Hey I'm trying to import ERC721A..I've installed the library..done the remapping..but forge build refuse to run Is there any specific way I'm meant to write the mapping? Remapping*... please.. anybody How are you writing it now? Did you install it with npm or forge ? forge ..my remapping is [""ERC721A/=lib/ERC721A/contracts""] My Import is Import ""ERC721A/contracts/ERC721A.sol"" Can you please run ls lib/ERC721A yw Remove contracts from the remapping just lib/ERC721A is there any way to use deployCode/getCode cheats with a contract that needs linking? @elyx0 flattened version should work fine, regarding the create2 verification Just trying to understand setting up a repo with purely foundry, no use of NPM or hardhat.",445
1022,foundry-support.txt,"When doing so, how does one go about formatting their repo? I usually use prettier and eslint but those are node package modules right? I've noticed in some other repos that seem to use only foundry for development without npm, that they don't have prettier so I'm just a bit confused how one goes about reformatting, etc. Example repo from maple-finance: https://github.com/maple-labs/maple-core I will try this there's forge fmt still wip with some limitations/rough edges, but is usable already, if you come across something that looks weird please open an issue Very interesting. I'm talking with some of my friends and they're saying to just use bash scripts to format the smart contracts vs using prettier. Or at least that's what I'm interpretting. Would forge fmt plus some bash scripts do the trick? Also, what is the reasoning to go without NPM (for prettier, and possibly other useful packages)? I'm excited to make pure foundry projects cause they look dope but I'm still not 100% on why it is better to go pure-foundry vs using NPM too Thanks for your thoughts so far Matthias 😄 It’s definitely not an either or forge fmt is baked into forge, no big installs required Will soon be usable in CI to just run forge fmt —check to ensure everything’s formatted correctly or format on save instantly for example Can I ask Foundry to flatten it? I think forge flatten should work Greatest software 🔥 You don't need to do any linking yourself, Foundry does it for you Unless you have a different problem I was trying to deploy a contract compiled with a different solc version using the deployCode cheatcodes, but when passing in the contract (which requires linking) I got an error that this might be an abstract or unlinked contract - because the bytecode in the artifact is incomplete. My intuition is that this is currently not possible as the cheat codes expect a complete bytecode in the json file hmmm that sounds like a bug. is the repo open source? Afk right now but I’ll share a minimal reproducible repo when I can. Cheers! Hey all, just picked up foundry and really like the tooling.",453
1023,foundry-support.txt,"Wondering if there is an easy way to make solc's LSP server aware of the remappings foundry does? I googled around a bit and didn't find and answer and I am guessing because both tools are so new its not really possible. Still not working My import and remapping Try putting remapping in a remappings.txt file Didn't work I'm thinking it has something to do with my import I don't know a better way to write the inport your remapping format is incorrect you are just doing [""lib/../"",...] when it should be [""erc721a=lib/erc721/"", ...] I did that it didn't work try ""erc721a=lib/erc721a/contracts/"" I think it needs to be lib/ERC721A/=erc721a/ And you might need to check the directory structure of lib/ERC721A too see if there is smth like a src/ folder where the actual contracts are stored I will open a new window start afresh None of them worked 😪 try a forge remove and a forge install again then don’t touch the remappings in general only need to manually do remappings for some node installed stuff just set it up in your workflow file What OS? forge fmt i wouldnt use vscode shell you may be using a different shell bin than normal Windows :(((((((( Are you using WSL 2? or whatever the windows linux thing is called they are probably meaning that you should git diff your contracts and apply formatting that way instead of just running it needlessly No I am passing in an array list like you suggested and getting the error ""no matches found: [5667,5574]"" you have to be using that ser windows does use / for file system it uses \ dont pass the arguments then, or configure it in your toml file Okay will do. Thanks! I have a function taking a bytes array that's a call signature how do I put that together in solidity? usually I'd serialize that using ethers check out the solidity docs, there are functions like abi.encode and abi.encodeCall and so on yea, just reading them now thnx also if its just the selector you can use ContractName.functionName.selector, e.g. CoolToken.transfer.selector with abi.encodeCall it lists the first argument as a function pointer. Is that just the selector? no that would be the function itself.",485
1024,foundry-support.txt,"for example if your contract is named CoolToken and you want to encode for the transfer function, the first argument would be CoolToken.transfer What's in the function pointer that isn't in the selector? the function pointer is a type, the selector is just the 4 bytes you are used to the compiler uses the function pointer to get type information and make abi.encodeCall more ergonomic basically Hey there. Getting a strange error Can anyone reproduce? forge init foobar && cd foobar forge install chiru-labs/ERC721A@v4.2.0 forge update Error: fatal: Needed a single revision Unable to find current origin/master revision in submodule path 'lib/ERC721A' forge 0.2.0 (af3c9d3 2022-07-31T00:07:44.150367681Z) Trying to write my own library that uses ffi, and getting could not instantiate forked environment: relative URL without a base from nowhere for repro: https://github.com/iFrostizz/sbook in forge test is there a way to pass an argument to a test function that has been computed outside the test via scripting? if I declare test(thing), then foundry automatically assume I want to fuzz over ""thing"", but I just want to be able to pass it in from the outside, because it's the result of scripting that I can't do via foundry (namely json parsing a http req) I guess I want to forge script? thought that was only for executing stuff on-chain but there's a --fork-url flag is passing bytes supported? I mean as in --sig foo(bytes) ""0x1234"" currently trying this and getting Error: Failed to parse tokens Context: - Error #0: Hex parsing error: Invalid character 't' at position 0 - Error #1: Invalid character 't' at position 0 can't figure out what the t is, there's no t I'll make a small repro IIRC , you need to use the GitHub FQDN It installs just fine And OpenZeppelin contracts can be updated It's the update step that's failing nuke the directory and reinstall submodules is fucked I found the reason of the bug, passing -ffi is read as -f[fork-url] so the fork url is ""fi"" So I had to put ffi = true in the foundry.toml.",489
1025,foundry-support.txt,"Should I remove the alias of the fork argument on a smoll PR ? is there a playground I can dump my contract + foundry command in to get it debugged still getting this Error #0: Hex parsing error: Invalid character 't' at position 0 but I am passing ""0x1234"" there's no ""t"" in the hex fuck fuck fuck I got it error was forge test ""test_fn"" --sig ""test_fn(bytes)"" ... it only took me 2 hours is it possible to iterate through all of the function and function selectors of a contract in solidity scripting? is there any way to set a gas limit on tests or some other means to have tests fail if gas is excessive? I could write it myself with a couple gasleft() checks... lol when i lower the gas_limit then the reported gas used by the offending test drops to just below the limit This also happens on a brand new forge project https://github.com/ethereum/solidity/issues/12603 Found my answer Currently no, possibly in future --ffi I'm pretty sure that the error message was talking about -ffi so it's just a typo yes that's not the flag for foreign functions, it's --ffi Well no it's written --ffi I was probably drunk when running forge fmt I do not have output is it normal ? yes hey team, does foundry support apple m1 pro or m2 chip? ya you can always do foundryup -b master to install from source as well if the binaries are not wokring (they should) ok got it, thanks! bump, i cloned a repo from github and tried to foundry-ify it. now that i run forge build it doesn't output the cache/ and out/ folders. i tried adding foundry.toml and it goes, ""nothing to compile"" when i do forge build. after removing it, it builds but output to out/ and cache/.",394
1026,foundry-support.txt,"does anyone know why? here is the toml file, [profile.default] src = 'src' out = 'artifacts' libs = [ 'lib', 'node_modules', ] maybe because artifacts contains your hardhat artifacts? the default output is out/ for the build files yes that's right! is there a way to get around this? thank you i'm also trying to get a better understanding of how foundry does precompile contracts / optimizing them like how seaport does it here: https://github.com/ProjectOpenSea/seaport#foundry-tests.",118
1027,foundry-support.txt,what's the typical size of cache used in forge test? 'forge cache ls' shows it's 0.0 B for all three chains I am working on. but when I look into .foundry/cache/rpc/mainnet/ there are some blocknumbers. so i believe foundry does cache some data for me.,66
1028,foundry-support.txt,"for solc , cmd + shift + p > Solidity : Change global compiler version. This would allow you to quiet that error by select 0.6.12 do the former if you are still getting import errors in vscode yeah just added this to my global vscode config: ""solidity.compileUsingRemoteVersion"": ""v0.6.12+commit.27d51765"" Anybody know how I can encode a tuple? Can't seem to find a way abi.encode((1000000, 10000000000000000000)) It's for a return value for a mockCall Is it normal that anvil+forge script is somewhat slow? Deploying ~10contracts takes about 8 seconds, when doing the same inside a forge test would take much much less. It's not related to sending ~10 txs — doing the same by deploying everything in one tx takes the same amount of time. Maybe anvil writes to disk? forge verify-contract --compiler-version <VERSION> <ADDRESS> <CONTRACT> <ETHERSCAN_KEY> I don't understand i thought the point of verifying a contract was to get the etherscan abi key What issue are you facing good Ser ? i can't verify my smart contracts i'm kinda new to foundry first stop , ctrl + f in this chat, there is chance someone has solved your issue , or its a known bug. It would also help people diagnose your issue , if you copied the error message you get i did, apparently my verification command was wrong even though i followed the book yeh the code base often changes faster than the book can keep up. Pay it forward and submit a PR to the book seriously? This looks like the correct command the etherscan key refers to your etherscan API key that you can get on etherscan You can also verify at the same time you deploy by passing in your etherscan api key and using --verify oh the api key, that makes way more sense Submitting verification for [contracts/conduit/ConduitController.sol:ConduitController] Ok(""0x4a081560A2516D2abfDFf3D5B915a4cBeCD91c85"").",447
1029,foundry-support.txt,"Encountered an error verifying this contract: Response: NOTOK Details: Invalid API Key ok for some reason the api key is invalid https://api-rinkeby.etherscan.io/ i used this one that's what i was just asking lol why is the api key invalid its the one i got from the etherscan documentation https://docs.etherscan.io/v/rinkeby-etherscan Hey, how can we get/read the address of a previously deployed contract from within a Script? thanks 🙏 when fuzz testing, is there any way within a single test function to expect different behavior depending on the inputs? ie. expect a pass in certain cases and a fail/revert in others based on different input values, or is it better/necessary to separate into two functions and use vm.assume to restrict ranges to expected passes in one function and expected fails in the other? that is an api endpoint not a api key. look here instead https://info.etherscan.com/api-keys/ address({your contract variable}) I guess this would work if the contract was deployed in the same script. My question was about the case when it was deployed from another script. Sorry I didn't formulated well my question my bad misinterpreted your question. i’m not sure then, still pretty new to foundry myself. perhaps someone else could help to answer this. You have to use your own accounts api key Just to double check, forge test --gas-report does not work for fuzzed tests? ah, ofc it's not supported, because the test itself has its own logic written in Solidity, so it wouldn't show correct values Any way to see what fuzz values are being tested? How do I import OZ files ""Unable to resolve import: ""@openzeppelin"" I got that working using forge install OpenZeppelin/openzeppelin-contracts, need to update VS code so it doesn't show up as an error in the editor.",394
1030,foundry-support.txt,"add the remappings to the settings.json file hey i'm trying to read bash env vars using cheats.getBool(key) and keep getting the error ""environment variable not found"" i'm setting the environment variables by running source env.local before running my forge script can you please open an issue for this with a dummy excerpt of the env fille? yea sure, give me a sec can you try echoing the variable in the shell? yea it's there my script runs like: $ echo $ENVVAR && forge script/script.sol --ffi i'll put together an example in a min It's strange, I just re-cloned a repo and when I ran forge install to pull in the dependencies, It's just giving me errors of remote Repository not found for openzeppelin-contracts-upgradeable are you running  forge install https://github.com/OpenZeppelin/openzeppelin-contracts-upgradeable yesser open an issue ser. also foundryup for good measures It's a freshly installed OS, so I figure I'd check and see if there was some dumb thing I missed in setting up before I do the issue. It was weird, cuz when I first ran it in here, my vscode attempted to just delete all the dependencies. But then couldn't reinstall them. Now it is only struggling with this OZ upgradable Foundry Support Ok, super weird... this just worked, while the one that you'd checked me with didn't: https://github.com/OpenZeppelin/openzeppelin-contracts-upgradeable.git hmm.. https v git .. probably a transport / connectivity issue @mattsse @SamuelDare https://github.com/marcusmolchany/foundry-env-vars-in-script oh u said open an issue, one sec I have used this envBool cheat code before , but looking at the code , it expect calldata I just went through and re did all the SSH keys, just to make sure. It's strange. It just fails from within vscode term, but then it asks me for my gh username & pw on the normal terminal, then fails because it wants that and you can't use that lol...",434
1031,foundry-support.txt,"Is it something where forge install tries to run clone it in a way that's not allowed? No clue forge install uses sub modules so your answer is probably around there Does anyone have suggestions for testing emitted events from the implementation of a proxy contract delegatecall'd to? Keep receiving Log != expected log and saw this issue which mentioned such events are not detected: https://github.com/foundry-rs/foundry/issues/668 . https://github.com/foundry-rs/forge-std/issues/141 Hello everyone. One question, how to perform unit tests with Chainlink VRF V2? Could someone give me some advice or a repository as a guide? Had this issue today, only tests run with forge test seem to be able to utilize the external cheats. Any advice on this? Having external access with scripts is essential for deployments sometimes Weird. I just uninstalled everything and redid it from the ground up and it works... not going to open an issue since it was probably something weird with a configuration. oh well 🤷 I'm trying to run a coverage report, and I get this error, but I'm not sure where it'd be coming from since there's no other stack too deep errors. I'd even moved a bunch of the test local/memory variables into a struct so that it would reduce the stack (I'd initially gotten that stack too deep during an end to end test before pulling them into the struct) `Error: Compiler run failed CompilerError: Stack too deep when compiling inline assembly: Variable headStart is 1 slot(s) too deep inside the stack.` some permission issue in shell autocompletion your loading a different shell environment vscode is loading for whatever reason not your normal shell path run forge completions zsh > tothefile and make it executable There is no issue the issue is with your command source. When you source the file, the const assignments will be set but the variables are not exported unless the allexport option has been set. you enable allexport by doing set +a so just do: set +a . env.local; set -a; https://man7.org/linux/man-pages/man1/set.1p.html this still doesnt work with the script adding export to all the variables works though: export BOOL_ENV_VAR=true export BOOL_ENV_VAR_2=false export STRING_ENV_VAR=""I am a string"" foundry-env-vars-in-script $.",486
1032,foundry-support.txt,".env.local foundry-env-vars-in-script $forge script script/Contract.s.sol -vvvvv [⠢] Compiling... No files changed, compilation skipped Traces: [98] ContractScript::setUp()  └─ ← () [9463] ContractScript::run()  ├─ [0] VM::envBool(""BOOL_ENV_VAR"")  │ └─ ← true  ├─ [0] console::log(""BOOL_ENV_VAR"", true) [staticcall]  │ └─ ← ()  ├─ [0] VM::envBool(""BOOL_ENV_VAR_2"")  │ └─ ← false  ├─ [0] console::log(""BOOL_ENV_VAR_2"", false) [staticcall]  │ └─ ← ()  ├─ [0] VM::envString(""STRING_ENV_VAR"")  │ └─ ← ""I am a string""  ├─ [0] console::log(""STRING_ENV_VAR"", ""I am a string"") [staticcall]  │ └─ ← ()  └─ ← () ctrl + f.. IIRC , forge coverage doesnt compile via-ir , so that's why you are getting this Follow thread here : https://t.me/foundry_support/16190 hey guys, can I write tests in rust? I'm still curious about anvil seeming way slower than forge. Specifically sending ~10 deploys to anvil with forge scripts takes ~8s, doing those deploys in a forge test takes ~3s. Not sure where the difference comes from Hi all, installing on Windows 11 x64 gives me the following error.",340
1033,foundry-support.txt,"Is there a workaround (except Linux installation :D)? Compiling revm v1.8.0                                              error[E0658]: deriving `Default` on enums is experimental --> C:\Users\Alexander\.cargo\registry\src\github.com-1ecc6299db9ec823\revm-1.8.0\src\db\in_memory_db.rs:41:24 | 41 | #[derive(Debug, Clone, Default)] |      ^^^^^^^ | = note: see issue #86985 <https://github.com/rust-lang/rust/issues/86985> for more information = note: this error originates in the derive macro `Default` (in Nightly builds, run with -Z macro-backtrace for more info) For more information about this error, try `rustc --explain E0658`. error: could not compile `revm` due to previous error warning: build failed, waiting for other jobs to finish... how are you accessing anvil ? through localhost:8545 or another? yes, localhost I tried sending the deploys as a single tx (one big deploying contract), same time used Are the 8 seconds about the broadcasting part, or are you including the local and on chain simulation ? most of that time is waiting for receipts not sur how to precisely split the two but I would say about 6s Right, so the simulation before seems to take maybe 1-2s. So there's definitely something different about how anvil runs the txs.",309
1034,foundry-support.txt,"Hm, strange, that should basically be instant when dealing with an anvil localhost I've just looked at the anvil default logs Actually the contract creation logs appear very fast, for instance Transaction: 0xf347eb6c146b8b330903bd46e160e706d425cae4b3d165caed7e3de359ee1c3d  Contract created: 0x4ed7c70f96b99c776995fb64377f0d4ab3b0e1c1  Gas used: 4126803  Transaction: 0x2632441b4cc7d98f8a659145e5c0a6ff1d91d9b927f4a76e31042b871d4e31ec  Contract created: 0x322813fd9a801c5507c9de605d63cea4f2ce6c44  Gas used: 4429088  Block Number: 11  Block Hash: 0xaeed4323bf4e3b1288682c11531176e6e6e8a5b74780888d44190f1c36fe4259  Block Time: ""Tue, 02 Aug 2022 11:35:34 +0000"" Then there's a long pause (~5s?), where the forge script side is saying Waiting for receipts.",301
1035,foundry-support.txt,"And then, on anvil side I get: eth_getTransactionByHash eth_getTransactionByHash (...) eth_getTransactionReceipt eth_getTransactionReceipt yeah, by default we wait 7 seconds for the receipt but in case its a localhost rpc, we dont or shouldnt lol that seems like a likely culprit haha how do you determine localhost/not localhost? let me see if I use the default port, I've been using 8546 we just check if the rpc string has localhost or 127.0.0.1 so it should technically work hmm --rpc-url http://127.0.0.1:8545 also getting 7s wait with --rpc-url http://localhost:8545 @joshiedo did you find anything? happy to keep trying things on my end if that helps how do you verify contract in polyscan using foundry ? wihtin a script Hi, im trying to call a certain contract and I am getting the same error everytime: Error: ProviderError(JsonRpcError(JsonRpcError { code: 3, message: ""execution reverted"", data: Some(String(""0x"")) })) code: cast send 0xbEbc44782C7dB0a1A60Cb6fe97d0b483032FF1C7 ""mint1t1FRAX(uint256,uint256)()"" 10000000 9000000000000000000 --from ""0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266"" Hi, I am learning scripts and anything I do seems to fail to add more than 1 private key when not using interactive mode, can anyone provide an example of a command to load multiple keys from a mnemonic? Anyone ? 🙄 I answered you in the core chat ty When I run this command even though my out folder has a bunch of subdirectories containing json files, it doesn't recognize this. `zsh: no matches found: ""out/**/*.json""` i am having trouble verifying my contracts using a deployment script. not sure if im doing something dumb or something else ```Start Contract Verification Submitting verification for [src/Whitelist.sol:Whitelist] Ok(""0x029d4D56fb2B9cfCD0e6e2F294858572a144B97B"").",477
1036,foundry-support.txt,"Submitting verification for [src/Whitelist.sol:Whitelist] Ok(""0x029d4D56fb2B9cfCD0e6e2F294858572a144B97B""). Transactions saved to: broadcast/Deploy.s.sol/5/run-latest.json Error: Etherscan could not detect the deployment.``` A standard grep will find these files so I dunno whats up POSIX ME HARDER you dont neeed to quote glob npx typechain --discriminate-types --target ethers-v5 out/**/*.json Also zsh different globbing characteristics than bash iirc is there not a cheatcode for printing to stdout? https://book.getfoundry.sh/cheatcodes/external do people use ffi for this? i’m sure i’m missing something obvious, how come print isn’t a first class cheatcode? hey guys, I tried deploying this contract and I got this error uccess. Error:  0: Invalid data Location: cli/src/cmd/create.rs:131 I'm still a noob with foundry aaand it’s because there’s console.log lol that was hard to find for some reason, sry all Is using storage in scripts not recommended? Is it much more expensive for the deploy? e.g. I am using an array and can only call`.push` if the array is stored in storage. Wondering if I should just use an index and use memory. But I know dynamic arrays are not available in memory nice! this worked for me. thank you!! add options --chain-id for goerli --chain-id 5 \ didnt work but surely it should pick it up from the RPC? didnt read the docs properly lol ...  --delay 5 \  --retries 3 \ ... just needed to give it a bit of a delay More broadly wondering if storage in scripts counts toward the gas cost of deploying the contract. Hey I'm trying to verify a contract on moonbase alpha. When I verify with forge verify-contract --chain moonbase I get a 200 response (although moonscan's UI still doesn't show that its been verified about 30 mins later). When I try to verify during deployment with forge script --broadcast --verify --chain-id 1287 I get a ""Chain moonbeam-dev not supported"" error.",470
1037,foundry-support.txt,"Is moonbase alpha truly not supported yet? Seems odd that forge verify-contract --chain will accept a moonbase arg if thats the case Ah y probably needs to be added Quick pr for anyone interested added naming support for moonbase just a couple of days ago, can you check with latest nightly? bumping check the vm.derive cheatcodes! i.e. dont try to do it from CLI https://github.com/foundry-rs/foundry/pull/2299 https://github.com/foundry-rs/forge-std/pull/130 https://github.com/foundry-rs/book/issues/452 <— open issue here which we should take Hello, is anyone using Foundry in GH Actions workflows without the official action? This is my bad, I've been very busy with some other work lately and haven't had a chance to add the remember Cheatcode I also wanted to and then document it all. Soon ™️ Woow this is even better, thank you so much! Even though I wonder how should arguments be passed for`--mnemonic-indexes` or --private-keys? how do I pass aray of number with cast? something like so use the ethers abiEncoder class is enough? cast call 0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D \ ""getAmountsOut(uint,address[])"" 1 ""[0x6b...0f,0xc0...c2]"" something like that anyone know if the gas used in a script (e.g.",326
1038,foundry-support.txt,"to store things in the script contract) contributes to deployment cost? what if i need an array of numbers? do I encode each one and the do cast call 0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D \ ""getAmountsOut(uint[])"" ""[0x6b...0f,0xc0...c2]"" ? yep would help if somebody wrote it in the docs :p think you can pass them as decimals? —private-keys 0x1234 —private-keys 0x2345 CTRL + C => CTRL + V 😅 i dont think so im trying to call this: cast call ${FRAXBP_Pool} ""add_liquidity(uint256[], uint256)(uint256)"" ""[100,100]"" ${minFraxBPOut} I tried to encode the array but its not working btw this call doesnt work obviously call or send hey there folks, is there any way to send structs cross contracts? they are exactly the same, but I'm getting an error Proposal memory proposal = IOnboardProposal(onboardProposal).proposals(_proposalId); two different things, call is for view functions and send will push the tx to chain Type struct IOnboardProposal.Proposal memory is not implicitly convertible to expected type struct Executor.Proposal memory.",283
1039,foundry-support.txt,"yeah one sec hmm sorry yeah its a send but I think the aray is still giving me problems the way i did it was just with copying struct structure across contracts cast send 0xDcEF968d416a41Cdac0ED8702fAC8128A64241A2 ""add_liquidity(uint256[], uint256)(uint256)"" ""[100000000000000000000,100000000]"" 80000000000000000000 --from 0xed320Bf569E5F3c4e9313391708ddBFc58e296bb' thats the call i am making and its failing failing with what `stderr: 'Error: \n' + '\x1B[31mProviderError(JsonRpcError(JsonRpcError { code: 3, message: ""execution reverted"", data: Some(String(""0x"")) }))\x1B[0m\n' ` Hey has anyone run into this error? ""EvmError: OverflowPayment"" I am guessing that it has something to do with sending ether. I have a a contract that inherits another contract in case that is relevant. looks like its getting to the contract alright but the contract reverts yeah maybe.... i've gotten this error with other casts as well they are exactly the same, but they are somehow non convertible which is weird... couldnt point out what actually solved it i just copy pasted struct thorugh interface as well is the way that I m passing the uint256[] array correct? think so where in the docs do they even show how to pass arrays? I'm on pragma 8.13 btw under cast send cant see it https://book.getfoundry.sh/reference/cast/cast-send i found it under call but i cant get this to work... this is frustrating lol Hmm still getting a ""Chain moonbeam-dev not supported"" error when I try to verify during deployment with forge script --broadcast --verify --chain-id 1287.",404
1040,foundry-support.txt,"does the tx get sent like do you have a txid I actually got it to work sick! when the functions demands an array of uint you gotta pass the size of the array so uint256[2] that was the issue, cuz the curve contracts are written in Vyper so I guess its a must yeah dynamic and static arrays are different yup glad you got it sorted thanks man! appreciate your help what's your forge --version I tried it on forge 0.2.0 (8016f26 2022-08-02T00:17:15.28384Z) and 9ed1c37 oops we assigned 1287 to moonbeamdev fixed here https://github.com/gakonst/ethers-rs/pull/1552 Woops! lol thanks for the fix 🙂 can the lib config in foundry.toml resolve paths to home dir? say i have a directory $HOME/deps where i want to use for remappings outside the project folder Thnx. ran into a weird typechain error with this... Error occured: '{' expected. Does expectRevert not work if the revert is inherited or this? There is a different chest code for over flow ctrl + f in the chat your not sourcing the env, there is a dot in there . No It cant be outside the git repo you may be able o do some symlink hackery tho Ah! Very simple. Just import stdError from Test.sol in forge-std: using stdError for bytes; And vm.expectRevert(stdError.arithmeticError); Say , once .rs gets compiled , there is no way to decompile to source right ? hey, does foundry offer any tool to help deal with EIP170 spurious dragon error? Since Seaport is kinda foundry heavy and they have over 100 files when i tried to compile it. They have must ran some command to generate the optimized-out/ folder that allows faster compilation (but i'm not sure if that's related to contract size).",412
1041,foundry-support.txt,"hi, running this command: cast send 0x0a17FabeA4633ce714F1Fa4a2dcA62C3bAc4758d ""pool_mint(address,uint256)()"" 0xed320Bf569E5F3c4e9313391708ddBFc58e296bb 10000000 --gas-limit 1000000000000 --from 0x0Dd99d9f56A14E9D53b2DdC62D9f0bAbe806647A getting code: -32602, message: ""No Signer available"", data: None anyone knows what this error means? I supplied the --from code: -32003, message: ""Out of gas: required gas exceeds allowance: 0"", data: None this error is now showing I assume its requesting for ETH to pay for the gas... how do I manipulate the given user's ETH allowance? Maybe you can send ETH to it from a given account ? Am I doing something wring? Is it possible to set env variables to persist after the forge command execution? $ forge script script/Demo.s.sol:Test -vvvv [⠔] Compiling... No files changed, compilation skipped Traces: [5068] Test::run()  ├─ [0] VM::setEnv(""MY_LOVELY_STRING"", ""Foundryyy!"")  │ └─ ← ()  ├─ [0] VM::envString(""MY_LOVELY_STRING"")  │ └─ ← ""Foundryyy!""  └─ ← () Script ran successfully. Gas used: 5068 $ echo $MY_LOVELY_STRING $ Hello, I am having some problem when trying to mock with vm.mockCall a method that doesnt return anything. I dont know what i have to put on the return param of the mockCall. Tried changing the method I want to mock to return bool for example and then it works. But I need to mock it as it is (without return). How can I do it? Any guidance on this will be appreciated, thx! Is it expected for a test to pass if I .expectRevert but it didn't revert? Because I just had a test pass that way.",472
1042,foundry-support.txt,"submitted the bug report: https://github.com/foundry-rs/foundry/issues/2575 solved on this issue: https://github.com/foundry-rs/foundry/issues/1987 thx! What's the syntax for constructor-args-path file ? I want to input array someone manage to trigger forge fmt at each save ? Ctrl + F in this chat Check their foundry.toml file probably optimiser runs and via-or I'll pay 100$/h to someone for answering all my stupid ""how to do X in foundry"" questions. DM me if you're interested. Post here we do it for free Ser Response times are pretty decent AFAIK. Also going through the book would take you about an hour I have a forge create script like this: forge create src/Badges.sol:Badges --constructor-args $BADGES_NAME $BADGES_SYMBOL $BADGES_VERSION but I upgraded to upgradeable contracts, where I no longer have a constructor am I no longer able to use forge create? DM me and you won't have to! When trying to use metamask on an anvil fork, I’m getting error of “RPC URL is different chain id to the one you entered” But I set chain id flag Es possible ? Oh nvm just uses chain Id 1 lol is it possible, when using a mockCall to make the mocked call revert? Tried it various things but wasn't able to. you mean in metamask settings? bc anvil should use the chain id of the fork if not set explicitly Yeah I’ve got it now thanks, but when I set it explicitly it still used the fork Id But that’s fine anyway, ty for the help hmm can't reproduce this anvil -f ....",357
1043,foundry-support.txt,"--chain-id 99 curl -X POST -H ""Content-Type: application/json"" -d '{""jsonrpc"":""2.0"",""method"":""eth_chainId"",""params"":[],""id"":83}' http://localhost:8545 gives {""jsonrpc"":""2.0"",""id"":83,""result"":""0x63""} (99) Hi, trying to call remove_liquidity from curve pool but I cant seem to figure out the params cast send 0x48fcFFa86fb24bDEB45B5739F7Ced24095A7c8e8 ""remove_liquidity(uint256,uint256[2],address)(uint256[2])"" 100000000000000000000 ""[0,0]"" ""0xed320Bf569E5F3c4e9313391708ddBFc58e296bb"" --from 0xed320Bf569E5F3c4e9313391708ddBFc58e296bb that's my call anyone knows what's wrong with this? try adding --chain-id 5 maybe useful for some of you once. I built a Solidity function that converts a normal signature into a 2098 formatted signature. Had to do this for my snekmate ECDSA Vyper tests: https://github.com/pcaversaccio/snekmate/blob/main/test/utils/ECDSA.t.sol#L18 Hi, is there a tool for checking the coverage for the solidity test contracts? forge coverage When deploying with forge script, is there a way to fill the contractName field of the .json output? it should be getting filled automatically? for known contracts I'm doing something wrong then maybe, should contracts be created in any special way? I'm doing broadcast then new Contract in a script, then forge script TheScript forge coverage is giving me strange results. I have a contract that inherits from another contract, and doesn't override anything but one function. And yet coverage shows 0% for the inherited contract. Just doing forge init and then adding new Contract() to the default ContractScript fails to fill in contractName forge coverage still needs improvements 🙂 please open an issue with a minimal repro of your code and we can investigate Fixed it thanks, the issue was not the chain I’d, it detects it from the rpc.",477
1044,foundry-support.txt,"Just needed to add retries and a delay, etherscan is a bit slow to detect forge script with automatic verification is such a killer feature for contract deployment. know i'm late on this one but just wanted to say well done ❤️ Hey everyone. Is there a way to grab a nightly build of Foundry from a few weeks ago w/o building from source? Github seems to clear out releases older than a few days. Also having an issue with Anvil builds from the past few days not caching some calls, looks like eth_getTransactionByHash calls are being forwarded to Alchemy when forking regardless of cache settings. Clone, git checkout an older commit, build Can you open an issue for the anvil thing? https://github.com/foundry-rs/foundry/blob/44f3a4b7aebfb58af4beffc71421d02d08ba0c40/cli/src/cmd/forge/verify.rs#L77 I think it gets it from the chain-id value you pass in, and if you don't pass one in, chain-id defaults to mainnet will do. Thank you ser and all of the community for such a fantastic dev tooling suite! can we pass command line arguments to foundry solidity scripts? Yes function run(address) Hey, vm.expectRevert is not working in my case can you help me? why? Is there any version error? hey folks, computing uint256 is giving me quite a headache, would really appreciate if someone could help me if available trying to compute the following: result = priceRatio * _amount * _length * 1e12 / 3650000; when I get the result, in another function, I try to divide it by 1e12 to get the actual value and it ends up resulting in 0. I'm console logging the result and on my tests it returns 246575342465. But trying to divide it by 1e12 results in 0 246575342465 / 1000000000000 = 0.246, which is less than 1. You're using integer values so it goes to 0 I assume Hey I was wondering if someone could point me in the right direction: is there a way to set the rpc url per chain? I can edit the ""eth_rpc_url"" in foundry.toml, which works fine.",485
1045,foundry-support.txt,"I was wondering if I could have it so that it could change based on what I passed into --chain for my commands. I did try [profile.default.rpc_endpoints] but I may have incorrectly set it up, just want to know if that’s the right configuration to be looking at isn't 1e12 7698 in hexadecimal? man, if its 1 * 10**12, I'm pissed hahaah Ah, sorry I didn't realize that you meant that 246575342465 was in hexidecimal no no, its not! I thought 1e12 was another way to express numbers in hexadecimal I saw it popping in some ocntracts asked a dev friend anyone has any idea when removing liquidity from curve pool, do I need to give any approve? and he said that it was a hexadecimal I'm fairly certain that the 0x indicates hexadecimal and e indicates power of 10 but makes sense yep true is the any way to customize the data saved from script broadcasts? e.g. if we wanted to get rid of the ""data"" key, or maybe make something more lightweight that just stores the deployed contract addresses?( If anyone wants persistent env variables in your scripts (stored on your hard drive, I know, very env) I made a cool script to manage them. Potentially some logic could be introduced that bases on past info generated in evm context such as deployment address, some parameters, storage slots... Still very basic though https://github.com/Czar102/forgemate/blob/main/src/Env.sol can you post how you are calling it? Cool thanks, I set the via_ir = true and optimizer = false Solidity version 0.8.13 Getting a more useful error now, but it says “YulException: Variable expr_135_address is 2 slots too deep inside the stack.” Im not sure where that would be located? Is there some way to get it to tell me which line/file it’s running into it? The normal compiler has no issue, and now im wondering if this would cause an issue for deployment or if it’s just the way foundry checks coverage? I had the same issue when I wanted to up it for just the time of one test, I ended up doing like you with the .toml config could be possible with some vm.",474
1046,foundry-support.txt,"tricks probably but I didn't find anything obvious Import path error, Guys i'm trying to use wsl2 and start contract development with foundry. I'm getting this import path error. can anyone please help me on this Got it to work with an older build, will file an issue when I can find some time to make a test case, thanks! 🙏 Set your remappings txt Check the book on vscode sure i will try that. Thank You is there any way to run coverage excluding directories / files ? forge test gives these warnings: warning[2519]: Warning: This declaration shadows an existing declaration. --> test/Crafting.t.sol:18:13: | 18 |    BattlePass bp = new BattlePass("""", address(crafting)); |    ^^^^^^^^^^^^^ Note: The shadowed declaration is here: --> test/Crafting.t.sol:23:9: | 23 |   BattlePass bp = new BattlePass("""", address(crafting)); |   ^^^^^^^^^^^^^  function setUp() public {   crafting = new Crafting();   for (uint256 x = 0; x < inputLength; x++) {    BattlePass bp = new BattlePass("""", address(crafting));   }   BattlePass bp = new BattlePass("""", address(crafting));  } this is prolly a small bug right? Hello, is it possible coverage doesn’t yet handle inheritance properly? I am getting 25% branch coverage on a super simple contract which overrides parent’s methods and line coverage is 100%. Thank you https://github.com/AztecProtocol/aztec-connect-bridges/blob/master/src/bridges/example/ExampleBridge.sol When I remove the inheritance I get the same result so it’ not that gm.",361
1047,foundry-support.txt,"how can i skip fuzz tests on forge snapshot? this was the default behavior until last night's release (with this change: https://github.com/foundry-rs/foundry/pull/2591) they are deleted unfortunately what's a correct way to expect revert with a custom error? found it in Seaport something like vm.expectRevert(abi.encodeWithSignature(""InvalidNativeOfferItem()"")); vm.expectRevert(Errorname.selector) also works that would mean I would have to define the same error in the test contract though, right? No you just need to import the contract I tried that before, but it can't find the error: Member ""..."" not found or not visible after argument... Weird I use them like that. Post a snippet a let me see if I can figure out what’s wrong Works in my code here https://github.com/AztecProtocol/aztec-connect-bridges/blob/6388b08be07ebd4d86a2de8e6bf2ca3c2cc8ac5b/src/test/bridges/liquity/StakingBridgeUnit.t.sol#L43 maybe it's because of inheritance https://github.com/rumble-kong-league/tiny-rkl-erc721/blob/main/test/Rookies.test.sol#L87 When fuzzing is there a way to avoid having addresses generated be contract addresses? so restrict the generated addresses to EOA only ic Create2Deployer in the verbose logs here, so assume there is contract creation sometimes that gets fed into the fuzzed args. nevermind, I can just vm.assume(account.code.length == 0), I think Hello there, Any idea why i got this error this is the first time? ProviderError(JsonRpcError(JsonRpcError { code: -32603, message: ""EVM error InvalidOpcode"", data: None })) I am using macos for the first time just would like to run on it no idea if it's link to the issue hope those private keys are not dummies There is a plenty of ethers on it oups! Joking that the default foundry keys guys. kek lol shouldnt you be sending some ether to the function? I tried same output..",452
1048,foundry-support.txt,"I don't know if the VM has assert If you're running connected to a localhost you will need to check if that opcode is supported Anvil VS hardhat VS ganache Not sure about anvil but I know hardhat and ganache function very differently in certain circumstances You are right! First time i tried to use assert instead of require Also you might want to check out forge script instead of cast You can write scripts directly in solidity it's really neat Yep but just for calling main() was bit overkill ahah But thanks anyway 🙂 Anyone has an idea how to use the opcode assert inside anvil so, really like using anvil don't want to change to hardhat everytime i have to deal with assert ahah Any issues with assertTrue? How the fuck did you know ?! Yep it works well with assert(true) weird no? Sorry meant assertEq Trying 😉 Does anyone have any problems verifying contracts? I can deploy them no problem but whenever I try to verify them I get the message ""Etherscan could not detect the deployment"" Location: cli\src\cmd\forge\verify.rs:140 How can I get it to keep state between tests? just send the same command but swap out --broadcast with --resume for now Are there any examples of deploying raw bytecode using forge/cast? Seconded. Currently trying to cast a hex string in forge to bytes and uploading it. But the string 0xaa for example gets uploaded as 4 bytes when it should be one byte. bytes[] public traits = [bytes(""0xaa"")] In hardhat this works ""magically"". You can pass a hex string to a solidity function that accepts bytes, and it does the right thing. e.g. 0xaa is one byte. any examples of forge github actions that handle Fork testing ? i want to add GH secrets to construct --fork-url ${FORK_URL} but i cant find any examples, most templates just use forge test why do you use vscode terminal ? yes One sec https://gist.github.com/sambacha/89129cdeb59fd6098a5b46ea8b9664e2 I know Georgios mentioned forge coverage isn't yet done, but is there a way to see which branches specifically aren't covered? Right now it only shows the %es.",466
1049,foundry-support.txt,"Try this It'll open in the browser for forge scripting whats the best way to work with dynamic inputs? is there a way to pass args to the run function and add them to the script command? oh god, I love foundry. Thanks! I have tried it. Now I have another error. It says ""The application panicked (crashed). Message: Target not found? Location: cli\src\cmd\forge\script\build.rs:163"" is there any way to run forge fmt before each commit so that someone's local style settings dont make it to the commit? i tried setting up a pre commit hook but it requires two commits, im trying to make it so that as soon as u commit, forge fmt is run, and then it actually commits. I have !/bin/sh forge fmt in .git/hooks/pre-commit.sh the docs state that via the —sig flag to froge script command calldata can be specified. Is that the only way? fixed by using husky, disabling solidity for solidity and using run on save vs code extension Running latest foundryup/forge version im hunting down an issue on strategy mix but getting this weird error, not sure if its on my end or forge, if nobody else is seeing it i can add an issue to reproduce [PASS] testStrategyOperation(uint256) (runs: 256, μ: 458096, ~: 458097) The application panicked (crashed). Message: division by zero Location: /Users/runner/.cargo/registry/src/github.com-1ecc6299db9ec823/primitive-types-0.11.1/src/lib.rs:38 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets.",388
1050,foundry-support.txt,"make: *** [test] Abort trap: 6 I think there is a PR out to fix this Merged so should be fixed in the next release : https://github.com/foundry-rs/foundry/pull/2612 im trying to deploy some contracts with forge script, and trying to match addresses to contract names in my run-latest.json, but contractNames are all null   ""hash"": ""0xe09b2ed25b5b67f0609067a6e60d3da692ab171d61954c5d5d6969cc09bafed0"",  ""transactionType"": ""CREATE"",  ""contractName"": null,  ""contractAddress"": ""0xd7677b7bfdfb796fbe5d25599e56dc6d826c9417"", any ideas ? Do forks used in cheatcodes use the disk cache? Running tests with —rpc-url and —fork-block-number runs slow the first time, creates files in ~/.foundry/cache, then runs fast Doing the same with cheatcodes keeps running slow despite creating cache files Hi! Is there a way to mock the return value of a function call? I couldn't find any specific cheatcode that does that. you can snapshot right before the function call, and then revert back to the previous state https://book.getfoundry.sh/cheatcodes/snapshots vm.mockCall https://book.getfoundry.sh/cheatcodes/mock-call Oh interesting. What if I can't directly access this function call (i.e it's inside a function that I'm trying to test) ? Example: function getOraclePrice() public view returns (uint256 value) {   (uint80 roundId, int256 price, , , uint80 answeredInRound) = chainlinkFeed.latestRoundData();   if (price <= 0 || answeredInRound != roundId) revert InvalidOracleAnswer();   ........ } I'm trying to test that InvalidOracleAnswer error. But to trigger it, I need that condition to be met. Which means that I need to be able to mock the return data for chainlinkFeed.latestRoundData() ah, i misunderstood your initial question. it shoulds like matt's suggestion would work for you though I'm slightly confused by the mockCall cheatcode. Can I specify whatever return data I want there? According to this description that doesn't seem to be the case.",497
1051,foundry-support.txt,"Or maybe I'm misunderstanding something. hey about forge script command, if I add --slow flag does each transaction query new state before create new transaction receipts? or is there any way to work around? Huh That work out for you ser Will test tomorrow anyone has a way to pass dynamic inputs to deployment scripts? for example passing it an address of a contract which differs across networks ""forge script …. —sig calldata” works but would be cool if those could just be passed as args on the cli level and generate the calldata behind the scenes Hey does anyone know what the correct contract signature will be for a contract that accepts an interface as a parameter: Is it: ""name(Interface)"" or ""name(address)"" Will obviously be taking the 1st 4 bytes of the hash etc etc any good way to log arbitrary structs? I think forge coverage --report lcov should fail if any of the tests fail. name(address) what's the convention to test internal functions? I am thinking create a contract inherit the contract to test. And create public wrappers for internal functions. That's what I do you found a bug in cast, no? the signature array was being encoded incorrectly? Hate to be pestering but any update on when there might be coverage with optimizer settings and via-ir? Hello guys, Any idea how to print mapping using emit log ? Would like to work to understand more about mapping but do we have a way to display the global mapping like in rust using println("":?"",mytab); +1 anyone came across this error when deploying and verifying? “You can only verify deployments from inside a project! Make sure it exists with forge tree.” Am getting evmError: revert for my NFT mints now after I did foundryup Any ideas New unknown at 0x9dba…23ba If anyone has any ideas please lmk Was never like this before Verifying contract using forge. It says response Ok submitted. But the contract is not verifying What shooudl I do It gets deployed successfully https://goerli.etherscan.io/address/0xdb319cf580ba417268c54603fe16c1855ab81699 Hi all! I’m trying to deploy a contract to Rinkeby with foundry.",458
1052,foundry-support.txt,"It seems I need to raise the gas limit for the tx, how can I do that? Oh never mind! —gas-limit Anyone having issues with foundry not using Etherscan to ABI decode calls to common contracts (e.g. Uniswap) in tests? I've set the Etherscan API key in my foundry.toml Actually it doesn’t work what am I supposed to put in there? I assume its probably not in Wei? I always get “gas required exceeds allowance (0)”. It was the rpc node.",110
1053,foundry-support.txt,"Probably disabled looks like etherscan is having trouble right now https://etherscan.io/contractsVerified they must be behind anyone else seeing an error trying to compile from source recently? error[E0282]: type annotations needed --> cli/src/cmd/utils.rs:201:35  | 201 |     .with_key(""eta"", |state| format!(""{:.1}s"", state.eta().as_secs_f64()))  |         ^^^^^ consider giving this closure parameter a type  | ::: cli/src/cmd/forge/script/receipts.rs:39:14  | 39 |  let pb = init_progress!(tx_hashes, ""receipts"");  |    ------------------------------------- in this macro invocation  |  = note: type must be known at this point  = note: this error originates in the macro `init_progress` (in Nightly builds, run with -Z macro-backtrace for more info) error[E0277]: the trait bound `u64: Neg` is not satisfied --> cli/src/cmd/forge/script/receipts.rs:40:26 | 40 |  update_progress!(pb, -1); |       ^^ the trait `Neg` is not implemented for `u64` | = help: the following other types implement trait `Neg`:    &f32    &f64    &i128    &i16    &i32    &i64    &i8    &isize   and 8 others error[E0282]: type annotations needed --> cli/src/cmd/utils.rs:201:35  | 201 |     .with_key(""eta"", |state| format!(""{:.1}s"", state.eta().as_secs_f64()))  |         ^^^^^ consider giving this closure parameter a type  | ::: cli/src/cmd/forge/script/broadcast.rs:98:22  | 98 |    let pb = init_progress!(deployment_sequence.transactions, ""txes"");  |      -------------------------------------------------------- in this macro invocation  |  = note: type must be known at this point  = note: this error originates in the macro `init_progress` (in Nightly builds, run with -Z macro-backtrace for more info) Some errors have detailed explanations: E0277, E0282. For more information about an error, try `rustc --explain E0277`.",476
1054,foundry-support.txt,"error: could not compile `foundry-cli` due to 3 previous errors warning: build failed, waiting for other jobs to finish... error: could not compile `foundry-cli` due to 3 previous errors error: failed to compile `foundry-cli v0.2.0 (https://github.com/foundry-rs/foundry#8d0b5781)`, intermediate artifacts can be found at `/var/folders/pt/f9qvqpsx2_g1c36mryf4mdmc0000gn/T/cargo-install1kmdGc` Updated 1 git package. Failed to update foundry-cli. please check that lockfile is not modified and that your rust version adheres to the tool chain files, I believe it should be >=1.64 anyone has run into a bug where payable(_to).transfer(amount); reverts with some specific addresses like '0x3fab184622dc19b6109349b94811493bf2a45362' they probably have a fallback function which means transfer won’t work cuz it only forwards 2300 gas mmm but if i'm running the test locally it shouldn't be an issue does the address have code? that address is the foundry create2 deployer, I think we set its balance ot maxUint so it overflows @onbjerg @joshiedo I forget where we left off in this discussion about reducing/zeroing the balance ^ also good tip when this happens is search sourcegraph to see if it's a special foundry address: https://sourcegraph.com/search?q=0x3fab184622dc19b6109349b94811493bf2a45362 Thanks Yeah having this issue with multiple specific addresses I will remove them from the fuzzing Any idea why forking tests that fail against deployed contracts’ custom errors take so long to execute ? Hey foundry user any idea why i got this revert EVMerror I got a revert on the transfert function. How do I refer to env keys in the terminal source .env Then use a $ sign before the env variable name Forgot this wow. Thanks 🙏 Was just gonna ask if someone else was experiencing that foundry just got slower on startup. Though I realized that foundry now uses the .env by default and I was running forked tests.",481
1055,foundry-support.txt,"Cool stuff though hmm, just getting this as a new error message now Currently trying to load in abi encoded output via FFI. ABI encoding with ethers, and abi decoding in ethers it seems to work. But in FFI it doesn't. Any thoughts? JS encoder: const encodedData = defaultAbiCoder.encode(  [  ""uint256 width"",  ""uint256 height"",  ""tuple(bytes[] traits, string[] names, string[][][] palettes, string[][] paletteNames) backgrounds"",  ],  [width, height, backgrounds] ); // const decodedData = defaultAbiCoder.decode( // [ //  ""uint256 width"", //  ""uint256 height"", //  ""tuple(bytes[] traits, string[] names, string[][][] palettes, string[][] paletteNames) backgrounds"", // ], // encodedData // ); // console.log(decodedData); process.stdout.write(encodedData); FFI call: struct TraitData {   bytes[] traits;   string[] names;   string[][][] palettes;   string[][] paletteNames;  }  struct SvgData {   uint256 width;   uint256 height;   TraitData backgrounds;   // TraitData clouds;   // TraitData lands;   // TraitData planets;  }  function run() external {   string[] memory inputs = new string[](2);   inputs[0] = ""node"";   inputs[1] = ""scripts/Landscapes/abiEncodeData.js"";   bytes memory res = vm.ffi(inputs);   SvgData memory svgData = abi.decode(res, (SvgData));   console.log(svgData.height);   console.log(svgData.width);   // vm.startBroadcast();   // Landscapes landscapes = new Landscapes();   // vm.stopBroadcast();  } Did you sent the WBNB on the CAKE contract rather than on the pair contract before swap? Yep but should works anyway (even if it's the null address it should work here) doesn't make sense I'm having an issue here wherein I have a foundry script which executes a TX, but I just get a hang waiting for confirmation... then when I kill and re-run the script, I get ""transaction already imported"". Anyone hit this before? Yea but you need to send tokens to the pair before swapping ethers has different format iirc ethereumjs-abi is the format typically used Yep but the issue here is not related to that.",499
1056,foundry-support.txt,"Here the fact is cannot transfert at all (whatever address should receive) Checked out that library and github and it says: "" This library is deprecated and will not be further maintained. It specifically doesn't support the new ABI Coder v2 which is now activated by default starting with Solidity v0.8.0 released in December 2020. We recommend to use the Ethers.js v5 ABI Encoder as a replacement which supports the new ABI Coder v2 types and is under active development. "" Think you need ABI Coder v2 for struct encoding within a struct right? oh, yeah, completely forgot about this 😅 , but i thought you did i just confirmed not that one there is another one That one is by axic i think idk going off memory Gotcha, do you happen to know what the name of the lib is? Down to give it a shot if ethers isn't compatible Last time it happened was when I was trying to send ETH to freshly deployed contracts from a forked network. As the pkeys were known, same deployer, same nonce, the contracts were already deployed at this address, and as they didn't had any fallback function it was reverting. I had to prank lol all good i'll file just wanted to make sure you hadn't already! Hi, Went into another issues when doing ""forge create"" we used --verify arguments but the command seems failed to verify our contract on etherscan. So we try to run a separate command as ""forge verify-contract"" But that commands seems always failed on verification. Is there any particular parameters I need to set ? (All parameters are remains in default when we ran 'forge create' ) Tried follow the instructions on cook book, for verify-contract command. The command always not able to do this line $(cast ""constructor()""...) This line always failed with UnrecognizedToken: constructor error. So we tried to not pass it and tried to pass it the same as ""forge create"" command. But neither way will pass the verification. So want to check what is the proper steps we need to do to run ""forge verify-contract"" correctly. Thanks in advanced. Nice idea to prank but don't work here.. Is your addresses funded with ETH ? And here i am using wbnb not `BNB`so fallback issue seems unlikely hm.. upgraded & made sure i was on nightly, still seeing the error.",491
1057,foundry-support.txt,"will look at the lockfile next From what I see the code seems good Yep plenty of BNB... If you want to come discord trying to debug via the debugger feel free to send a message ahah... Please disregards the questions. I have received it via several trials and errors. First is --optimization-run default on ""create"" is 200, so when verify-contract need to override 200 And in cookbook it puts $(cast ""constructor()"") but instead it needs capitalize C as Constructor. which lockfile am i looking for? command run was cargo install-update -ag so not sure there is one? (rust noob here sorry) haven't had any luck figuring this out yet unf are there any project trying to bring a more Rusty modern version of solidity to the evm? something that's lightweight like solidity (no borrow checking) but with a more modern syntax and functional style and that also comes with a better compiler that optimizes well? seems like despite solidity's flaws it's still just the best we've got lol Huh wdym ? Like a rust like syntax ? not necessarily completely like rust there are languages like Move and stuff and obviously there's a compiler for rust to evm but the support and ecosystem just cannot compare I think you want vyper. Still no one has an idea guys? isn't vyper more pythonic? without looking at any of the logic, make sure you aren’t convoluting bnb and wbnb, that you aren’t making an error in decimal (that 1 ether is a lot of decimals), and that there isn’t a permit you’re missing for the swap call to succeed are you expecting to send no value with the swap call? bc that’s what you’re doing What do you mean by are you expecting to send no value with the swap call? bc that’s what you’re doing Remove everything from the function. Same error on the transfert directly. But the issue is weird first time i got vmError: Revert you don't have any Wrapped BNB Yep.. I am tired here sorry thanks.. nw. It can be confusing.",430
1058,foundry-support.txt,"Anyone know what ""No srcmap index"" means inside the foundry debugger? may be a bug, submitted report here https://github.com/foundry-rs/foundry/issues/2639 ye i built the debugger, basically it means that there is no matching source code (code you wrote) for a given opcode generally that means the compiler did some bytecode generation that no longer corresponds to a particular line of code sers, are there any docs on configuring forge fmt? couldnt find anything in foundry book There are, but I don't think they are really final yet. If you foundryup and then run forge config you should see them at the bottom sweet thanks Np! Thanks Brock. The debugger is very nice. Do you think this has to do with optimizations or do you have a suggested workaround? ye if able, turn off the optimizer and most of that should go away What is the command to turn off optimizations? I tried ""optimizer = false"" in my foundry.toml and it didn't seem to do anything okay then even still the compiler is generating code that is just associated with nothing you wrote first what solidity version are you using? does cast support using a ws endpoint? Is there a library where I can create signatures? e.g. EOA signing a hash, smart contract wallet signing a hash, etc. I have pragma solidity ^0.8.13; check out SigUtils contract in tutorial https://book.getfoundry.sh/tutorials/testing-eip712 via_ir = false optimizer = false optimizer_runs = 0 optimizerSteps = '' Just use these fields is there a way to disable simulations for scripts? couldn't find anything here or in the docs - or overlooked it 100 times.",350
1059,foundry-support.txt,"sorry if so Hi, I'm trying to configure slither as a CI workflow on a repository and I'm stuck on the following error during Slither running step: `No such file or directory: 'forge'` Here is a link to the failing job on gh: https://github.com/0xGabi/givpower/runs/7707335489?check_suite_focus=true Does someone experience a similar issue before? Thanks! Slither IR not yet compatible I think still with foundry output you will have to use another framework for slither i am afraid 😱 I believe you're referring to: forge script --skip-simulation https://github.com/foundry-rs/foundry/pull/2524 man I should have just updated and looked at the docu then... thanks for the hint! Amazing - thank you 2 questions 1) whats the error code for ""return value not used"" 2) can you ignore certain folders for compilation? dont thing there is ""ignore"" field for config.toml i mean low level return value here Error code where? u can specifiy in the config file which error codes to ignore, im just trying to figure out which one belongs to ""Return value of low-level calls not used"" ah i got it, its 9302 That's not true Is there any way to adjust forge fmt settings? Looking to make whitespace 2 spaces instead of 4 😅 https://t.me/foundry_support/20152 - should help Can cast send txs to null? i.e. create contract Should be How to change this layout into four quadrants? For me it usually switches automatically on getting enough screen space. Zoom out Gm Is it possible to do multiple eth_call that depend on eachother Say I wanna addLiquidityETH, swapExactETH ..",373
1060,foundry-support.txt,"i wanna retrieve the revert status of swapExactETH without sending 2 transactions & mining them using evm_mine I am using anvil Maybe that is possible by writing a smart contract that does process multiple input data? 1st would be addLiq input and 2nd swapExactETH? Thoughts? for(uint256 i = 0; i < calls.length; i++) {  (bool success, bytes memory ret) = calls[i].target.call(calls[i].callData);  returnData[i] = ret; } Something like this ye in a smart contract function as you did what you wrote is the multicall contract Since when? How to directly debug a runtime bytecode in foundry ? hello eveeryone Hi, Yasir! Welcome! gm. I’m encountering an issue in forge running a deploy script. In short, when I enter the forge script… command, forge thinks i’ve included a —fork-url argument when I haven’t (I’m deploying to Goerli so that wouldn’t even make sense). Here’s the error I’m getting: I’m able to deploy locally to anvil just fine (using —fork-url http://localhost:8545 ) and when I try adding the same argument to my Goerli deploy command, forge tells me I can’t include the —fork-url argument twice Any ideas what’s going on there? If this is potentially a bug, I’ll create a gh issue Can you echo that env var 🤦‍♂️ i forgot the source .env command thank you!! Not sure if I'm missconfigurating something but I tried to follow a few example repos: - https://github.com/dmfxyz/murky/blob/main/.github/workflows/slither.yml - https://github.com/foundry-rs/forge-template/blob/slither/.github/workflows/lint.yml But is not working on our repo. Using the murky repository setup seems slither is working but can't figure out openzeppeling contracts path: https://github.com/Giveth/givpower/runs/7714076113?check_suite_focus=true Thanks. I think optimizer=false actually worked, it's just that my optimized version got cached and never recompiled after my config change Is it via some option other than send? The cast-send docs say cast send [options] to [sig] [args...] which makes to look required.",489
1061,foundry-support.txt,"> The destination (to) can be an ENS name or an address. Is forge create https://book.getfoundry.sh/reference/forge/forge-create when deploying with forge script my deployments work however the etherscan verification doesnt. It warns me with “You can only verify deployments from inside a project! Make sure it exists with forge tree.” all my contracts are in my forge project what exactly am i supposed to be looking for here? Unfortunately forge create doesn't allow me to set the raw data bytes directly I'm trying to deploy handcrafted bytecode hence cast Interesting, it doesn't seem to output the contract address Does cast wallet new use deterministic key derivation (i.e. generate private keys from the same seed phrase)? *`cast wallet new` No it's random https://docs.rs/rand/0.8.5/rand/fn.thread_rng.html Can you open an issue on crytic-compile and link to the repo please? anyone know if its possible to generate a salt for a specific address to use with create2? So far I can't think of a way that isn't pure luck It's brute forced yeah alright well... time to brute force and pray it would be a miracle thank you @gakonst ! Also working on a PR to add a —delay arg for verification using forge script i'm 100% forge no js still and HAPPY! Using forge for vanity addresses should be pretty fast no? Though thinking that.. if you fuzzed the private key as an input (using create instead of create2) this could cause security concerns due to bias? I'm writing a test for function sendEther() public { payable(msg.sender).transfer(1e18); } as function testSendEther() public{ vm.prank(address(1)); nft.sendEther(); } but it fails with error ""PRECOMPILE::ecrecover."" WHY'S THAT? when having your deployment pipeline with foundry, scripts only keep transaction receipts in the broadcast folder.. Is that the only way to keep track of deployed contract addresses? address(1) stores the ecrecover function as a ""precompiled"" contract. I imagine there's an error due to calling the address via .transfer with invalid data you can also console.log them or use ffi to store them in your own files yeah they get logged already.",470
1062,foundry-support.txt,"thanks will use ffi Is there some kind of way to access some ""randomness"" when running fuzz-tests aside from passing in an extra value? There is a PR running still if you want to test you can clone the repo Still not sure if it would be a cheatcode or a library using ffi Hello do you know any specific learning resources or group for echinda Hi. The response to the forge verify command is OK, but it does not seem to verify on etherscan. Is there something I should do? https://rinkeby.etherscan.io/address/0xfc384569401c65e89e3933fe478634f822c49d4c#code Hello Foundry users! Trying to play with fuzzing here: `pragma solidity 0.8.10; import 'forge-std/Test.sol'; contract Safe { receive() external payable {} function withdraw(uint256 check) external { if (check == 7) { payable(msg.sender).transfer(address(this).balance); } } } contract SafeTest is Test { Safe safe; // Needed so the test contract itself can receive ether // when withdrawing receive() external payable {} function setUp() public { safe = new Safe(); payable(address(safe)).transfer(1 ether); } function testWithdraw() public { uint256 preBalance = address(this).balance; safe.withdraw(How to fuse here?); uint256 postBalance = address(this).balance; assertEq(preBalance + 1 ether, postBalance); } }` Anyone now how to fuse a really simple function with one parameter ? Would like to like afl fuzz If someone has an example to try to fuzz some function with parameters could be so nice! The response OK just means the request was accepted, you need to check if verification was successful by running the verify check using the guid returned from the verification command Also, I have had a lot of issues with verification, I would have a contract verified on one network, then the exact same contract/deploy script not verify on another network.",409
1063,foundry-support.txt,"So might not be you with this issue currently still open (https://github.com/foundry-rs/foundry/issues/2292) is there any way to broadcast transactions in a script with dynamic inputs without having to supply the calldata as a replacement for the human readable function sig? this comes up from time to time “OK” is the actual etherscan response in these cases which usually indicates it was successfully verified but for some reason it doesn’t show up in the web ui… hard to say what’s happening We needed to include a slither.config.json with: { ""filter_paths"": ""lib"", ""solc_remaps"": [ ""ds-test/=lib/ds-test/src/"", ""forge-std/=lib/forge-std/src/"", ""@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/"", ""@openzeppelin/contracts-upgradeable/=lib/openzeppelin-contracts-upgradeable/contracts/"" ] } I run slither as slither . --compile-force-framework foundry --filter-paths 'test|lib' and yes I also needed the solc_remaps in slither.config.json If I am making a 'pure' foundry project repo, what are the best ways to format instead of using npm and prettier/solhint/eslint? hmm how cna we make slither inherit the foundry remappings forge fmg fmt does the forking cheatcode only work for tests and not scripts? HI, I installed openzeppelin-contracts but im getting this error: Unable to resolve import: ""lib/openzeppelin-contracts/contracts/utils/Context.sol"" with remappings thats whats inside gitmodules: `[submodule ""lib/openzeppelin-contracts""] path = lib/openzeppelin-contracts url = https://github.com/OpenZeppelin/openzeppelin-contracts` also im getting a squiggly line under: import ""forge-std/Test.sol""; nvm i solved this but now im getting this error when trying to use ERCBurnable: `Compiler run failed error[3656]: TypeError: Contract ""Share"" should be marked as abstract. --> src/contracts/Share.sol:12:1: | 12 | contract Share is ERC20Burnable, AccessControl, Ownable { | ^ (Relevant source part starts here and spans across multiple lines).",476
1064,foundry-support.txt,"Note: Missing implementation: --> lib/openzeppelin-contracts/contracts/token/ERC20/ERC20.sol:54:5: | 54 | constructor(string memory name_, string memory symbol_) { | ^ (Relevant source part starts here and spans across multiple lines).` Just getting going with the debugger. Is there any way to export the the OPCODE list? Or import some raw bytecode? I guess this would not be debugging solidity then. Ok, maybe I can think of another way to take some notes, maybe just screen capture the debugger and take notes that way. this is a solidity error, 3656 means that you're propably missing some interface impls in Share yeah but there is no interface involved none of the contracts I inherit doesnt as well contract Share is ERC20Burnable, AccessControl, Ownable check lib/openzeppelin-contracts/contracts/token/ERC20/ERC20.sol:54 i did its a standard implementation it has the IERC20 reference, but the ERC20 is implementing everything in it Has anybody successfully used foundry to verify contracts on moonbase alpha? Try putting in the constructor line of your SHARE.sol contract: constructor (blah, blah, blah) public ERC20(_name, _symbol) {...} The key thing is the instantiation of ERC20(). I believe this is what needs to be done, it's answered here: https://ethereum.stackexchange.com/questions/83267/contract-should-be-marked-as-abstract#:~:text=In%20this%20specific%20case%2C%20you%20are%20missing%20the%20constructor%20call.%20Even%20if%20you%20don%27t%20want%20to%20change%20the%20original%20ERC721%20constructor%2C%20you%20still%20need%20one%20in%20your%20contract.%20Therefore%20you%20get%20the%20error%20of%20declaring%20it%20%27an%20abstract%27%20contract.%20Abstract%20contracts%20cannot%20be%20instantiated.",452
1065,foundry-support.txt,"Hey, how do we get the account balance when forking mainnet on a script? address(0x…).balance seems to give a random value Okay, so if I don’t supply —private-key it works as expected But I need to check my own balance, can anyone help? can I access different accounts through the test contracts? How do invariant tests interact with fuzzed tests in the same file? My current understanding is that the invariant testing is independent of the fuzz testing (i.e. invariant runs are performed, then remaining fuzz tests are performed), but I'm not sure if this is right. also curious to hear more about invariant testing I wrote a contract that inherits from my base contract to expose internal functions e.g. contract LandscapesTestable is Landscapes {  Traits public testableTraits;  Palettes public testablePalettes;  constructor() {}  function addTraits(   bytes[] calldata newTraits,   string[] calldata newTraitNames,   string memory traitType  ) external {   _addTraits(newTraits, newTraitNames, testableTraits, traitType);  }  function addPalettes(   string[][][] calldata newPalettes,   string[][] calldata newPaletteNames,   uint256 numTraits,   string memory traitType  ) external {   _addPalettes(newPalettes, newPaletteNames, testablePalettes, numTraits, traitType);  } } When running my foundry tests, it seems to think that the two public variables I initialized are tests, even though they are in the contract I am testing Running 2 tests for contracts/Landscapes/LandscapesTestable.sol:LandscapesTestable [PASS] testablePalettes():(uint256) (gas: 2433) [PASS] testableTraits():(uint256) (gas: 2432) Test result: ok. 2 passed; 0 failed; finished in 342.46µs Anybody know why foundry does this? any function that starts with test* is considered as a function that performs testing. since public vars create external functions, it's seen as a test. Not sure if there is some logic to prevent this in general.. might be confusing the logic with those structs. Ahh I see.",475
1066,foundry-support.txt,"Thank you How do you connect a second user to a contract in tests so you can call one function from two separate addresses? Thank you for your kind reply. Is there anything I can do next to be verified by Etherscan? Say I have an object Object memory x, what's the easiest way to log the address of x? I know you can at least inline assembly and read out the content of 0x40 (free memory pointer) right before declaring x, but this isn't ideal. I'd first check on a different testnet with the same deploy script. I had verification succeed on Optimism Kovan but fail on Arbitrum Rinkeby a couple weeks ago. The code is exactly the same, and the deploy command only changed the API key and the RPC url. If you can't verify on multiple networks, it's possibly a problem with your verification approach. If it works on one network but not another, it might just be an issue with the explorer. is this is a new known thing? i just encountered it in my ci and my fren said ""that seems to be a bug/issue with a recent foundry version, we have it all over our CI"" also, we're not using invariants yet yes this shoudl be fixed on latest - our bad might come out tonight or mighti already be - i forget Set your env var sir Understood. I will try another network. By the way, were you able to do it on testnet? Yep quick question in solidity scripting how do we make sure to use the address derived from our private key and NOT the contract address the contract address of the test contract I'm getting a ownable notowner error I want this broadcasted so obviously cannot just do vm.prank right? nvm i'm dumb I used address(this) instead of the right thing Getting fatal repository not found when attempting to install https://github.com/superfluid-finance/protocol-monorepo/tree/dev/packages/ethereum-contracts/contracts i'm trying to use expectRevert but it seems like I cant access the selector in a parent contract. I have contracts setup like this contract A { error MyError(); } contract B is A { } And I'm trying to do expectRevert(B.MyError.selector) but it doesnt work. I have an error saying MyError doesnt exist in B.",479
1067,foundry-support.txt,"Is that normal? Can I fix that? Thanks :) from my experience it's not possible to access events and errors from ""outside"" contracts. You'll have to either globally define it and import it or redefine it in the test contract. Someone correct me if I'm wrong Hi, How do I display messages with console.log with fuzz testing? Thanks You need to import hardhat/console.sol and you can then use it I assume, atleast from the contracts being tested AFAIK foundry doesn't log messages to console with fuzz tests.... You can use file cheatcode to capture the messages you wanna print It might crash the terminal if fuzz tests show logs Can you please tell me how? Is there a way to prank using my own address & run tests on Rinkeby? https://book.getfoundry.sh/forge/fork-testing yes but does it allow to make test transactions using my own private key? use the vm cheatcodes and yeah vm.prank and so on Hello, is there a way to expect all the reverts while ignoring error messages? I am using fuzzer to generate addresses and different contracts throw different errors and I simply want to test that the call reverts for all of them. Thank you `vm.expectRevert()` and the other variants catch just the specific error cases I'm doing this in my forge tests: vm.expectEmit(true, true, true, false); emit Transfer(from, to, tokenId); and I'm getting [FAIL. Reason: Log != expected log] How do I debug this? Use the -vvv flag and look in the traces what values were emitted in the events and if they match They seem to match... emit Transfer(from: 0x0000000000000000000000000000000000000000, to: BadgesTest: [0xb4c79dab8f259c7aee6e5b2aa729821864227e84], tokenId: 39328316009022100444429864117930245058884000054031674455302921828332403411078) actually, from the docs it says Call this function, then emit an event, then call a function. should I be calling another function after emit Transfer(...? I figured it out... the order needs to be 1. vm.expectEmit 2. emit Transfer(... 3.",481
1068,foundry-support.txt,"your function call I had my function call before the other two yes, you have to emit 2 events 1 reference one, another somewhere in the function you are testing Are there any tools in Foundry to help with Stack too deep infamous problem? How to deal, with the compiler when there is different version of solidity ? (Discovered incompatible solidity versions in following) I'm trying to setup foundry in an existing hardhat project (followed the instructions: https://book.getfoundry.sh/config/hardhat#4-steps-to-add-foundry-test) However, I run into this error. Any ideas how I may solve this? Hey is there an equivalent of bound() but instead of limiting on a number range I would like to limit a bytes to a string array value? Doing the same as this snippet but in an efficient way as with bound(): vm.assume(str == bytes32(""1"") || str == bytes32(""2"")); Bump this question, am I misunderstanding something? It’s not clear what you are trying to achieve In hardhat you can call connect(addr1) to a contract and then call functions. Then later call connect(addr2) and call functions. I’m trying to figure out how to do the same with Foundry vm.prank(address1) function call.... vm.prank(address2) function call.....",273
1069,foundry-support.txt,"Thank you I am currently trying to load a abi encoded data into a struct, and I am getting the struct has all its members omitted, therefore the getter can't return any values // Trait Data  uint256 public width;  uint256 public height;  TraitData public backgrounds;  TraitData public clouds;  TraitData public lands;  TraitData public planets;  function _loadSvgData() internal returns (uint256, uint256, TraitData memory, TraitData memory, TraitData memory, TraitData memory){   string[] memory inputs = new string[](2);   inputs[0] = ""node"";   inputs[1] = ""scripts/Landscapes/abiEncodeData.js"";   bytes memory res = vm.ffi(inputs);   (    uint256 width_,    uint256 height_,    TraitData memory backgrounds_,    TraitData memory clouds_,    TraitData memory lands_,    TraitData memory planets_   ) = abi.decode(res, (uint256, uint256, TraitData, TraitData, TraitData, TraitData));   return (width_, height_, backgrounds_, clouds_, lands_, planets_);  }  function setUp() external {   // Give alice and bob some ETH   vm.deal(alice, 1 ether);   vm.deal(bob, 1 ether);   // Label addresses for stack traces   vm.label(alice, ""alice"");   vm.label(bob, ""bob"");   // Load SVG test data   (width, height, backgrounds, clouds, lands, planets) = _loadSvgData();   // Get new contract instances for testing   landscapes = new LandscapesTestable(width, height);   erc721receiver = new ERC721Reciever();   // Give ERC721Receiever contract some ETH   vm.deal(address(erc721receiver), 1 ether);  } For backgrounds, clouds, lands and planets - does anybody know why this is happening? I have a foundry script with the same logic and it works. Not sure why it's failing here. And this is the TraitData struct: struct TraitData {   bytes[] traits;   string[] traitNames;   string[][][] palettes;   string[][] paletteNames;  } Figured it out. Just can't have the structs be public. Hello there guys! I've got something that it looks like a pretty simple question but it's getting weird for me.",497
1070,foundry-support.txt,"When you fork a network to run your test the cheatcodes normally work perfectly but I am trying to do some manipulations using warp and all the tests that are ""block.timestamp"" dependant are failing right now, does testing on a forked network make this block manipulations go badly? anyone have issues with forge bind generating incorrect rust bindings? Looks like its stuck on an ancient version of ethers.rs https://github.com/foundry-rs/foundry/issues/2675 I think this is already there , but not exposed to the help argument : https://github.com/foundry-rs/foundry/blob/9d99638f2441e3ff073e79d677b6a5531da65f28/cli/src/cmd/forge/bind.rs#L53-L56 the comments say its default behaviour , and my bindings dont contains tests Follow up question. If I have a public struct in a contract where one of the struct elements is a mapping how do I look up a value of that mapping in forge for testing? For example I've tried: traitStruct.traitMapping(0) and traitStruct().traitMapping[0] and I can't seem to pull out the values None of these work What's the consensus on the broadcast/ folder? .gitignore? Do I have to implement the getters myself? awesomeee! Second prank does not actually change the msg.sender Anyone have any idea why? log it from the function wdym try remplacing share.mint() by a very small contract with just a mint() function that uses console.log() to check the sender also foundryup to be sure Hi, is 0.8.16 support coming soon? [⠘] installing solc version ""0.8.16"" [⠃] Failed to install solc 0.8.16: Unknown version provided It's not ready yet is it 🙁 ? I did foundryup and forge update and still error[9582]: TypeError: Member ""derive"" not found or not visible after argument-dependent lookup in contract Vm. it was ready after 3days ish for .8.15 foundryup -b master it’s coming out tonight it’s deriveKey iirc ah..",458
1071,foundry-support.txt,"and .remember() is gone as well it seems awesome as always!! thanks vm.startBroadcast doesn't take args as well hmm, it's only very partial PR then ill give a shot to vm.startBroadcast(address(uint160(deployerPrivateKey))); Close enough with vm.startBroadcast(vm.addr(deployerPrivateKey)); but not yet: No associated wallet for addresses: {0x1ba....38cf70}. Unlocked wallets: [] https://gist.github.com/sambacha/c46cef7ac4b466898dba22fd5fd56f6a is ussc blacklisting weth now Hi Guys! im trying to deploy a simple test contract to Mumbai, but it seems that the tx has get stuck, how can i replace it with high gasPrice ? this is my current bash command; forge script ContractScript --rpc-url XX --chain 80001 --broadcast --private-key XXX --verify --etherscan-api-key XX -vvvvv Is there anyway to export the byte code that appears in the debugger? It doesn't appear to be the same as the full compiled code of the contract. I might be missing something about how the EVM works when calling functions. maybe try adding --legacy I solved waiting like 20 minutes... LoL, but it will be nice how to touch the gas price config does polygon have a discord or only the forum? should raise that, perhaps they know what we're missing when estimating for mumbai I hope this was resolved, by bumping the lockfile When running forge test, forge (0.2.0) is hanging after only running part of the test suite. It happens unrpredictabily. Sometimes it will hang after one file, then I'll run it again without any changes and it will hang after a different file. And finally it ends with: [1] 44307 killed  forge test Any idea what is going on? yessir is there a way to publish transaction calldata via a cast send? or do i have to manually roll the entire tx then publish the raw tx hex? Turns out this was from a math operation triggered by one test. Still not sure exactly why it hangs but I was able to hack around it. Will file an issue if I find a specific bug.",461
1072,foundry-support.txt,"ah ok figured out, cast will interpret sig as transaction calldata in a cast send Is there a $ cast command to pass the following?  require(address(keccak256(publicKey)) == owner); I am getting tripped up on the difference between the initiation code and the runtime bytecode. How can I get the runtime bytecode, which is what I believe is shown in the debugger. Any good tutorial for forge script? https://github.com/foundry-rs/book/blob/master/src/tutorials/solidity-scripting.md is solc 0.8.16 already supported in foundry's latest nightly build? seems not version: forge 0.2.0 (63ed109 2022-08-09T00:03:50.892098571Z) foundryup -b master Does anyone know how to create a 'signed message' in solidity only + Foundry? I've found the (uint8 v, bytes32 r, bytes32 s) = cheats.sign( signerPrivateKey, message ); cheat code, but not sure how to recompose v , r , s into a message in solidity basically I'm looking to replicated the output of ethers's signer.signMessage() .. ah sorry, just noticed I forgot to do a little search here, and indeed this question was already asked :) Will try one of the formerly proposed solutions hm, still unclear how to do this from a forge-std/Test.sol test context. If anyone has tips I'd appreciate. what are you trying to do ? the js function in screenshot I sent above generates bytes, which can be given as a parameter in a transaction. It is then decoded as follows: since I'm trying to use Foundry tests instead of JS, I need to create the ""bytes memory result"" we see above, bug using solidity only (and Foundry cheat codes) code above is from here: https://github.com/smartcontractkit/ccip-read/blob/master/packages/examples/trusted-gateway-token/contracts/contracts/Token.sol#L87 and the recover function comes from @openzeppelin/contracts/utils/cryptography/ECDSA.sol Did you figure it out Czar102 ? I used —private-keys flag multiple times Just curious, but why do many forge commands require a clean working and staging area? Okay, I figured it out.",471
1073,foundry-support.txt,"In case anyone is looking for this in the future, here's how to compose a signature from Foundry's cheats.sign(): (uint8 v, bytes32 r, bytes32 s) = cheats.sign(signerPrivateKey,message); bytes memory signature = bytes.concat(r, s, bytes1(v)); is it possible to specify gas_limit via cheatcode and not at config level? I would like to make a specific tx or a group of tx respecting a gas limit.",94
1074,foundry-support.txt,"Something like vm.prank() or vm.startPrank() +1 on this another question: how can i install an older version of foundry? I tried this foundryup --version nightly-9b0575e60339c35d94bbc97019ce70b0dfb2f716 but got this error tar: Error opening archive: Unrecognized archive format foundryup: downloading manpages #=O#- #  # tar: Error opening archive: Unrecognized archive format foundryup: installed - forge 0.2.0 (63ed109 2022-08-09T00:20:50.211015Z) foundryup: installed - cast 0.2.0 (63ed109 2022-08-09T00:20:50.211015Z) foundryup: installed - anvil 0.1.0 (63ed109 2022-08-09T00:20:49.834767Z) hey all, i'm trying to get foundry working with solc version 0.7, on a m1 mac i was able to install foundry correctly and test forge test works properly with the latest version of solc 0.8.13 with a example project init, test however, in my solc version 0.7.6 project, i see the following error: `""/Users/pbj/.svm/0.7.6/solc-0.7.6"": Bad CPU type in executable (os error 86)` Hi guys, when runnin g test -vvvv is there a way to expand the addresses? e.g, 0xaaaa..aaaa to 0xaaaaaaaaaaaaaaaaaaaaa just confirmed if i change the sample project to 0.7.6, get the same error guess there has been a fix with later versions of Solc, am I out of luck if I want to use <0.8 solc on mac m1 silicon? sigh...looks like solc v0.8.5 or greater works fine. Hi! I know forge coverage still need improvements...but maybe this is sth I'm doing bad. When I run coverage I get strange results...my % of lines is 100% or 0% and the number of lines dont match with the real contract (not even close).",489
1075,foundry-support.txt,"Does anyone know the reason? thanks in advance 😉 hello everyone! I'm working on new contracts that will interact with an old-ish codebase. How well does the getCode cheatcode work with imports? Basically I've got a token written for solidity 0.6 that I want to interact with from my tests which are on 0.8, but the token contract imports from openzeppelin contracts and other relative imports (all also on 0.6) Friends, with the hardhat-anvil plugin, setting ""launch: true"" inside of the hardhat config doesn't seem to launch the node and I get the error ""Unsupported network (""anvil"", chainId: 31337)"". However, if i run the node before hand and set ""launch: false"" everything seems to work fine. Does anyone have experience with this? does anyone know if address(contract).code requires a minimum solidity version? I'm getting error[9582]: test/Contract.t.sol:38:29: TypeError: Member ""code"" not found or not visible after argument-dependent lookup in contract ERC1820Registry. answered my own question: you need to do bytes memory code = type(contractType).runtimeCode; instead Hey, just wondering if there is any plans to setup a foundry discord? cttrl + f.. TLDR no there are no native apple silicon solc builds before that yeah telegram is a mess when trying to coordinate thanks for confirming, back to the drawing board for me Does using the uniswap v3 code that was migrated to foundry by georgios necessitate yarn installing? Trying to keep it purely foundry, without the node & hardhat components... Just wanting to be able to have a mock uni v3 lp position nft to deposit into my contracts & manage.",364
1076,foundry-support.txt,"is there a way to execute a raw tx from within a test? I don't see any cheatcodes for it so probably not, but figured I'd ask no plans for discord 🙂 i’d encourage people to stress test their writing and search the tg/issues/book for questions that have been asked before and document them in the book if they dont exist and for discussions we can always coordinate around the issue tracker and the main chat which is higher signal to noise I just turned on viaIR and compilation went from a few seconds to 15 seconds Is that expected? Anything I can do to speed things up again? [profile.default] via_ir = true solc = ""0.8.16"" [profile.default.optimizer_details] constantOptimizer = true yul = true # this sets the yulDetails of the optimizer_details for the default profile [profile.default.optimizer_details.yulDetails] stackAllocation = true optimizerSteps = ''"" 3 seconds to 15 seconds It's expected because some heavy optimizers run by default. The above will skip the heavier ones (optimizerSteps empty) while removing stack too deep I was running into this as well when I made these changes for generating coverage reports. It was taking up to 5 minutes to compile... took me a while to try just stepping away from the computer and not ctrl+c thinking it'd hung. Even with empty optimizerSteps? Is 0.8.16 supported in forge yet? Ran foundryup but still says that's a bad version 0.8.15 is fine too which steps are the heavier steps and what is lost by skipping them? Can't tell for sure without checking laptop which letters from the sequence, but any optimizer step that relies on what's internally called the Data Flow Analyser. This is being profiled and improved at the moment. What you lose is mainly gas optimizations. You can see the empty optimiser steps as a ""debug mode"" for quick compilation and testing, and the full optimizer suite as a ""release mode"" that optimizes gas but takes longer to compile, which you should ofc still run the tests on. thanks, appreciate the info! definitely is on intel mac, can't say for silicon, but should be Anything change recently with the foundry-toolchain Github action? (Or the path to nightly build artifacts?) It seems to be hitting a 404 when it tries to download the latest nightly.",485
1077,foundry-support.txt,"(resolved here, thx @onbjerg https://github.com/foundry-rs/foundry-toolchain/issues/11) does the beta version forge support the script command anymore? How do I deploy contracts with the beta version of forge? I am trying to do this, but it doesn't work because there is no subcommand script in the official forge already,right? error: Found argument 'script' which wasn't expected, or isn't valid in this context Foundryup It should be there :) Is there any uninstall command? forge remove i assume you mean for a lib or do you mean for foundry in general? I mean this one foundryup replaces old version but i don’t think there is a builtin uninstall It wasn't work.So I deleted .founry I have some error like these. .foundry/bin/forge: No such file or directory .foundry/bin/cast: No such file or directory .foundry/bin/anvil: No such file or directory And I have this after foundryup tar: Error opening archive: Unrecognized archive format i found a forge version that only had the run command and not the script command. How did that happen? Same here It's weird I downloaded a different version Did you work well? yes I just did a fresh foundry install because I was running into a weird error that I never encountered previously (forge build was working smoothly 2 hrs ago) I am trying to run ""forge clean && forge build"" but I ran into this error: [⠊] Compiling... [⠰] installing solc version ""0.8.15"" [⠒] Successfully installed solc 0.8.15 Error: Solc Error: I'm trying to debug a transaction getting sent by eth_sendRawTransaction never making it out of the tx queue, but I am getting drowned in logs. Does anyone have a RUST_LOG incantation that makes traces readable for anvil? Hi, I'm a dev who wants to learn Rust and also contribute to Foundry's source code at the same time. Is there a Discord server for this tool where developers can group together? You should start seeing all the GitHub issues and commits instead of a discord channel Yes, looking through the “good first issue” ones at the moment.",472
1078,foundry-support.txt,"And as a newbie developer learning rust, I realize I might need some guidance so not sure where I would reach out for help Any cast command to test out the ledger is set up appropriately? Had success in the past with cast send --ledger --hd-path ... but having a rough time with latest and trying forge script with a ledger. Error: hidapi error: hid_error is not implemented yet Can confirm that cast send works exactly as expected, so could be my misuse of forge script Using the following command forge script script/abcd/Deploy.s.sol -f $ETH_RPC_URL -vvvv --ledger --hd-paths ""m/44'/60'/0'/1"" --legacy --broadcast --sender ""0xABCD"" I can confirm that 0xABCD is at the hd-path m/44'/60'/0'/1 Switching over to cast send is no issue at all cast send 0xABCD --hd-path ""m/44'/60'/0'/1"" --ledger --value 0 --legacy Successfully sends a transaction to itself from itself using the ledger. Created an issue https://github.com/foundry-rs/foundry/issues/2709 I can't get gas reports working. I added gas_reports = [""*""] to foundry.toml and am using forge test --gas-report Also what does this mean at the end of the passing test (runs: 256, μ: 33334, ~: 33307) it seems like etherscan contract verification for goerli isnt working right now (worked with same params yesterday so probably not related to my code) -- guessing its a merge related outage of some sort, but just dropping a note here in case its a foundry bug I am also having contract verification issues on Polygonscan, not sure if Etherscan is having issues overall Did you find a solution to this? wld also like to deploy raw bytecode from cast Premm.eth, [8/10/2022 11:41 PM] I can't get gas reports working.",416
1079,foundry-support.txt,"I added gas_reports = [""*""] to foundry.toml and am using forge test --gas-report Premm.eth, [8/10/2022 11:45 PM] Also what does this mean at the end of the passing test (runs: 256, μ: 33334, ~: 33307) have you tried using --mnemonic-indexes? getting the same error I did not, fell back to web3py working on hacking it into cast, but not priority rn it should be quite easy though, the api is pretty straightforward to add a ""cast deploy"" or something in Can you please open an issue? I thought we had cast send --create but maybe we don't Can anyone else reproduce this? I did try but unsure if I really nailed the correct incantation w.r.t --mnemonic-indexes ye that works for me although I spent a while trying to get the right index because metamask names ledger accounts from 1 😅 https://github.com/foundry-rs/foundry/issues/2710 lmk thoughts on cli format I am using the old Legacy hd path`44'/60'/0'/x`, are you specifying the hd-path in any way? ahh no i'm not Hi, does anybody have any ideas how to start debugging internal EVM error My contracts run fine on test When running forge script using an RPC URL, however, I run into Script Ran Successfully but then The application panicked (crashed). Message: Internal EVM error: Execution reverted: EvmError: RejectCallerWithCode (gas: 0) fuzzing testing runs 256 times the second is average of gas the third is the medium of gas Any idea why when I run forge snapshot locally everything is passing but when it's run from GH actions 3 of 33 would fail? FYI - the ones that aren't passing are ones where I'm doing fuzzing Hi there, after foundryup I'm getting this [⠊] Compiling...",410
1080,foundry-support.txt,"[⠰] installing solc version ""0.8.15"" [⠒] Successfully installed solc 0.8.15 Error: Solc Error: ok I'm not the only one opened an issue https://github.com/foundry-rs/foundry/issues/2712 I'm thinking that this is something with solc 0.8.15 or forge+0.8.15 Hey guys, so to run invariant tests, I just have to prefix the test function with invariant and place a require at the last line? I think it might be an intell issues as it works fine on my m1 no I'm on m1 too ha your issue says intel sorry, updated the issue I fast clicked on the first macOS option 😄 realioverse-contracts $forge -V forge 0.2.0 (6cd6618 2022-08-11T00:05:44.416299Z) realioverse-contracts $forge test -f $INFURA [⠊] Compiling... [⠆] Compiling 32 files with 0.8.15^C realioverse-contracts $forge test -f $INFURA [⠊] Compiling... [⠢] Compiling 32 files with 0.8.15 [⠰] Solc 0.8.15 finished in 3.22s Compiler run successful can you do a forge clean? uname -a Darwin Samuels-MacBook-Pro 21.4.0 Darwin Kernel Version 21.4.0: Fri Mar 18 00:46:32 PDT 2022; root:xnu-8020.101.4~15/RELEASE_ARM64_T6000 x86_64 realioverse-contracts $forge clean realioverse-contracts $forge test -f $INFURA [⠊] Compiling... [⠢] Compiling 32 files with 0.8.15 [⠰] Solc 0.8.15 finished in 3.23s Compiler run successful I tried on two different projects and it always try to download the solc it's odd if I switch to 0.13 it works (the same project I was having problem with the 0.15) looks like it might be an svm issue.",491
1081,foundry-support.txt,"can you check your svm folder to see which versions of solc are installed? ls ~/.svm/ 0.5.17 0.6.12 0.7.1 0.8.0 0.8.10 0.8.12 0.8.13 0.8.15 0.8.4 0.4.26 0.5.17 0.6.4 0.7.6 0.8.10 0.8.12 0.8.13 0.8.14 0.8.15 strange , try logging ethers by prepending RSUT_LOG to your command e.g. RUST_LOG=ethers=trace forge test -f $INFURA I get this 2022-08-11T09:56:25.619033Z TRACE compile: ethers_solc: using solc auto detection to compile sources 2022-08-11T09:56:25.635353Z TRACE compile: ethers_solc::resolver: resolving input node versions 2022-08-11T09:56:25.635937Z TRACE compile: ethers_solc::resolver: found exact solc version for all sources ""0.8.15"" 2022-08-11T09:56:25.635977Z TRACE compile: ethers_solc::resolver: resolved 1 versions [Installed(Version { major: 0, minor: 8, patch: 15 })] 2022-08-11T09:56:25.636255Z TRACE compile: ethers_solc::resolver: verifying solc checksum for /Users/myworkspace/.svm/0.8.15/solc-0.8.15 2022-08-11T09:56:25.642072Z TRACE compile: ethers_solc::resolver: corrupted solc version, redownloading ""0.8.15"" 2022-08-11T09:56:25.642090Z TRACE compile: ethers_solc::compile: blocking installing solc version ""0.8.15"" 2022-08-11T09:56:33.227947Z TRACE compile: ethers_solc::resolver: reinstalled solc: ""0.8.15"" ok ..",488
1082,foundry-support.txt,"so it turns out ive fried my installation by trying to delete that solc version and running forge again to repro: realioverse-contracts $forge test -f $INFURA [⠊] Compiling... Error: Solc Error: dyld[78303]: Library not loaded: /opt/homebrew/opt/z3/lib/libz3.dylib Referenced from: /Users/samueldare/.svm/0.8.15/solc-0.8.15 Reason: tried: '/opt/homebrew/opt/z3/lib/libz3.dylib' (no such file), '/usr/lib/libz3.dylib' (no such file), '/opt/X11/lib/libz3.dylib' (no such file), '/libz3.dylib' (no such file) 😆 @stermi so it looks like your solidity 0.8.15 is corrupted and there is a bug with forge trying to redownload it. Although I could not repro , I was able to get past nuking my solc folder by installing svm and installing solc 0.8.15 You need to install rust first though. the delete the folder containing 0.8.15 code. realioverse-contracts $ls ~/.svm/ 0.5.17 0.6.12 0.7.1 0.8.0 0.8.10 0.8.12 0.8.13 0.8.15 0.8.4 realioverse-contracts $rm -rf ~/.svm/0.8.15 then cargo install svm svm install 0.8.15 then ..profit but how could I corrupt by myself it? and as far as I get I'm not the only one with this error You would have to wait for a core guy to wake up as that's above my paygrade sir nono that's totally fine I'll try the manual solution for the moment thanks a lot for the help 😉 note: I think the command is cargo install svm-rs nope, your solution does not work, now I get the same.",434
1083,foundry-support.txt,"error you got above 🙁 which error is that? you are probably deleting the contents of 0.8.15 and not the actual folder , so it thinks its still there Solc Error: dyld[92320]: Library not loaded: '/opt/homebrew/opt/z3/lib/libz3.dylib' Referenced from: '/Users/myuser/.svm/0.8.15/solc-0.8.15' Reason: tried: '/opt/homebrew/opt/z3/lib/libz3.dylib' (no such file), '/usr/local/lib/libz3.dylib' (no such file), '/usr/lib/libz3.dylib' (no such file) ls ~/.svm/ again same as before, I have 0.8.15 I tried both to install manually by svm install 0.8.15 and by just removing it and letting forge install it uops now I have completely deleted ~/.svm 😐 that because you are running rm -rf ~/.svm/0.8.15/ - this will delete contents and leave the folder intact. rm -rf ~/.svm/0.8.15 remove the slash god save you well I think that it was only having solcs but I still get that homebrew error it's the svm 0.8.15 version anyway because now I'm building with the 0.8.13 and it seems to work don't know if when you download from svm it's always using the same solc or different one hosted in different servers because of location? foundry uses ethers , which has ethers-solc , which runs svm. so its the same thing the reason it tries to redownload the binary is due to a checksum mistmatch ; https://github.com/gakonst/ethers-rs/blob/e817073f8e5dee2d9e3801561d436cd5c412890f/ethers-solc/src/resolver/mod.rs#L768-L769 Guys. How to spoof accounts using Foundry? vm.prank(account); someCall(); but we have to send eth from the test contract I'd like to have something similar to getSigners() where every signer has 100 eth you need to use a helper function to create the accounts..",463
1084,foundry-support.txt,"i use this ( didint write it , found it on here) https://github.com/realiotech/realioverse-contracts/blob/master/contracts/src/test/utils/Utilities.t.sol thx https://github.com/realiotech/realioverse-contracts/blob/master/contracts/src/test/LandNFT.t.sol#L34-L43 you can add the labelling to the utility contract No it's not: https://blog.soliditylang.org/2022/08/08/calldata-tuple-reencoding-head-overflow-bug/ ? funny thing discovered today default address is used by someone in mainnet https://zapper.fi/account/0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 Hey, having trouble using the sign cheatcode. Testing a contract that checks a message has been signed by an 'authority' address, have the message hash matching up with the message hash the contract produces. But OZ's tryRecover(hash,sig) is returning the 0 address as the signer. Anyone with any experience in this area? Make sure this works for you first https://github.com/huff-language/huff-project-template usdc = ERC20(0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48); getting error after trying to get usdc.decimals() inside a test contract anyone knows why? Doesn't look like it's supported.",310
1085,foundry-support.txt,"I just ran foundryup and I'm getting this error when trying to compile with v0.8.16: > Solc Error: dyld[70242]: Library not loaded: /opt/homebrew/opt/z3/lib/libz3.dylib > Referenced from: /Users/paulrberg/.svm/0.8.16/solc-0.8.16 > Reason: tried: '/opt/homebrew/opt/z3/lib/libz3.dylib' (no such file), '/usr/local/lib/libz3.dylib' (no such file), '/usr/lib/libz3.dylib' (no such file) Thats my code I also tried to rm -rf ~/.svm/0.8.16, upgrading to the latest svm-rs and manually installing solc v0.8.16 You'll need to provide more info - are you trying to fork mainnet? If yes, did you read the guide? https://book.getfoundry.sh/tutorials/forking-mainnet-with-cast-anvil nope im running forge test and I want to access USDC decimals from my test contract You might be misunderstanding how Forge works. You can't access Ethereum Mainnet contracts by default; you need to ""fork mainnet"". See the tutorial I shared above. ohhhh ok that's cool i thought I can access mainnet thanks! 👋 anyone know why I might be getting an overflow error on this contract call broadcast in a script? Am I doing something wrong, or is there maybe an issue with scripts and one of these array datatypes? https://github.com/carlosdp/decisions/blob/local-env/contracts/script/DeployLocalEnvironment.s.sol#L43 after running ""foundryup"" I am now getting a failing message when I try and run forge tests.",368
1086,foundry-support.txt,"Any ideas what happened here? i think it’s z3 missing ugh do brew install z3 @mattsse @rohitnarurkar did not realize that Z3 is ALWAYS loaded so that now that we ship the solc binaries with it it’ll crash if it’s not installed Hi, anyone had any luck verifying contracts on Arbitrum Rinkeby? forge verify-contract \ --chain 421611 \ --compiler-version v0.8.12+commit.f00d730 \ 0xbe053dd370fab739485d82ddd616e8f40d8f605a vaults/contracts/factory/VaultFactory.sol:VaultFactory ${ARBITRUM_KEY}  The verify works fine and I get a GUID, then when I run verify-check I just get: Waiting for verification result... Contract verification failed: Response: `NOTOK` Details: `Invalid API Key` Copied the API key straight from arbitrum 😡 Does it get verified when you go to etherscan? I am having this same issue now too. Did you solve it? It’s an issue with z3 been shipped with the latest solc binary. You need to brew install z3 their is an issue that goes through this https://github.com/foundry-rs/foundry/issues/2712 how do I nuke the ~/.svm/* folder Thanks Samuel, I'll try that rm -rf ~/.svm Can confirm that this was the issue Yep, after installing z3 It does not, I've been able to verify in the past when using forge create Can you please open an issue? do you mind walking through the steps you used to solve things brew install z3 if possible, could u also provide contract source in the issue description? it's apparently linked dynamically, no idea if there's an option to statically link this or what the default is https://docs.soliditylang.org/en/v0.8.9/installing-solidity.html#smt-solvers I was wondering if there is something like @openzeppelin/hardhat-upgrades for Foundry? I know I saw a repo recently to deploy and upgrade proxy, but my main question is for the storage validation, @openzeppelin/hardhat-upgrades also keep track of the storage of your proxy to avoid storage conflict or re-order...",475
1087,foundry-support.txt,"ctrl + f @jordaniza has a repo that illusrates this It’s also a bit tricky, in the sense that specific versions of solc are compatible with specific versions of Z3. And you will need to fetch the appropriate Z3’s cask. So switching solc versions also becomes quite inconvenient. Just trying this out. Will check back tomorrow and let you know. We could revert back to the solc binaries built without Z3 until we figure a way out. @ehildenb wdyt here? basically all the z3-related stuff is making distribution harder Are you guys using Solidity SMT Checker? I always turn of Z3 integration for my builds of solc because it conflicts with K's needed versions too. If you're not using Solidity SMTChecker, you can pass -DUSE_Z3=off -DUSE_CVC4=off to cmake when building solc. We had it turned off but people wanted to try out the Solc FV features But, Solidity SMTChecker is simply awesome. It would be a shame to limit users ability to use it, but maybe they can have it separately. I would say though, if Foundry is not using it directyl, turn it off for now. Is Foundry able to juggle multiple solc's at a time? If so, it may be the solution. Is it possible to use a flag with the “solc” binary to ignore the SMT checker? Not while building it, but while using it If users want solc SMT integration, they can also use the CVC4 solver, or they can use the Eldarica solver with Solidity SMTChecker, because that works really well actually. This I don't know. @leonardoalt ? Cvc4 is probably not supported on Mac M1 Darn MacM1. We have teh same headaches. Has anyone sucessfully solved the ""\x1B[31mSolc Error: dyld[64723]: Library not loaded: '/opt/homebrew/opt/z3/lib/libz3.dylib'\n"" + error for a MacM1 yet? I tried the solution of uninstalling z3, nuking the svm folder, and reinstalling z3 and get the same error message If this is possible, we can simply add that flag/field to foundry as well. And it shouldn’t be an issue for us.",495
1088,foundry-support.txt,"If not, we can’t distribute those Solc binaries because not all foundry users will have (or want to have) Z3 installed. Plus different versions of solc need different versions of Z3 so its a no no. What version of solc are you using? have you rm -rf ~/.svm It is opt in, so not run by default, even if smt solvers are available Hmmmm, so how is that causing Foundry problems then? Is it at packaging phase (just dealing with versions), or at runtime? The solc binary has been built with z3 solver. If this binary is distributed and used by someone on a machine without Z3 installed, its an issue right? This only happens if solc was compiled with z3 linked dynamically. The OSX non M1 compiler binaries are shipped with static z3 Foundry Support Ah! Yea for macos I installed using hombrew, so it was dynamically linked It simply won't be able to use the smtchecker, but shouldn't crash. Unless it's required by the binary, which it might if it's compiled with z3 dyn linked For instance, the Linux binaries are *not* shipped with dyn z3 at all, it simply DLOPENs it at runtime, but doesn't depend on it Got it So yes its a problem for osx then Because z3 is linked dynamically I am using 0.8.16 @gakonst I think I should probably release new binaries with Z3 disabled. Since OSX has Z3 dynamically linked, the solc binary depends on it and hence the errors to OSX users. foundry downloaded solc in ~/.svm. It might OK to use solc binary should we statically link for macos then? That'd be great. That's what the solc releases do for OSX I can work on it tmrw… z3 version 4.8.17 would be best i think, can confirm in 30min I see multiple repo in this channel that help deploying or upgrading proxy, but this is not really what I'm looking for, I'm talking about the storage layout verification that oz does.",440
1089,foundry-support.txt,"As I see these repo will upgrade a proxy but they don't do any storage check to make sure you keep the same order, you don't endup with conflict z3 also started bumping their minor version a lot in the last weeks due to continuous API changes which requires some more work on our side... So sticking with 4.8.17 for now Should the new solidity versions (0.8.16 for eg) be compatible with 4.8.17 z3? when you run deployProxy with the oz package, it create a .openzeppelin folder with a .json file that keep track of all your storage, so then when you upgrade it will detect if you are doing something wrong with the storage I just edited this msg, had wrong content That's what I want to verify in a moment, but I think that's what it's using now The first time I tried building 0.8.16, I had the latest version of z3 installed. Which was 4.20.x yeah we dont have that Wait, 20??? I will fix this tomorrow. Is it ok for you to use 0.8.14 for now? That doesn’t depend on z3 It was 4.10.1 a few days ago lol Sorry. 4.10.x Typo Ah ok That *could* work but we haven't tested it yet with their API changes I noticed that anvil_loadState and anvil_dumpState don't reapply all rpc methods that were called before loadState – wanted to understand which it works and doesn't work for (I ran a test case w/ anvil_impersonateAccount. It seems like the most intuitive would be that it is dumping all account storage & code rather than reapplying previous rpc calls – is this correct? yes thank you! can you please anounce it here when this is fixed Yes, will share a message Yessir confirm z3 4.8.17 is what solc osx non M1 ships currently Yup, I checked here: https://github.com/ethereum/solidity/blob/develop/.circleci/osx_install_dependencies.sh#L64 I'm building another binary. Will push now.",451
1090,foundry-support.txt,"Shouldn't take much time btw @leonardoalt do you yourself use OSX on M1? I usually rely on Solidity's CI to do OSX things, but we haven't gotten M1 machines yet from CircleCI - solc-builds: https://github.com/roynalnaruto/solc-builds/commit/fc7263e8b571b6a4c754d443fa4b7b4236b4735f - svm-rs: https://github.com/roynalnaruto/svm-rs/pull/59 @gakonst I'll publish this and then update ethers-rs/foundry solc was built with z3 statically linked, so those errors should disappear now. is there a ""live"" version of vm.selectFork ? For example to deploy contracts using different RPCs in the same script? WDYM live? It’s in latest version for a few weeks now any idea why i cant see the output of the error here forge test -vvvv [⠊] Compiling... [⠒] installing solc version ""0.8.15"" [⠘] Successfully installed solc 0.8.15 Error: Solc Error: i just get empty error, no traces Ctrl+F Tldr new svm break it , nuke svm folder and brew instal z3 This should start to fix it once it gets merged into foundry : https://github.com/gakonst/ethers-rs/pull/1588 With forge script, when --verify is set but not --broadcast, does it look at run-latest.json? Can I point it to another broadcast log? vm.selectFork already live but multi chain deployment not yet i can reproduce dunno if someone else was able to for an issue report or not https://github.com/foundry-rs/foundry/issues/2712 https://t.me/foundry_support/20716 the fix is merged.",407
1091,foundry-support.txt,"it should be out in the next nightly release Many thanks! cool thx, how long does it take for nightly releases? Nightly means it’s updated every night 😬 So you can run “foundryup” and it should be fixed After midnight today, i.e If you can't wait for the nightly build, run foundryup -b master that's now become my morning routine as I'm 10 hours ahead I am having some problems with anvil completions , where forge and cast work fine , but anvil does not It this a bug ? https://imgur.com/a/SU4PWmd Please see gif ,it is oversized so you can choose to download or play full screen What IDE setup do you use/recommend? well if u use vscode you can add foundry vscode snippers , but if you like living in the terminal you can use any flavor of NVIM just search ""foundry"" at VSCode extensions? no here https://github.com/crisgarner/awesome-foundry I wonder how it happened Someones joke? nice list thanks! Is there any way to fork a chain and get the past event logs for a given address? Basically, a cheatcode equivalent of this? https://www.quicknode.com/docs/ethereum/eth_getLogs Seems like there is getRecordedLogs() but that only get logs you've recorded. Hey everyone, is there an easy way to turn off stack too deep for testing code? Just started using foundry recently for testing, any help is appreciated no, that's a Solidity compiler issue oh that's an issue with how we generate them, can you please open an isue for that? Roger Try surrounding the offending block with {}, sometimes helps. I keep getting this error, forge create --rpc-url http://localhost:8545 --private-key ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 src/Storage.sol:Storage [⠰] Compiling...",420
1092,foundry-support.txt,"block arrives and you immediately query for information from it and the info is not there related https://github.com/ethereum/go-ethereum/issues/16123 https://support.chainstack.com/hc/en-us/articles/4440543903257-EVM-node-returns-Missing-trie-node- yea, maybe its an issue with AvalancheGo either way, think there's some way to prevent the panic ? we are working on adding a way to propagate the result up so that we can handle it currently not possible and you need to retry is there a graceful way to exclude file (a script or a contract) from compiling? is it ok that pragma of contract from <./src> influence compilation of script from <./script> when the contract isn't imported to the script? A moment of surprise! the whole project is compiled as one Oh, thanks! https://book.getfoundry.sh/reference/cast/cast-storage doesn't say about parameter limit, but I got ""error: Invalid value ""35707666377435648211887908874984608119992236509074197713628505308453184860937"" for '<SLOT>': number too large to fit in target type"". Is it designed to accept only some range of slots? shouldnt be can you open an issue with your exact command sure just to be sure: at [this repo](https://github.com/foundry-rs/foundry/issues)? ye done https://github.com/foundry-rs/foundry/issues/2738 i see it too, find a fix? looking to test an ERC2771 compat contract by deploying a forwarder and generating a signed request in tests -- anyone have examples of such tests being written with foundry? Hey, Having trouble using the ""sign"" cheatcode and getting the message signer to return from OZ's tryRecover function. message hashes line up, and the signer is recovered when using the standard ecrecover.",397
1093,foundry-support.txt,"but when using the EDSCA tryrecover function it returns the 0 address, anyone familiar with what might be the problem? Kate after foundryup, do you still see any issues with solc 0.8.16? just did the latest foundryup: installing foundry (version nightly, tag nightly-bdc661f52da5da842d859301f53f6eab28af9919) and my tests run but it default compiles now to solc 0.6.12 when before it was using 8.0.13 and we havent changed any pragmas Could you try force using 0.8.16 and see if the tests still run? we have some open zeppelin imports that wont allow 0.8.16 I changed the pragma in one test that doesnt use any OP imports to 0.8.16 and it works perfectly again so I think we're good to go. Will keep you posted if I encounter any more bugs but seems to be working great again Hey @gakonst, weird wrinkle - this appears to be at least in part related to the contract. I created a barebones contract with no dependencies and just a pure function, and verify works. I tried with more complex code and it does not. Getting a bit more context then I will raise the issue @jordaniza LMK what you find, experiencing similar problems with verification right now as well Pls open an issue yep Thanks @jordaniza I was able to validate the same contract deployed in a different manner using the standard-json-input method on Polygon etherscan, so must be an issue in foundry I managed to get a subset of contracts verified by passing —verify to the deployment script But the verify-contract command seems to struggle Hi guys, a quick question, is there a way to get a transaction's stateDiff with foundry, forge etc? Besically I am trying to find a way to get the state/storage changes of a TX that interacted with my contract I also had some issues with verifying our contracts through forge script (on Rinkeby). I read somewhere that etherscan has issues with verifying contracts that have constants defined, not sure if it's related Updating Rust helped me to fix it When using --skip-simulation + --slow and broadcasting the second transaction fails due to gas limit.",482
1094,foundry-support.txt,"Is this a bug or I forgot to config a parameter? How do I deploy a contract that it is in an older pragma version of than the current one? If I recall, you don't need --slow with skip simulation. What is your forge version ? Latest? Yea latest, just did a Foundryup this morning. Let me try without --slow Error: Failed to estimate gas for tx: 0x4e62…bcef Which chain ? rinkeby The JustFile is here https://github.com/dferendo/ethernaut-foundry/blob/main/Justfile hi guys, i'm loving the debugger so far! I'm wondering is it possible to view the stack and memory encoded as decimal numbers? Hi guys, I'm writing a test that checks that the tx reverts due to ""EvmError: OutOfGas"".",173
1095,foundry-support.txt,"I am currently checking for revert with no reason like this vm.expectRevert(), but I was wondering if there's any way to specifically check for this error with the vm.expectRevert cheatcode? does FFI cheatcode work in windows? vm.deployCode GM Guys! i was trying to resolve the Mapping challenge with foundry using fuzzing, but the counter example that im getting its not what im expecting :S :S Any ideas? https://github.com/eugenioclrc/capture-the-ether-math-foundry/blob/soluciones/test/4-mapping.t.sol#L39 when forge test -vvv , i sometimes get - SIGKILL Forced Quit , stuff on the net suggests to restart the terminal , but still same issue, anyone have any ideas ? problem gif - https://imgur.com/a/O90MR7f Maybe this is memory related perhaps it uses too much memory so your OS kills it? ok , let see if I can bump up the specs of that codespace vm It would align with the stage it happens, because right after compiling finished we have the largest memory, contains all the json compiler output artifacts So max memory corresponds directly to the size of your projects, very large projects can have >100MB solc output Fixed Gif - https://imgur.com/a/cH7K9A1 Thanks again for the answer , initially when i was running a github codespace wih this specs - 4GBRAM/32GBHDD - the forge test fails but then when i was running a new github codespace with this specs (higher) - 8GBRAM/32GBHDD - The forge test works You mentioned the large projects can have >100MB output , which is still small , as compared to the RAM, maybe I need to study how the compiling process of the EVM in general to understand this issue. thanks tbh I haven’t profiled the overall nem consumption but it shouldn’t be anything close to that lol Maybe you have something else running that pushes the machine to it’s limit? its github codespaces , maybe part of the RAM is being used to keep the connection and services up , will look for some online for tool that can let me see memory being used If I have a suite of brownie tests with a lot of fuzzing, can anyone give a general estimate of how much faster this might run with foundry? It takes one hour and 44 minutes with Brownie.",499
1096,foundry-support.txt,"litterally minutes at most your better off running a digital ocean instance droplet then running the IDE like that if u want well , digital ocean doesnt have an online ide as such , not unless I set my own instance up with something like gitpod , but that involves knowing how to setup a kubernetes cluster and setting up certificates, connection profiles , etc , its way too complicated github codespaces like gitpod , an online ide , few clicks and completely isolated dockerized container with an ide for learning testing etc , those gifs were made when I ssh into the VM , but primarily its an online ide where u work in vscode When using foundry anvil, is there a way to see my console.log or require(...) logs in the console when interacting with the contract? Hey guys, I'm getting the following error which doesn't make any sense ot me because the path looks correct and the file exists: ParserError: Source ""lib/mud/packages/solecs/src/System.sol"" not found: File outside of allowed directories. The following are allowed: ""."", ""/Users/moralpunk/dev/graal"", ""/Users/moralpunk/dev/graal/lib"". Evidence that the file exists, not sure why my remapping here isn't working, any ideas? It’s not supported rn but we can easily add this Mind opening an issue for this? Useful to have This could be a simple remappings issue since the path is not standard dapptools/nodemodules Can you check your remappings? If this is a common JS dir layout please open an issue and we can add support for auto remappings detection for this These are my remappings: `solecs/=lib/mud/packages/solecs/src/ std-contracts/=lib/mud/packages/std-contracts/src/` Where forge is searching is correct (they path its telling me doesnt exist, does infact exist), super weird We could add more logging on the Anvil side for evm internals Could you also please check that the root dir is correct or try with —root .",412
1097,foundry-support.txt,"If this is public please open an issue I’ll have a look Is there a good way to enable gas reports even when all your tests are fuzz tests? ah gas reports should probably use a deterministic fuzz seed now, similar to https://github.com/foundry-rs/foundry/pull/2591 could you open an issue? https://github.com/foundry-rs/foundry/issues/2751 Is it possible to install sub repo / tree? I’m getting ‘fatal repository not found’ When running forge install <gh-username>/<repo>/tree… do repo@branch Neither >forge install superfluid-finance/protocol-monorepo/@dev/packages/ethereum-contracts Nor >forge install superfluid-finance/protocol-monorepo/packages/ethereum-contracts@dev Worked for >superfluid-finance/protocol-monorepo/tree/dev/packages/ethereum-contracts/ Oh I see. Yeah you want to install a sub package in Monorepo hmm Not a huge deal. I’m ok installing the entire monorepo and using remappings Thanks One thing I noticed is remappings need a forward slash appended. Would be cool if that was optional We've gone back and forth here can I build one file? with something like forge build contract1.sol forge script <fname> Btw why not do simple solc then? because I am writing some automated tools I am trying to get the names of the contracts in a solidity file with multiple contracts If I run anvil, will it have the same test accounts everytime? what is an BIP39 mnemonic phrase how do i enter the mnemonic phrase with anvil? hello everyone! i'm new to fuzzing in solidity, but have some experience in scalacheck (scala property based testing library). what's general approach in generating arbitrary input values? e.g.",371
1098,foundry-support.txt,"let's say my function accepts a string that needs to be in UUID format, everything else is rejected (so if I just let forge generate random string, it probably won't generate a valid UUID) only idea I have is to accept uint in my test, and transform it to UUID? but i'm not sure how that would work in case of invariant tests? thanks! in scalacheck, there's a concept called generator: https://github.com/typelevel/scalacheck/blob/main/doc/UserGuide.md#generators is there a way to debug a previous mainnet tx and step through the opcodes it went thru w foundry? Hi everyone I've follow the tutorial for create a foundry project but I downgrade the solc version to 0.8.0 and they show me this : bash Source file requires different compiler version (current compiler is 0.8.0+commit.c7dfd78e.Darwin.appleclang) - note that nightly builds are considered to be strictly less than the released version I change the .toml : solc_version = ""0.8.0"" file and the remapping file with : ""solidity.compileUsingRemoteVersion""=""v0.8.0"" WORKING WELL know thanks I'm trying to interact with the forked mainnet using cast and anvil. Basically I'm following these steps https://book.getfoundry.sh/tutorials/forking-mainnet-with-cast-anvil But when I transfer from the $LUCKY_USER I got the following error: cast send $DAI \ --from $LUCKY_USER \ ""transfer(address,uint256)(bool)"" \ $ALICE \ 1686045944718512103110072 ProviderError(JsonRpcError(JsonRpcError { code: -32602, message: ""No Signer available"", data: None })) It is reproducible by following the ""Forking Mainnet with Cast and Anvil"" tutorial Am I missing smth? Thank you Hi Team.",409
1099,foundry-support.txt,"I was trying to build Foundry from source and got a linker error: Compiling foundry-cli v0.2.0 (/Users/.../foundry/cli) error: linking with `cc` failed: exit status: 1 | = note: ""cc"" ""-m64"" ""-arch"" ""x86_64"" (...) = note: ld: warning: ignoring file /opt/homebrew/Cellar/libusb/1.0.26/lib/libusb-1.0.dylib, building for macOS-x86_64 but attempting to link with file built for macOS-arm64 Which I was able to fix with two commands: rustup target add aarch64-apple-darwin cargo build --target=aarch64-apple-darwin But now as I build I get my binaries in a specific directory for that specific target and also need to specify the target every time I build. I can override it locally in Cargo.toml, but this seems like a hack. If anyone has any suggestions on how to fix it in another way - would be great. Disclaimer: totally new to rust. I saw that the same question was raised before by @alexanderattar but didn’t find the answer. Also carefully read through all the issues on libusb and adding/removing warnings around it, but it doesn’t seem like a libusb issue in my case, but rust incorrectly detecting the architecture? can you echo LUCKY_USER and ALICE to see if u see an address? Can you forge init with a specific solc version? For example, 0.5.0? Yeah, I can see their addresses weird.",335
1100,foundry-support.txt,"i wrote that tutorial 😅 you could use a local ide and rsync or mount the remote locally wtc why do you need UUID? are you able to follow it? here is the asciinema recording of me trying to transfer some DAI to the $LUCKY_USER: https://asciinema.org/a/mGIbAy0GjrHOL8YavZOxjYgfP anvil 0.1.0 (7ff257d 2022-05-07T10:41:55.940005+00:00) cast 0.2.0 (bdc661f 2022-08-12T00:14:14.692552Z) Oh nice , i just saw a youtube vid on doing remote dev on a cloud server , lol I was using gitpod so much prior to code spaces , i totally forgot this was possible , thanks ! heey, so. What's the best way to indentify cause and resolve errors like. ERROR ethers_solc::resolver: failed to resolve versions ? Anyone else getting Solc Error: It installed 0.8.15 and just throws this now Any way to reinstall it https://github.com/foundry-rs/foundry/issues/1991 thank you. and sorry for not looking hard enough first. How do I uninstall foundry M1 MBP 2022 version Just did foundryup and then forked femplate It said installing 0.8.15… Forge test does this now All of my other repos are also broken and will not compile with the same error I want to either reinstall via command or uninstall and then I can install on my admin profile Was working like 30 mins ago now it’s bricked I think if I uninstall and reinstall it’ll be fine I just don’t know how. I did forge help but nothing yet Ctrl + F for the error you are facing It’s a problem with the changes to svm well, that's just one example, what if you wanted to build e.g.",417
1101,foundry-support.txt,"shopify, simplified: - one function that creates a product - one function that creates an order (so you need to somehow choose which products you want) it doesn't matter if it's UUID or uint, what are the odds invariant test would be able to pick product that exists? in this case, I guess you'd need to somehow say ""pick any product from contract.getProducts()""? that's easy with fuzz test, but I don't see how you'd be able to do that with invariant? is there something I'm missing? Hello, is it possible to somehow ""untouch"" slots? It seems gas profiling gives significantly lower results than what we get on mainnet probably because slots are already touched since the test is executed in 1 tx. There is no error See It’s just empty can't repro you might be bettter off opening an issue I mean is there no way to uninstall foundry That’s all I’m trying to do here You can remove the binaries and svm, but I don’t think there an uninstall option. So remove forge , cast , anvil and also foundryup rm -d $HOME/.foundry/ Thanks Does foundry support smart contract deployments? I can't find documentation for that 👀 Scripts and VM.broadcast() cheat-code sometime rm -d might throw an error , so you can instead rm -rf but be sure of what your removing hi guys, new to forge —> I have this contract ```pragma solidity 0.8.13; contract TOK { string public name = ""Token Name""; string public symbol = ""TOK""; uint8 public decimals = 18; }``` I do forge build, then forge inspect TOK storage but it is just empty? what am i doing wrong? I was getting it. Seems like an issue with 0.8.15.",372
1102,foundry-support.txt,"So I just reran it with --use 0.8.13 hey is there any reason why forge script doesn't verify every single contracts deployed? some are and then some arent' Forge coverage still isn't production ready right? I'm getting lines reported as covered although I have no tests for them Also, anyone know how to get hardhat solidity coverage to work when used in a forge + hardhat combined repo? It can't find the import files so I'm assuming it's just a remappings issue, but haven't been able to solve it hi guys, is there a way to deploy raw bytes as an contract with cast or foundry? with send it seems like i always have to provide a TO address How do I use GNSPS library in foundry This is a dumb question but normally I don’t use custom libs checking out the snapshot cheatcode and it seems that it might be useful for making consequent tests persistent across state...has anyone tried this? Foundry is full of error I tried two month to solve my issues Better get on with hardhat what was your error? I want to test a defi But recieve resolve errors: [7920] [6275] Most of it for import did you read the docs? Yes.Somebody reported these error as issues About 3 days ago on github link? This fixed it Thank you is there any doc (should it be mentioned at <https://book.getfoundry.sh/forge/traces>?) on how transfer to EOA looks like in traces? I'm looking at a trace on Anvil -f where a quite old contract console [28005] 0x1844…fbda::withdraw(1) │ ├─ [0] #EOA#::fallback{value: 1000000000000000002}() │ │ └─ ← () Everything green, but tx value doesn't match when check cast balance. So I wonder if I even read the trace correctly. fallback isn't what I really expected. Tried at a testnet, and indeed `cast balance` on Anvil didn't reflect this transfer; even when forge script was tried with --legacy key.",443
1103,foundry-support.txt,"is vm.getLogs() actually a cheatcode? I see vm.recordLogs() and vm.getRecordedLogs(), but don't see vm.getLogs() is it possible to forge coverage only a folder of interest? tried doing forge coverage --match-path contracts/include_this_folder_only/ but didnt work. also it looks like if i were to do that, it would exclude the test/ folder that has the same parent dir as contracts/ what if you do something like; forge coverage --match-path contracts/include_this_folder_only/**/*.sol I think you could also create a profile in foundry with that test path and just do forge test coverage thanks! it's showing all 0's ideally i think it should be a combination of the test/ and contracts/this_folder_only/ Yeah, probably this is the way Not sure how else I am supposed to encode tuple arrays, am I missing something? Hey all, let's say I wanted to do forge install on a github repo that uses yarn to manage its packages. Is there a way I can install this repo's dependencies via forge or do I need to run yarn install in the lib folder? you can forge install it But you will need to cd in the package and run ""yarn install"" As you said Ideally can do this in a makefile We could I guess add a step in Forge install which does that? @mattsse wdyt https://github.com/foundry-rs/foundry/issues/2673 ""refactor cast RunArgs so it can be used as a standalone function"" Anyone able to clarify on what it means to refactor a structure so i can be used as a function? or if there exists any examples Hey all, I am trying to check my test coverage so I run ""forge coverage"". But it seems like have some error. could not find anchors for branches: we do not have the bytecode for USDJBank Is there any solution for this error? sorry I haven't update my foundry. after I update it, it works now I have issues with foundry So installed it with ""curl -L https:foundry.paradigm.xyz | bash"" on wsl ubuntu But foundryup does not work May help me what to do? Can you try running “which foundryup” ? That is previous foundry i installed Not new installation with wsl ubuntu I must add new path? Yes.",485
1104,foundry-support.txt,"Haven’t used wsl in a while , and don’t understand windows well enough to help. But setting to path usually helps for these things in wsl .. adding path to bashrc would be fine (if you are using bash shell) Tnx for help I install foundryup. Now have forge Cast And anvil They zipped What next to do? There is something wrong as they should not be zipped sorry I read wrong lol They should be unzipped and added to path automatically Can you try rm -rf ~/.foundry and try foundryup again? Maybe your installation was interrupted what error are you getting? I'm using foundry on wsl2 and have no issues w/ the installation. Tnx You have a heart made from gold It installed and i am super happy the vm.getCode cheatcode returns the deployment bytecode. Is there any other cheatcode that returns the runtime bytecode given the path to a contact? Note: I know that I can load the code via <address>.code but that's not what I want. is there a way to label each broadcasted transaction so that when i look at the receipt it shows the name of the contract i am deploying? Why has the default value of bytecode_hash been set back to ""ipfs"" on master? (reverting the change introduced by PR 1177) I digged this after noticing that deploying with CREATE2 gives me different addresses between environments. https://github.com/foundry-rs/foundry/issues/1177 I can't get a test to pass in which I'm testing the address of a contract created with create2. I'm using the computeCreate2Address utility from forge-std, and then checking the value I get with the actual contract being deployed. I have made sure that: 1. The bytecode hashes match 2. The salts match 3. The deployer contracts' addresses match 4. The metadata hash is disabled in the Foundry configuration file What could the reason for why the test doesn't pass? Hey is there a way a script contract (Example.s.sol) run a different setup depending on which network it is running on? This might be a bug in Forge or the REVM.",451
1105,foundry-support.txt,"I opened an issue: https://github.com/foundry-rs/foundry/issues/2777 unless i missed something forge is calculating correctly i tried a random tool from github https://github.com/frozeman/eth-create2-calculator and passed the necessary values and got 0x2371573DAF3C77674eC904AF420892C410530E0D found it i think It could be that some feature used by my contract triggers a miscalculation of the create2 address. Or it could be a mistake that I made, of course, but I went through all ideas I have for what that mistake could be oh mds1 answered it already in the gh issue, but yeah its the encode instead of encodePacked Yep. Just seen that now. Thanks for your help It maybe not related to foundry , I am not sure if foundry can compile zk logic in contracts. Thats why i have posted this question here rather than in the rust discord hello rust people , I recently came across this rust library , for using these ZK proofs , while I am just reading about them , is this - https://docs.rs/zksnark/latest/zksnark/ crate used for writing zk circuits ? just curious I am getting this error when verifying two contracts I have deployed: Error: Checking verification result failed: Context: - Verification is still pending... it's been 15 minutes that seems etherscan related what does the contract page show ? oh sorry it verified it now! took so long !! what RPC were u using , if I may ask ? for the deployment ? alchemy the blockchain is polygon testnet mumbai so odd, that one is pretty quick , thanks for the headsup ah makes sense , polygon testnet always is congested when I deploy with `--optimize --optimizer-runs 1000` I get Response: `NOTOK` Details: `Fail - Unable to verify when trying to verify Hi , Is there by any chance I can use foundry to interact with a deployed verified contract?. Usecase: Trying to write a test that checks if a deployed contact follows a specific implementation guide. Or does anyone know of any resources or article that can help thanks.",453
1106,foundry-support.txt,"can anyone help with this? You can run your tests in a forked environment https://book.getfoundry.sh/forge/fork-testing is it possible in foundry to listen whenever a new block is created and run some code using foundry . In ethers.js it is possible using provider.on(""block"", callback fn) Thanks, thought about this too but never followed up, I will try and read more about it 👍 Hi does anyone know how to have in-depth error messaging in Anvil like with what's possible with Hardhat? For example it telling me exactly why a tx was reverted Try messing with -vvvv, it ought to give you some nice output. Nice video 👍 I'm suddenly getting the YulException: Variable xx is 1 too deep in the stack. But I've enabled the settings to make coverage reports work. Is there a way to address this that won't mess up coverage reports (like maybe running more optimizer runs)? in that same warning, did you get something about the memorysafe inline assembly block guard? YulException: Variable _50 is 1 too deep in the stack [ _1 _30 _50 _37 _3 _29 _7 _15 _6 zero_struct_TestState_mpos _46 _49 _1 _49 expr_address_3 _49 _1 _49 _48 ] No memoryguard was present. Consider using memory-safe assembly only and annotating it via 'assembly (""memory-safe"") { ... }'. Having a hard time finding what to do through searches yea so what's happening is that there's some inline assembly block either in your code or some library that is not marked as (""memory-safe"") and may perform unsafe memory operations. https://docs.soliditylang.org/en/v0.8.16/assembly.html#memory-safety this blocks the lifting of variables from stack to memory, which is why you get the error Ah, ok that's annoying lol. But I see. Although it doesn't like having this phrase added at all. Hmm maybe the linter isn't up-to-date, not sure This shouldn't be an issue because solidity ver is 0.8.13 though Do you know of any good sources where I can learn what exactly is going on in that error statement? I think I'm going to have to hunt down where this is happening. you mean the linter msg? No, sorry, I meant the yul exception/ memory guard.",498
1107,foundry-support.txt,"But realistically, I don't know how to match those values in the stack example shown there up with what it is in the contract that's getting pushed too deep... So I might just be able to re-order something and avoid an issue... Especially since these contracts I'm testing against won't have Memory-Safe in them as they're external I just think these assembly instances are going to be super prevalent and I can't readily go adding it to any import that has assembly in it haha. I'd like to learn so I don't have to ask 🙂 Like, what variable is _50 in the solidity file? etc etc (also, if I might just need to adjust some of those settings in the .toml to get it to be more efficient? but wait, did adding the memory-safe guard not help? no, I'm still getting it. If I know what the variables were that were being accessed right then, I could probably locate where it's failing and make sure that there wasn't something obvious there folks I'm having a brainfart, anyone have problems running ffi on WSL ubuntu? getting os permission error 😐 nvm, my script was wrong thanks rubber ducky string[] memory inputs = new string[](3);   inputs[0] = ""echo"";   inputs[1] = ""-n"";   inputs[2] = vm.toString(abi.encode(""gm""));   bytes memory res = vm.ffi(inputs);   assertEq(string(res), ""gm""); got this to work is the latest foundry stable? getting this now, can't figure it out. even tried changing the solc ver ahh i figured it out. i had an function called ""invariant"" that i guess was colliding with the new invariant feature New to foundry, thank you for this. We should get better errors for invariant edge cases, pls open an issue. But yes, invariants have landed I saw rustup bugging out and building for x86_64 when I requested arm64. Its a bit of a mess.",415
1108,foundry-support.txt,"What's your output from the following: λ file $(which rustc) /Users/jacob/.cargo/bin/rustc: Mach-O 64-bit executable arm64 ~ λ file $(which cargo) /Users/jacob/.cargo/bin/cargo: Mach-O 64-bit executable arm64 In my case, it was actually finding and preferring the OLD /usr/local/Cellar/libusb/`(x86_64) over `/opt/homebrew/Cellar/libusb/ (arm64) and I was having issues there. In the past I had success with overriding the DYLD fallback paths DYLD_FALLBACK_LIBRARY_PATH=/opt/homebrew/lib:/Users/jacob/lib:/usr/local/lib:/usr/lib There seems to be a few issues with DYLD_LIBRARY_PATH and DYLD_FALLBACK_LIBRARY_PATH, and propagating to child process, it's not simple. homebrews response seems to want to get everyone to use -L ""${HOMEBREW_PREFIX}/lib"" now that arm64 libraries live under /opt/homebrew/lib Hi all, I have a script trying to deploy several contracts and make set-up calls for the contracts. However, when I call the command to run the script forge script script/DeployScript.s.sol --rpc-url $RPC_RINKEBY --private-key $PRIVATE_KEY_TEST --broadcast it ONLY deploys the first contract, and then exits execution as if everything was good. I go on-chain to check what happened, and yep, only one contract deployed. Any ideas? I have to add that simulation seems to run okay (its spits out all the pretended contracts). facing some issues removing forge-std and idea how I can edit the index? I have removed forge-std from gitmodules Hi folks, I am working on on-chain testing for Compoand. I get stuck on a testing liquidation. Not sure which cheatscode suiteable for this case. My question is how to manipulate price or borrow amount to make collateral to be liquidated. I've tried vm.roll, wrap, of course didn't work. My code: https://github.com/SunWeb3Sec/DeFiLabs/blob/Comp/src/test/Compound.sol Look up how to uninstall git submodules! @mattsse @onbjerg wonder if we shoild add this to forge remove.. Are you looking to modify a balance? vm.store? Yes, I think modify a balance will work.",493
1109,foundry-support.txt,"Check the helpers for writing to storage slots without knowing the exact slot, based on a public function that touches your desired slot, inside forge std OK, I will take a try, thanks a lot. thank you ser, that solved it what did you do exactly? git rm -r lib/forge-std rm -rf .git/modules/lib/forge-std that cleaned out any traces. subsequently i could proceed to install forge-std with no issues (also made sure forge-std was not listed in .git/config file) Hi guys, I wonder if there any guides for me to use forge coverage, I think my report seems incorrect reinstalling foundry, I am stuck this error. command used: cargo install --git https://github.com/foundry-rs/foundry foundry-cli anvil --bins --locked rustup update but you can also use foundryup i did use foundryup first. but it said forge, cast and anvil are already installed and remove the directotories. and so i removed the directories and ran this command. is there any way to remove all traces of previous foundry installation so that I can start fresh again? Problem resolved. I can liquidate via max borrow without cheat code.",252
1110,foundry-support.txt,"code is updated to DeFiLabs is there an example of how to use forge script to deploy a contract and fund that contract at the same time if the constructor is payable? use —value param forge create --chain=xxx --rpc-url=xxx --private-key=xxx --value=""0.002 ether"" src/xxx.sol:xxx --constructor-args “a” “b” can you share the repo to reproduce? if you do it the solidity way to pass a value, it should work you can remove ~/.foundry if I have launched anvil via --fork should I be able to disconnect from the internet and be able to deploy on it? because it seems that at least from forge script it needs the connection to gather some info hm, i dont think so, or it depends on how much data there is cached i think that whenever you interact with a different address which is not cached, he has to query data @mattsse would know better tho Can vm.store be used to change specific items in a struct? Or is there a clean way to abi encode the content of the struct and save it in it's storage slot? The error says it's not supported (yet? 😏) but happy to hear if someone found a good way around it Ah also saw https://github.com/foundry-rs/forge-std/pull/148 I'll wait an answer from him Hello, our CI recently started failing because the container in which it runs is running out of memory. Is there some way how to limit the memory consumption of the forge command? We are having a lot of tests. Thank you if you use a constant block (-b) then it will load the already retrieved and locally cached state how much memory does the container have? do you have a lot of invariant/fuzz tests? trying to pinpoint the cause afaik, there's no way to limit it is the repo public? make sense what about forge script it seems that the --value is not working do you mean --fork-block-number? yeh, I believe -b is the short version nope 😄 -b, --block-time <block-time>  Block time in seconds for interval mining --value is not to be used in this context do this yes, and it started failing in this PR https://github.com/AztecProtocol/aztec-connect-bridges/pull/206 -.- so what's the correct way to do that? .",499
1111,foundry-support.txt,"so it would ""automatically"" use the balance from the msg.sender ? yeah uhm I don't think so tbh not the msg.sender, but the one you set on broadcast() did you try? ok maybe this answer also another question, the broadcaster is also the one used for CREATE2? by default isn't the msg.sender that I would assume is the one signing the tx? thanks for this! looks like there's something suboptimal with triple verbose which consumes a lot of mem here can you try running without -vvv in CI? could just be that the traces require a lot of mem Hey, on https://book.getfoundry.sh/reference/anvil/?highlight=sender#examples there's anvil --sender 0xC8479C45EE87E0B437c09d3b8FE8ED14ccDa825E which yields an error as Found argument '--sender' which wasn't expected What is the correct way to impersonate an address when running a script on anvil? that shouldn't be there -.- I can confirm that it does not work. I have anvil --fork-url INFURA_URL --fork-block-number 15351883 now I disconnect from the internat and execute forge script script/Test.s.sol:Test --fork-url http://localhost:8545 --fork-block-number 15351883 <BLABLABLA> and even if the block numbers matches it fails because it tries to call the infura RPC even on the second try? if you do .broadcast() without any arguments, then yes no, CREATE2 can only be called by contracts. there's a default CREATE2 deployer under the hood unless im missing something, its impossible that this would work maybe if you do . anvil . script . disconnect . script <- maybe it works, since it cached all storage accesses from the first script but . anvil . disconnect . script any address/storage access anvil will try to query the state, but it's disconnected I'm doing the second one do you know where can I found that address? it seems to be no where written in the docs Just tried running it silently and it indeed solved the issue. We are fine with running the tests silently in the CI as we are able to reproduce it locally if needed.",463
1112,foundry-support.txt,"Thanks a ton 👍 https://github.com/AztecProtocol/aztec-connect-bridges/pull/209 0x4e59b44847b379578588920ca78fbf26c0b4956c ah sad 😅 Is there any docs on how to run a script with a certain address (for which i don't have the PK)? Essentially I want to ""execute"" a test on anvil and afterwards connect a ui to the rpc to check some things. My idea was to just use a script to breadcast on the anvil... which does not work as you can't prank in a script, so i thought —sender might be the way to go. thanks for flagging this highlighted some issues with how long we store traces for fuzz tests, if we run a test 256 times and record everything this can grow quite large for large functions do you also know which is the nonce of the deployer when I deploy the first contract? because I'm trying to verify that computeCreateAddress works as expected but it seems to fail there's anvil_impersonateAccount RPC call which allows you to send tx (`eth_sendTransaction`) with any sender ah but then i would not be able to execute things via test or script, but would do this externally i guess? CREATE2 does not use nonce though https://eips.ethereum.org/EIPS/eip-1014#specification sorry mate, it has been a long day 😄 and if i'm not mistaken, passing value to the CREATE2 should work as well on deployment. but i dont recall testing it out tbh Hey guys, In fuzzing test I get this error : [FAIL. Reason: Assertion failed.",349
1113,foundry-support.txt,"Counterexample: calldata=0xe91f2bce7bffd7fefdfe5bce6bd5ed7ff7bf5bdd6f77fffffff5fbf97e89b1f950f48d81, args=[56086517127299914060063391332138712444952232236594461639213641932100368371073]] So I have an arg 1e58, while I use something like that uint256 input = bound(input,1,1e30); Why do I have an input so big ? the inputs are bounded in your code, so assuming you have the bound set up correctly, it’s bounding it to somewhere in the space u defined and still hitting an error basically: inputs aren’t bounded directly, but in code. and you’re still hitting a revert after the bound so there is likely a bug in ur code Yes it was the case with log o have been able to find out what was wrong but the input arg was quite misleading anyone seen this before? was working just fine for over a week i think im getting rate limited rm -rf ~/.foundry but why is it panicking from a rate limit? changing rpc, get same error ? What provider is this? It’d be helpful if you can reproduce the rate limit and then share a curl dump of a random request so we check status codes etc what is curl dump ? r u referring to curl -D aaa I don’t want to accidentally leak any info let me get it I’m assuming it’s panicking because it doesn’t know how to parse a rate limit from this specific provider Klaytnapi .com yeah infura+alchemy return a specific status code for example Hello! Any tips on the correct way to test functions that receive a calldata argument? I am sure this question has been asked before, but can’t find the answer anywhere. Is using vm.mockCall a sane way or are there better alternatives out there? Thanks in advance. And I am loving foundry 🙂 will respond in a bit, on call with couple of students is there a way to pass over the outOfGas errors? a cheat to add gas maybe? Using the --etherscan-api-key flag for forge test doesn't do any modification to my traces.",465
1114,foundry-support.txt,"(I am not using —fork-url with it but am using an rpc specified in foundry.toml) Also when adding the etherscan section to foundry.toml shown here, likewise nothing is changed. https://book.getfoundry.sh/reference/config?highlight=etherscan#etherscan anyone see this before, or know how to resolve it? 😅 $ forge build [⠊] Compiling... Error: Solc Error: dyld: Symbol not found: __ZNSt3__113basic_filebufIcNS_11char_traitsIcEEEC1Ev Referenced from: /Users/cf/.svm/0.8.15/solc-0.8.15 (which was built for Mac OS X 12.0) Expected in: /usr/lib/libc++.1.dylib getting this as well foundryup -> rm -rf ~/.svm and then forge b again i was able to get invariant testing working in a fresh repo, but when i added an invariant to one of our AMM test suites, i get the panick crash. im guessing i should create a ticket? yes please with a repro mm I tried this, no luck 😢. I'm trying updating my mac os to 12.0, since it mentions that in the error message and I'm currently at 11.5.1. @jeremytwei what version of mac os are you on? Are you also using an m1 macbook? I solved my issue by downgrading to solidity 0.8.14 (both in my .sol files and in my foundry.toml file). I am using an m1 macbook and on MacOS Big Sur Version 11.6. interesting.. ill lyk if updating my macos to monterey works for 0.8.15 @jeremytwei yep, updating my mac os to monterey resolved the issue. can now forge build with 0.8.15 I think it might have something to do with the versions of z3 that those macs ship ctrl +f , brew install z3 should do the trick` i also tried that before updating to monterey, still didnt work @rohitnarurkar do we statically bundle z3 also for 0.8.15? hey. i just dived into foundry and couldn't find anything about upgradeables.",490
1115,foundry-support.txt,"Seems counter intuitive to be able to load an env protected key into something. Is there a way to feed that in without doxxing it? Is there a reason why you are building your own action? There is already you. You can use here : https://github.com/foundry-rs/foundry-toolchain For the key, you would add that to your git repo as a secret .. then call from the run https://docs.github.com/en/actions/security-guides/encrypted-secrets just confirming, there is no post-test hook available in forge test, right? like afterEach() in Mocha? Awesome. I need to learn more about how actions work. I saw that and wasn't sure if it had to be ran on a ubuntu based system, or rather, if that's just how it's being ran on github. Sweet. I'll take a look Hi guys! I just did foundryup to upgrade and now all my builds with solc 0.8.15 are failing. [⠊] Compiling... [⠔] installing solc version ""0.8.15"" [⠘] Successfully installed solc 0.8.15 Error: Solc Error: ^^ That's literally what's turning up for me. Was fine before I did foundryup literally 30 mins back and it seems to work for any solc version that's not 0.8.15. Any clue what's up? https://t.me/foundry_support/21167 Thanks! This worked. what’s the difference between deployCode cheatcode vs. new Contract() in tests? New would create an instance of the contract from via inheritance , deployCode uses the byte code from the artifacts directory. Hey guys, when i run forge test -vvv i got bytes sig for function instead of functions names; DAI::313ce567() <- shoud be DAI::decimals() did u provide an etherscan api key? (i’m assuming u are using a mainnet fork) you are right :S, i add --etherscan-api-key And now is working as expected, i wonder why, i have add a interface I'm getting like a 20% chance of a contract being verified by etherscan (performing deployment + verify multiple times, trying to reproduce a simple example) via forge script --verify.",485
1116,foundry-support.txt,"Is there any easy way to see what is being submitted to etherscan (raw http logs?) to play spot the difference? Default foundry.toml compiler settings, have a hunch it may be related to remappings. Or is there a process to manually take the artifact and attempt verification? Like Standard input json artifact? you can run RUST_LOG=trace forge … ty ty found it TRACE foundry_cli::cmd::forge::verify::etherscan: Should I expect to be able to use CREATE2 on local anvil? I mean, is it a bug that I cannot? Opened 2807, 2808, 2809 to keep things clean. The tricky one is 2809, happy to codeshare privately if you need. I am trying to log into Etherscan and its rerturning a 500. Maybe it might be lined to your verification woes @jordaniza Not sure, I've had this issue on and off for weeks does anyone know how to pin versions in foundry for CI according to docs its nightly only Is there any documentation on invariant tests? is there any way to check upgradeable contract storage slots and see if the new contract is okay Stupid question: how do I use an envrionment variable in vm.createSelectFork(FOUNDRY_GOERLI_FORK, 7412222); where the rpc url/key is stored in ~/.bashrc ? How do I call an environment variable in a solidity test? IIRC , foundry would read .env files automatically , but not sure about dot files vm.envString Check the env cheatcodes can you please give me an example of how I import that in a test? vm.createSelectFork($RPC_URL_FROM_ENV, 555555) ? We don't rly support that, because we only keep last three days of night lies around I think that's it. Looked around the docs and was thinking I have to pass it through config file first. vm.envString will probably do. thanks! Anyone know why i am getting this error. I am trying to do some fork testing following the example on https://book.getfoundry.sh/forge/fork-testing Ok, any plan for versioned release soon? Check the cheatcode reference.",463
1117,foundry-support.txt,"createFork takes a string not address You can still use foundryup -C COMMITHASH With your desired nightly commit ohh thanks I was confused when I saw ""MAINNET_RPC_URL"", does that mean the url of the contract on etherscan? The RPC url actually HTTPS://infura.rpc.... no. that's and RPC url. it's a link/provider you use to fork ('copy') the network. Signup for on on alchemy or infura. Oh thanks, i have the alchemy key already. It looks like i got the whole fork testing wrong. what i was trying to archive is to be able to test a deployed contract with foundry, and that was the reason why i inserted the addr where the rpc should because i was like where is it going to reference the contract 🤦‍♂️ You have any idea on how to test a deployed contract? @parseb Likely too broad for this chat. I would use an interface IContract(contractAddr) or deploy the contract locally. or fork the source repository. No clue what u're trying to accoplish. good luck. this is what i am trying to archive 😅 @parseb so basically what i am trying to archive is to be able to test a deployed contract with it address. I don't know if that is possible if its verified you can grab the abi from etherscan and generate an interface using https://gnidan.github.io/abi-to-sol/ then in the test just use the address w that interface to run the tests 👍 if you're only looking to test a deployed contract in one chain, disregard the forking cheatcodes imo. write your test script, create your interface (if you dont have the contract) ... IContract c = IContract(address) assert(c.function() == somethingsomething) ....",374
1118,foundry-support.txt,"and just call your script : forge script ScriptContract --rpc-url ALCHEMY_URL -vvvv @jordaniza feel free to DM me for the verification issues Thanks @kesarito i will try this out Thanks will look into this 👍🏽 Can you deploy contracts with cast? Hi All, does anyone have or can anyone point me to any materials for testing/deploying and upgrading diamonds eip-2535 natively with foundry? https://book.getfoundry.sh/forge/deploying?highlight=cast%20deploy#deploying technically, you probably can with cast send passing the bytecode to --sig ? never tried. but this would be quite niche. you're better off with forge create or forge script ive searched back and seen a few people having the same issue verifying contracts. im using the same bash script that i had it working with before and my env vars are correct, has anyone come up with a solution? RUST_LOG=trace forge script script/CollateralAgreementDeployer.s.sol:DeployCollateralAgreement --rpc-url $RPC_URL \  --private-key $PRIVATE_KEY \  --broadcast \  --verify \  --delay 20 \  --retries 5 \  --chain-id $CHAIN_ID \  --etherscan-api-key $ETHERSCAN_KEY -vvvvv >>log.txt im getting Contract verification failed: Response: `NOTOK` Details: `Fail - Unable to verify are you able to share your repo? which chain? Trying to install foundry from source on WSL I'm getting I'm also having issues verifying a contract, on optimism. I've tried: 1. Using the --verify flag with forge script on the script that deploys my new contract 2. Using forge-verify 3. Verification with ethercan ui also fails though... strange @AaronAbuUsama which chain are you deploying on? did you also try verifying with the etherscan ui? goerli i can verify on etherscan manually or with remix but its just a bit anoying i love the fact i can just work in solidity in vim with no context switching, not a big deal but just mildly annoying for sure, I'm not a fan of it either haha.",462
1119,foundry-support.txt,"I'm just asking because I tried verifying with the ui and it also didn't work, so wondering if the same applies to you for debugging this issue can anyone help with this, please? thank you! :) yea @joshiedo we've been having issues verifying on optimism, any ideas on potential causes? tried a ton of different approaches as chad mentioned but all have failed hi, im running traces in test env, and i have an interface for Timelock with both methods. Forge trace detects the name of the second method, but not the first, any ideas what am i missing? would like trace to print out both Timelock::admin() and Timelock::delay() is timelock an interface or a deployed contract ? if you could share the repo, it would help a lot or a reproducible case, since i can verify fine :( havent tried optimism in a while, ill check interface in sol of a vyper bytecode contract admin is a public field actually, that probably may be the issue? yeah, interfaces are trickier. we get the sigs from sig.sam and that one does exist though can you try running testSetup as a script? hmm, i c, was wondering why ""delay"" is picked up, and not admin forge script TestContract --sig ""testSetup()"" and see if it shows there [⠊] Compiling... [⠢] Compiling 13 files with 0.8.16 [⠰] Solc 0.8.16 finished in 1.12s Compiler run successful Script ran successfully. Gas used: 40357 == Logs == address for timelock: 0x7AaCc5300ec7Ac58fe86645D08f21b1BEcadf99a this is the output -vvvv with verbose, sorry [⠊] Compiling...",387
1120,foundry-support.txt,"[⠢] Compiling 13 files with 0.8.16 [⠰] Solc 0.8.16 finished in 1.12s Compiler run successful Traces: [40357] TimelockTest::testSetup() ├─ [2262] Timelock::admin() [staticcall] │ └─ ← 0x0000000000000000000000000000000000000000000000000000000000000001 ├─ [2308] Timelock::delay() [staticcall] │ └─ ← 172800 └─ ← () Script ran successfully. Gas used: 40357 == Logs == address for timelock: 0x7AaCc5300ec7Ac58fe86645D08f21b1BEcadf99a hmm it does, but not on the tests, im running ""forge test -vvvv"" hm, its possible we dont have sig.sam decoding for forge test ill have to check thx, lmk if i need to add an issue yeah, if you dont mind, id appreciate it 🙇‍♂ but one limitation is that the sig comes without the return type, and so its not properly decoded probably should try and find a way to get it from the interface 🤔 sorry, false issue about the SOLC Error: i fixed it, will open the ticket for the traces If I read a hex bytes32 value using string hexString= vm.readFile() , how do you cast it from the returned string to bytes32? Before suggesting it I can confirm that the following method does not work bytes32(bytes(hexString)) a string is not guaranteed to fit in 32 bytes, but you can use assembly like this: function stringToBytes32(string memory str) internal pure returns (bytes32 result) { assembly {  result := mload(add(str, 32)) } } but again, be aware this will only keep the first 32 bytes of the string, so it's a lossy conversion if you have long strings Tried this too with no success. For context, my hexStrings are (uint8 v, bytes32 r, bytes32 s) signature values generated by a separate script because the signature is on Chain A and the execution is on Chain B .",478
1121,foundry-support.txt,"I am trying to do it foundry but I am seeing no light at the end of the tunnel and I am considering fall backing to etherjs I get this error: FAIL. Reason: Setup failed: FFI disabled: run again with --ffi if you want to allow tests to call external scripts. and I have ffi = true in my foundry.toml, not sure why just use remix and the etherscan plugin, its the easiest way i have found Guys, I'm doing some tests and forgot to change a hard-coded variable on the constructor of the contract I'm testing, just made the change but can't force the constructor to run again, someone knows how to do it? how can i validate storage slots when i upgrade a proxy contract it just upgrades to new implementation without checking it. I'm having an issue where i'm calling a SC in anvil but after making the call, anvil stops working/is stuck/does not respond, but making the same call on a hardhat node works properly Anyone have any idea why this could happen or had this problem before? Open an issue with logs I.e RUST_LOG=anvil some_command it says command not found Some_command= whatever command you were running before The first bit tells the compiler which types of logs to emit I.e anvil logs Ohh gotcha strange, specifying paths for out, src, test, etc now is throwing panicks was not happening before in this project will send a pic i was trying to add the openzeppelin repo using Foundry with ""forge install openzeppelin/openzeppelin-contracts"" but I got this error: Error: This command requires clean working and staging areas, including no untracked files. Modify .gitignore and/or add/commit first, or add the --no-commit option. tried -no--commit but no avail Can someone help me? Somehow I can't find the solution I still can't get forge create to work. This is with a basic template, with a blank contract ""contract Contract { }"" forge create --rpc-url http://localhost:8545 --private-key ac.....80 src/Contract.sol:Contract [⠆] Compiling... No files changed, compilation skipped Error: could not find artifact: Contract @chadflem and @AaronAbuUsama -- i tried a few times, and it seems sporadic. some succeed and some fail.",486
1122,foundry-support.txt,"might be an etherscan issue Which method of verification did you use? forge script --verify fwiw, ui verification in etherscan failed for me too, tried forge flatten and verifying in etherscan could you please open an issue for this I'm getting 0 feedback from this callstack. Is there a way to further inspect calls besides —debug? issue? how? Also, why not start a discord, seems like a lot less options on telegram. can't reproduce this, forge install openzeppelin/openzeppelin-contracts --no-commit works with changes in working area could you please open an issue with your OS Ok, found the issue link. would need a bit more context here, could you please open an issue and add a repro or link to repo? But the link end up in a loop. :Support This issue tracker is only for bugs and feature requests. Support is available on Telegram! opened one https://github.com/foundry-rs/foundry/issues/2825 will take a lot at this hi! what’s the state of forge fmt? planning on using it for a repo i’m working on I ran: curl -L https://foundry.paradigm.xyz | bash foundryup and it works now! I'm trying to import the openzeppelin contracts but it's giving me this error: ""Error: This command requires clean working and staging areas, including no untracked files. Modify .gitignore and/or add/commit first, or add the --no-commit option."" Can anyone help me? Add the no commit flag forge install openzeppelin/openzeppelin-contracts --no-commit ? Hello everyone im trying to test my withdrawMintFees() function wich returns the ether in the smart contract to onlyOwner. This function works just fine in remix, but in foundry i get [FAIL. Reason: EvmError: Revert] testWithdrawMintFees() (gas: 96406.",397
1123,foundry-support.txt,"Thanks anyway. function testWithdrawMintFees() public { nft.safeMint{value: nft.mintFee()}(msg.sender); nft.withdrawMintFees(); } this is the test function, how would i ahve to change it in order to work theoretically, you could make a library that uses .ffi to get the calldata of a transaction hash but did you understand the issue here ? this is one option the other is writing a fallback function in your contract i did*nt quite get it. and for me its hard to wrap my head aropund since everything works when testing manually in remix why would it work in remix but not in foundry the way testing works in foundry is: you write your tests in a test contract (NFTest), and the testFunction is called by an EOA. in your testWith...() you're withdrawing ether. which means that the ether is being sent from your NFT contract to your NFTest contract. however solidity states: your NFTest probably doesn't fit any of those requirements and thus fails. what you can do instead of writing those functions is to use startPrank() or prank(): https://book.getfoundry.sh/cheatcodes/prank?highlight=startPrank forge fmt --check should probably work out of the box in a foundry project (it throws a 1 exit code if there are differences) uint forkId = vm.createSelectFork(mainnetHttpsUrl); uint latestBlockNumber = block.number; console.log(""latestBlock number is: "", latestBlockNumber); for (uint i =0 ; i < 25; i += 100) { console.log(""i is: "", i); vm.rollFork(latestBlockNumber - i); } When I use the forking feature I cannot see the console.log printed while looping? Is there a way to turn this on? Actually I only see the first console.log printed but not the subsequent ones .prank() is for a single call.",411
1124,foundry-support.txt,".startPrank() is for many @jengelh i feel a bit stupid but id doenst work: function testWithdrawMintFees() public { vm.startPrank(address(0)); nft2 = new NFT( ""NFTTest"", ""NFTT"", ""http://nft.com/"", "".jpg"", 1, 100000000000000000 ); nft2.safeMint{value: nft2.mintFee()}(msg.sender); nft2.withdrawMintFees(); } vm.startPrank(user) where user is someone that it will mint to you need to do vm.stopPrank() after you call withdraw you can DM me if you want, so we dont take up all the space here Thanks I will that's so kind of you, Joshie! 🙇‍♂ Not only kind, but also a genius! problem solved. solution, i had to become a diffrent account and fund it beforehand. math issue, you put i<25; i+=100. of course only printed one. change to for (uint i =0 ; i < 2500; i +=100). you will see. hope it helpful. hey all looking around foundry and switching from hh... besides foundry book, what are some recommended repos where I can see some good testing code and learn best practices. It is a bit different from hh, looking to learn more about local network manipulation (time advance, blocks advance...) and basic setup of addresses and transactions... also what are some of your top features you love from foundry :) haha... thanks all ⌨️🤓 for now I use forge and migrating tests within still a HH project 🍿 https://github.com/ProjectOpenSea/seaport/tree/main/test/foundry https://github.com/SunWeb3Sec/awesome-foundry alrighty 💪 seeing the projects also use a combo of tests, some HH some forge on purpose / is there a reasoning behind? Hey, can you help me plz? I followed your instructions and got the justfile working but need help about what to change so that I can export abis in json format.",448
1125,foundry-support.txt,"Where is this setting for ethers_solc_output? Hi, what's the fix for error[6275] basically I am trying to use openzepplin as a git module but getting import issues on forge build Can anyone explain how scripting works under the hood? I'm a bit confused, because when running a script with a rpc/fork url, I can pull on-chain data and use that, but I can also console.log (and the console address doesn't have code on rinkeby). And how should integration tests be done? Do I basically just run forge test on a forked network that includes the same setup script that would be run using forge script? did you run forge remappings > remappings.txt in root? Also, does anyone have a good setup for tracking deployments on various chains and using these for upgrades? Maybe through ffi Hey, how do I install an old version of Openzeppelin? im using 'forge install openzeppelin/openzeppelin-contracts@3.1.0 --no-commit' and getting the error that the repo was not found nvm figured it out I needed to add a v before 3.1.0 silly yeah if a contract is deployed inside the constructor of another contract, is it possible to have get script --verify working or do i just have to verify it separately? does it not verify it? didn't just now on goerli: https://goerli.etherscan.io/tx/0x087b493b12b5c8ce01ba37962e92b3552f985bb1be8b075b5c04a6fbed5b0c1f (can see it verified the main contract but not the implementation contract it deployed in its constructor) happy to open an issue in repo if this is a bug @joshie maybe we don’t right @joshiedo (just verified the implementation separately so will show up now on the explorer for tagged people checking this out later) Is there a way with Foundry to access the storage slots of an external contract, similar to the getStorageAt functionality in ethers.js? Like for example I wanted to check the value of a private state variable at a particular contract on chain.",456
1126,foundry-support.txt,"Is there some way to do that or am I forced to use ethers/web3.js? https://docs.ethers.io/v5/api/providers/provider/#Provider-getStorageAt https://github.com/foundry-rs/forge-std/blob/master/src/Vm.sol#L22 it's load cheatcode awesome, thank you! We don't atm I can add that tomorrow, I've seen it mentioned a couple times already Solidity 8.1.5 introduced .selectors member to errors but I cant find any documentation on how to use it Say I have this code  function _userExpectsError(string memory error) internal {   hevm.startPrank(user);   hevm.expectRevert(abi.encodeWithSignature(error));   ...  } should i not beable to replace the abi.encodeWithSignature(error) with error.MyError()`?  function _userExpectsError(string memory error) internal {   hevm.startPrank(user);   hevm.expectRevert(error.MyError());   ...  } @joshiedo is it cool if I add you to a github repo to help take a look? still no success verifying. I can send you the details privately should just be hevm.expectRevert(MyError.selector); thought I can't really tell what is the error variable. like say the contract i was testing was contract SomeContract {  error MyError(); } this is all the solidity docs say its new so i cant find an example of it being used anywhere @joshiedo actually, I think it's related to us using bytecode_hash = ""none"". I just tried a new deploy using forge script --verify and bytecode_hash = ""ipfs"", and it deployed and verified successfully..",349
1127,foundry-support.txt,"any thoughts wrt that ^? you can get more details here https://github.com/foundry-rs/foundry/issues/2795#issuecomment-1216877543 Hey, getting the following error message when building from source (foundryup -b master): error[E0658]: deriving `Default` on enums is experimental --> /home/samgoldman_eth/.cargo/registry/src/github.com-1ecc6299db9ec823/revm-1.9.0/src/db/in_memory_db.rs:41:24 | 41 | #[derive(Debug, Clone, Default)] |      ^^^^^^^ | = note: see issue #86985 <https://github.com/rust-lang/rust/issues/86985> for more information = note: this error originates in the derive macro `Default` (in Nightly builds, run with -Z macro-backtrace for more info)  Compiling watchexec v2.0.0 For more information about this error, try `rustc --explain E0658`. error: could not compile `revm` due to previous error warning: build failed, waiting for other jobs to finish... error: failed to compile `foundry-cli v0.2.0 (/home/samgoldman_eth/.foundry/foundry-rs/foundry/cli)`, intermediate artifacts can be found at `/home/samgoldman_eth/.foundry/foundry-rs/foundry/target` did u figure out the issue? in you case, since the error is declared within the contract, you’d have to vm.expectRevert(SomeContract.MyError.selector) I'm running an Ubuntu 18.04 machine btw do u have nightly toolchain enabled by default? hmm but you should still be able to verify without bytecode hash? e.g.",372
1128,foundry-support.txt,"uni v3 deploys without it and still is verified on etherscan it might’ve been verified using source files instead of standard json the verification provider needs to somehow get the og contract code either you provide it using flattened source files / multipart or upload it to ipfs I'm pretty sure it was done with hardhat using standard json https://github.com/NomicFoundation/hardhat/blob/767f68dee84d6a47cd40153a8ab8552f41a95d5e/packages/hardhat-etherscan/src/etherscan/EtherscanVerifyContractRequest.ts#L11 https://github.com/Uniswap/v3-core/blob/412d9b236a1e75a98568d49b1aeb21e3a1430544/hardhat.config.ts#L48 interesting, i’ll take a closer look tmrw morning If that question was directed at me, then no, I don't i’m not sure if it’s available on stable just yet, but in general, foundry master relies on nightly neither work this is the test im trying to convert https://github.com/nation3/court/blob/d9272afabdc9241a561a233001a59a1fde6cce55/test/foundry/utils/AgreementFrameworkTestBase.sol#L125 awesome, thanks a lot 🙏 Would it be helpful if I added you to our repo and point to the deploy script we've been using for this? yup, it would, thanks.",315
1129,foundry-support.txt,"gh: rkrasiuk cool ill dm u privately i cloned down ur repo, which error are u expecting there? nvm @AaronAbuUsama  function _aliceExpectsErrorWhenJoining(bytes32 agreementId, bytes4 err) internal {   hevm.startPrank(alice);   token.approve(address(framework), 2 * 1e18);   hevm.expectRevert(err);   framework.joinAgreement(agreementId, CriteriaResolver(alice, 1e18, proofs[alice]));   hevm.stopPrank();  } sample usage  function testCantJoinDisputedAgreement() public {   bytes32 agreementId = _createAgreement();   _bobJoinsAgreementWithPermit(agreementId);   hevm.prank(bob);   framework.disputeAgreement(agreementId);   _aliceExpectsErrorWhenJoining(agreementId, IAgreementFramework.AgreementIsDisputed.selector);  } hope this helps thanks @rkrasiuk its almost 1:30 am my eyes are glased lol will try in the morning is it possible to use the deal cheatcode in scripts that just ingerit from Script or only in contracts the inherit from Test? Is it possible to run forge test inside of the anvil? I still haven't found a way to test inside the local node if you want to give it a go https://github.com/foundry-rs/foundry/pull/2840 should be usable, just need to add some tests and maybe change one thing GN everyone , is that possible to store something as a global variable after a return function and can we add argument on function tests ? Ey foundry frens, just found a bug running the debugger: Seems like it's not a reported issue ? I will provide a full repro in few minutes If it's not fixed yet I'd like to fix it myself plz :) how accurate is the gas reporter? I get a lower gas consumption on etherscan than in the gas-report table Hi, I'm trying to installing Foundry on my EC2 instance. But its not getting installed and shows connection timed out error.",446
1130,foundry-support.txt,"testing upgradeable contract and normal contract is same right with foundry? Can anyone please help me out ? can anvil start from a predefined genesis.json file? Check your firewalls & ports are open Is there a feature in foundry similar to ""State changes"" in tenderly? Would be cool if I could do sth like uint256 diff = vm.diffStart(); vm.diffEnd(); or similar to generate a storageslot diff for a certain tx execution. There's --diff on forge test but it sth different. anyone got a clean way to get forge fmt to run on save in vscode? Standard vscode way works fine Hi, I am not sure this is the right place for this question but atm can't find a better one: I was looking for information about how to interact with an Anvil Node using Vyper Titanoboa More specifically, I'd like to use Titanoboa to interact with a forked chain so I was thinking about Anvil for that purpose @storm0x has been doing a lot of foundry / vyper work and might be able to provide pointers Great to read that hello team. is CTF in solidity / foundry this year or py? @gakonst we've talked about this but not sure if we're tracking in an issue? supporting state diffs would be super helpful, the cheatcode idea here is interesting + I think cast run + traces in general should have the ability to also show state diffs @sakulstra do you mind creating an issue to track this and we can flesh out the UX a bit more there forge test -vv --match-test ""testHarvesting\$"" No tests match the provided pattern: match-test: testHarvesting$ I get this while using regex? How to get this working? My issue is that I have several tests like this: testHarvesting testHarvestingZeroBalance testHarvestingNoBalance And I just want to run the first one: testHarvesting hey. doing a simple flow test on openzeps governance contracts... having some issues... but even after contract init, they still have address_zero... wtf am I doing 😡 where do u define alice? in TestParameters alice has address look at the startPrank you have it as address(0) thus sending all those txs from 0 address so it tries to mint to address 0 but simple store box contract...",492
1131,foundry-support.txt,"alice isn’t defined yet at that point it seems just look at the trace, you can see it calls startPrank with the 0 address so alice isn’t defined there ok you need to call createUsers in the constructor some garbage commit - https://github.com/kristjank/blockchain-developer-bootcamp-final-project-v2/blob/feat/foundry-testing-switch/test/foundry/VoteFlow.t.sol#L42 yes constructor makes sense, sorry foundry noobish thanks Brock now lets pllllay further ⌨️🤓 i think it should be possible, i havent personally run both, i had run vyper contracts in forge runner tho, but dont see any issue blocking titanboa to use anvil directly. I suggest you join the discord for vyper to ask directly here: https://discord.gg/6tw7PTM7C2 you'll get faster answers In forge scripting, does the msg.sender address resolve to the address corresponding to your PK? I think it's set by the --sender flag, but by default is https://github.com/foundry-rs/foundry/blob/master/evm/src/lib.rs#L33 Ok so default is just the tx.origin message creator starting to fall in love so much less garbage code 💪 Got a bizarre issue that seems to be something wrong with forge's simulation. Have scoped it down to a minimal reproducible example, would love if you could take a look https://github.com/foundry-rs/foundry/issues/2855 how much is the balance? Greater than 1 ether. I grabbed the ethermine address as an example but wait you're depositing 2 ether The Ethermine address has 600 ether 🫡 Did you guys make a change to verbosity in a recent foundry version -vvv seems to output the same as -vv and only -vvvv works for full stack traces Hey, I'm trying to setup my project to just use .env for our infura keys and whatnot, looking around in the docs and it seems that it should just work if I put my keys in the .env file in root, but when I try to run forge test --fork-url https://mainnet.infura.io/v3/process.env.INFURA_KEY it doesn't work.",467
1132,foundry-support.txt,"Any quick thoughts? foundryup? Spaces between the variables of your .env file? no dice 🙁 forge test --fork-url https://mainnet.infura.io/v3/$INFURA_KEY process.env is only in Node JS oi, thank you so much! just a wrong interface 🙂 https://github.com/foundry-rs/foundry/issues/2855#issuecomment-1220984553 Will put on the cone of shame, ty ser Im not sure if this is the right place to ask this. I'm trying to make a small Aave flashloan contract. My constructor looks like this constructor (address _addressProvider) FlashLoanReceiverBase(_addressProvider) public { } I get this error when I forge build: Invalid type for argument in modifier invocation. Invalid implicit conversion from address to contract ILendingPoolAddressesProvider requested I'm not sure if this is just because I havent passed in an address or something with solidity Nobody has done this yet. Should be trivial though, we just got a state access inspector in an open PR for access lists, so we could leverage that. I think it'd be nice if we named the storage slot keys too Try single quote no backslash @joshiedo we got this massive footguns around msg sender TX origin and address(this) I think What kind tho? No way, tried a million combinations, it doesn't work If anyone knows how to match exact test name with regex, I would appreciate sharing it here! Any way to skip certain tests at the stage of setUp being called? i.e. if some environment variable is set, don't run the next test. I'd like to do it for all tests which inhert a single base contract. The use case for this is I have some tests which run against a deployed version of a contract but I don't want to run them on CI because they need a certain private key to pass. I'm okay with these tests passing only a machine with that private key. On this one, I've been thinking to basically log a warning if there are any calls to ADDRESS, ORIGIN or CALLER in the compiled code of a script. There are geniuine use cases for these, but most people probably don't mean it.",456
1133,foundry-support.txt,"forge test --match-test 'testHarvesting\b' finally worked I think $ is not the right anchor here because that expects a \n This looks like an issue with your EC2 outbound connection , permissions https://aws.amazon.com/premiumsupport/knowledge-center/connect-http-https-ec2/ Mods sorry for the non foundry post you still need this? Is anyone else having issues with forge bind on the latest nightly build? It's throwing the same error from this issue in May that has been closed: https://github.com/gakonst/ethers-rs/issues/1321 The steps to reproduce are in the issue. I tried running with the nightly build from 5 days ago and don't get the error. i cant believe i cant solve Random im so sad Yep, I do Hello here! I am doing the ctf but got something weird from a forge script don’t understand why the version are not compatible.. If anyone know why i got that. cause 0.8.16 is between 4 and 9.0 so i don’t get why! I will just keep running forge test today the whole day. just for fun :) is there any documentation on invariant testing? not yet unfortunately.",249
1134,foundry-support.txt,"you can take a look at the the PR for some usage information: https://github.com/foundry-rs/foundry/pull/1572 testdata/fuzz/invariant has some examples https://github.com/maple-labs/revenue-distribution-token/tree/add-forge-invariants also this can be a good place to look at -> book issue -> https://github.com/foundry-rs/book/issues/497 Is anyone playing Paradigm CTF but first how do you setup things? How to generrate a contract signature using forge? Yep! this my questions 😃 how to setup the [rpc_endpoints] is it like this ``` [rpc_endpoints] paradigm = ""http://334.66.135.107:81527"" ``` forge script works but vscode still complains about this, which blocks all of the intellisense on the solidity I have installed with --no-git and --no-commit, apart from that I'm in the project without any modified directory, I go in the script folder and I have this forge install also works https://youtu.be/uelA2U9TbgM?t=255 check this part ok Hi, is it possible to use rpc url from env in cast? Kind of annoying to type —rpc-url each time yea ETH_RPC_URL env var gets used by default if set not yet, but there’s an issue for a skip cheatcode here https://github.com/foundry-rs/foundry/issues/1123 Thanks! There are a few other contributions I want to make first but if it's still not implemented afterwards I'll take a look Helo there, Any idea how to deal with theses kind of issue really horrible everytime anvil fault and you have to reboot… is there a way to just raise error and continue using anvil? Is there a way to send ether within a function call? Ex. I am just adding liquidity to a new pool, and want the other side of the pair to be ETH. How do I send ETH within my test function again such that it is all part of transaction? Or am I supposed to actually have the ETH pulled within the smart contract that I am testing itself? Do I have to do something like this: ``` /// @param fnDetails to be function sig: ex.",467
1135,foundry-support.txt,"ethToToken() /// @param num nonce of eventual caller /// @return signedHash for tx callData function hash(string memory fnDetails, uint256 num) public view returns (bytes memory signedHash) { bytes memory hexString = abi.encodeWithSignature(fnDetails, num); return hexString; } /// @notice call() anything the owner sends it /// @param passedCallData tx that is being executed /// @param _eth msv.value for tx function call(bytes32 passedCallData) public onlyOwner { if (passedCallData != 0x00) { address(this).call{ value: msg.value }(passedCallData); } } ``` and use these as helpers in my test? Can I run forge script to deploy a contract, then use then use the output from that call to verify the contract with verify-contract. I want to validate the contract on a separate call, instead of using the —validate flag just use uint256 value = 1 ether; contract.function{value: value}(args); the test contract has ether already you can run --broadcast first and then --resume --verify later Oooo thanks so much, will try this! Guys, I would like to know why i cannot deploy script usually i am using forge create.. But not working this time any idea why? How to do this using ethers? address(uint160(uint a + uint b )) You mean the test contract for unit testing? yes Where does it say how and what user addresses have ether in the unit testing environment? Or is that not for unit testing but for persistent mainnet fork testing? was wondering if there’s an equivalent of the hevm debugger for a view function i.e. can i step through a getter function line by line in a solidity contract for debugging? cast call —debug doesn’t find debug to be a valid arg is there a way to log without a newline at the end? How to encode an array ? Doing cast abi-encode ""func(uint[3])"" ""[1, 2, 3] gives failed to parse token error Need urgent help How to accelrate and shell in monaco game? What' the process to play after submitting the bytecode? how should i correct this comand? solved Do we have a way to auto reload script and execute? Has anyone here been able to run a forge script against the flashbots protect public rpc endpoint (i.e. running forge script ...",489
1136,foundry-support.txt,"--broadcast --fork-url https://rpc.flashbots.net ? I always get a 502 - Gateway error when trying to broadcast the transactions. can anyone help me setup foundry for paradigm ctf?? https://github.com/zobront/paradigm-ctf the README in that repo actually pretty helpful, have tried following it? I got it. which is paradigm rpc url? For the people who have never taken part in live CTFs (me included) the process of having to use nc, provide tickets, get instances, run docker envs, use python pwn and such seems like something that everybody is already expected to fully understand and be familiar with. I get that this is generally an ""elite"" ctf for high skill people, but where should I look to know what to do? I understand most of these tools separately, but don't really know what I'm expected to do to get started. EG: I know that I need to run chal.py to get some ticket to pass to nc, but I'm missing eth_sandbox which is in eth-base-sandbox so I build it and then build random but then don't know what to do from there. TLDR: I'm okay at Web3 and wanna try the challenges but I'm getting filtered by the CTF infrastructure. What do? Any resources? the general process is 1) nc [ip] [port] 2) provide your ticket (from the ctf site) 3) you should get something like this your private blockchain has been deployed it will automatically terminate in 30 minutes here's some useful information uuid:   [uuid] rpc endpoint: http://35.232.199.80:8545/[uuid] private key: [private key] setup contract: [contract] 4) use the rpc endpoint in whatever ethereum tooling you like (remix, metamask, hardhat, foundry, etc etc) 5) import the private key you're given 6) pwn you're given the Setup.sol contract and the address it's deployed to when you're done pwning (i.e.",433
1137,foundry-support.txt,"make isSolved() return true), head back to the server and select option 3, provide your ticket, and get your flag @saurabh_quillhash ^ hope it helps p.s: you can find the ip address, port and ticket on the https://ctf.paradigm.xyz/challenges/{your-challenge} page thank you I've got some issues with the foundry template for the paradigm ctf, whenever I test my contracts I get an error saying ""Invalid Data"" i think it's the vm trying to fork the current chain: vm.createSelectFork(vm.rpcUrl(""paradigm"")); My typical workflow for the paradigm ctf is to source .env and then run forge test --fork-url=$PARADIGM_RPC_URL -vvv --watch Are doing the same thing? hm i'm just running forge test in forge scripts, in the main run() function, the value of block.number and block.timestamp will be the same than in the tx i am broadcasting into the blockchain? Please open an issue on github! Am I missing something or is vm.getRecordedLogs() not capable of checking the emitter contract's address? forge test --fork-url https://rpc.ankr.com/bsc --match-contract LiFiZapperTest -vvvv    [⠃] Compiling... No files changed, compilation skipped The application panicked (crashed). Message: Unable to create fork: Failed to get block for block number: 20641860 latest block number: 20641860 Location: evm/src/executor/backend/mod.rs:307 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry is this something i should report? or is there a workaround looks like it worked if i use a different provider URL might be a problem with Ankr I am trying to understand why there are so many JSON files being created in the broadcast folder, running forge script , I was following this tutorial - https://book.getfoundry.sh/tutorials/solidity-scripting , Aha never mind , i had ran broadcast more than once, and every time it makes 2 jsons , the suffixed number after run-XXX looks like a unix time stamp if im not mistaken https://imgur.com/a/ZxCr9bT Yeah some rpc urls do not work the intended way.",483
1138,foundry-support.txt,"I had some problems with bsc network does forge test not print console.log() statements? add some -vvv Is it possible to detect when --broadcast flag is set? Would be helpful for scripts that want to do some extra work via --ffi, but don't know if they're being simulated atm Is the syntax for the json cheatcode still vm.parseJson? Reading from here it seems so (https://github.com/foundry-rs/foundry/pull/2293), but getting TypeError: Member ""parseJson"" not found or not visible after argument-dependent lookup in contract Vm. Maybe I'm not doing the interface right, but just calling it with first argument a JSON string and the second argument "".keyName"" not in forge-std yet, but you can just add  function parseJson(string calldata, string calldata) external returns (bytes memory);  function parseJson(string calldata) external returns (bytes memory); and it will work Doesn’t the interface still have to be hooked up to the actual implementation? How is that done? the pr is merged and integrated, it's just the interface in forge-std that isn't up to date yet. The logic in foundry is already there Gotcha, ty i didnt thank you for this. thank you 😄 u got it 🙌 hey, another question: cmd for deployments forge script scripts/foundry/deploy.s.sol:DeployContracts --contracts contracts--rpc-url $GORLI_RPC_URL --private-key $PRIVATE_KEY --broadcast --verify --etherscan-api-key $ETHERSCAN_API_KEY -vvvv errors during verify: `Error: You can only verify deployments from inside a project! Make sure it exists with forge tree` Forge tree includes the contracts... this is a hybrid repo with hh and forge the script itself has to belong as well, should be seen on forge tree awesome thanks, added to foundry.toml. hi everyone. , I'd like to send eth in my contract address that I deployed but I don't know how to do it on the test environnement is someone can help ? Does anyone know of a repo that is using forge & generating solidity docs from code comments? Seems like doing so is still a pretty bespoke process. Hi all, When testing a safemint function in Forge, I'm using the prank cheatcode to initiate the call from a certain wallet address.",486
1139,foundry-support.txt,"I get the error that the smart contract address need to implement ERC721Receiver. Im wondering if there is a way to truly mock a wallet address in forge right now or is that not possible yet? sigh hey there everyone! Is it possible to force a contract to deploy to a certain address? during testing of course want to deploy a USDC but for simplicity I wanted to deploy to the current USDC address use cheatcode: vm.etch(address, code) or fork the chain state with --fork-url refer to message above for a ERC721Receiver-compliant contract You can use deal or hoax cheatcodes. thanks peepo! WORKED woops it worked https://i.imgur.com/bWqK43w.png anybody please help me. i am getting some issue with latest version of foundry. its giving error on typechain generate types as invalid abi. i am trying to switch to older version of foudnry with foundryup -v $version_tag. but its not working. i am taking tag name from foundry repo in all repo's which has foundry dependency it is giving this invalid abi error. want to switch older version of foundry . how can i ? how to deployCode(artifact) multiple times with different addresses? Same... need help in figuring out how to downgrade Foundry.... Hey all, how do I parse the deployed address from a forge create call programmatically? For example, so I don't have to have two separate deployment scripts wherein I manually copy and paste the address of the first contract, which is required as a constructor arg for the second contract. Thanks 🙏 I get that you'd be able to do it by manually parsing the output string, but my brain's too small for that :( ok i think i got the issue. https://i.imgur.com/SA1mNCb.png this .metadata.json files are getting generated . and i am feeding typechain to check out/**/*.json files. so it is giving me error of invalid abi as this metadata.json file contains some other info is there any way to stop generating this .metadata.json files on forge build ??? for now i am removing this files programatically whiile passing to typechain. What is margin in forge build —sizes? I’m guessing imports & guessing that it counts to the total size of the contract.",474
1140,foundry-support.txt,"Is that right? Hi guys Is there any example that forge coverage contains all branches, my test report seems incorrect with solidity test files. forge build creates two folders with same name test.sol and Test.sol only capital letter diff. which causes typechain import error. is there any solution for that ? on earlier version this is not the case !. for more details created an issue here. https://github.com/foundry-rs/foundry/issues/2894 anyone know why my stack traces arent decoded properly? this is on a fork URL on optimism testnet which doesnt have etherscan, blockscout only whats the best way to decode the data coming out from here? Is this a test? Or script Hi, I'd like to use Foundry to run tests on a protocol that makes use of Oracles The strategy I was thinking of is to fork the chain locally and write numbers directly into the ChainLinkOracle Storage The way the Oracle should get the data is by calling _getLatestRoundData() here https://optimistic.etherscan.io/address/0x94740ca2c47e13b7b0d3f44fc552ecc880e1d824#code#F1#L71 which ultimately calls the aggregator, so I was thinking a clean solution would be to create a contract that impersonates the Aggregator and implements latestRoundData() here https://optimistic.etherscan.io/address/0x13e3ee699d1909e989722e753853ae30b17e08c5#code#L98 However, the ChainLink Oracle has the Aggregator set as immutable variable https://optimistic.etherscan.io/address/0x94740ca2c47e13b7b0d3f44fc552ecc880e1d824#code#F1#L14 so since there is no setter method for it, I think the only solution to use it is by using the store() cheatcode  function store(address account, bytes32 slot, bytes32 value) external; https://book.getfoundry.sh/cheatcodes/ How can I use it to change the value of that specific variable? Thanks test it seems like Forge can decode from Etherscan but not from blockscout? Anyone has a cleaner strategy to test internal functions? Not happy by our current approach Hello, I am trying to deploy some contracts using a shell script.",495
1141,foundry-support.txt,"After deploying the first contract, i would like to pass its address as the constructor arg to the second. Is this possible? I usually create a ""helper"" contract, then deploy and call it from the tester contract. Guys, has anybody faced problems with unchecked{}? It doesn't disable the overflow/underflow checks any logic in unchecked blocks are not supposed to have any overflow / underflow checks edited the solution i found is to use —json —silent | sed '2,$d' > myContract.json and parse that further. Devs, please note that the —verify flag does not respect the —silent flag! thank you very much Any idea why forge build --sizes doesn't list out sizes of all the compiled contracts?! Did anyone face similar issue? Does anyone know why this error would pop up ""EvmError: Revert"" ? I'm trying to mint a Uniswap V3 Position NFT and testing with forge that's the test does coverage works fine w require() different branches? I have a test that checks both possible conditions and still shows like one branch is not tested https://github.com/foundry-rs/foundry/issues/2897#issuecomment-1224315594 why are you adding vm.addr when you instanciate those address ? Does createFork work for anyone? Always get ""Invalid Data"" error when utilizing createFork for tests. Fork from cli works fine though Hello how do you do when you'd like to have different setup functions for a given ""ContractTest"" in foundry ? Thanks :) deploying contracts with a forge script. the contractName field on the output is left null. is this a known issue or something I'm doing wrong? Which forge version do you have ? This should have been fixed a while ago hmm. that was it.",367
1142,foundry-support.txt,"I was on another PC for the past 2 weeks, should have remembered to update here first 🤦‍♂️ Member ""snapshot"" not found or not visible after argument-dependent lookup in contract Vm not sure what's wrong here anyone knows? Whats the command for source .env on windows? trying to follow the scripting deployment tutorial in the book what ? there is no command , you just create a .env , there is no native equivalent of touch for windows , you have to just create a file with notepad Ok thank you @mattsse can I dm about a potential issue? is anyone aware of why this could be an issue? Is there a cheat code to swap the smart contract code at some address? etch When I run forge script command do I need to include --fork with local host? i'm getting the error: The argument '--fork-url <URL>' requires a value but none was supplied for deploying through script I thought fork was only for anvil was snapshot removed from Test.sol? Foundry Support it's in vm https://github.com/foundry-rs/forge-std/blob/master/src/Vm.sol#L148 just use http://localhost:8545 hmm, this looks like a abiencode issue could you please share an example in a new issue, perhaps there's another regression due to yesterday's revm bump weird, this is what I'm getting, could the function not be present somewhere else? this is usualy an indicator for a failed abi decode somewhere, but hard to say without an example to debug Hey guys, just got into foundry and its awesome. I had a quick q regarding whether something was possible: I want to do some differential testing of a solidity function against a python implementation of the same function, is this remotely possible yet? https://github.com/FrankieIsLost/gradual-dutch-auction/blob/master/src/test/ContinuousGDA.t.sol#L155-L194 checkPriceWithParameters is always called with a concrete set of arguments, but you could instead fuzz it This is great. Ill try it out and lyk how it goes. Hi beautiful people.",435
1143,foundry-support.txt,"👋 Is it possible to use the vm.prank() and vm.warp() in Solidity scripts ? i want to broadcast some transactions AND manipulate my local anvil instance in solidity 🥹 For example, i am running a mainnet fork and i want to whitelist my contract by impersonating another contract owner in my script :) I think you could manually unlock them in the anvil instance first by calling anvil_impersonateAccount I will try thank you but i have many other anvil manipulation to do so i may try to write a Rust script.",114
1144,foundry-support.txt,"did you every implement the deploy_plain_pool in curve with foundry? so how can I get the actual revert message? the node isn’t returning you a revert message i dont know where you’re testing this just in the terminal Hey gang, i intermittently get this error, it appears when i run forge test and seemingly happens randomly between times where forge test works fine (when nothing has changed). What other info would be needed to debug this or is this sth people have seen before? against the curve factory please open an issue with the steps to reproduce! i have not seen this before its in a private repo so i can try and recreate it in some public code but sure, will try and get to it tomorrow! Hey guys, running into an issue where when I pass in a hardcoded bytes value (getting from encoding via ethers) in to a function on forge, I get some arbitrary value which was not the data I passed in. It looks like 0x30783030...31. No idea where thats coming from. However, if I abi.encode in the contract itself and store that value in a variable as opposed to hardcoding, the expected value gets passed in to the function Any ideas as to whats going on here/potential solutions? Thanks when running forge update I'm getting the followign error: Error: fatal: Needed a single revision Unable to find current origin/master revision in submodule path 'lib/solmate' if I run git pull --recurse-submodules to get that submodule, submodules revert to old versions I'm not aware of. Foundry stays the same version (0.2.0) For example, I can't call vm.snapshot() Is anyone of how to solve this / encountered the same error? Pass it as hex""abcdef"" Otherwise it thinks it's a stirring How do I downgrade to a lower version of forge? Updating forge seems to have broken a few tests. Bizzare, and also now forge build is failing with errors such as: error[6275]: contracts/CreditLine/CreditLine.sol:7:1: ParserError: Source ""node_modules/@uniswap/lib/contracts/Math.sol"" not found: File not found.",445
1145,foundry-support.txt,"foundryup -c <COMMIT_HASH> Getting this error now The commit hash is from Aug 1 https://github.com/foundry-rs/foundry/commits/master?after=4e11d1ff1d01cec67399cb7fdaaf7fa3cf467532+174&branch=master&qualified_name=refs%2Fheads%2Fmaster Hi im trying to test against mainnet fork but get this error message saying that the project id is required in the url. has someone had this problem before ? Hi, I am trying to test staticcalls against an anvil fork The code above is called as the owner of the contract (srcGovernor), and works if I make the actual call, but fails on staticcall The error given is EvmError: Not Activated Does anyone have any idea what's going onhere? So this code runs fine Your infura link is wrong .. you need to add your project I’d to the end of it… verbatim of what the error message says 😂 please alaborate. what project id It’s like an api key you get from infura.. open an infura account and copy the string there . It’s free for now ok i will check out infura works liek a charm, thanks just noticed i posted the key 😅, so i deleted and reeplaced it Im having an issue in my test. I get an error ""Memory allocation overflow"". It's in the setUp function, where I just initialize a few contracts, nothing more. Any idea? if you get this error Solc Error: dyld: Library not loaded: just run foundryup, looks like you're missing an update Hey lads, just got setup with foundry, but ""forge init"" seems to be giving the following error This command requires clean working and staging areas, including no untracked files. Modify .gitignore and/or add/commit first, or add the --no-commit option.",408
1146,foundry-support.txt,"does foundry require me to git init before initializing ? anybody know what is fuzzing in test, how to do fuzzing in foundry? https://book.getfoundry.sh/forge/fuzz-testing response seems clear to me, you are in a git repo with uncommitted changes, so commit them first or use --no-commit i created a new folder and did forge init :P made sure the folder is empty but still got the error. curious try ls -a there might be a .git folder lurking ya i was onto that, it seems ther is a pesky folder by the git name, deleting it now . @SamuelDare thanks m8. is it possible to import vyper contracts into script files? Hello folks, anyone know why this is happening? anyone hitting: ""Failed to create artifact parent folder"" ? no idea why its trying to store artifact on root / umm nvm forge clean fixed it Hi guys, can you help me with a compilation problem please In my project I use the library https://github.com/Uniswap/v3-periphery/blob/main/contracts/libraries/OracleLibrary.sol which has a pragma >=0.5.0 <0.8.0; I would like to use the latest version of solidity (0.8.16) but it is impossible to build the project if forge detects different solidity versions in the different pragma statments of my project files. Discovered incompatible solidity versions in following: [...] Is it possible to automatically use several versions of solc to compile the files with the right solidity version? Uniswap has a ""0.8"" branch, check it out: https://github.com/Uniswap/v3-periphery/tree/0.8 Very nice dude, thank you ❤️ just out of curiosity, is it possible to compile with multiple versions? About vm.getRecordedLogs(), am I right that addresses do not get recorded? So there's no way to check who emitted the log? is it expected behavior that deployCode(artifact) would result in the same address on different forks? e.g. deploying after vm.selectFork(0) and deploying after vm.selectFork(1), the resulting contracts have the same address.",452
1147,foundry-support.txt,"I want to make them persistent across forks but because they have the same address, this messes things up anyone know how to get vscode to recognise my remappings? You need to add https://book.getfoundry.sh/config/vscode why do you need to make them persistent? (just trying to understand) i need to access address(DeployedContract) on the other fork If the implementations are compatible, if yes. But it always depends upon the implementation and if the pragma enables a wide range Just had two failed transactions sent out using forge script after accidentally declaring one method public in a library. Now after changing it to internal and running forge clean I keep on getting this output. Saying ""Code should have been linked before.""... Not sure if there's some other cache that could be influencing this and creating this message oh maybe it’s the broadcast folder? try rm’ing that I did as well no luck oh does forge fuzzy-search for broadcast? I had just renamed it to ""broadcastOld"" and it wouldn't work, but renaming it to something entirely different worked. Or I'm tripping. hmm not sure [FAIL. Reason: Too many global rejects] testFuzzPrice(uint256) (runs: 253, μ: 88134, ~: 88139) why would this happen? i thought default global rejects was 1024 hey there I'm trying to run a bash shell script command with foundry cast but am getting invalid data associated to these lines of code (below)... The error is coming about when trying to use the array curvePoolCollaterals, am I going about using arrays incorrectly in .sh files? curvePoolCollaterals=(""$owner_frax_bp_balance"" ""$owner_eusd_balance""); ## Deploy funds into FRAXBP-EUSD pool cast send $fraxbp_eusd_address ""add_liquidity(uint256[2],uint256)(uint256)"" ${curvePoolCollaterals[@]} 0 --from $owner_address; actually nvm that, but I am getting this error: (code: 3, message: execution reverted, data: Some(String(""0x""))) and can't make sense of anything I find on stack overflow for it.",453
1148,foundry-support.txt,"The command to access the curve pool we are trying to test with seems to work but it still reverts here is the command that I am trying to work with to add liquidity to a curve metapool: cast send $fraxbp_eusd_address ""add_liquidity(uint256[2],uint256)(uint256)"" ""[$owner_frax_bp_balance,$owner_eusd_balance]"" 0 --from $owner_address; Any help is super appreciated 🙂 it's 65536 by default, more info here: https://github.com/foundry-rs/foundry/issues/1202 I'm guessing that sig doesn't exist, what's the contract address? curve has slightly different sigs across contracts which changes the selectors and can be tricky to catch I meant the local one which is the smaller of the two But glad this bug is known about Just says 253 runs which is smaller than both So doesnt make much sense local rejects is not used, as mentioned in that issue 😛 253 is number of succesful runs you could hit the max rejects before having any successful runs, i.e. rejects do not count as runs Aahhh Ok Do u have any recommendations for getting around this? you can wrap your inputs into a given range using the bound method from forge-std Hmm, the context of the problem is that we are deploying a hypothetical curve metapool using foundry and cast. So the contract is already successfully deployed according to other code within our script, but then this error is still being generated so we deployed this hypothetical metapool using curve's factory contract address on a local mainnet fork hmm still possible you aren’t specifying the sig right, but they’re other possibilities too.",349
1149,foundry-support.txt,"hard to debug without a repro/more code, but checking the tx trace to see where the revert is is a good next step is there a doc, or even a PR, that kind of explains at a high level how/where the foundry debugger is implemented? I assume it uses a trace emitted from revm? not sure if this is outdated / if there's a more recent version, but @brockelmore wrote up a good description in the original PR https://github.com/foundry-rs/foundry/pull/356 Any good resources besides the docs about foundry scripting? https://github.com/joshieDo/v3-core/blob/main/deploy/deploy.sol heres an example ty sir Yeah still not sure, the addresses line up in the trace: Code that is causing the error: cast send $fraxbp_eusd_address ""add_liquidity(uint256[2],uint256)(uint256)"" ""[$owner_frax_bp_balance,$owner_eusd_balance]"" 0 --from $owner_address; Trace: + cast send 0xDcEF968d416a41Cdac0ED8702fAC8128A64241A2 'approve(address,uint256)(bool)' 0xc22936D5ECE78C048D6E7fe5d9F77fb6cAA16Dbb 9992377595096892450088022 --from 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 + cast send 0xc22936D5ECE78C048D6E7fe5d9F77fb6cAA16Dbb 'add_liquidity(uint256[2],uint256)(uint256)' '[9992377595096892450088022,9992377595096892450088022]' 0 --from 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 Error: (code: 3, message: execution reverted, data: Some(String(""0x""))) These addresses line up as: 1. 0xDcEF968d416a41Cdac0ED8702fAC8128A64241A2 - deployed metapool we're adding liquidity too 2.",482
1150,foundry-support.txt,"0xc22936D5ECE78C048D6E7fe5d9F77fb6cAA16Dbb - user calling add_liquidity() Any thoughts are welcome, I understand this may be too specific though to be troubleshot here so I'm gonna try sleeping on it - might try asking curve discord too ty, this is very helpful. raises a question: what evm impl is used in foundry? is it sputnikvm as referred to here? for some reason I thought it was bluealloy/revm Hello! I'm in the process of trying to run anvil in kubernetes, and I plan to submit a PR to the project when I have it working. A required component is a working readinessProbe, which I'm having difficulty getting working. If I do a simple GET http://localhost:8545, it returns a 400 response. Is there a simple endpoint I can query to signal that anvil is up/serving traffic? I tried poking the code but rust/the codebase is quite unfamiliar. Something I can just HTTP GET would be best, allowing me to use the built-in readinessProbe.httpGet field. yea its now revm, it used to be sputnik must it be a GET? readinessProbe.exec -> json-rpc POST to syncing or blockNumber would be simple enough maybe even net_listening? (still a POST though) I'm willing to try that. What would that POST look like as a json payload? Oh I found this: https://www.quicknode.com/docs/ethereum/net_listening Will try that. Thank you! is there no way to estimate contract deployment gas costs via forge create, before submitting? I guess we could deploy to anvil forked from eth Can foundry list the changes in storage slots as the result of my transaction? not yet, being tracked here https://github.com/foundry-rs/foundry/issues/2846 when I try to run ""forge install Script"", I get ""Could not determine URL for dependency ""Script""!"" how do I install Script.sol forge-std/Script.sol Hi, read the docs but still struggling to understand log testing, any good examples? im trying to test a simple setter with this code but test fails with [FAIL.",467
1151,foundry-support.txt,"Reason: Log != expected log] testOnlySelfCanSetDelay() (gas: 16917) no idea what the bool args mean, or what should be the value i should pass my expectation from args interface, is the first bool checks the value emitted in topic is the same? probably im missing smth, contract is vyper btw in case that matters, altho in traces i see the event perfectly fine from vyper traces show both emits are exactly the same so not sure what am i missing you need to call expectEmit first, and then emit the log you expect thx, that was the error i was doing when i try to install Script.sol with ""forge install forge-std/Script.sol"" it prompts my github username pls read the docs - you forge install foundry-rs/forge-std And then import forge-std/Script.sol In your code anyone has seen this error before? Error: Compiler run failed error[6675]: TypeError: Member ""expectRevert"" not unique after argument-dependent lookup in contract Vm. --> foundry_test/Timelock.t.sol:133:9: | 133 | vm.expectRevert(""!eta""); | ^^^^^^^^^^^^^^^ if i use vm.expectRevert(""!admin""); it compiles fine, but assert fails since actual revert message string is ""!eta"" [FAIL. Reason: Error != expected error: '!eta' != '!admin'] try vm.expectRevert(bytes(""!eta"")); https://book.getfoundry.sh/cheatcodes/expect-revert these are the 3 ways you can use expectRevert Hey guys, getting an off-by-one error on nonces when forking mainnet that’s preventing me from simulating transactions. It’s giving me an Error: nonce too low but the transactions are I’m simulating are confirmed on mainnet. Has anyone encountered something similar? When I run ""forge install foundry-rs/forge-std --no-commit"" and there is an existing forge-std directory present, it doesn't overwrite it. Is there a way to overwrite the forge-std directory you can uninstall it by doing forge remove https://book.getfoundry.sh/projects/dependencies?highlight=remove#removing-dependencies If I run ""forge script mySmartContract.sol"", and the contract doesn't inherit from Script, it compiles then crashes It returns ""Compiler run successful The application panicked (crashed).",495
1152,foundry-support.txt,"Message: Function signature not found in the ABI Location: cli/src/cmd/forge/script/mod.rs:412 This is a bug. Consider reporting it at ... which version do you have? can you foundryup? if its what i think, newer versions shouldnt crash, but give out a proper error your contract probably doesn't have function run() and you didnt specify any on the command does anvil runs by default with cheatcodes ? ok, the newer version didn't crash. So I can't use forge script on any contract which doesnt impliment run does Forge ever hang when running tests? it started doing that for some reason 🧐 compiles fine and hangs right after... Hi, what is the syntax to pass a struct as argument when calling forge create? @gakonst this code works fine, while... read the docs: https://book.getfoundry.sh/reference/forge/forge-create?highlight=create#forge-create while this code will cause forge to hang after compilation wanted to use foundry scripting but my forge std dsnt have a scripting.sol file for some reason. Hello! I’m trying to use Anvil as a drop-in replacement to hardhat node/network. So instead of running our hardhat tests written in JS on hardhat’s own network, we’re running them on Anvil. We’re having trouble with that. The tests starts super fast, but then performance starts degrading. Eventually, the whole thing stalls and the tests fail because the requests begin to time out. Running the test cases separately, spawning a new Anvil for each new test case, seems to work. I don’t know where to begin heh. I’ve found a couple of issues on GitHub which may related, but it’s hard to tell. So I’m reporting it here first. Any suggestion on the next steps? is it possible to generate gas report for the contracts without writing test cases calling the contract functions ? Is there a way to reproduce and debug this? Would appreciate an issue with some context Could Zou please open an issue for this with the code snippet that’s causing problems? We solved it by removing a few storage pointers in the contract, it wasn't strictly related to that snippet alone turns out I can try to come up with a minimal, reproducible thing. If it helps, our tests do a lot of evm_mine and evm_advanceTime.",483
1153,foundry-support.txt,"could be related to how we keep history when mining a lot of blocks there's currently no --unlock option for cast send, right? only for forge create https://github.com/foundry-rs/foundry/pull/2368 some issues writing tests for payable function. If I run the function without payable - all works ok... I have a QuizFactory and Quiz contract. Then I call a method to create new quizzes ... as long as the method is not payble tests pass. When I add payable logic it error... I have dealt all the accounts some ether with vm.deal.. is it possible to run forge test with the actual gas that exist in a block i.e 30 million instead of this value ""9079256848778899373"" it only works when the sender is the same account that created the QuizFactory and Quiz. if I want to just vote, with a different user/prank, it gives me this error. // the other user also has ether... 🆘 what is my small brain missing as simple as that is the payable function: https://github.com/kristjank/advanced-consensys-academy/blob/02e594bb5a57c1e8651dafc164dab3b539753ee5/test/QuizFactory.t.sol#L57-L65 weird trying to call a function in test and send some msg.value   uint value_to_send = 1 ether;   c.mintTo{value:value_to_send}(address(0)); it seems to be reverting with an EVM error: OutOfFund, not quite sure what am i doing wrong did you call vm.prank to make the call with a funded address? not , wasnt sure it was needed i thought forge by default has balanced loaded. btw is it possible to set a gas limit on a specific tx, such that, that gas limit is reflected in the contract call, trying to give a specific tx a arbitary gas amount but it always gives 50k less than i specified How do you guys test internal / private fonctions ? I know you generally only wants to test your exposed API but I feel like unit testing private function, ensuring their good inner working is not that bad... The main problem though using foundry to write unit tests is since each private/internal methods needs its own specific ""setup"" I'm not sure how to actually write those tests.",489
1154,foundry-support.txt,"What I do for now is I write the ""setup"" part within each unit test but it's kind of messy since it's not supposed to be tested + the test gas report is taking into account the gas spent to setup the test. Any idea ? Thanks not sure. here are cheatcodes. https://book.getfoundry.sh/cheatcodes/ @gakonst the foundry <> python differential fuzz testing worked really well! Would be keen to write up docs on it if no one is doing it yet and u think it would be useful. Hi, I’m deploying a contract on arbitrum using forge script, it works on a local rpc, but on arb mainnet it returns this error: « Failed to estimate gas for tx: 0x… » Is there a fix for it? it typically means that the transaction reverted during gas estimation. If you feel confident that it will not in fact revert, then you can try specifying the gas limit manually Thanks, even after manually setting the gas-limit I get this error https://book.getfoundry.sh/forge/differential-ffi-testing?highlight=differential#differential-testing hehe Hello, how to convert a hardhat framework to the foundry? If you know, please send the link or any resource about it... please check the docs it’s there 🙂 Okay, thanks Sniped, might do one in more detail on a thread or sth, think this is super useful for quant related stuff. sgtm! would love to hello! is there a way to download the pre-defined dependencies in a project? Similar to how running ""npm i"" will install all the deps pre-defined inside package.json hi folks, is there a foundry method for deploying a contract based on raw EVM bytecode. e.g.",364
1155,foundry-support.txt,"using web3 would look like web3.eth.sendTransaction({ data: '0x69602a60005260206000f3600052600a6016f3' })? forge create seems to require path to solidity file, while cast send requires a to param You should be able to do this with cast Ctrl + f here thanks Samuel i think i see the github thread on this cast send --create Is the margin the imports / does it count to the actual size of the contract? Or is the margin just the unused space Just run ‘forge install’ margin is just sizeLimit - size size limit is 24.576 kb it's strange, when i use the normal method of testing to get tokens & to then stake or lock, if the staking contract or a rewards contracts checks balanceOf(myTestContract), it doesn't preserve the amount and instead checks back with the non-forked enviro. Like if you were to test locking crv & then later collecting rewards: - whale wallet transfer some crv to my test contract - test contract creates veCRV lock - roll forward in time - claim rewards => test contract has no balance of veCRV the only way I've found around this is to create a mock veCRV & use that in the testing environment, which usually means including mocked contracts that call it so that I can redirect them to my mock veCRV address & deal with the weird total supply challenges. I feel like I must be overlooking some way easier way to handle this...",308
1156,foundry-support.txt,"what is the tx.origin for vm.startBroadcast when you pass in an account? How is it different than vm.startPrank(account)? For example: vm.startPrank(deployer);  asset.approve(address(vault), type(uint256).max);   console.log(asset.allowance(address(deployer), address(vault)));  uint256 shares = vault.deposit(initialDepositAmount);  vm.stopPrank(); passes but if I change prank to broadcast vm.startBroadcast(deployer);  asset.approve(address(vault), type(uint256).max);   console.log(asset.allowance(address(deployer), address(vault)));  uint256 shares = vault.deposit(initialDepositAmount);  vm.stopBroadcast(); fails with ""SafeERC20: low-level call failed"" when transfering the asset for depositing into the vault using deal(token, to, amount, updateTrue) doesn't do the trick because it's not the ve-token, and you can't just deal the veToken since doing that fails with stdStorage find(stdStorage): Slot(s) not found. Hello foundry! When discord ? when? no discord plans You don't think than it more user-friendly than telegram? There’s 1 topic for the most part 🙂 and it’s easy for me & others to keep track vs discords with thousands of channels forge test —chain-id 4 -vvvv Running this to simply check ether balance & it’s not working on any chain , including when I omit ‘—chain-id’. Anything I’m missing? You need —rpc-url 🙂 should work same with eth_rpc_url in foundry.toml?? https://book.getfoundry.sh/reference/config 🤝 hi I have a simple question during test, will the block.timestamp increase with the transactions? like start from 1, after 1 tx it would be 2? where is the file output for the flag --extra-output-files no but you can change it with vm.warp thx got it if I want a script to output storage output do I run ""forge script <fileName>:<contractName> --extra-output storageLayout --extra-output-files metadata"" Hey I’m looking to test a function that refunds the gas spent, but currently foundry’s test doesn’t deduct the gas fee from the caller, is that correct? Nvm, thinking about it gas would only be deducted after the transaction is done, which is when the test is done..",494
1157,foundry-support.txt,"Is there another way to access immutable variables in inline assembly besides first putting them in the stack in plain Solidity? https://book.getfoundry.sh/ down? is there a way to display all logs (-vvvvv) but not those from cheatcodes? No Do you have so many cheatcodes that it's cluttering ? ahah kind of 😊 i have a lot of logs because my tests are a bit long and it would be cleaner if i could take out the cheatcodes, so i can go over it quicker If it's not implemented. Let me know if that could be a feature interesting to anyone else, I could implement it and open a PR for it. If the team is ok with it is it possible to use cast send and the debugger? Hi , I'm getting the same issue , with forge bind . you didn't explain how you were able to fix it, I have the latest version of foundry and ether-rs It seems to be a bug in the latest version of foundry. I went back to a previous nightly build from a few days before (Using foundryup with a specific commit) and was able to generate the bindings thanks tbh seems pretty interesting to me. I have very long logs that fill the entire terminal due to cheatcodes processing files (parseJson and writeFile). Would be cool to have some filter on those or cutoff for data being passed. which commit did you use ? Hi, I am dealing with a small issue when using forge test --gas-reports The tests are displayed slowly in comparison with the forge test -vvv. Been using foundry for months and it's the first time when I am dealing with this. could anyone help me with the build version that can satisfy, trying commit from month (july now) and I still have the issue of parsing metadata > and I still have the issue of parsing metadata can you open an issue and provide some additional context please nvm found the issue forge bind issue fixed here https://github.com/foundry-rs/foundry/pull/2964 +1 on this. It was happening to me last night I have a hard time for hardhat to detect the artifacts produced by the foundry-hardhat plugin Any special configuration value I should use to produce compatible artifacts? apart from that, the plugin is truly drop-in replace.",475
1158,foundry-support.txt,"Thanks @tyneslol ❤️ @odyslam do your hardhat tests run when using the plugin? Oh maybe there was a regression. Will investigate Was this vm.readJson idea added? Trying to figure out if I can import some values into a script. One sec https://github.com/Timidan/Foundry-Hardhat-Diamonds/blob/3000fca83a25a789a0683bd935d665114deb7e69/scripts/genSelectors.js#L13 This should help You can currently already use ffi with jq, somewhat cumbersome though. https://github.com/foundry-rs/foundry/pull/2293 also looks to be merged. FYI https://github.com/foundry-rs/foundry/pull/2903 this is the PR that caused this performance regression on gas reports. We’re on it 🙂 Glad to hear that so if I can't use the -vvvv flag when I run a script on Rinkeby? Quick question on cast. Trying to call a function that returns a struct mapping how do I do that with cast call? Keep getting reverted data: some(string(""0x"").. Assuming im doing the wrong call command Hi everyone. I got into foundry today because I'm working on a repo that uses it. I need to debug a test but I get an error when trying to attach a debugger. No matches on Google or Github issues. I can run the function I want to debug alone successfully with forge test --match-contract ContractTest --match-test myFunc trying to replace match-test with debug forge test --match-contract ContractTest --debug myFunc causes the error Error: contract source info format must be <path>:<contractname> or <contractname> Just wanting to make sure I don't make a rookie mistake here, does anyone have a clue what could resolve my issue? To reproduce you can also try debugging this function https://github.com/nomad-xyz/monorepo/blob/main/packages/contracts-bridge/contracts/test/BridgeMessage.t.sol#L90 Im trying to deploy using scripts, I have my RPC endpoint in an env file. whenever I try to run the script file I get the same error: -fork-url <URL>' requires a value but none was supplied foundry. I'm passing in the RPC url using --rpc-url $RPC_URL.",485
1159,foundry-support.txt,"If I try to change it with --fork-url I get a similar error saying I passed in too many values. Does anyone know off the top of their head what this might be? banyan, if you're trying to run a forked mainnet, are you sure your RPC URL points to an archive node or a service that supports one? I ran into this error earlier this week because my RPC URL wasn't valid for forking mainnets Im using quicknode for Kovan...How would I tell? Maybe a better question is how did you fix your problem? I'm sorry im so antsy I just want to deploy, I can smell the immutability haha i think you need a paid plan for QuikNode archive nodes — are you paying for their service? nope i used Infura for archive nodes and my problem was fixed. Although since I'm not understanding the full context of your error, i may be mischaracterizing your situation. I think you might be passing in more params than needed via your env file? Try running the command first on the command line without an env variable. Then I would recommend using the env variable once you've figured out the format in which to place the forked URL yeah that's probably it (again, assuming you're using this for running a forked mainnet) Thank you i've tried that but I run into txn revert errors before my script does anything, I guess it's better to revert then error out I suppose.. but I learned more about what the forking keyword means, so that's good thanks ofc — I gotchu 🔥 when calling a contract function with cast, error with some(string(""0x"")) generally is wrong function signature ? So it seems my contract is reverting upon triggering the contract address for scripting. I get this: new <Unknown>@""0xb4c7…7e84"" and then it reverts.... I'm p sure the address is the foundry script address... damn gas is like 6 gwei Iirc the —debug option didnt work with —match-contract. Did you try the format that the error specified? Hey, I want to deploy a contract using Metamask. How could I do that in Foundry? You can export the private key of the Metamask account you want to use in Foundry, then use that inside your foundry scripts.",485
1160,foundry-support.txt,"Alternatively, you can run an anvil fork on localhost, and connect metamask to the local fork by changing the RPC. Umm no, we have a contract which we want users to be able to deploy by using their Metamask on the Mainnet Like we take some inputs from the user and create contracts for them and complie using forge build but I can't figure out how could the user deploy the contract themselves In that case you might need a deployer contract, or contract factory, deployed on chain. The user can then just call the deployer to create a new instance of a contract. I don't think you need forge build here unless I'm missing smth Can we use signers in etherjs for foundry projects? I think you can connect a hardhat instance to foundry but I haven't used it. I've been able to fully move a Typescript development environment from Hardhat to Foundry with no issues, I suspect you might be able to achieve what you want without using Javascript, might be worth taking another look at the foundry book. You can unlock accounts by passing --private-key to cast and forge script. You can spoof accounts in tests using vm.prank(accountAddress) You can broadcast transactions as an unlocked account (similar to ethers signers) using vm.broadcast(accountAddress) If it's just about this, you might want to create a contract factory that users can just call with certain parameters and which will then create the contract for them. Or if you don't want to do that, you can use ethers ContractFactory. If you want them to actually change code and compile, I guess you'll need a backend for that or compile via js How to compile a project that has deps that have their own remappings without duping them in our projects remappings? remappings are managed and used by the framework. are you using 2 frameworks at the same time? How are you installing deps? Look into flattening. Though you should remap as needed. hi.every knows how to set my own test account address to testing? wdym? vm.prank(whateverAddressYouWanttoTesting) maybe https://book.getfoundry.sh/cheatcodes/start-prank https://book.getfoundry.sh/cheatcodes/prank i try to set sender in config but looks not correct.",473
1161,foundry-support.txt,"thanks.let me check now Is there any way to skip setUp() for a specific testFunction()? I want to vm.createSelectFork() but not for all tests. I also have to re-do most of setup after fork. (chicken-egg problem) ...guess I'll just do a new file. I don't think that it's possible. It's like skipping beforeAll for a specific test js reference noted. True. A vm.skip('function()') would be cool. the way I would go about it is that I have a common TestContractBase with a setup() that is 'virtual' and if you really need to override it in TestContractXYZ add the setUp() with 'override' don't think a cheatcode is necessary here yeaa. still separate contract/file. no duplicate code though. I did try providing the path/contract in a few different ways but it didn't make a difference idk, just tested locally in my current repo and it seems to work the way you described. Are you up to date (i.e. foundryup)? What are you exactly passing in? I'm on 0.2.0 (fresh install yesterday). and mostly referring to the documentation here https://book.getfoundry.sh/forge/debugger so I ether use match-path or match-contract to specify which contract im working with. What's strange is that both debug and match-test use regex to identify the function, so if I can run a single function using match-test I thought I should be able to with debug as well does it also work for you in the repo/test I linked above? 🫤 nope. Same issue. I think it might be due to the contracts not being located in src? Perhaps the debugger doesn't know where to look then might be what address should i use for spender when i am use forge test? Uhh whichever smart contract or EOA you want to check the allowance of to spend funds on behalf of the owner? i get error Reason: BEP20: transfer amount exceeds balance, so had try to give some allowance. https://eips.ethereum.org/EIPS/eip-20 should have everything you need to understand the issue. ☺️ thank you Hey guys, can anybody help me by telling how can I specify mutiple solc-versions for a project ? I tried providing array of versions in toml file then forge-script crashed.",492
1162,foundry-support.txt,"How to access the address of deployer in forge tests? 0xb4c79daB8f259C7Aee6E5b2Aa729821864227e84, it's mentioned here https://book.getfoundry.sh/forge/writing-tests is there a discord channel? Can I use link tokens on anvil? Hi guys, we have setup a series of challenges for Stanford defi security summit; https://github.com/eugenioclrc/DeFi-Security-Summit-Stanford/tree/foundry i just can deposit weth, can not deposit other token in test contract, anyone knows why? I think you should check your IERC20 token interface , some ERC20 tokens are designed differently and the standard proposed by Oz can revert . interface IERC20 { function approve(address spender, uint256 amount) external; function transferFrom(address from, address to, uint256 value) external; function balanceOf(address account) external view returns (uint256); } i see. so how can i get some testing tokens when i use foundry? what do you mean by testing token ? depends on how you test ? do you test on a fork network , or do you want to deploy your own tokens ? https://book.getfoundry.sh/ take a look and check the cheat code if you want to prank some addresses is there a way to reset or remove a remapping in forge ? I tried defining a remapping.txt but still cant seem to get unwanted remppings to be removed we could add a setting to opt out of remapping auto detection easily, mind opening an issue for this? Does Foundry support Upgradable Contract deploys like Hardhat? https://github.com/OpenZeppelin/openzeppelin-upgrades/tree/master/packages/plugin-hardhat/ same question here! where's the doc of testing a deployed contract ? 😃 So I'm using a local Anvil server to run a bunch of tests, but sometimes the server just stops responding and hangs.",407
1163,foundry-support.txt,"Has anyone encountered this before? What could be causing this? Is it worth using another fork provider like hardhat? hard to say without some additional context, would appreciate an issue, ideally with a way to repro or context when this happens (what requests, how long the server is running, etc...) Ok, I've got a much smaller version of the problem upon sending {  ""jsonrpc"": ""2.0"",  ""id"": ""0"",  ""method"": ""anvil_reset"",  ""params"": [   {    ""forking"": {     ""jsonRpcUrl"": ""http://eth-mainnet.alchemyapi.io/v2/api_key"",     ""blockNumber"": 15181720    }   }  ] } to my anvil server, I get back the response {  ""jsonrpc"": ""2.0"",  ""id"": null,  ""error"": {   ""code"": -32600,   ""message"": ""Invalid request""  } } is multi fork for cross-chain testing documented anywhere? is there a way to get calldata with which an address was called? record calldata, sender, etc.? Hey so Ive had the same error for several days now. when I try to follow the scripting tutorial on my project. https://book.getfoundry.sh/tutorials/solidity-scripting I get Error: The argument '--fork-url <URL>' requires a value but none was supplied I'm not trying to fork mainnet, I'm trying to deploy to Kovan for testing. I have tried both quicknodes and infura and get the same error. If I add an fork value as the error suggests I do, I get an error saying I have too many fork values..... Under what conditions does Foundry decide you are trying to fork the state? Does anyone have any ideas? can there multichain scripts? Gm Foundry can make test for rust contracts? It’s an alias for —rpc-url.",401
1164,foundry-support.txt,"Are you following the tut, but forgot to set up the .env? You don’t have rust contracts you have solidity / vyper / Yul / huff contracts so no is it normal that I""m getting Error: 0: Discovered incompatible solidity versions in following even tho I have auto_detect_solc = true shouldn't it just be able to resolve the different versions? is there a guide on how to release a package to forge? I see there you can use forge install for a few already no need to release a package for forge specifically, forge can directly install dependencies from various sources including github https://book.getfoundry.sh/reference/forge/forge-install?highlight=forge%20install#forge-install oh perfect thanks a lot! Hi guys, do we have any additional documentation regarding solidity scripting in solidity ? I need to run UniswapV2Router in my tests... how do I do that without getting this versioning error have you checked out the relevant part of the book? https://book.getfoundry.sh/tutorials/solidity-scripting Yeah I did. But I wanted to know if we can do anymore things with vm does anyone else feel like console.logging has gotten very slow compared to before? Has it? How so? Are you on latest? ok, actually printing my env revealed that I had RPC_URL set somewhere, and my internet's been super slow.. thinking that might be the culprit but it's odd that it first runs (shows a fail) and then gets stuck on the logs yeap, that was it > <"" but is there a reason why logs specifically take so long on forked rpcs? If I add a bunch of logs it takes ages because it’s trying to decode them via etherscan/4byte directory i think? cc @joshiedo Which version do you have ? It shouldn't have the same problem anymore That's why I didn't add it to forge test in the beginning...we can always revert it and keep it to forge script only But since many people were asking...",415
1165,foundry-support.txt,"But this seems something different Hello there! Do you know if there is a way using forge script to have more step inside the —vvvv logs? For example here, I get the emit result but don’t get the other call inside the transfer function I got multiples call inside the transfer function but only one is displayed on the script output logs any idea how to print them all? Hi there, I am new to Foundry and I have a noob question. How do you guys test event emitted in the constructor? Can I call constructor with some kind of cheat code or something? So it might be due to the function selector fetching? Can't really test anymore, because internet speed is back up. I'll keep on monitoring it Oooh slow internet, ok I didn't read that far back, yeah that might be it Are they external or internal calls? Hi Kamil, Just tried your use case, you just have to herit from Test and add a cheatcode inside the constructor of the new contract there are internal calls. Thanks for the help! I guess my use case is slightly different. I am already emitting an event in the contract constructor. And what I am trying to do is to check if it is emitting correctly inside the testing Contract. Oh sorry ahah, see your point but never tried… Thanks anyway! Hi everyone! I'm trying to run foundry on Windows 11, but I am getting this error for whatever command started with 'forge': Error: cannot install provided ErrorHook, a hook has already been installed Location: cli\src\handler.rs:62:9 I tried to look into handler.rs and forge.rs but I'm kinda not sure what to do Could you please open an issue for this, this is probably some misconfig on windows Internal calls don't show up on traces sure 👍🏼 I have an .env file, im on windows. So I cant run the source .env command in the tut. It seems my scripts may not be communicating with my .env file.......do I need to do a remapping or something? try to close and restart your terminal on linux you would do source .env On windows you can just do set VARIABLE=VALUE in a batch script.",453
1166,foundry-support.txt,"is it perhaps unset in the .env? Can you delete the .env to be sure and make sure it's not set to something invalid in your environment Ok will try all this thank you gm sers wats best way to report bug in forge verify-contract I have repo with single contract and single deploy script. should I just open issue with that repo linked? ya can --via-ir fuck up the verification? https://github.com/foundry-rs/foundry/issues/2996 🫡 how do I get the current wallet address in a foundry test? I'm pretty sure msg.sender is the test contract itself - am I missing a cheatcode? https://t.me/foundry_support/22119 heyo everyone, any way to speedup compilation when using viaIR? hmmm I don't see that addressed there. more context: I'm trying to figure out who the owner of my contracts is BEFORE I call vm.startPrank Assuming you never ran vm.prank, the owner of your contract is 0xb4c79daB8f259C7Aee6E5b2Aa729821864227e84. If not, you can always just console.log and call the owner() function ohhhh. why? referring to https://github.com/foundry-rs/foundry/issues/432, i don’t understand the context of “switching over to Revm” - is this ongoing? will we expect to be able to mock internal library fxns soon? hey there o/ Thx! I should have been more explicit, I meant to produce hardhat compatible artifacts. Basically trying to use forge to build the artifacts in place of hh and then pass the artifacts to the rest of the hh plugins (typechain, packager). Currently Hardhat can’t find the artifacts that are produced by foundry via the foundry-hardhat plugin. We got the core cheatcode merged + hotfixes and now working on the helper functions in forge-std I think today/tomorrow should be merged as well and will make sure to ship some docs this week as well. I think it’s the best UX we could have, given solidity’s restrictions It took a while to nail down the ergonomics.",461
1167,foundry-support.txt,"writeJson is next in line and by the looks of it, it’s more complex and with weirder ergonomics, again thanks to Solidity Is there any obvious way to troubleshoot an EvmError: Revert? I ran foundryup and now I'm getting them for lots of tests that previously worked without issue. try deleting cache Didn't work. But I think I found the issue. When using an Alchemy rpc, it returns 0. When using infura, it can't locate the env variable (My .env is in the root directory with foundry.toml and I haven't moved it where it worked previously) I figured out the issue. Before I was deploying contracts before creating forks, but now that no longer works (because forks now have isolated memory?) and I just need to move the fork creation to the top of the setUp aha, yeah it I also got random RPC errors that bubbled up as reverts usually after a few runs it will do the trick or find better RPC endpoints Yeah, now every fork has it’s own state and you have to explicitly state which objects can persist e.g a contract, an address, etc. this will be nicer pretty soon because we'll bake rpc error handling directly into it there’s also a makePersistent cheat that makes your contract available on all forks can any wizard help me decypher this your probably importing the interface from two different places with not 100% matching interfaces (at least for me that was always the case) Hi there, I'm having issues with getting an input param to work while adding liquidity to a metapool (FraxBP curve metapool) I tried the following: uint256[2] memory metaLiquidity = new uint256[](2);   metaLiquidity[0] = 0;   metaLiquidity[1] = five_m_d6;   fraxBP.add_liquidity(metaLiquidity,0); And an error comes up for the first line of code above: error[9574]: TypeError: Type uint256[] memory is not implicitly convertible to expected type uint256[2] memory.",438
1168,foundry-support.txt,"--> test/CurveTWAPOracle.t.sol:48:9: | 48 |   uint256[2] memory metaLiquidity = new uint256[](2); I've been asking around and troubleshooting this for 1-2 hours, so any help would be appreciated 😄 I'm running this in my foundry tests against a curve metapool in our unit testing enviro using anvil and foundry interesting, ty ser try this? uint256[] memory metaLiquidity = new uint256[](2); Tnx so, interestingly I am stuck with forge not producing ast for all artifacts. Not sure of why, but some artifacts (like DSTest), doesn’t have an ast which is required by hardhat. the ast field is required by foundry-rs/hardhat to convert the foundry artfacts to HH-compatible is there a way to simulate a tx using cast send ? @mattsse any idea on why forge build will populate the ast on some contracts ? Perhaps we should filter out these contracts at the hardhat plugin level? wdym? in the artifacts directory, some artifacts don’t have the ast field I think it’s dependencies and test contracts (e.g DSTest), but they do find their way into the artifacts directory so forge-hardhat parses them and errors Hi All, im working with an UUPS contract and want to get the state layout prior to upgrade is there a way to do this? get it in what form? looking for storage layout are external cheatcodes supposed to work in scripts? i'm writing a deployment script and want to import RPC_URL from an external env file. that should be possible, right? yup You guys have any idea why cant i properly test erc20 functions, if you have any example repos that would work too Thanks Shaper.",371
1169,foundry-support.txt,"This is the format that worked:   uint256[] memory metaLiquidity = new uint256[](2);     metaLiquidity[0] = one_m_d18; // frax   metaLiquidity[1] = one_m_d6; // usdc   fraxBP.add_liquidity(metaLiquidity, minLPOut); I'm getting some weird generic revert now though, working between curve vyper contracts and solidity test files with foundry has me feeling a certain way lol I'm so happy! Foundry debugger is working with the last update!!! Sick! What was the issue before? I don't know, it was throwing some rust error, I'm using a MacBook with the new chipset Quick question: I'm trying to workin with curve metapools within a local mainnet fork using foundry and am getting a generic error [FAIL. Reason: Setup failed: EvmError: Revert] - it got me thinking... does Foundry require certain configuration in order to work with vyper contracts, even in this scenario where I am testing with an already deployed vyper contract on mainnet of which I am copying the network (mainnet)? In theory, whether I write my code in solidity, vyper, whatever it doesn't matter, it's just bytecode talking with one another in the EVM in my scenario right? Trying to link a library, compiled and deployed on anvil previously, like said here (https://book.getfoundry.sh/reference/forge/forge-create#linker-options), with the library linked in foundry.toml. Am I doing something wrong ? Hey guys sorry to writing about it again but any suggestions? is it normal for a script that deploys multiple contracts + transactions to get stuck for a weirdly long amount of time? this is on goerli it's been like this for 2+ minutes now.",387
1170,foundry-support.txt,"nothing showing as pending on etherscan either Hello there, Could we use verify flag on others blockchain when deploying contract like ropsten or goerli? Only the EtherScan API key but how could we choose a testnet for example? on hardhat seems to be simple like that it works for testnets too at least for rinkeby and goerli for me You right! I didn’t know how to deploy on testnet but actually exact same syntax! Thx!! for the life of me I can't update the number of fuzz runs when testing locally. someone please help Is there any reason why the value logged in something like the following would be incorrect (lower than it should be)? it seems to think my most-significant-bit implementation costs 27 gas (lol) fuzz config is moved to a [fuzz] section, more info here https://github.com/foundry-rs/foundry/issues/2972#issuecomment-1229157851 @rkrasiuk do the new [fuzz] sections of the config support profiles with e.g. [fuzz.myProfileName]? or do we no longer have a way to change fuzz runs by profile? 😅 man i just can't keep up w the speed of development!! (neither can the Foundry book lol!) i know we're not the only ones that like to fuzz differently depending on the profile, Maple and Solmate come to mind yea ultimately I want a way to specify different fuzz/invariant configs both at the profile level (such as default and ci) but then also at the file/contract/test level. so for example the default profile could have a lite mode that does 100 runs and heavy mode that does 500 runs, and ci profile has lite mode do 1k runs and heavy do 5k just need to think of a good UX to do that in the config file, suggestions welcome what are some options file/contract level? I guess you could have an array in the foundry.toml file. are we opposed to config settings in comments? i think i remmber brock is not a fan of that.",435
1171,foundry-support.txt,"could we then have some kind of ""cheatcode"" like vm.config(fuzz_runs=1000) ? 🤔 the issue with comments is it only works for versions of solc that support`/// @custom:whatever` type natspec so they show up in the solc devdoc output (0.8.2 iirc), and the issue with cheatcodes is that you need to preprocess the test files because fuzz config is defined before execution i.e. if we can find a good UX to specify in the toml, thats the easiest to implement I think something like[fuzz.profile.subProfile] then have another section that behaves like the match* flags to match files/tests to subProfiles would work good test prefixes makes the targeting much easier, e.g. testFuzzL0_* or invariantL3_* where L0 maybe light and L3 is heavy or whatever Is there per-line gas costs yet frens? no ser. a recent relevant thread about this https://twitter.com/fubuloubu/status/1563283491412148224?s=20&t=VCNeo_6h_M45f4wpnqWp9Q Ah saw this early on but didn’t see the conclusion. Thanks 🙏 Are you deploying them on foundry fork? sounds like an issue on the compiler side, i assume you are using the vyperDeployer, works fine for us in vyper 0.3.6 in this example repo https://github.com/yearn/serpentor Anyone able to use vm.setEnv() inside a Script? are there any permissions, flags or some sort of directory change that I must make to be able to use it? getAddress works fine Hey folks. Love foundry, but had some questions about deploying contracts currently deploying a Lib that imports another, aleady deployed lib.",376
1172,foundry-support.txt,"I think im follwing the docs correctly about how to pass in the deployed lib via libraries parameter in the CLI but im getting invalid type: string ""0x610858ec92822fcc78d0ef51e3434e5f4968ae66"", expected a map at line 1 column 3787 Full command is forge create contracts/utils/SpigotLib.sol:SpigotLib --rpc-url $GORLI_ETH_RPC --private-key $GORLI_ETH_PRIVATE_KEY --libraries contracts/utils/LineLib.sol:LineLib:0x610858ec92822FCC78d0EF51e3434E5F4968ae66 --verify --etherscan-api-key $GORLII_ETHERSCAN_API_KEY gm, i’ll take a look today, make sure it works. good point on the book, gotta update it as well anyone have any tips on how to pass in libraries when deploying a contract? just wrote a test to be sure - they do, sir, in the format [profile.<name>.fuzz] ok awesome, thank you. cc @devtooligan @transmissions11 oh great :D ty @rkrasiuk & @msolomon4 Oh... Ok How to catch an EvmError in forge test, e.g. catch an ""EvmError: OutOfGas"" hey guys! i have two separate folders for testing. one for arbi fork and the other for op fork. is there an easy way to exclude a folder for testing using just flags. when i tried --match-path or --no-match-path, i had to provide the test filename as well to include or exclude. hey guys, is it possible to capture the value from an event ? Hello, is there any cheatcode to pause the execution of a script : for example vm.sleep(time) or vm.pause(time) 😎🤟🤓 Hay 🔥🌟🤓 Сonnect to boost vpn now 🤓😎🤓 https://t.me/kzchnmxdgm960_bot?start=473711 forge test: EOF while parsing a value at line 1 column 0 ...",445
1173,foundry-support.txt,"Compiles fine @transmissions11 @gakonst I opened issue here: https://github.com/foundry-rs/foundry/issues/3016 anybody having issues with cast send on rinkeby rn or is it a problem local to me? oh nevermind, the transaction goes through but returns no tx receipt in CLI it just hangs on the command Can I test with excluding some lines for gas usage? I can’t use them in setUp as I need to load a memory array, since converting it also costs gas No but you can log the gas usage yourself, in solidity it's gasleft() and just calculate the delta might just be an issue with rinkeby nodes, I believe I had this as well Thanks! forge install smartcontractkit/chainlink and then forge remappings > remappings.txt gives me the remapping chainlink/=lib/chainlink/contracts/src/v0.8/dev/vendor/@arbitrum/nitro-contracts/src/ for some reason, which isn't right not sure if a foundry issue or if it's related to chainlink I updated the issue here: https://github.com/foundry-rs/foundry/issues/3016#issuecomment-1231592044 Found this old discussion with the same underlying problem: https://github.com/foundry-rs/foundry/issues/209 i noticed a lot of live foundry repos do not have a lib folder with the dependencies. is there a new convention for this Might be sketchy but is there a way to change the bytes in the memory where the code is stored?.",324
1174,foundry-support.txt,"I know it's supposed to be immutable and can only be read w CODESIZE/CODECOPY etc but since it's basicly simply in local memory whilst testing I could imagine there be a way to directly change the bytes of the program probably unsafe toh :s Unless there is another way to change an immutable var w cheat codes please enlighten me 😄 is there a way to test the storage layout? I can't verify contracts on mumbai when I use --optimize --optimizer-runs 1000 anyone got the same problem? u can change the mappings manually u know yep, just thought it was weird if you can read rust fluently, u can see the code for that forge remappings to figure out how it determines the mappings gm, I'm getting an error when running forge test, with linked library (it seems to happen only on Ubuntu) Error: invalid type: string ""0x..."", expected a map at line 1 column 355 Any idea? Thanks! it seems have been reported here: https://github.com/foundry-rs/foundry/issues/3012 I could comment with steps to reproduce eventually rpc-url is set to goerli testnet ( from infura ) forge script verification seems broken? --verify has no effect since I did foundryup maybe #2940 ? (looks like a recent commit that touches —verify) Hey folks i have this view call with a revert message. Im expecting the revert message but for some reason the test still fails. It did work on other view calls with require statements but for some reason not on this one could you please on an issue for this, ideally with the command you're running yes just posted a comment with steps to reproduce @mattsse Now it gets trickier to add other classes to my main contract that inherits the MyEvents.",370
1175,foundry-support.txt,"contract B is MyEvents, OwnableUpgradeable is rejected since it wants B to be abstract now hmm The pattern you descirbe is exactly what we use (MyEvents abstract contract imported by main contract as well as core testing contract) Not sure why you're getting ""rejected since it wants B to be abstract"" Maybe u can dig a little deeper on that Seems to be because of UUPSUpgradeable in the mix is ReentrancyGuardUpgradeable, OwnableUpgradeable, MyEvents { works fine what's the most robust way to do an apples-to-apples gas comparison of two functions? The gas reported by forge test includes the overhead of the test function itself, so it's affected by selector branching (changing the name of the test function changes the gas cost) BTW this is definitely doable in Solidity 🙂 Same way we instrument for code coverage, we’d also apply per-opcode step gas costs, map it back to the source, and output the info in a way that e.g. VSCode (or e.g. something like solidity-lsp can nicely render inline) does the forge script --verify-contract work with mumbai? should there's a pending PR that should fix a current bug with script+verify https://github.com/foundry-rs/foundry/pull/3022 so what r ur thoughts on having a discord for foundry-zing ? no discord 🙂 2 telegram rooms that are busy / consolidated better imo very well then , less scammers on TG anyway 😁 I think forge test --gas-report should give precise results, though correct me if I'm wrong I believe —gas-report is for contract calls, so the gas numbers include the CALL overhead how can I get a struct as a response from a cast call? if I need a contract state variable that i a struct is* did you find out about this? I haven't gotten an answer yet but I found something that might be helpful https://github.com/odyslam/foundry-upgrades we were looking at that and one of the guys was thinking it might not have actually done what exactly what intended -- can't remember what exactly it was but will try to figure it out In theory, you should be able to deploy the proxy and the implementation and run the specs. This repo has some util helpers that seem to do that.",477
1176,foundry-support.txt,"https://github.com/odyslam/foundry-upgrades/blob/main/src/test/ProxyTester.t.sol#L36 But it all depends on what you're trying to test. i noticed revert strings are showing up in the most recent version as “EVM ERROR : REVERTED”, is this expected? if so is there way a to make it more verbose hmm this shouldn’t be the case, if it is, it’s a bug. can you confirm via a simple test of require(false, “test revert”);. otherwise you have some other revert not via a require statement ty, i was wrong. How can I show log from console.log() statement in testx function? “-vvvvv” doesn’t work after a recent patch. is the test passing? what’s the output of just -vv, does it not show? I figured it out, I accidentally added unwanted argument in the testx(uint x) function.. sorry Are there any repos that people know of that have used solidity scripts to deploy to public networks some UUPS contracts? Just wanting to take a look to learn. I see the odyslam/foundry-upgrades one, but I'm not sure how that translates to real deployment? Hmm well I tried a script where I deployed a UUPS & when I went to the address on test net, it doesn't recognize it as a proxy, & when I click ""more options"" and try to get it to register as a proxy, it says it isn't one... Shouldn't a contract that *is* UUPSUpgradeable deploy as a proxy when I say MyContract contract = new MyContract();` in the script? forge build [⠊] Compiling... [⠰] installing solc version ""0.8.16"" [⠔] Failed to install solc 0.8.16: request or response body error: operation timed out Error: request or response body error: operation timed out Context: - operation timed out Facing this error - tried switching networks.",418
1177,foundry-support.txt,"Also instslled z3 and libusb on M1 mac Please try to foundryup Good Day All, I am trying to Foundryup -b master but gets this error error: failed to run custom build command for svm-rs-builds v0.1.8 Caused by: process didn't exit successfully: /home/ubuntu/.foundry/foundry-rs/foundry/target/release/build/svm-rs-builds-9fbb8ed37229b4b8/build-script-build (exit status: 101) Managed, it was connection issue. Regards UUPSUpgradeable is used for the logic contract, not the proxy. For the proxy, you probably want to use ERC1967Proxy here is something similar that includes a ""tutorial"" part. https://github.com/0xPhaze/upgrade-scripts yy, that was a first iteration to try out the ergonomics.",187
1178,foundry-support.txt,"I will be tackling upgrade contracts near term, so I was eyeing to rework the package Any feedback or ideas on the ux would be more than welcome 🙂 btw, I just encountered the following error without the improved error message: https://github.com/foundry-rs/foundry/issues/2158 annyone pre computed a deployment address in ther foundry tests? tried this vm.startPrank(governance, governance); address deployedAddress = address( uint160( uint256( keccak256( abi.encodePacked( bytes1(0xd6), bytes1(0x94), address(governance), bytes1(uint8(vm.getNonce(address(governance)) + 1)) ) ) ) ) ); following discussions herer https://ethereum.stackexchange.com/questions/760/how-is-the-address-of-an-ethereum-contract-computed but this doesnt compute the actual address to which my factory contract deploys another contract to anyone came across this before? this can happen if github/binaries.solidity has problems serving the bin will improve the error message here could you perhaps have a look at the existing checks, whether they work as expected for your context? https://github.com/foundry-rs/foundry/pull/2164/files Hey Sers, i wanted to know what's the best way to fork polygon mainnet on anvil, what's the network id when using metamask/anvil/polygonfork? hi,every one, how to connect a mainnet address to test in forge command? you can search network id by each network. Hey guys had a quick question. What is the proper syntax to pass an array of addresses as a command line arg when deploying a contract with forge create --rpc-url <your_rpc_url> \  --constructor-args <address[]> anvil -f <url> network id is string(chainId) which will be the forked network's chainid if not specified via --chain-id <id> you can set id in config file too I see a couple of people having this issue but can’t see obvious solutions. I’m attempting to fork mainnet in a test but seem to just always receive ‘invalid data’ when it tries. I can do it fine from CLI/within Rust though.",461
1179,foundry-support.txt,"What am I doing wrong? this is likely an issue related to abi-(de|en)coding, would appreciate an issue with additional context for this, ideally with a repro Much as I would have told someone else to do before bothering to post a message I made sure everything was actually up to date and seems it was fixed already 😅 does fuzzing support arrays? say i want an array of 5 random addresses and another array of 5 random amounts is that supported? hmm apparently it does, https://github.com/ProjectOpenSea/seaport/blob/dfce06d02413636f324f73352b54a4497d63c310/test/foundry/FullfillAvailableOrder.t.sol#L75 i see it seaport, will test this Hey there, I have a noob question, just installed foundry on windows using rustup, I don't know much about rust, but when using forge just after install I got a hook error would someone know what's going on ? I see I'm not alone Rafael did you manage to get it working ? I posted an issue Oh this is new. Are you also on wsl? nope just regular windows Hello, my deployment on a Ganache node with the command ""forge script"" using the option ""--legacy"" fails with the error message: (code: -32003, message: transaction underpriced, data: None) I have tried various values of ""gas-price"", ""gas-limit"", etc, with no change. The particularity of my contract is that it contains a lot of libraries, but I manage to deploy it without any problem on the anvil network or another personal Ganache instance. Hey Benjamin! Not rly =\ Didnt actually take the time to figure it out tho, Im pretty confortable with javascript not rust to figure this out tbh so foundry was not my first option, but feel strong about cheatcodes being a game changer wow, this is pretty sick. and the safety checks component looks really powerful! What’s up guys? I’m trying to write a Dockerfile that launches a chain with anvil and subsequently runs a deploy script with forge. But I’m having trouble doing this as anvil doesn’t run in detached mode and blocks the forge script command. Has anyone achieved a similar setup? I did.",476
1180,foundry-support.txt,"not sure if it's the best approach, but has been working for me: dev-node: #!/bin/bash sleep 1 && just dev-deploy & just node node: #!/bin/bash source .env anvil --mnemonic ""$DEV_ETH_MNEMONIC"" --block-time 5 (this is from a Justfile) should have included this part as well: dev-deploy: #!/bin/bash source .env forge script script/anvil.s.sol \  --rpc-url {{anvil_url}} \  --private-key $DEV_ETH_PRIVATE_KEY \  --sender $DEV_ETH_SENDER \  --broadcast Is there any way of reducing the security implications of enabling ffi? Arbitrary code execution is a hard sell to my security team but ffi would enable some advanced test cases. Nice and how did you use this setup with docker? Did you write any dockerfile to automate this? That’s what I’m having trouble with I don't use this one with docker. I just run just dev-node locally But I don't see a reason why this wouldn't work in a docker entrypoint.sh just the same has anyone here bought/sold an nft by interacting with the seaport contract directly? hi everyone, I see in the foundry book tutorials that the ""forge install transmissions11/solmate Openzeppelin/openzeppelin-contracts"" command is used. is there anywhere to see all the packages available to forge install? anything available on github, check forge install --help how can i set the gas limit for a solidity script? i keep running into a ""Failed to estimate gas"" error This deploys the proxy as a diamond standard, rather than just doing the OZ version.",346
1181,foundry-support.txt,"I'm not certain where I'd sub that in very cool, thanks! Hello everyone I’m new to foundry and having some issues can I get help here? Ask away How do I get started with a GitHub repository I want to use with foundry? I’ve downloaded the files if you just wanna try foundry you could try with this gitpod (a remote docker image that will run on your browser; https://gitpod.io/#https://github.com/eugenioclrc/DeFi-Security-Summit-Stanford/tree/foundry/ pls check the book :) Can I have link to the book please book.getfoundry.sh It’s just a generic Erc1967Proxy, the actual upgradeability/logic comes from the users implementation contract Is there a foundry discord? running into issues with testing and enums. Trying to use assertEq to ensure an enum value in a mapped Struct has changed but when trying contract.State state_ am getting ""Identifier not found or not unique It's weird that it only verifies the proxy contract and not the implementation contract By verifies, you mean on etherscan? Is there something else that should be ran to make it verify both the proxy & the implementation at time of deployment? I'm using: `forge script script/$(arg) --rpc-url https://eth-rinkeby.alchemyapi.io/v2/${ALCHEMY_RINKEBY_KEY} --private-key ${PRIVATE_KEY} --broadcast --verify --etherscan-api-key ${ETHERSCAN_KEY} -vvvv arg=MyScript.s.sol:DeployScript yeah sorry. on etherscan :) It puts proxy code up but not the implementation log haha. Deploys 2 contracts 1st the impl, 2nd the proxy. Then when it verifies, it only verifies one Hmm..",364
1182,foundry-support.txt,"that’s odd, I’m sure it worked for me with multiple implementation contracts, but let me verify so, after 2 failed attempts, a forge clean and foundryup it finally worked it shouldn't be related to the scripts I think brilliant! haha shoulda just done that right away 🙂 good stuff Is there an equivalent of tx.wait() in Solidity to write tests in Foundry? you don't really have to wait? you just put in what you want to the function call? or vm.prank(addr) or if long vm.startPrank(addr) My use case is the following: I’m writing a fork test in which I send a message from Ethereum to Optimism using the native bridge. But the bridging takes at least 5 minutes so I need to be able to wait for the transaction to be processed on Optimism by their L2CrossDomainMessenger contract. So I think I need to retrieve the transaction hash of the transaction on Ethereum and then look on Optimism if it has been processed. I’m not sure Foundry supports retry and timeOuts, so I may have to use Hardhat. hmm, sorry, don't think I could help out with cross chain stuff... Could you create a mock bridge? Seems janky tho and someone else probably knows better 😉 yo does someone know how to get the concatenated signature in tests like vm.sign() but full signature the way its done in ethers, not splitted v,r,s Tests for passing in signature for this kinda function : function update( string memory _route, address _address, bytes memory _signature ) weird. it was working, then I made a meta script to deploy 2 non-proxy contracts & 2 proxied contracts (so four total to deploy there) (six total) on a single script. it verified four, then failed. now even deploying 1 won't let me verify haha I feel like this is an etherscan issue perhaps? I was doing some testing where I used some js script to generate the sign for approvals. But there's also a built in signing I believe yup there is vm.sign() but it splits up v,r,s instead of giving full signature So weird, it worked early on some, now none.",449
1183,foundry-support.txt,"grr hello guys, wonder that how to change the cast call sender hey guys, im trying to write a script to deploy and verify a bunch of contracts, it deploys all the contracts but it only verifys the first contract (USD) its only deploying the USD contract . am i missing something about the way broadcast works? contract DeployGoerli is Script {  // Constants  uint256 public constant HUNDRED_K = 100_000 * 10**18;  // Contracts  Actuary public actuary;  Adjuster public adjuster;  InsurancePool public pool;  Certificate public certificate;  MockUSD public usd;  function run() public {   vm.broadcast();   // create contracts   usd = new MockUSD();   actuary = new Actuary(address(this));   adjuster = new Adjuster();   pool = new InsurancePool(address(this), usd, ""PoolOne"", ""POOL1"");   certificate = new Certificate(""Insurance Certificate"", ""CERT"");   vm.stopBroadcast();  } } Already tried - not worked. I finally managed to get it to work by a fresh installation of foundry and using my local network. Not sure how that impacts the installation for the 0.8.16 installer.",257
1184,foundry-support.txt,"neva mind smooth brain moment Why is forge update doing nothing for me? Just concatenate the signature: bytes memory sig = abi.encodePacked(r, s, v); I believe Does anyone know if for Foundry Cast, you can specify a msg.value for cast call? https://book.getfoundry.sh/reference/cast/cast-call Doesn't seem to have this flag (--value), which cast estimate has Am trying to simulate a transaction with msg.value by using cast (I know you can do it easily with forge test), but can't seem to figure out how to do so with a non 0 msg.value tx Guys does anybody know what happened to this link? https://book.getfoundry.sh/reference/anvil/tutorials/foundry-docker.html It seems like it is broken It's referenced in here https://book.getfoundry.sh/reference/anvil/#usage-within-docker does anyone know how to get some token balance to the test contract for test use? is there a way to access msg.sender/deployer address in a forge script? you mean the EOA? yes what does tx.origin print in forge-std/Test.sol -> function deal(address token, address to, uint256 give) anyone know if forge coverage is gonna support via IR compilation? how do you usually debug this sort of failure in tests? I'm having a hard time finding what the issue, there is no log on the traces, seems like an issue with vm.expectEmit but I have a few on each test FAIL. Reason: Log != expected log When I do forge update it doesn’t populate my Libs, how do I fix this? Have been reading book but don’t see a fix try forge install or git submodule update --recursive --init It’s like my forge commands are doing nothing did you ever figure this one out? Ill check and DM you thanks , will try it out - should work thank you so much.it works now. pranks only get activated in the next external call Can cast estimate be used to estimate the gas of a deployment? I suppose you can always use the amount given by deployment in a test hi, did a quick search here but didnt find the answer.",442
1185,foundry-support.txt,"Does foundry support fuzzing privateKeys as uint256 for Eip712 signing tests? im following the guide showing uint256 voterPrivateKey = 0xA11CE; hardcoded privateKeys, so i wanted to try fuzzing them, excluding max and 0, but i get signer error in some specific cases from forge test [FAIL. Reason: signature error Counterexample: calldata=0xa25b77b200000000000000000000000000000000000000000000000000000000000f4241fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd03641410000000000000000000000000000000000000000000000000000000000000000, args=[1000001, 115792089237316195423570985008687907852837564279074904382605163141518161494337, 0]] second arg is the privatKey uint256 if i change it to hardcoded version test works fine, my guess is an issue with the number? not sure Any references to check on why I cannot get my “lib” to update with forge update? yep, that's the secp256k1 order, it's slightly less than type(uint256).max so you want to hardcode the private key to be less than that in vm.assume: 0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141 or you could use uint248 in the params Foundry devs how do you debug? Trying to verify a foundry bug but breakpoints won't hit (rust beginner). I tried both vscode + LLDB and IntelliJ. rustc 1.63.0 (4b91a6ea7 2022-08-08), M1 chip Does Anvil support graphql api? hey guys! when deploying a contract on arbitrum mainnet, the script runs successfully but throws a failed to estimate gas error. there's an issue open regarding this.",414
1186,foundry-support.txt,"just wanted to know if there's a way around it? https://github.com/foundry-rs/foundry/issues/2941 Is it possible to read immutable private properties from contracts using cheatcodes in forge tests? https://book.getfoundry.sh/reference/forge-std/std-storage?highlight=storage#std-storage i think this may be useful, you need to know the slot of the field you want to read you won't be able to find immutables in storage ah, immutables yeah thats diff, is not storage they get compiled into the bytecode, not sure foundry can read those Exactly, I don't think std storage applies in this case. getCode = bytecode? yeah, but that would need parsing to get your specific constant value you are looking for i would guess 🤔 plus encode it in the type, etc it seems that if I forget vm.startBroadcast(), then the same code will be called with the wrong msg.sender. I'm assuming then that --sender is only used for broadcasts, and not other txs in a script? isn't this counterintuitive? in my case, was getting a lot of AccessControl errors. I also imagine that if non-broadcasted txs are mixed in a script, having two separate senders for each can be confusing anyone facing similar issues with the foundry GH actions rn? locally tests are running smooth @gakonst @joshiedo do we have docs explaining how msg.sender/tx.orgin work in scripts? I checked the book quickly but didn't see much. there's often questions about it and I've only ever used one sender so am not sure of the current behavior yea new fs permissions, see updated docs here https://book.getfoundry.sh/cheatcodes/fs Broadcast is similar to prank in this regard. If you don't use either of them, the script/test contract will be the msg.sender when making external calls/contract creations and --sender will be the tx. origin I feel thats what makes most sense to be honest. We use cheatcodes to change the default solidity behaviour I guess from that perspective yes. But the counterpoint is that I'm explicitly calling it with a flag --sender.",449
1187,foundry-support.txt,"If it were --broadcast-sender I would more easily understand it Hm, but that wouldn't be quite right either Sender is the address calling the script Tx.origin How do you avoid batching transactions in a deploy script that are grouped in a for loop? I am explicitly splitting an upload of data into different calls via for loop because doing it in one call takes up to much gas. But the batching that happens makes this break --slow awesome, thank you can I show the storage layout after running a script? can you look at changesets on foundry? Hey friends, so I am getting an error that is pretty tough to debug. I am providing a payable(address(0x123...)) value to an external function and getting a [FAIL. Reason: Contract {0x123...} does not exist] error that is found in evm/src/executor/backend/diagnostic.rs. However, this parameter isn't a contract, it is an EOA. Is there any insight into why this error might be occuring? Is there some kind of validation that might be running on addresses that could be buggy? Not sure how I could be misusing the address in a way that Foundry is throwing the error on an external contract call. @gakonst @brockelmore For clarity, I am not using the address to instatiate a contract etc. it is a value passed as an external functional param. Perhaps also relevant, this is occuring in a forge test. We are testing the integration of our contract with external, deployed contracts via a fork. @captnseagraves have you tried to isolate your problem and see if it still occurs? @UnknownRJ89 For isolation I have supplied the relevant params to the external contract directly, removing any intereactions with our contracts. The error still occurs. My hunch is that is an error with recovering a signature and whatever error message that is rippling back surfaces as this error in Foundry. Would make sense that it is a bit ambigous and hard to track if it is a signature recovery error. Meta-transacations can be difficult to get right. hi guys, im having a small bug, startPrank(deployer)`its not changing tx.origin to deployer, but `startHoax(deployer,deployer); its working lol...",476
1188,foundry-support.txt,"according to docs i should use; function startPrank(address sender, address origin) external; ok, just wasted 40 minutes 👌 the docs are ur friend anyone running into similar errors on GH actions? Started running OOM on forge test perhaps related to: https://github.com/foundry-rs/foundry/issues/3067 Yes same the abis are already exported in the out dir in json no Good morning! what is the best way to check for event in foundry? I want to test for this particular event in the test https://book.getfoundry.sh/forge/cheatcodes?highlight=event#cheatcodes expectEmit thank you! expectRevert for reverts @mattsse I can’t get mdbook to build the parse-json.md page, for the life of me (it 404s on book currently) Hi Guys. I have a test contract with a test function that just call some existing mainnet contracts (uniswap router, factory ect) to do some swaps. I can run it on a fork network with forge test --fork-url=xxx and everthing works well (I get the token I want to swap to).",241
1189,foundry-support.txt,"My question now: is there some magic way to run all this test logic directly on mainnet as multiple transactions? or do I need to pick up some JS/python and re-write all this logic (fetch pools, approve, factory, getAmountOut) and call the Uniswap contract respective method one by one? is there a way to know which paths are not tested from forge coverage ? What kind of ""transaction batching"" is happening in the background? Does anyone have more info on this? If there is only one sender, then it tries to send all transactions as fast as possible Which depending on the network, might mean that they're all in the same block is this some kind of special rpc method? Or it just means all with same gas price at once? It seems forge test runs get killed in the last version (at least for me), lmk if any of you face the same problem: https://github.com/foundry-rs/foundry/issues/3070 anyone that wants to follow that issue, here is a previous one: https://github.com/foundry-rs/foundry/issues/3067 The latter seems like a recent commit made forge test -vvv super slow (-vv works fie) *fine Maybe we should have a simple graph/diagram that shows the value of msg.sender / tx.origin in various contexts depending on usage of prank? https://github.com/foundry-rs/foundry/pull/3068 Should be fixed here Can you try it out? Hey guys, are foundry tools backwards compatible with things like Seth? @gakonst this fix releases tonight in nightly? or being dropped as a hotfix? Can't atm will later hey guys, quick q, are tests on foundry run like an atomic multicall or seperate calls with setup being atomic beforeEach? also ig the natural next question is fork context… do test contract A and B share state in fork tests? Can anyone verify whether a bug I’m seeing is just local to me please? It looks like calling ‘vm.createSelectFork’ then trying to call createSelectFork or selectFork again in the future causes an application panic.",442
1190,foundry-support.txt,"or *can* they point to the same forked state* the second part of my q pretains to select fork and create fork nvm @ndt1993_01 I would say as a matter of principle two tests shouldn’t share state (and my understanding is that each test runs in its own instance as created by setUp) hm ok, I’ll investigate, this all pretains to hot slots n stuff Hi guys, do you know how to generate a BLS signature with foundry for testing porpouses? im testing a staking system for eth2 validators https://github.com/ethereum/consensus-specs/blob/v0.10.1/specs/phase0/beacon-chain.md#bls-signatures I know I've asked before, but can't find it searching. I'm using Foundry on Windows via WSL and foundryup literally never works for me. Every time I try, I need to go through some convoluted process that I can never remember 😅 Found it :https://t.me/foundry_support/16956 Will try replicating that again 🙏 I see. Last time, the trick was to run foundryup again and it magically worked the second time 😂 Not so lucky this time: Trying rustup nightly 🙏 rustup update Yeah. Trying now 🙏 It got past that earlier error. 3 more compiles 🙏 (building foundry from source seems stuck on 822 of 824) Got it. Thank you. After rustup, I was able to build Foundry from source 👍 I think most people using Foundry are experienced giga brains, but for people like me who are not familiar with Rust, I wonder if a word in the docs near foundryup could also mentioned rustup? If you've been away from Foundry long enough to need foundryup, there seems to be a good chance you'll also need to rustup 🤔 Sometimes I go a couple weeks between needing to use Foundry and I always have troubles.",419
1191,foundry-support.txt,"any chance this can be related to submodules? solution: https://github.com/foundry-rs/foundry/issues/2810 foundryup and nuke svm does anyone have a nice template for a multi project forge setup Does forge script -—verify work when the contract creation happens via a nested CREATE2 call? It appears the answer is no remember some issue open for that i have a function in my server that triggers a bash script to deploy contracts automatically with foundry. when i try to dockerize my backend, the sh file is not copied. anyone have any thoughts as to why? please message me if you have any ideas and i can provide more context also now getting error that forge not found in docker Anyone know why forge thinks my contract has some crazy high Ether balance in my test? Is there some way to use forge-std without submodules? I have only had pain and suffering when trying to deal with submodules. Not sure if I should use this https://www.npmjs.com/package/forge-std 🤔 Maybe this will help? https://github.com/paulrberg/foundry-template I think my partner is using that. It is using submodules still right? (I'm catching up on code changes) can I get the contract bytecode for an un-deployed contract from inside solidity? the equivalent of forge build && jq -r .bytecode.object < out/Contract.sol/Contract.json basically maybe some solidity primitive like Contract.bytecode? does that exist? as an alternative I am also accepting a way to run bash from solidity I guess 😅 forge inspect MyContract bytecode take a look https://book.getfoundry.sh/reference/forge/forge-inspect?highlight=bytecode#description that looks like a cli command you want what kind of command? inside sol? yeah well that is easier oh but you said undeployed...",384
1192,foundry-support.txt,"this contract cannot be one that you initialized with new ? I guess I could initialise with new outside vm.broadcast() getCode - Foundry Book https://book.getfoundry.sh/cheatcodes/get-code yeah exactly what I needed, thanks! I'm still hoping there is some way to use forge-std without submodules 🙏 what is your main problem with submodules? to update/download them with one line is just git submodule update --init --recursive It used to be a major pain in the @$$ to remove submodules, but it seems easier now since the last time I tried. https://stackoverflow.com/questions/1260748/how-do-i-remove-a-submodule Submodules are just not cool. Subjective opinion, but I'm not alone. is there any ""forge uninstall"" to remove a dependency? I've just experienced so much pain. There is forge rm forge remove? 👆 Please open an issue with what extra commands to bundle And we can make it easier shouldn't this remove a submodule for you? Yeah it does But sometimes people do something. Weird I tried it, but my entire git status got hosed. Like delete the folder themselves And then the submodule removal fails Working with submodules requires git kung fu above my abilities. Yeah. That is probably me 😅 Following this: https://stackoverflow.com/questions/1260748/how-do-i-remove-a-submodule I was able to remove the submodules and I can add back the dependencies using yarn, but forge-std does not have a manifest. Check mate. It would be awesome if forge-std was on npm. I think it's worth being familiar with the git commands to manipulate submodules even if you don't like it Sure! We could. Open an issue in the repo? Happy to 👍 That would make my life so much better. I know I should probably learn to love submodules, but I am much happier with yarn / package.json for dependency management.",396
1193,foundry-support.txt,"We've talked about ""forge publish""as an easy command to touch a package json and then publish source/artifacts, maybe with support for the deployment addrs, maybe on npm etc Does anyone know if for Foundry Cast, you can specify a msg.value for cast call? https://book.getfoundry.sh/reference/cast/cast-call Doesn't seem to have this flag (--value), which cast estimate has Am trying to simulate a transaction with msg.value by using cast (I know you can do it easily with forge test), but can't seem to figure out how to do so with a non 0 msg.value tx There is a related issue I will link to: https://github.com/foundry-rs/forge-std/issues/39 Maybe we forgot :) easy PR to add this is from docs, what does this 1 means? maybe value? ooh uint from param https://github.com/foundry-rs/forge-std/issues/170 how to avoid estimateGas when running forge scripts? same i think —gas-limit only gets used for setting gas limit on local execution of run hi guys, just make a foundryup, and my cioverage has dropped to 0 :( why coverage includes my script folder? how can I ignore that? oh, there is an open issue about that Hey guys! forge coverage results show right number of functions but not right number of lines...what could be the reason? This contrat for example do have 14 functions but >57 lines...thanks in advance Hey guys! how to pass multiple private keys in forge script ? It's probably to let you deploy and make transactions without running out of gas, maybe you wanna simulate an user and you could prank and deal to it just bumpng these for visibility. also now getting error that forge not found in docker should be forge script --private-keys ""key1,key2,key3"" in .env PRIVATE_KEY=key1,key2? Error: Failed to create wallet from private key: Odd number of digits getting this error while trying. try --private-keys key1 --private-keys key2 ... yes it worked.",429
1194,foundry-support.txt,"Reason: SafeMath: subtraction overflow] Is there something comparable for Foundry? https://safe.ape.tax/ A tool to interact with multisignatory Gnosis Safe interactions. mind if i message you seperately to talk about this? Is there a new variable that needs to be set for forge coverage to work? Ours is reporting 0% after updating to latest. I solved rolling back to a previous version It's a bug, rollback to a previous version Is it tracked in any issue? https://github.com/foundry-rs/foundry/issues/3072 Did 3073 fix it? https://github.com/foundry-rs/foundry/pull/3073 yep, fixes What's the best way to prevent erasing run-latest.json when doing tests? If I start reading json files with readJson the broadcast logs better be the right ones (and not files created by test runs). basically how to distinguish runs with --broadcast There's also a timestamped json file That would mean hardcoding the json file loaded by the script. Ok i'll do something by hand, maybe look for receipts.",230
1195,foundry-support.txt,"Do you think it would be a good idea to split logs between broadcasted and not broadcasted? Curious: in Brownie when I add 50% more tests, tests take 50% longer to run; in Foundry, adding 50% more tests only adds 10-20% more time, as it seems bulk of time is in startup Any idea as to why this could be? Anyway I can tell my fuzz test cases to stay within a certain bounds? glad you figured it out @OxTaylor lol i was just typing up a response yes you can use bound() hehe yeah it makes sense why with the *1e18 for the amount 😉 I remembered it's not doing a whole set of coverage, simply just near bounds it tests more than just near the bounds, but def not 100% of all possible uint256 values 😄 right I added the *1e18 because it was failing on 0 value initially i have an issue opened to fix thus ideally foundry would compare eth_createAccessList with the response from eth_estimateGas to do pricing and then generation of tx can you provide repo? The foundry docker env uses alpine, there is no bash included in alpine linux , it uses ash if you want bash in alpine linux you have to add it via apk then add RUN sed -i -e ""s/bin\/ash/bin\/bash/"" /etc/passwd Is there a way to check error codes on ffi returns? anyone else using vim? how to i get the LSP to recognize the the remappings? its really jarring lol Foundry Support remappings.txt does the job for me, both editor and foundry, not sure how else you can configure them for your editor hmmm strange which language server are you using? will be able to tell you later today, not home at the moment ok thanks neva mind, i had two configured at the same time. im using space vim and it seems it installed one for me disabling one removed the error [FAIL.",412
1196,foundry-support.txt,"Reason: SafeMath: subtraction overflow] trying to replicate a swap test for a DEX but cant seem to get pass this, the example is Uniswap and that works okay but can't get it working on GMX swap anything related to deadline/slippage? for ex: blocktimestamp starts with 1 try to trace your error with -vvv could be, let me trace the error and include blocktimestamp ? what kind of swap are you doing? swap on Pair or on Router? v2 or v3? hi all, i thought in solidity struct is just a tuple- does anyone know why i can decode as struct or tuple when both fields are address but struct does not work when it has a bytes field? On a Router, I need to approve router and call router.swap with params solidity has it built in now hello, any idea if this is allowed in a test? it seems to be returning 0x00 when after it goes into assembly `function toBytes32(string memory str) public pure returns (bytes32 outBytes32) { bytes memory strBytes = bytes(str); if (strBytes.length == 0) { return 0x0; } assembly { outBytes32 := mload(add(strBytes, 128)) } }` wdyt about adding a prefix like dry-run-* to the output JSON if --broadcast wasn't passed? cc @gakonst Good for me. Actually may still need to write in-house stuff because multiple instances of same contract with diff. params cannot be distinguished. But still helps. can you expand? wouldn't they be distinguished by timestamp? I may not be following exactly what you're trying to do just created https://github.com/foundry-rs/foundry/issues/3088 to track If Contract is parameterized by a pair of token, we'd like to be able to lookup deploys Contract_AB, Contract_CD, etc. Not sure if we're going to write 1 script/contract per token pair (eg Contract_AB is Contract deployed by DeployerAB.s.sol ), or write to a addresses.json file as part of running the deploy script. Note that you can kind of differentiate by looking at the receipts field, but then you'd have to iterate through previous run-X.json through ffi and find the first that has receipts.",471
1197,foundry-support.txt,"hm so iiuc you can avoid in house stuff by looping through the array of broadcasted txs and picking out the ones where the constructor args match the two token addresses? true, though you can use readFile + parseJson which would be easier than ffi once this https://github.com/foundry-rs/foundry/issues/3053 is fixed yes :) heh yep that's what I figured you can iterate through a dir without ffi? oh no, sorry I just meant for parsing the files I managed with USDC to USDC but WBTC to DAI is having issues will investigate further, thanks *USDC to USDT for scripting, can u set up which rpc url to use and which pk to use inside the sol file or do you have to provide them via command line arguments? hey i'm having an issue testing transactions on a fork of mainnet this is throwing the ""swap failed"" error I put there Are there any known open errors on verification? I'm deploying a contract to goerli using 0.8.16 using forge script —verify, but keeps failing Imports are pretty straightforward, one use of a library but that's it: import {ERC721} from ""solmate/tokens/ERC721.sol""; import {Owned} from ""solmate/auth/Owned.sol""; import {Base64} from ""lib/Base64.sol""; import {Strings} from ""openzeppelin-contracts/contracts/utils/Strings.sol""; Via ir ? No, default compilation pipeline Did u try sourceify? Or just etherscan? Just etherscan.",320
1198,foundry-support.txt,"Maybe something about it being a standalone library? If I move the library code inside the main contract, then verification succeeds But if I import it, stuff fails Interestingly the openzeppelin Strings library has no problem being imported hmmm weird. if u peak at the bytecode in the out folder does anything look weird forge clear and try again, solved for me earlier Still failing after a fresh forge clean Not a bytecode expert but all the necessary files seem to be being generated in out/ Are there better options than this? cat $.env ... export PRIVATE_KEY=""YOUR_PRIVATE_KEY"" --interactive or https://twitter.com/devtooligan/status/1523716952421584899?s=20&t=unvYDEg6N-4SfQ8e81qnRA Nice by any chance do you have bytecode_hash set to none? I recently had issues with verification when that was set to none Don't think so, do you mean in the out/ folder for build artifacts? referring to this solc option https://book.getfoundry.sh/reference/config/solidity-compiler#bytecode_hash Ah, just using default values in the config try just naked import no named import @oxfoobar gm, could u pls open an issue with a minimum repro example? is there a way with cheatcode to create a snapshot, perform actions+assert, save some data in local variables, then restore the snapshot to last version perform other actions and compare data from those snapshots? I swear I did a ctrl+f on the cheatcode page 😄 found: snapshot + revertTo Hmm I think the transactionType field is always CREATE in broadcast logs Hey all, I’m running into a weird issue where when I try to use forge create to deploy a contract to optimism/arbitrum the eth_estimateGas RPC call fails with a too many arguments error, even though the number of provided parameters is indeed 1. Deploying to Goerli worked, and the estimateGas call set accessList to []. is there a cheatcode to get the label of an address? is it possible to pipe commands in ffi? Question! Having issues with expectRevert when it comes to revert use in the contract e.g. revert OwnerQueryForNonexistentToken(); Getting this error: Failed tests: [FAIL.",459
1199,foundry-support.txt,"Reason: Error != expected error: 0xdf2d9b42 != 0xdf2d9b42] testUnmintedId() (gas: 12678) hi guys Hi, if I have an event that is emitting 5 arguments and I wanna check the values only in the first 4, what should the vm.expectEmit look like? no matter what I do with forge or cast, I always get this error: called `Result::unwrap()` on an `Err` value: ExtractConfigError { error: Error { tag: Tag(Global, 27), profile: Some(Profile(Uncased { string: ""global"" })), metadata: Some(Metadata { name: ""`FOUNDRY_` environment variable(s)"", source: None, provide_location: Some(Location { file: ""config/src/lib.rs"", line: 1380, col: 14 }), interpolater: }), path: [""etherscan"", ""api_key""], kind: InvalidType(Str(""[redacted]""), ""struct EtherscanConfig""), prev: None } } Location: config/src/lib.rs:420 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry same after i do foundryup does selfdestruct in forked state not work? according to my test the bytecode is still there ""selfdestruct doesn't take effect until the call is over, which it isn't until the test is over."" nvm, resolved looks like an issue with your config, perhaps with an env var? Struggling with getting custom errors to be read in expectRevert, this is from the foundry book vm.expectRevert(MyContract.CustomError.selector); this is mine vm.expectRevert(nft.MintZeroQuantity.b562e8dd); Anything clear I'm doing wrong? nft.MintZeroQuantity.selector ? Selector should be the first 4 bytes of the errors hash (https://docs.soliditylang.org/en/v0.8.11/contracts.html#errors) But also tried .selector and didn't work 😅 did you set error MintZeroQuantity; in your nft contract? It's in the ERC721A contract that the contract inherits, and when testing it returns the error correctly but won't accept it in the test contract. Even if I just enter the bytes the test doesn't accept they're equal [FAIL.",490
1200,foundry-support.txt,"Reason: Error != expected error: 0xb562e8dd != 0xb562e8dd] testCannotAirdropZeroTokens() (gas: 17625) hex""b562e8dd"" ? lol running out of options I've given up 😂 test functionality works as intended, will just ignore the ugly FAIL for the time being did you try bytes4( ? 😝 I beleive you can use the nft.MintZeroQuantity.selector just seen this bytes4 says the string literal is longer than the tyype. Tried abi.encodePacked and again says 0x... != 0x... can i do an expectRevert for any type of error? I have a complex fuzzing test running and one of the calls could revert for multiple reasons. So I just want to have a vm.expectRevert() and accept any error. Is that possible? It seems like if i have an empty expectRevert() it expects a revert with no error message it shouldn’t even be using estimateGas if its going to try and make an access list eth createAccessList does the same thing as estimateGas, probably worst names rpc method in existence Arbitrum Arbitrum gas units are different: opcodes are priced differently, so swaps as an example, cost different amounts. Arbitrum has 2 separate gas meters- one for compute and one for storage On Arb its not clear if we capture everything we need by querying eth_gasPrice (also unclear if we need to capture both when estimating gas) Optimism Optimism charges a fee based on the size of the calldata that would need to be sent to L1 On Optimism for example eth_gasPrice always return 1000000 I use a github repo in my project and install it with forge install, and that project uses npm imports which gives me the error File import callback not supported in vscode and ParserError: Source ""@openzeppelin/contracts/access/Ownable.sol"" not found: File not found. Searched the following locations: """" when compiling.",416
1201,foundry-support.txt,"How do I solve this? The repo is https://github.com/UMAprotocol/protocol btw Do I go into the lib folder and npm install in the uma dir? Might be able to resolve by installing those packages (either with forge install github-repo or npm i package) and adding the remappings.txt I have the open-zeppelin contracts installed with forge already, but the uma contracts can't find those since they are importing via npm. What's weird is that foundry usually solves this automatically, because chainlink contracts does the exact same thing as uma wrt this and I have no problem there.",124
1202,foundry-support.txt,"did you install submodules after git clone? git submodule update --init --recursive hmm, why would I git clone? I normally use forge install <random repo> @szicknabo show me your mappings remappings* forge-std/=lib/forge-std/src/ ds-test/=lib/ds-test/src/ openzeppelin-contracts/=lib/openzeppelin-contracts/ protocol/=lib/protocol/ openzeppelin-contracts/ is not equal to @openzeppelin, you should fix that this is what i do on mine ds-test/=lib/forge-std/lib/ds-test/src/ forge-std/=lib/forge-std/src/ @openzeppelin/=lib/openzeppelin-contracts/ @uniswap/v2-core/=lib/v2-core/ @uniswap/v2-periphery/=lib/v2-periphery/ so I can use same import string as those from npm ah awesome, this solved it how can i use cast to calculate just the calldata cost of a tx? or the cost of a tx that sends just data to an EOA im trying to calculate costs of data availability how accurate you need to be? i think it is 68 gas per byte for nonzero bytes 21000 base tx gas cost + 4 gas per zero byte, 16 gas per non-zero byte - on mainnet at least looks like Istanbul changed from 68 to 16 👍 huh thats not how w is suppose to work i think https://github.com/sambacha/gas-reporting#evm-params ser you have a repo for everything what do you mean? is arbitrum deployment with a ledger broken ? Keep getting succesful traces but “failed to estimate gas” error https://github.com/sambacha/gas-reporting/issues/10#issue-1138205782 Forge install is meant to add dependency to existing / initialized project not create a new project not sure if this is 100% accurate FYI post Nitro or whatever i think thats Arbitrum right yes ofc, maybe I was unclear The deal cheatcode doesn't change the balances of contracts on a fork test but only changes the numbers internal for the test file, yes? i.e.",449
1203,foundry-support.txt,"if I deal to an address (from inside my test contract) and I make a call to a contract whose function calls balanceOf should that be the amount on the fork or the amount from deal? yea this is no longer true with nitro which is now live, opcode gas usage is now the same as L1. eth_estimateGas returns different values (and therefore gas limits are different) though because it adds additional gas to account for L1 costs deal that gives tokens or deal that gives eth? i confirm this is happening both on ledger and without tokens iiuc, yes, all balanceOf calls will return the dealt amount Because that doesn't appear to happen in my test what happens? do you have a repo to reproduce? and are you using something like aave atokens where balanceOf is computed dynamically and not static? Returns 0 Yes, and no. Can open an issue. awesome, yea if you can open one in the forge-std repo that would be great, thanks Done thanks, I'll try to look today but may be tomorrow, will keep you updated there using —skip-simulation did the trick solved, or accidentally closed? 😅 I realized the problem right after opening the issue. It was a problem with my code. Very on brand for me. heh well glad you got it resolved! What do you mean? Forge didn’t call eth_createAccessList, it just used an empty access list when calling eth_estimateGas which somehow made the call successful whereas when it doesn’t use an access list the RPC call is failing.",317
1204,foundry-support.txt,"https://github.com/0xfoobar/failedverify forge script script/Deploy.s.sol:Deploy --rpc-url ${GOERLI_RPC} --chain-id 5 --private-key ${PK} -vvvv --verify --delay 15 --broadcast deploys successfully but verification fails (with ETHERSCAN_API_KEY set properly) Something about importing an interface, even when it's dirt simple Wondering if I need to set up some special config or whatnot if I'm importing local files from the src/ directory @oxfoobar yeah, the source path def doesn't look right here This is a fresh forge project init, so not sure how it could've gotten corrupted what looks wrong? should be src/interfaces/ICounter.sol off to investigate 🫡 When I change the import from import ""interface/ICounter.sol"" to import ""src/interface/ICounter.sol"", it works But should it be failing on compilation if the path is wrong? Not successfully compiling, passing tests, getting deployed, and then just breaking on source code verification the snippet i posted is from metadata section of the artifact, that's used as a part of standard json input. so, it's highly plausible that it's simply malformated entry in the metadata Not possible? I found the Issue posted about 7h ago about the new file permissions function testFailYourTestHere will assert any fail oh your problem is that not always fail 😐 No. One of the calls in the test should fail with a custom error. But depending on the input, the custom error can be different. So I just want to have an expectRevert that matches any error that is thrown. So testFail could work, but I want to be able to have some some other calls afterwards that will succeed (in the same test) i take it back, since src is supplied as --include-path arg to solc, the entry is valid. hmmm is there any way to check which fork a non-persistent contract has been deployed to while switching between forks? it seems that deploying a contract with create(0, add(bytecode, 0x20), mload(bytecode)) doesn’t respect the current vm.selectFork() Did a ""random"" cheat code ever get anywhere? I could have definitely used one recently.",464
1205,foundry-support.txt,"We could easily add one yep That would be fantastic, as there are no straightforward ways to generate true randomness that I know if in straight solidity @oxfoobar sourcify verification - worked, etherscan with --flatten option - worked. my bet is that etherscan tries to recompile the contract and errors with not being able to resolve interface import path. sidenote on why it compiles: since foundry supplies src, lib, test & script as --include-path, you could import any directory from those folders directly and the compilation would still be successful. i.e. given project tree - script -- folder --- OtherContract.sol - src -- Contract.sol and Contract.sol pragma solidity ^0.8.16; import {OtherContract} from ""folder/OtherContract.sol""; contract Contract is OtherContract {} what was your use case for it? I was participating in 0xfoobar's nft game (https://twitter.com/0xfoobar/status/1566947546131464193) and was writing a function to ""find"" targets within 10,000 or so competitors. I wanted to do a random sampling to search for suitable targets to ""attack"". That's when I realized there was no straightforward way to generate random numbers. wouldn't writing a fuzz test generate those random numbers? or did you need purely random, whereas the fuzzer tries to be smart? if the latter and you need purely random, you can just hash the values generated by the fuzzer Gotcha. I'll just prepend ./ for now, weird edge case @rkrasiuk do the docs have ""best practices"" for etherscan verification? feels like there's a lot of quirks that come up (this one + bytecode hash), would be great to have them documented If you're doing the search within solidity, something like keccak256(abi.encode(i)) could work in a for-loop. Gives you non-adversarial random sampling hmm, I'd have to look into that. I was writing a script to interact with the contract, and dropped a loop function to sample some random nft ids. Not immediately sure how I would plug the fuzzer in there.",438
1206,foundry-support.txt,"@oxfoobar wouldn't that generate the same numbers over and over? 🫡 https://github.com/foundry-rs/book/issues/597 Ah, if you're looking for a repeatable function to call then maybe seeding the hash function with current block timestamp could get you novel results each time amazing, thanks Since you're running on a mainnet fork yea for a script you can’t use the fuzzer of course so this seems like the best workaround yeah good point. That should work. Still would be nice to have a vm.random cheatcode though. :) would love some advice on how to deployCode(artifact) to create multiple instances of the same contract with different addresses. currently this is creating contracts sharing the same address, even on different forks still struggling with the same problem re: custom errors, any big brains around? error[9582]: TypeError: Member ""MintQuantityZero"" not found or not visible after argument-dependent lookup in contract SEACNFT. --> test/SEACNFT.t.sol:134:25:  | 134 |   vm.expectRevert(seacNft.MintQuantityZero.selector); Try MintQuantityZero.selector If the custom error is defined in the SEACNFT contract ooh it worked! Had to define the error again in the test contract, then ErrorName.selector passes the expectRevert call. Thank you! Been stewing over this annoying FAIL test for a while now haha Well.. Tbh.. You don't have to define the error in your test contract Should work fine with contract Name.errorName.selector But it works.. So...",326
1207,foundry-support.txt,"👌 It doesn't find it this way for me, get the 'argument not found or not visible in X contract' but at least I have a fix now When you deploy a contract using a script, can I set just just the gas price? I'm not sure if that'd need to be done within the script or as a --gas-price flag on my make command? like would it look like this? forge script script/$(script) --rpc-url ${MAINNET_RPC_URL} --private-key ${PRIVATE_KEY} --broadcast --etherscan-api-key ${ETHERSCAN_KEY} -verify --slow --gas-price 10 -vvvv --with-gas-price $(cast --to-wei 10 gwei) hmm ok, so using makefile it'd look like: `mainnet_script_broadcast_slow_gas: forge script script/$(script) --rpc-url ${MAINNET_RPC_URL} --private-key ${PRIVATE_KEY} --broadcast --verify --etherscan-api-key ${ETHERSCAN_KEY} --with-gas-price $(cast --to-unit 10 gwei) -vvvv` Or I could change that 10 to $(gas) and then specify it in the command line as script=mypathtoscript and gas=10 so: make mainnet_script_broadcast_slow_gas script=filepath:scriptname gas=10 or would it not work to specify within the $(cast ...) component? yeah that works, it's --to-wei not --to-unit, my mistake error: The argument '--with-gas-price <PRICE>' requires a value but none was supplied when doing: --with-gas-price $(cast --to-wei $(gas) gwei) then setting gas=100 $(command) executes the command, while $variable or ${variable} is a variable so you want --with-gas-price $(cast --to-wei $gas gwei) hmm, still doesnt work I'm thinking it cannot be within another? Since that works for the script file path huh nope. even specifying it in the command fails the same do you have cast installed? if so try running the script from the console without make file cast is auto-installed I thought? I just tried --with-gas-price=100000000000 so just convert 100 to gwei manually, and that worked... weird with foundryup yes Interesting, it seems like it just hangs.",489
1208,foundry-support.txt,"I didn't use the --slow tag yet just wanted to see if it works with the gas This is where it sits Well, it looks like just doing =$(gas) then putting it in as already converted to gwei works now lol Much appreciated for the flag though! did anyone ever post an answer to this? or is this not possible atm? is it possible to get a full gas-report for fuzzed tests using --gas-report or not possible at the moment? fuzzing a function call that I know has a range of gas costs and getting a gas report back that has min=avg=max gas cost forge test —fork-url is taking > 1 minute to execute.. wifi isnt bad tried forge clean and forge cache clean ..",148
1209,foundry-support.txt,"any other reccomendations gratis senor can you try running with RUST_LOG=ethers=trace,forge,foundry_evm to identify bottleneck via logs I think we're currently missing the tuple case, the tuple output sould probably be (0x...,0x....,0x...,...)? will add this Hey forge fork testing works on neondevnet? hey guys, currently getting an EvmError: Revert when trying to test a withdraw function that uses payable(msg.sender).transfer() If I change the withdraw to use call() there's no revert, and if I test the same logic directly in the test contract it also works (also tested the function on a testnet to make sure actually works), any ideas what causes this? that should fix it https://github.com/foundry-rs/foundry/pull/3113 when i deploy my contract to polygon i get this error (code: -32000, message: gas required exceeds allowance (0), data: None) and it uses all of my matic in my wallet and goes to a random address what am i doing wrong? my command for my dockerized foundry is docker compose run foundry-deployer --constructor-args TEST TST https://labs.openai.com/ 2 0x522dB1211a0964A5c9DBE362741ca9c48C01394B --rpc-url https://polygon-mainnet.g.alchemy.com/v2/<my-alchemy-api-key> --private-key=<my-private-key> wtf are you trying to do deploy a contract to polygon ignore the constructor args it's just for testing Same thought 😄 nvm then i'll figure it out I'd recommend trying Scripts over deploying from the CLI: https://book.getfoundry.sh/tutorials/solidity-scripting Not that I’m aware of no hey how you doing? i'm having trouble setting ignored_error_codes in my project. already set the array in the foundry.toml, but at compiling, the warning pop again hey guys! having a super strange problem - using the default account, i fork mainnet, then deploy some contract which takes an address as input for the constructor.",452
1210,foundry-support.txt,"when i try to interact with that contract using the address i passed as input, i get the following error Setup failed: Contract 0x4859614cBE8bbe9cCAd991Cc69394343943CD52D does not exist. here's the code: ''' fortressSwap = new FortressSwap(address(owner)); console.log(""fortressSwap address: "", address(fortressSwap)); vm.prank(owner); fortressSwap.updateOwner(alice); ''' PLS HELP! ignored_error_codes = [5740] in my config hmm, could you open an issue ideally with a snippet that throws the 5740 warning maybe i'm setting it wrong? i've followed the docs maybe try adding the --ignored-error-codes flag when you run the tests? that's sounds like an issue/edge case with account managment in forking mode, would appreciate an issue also I think the newest nightly should throw a better error yeah that works. but it should work by setting the config in the foundry.toml and just running forge build oh i see. maybe try ignored_error_codes = ['5740']? never added this configuration to my foundry.toml before so i could be wrong let me check. according to the docs, it should be an array of integers just executed 'foundryup', now got the following error - Setup failed: Contract 0xCe71065D4017F316EC606Fe4422e11eB2c47c246 does not exist and is not marked as persistent, see `vm.makePersistent()` maybe that gives more info? nope. array of strings does not work either could you open an issue with your setup code do you see your error codes in the forge config output? i was following the script tutorial and am getting this error TypeError: Member ""startBroadcast"" not found or not visible after argument-dependent lookup in contract Vm. checked the forge-std lib i have and this function is present.",400
1211,foundry-support.txt,"maybetry removing and reinstalling? perhaps this one https://github.com/foundry-rs/foundry/pull/3111 ? wait no those were not the error codes i set in my config these are the defaults, if you set ignored_error_codes = [5740] you only should see them where do i do that? [profile.default] src = 'src' out = 'out' libs = ['lib'] ignored_error_codes = [5740,2018] that's my whole foundry.toml https://github.com/foundry-rs/foundry/issues/new?assignees=&labels=T-bug&template=BUG-FORM.yml the strangest part is that it literally worked yesterday forge config output is showing the defaults 1878 and 5574 could you double check that your working directory is the dir that contains foundry.toml? it is getting my custom remapping from remappings.txt it is, yes do you want me to open an issue? can't reproduce this, so I'd appreciate an issue for this, ideally with a repro great, thanks ❤️ yeah it's still not working https://github.com/foundry-rs/foundry/issues/3119 any info missing? issue submitted https://github.com/foundry-rs/book/issues/605 is there a way to get usd and estimated ether costs using gas reports / snapshots? Something that hooks in etherscan or coinmarketcap? something seems wrong in the reference for start broadcast and the forge-std github. the startBroadcast(uint256) overload is not present I was just trying to figure out how to get estimated gas for a mainnet deployment script where it deploys multiple contracts. I'm guessing its the same as deploying to test net... but you can use snapshot to get function call gas costs you should be able to run in verbose mode (e.g. -vvvv) and see the costs for each transaction in the deploy script The gas used is the same in all networks The gas price is what changes I am trying to use vm.rememberKey , but i am getting this error ""Member ""rememberKey"" not found or not visible after argument-dependent lookup in contract Vm."" anyone know why ? Calling forge test I get this error [⠊] Compiling...",467
1212,foundry-support.txt,"[⠊] installing solc version ""0.8.16"" [⠆] Successfully installed solc 0.8.16 Error: Solc Error: Anyone know how to fix this without manuallly having to pass in --use 0.8.15 every time? same for forge build try nuking ~/.svm and foundryup how do i get the latest version of Foundry, after this commit https://github.com/foundry-rs/foundry/issues/3119 ? tried 'foundryup' but seems to be the same version or will it only be released in nightly? foundryup -b master or wait for nightly awesome ty! update your forge-std version Perfect yeah that’s what I thought and it is true :) Good god I love foundry. Is there an uninstallation doc? rm -rf ~/.foundry im screenshotting and framing this I’ve been through situations where I couldn’t remember how I installed a binary and started deleting it from the filesystem manually only to find out there was leftover state somewhere. Didn’t want to go through that again 😅 Nuking worked. Ty I have a test that iterates through a for loop and makes a pretty expensive call each iteration. Eventually the test runs out of gas because I'm making so many calls. Does anyone know of a way to handle this for tests? It seems super brutal to have to manually batch these things into different tests. I initially thought writing a fuzz test and making the fuzz runs the batches would work but that runs out of gas too yeah run forge test —gas-limit <..> or configure it in foundry toml Awesome. Thank you Nice, will give it a try soon, thank you 🙇‍♂️ Am I calling startBroadcast wrong in my solidity deploy script? I followed the docs.",379
1213,foundry-support.txt,"Should I be using cheats instead of vm? you want to give an address not a privkey you need to do addr = vm.rememberKey(privKey) and vm.broadcast(addr) can i do that for multiple private keys? like sequentially i want one wallet to deploy and one to send a tx Actually, today we merged in the ability to directly specify a private key in the broadcast functions Are you on latest versions of Foundry and forge-std? foundryup forge update now i am lol Should work then is it the same syntax as in the docs & what i screenshot? Yes, looks fine But actually, we probably pushed the doc update a bit too quickly, my bad now i'm getting Execution reverted: Failed to get environment variable `GOERLI_DEPLOYER_PRIVATE_KEY` as type `uint256`: a character is not in the range 0-9 (gas: 286427) does the private key in the .env need to start with 0x? i just copied and pasted it from metamask You won't have this method until the new nightly is published, or you run foundryup -b master Yes, please do preface it with 0x are deployments saved locally similar to hardhat? Yep, in a broadcast folder If you mean the deployment output? i.e. a list of transactions which were run So, just to recap, run these in your project directory: foundryup -b master forge update And make sure your private key in your .env starts with 0x and then the output from metamask i'm getting different addresses for the private keys when i ran the script with verbose mode on Just to be sure, I would recommend to run vm.addr(privateKey) and then log it.",355
1214,foundry-support.txt,"If you copied the private key directly from MM into your .env, they should produce the same address i'm getting the same incorrect address when i console logged using .addr and .rememberKey is the issue vm.envUint(""GOERLI_DEPLOYER_PRIVATE_KEY""); should i be importing it as a string No, you should use envUint gotcha, yeah it was giving me errors with the string Just to be sure, does your private key look something like this in your .env? GOERLI_DEPLOYER_PRIVATE_KEY=""0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80"" pretty much yea Hm, aside from asking for your key I'm not sure how else I can help 😄 We have tests to make sure that it derives the correct address, and we use the same code that's used everywhere else in Foundry to go from private key to address You're 100% sure it's the same account you are looking at in MM? if you're down to jump on a call i can show you what i'm doing. they're only dev keys so i can also send them lol. i just double checked, straight from MM Do you have the code anywhere? Can't jump on a call rn but could in about 15 it's a private repo unfortunately yeah i'm down in 15 @thedanhepworth what a beast 🔥 Thanks @thedanhepworth for the help debugging, this should fix your issue. I tested it with my local build of forge and it works: https://github.com/foundry-rs/foundry/pull/3126 If I have constructor like this:  function createToken(   address owner,   TokenConfig memory base,   SaleConfig memory,   RoyaltyConfig memory royalty,   address config,   bytes calldata  ) external returns (address) {   DStorageERC721 token = new DStorageERC721(base, royalty, config);   token.transferOwnership(owner);   return address(token);  } When I run forge create I always get invalid data. I already pass the parameter correctly and ordered. Is there anyway that I can avoid using passing the constructor-args? Because I just use deploy when using truffle.",478
1215,foundry-support.txt,"Hello everyone, Is it possible to mock contracts for testing, like how it is done in Hardhat using Waffle but in Foundry ? yo... i added openzeppelin to my project and imported it but when i run forge build it says it cant find the library . ├── foundry.toml ├── lib │   ├── forge-std │   └── openzeppelin-contracts ├── script │   └── Counter.s.sol ├── src │   ├── Character.sol │   ├── Character.sol~ │   └── Counter.sol └── test └── Counter.t.sol import ""/openzeppelin-contracts/contracts/token/ERC721/ERC721.sol""; if I change the import to import ""lib/openzeppelin-contracts/contracts/token/ERC721/ERC721.sol""; it works wtf idk why it wont search the lib folder this is a new foundry project dont use leading lne your pointing to the root of ur drive not the relative path Remove /open to just open lib is implied alrdy by default in the scope sry @sambacha i put a typo here @sambacha import ""forge-std/Test.sol""; import ""openzeppelin-contracts/contracts/token/ERC721/ERC721.sol""; it can find forge-std just fine but not openzeppelin wtf Test.sol is in lib/forge-std/src/Test.sol idk how it can even find Test.sol lol yo @sambacha is https://github.com/OpenZeppelin/openzeppelin-contracts supposed to have foundry.toml in the root? I just tried a difernet library.. solmate: > forge install transmissions11/solmate import ""solmate/tokens/ERC721.sol"";  ^^^^ this builds fine... so i think the crappy openzeppelin contracts arent working properly w/ foundry ok i think i found out the cause of the problem... forge doesnt have a remapping for openzeppelin.",400
1216,foundry-support.txt,"but it does for forge-std which is how it can find Test.sol so I have to do something like this: remappings = [ '@openzeppelin/=lib/openzeppelin-contracts/', in order to find openzeppelin properly stupid foundry nft tutorial doesnt tell you about this smh https://book.getfoundry.sh/cheatcodes/mock-call#mockcall is this what you’re looking for? you can also check all current mappings with forge remappings How did you change your font passing in structs can be messy, invalid data should mean the input is incorrect (but it unfortunately doesnt provide targeted error messages). So perhaps you could consider writing a deploy script. Something like this: https://book.getfoundry.sh/tutorials/solidity-scripting#writing-the-script tg supports markdown : https://www.markdownguide.org/cheat-sheet/ some of my tests started failing after updating to (6abb763 2022-09-08T00:05:15.055944634Z) from (6b3db2a 2022-08-19T00:24:19.967244Z) anyone seen similar issues with the latest one? try this: did you install submodules after git clone? git submodule update --init --recursive Yeap, thats exactly what I need., Thanks Hi, my deployment on anvil does not succeed anymore because the network is ""killed"" during the process. I'm using the latest Foundry build ( nightly-6abb763c2259e034fef283ab753b539113d971e5). Any idea? Which Ethereum API is used by cast wallet sign? Hey, does console.log only print to terminal for test scripts? I want to debug part of a transaction to a deployed contract (deployed to anvil fork) hmm this looks like the kernel killed it? perhaps this is a memory issue, could you try monitor mem usage and open an issue if something's off we should have logs enabled it anvil as well, if they don't show up that's a bug is selfdestruct() not implemented in anvil? doesn't seem to work when I call it from a forge script so could also just be ignored from forge script even if vm.broadcast is enabled actually, if I cast send 0x... kill() it works: call code 0x...",481
1217,foundry-support.txt,"returns 0x however it doesn't seem to be the case when inside a forge script so it's not anvil so it just seems the broadcast feature of forge script doesn't detect it as a storage operation to perform There seems to be a memory leak with anvil, which crashes after consuming more than 10G of RAM and without being able to perform my deployment. While a few dozens of MB were enough with Ganache. I will create an issue. I installed foundryup on my ubuntu 18.04 and tried forge init I got an issue anyone can help me? https://github.com/foundry-rs/foundry bottom of page OUT OF DATE GLIBC This one, right? I tried first option and got an error with compliation. I use rust 1.61.0 is it possible to pass factory contract? I mean without needing to pass the parameter? so that frontend can call the contract and pass the parameter. So my contract is deployed so that user can create another contract. Using forge create need me to pass the constructor parameter. And seeing the script section, I should create the contract with parameter. @totlsota can you please help me with this? https://github.com/sambacha/zen-foundry-template/blob/efc6cbf8212e6673faa0671a29ef32b75e564da6/foundry.toml#L56 i dont even know why there is a musl build when you need glibc Hello can I just use written test for deploying to custom network other than local vm? without using forge create and cast cmds... like hardhat just changes the network it is using via configs You can write a script you point to a different —rpc-url and you use forge script thank you I will search for that forge script works well. thank you Does vm cheats work even in script too? like vm.roll() waits for the specfic block number and `vm.warp()` waits tlil certian timestamp no it just modifies the vm state is the solidity scripting slower than other methods of scripting? i'm trying to send a tx with a payload with the hash of the previous block number, and getting errors bc it isn't being included in a block until 2/3 blocks later than expected.",465
1218,foundry-support.txt,"i'm using Goerli testnet if this is a known issue there hmm no it should be fast actually can u open a repro maybe? https://blog.soliditylang.org/2022/09/08/solidity-0.8.17-release-announcement/ Does new keyword create a contract in vm? even in script mode? not consuming gas at all and geetting same contract addresses immediately i'm working in a private repo, but if you want I can share code snippets over DM I had to use --broadcast rofl We are never gonna get no append metadata option in solidity If the script expects some state at a later time, the RPC endpoint might not realise that your transaction *will* work --slow can help this I've had that when a script withdraws some ETH and needs it in subsequent transactions, the RPC endpoint gives me insufficient funds errors, even though the sender will have enough ETH Hey guys, I'm wondering if I'm misusing the forge build --contracts option or if this is a bug... The compiler run fails due to a compile error outside the directory specified in the --contracts option, which does not contain any dependencies For example, running forge build --contracts src and compilation fails due to an error in test point the test dir to src in your toml Hey @mattsse, I'm trying out this feature you added (https://github.com/foundry-rs/foundry/pull/3116) but cannot seem to get it to work.",304
1219,foundry-support.txt,"Calling cast call 0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D ""WETH()"" --rpc-url ""mainnet"" I get the following error: I've run foundryup, it includes your commit and I also have mainnet setup as an alias in my foundry.toml maybe cast call doesnt load from the config? I think it's because the RPC URL property in Config and EthereumOpts have different keys: rpc_url vs eth_rpc_url I guess that's what this line is supposed to do, but I think it doesn't use the right values based on my last message: https://github.com/foundry-rs/foundry/pull/3116/files#diff-32b1e82bd49d6a44243f2eb7e4e8d4041184664daeed38d459d5a82b675e8736R62 hmm no it should have worked per this line https://github.com/foundry-rs/foundry/pull/3116/files#diff-4429d8a75f4f230ae4b5c590d76a1a5a9aa1f2553bc4740c5f3d7dc0137cd704R2801-R2809 can you try logging what the value is? oh it’s relative URL without base hmm is your mainnet prefixed in the config with https://? Yep. FWIW vm.createSelectFork(""mainnet""); in tests works fine, so I expect that the value is mostly being read in fine this worked for me I'm an idiot a question, are you calling this at the root of the forge project I think matsee just didn't implement it for forge script and so I started debugging.",378
1220,foundry-support.txt,"Then, I was doing my cast commands from the foundry folder 😄 Running the cast commands from my project folder works perfectly So, I'll open a quick PR to also make it work with forge script Apologies for the collective brain power exhausted 😄 its a call for better error messages actually agree Good point, I'll get that in my PR too yo I see this in the foundry book vm.expectRevert(Unauthorized.selector); where can I find a list of all the different things I can pass to expectRevert I don't know what to put to catch my failed require call lol another question... if they say testFail is bad practice then why did they implement it lmfao foundry rocks btw way more fun than remix Read Vm.sol in forge-std you can also put the 'require' message - eg. to catch: require(false, ""NotAllowed""); you can use vm.expectRevert(""NotAllowed""); backwards compatibility with dapptools as well as in very rare circumstances it’s needed/best gas wise is there a difference in a function accessing a variable of its own contract or a variable of some other contract? is there a good guide on remappings and solc module resolution algorithm ? Hi everyone, I was trying to use forge create with anvil as well as hardhat local node, and in both case I don't get any contracts address, neither do I get a error msg... (my contract does not have constructor) what I'm doing wrong...? wonder if this is again some weird issue on windows, does it work on WSL? it looks like forge thinks the cwd is not a project dir, does the of forge config reflect your foundry.toml settings, we had this already that for some reason on windows it refuses to load the config file... yeah I get all the setting I have set in foundry.toml + remappings.txt and some more when I do forge config, do I need to add special config to use forge create? I'll try shortly with WSL... Trying to install foundry from source on WSL got me this error when trying to install anvil... sorry about that, try removing the --locked flaf is this repo public? would like to try debugging some windows issues thanks, it seams to went further in the install process, but still endup with a few errors...",476
1221,foundry-support.txt,"🤦‍♂️ I never had issue installing foundry on windows, but WSL... I'm having issue on each of my pc 🤦‍♂️ getting this error when sending a tx to anvil MetaMask - RPC Error: [ethjs-query] while formatting outputs from RPC '{""value"":{""code"":-32603,""data"":{""code"":-32003,""message"":""invalid chain id for signer""}}}' could check the chain id of your signer, anvil uses 31337 but you can set this with --chain-id thank you! that was the problem - I thought chain id was 1337 Hi @gakonst , forge install does not function in the exact same way as Dapp install. Some of the DSS libs are not installing the correct versions, however ‘git submodule update —init —recursive’ does install correctly. Could you please look into this? could you please open an issue for this Done Please lmk when this is fixed so I can update make files, thanks! When using createSelectFork cheatcode inside a script it works fine when reading values, but when trying to broadcast it panics and crashes. Should the forks be useable in the scripts or? It works fine when not using the cheatcode but passing the fork in with --fork-url instead. Afaik it’s still in the works for being able to deploy multichain Thanks 👍 I think in the manual there is an error in the integration with hardhat With just an already barebone foundry project I receive this error when I launch npx hardhat We couldn't initialize the sample project because this file already exists: test As there is already a test folder Would be great to have something like this. I think maybe it could be done without too much trouble in Foundry? What would be necessary for that? Building transactions to be executed by the safe and then submitting them to the endpoint provided by Gnosis... when using Anvil forked from mainnet - it appears that `totalDifficulty` for a block is not present if any blocks are mined (either after an interval or automatically due to a transaction). Is this expected? It appears that Hardhat keeps this around. maybe a bug, should be simple fi can u open an issue? Yup! I will in a bit.",472
1222,foundry-support.txt,"https://github.com/foundry-rs/foundry/issues/3154 How do I invoke a script and sign the broadcast with a hardware wallet? --ledger and it’ll autodetect forge script script/Contract.s.sol --rpc-url $GOERLI_RPC --broadcast --ledger that isn't working for me ^ what’s not working? ^^ This is probably incomplete... function run() public { vm.broadcast(); address dst = 0xA600AdF7CB8C750482a828712849ee026446aA66; (bool sent, bytes memory data) = dst.call{value: 5 gwei}(""""); } I probably need something more along the lines of this function run() external { uint256 deployerPrivateKey = vm.envUint(""PRIVATE_KEY""); vm.startBroadcast(deployerPrivateKey); NFT nft = new NFT(""NFT_tutorial"", ""TUT"", ""baseUri""); vm.stopBroadcast(); } } Is that what I should put in there? Does anything change there when I am using a ledger? Feels weird to have vm.envUint(""PRIVATE_KEY""); when I am signing with a hardware wallet You could do vm.broadcast(address) and use the hardware wallet’s address Ok that's a little more comfortable well that was simple, doesn't even ask for the derivation path or anything, it just knows to sign with that account on the ledger Foundry is so good haha nice yep exactly that’s the point can I at least check a box so I can choose security? just kidding. that's a joke about user experience and object capabilities based login systems. what’s up what would be really nice though, is a way to build gnosis safe transactions with this totally straightforward solidity based approach. anyone ever get ""The path <path to a contract json> is not allowed to be accessed for read operations.”? its happening during a forge script specifically when using deployCode. edit: solved via foundry.toml file permissions Having trouble building foundry from source. Im getting the following error: `error: failed to select a version for the requirement rpassword = ""^7.0.0""` Tried a fresh clone of the repo as well.",445
1223,foundry-support.txt,"Using this command to build forge (taken from README) cargo install --path ./cli --profile local --bins --locked --force hello, why does cast wallet sign not have the same output as personal_sign with metamask? Is it not the same signature scheme? fwiw I have been building from source for months using cargo build --release i believe cast wallet sign uses eth_sign, not personal_sign, hence the difference in output. Unless I’m wrong about this. is there a way to deal erc20 tokens in anvil? there’s a deal(who, balance) on the cheat codes contract but that’s for eth i guess i could transfer them from some address still deal(token, who,amount) doesn't seem to work cast decodes the signature and calldata however n9,] it's a function in forge-std/Test.sol, not a part of the Vm interface ok. lmao hi does anyone know what's the best way of doing named structs like rust or Union types like C? where you have a type that's this type or that type? Struct Foo {} Foo foo; should work that's just a normal struct? like let's say I have Struct A and Struct B and I want a array of things that are either A or B Ah! Sounds like dark magic yes but most low level languages have a way to deal with that like C you have union types you do need to dynamically check type tho and in rust you have enums which can hold a struct value here's the problem: say you have a list of tasks to send to your contract and depending on the task type you have a different set of argument you could just create a struct that contains all the possible arguments but that just uses way more space than it should and it's also not as easily expandable. what happens if you need to create a new task type? enum Foo { Var1(MyStruct), Var2(MyOtherStruct) } tagged unions that's possible in solidity? https://patshaughnessy.net/2018/3/15/how-rust-implements-tagged-unions#:~:text=The%20Rust%20compiler%20implements%20tagged,unions%20at%20the%20same%20time. nope not in solidity oh sorry i thought you meant how to do it in rust my bad its not possible in solidity yeah that's what I'm saying haha.",495
1224,foundry-support.txt,"yeah I was using rust as a good expample one extra reason to be excited for Fe then *fingers crossed ?: im trying to use forge install and i keep getting the same error, ""This command requires clean working and staging areas, including no untracked files. Modify .gitignore and/or add/commit first, or add the --no-commit option."" just use —no-commit or commit your changes sort ming ? 🤌 any plans to add log_bool? adding the library @perelyn_sama created Use classes aka contracts abstract Contract Base; Contract A is Base Contract B is Base Base[] myStuff; Base has virtual func getType Child contracts implement getType getType returns an enum Each child implementation of getType returns a diff enum myStuff.push(new A) myStuff.push(new B) myStuff[0].getType () myStuff[1].getType () hey guys, does anyone know of a Foundry repository that implements ERC1967 UUPS, along with a full testing suite? no usually proxies aren’t part of the business logic, so it might not be that common to see repos with tests on proxies. But if you’re simply looking to understand how to deploy proxies, hardhat has very mature plugins: https://github.com/OpenZeppelin/openzeppelin-upgrades/blob/master/packages/plugin-hardhat/src/deploy-proxy.ts , you can just mimic this. i suppose solidity doesn’t support generics or enum variants, so nope. I’m personally unsure if one could write assembly to implement this, would be interesting though.",308
1225,foundry-support.txt,"cast wallet new creates a new keypair I add the private key to a .env file and try to load in a deployment script uint256 deployerPrivateKey = vm.envUint(""PRIVATE_KEY""); The deployment script errors with Failed to get environment variable `PRIVATE_KEY as type uint256: a character is not in the range 0-9` How do I get a burner private key as a uint or what can I load it as? Just using --private-key $PRIVATE_KEY in the CLI as a work around doesn't work contracts are contracts you can't pass contracts in calldata structs don't have inheritance the simplest way is probably just to do like C unions but manually in assembly, taking the largest space possible for each element in the array, and then casting in runtime to the right time of struct as you check its type but that's just tooo sketch, I'd rather just have a struct that has all of the fields I guess and wait for Fe i see, will check this out. thank you! think your .env file’s PK isn’t prefixed with 0x. The cast wallet new command returns a PK printed without 0x. think cast wallet new works well as burner PK, though i usually use cast wallet vanity : https://book.getfoundry.sh/reference/cast/cast-wallet-vanity , I’d say that I’m not too sure about the difference between these 2 commands myself Adding 0x to private key in .env did the trick Well vanity is to create an address that matches a sequence but without parameter it's the same I am deploying to Optimism-Goerli and get Invalid API Key 2 using the same Etherscan API key as Ethereum mainnet. Do I need an Optimism-Goerli Etherscan API key? yes ""EvmError: FatalExternalError"" New achievement unlocked anyone had this before? Please, I am having issues installing foundry on macOS.",393
1226,foundry-support.txt,"I have installed foundryup and used it to install foundry, but when I run forge, I get an error: dyld: Library not loaded: /usr/local/opt/libusb/lib/libusb-1.0.0.dylib Referenced from: /Users/casweeneyojukwu/.foundry/bin/forge Reason: image not found zsh: abort forge Anyone fixed this before? https://github.com/foundry-rs/foundry#libusb-error-when-running-forgecast brew install libusb the instructions sre on the readme in the foundry repo They made a cheat code called toString, so now you just have to use it on your bool then log it as a string. Rough example: bool isBool = toString(false) emit log_string(isBool) How did you get it? Funny how I wanted to implement the cheatcode myself then I saw they were already working on it. The foundry team🐐 Thanks a lot, it worked. Thanks so much. Yes you can Simplest way is with contracts.",215
1227,foundry-support.txt,"It’s OOP what are you even talking about tho, you can only pass addresses that as an interface that you can call from that contract completely different from structs I wrote the example code earlier If you want to store diff objects in the same array And get the type I answered this q ok I see what you mean now but there are many caveats to a solution like this like extra gas costs and things like that and it isn't really as direct of a solution as something like C unions Use L2 cheaper gas thanks tho Each child contract can store diff data Everything has a tradeoff Have to make the best decision for ur unique problem yes but you see it isn't contracts that are the point here, it's more about passing different arguments depending on what you want to do Once you get the type of a contract you cast it to the child contract type If xyz.getType() == enum.typeB ((B)xyz).functionDefinedInB() the problem is more to do with calldata data like after you type check like this how do you get all of the arguments that goes with this If you know it’s contract b then you as the programmer know what the interface for contract B is an interface doesn't have data to it the same way a struct has It’s not an interface It’s a contact with state I mean the api of the contract is known to you state on a contract is only storage What’s wrong with tht well you just can't really use that to pass arguments without leading to tons of issues What issues, this is exactly what I do in my game I don't think we're even talking about the same issue then *same problem Hard to tell because you aren’t being clear what exactly your issue is You keep saying I can’t do this or that I’m showing you how but you’re not telling me why my solution won’t work I literally do this in my game I'm saying the problem I'm trying to solve is probably not the same problem as in your game This is your “issue” that I solved.",410
1228,foundry-support.txt,"I don’t see how I didn’t solve it Would you share your problem then send you a dm I don't wanna clutter the chat too much maybe keep an external remappings.txt file? is neovim just using a solhint extension? is this up yet? i get [⠑] installing solc version ""0.8.17"" [⠘] Failed to install solc 0.8.17: Unknown version provided I opened an issue 4 days ago, it's still open, so I guess not. https://github.com/foundry-rs/foundry/issues/3141 thought bytecode_hash = ""none"" was enough :[ it looks like he added https://github.com/roynalnaruto/svm-rs/commits/master 🤔 does @onbjerg need to manual patch from royal like https://github.com/foundry-rs/foundry/pull/2858/files ? there is no open pr to checkout on foundry i think you could try foundryup -b master to check whether it's already incorporated (am currently on my phone so hard to support haha) not in a crazy rush it's ok i'll 8.16, plus doing the -b master takes an eternity ;D hahaha I know - building from source (at least on my computer takes soooooo long) we just need to update ethers, this was merged yesterday https://github.com/gakonst/ethers-rs/commit/feaa473ffbabee82e1a20eb58f8bce9fd995dd16 meanwhile you can svm install 0.8.17 and add solc = ""0.8.17"" to ur foundry.toml I'm trying to test a flash loan ocntract by forking mainnet using forge test --fork-url <rpc-url>, but I'm running into this issue: essage: Failed to get account for 0x00a3…ea72 ProviderError(JsonRpcError(JsonRpcError { code: -32000, message: ""no trusted canonical hash trie"", data: None })) should I open an issue on github? you're using the default foundry account and not passing in --private-key Ah. I just fixed it by using a different rpc url Getting an odd error: [⠆] Compiling...The application panicked (crashed).",492
1229,foundry-support.txt,"Message: checksum not found Location: /Users/runner/.cargo/git/checkouts/ethers-rs-c3a7c0a0ae0fe6be/91d8c21/ethers-solc/src/compile/mod.rs:463 Nuke svm and try again seemed to have worked, thx anyone know what is the best beacon node to run? nimbus seem very buggy anyone familair with this issue when compiling with forge? Failed to create artifact parent folder “……/out/Setup.sol"": Read-only file system (os error 30) how do i give myself N amount of tokens nowadays? old methods seems to be not there this is a OS FS permission issue, check permissions and give user write access if missing didnt change anything though, and used to work. feel like its related to naming of some files/contracts cause i did some renamings.. any idea why it is not working with forking? 🧐 Try other RPC Any idea on where can i get good fantom one? 🥲 hey! love foundry. this might be the wrong place for this, but when using solmate 1155, there doesn’t seem to be a place to pass the uri (like in OZ constructor). Would i emit the URI w/ the uri event as `emit uri(“exampleURI”, exampleID) and be able to return via uri(exampleID)? this looks like your provider sent an empty response did it happen after installing 0.8.17 manually? i saw you used it for endgame init & i started getting the same error after installing latest manually.",331
1230,foundry-support.txt,"should be fixed once 0.8.17 is fully supported i run forge install OpenZeppelin/openzeppelin-contracts --no-commit option and it rtns Error ""Could not determine URL for dependency ""option""!"" Yes sounds right couldn't reproduce this only missing new apple silicon native builds to support this properly, aiming for tmrw's nightly Traces: [2922] DeployFeed::run() ├─ [0] VM::envAddress(""WALLET"") │ └─ ← ""environment variable not found"" └─ ← ""environment variable not found"" WALLET=""0x487afa34296cd7d6ceea2a6134adeebd41d77e81"" in my .env file does setting it manually wok WALLET=""0x....."" forge test ...? source .env yes I had it sourced Try removing the quotes on another note, if I want to send a transaction using cast and a hardware wallet, how do I tell it which wallet from my ledger to use? right now, it doesn't ask me which account I'm trying to use and earler, I remember I tried to use another account from my ledger than the one I first used with foundry, and it couldn't use it. it printed something that had an array of accounts in it, and in that array was the one I initially used foundry with. so it's like that account is synced into foundry somehow, but I never told it to do that, I just used the public key in a script and it found it. So in general, how do I use different wallets from my ledger with foundry? Have you tried   --mnemonic-derivation-path <PATH>  The wallet derivation path. Works with both --mnemonic-path and hardware wallets.   --mnemonic-index <INDEX>    Use the private key from the given mnemonic index. Used with --mnemonic-path. [default: 0] I got this error while trying to deploy a contract with forge create NFT --rpc-url=$RPC_URL --private-key=$PRIVATE_KEY --constructor-args <name> <symbol> I haven't because that looks spooky.",444
1231,foundry-support.txt,"Is that the way? How do I know I have parameterized this correctly? And what is this for? Is this the method of specifying which hardware wallet when running cast commands as well as forge script commands? Your derivation path should look like this m/44'/60'/0' - it is a little differeent between ledger and ledger live so you'll need to figure it out The index is appended /0, so depends on which address you're using I just want to be sure that I can figure this out without a massive screw up regarding my private keys and hardware wallet. Change [default] in foundry.toml to [profile.default] Try to find your address first cast wallet address still the same error was there some way to have foundry make http api calls? Save? Surl - https://github.com/memester-xyz/surl is that in the docs somewheres ser? yup based guess all we need now is a Jason Parser written in solidity Foundry does have a readJson method, and I believe simple JSON parser implementations do exist. Nothing particularly dev UX friendly though. https://book.getfoundry.sh/cheatcodes/parse-json haha wtfff this did the trick @MaximLegg thanks contract deployed 👍🏽 No luck. It must be a different file than .env by default, or something along those lines. Or do I have to put something in my foundry.toml? It should work like that :/ are you on Linux ? No I'm on mac I just tried vm.setEnv(""THIS"", ""THAT""); and it didn't write anything to my .env file, but nor did that step of the code fail. It failed when I tried to read a variable that is there do I need to grant certain permissions to my .env file? chmod or something? are you exporting the env var? export MY_VAR=stuff then source it and foundry will read it (if its called .env it should read it automatically without sourcing), and make sure you foundryup for good measure i am trying to use this snipet to mint a token, how do i add value to it cast send --rpc-url=$RPC_URL <contractAddress> ""mintTo(address)"" <arg> --private-key=$PRIVATE_KEY no, I wasn't exporting it.",474
1232,foundry-support.txt,"But sourcing it without an export will still make echo $MY_VAR work this is the error i got, so i thought maybe its because i am not providing any ethers you need to export it for foundry, otherwise its just local to your shell and not in newly spawned processes That fixed it, thanks Matt Also it worked to do WALLET=$WALLET f script scripts/.../... ... .. . ... .. anyone has ideas on how to deploy to optimism ? forge script keeps failing and cant be used is there a way to deploy the bytecode with cast ? forge create --rpc-url $optimism_rpc --private-key $my_PVK ContractName should work.. though I'm having a problem doing this for goerli-optimism atm and came here to ask used: forge create --rpc-url $optimism_goerli_alchemy_rpc --private-key $my_PVK ContractName got: (code: -32602, message: too many arguments, want at most 1, data: None) - alchemy: ""method"":""eth_estimateGas"" anyone know what's up with that? there's currently a bug with goerli optimism: https://github.com/foundry-rs/foundry/issues/3150#issuecomment-1242314188 is vm.sign() deterministic? any method to get signatures of various nonces? (without using ffi, for example) forge snapshot --check I am using this command and I got this type of error. anyone tell me how this error occurs? Any idea what would cause a test to fail when using vm.createSelectFork() while forking using —fork-url would pass? What could be different about the two methods? Also added vm.chainId() so the tests should be running in an identical setup You’re probably instantiating stuff before you call createSelectFork Just checked. That doesn't seem to be it. Forking at the very beginning of setup() with nothing instantiated before then.",399
1233,foundry-support.txt,"It happened to me once that it was an in-line instantiation at a var declaration Test contract level var Checked those as well :/ Only thin instantiated is Vm() *thing is it a constant? I mean, is it you doing it? otherwise it's constant so that shouldn't be a problem error log? kinda blind guessing here Yes can't think on anything else without the error log Vm internal constant vm = new VM(HEVM_ADDRESS); The error is simply a revert with no message.. It's a few different tests that interact with other mainnet contracts. that normally happens when you call an address that ""doesn't exists"", so I'd say it's either an instantiation before the fork (which you've discarded) or that you're not forking from the same block and hence some contract's are not there also, did you check the forkUrl is getting loaded correctly? https://pastebin.com/jux1ScnH That's the trace if that helps https://pastebin.com/HqNcjygL And the test can't see anything ovious, but I'd suggest a couple of things 1) use import ""forge-std/Test.sol""; and extend from Test instead of DSTest, that'll give you the console, the VM, and a bunch of other goodies 2) Check that DiamondTest is not doing something funny, as your test fails on a contract instantiated by it it may be that DiamondTest is instantiating stuff before the fork thnx I see what the issue is. Even after calling vm.chainId(1); the test don't seem to be honoring that... I think I found a bug. If you call vm.selectFork() and call vm.chainId() if you call vm.startPrank() after, the chain id does not persist.",365
1234,foundry-support.txt,"what's up with No matching declaration found after argument-dependent lookup.? trying to assert equality between two enums seems like foundry scripts is calling estimateGas with gas limit already set resulting in errors like “gas required exceeds allowance ()"" could you please open an issue for this this is likely because thinks there's type ambiguity in your arguments and doesn't know what function to use, maybe string/bytes? does scripts use revm gas limit in estimating broadcast txs gas? because it seems like it is providing gas limit in estimation rpc call Will do https://github.com/foundry-rs/foundry/issues/3190 might be a silly q but why am i seeing (code: -32000, message: failed to apply transaction: {txHash} err: intrinsic gas too low: have 0, want 21064, data: None) for cast access-list ? i wouldn't think it would need me to manually set a gas limit in the cmd so am assuming i must be doing something wrong Compiler run failed YulException: Cannot swap Variable expr_5 with Slot RET[abi_encode_uint256]: too deep in the stack by 1 slots in [ RET expr_5 expr_37393_address expr_4 expr_37407_address expr_4 expr_37393_functionSelector expr_37393_address expr_37393_functionSelector expr_37401_functionSelector expr_37407_functionSelector var_time expr_37391_address expr_4 var_time expr_4 expr_37391_address TMP[iszero, 0] RET[abi_encode_uint256] ] memoryguard was present. viaIR too deep in the stack despite a severe reduction on variables, is there a reason for this? am I simply not using too many variables? Interesting. Is this message complete? Wondering if assembly (""memory-safe"") { ...",373
1235,foundry-support.txt,"} was present in all assembly blocks (including imported code) yep! its complete [profile.default] src = 'src' out = 'out' libs = ['lib'] solc_version = ""0.8.15"" verbosity = 2 # Show logs by default gas_reports = [""*""] viaIR = true optimizer = true optimizer_runs = 2 [profile.default.optimizer_details] constantOptimizer = true yul = true [profile.default.optimizer_details.yulDetails] stackAllocation = true optimizerSteps = """" current foundry.toml are you using assembly blocks, either in your or imported code? not sure Leo how could I check? I need to check why it said that memoryguard was present just check for assembly { ... } in Solidity files oh sorry! yes do use it on two files, factory contracts something that did help now was removing a uint256 I was declaring, tests now run, but just want to understand what to do to prevent that from happening again are the assembly blocks just assembly { ... } or assembly (""memory-safe"") { ... }? just assembly ah right can you change them to assembly (""memory-safe"") ... I mean, in case they are memory safe lol jsure changed! it runs and I'll let you know if I get the error again hey how is it going? im having trouble with solidity scripting. i copied the exact same example from the docs and i'm getting this on build Member ""startBroadcast"" not found or not visible after argument-dependent lookup in contract Vm. That highlighted error is because of Error Lens Vs code extension ? solhint, but I'm just ignoring the error this - https://marketplace.visualstudio.com/items?itemName=idrabenia.solidity-solhint ? Hmmmm I'm able to call startBroadcast with an address, but not with a private key as the docs shows Contract Vm.sol has no function startBroadcast that accepts an uint as arg actually, if it says memoryguard is present you shouldn't actually need the explicit memory-safe thing.",412
1236,foundry-support.txt,"Do you have recursive functions? If possible, it would be great if you could open an issue at github.com/ethereum/solidity/issues/ with your code these are the two functions defined on Vm.sol function startBroadcast() external; function startBroadcast(address) external; none accepts a uint256 as arg Run forge update to update your forge-std and it should have it that worked! thanks! do i have to update every time i create a new foundry project? the one im working on was created using the last version of foundry that's why i didn't even consider it If you make a new project with forge init, no. If you want to use new features in an older project, yes. 🙂 i hate to be annoying but i'm having trouble running a script on anvil. again i'm using the docs example but i'm unable to load the priv key. Failed to get environment variable `PRIVATE_KEY` as type `uint256`: a character is not in the range 0-9 how am i supposed to load the private key? i have a .env with PRIVATE_KEY=[private key] the private key was exported from metamask and copied in the .env nevermind.",245
1237,foundry-support.txt,"it requires the private key to be prefixed with 0x could you open an issue for this with how you read this in solidity? looks like hex/int issue metamask does not prefix it with 0x and the docs doesn't specify oh, hmm, ideally both should work, please open an issue 🙏 okok great when I pass --verify and --broadcast to my script, it goes to the end, primts ""Start Contract Verification"", then finishes the process immediately without any verification happening If I follow the docs with this cast abi-encode ""constructor(string,string,uint256,uint256)"" ""ForgeUSD"" ""FUSD"" 18 1000000000000000000000 then I get an error `UnrecognisedToken 0:11 `constructor`` You can use vm.rememberKey To add the privkey to the script That will return you an address And then you can do vm.broadcast(addr) Is this on latest cast? The hacky way to fix would be: replace constructor with ""foo"" And strip the first 4 bytes I think Hi, just did a Foundryup and experiencing 'segmentation fault' on Ubuntu WSL, anyone else experiencing this problem? Okay, had to Foundryup twice, got it working again, regards my cast version is.... 0.2.0 so that looks like the latest, right? Why does the --verify fail on running a script, too? Do I nede to provide an endpoint for it to verify the contracts? I have a faint memory that this was working a couple days ago, too. So it looks like I can't verify my contracts now... run foundryup and try again why? 0.2.0 is the version in the current repo https://github.com/foundry-rs/foundry/blob/master/cast/Cargo.toml#L3 we're not releasing patches, we run on nightly builds version has been 0.2.0 for the past few months i think so there's a new nightly build that is also 0.2.0 yes it's automatically released nightly (daily) hence name Did you figure it out? Gas estimation seems to be still broken, even manually specifying 200 gwei still fails with ""transaction underpriced"" Changing to legacy txs works but weird that gas estimation is still failing months later Also seeing this error.",484
1238,foundry-support.txt,"For me, it seems to be trying to write something to ""/_1/Users..."" which is not allowed by MacOS - wonder if we can change this location to somewhere else? yeah that makes no sense at all Why does foundry have this behaviorr TLDR is forge create simply doesn’t work for arbitrum and optimism foundry has too many features there i said it dont ban me pls i have no where to troll i mean go TX under priced means you got txs stuck in the mempool with higher gas price. How did that happen? It’s a polygon-specific issue I've had the same issue with Mumbai FYI: https://github.com/ava-labs/subnet-evm/pull/238/files 👀 Hey, is there a way to send in an address as paramater to the test contract when run forge test ? (Solved with vm.envAddress) admin ban haram msg No one gives a fuck about bitcoin hashrate contracts pick a better scam at least my guy Holla. Does Foundry have something like npm search website? no Thx anyone has had any luck running forge on optimism? I keep either getting failed to estimate gas on forge script or (code: -32602, message: too many arguments, want at most 1, data: None) but the same tx works in remix nope, but the nearest we have is simply foundry install : https://book.getfoundry.sh/projects/dependencies?highlight=forge%20install#adding-a-dependency just find the repo on github and you can do this right away. It is managed by means of gitmodules. Not exactly the same as package manager, but it might be what you’re looking for I think its flakey on testnet for me. Sometimes it works (but partially, as i usually use script), but most of the time it doesn’t work. On mainnet, it has never worked for me. The workaround is still using the --legacy flag, for both testnet and mainnet. Not sure when would this be fixed.",417
1239,foundry-support.txt,"does this solves it? https://t.me/foundry_support/23405 I’m getting the same error for both optimism and arbitrum, cast send and forge create don’t work either how do you verify a contract that uses import aliases on a blockscout explorer? it seems to screw up when flattening the contract, like: import {a as b} from ""./a.sol""; contract a is b {} will become when flattened import a from ""./a.sol""; contract a is a {} and ofc I'll get identifier already declared I'm told this is not possible by flattening the contracts and that I should use solcInputs and that ""hardhat deploy produces them"", is this something I can do with forge too? forge install https://github.com/OpenZeppelin/openzeppelin-contracts/tree/release-v2.5.0/contracts isn't working for me( oh, check the examples here: https://book.getfoundry.sh/reference/forge/forge-install tried forge install OpenZeppelin/openzeppelin-contracts@v2.5.0 forge install OpenZeppelin/openzeppelin-contracts@58a3368 fatal: empty string is not a valid pathspec. please use . instead if you meant to match all paths ok so I guess I found the compiler input JSON description in out/contract.sol/contract.json at .metadata and after removing the unwanted keys I'm getting this when submitting the thing to a blockscout explorer, any clues? Same 😔 had to use remix to deploy hi folks, have very little detail about what (which contract) creates this issue : 2022-09-14T08:05:45.336760Z ERROR foundry_cli::cmd::forge::script::transaction: Failed to extract constructor args from CREATE data Error: Transaction failed when running the on-chain simulation. Check the trace above for more information. Any ideas ? hey guys! I think I've done all the setup properly, but getting compilation error, when trying to to call vm.rpcUrl Has anyone tried forge test --debug recently? Even on an empty test it hangs and starts eating 50GB memory...",435
1240,foundry-support.txt,"ok it ends up starting the debugger but after quite a while 😅 so I compiled the thing manually using solc with --metadata and --metadata-literal so that the literal content would be in the standard json input, and now I'm getting this when submitting it, great 😂 I'm lost Same issued here, and fixed. 🫡🫡🫡 foundryup -> rm -rf ~/.svm and then forge b again when compiling with forge and having the optimizer on it skips compilation eventhough the prior compilation was without the optimizer on shouldnt it recompile ? hello guys. I have some question about forge test. What's the difference between constructor and setUp in .t.sol? I notice that they two both will run before every test case I thought constructor will run before all once and setUp will run before every test case. But not like this. So they seems to be the same Like in hardhat, there are before which runs before all and beforeEach which runs before each item. Does foundry has before? SetUp runs like beforeEach in .js an example that I think is helpful for me https://github.com/dsam82/unifap-v2/blob/main/src/test/UnifapV2Factory.t.sol thx! Was getting the same just recently. Somehow went away again tho. Try foundryup and forge clean? Used to struggle a lot with polygon/mumbai. Just always use ankr’s rpcs and add —with-gas-price 38gwei and you should be good Is it possible to query eth2 consensus layer data with cast? e.g. cast block doesn't show things like slot or graffiti didn't help.",339
1241,foundry-support.txt,"It's supposed to be fixed here (last line) but it's not https://github.com/foundry-rs/foundry/releases/tag/nightly-c2816ca111beec6a33dd89a592bcae1af69800a8 could you please open an issue for this, ideally with a repro this is only a log, right? this happens when we could not decode the constructor arguments from the CREATE transaction, which is a bit tricky at the moment, if you could share the script contract that would be helpful getting this error when verifying contracts on Mumbai Error: Failed to submit contract verification Context: - Error #0: error decoding response body: expected value at line 1 column 1 - Error #1: expected value at line 1 column 1 that's the artifact, verification requires the standard-json-input for the compiler, I believe running with --build-info should spit that out this looks like an empty response/unexpected response from their API can you try running again with RUST_LOG=forge forge ...",211
1242,foundry-support.txt,"and share the logs in a new issue? the command I ran is: RUST_LOG=forge forge script ./DeployRelayerMumbai.s.sol:MumbaiDeployer --rpc-url $RPC_URL --private-key $PRIVATE_KEY --etherscan-api-key $ETHERSCAN_API_KEY --verify --legacy -vvvv should I post a new issue? The command output does not seem very insightful yes please https://github.com/foundry-rs/foundry/issues/3209 done are there any docs on the forge coverage feature? somehow it show 0% for a most source files would like to understand it a little better ah, makes sense! can u set which RPC to use in Script.sol as well? so i dont have to specifiy it with --rpc-url in the cl Is there a function similar to hardhat's getContract function to get already deployed contracts in foundry? can u pls open an issue sure Am getting some 2022-09-14T17:01:56.669526Z ERROR foundry_cli::cmd::forge::script::transaction: Failed to extract constructor args from CREATE data Since updating some wip https://github.com/foundry-rs/foundry/pull/3208/files can you try foundryup -b master adn see if it’s still occurring? sure still an error, with more details? 2022-09-14T17:12:23.741049Z ERROR foundry_cli::cmd::forge::script::transaction: Failed to extract constructor args from CREATE data constructor=""constructor(address)"" (...) Yeah please open an issue with a repro and we can identify it seems like your PRs were merged. Should I do foundryup and try again? I would like to use DSTestPlus with solidity 0.7.6, for uni related contracts. Is there any compatible version? Can't seem to find any, would appreciate any help. Thanks in advance. bumping this.. wondering if i should open a gh issue yeah pls open issue, i think this might be related to a recent change we made in ethers-rs great done https://github.com/foundry-rs/foundry/issues/3216 Hi! Is there anyway to jump to a specific block while using Anvil (Similar to vm.roll in Forge) ? I only see an option for jumping forward by a given amount of time.",489
1243,foundry-support.txt,"Yeh try with RUST_LOG=forge,etherscan that should print better errors now that’s anvil_reset endpoint From what I read in https://hardhat.org/hardhat-network/docs/guides/forking-other-networks#resetting-the-fork (Which is what the anvil docs linked to for anvil_reset), it seems like this just forks from a new block number? I'm trying to achieve something similar to vm.roll in Forge where I can simulate forward in blocks to able to trigger a specific transaction from an application to a smart contract on-chain and generate an event. Is this something that's possible with anvil_reset. Or I might be misunderstanding something. hey, im still a noob at foundry but trying to do a testnet deploy based on the docs. am i missing something silly? import ""forge-std/Script.sol""; import ""../src/NFT.sol""; contract Deploy is Script {  function run() external {   uint256 deployerPrivateKey = vm.envUint(""PRIVATE_KEY"");   vm.startBroadcast(deployerPrivateKey);   NFT nft = new NFT(""https://example.com/"");   vm.stopBroadcast();  } } then when i run forge script script/NFTBill.s.sol --rpc-url $GOERLI_INFURA_ENDPOINT --broadcast --verify -vvvv i get error[9582]: TypeError: Member ""startBroadcast"" not found or not visible after argument-dependent lookup in contract Vm. im sure its something simple im missing? i looked thru the history and saw people editing the vm.sol file but it does indeed contain the broadcast functions i need Does it contain startBroadcast(uint256)? @mojo0x oh no it does not When passing a private key it needs the uint256 parameter Run forge update to get the latest oh nice! thanks No prob! Wen merge? https://twitter.com/msolomon44/status/1564284645214019584 im writing a test to call a f() that is delegatecall from a proxy. Can someone point in the direction of some documentation.",421
1244,foundry-support.txt,"The issue is that the ABI of the proxy does not have that function, only a fallback you want to wrap the proxy address in your contract interface like // deploy the implementation Contract c = new Contract(); // deploy the proxy that dcalls to the contract impl Proxy x = new Proxy(c); // set the proxy to the contract’s interface Contract y = Contract(address(x)); hey guys! help me please. My dev environment is windows and powershell，how to read the variables in .env file? does it not work at the moment? it sources the .env file automatically it works automatically if omit --rpc-url, but i can not read the .env variables in Powershell Terminal just like $RPC_RINKEBY since profanity got busted is casts wallet creation safe lmao Nice. I have the error now. It's an HTML page: I am being blocked by Cloudfare and it is asking me to enable cookies? Hey, is there a way to impersonate account if using anvil fork through web3py? Ya just send the RPC request Hello, is there a way of running just one test file with mainnet state and the rest without it? Would the only way be running 2 different forge test commands or is it somehow possible to do it in one? main = vm.createFork(url) testnet = vm.createFork(url) u can switch between forks by calling vm.selectFork(main) then vm.selectFork(testnet) Didn't realize that. Thanks a ton 👍 Foundry Support how does one config sol files in a project that should not be part of coverage report? Uh ,just wondering is their a script method of deploying to multiple testnets in one deploy script ? Using foundry of course ? Hi, is there any great tutorials in rewriting .js test to foundry test? Foundry tests r all written in solidity , u need to know how to r/w that lang Yes, I understand that one has to figure which parts of the .js test correspond to solidity test structure of foundry. Just needed some examples to get my head around how to translate the test Hello, in my foundry contract test I need to get an array of tuples of all of a contracts external functions. I am wondering what is the best way to do that? In my foundry test I need to get an array of all the function signatures and selectors of a smart contract.",490
1245,foundry-support.txt,"Or another way to say it: how can I decode the abi of a contract in a foundry test? https://book.getfoundry.sh/reference/cast/cast-4byte-decode can I use cast commands within a foundry test? You can use abi.decode(""""something"") or abi.encode(""""something"") within test Yes, thanks. How do I get an array of external function selectors out of a smart contract in a foundry test? That's really my question I use slither print summary for that unless there is a real use case in Foundry test I still need to encounter Is slither print summary something I can use within a foundry test to get all the functions of a smart contract in an array within my test? https://book.getfoundry.sh/config/static-analyzers?highlight=slither#slither Not sure about within your test but slither print summary prints https://github.com/crytic/slither/wiki/Printer-documentation okay, thanks I put console.log(""working""); within a foundry test and then ran my tests with forge test. My tests passed but I saw no ""working"" output. Is that normal? I imported import ""forge-std/console2.sol""; im trying to deploy a contract on polygon mainnet using forge create and im getting this error, is this a gas issue? you need to run forge test -vv (verbosity level) to display logs. Might be -vvv, can't remember and unavailable to check atm Thank you! That works! faced this as well with forge script so i had to add the gas-price flag hope this issue helps https://github.com/foundry-rs/foundry/issues/1703 will turn this into a new error, could you please add the html content to the issue? Why does this revert: string memory data = ""{'abi': 'cool man'}""; bytes memory json = vm.parseJson(data, ""abi""); Why does that revert? I think json requires double quotes string memory data = '{""abi"": ""cool man""}'; bytes memory json = vm.parseJson(data, ""abi""); Still fails use "".abi"" to access the field, it's jq-style syntax Yes, that is it, thanks. It works now.",456
1246,foundry-support.txt,"I am writing tests for a contract that uses sstore2 and the tests are allowing me to write well past the contract size limit (~24kb) Is there a way to enforce contract size limits? has anyone else been having problems deploying proxies since some new update? what problems are you having? you mean merge?)))) no, locally with forge been having issues ever since this message started popping up which someone else noted as well something like ""forge is unable to decode calldata during CREATE"" when using scripting Hi asked this earlier, any resource to help rewrite js test to foundry? ah @mattsse I think this is same issue I saw that I sent you details about yeah haha it was gone at some point, but now even after reinstalling a few times I can't get it to work could you please open an issue and share the output looks like we need to make this a soft err for the time being I'm not sure, but the encoding seems weird when concatenating constructor args I'll open an issue in a bit ty, I'll turn this into an error log instead of aborting until fixed hey, does anybody know if anvil supports websocket connections? the bytes encoding is off? ws://localhost:8545 by default awesome, thanks! nvm just trippin are you able to reproduce the error easily? I haven't got a minimal repro yet but have private repo which will be open source soon where it happens yeah, my setup is a bit bulky as well, can't seem to reproduce in a clean environment hey, is forge coverage considered code complete? seems to miss some lines Hey folks, intermittently when I try forge debug — debug src/contract.sol —sig ""add(uint256, uint256"" 1 2 it tells me Function 'add(uint256, uint256' is not implemented in your script I'm not sure what's causing it or how to fix it? always improving…what is missing? Does your contract.sol have a add function? Also you need to write it as add(uint256,uint256) are you missing a closing parenthesis in your function sig? forge install https://github.com/OpenZeppelin/openzeppelin-contracts.git@release-v2.5.0 This one works Dunno why tags don't Hi, Running forge test with fork-url and getting this error repeatedly: FAIL.",474
1247,foundry-support.txt,"Reason: Failed to get account for 0x00a329c0648769a73afac7f9381e08fb43dbea72: 0x00a329c0648769a73afac7f9381e08fb43dbea72 anyone knows what might be the issue? also getting Failed to create genesis: GetAccount( when trying to run anvil both never happened to me before I just saw this on CI is there a way to test if an env var is set from solidity? I just fixed it there is a problem with infura as it seems i changed my fork to alchemy and it works perfectly possibly the merge messed with them? try vm.envBool('VAR') returns (bool) { // set } catch { // unset } thanks :) Hey, I made a new foundry project and all my imports are saying: not found: File import callback not supported Despite the fact I made them exactly like my last project and they worked, is there anything that is common that I might have gotten wrong? I cant find anything Nothing missing per se, noticing some lines aren't being covered even though there are tests for them. Can try to reproduce and open an issue if it persists 👍 how can i set forge testing to use my local anvil testnet node? Hi foundry fam, Can I mock internal contract calls? contract HowManyClowns { function getClownWorld() public view returns(uint) {  return _thisClowns(); } function _thisClowns() internal pure returns(uint) {  return 10; } } For example such that _thisClowns() returns a different number when getClownWorld() is called? vm.mockCall() did not work. or maybe I am doing something wrong 🤡 forge test --rpc-url http://127.0.0.1:8545 -vvv no, you can't would be a cool feature 👀, I am in need of it :( would probably be very tricky due to how internal calls are handled. You could probably make that internal call return data from some address that you set up a mockCall for, but I think there are probably better ways to test that.",451
1248,foundry-support.txt,"Internal calls have always been a pain @onbjerg do we have any better handle on them now that coverage has progressed? probably not? For reference: I tried making _thisClowns() public , though still does not work when called internally as you guys mention. Which I think perhaps documentation should clarify that vm.mockCall() only mocks when called externally. all repos i install with forge install and then forge remappings > remappings.txt work as expected however oz ""contracts"" and ""contracts-upgradeable"" do not get remapped. Any ideas? hi when i try doing forge create NFT --rpc-url=$RPC_URL --private-key=$PRIVATE_KEY --constructor-args ""testcontractname"" ""symbol"" —> it returns this error for my M1 Mac: Solc Error: dyld: Symbol not found: __ZNSt3__113basic_filebufIcNS_11char_traitsIcEEEC1Ev is there any solution for this it sounds like a contract compilation error Hi team, I have a question: The same contract . On-chain gas used: 314,777 But foundry Local test: 282,215 On-chain execution is 11% more than local I've noticed a few times that foundry gas reportings were cheaper than on-chain I am not getting more gas by increasing the value here mockOperator.fulfillOracleRequest2{gas:10000000}(..) how do I provide more gas to the function call? got it.",301
1249,foundry-support.txt,"There is an issue open on this: https://github.com/foundry-rs/foundry/issues/2627 is vm.roll(10) equivalent to mining 10 blocks or just simply changing the block.number? is there a way to mine a set number of blocks from the solidity testing environment if vm.roll isn't the right way to do that? Folks, how to compile 0.5.17 and forge-std in foundry? forge-std supports >=0.6.0 <0.9.0 hmm I wonder if this is related to z3 linking could you try after brew install z3 cause hardhat enables us to create configurations for different sol, but I can't see the same for foundry could you check your remappings, this probably happens if solc isnt't able to find imports feel free to open an issue for this Can you explain how you managed to fix this? I have a similar issue The path ""artifacts/Vault.json"" is not allowed to be accessed for read operations.] What's the cheatcode way to replace a contract at a specific address or somehow intercept an external call? Is it vm.etch() ? @brockelmore quick question on the stdstorage utility, can it be used to find the slot of a specific struct field in a mapping of uint -> struct hmm vm.etch() seems to just return the code when any function is invoked..",288
1250,foundry-support.txt,"is there a forge script or utility that can do evm_mine like what hardhat let's you do via hre: https://hardhat.org/hardhat-network/docs/reference#hardhat_mine i have a test that needs custom mining and execute transacations after N number of blocks cheatcode roll sets the block number unfortunately, just changing the block number isn't enough use vm.roll cheatcode is that equivalent to evm_mine? in my example it also took other calculations into account and confirmed previous blocks… what exactly is the issue then on your side  // move block.number forward by a given number of blocks  function mineBlocks(uint256 numBlocks) external {   uint256 targetBlock = block.number + numBlocks;   vm.roll(targetBlock);  } not sure, we can check how it looks under the hood hmm i was getting unexpected errors when I did that in my solidity test compared to hardhat ts tests also, if i'm running a local anvil node, i don't see the blocks progressing in the non-auto mode so i'm not yet sure vm.roll == evm_mine, unless there's another way i can confirm? havent played that much with anvil… to see the difference. docs: Mining modes refer to how frequent blocks are mined using Anvil. By default, it automatically generates a new block as soon as a transaction is submitted. You can change this setting to interval mining if you will, which means that a new block will be generated in a given period of time selected by the user. If you want to go for this type of mining, you can do it by adding the --block-time <block-time-in-seconds> flag, like in the following example. # Produces a new block every 10 seconds anvil --block-time 10 based from here: https://book.getfoundry.sh/reference/anvil/… where you also have prefixed methods. to be aligned with HH e.g. anvil_mine Mines a series of blocks https://book.getfoundry.sh/reference/anvil/#custom-methods for fmt foundry.toml settings, is it possible to prefer no curly braces when a single command is executed e.g. after an if statement? also, getting this after most recent foundryup % forge build [⠊] Compiling...",473
1251,foundry-support.txt,"[⠒] installing solc version ""0.8.15"" [⠰] Successfully installed solc 0.8.15 Error: Solc Error: can you try again after nuking ~/.svm solved it, thanks, will remember to do that in future hey dumb question how do I update to the newest version of foundry, foundryup is saying its an unrecognized command, what folder should my terminal be in? soon https://github.com/foundry-rs/foundry/pull/3234 hey yall is it possible to fork a block after starting anvil and running a few transactions with cast? didnt want to do anvil_reset in case it removed all my previous txns. Just wondering if it were possible so i dont have to completely restart my workflow lol. Thanks Hi Dump newbie question about console.log. Documentation: // import it indirectly via Test.sol import ""forge-std/Test.sol""; // or directly import it import ""forge-std/console2.sol""; ... console2.log(someValue); Reality import ""forge-std/Test.sol""; import ""forge-std/console2.sol""; import ""forge-std/console.sol""; ... console2.log(X); console.log(X); I see TypeError: Member ""log"" not found or not visible after argument-dependent lookup in type(library console It is not just editor but forge build also produces the same error. All log function in console.log and console2.log are internal function and aren't visible in my test How does one use console.log properly ? What am I missing ? have to use the specific console log functions based on the variable type. E.g console.logUint, logAddress etc Ok got it. I put the wrong type of parameter in. Thanks yes, use the depth flag i believe there is a specific example in tests https://github.com/foundry-rs/forge-std/blob/f36dab24d63d1c1945a05ed375ce341d3c1a49ed/src/test/StdStorage.t.sol#L73 More newbie question: Is there a way to print out event emitted by test without using -vvvv ( too much details. I just need to see event emit) I notice that doing log_array from StdLogs does print the event to console under -vv However, when I define my own custom event and emit it from the test.",486
1252,foundry-support.txt,"It is not printed out under -vv I moved to foundry from brownie. When I deploy non-urgent contract, I write a deployment script that checks gas price every 15 seconds and only kick off the contract deployment call when prevailing gas price gets below my desired threshol (ie 10 gwei). How do I replicate this using foundry script ? Questions: 1. how do I get the current gasPrice from provider inside the script. 2. Is it even possible to sleep in solidity script ? 3. Will my infinite for loop run out of gas limit ( whatever that is for a script run ) before the contract gest deployed ? Events are logged, use this guide to emit them within your functions https://book.getfoundry.sh/reference/ds-test?highlight=log_named_decimal_uint#logging example: emit log_named_decimal_uint(""USDT Balance:"", USDT.balanceOf(address(this)), 6); will give you Dai balance of this address to 6 decimals So only event defined in Std log shows up without -vvvv but not the custom event I define in the test ? What happens if I need to log custom struct ? ( neither console.log nor std logs support my struct as argument ) Is printing the full trace -vvvv the only way ? If you define custom event you do not need to run verbosity trace, your events will show as logs in your terminal Hmm. This is not what I observe. Not in front of my laptop. I will exhibit some screenshot in 30 minutes. forge test --contracts ./src/test/test.sol -vv Thats what I get with: emit log_named_decimal_uint(""USDC Balance:"", USDC.balanceOf(address(this)), 6); emit log_named_decimal_uint(""WBTC Balance:"", WBTC.balanceOf(address(this)), 6); emit log_named_decimal_uint(""DAI Balance:"", DAI.balanceOf(address(this)), 6); emit log_named_decimal_uint(""USDT Balance:"", USDT.balanceOf(address(this)), 6); @Sentient_X This is what I was talking about. only stuff defined in Std logs like log_array logs to the console. I have my own custom struct. which can't use console.log and emit event also doesn't output to the console.",455
1253,foundry-support.txt,"Hello👋 I'm trying to cast an interface from aave contracts on polygon, here is the command I use: ""cast interface 0xDF9e4ABdbd94107932265319479643D3B05809dc -c polygon"" I also tried copying the interface from polygonscan to a json, but it doesn't work either (the error is different though) https://polygonscan.com/address/0xdf9e4abdbd94107932265319479643d3b05809dc#code And here is the error I get, I don't understand what is the problem, I thought it might a problem with the ABI encoder version maybe🤔 Hi, I'm getting an issue with foundry on ci . it doesn't found some file when compiling . Error: Compiler run failed error[6275]: ParserError: Source ""contracts/src/landNFT.sol"" not found: File not found. Searched the following locations: ""/home/runner/work/bastion/bastion"". --> contracts/src/test/LandBank.t.sol:6:1: | 6 | import ""../landNFT.sol""; | ^^^^^^^^^^^^^^^^^^^^^^^^ I'm locally able to compile successfully. to the foundry devs , If for example I want to generate command completions for a shell that is not currently supported by foundry , How would i do that ? I want to create a the command completions , for nushell , but it has to be done manually , any advice in this regard is much appreciated , if I figure it out , i will put a PR for that i saw that SharedBackend is no longer passed into the executor for revm, does this mean the requests are no longer being batched for multiple backends? It's part of clap: https://docs.rs/clap_complete/3.2.5/clap_complete/shells/index.html doesn't seem to have a nushell variant yet hey guys. in my tests, i have a *assertApproxEqAbs* assertion, with a delta of *1000000000000*. my tests fail with a delta of *1000000000002*, when i increase the delta to *1000000000002*, the tests fail with *1000000000003* delta. same when i add a *0* to the ok delta.....",487
1254,foundry-support.txt,"what's going on here? oh i see, I will make a mention of that on their cord docs are probably helpful: https://github.com/foundry-rs/foundry/blob/master/evm/src/executor/backend/mod.rs#L299 see also: https://github.com/foundry-rs/foundry/blob/master/evm/src/executor/fork/multi.rs#L66 thanks ser hmm that's weird, could be an issue with cwd It'd try to debug this by logging forge config in CI and check it's what you expect Thanks will try anyone? ill try to rephrase the Q. i have an approximate assertion (assertApproxEqAbs), with some allowed delta. it constantly fails with 1 point above the allowed delta. for example, when the allowed delta is 9000000000000, it fails with 9000000000001 delta, when allowed delta is 9000000000001, it fails with 9000000000002 delta etc. when i set a significantly larger allowed delta, like 10000000000000 (replace 9 with 10), i get 10000000000001 delta etc. when i set a significantly smaller allowed delta, like 1000, i get 1001 delta..... anyone has an idea? super strange and frustrating oh great thanks🫡 hard to say without additional context, feel free to open an issue with a repro while using forge scripts estimations are getting made with gas limits already set leading to failed estimations.",312
1255,foundry-support.txt,"has anyone found a solution? any idea why this isn't working? I tried w/o user[msg.sender].eth += msg.value; and that was the issue but i dont understand why i delt bidder0 100eth too can anvil be set to forward transactions to fork rpc? Can someone try the command to see if it works for you? Promise it is not a way to enter the mainframe sorry what’s the error? wdym? can u repro? I'm trying to cast an interface but it's giving ""error occured when formatting an argument"" More details in this message https://t.me/foundry_support/23987 How do I change the following js line to foundry test? expect(await router.gov()).eq(wallet.address)? This is the function I am testing: function setGov(address _gov) external onlyGov { gov = _gov; I can do this in hardhat easily but cant seem to replicate same test in Foundry prank the gov address then assert the addresses are equal vm.prank(newGov); router.setGov(newGov); assertEq(router.gov(), newGov); Thanks, tried this but there has to be another way to get gov = msg.sender, because the above reverts hey i got the same error. my CI was working last week lol 😂 did you figure out? i logged forge config in the CI and it's the same as my local i checked and my CI last week wans running on solc 0.8.16 and it's now running on 0.8.17. wonder if that affected it. Would be great if anyone can share how to resolve this 🙂 i realized recently when working on two projects, one a forge depency of the other, that the remappings of the top project will override the remappings of the bottom project.",368
1256,foundry-support.txt,"are there any work arounds if i _dont_ want this to happen ? anyone know why this fails? i guess its a foundry issue Is there a way to change this debugger layout to the one shown in the docs https://book.getfoundry.sh/forge/debugger?highlight=debug#debugger-layout (the quadrant format)? Are there any known issues with vm.startPrank? what is the reason for this, could any foundry team number hlep me to solve this ? Solved it, was testing against a live state of the network and had to find the gov set at deployment, thanks @mnsky666 @phazze the gas reporting doesn't take into account the static base cost of a transaction (21000 gas) and the dynamic cost of the calldata (4 gas per zero byte, 16 gas per non-zero byte) What’s the reason for not including the dynamic calldata cost? gas report is meant to be a breakdown of each function’s gas usage. that’s useful for identifying costly function while retaining no context to it’s actual execution since that would introduce only more variability Just had a similar issue with ""Nothing to compile"" when using forge bind. I'm trying to generate bindings from lib/* contracts only. To solve I needed to have at least 1 sol file in src/. directory. Same issue whether or not I specify the root/out flags. Should this be raised as a bug? Also the bindings creates an rs file stub for the empty sol file too. how can i run a deployment script on my local blockchain? any resources somewhere? https://book.getfoundry.sh/tutorials/solidity-scripting yeah just saw it, was about to delete the massage. ty sir Hey! I am quite new to foundry and I have been looking for the answer for 2-3 days, but it is hard to figure it out.So I am working level0 of this CTF(https://ethernaut.openzeppelin.com/) Here we deployed the smart contract on rinkeby network. Here is my smart contract link (https://rinkeby.etherscan.io/address/0x5Af42E896748814C2553c35215b9BaF7eA2A84fb) and trying to solve this challenge here. I want to pass the password to authenticate function.",478
1257,foundry-support.txt,"So I am following this article (https://blog.dixitaditya.com/getting-started-with-ethernaut-hello-ethernaut) here to write this command. Instance level0 = Instance(0x879A7D9b82862eba53B2B5294CADd808630060B4); Where in the blog, he saves the smart contract in a file which contains the Instance function. As far as I understand in the above line, we are creating a level0 variable of smartcontract type,but why does he send the address of the deployed smart contract as an argument? Also, can we create a variable of smartcontract type without saving the smart contract locally?Like creata a variable of smart contract type that is already deployed over the chain? i run Anvil on a docker container, made sure port 8545 is mapped to host's 8545 port. i succssfully ping it, but cant run any cast commands against it. they return the following error: """""" Error: error sending request for url (http://localhost:8545/): error trying to connect: tcp connect error: Cannot assign requested address (os error 99) Context: - Error #0: error trying to connect: tcp connect error: Cannot assign requested address (os error 99) - Error #1: tcp connect error: Cannot assign requested address (os error 99) - Error #2: Cannot assign requested address (os error 99) """""" any idea? Have you tried --host 0.0.0.0 flag doesnt work as well. spin up Anvil with ""—host 0.0.0.0"", then execute ""cast chain-id --rpc-url localhost:8545"" or instead of locahost use 0.0.0.0/container_name, non of them works share your docker command its a docker compose file. see attached i then enter the ""deployer"" container manually with ""docker exec -it deployer bash"", then execute ""cast chain-id --rpc-url localhost:8545"" im on windows btw.",429
1258,foundry-support.txt,"ideally ill be able to call the rpc endpoint directly between the containers, without transferring the call via localhost Just tested and I thinkn it's because of your $MAINNET_RPC_URL env Try this version: ""3.7"" services: anvil:  image: ghcr.io/foundry-rs/foundry  restart: unless-stopped  ports:  - 8545:8545  command: [""anvil --host 0.0.0.0 --fork-url https://eth-mainnet.g.alchemy.com/v2/<yourkey> --chain-id 1 --hardfork latest""] how should i execute the call from the ""deployer"" container? ""cast chain-id --rpc-url 0.0.0.0:8545"" ? modified my compose to match yours, executing like the above, getting same error cast block latest to test use —rpc-url localhost:8545 from your local running it from another container that has Foundry installed. tried cast block latest --rpc-url localhost:8545 or cast block latest --rpc-url anvil:8545, both dont work i cant run it from localhost.. Your anvil container is called contracts so try contracts:8545 yeah changed the name to anvil.. This works for me. So start from here and work through it. Potentially you may have a port conflict. ok will give another try. ty sir It doesn’t seem to be the compiler version I use 0.8.15 well, the error i get when executing cast block latest —rpc-url anvil:8545 says that it's a bug (?) The application panicked (crashed). Message: called `Result::unwrap()` on an `Err` value: Invalid provider url Context: - Error #0: builder error for url (anvil:8545): URL scheme is not allowed - Error #1: URL scheme is not allowed Location: /home/runner/work/foundry/foundry/common/src/provider.rs:31 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets.",461
1259,foundry-support.txt,"Aborted Says invalid url try with http:// - does it work from localhost? that's the one!!! awesome, ty very much sir! (it works) That makes sense, but it’s a bit odd without knowing about it. I needed to know the exact gas usage for a function and it wasn’t matching up on mainnet. Is there a way to turn it on? i import import ""forge-std/Script.sol""; and inherit Script, but getting Member ""startBroadcast"" not found or not visible after argument-dependent lookup in contract Vm. any idea? what argument are you passing to startBroadcast? the private key i get from uint256 deployerPrivateKey = vm.envUint(""PRIVATE_KEY""); maybe you havent updated your forge-std forge update lib/forge-std yeah it worked. was sure foundryup updates this stuff too. ty very much sir gg nice 🙂 Oh okay. Did you fix it? can vm.startPrank() simulate a smart contract or only EOAs? specifically, trying to mock calls from a multisig.",215
1260,foundry-support.txt,"it can, any address I am trying to run a script on a mainnet fork, but startBroadcast fails with ""Invalid data"", this is pretty much all the code in the run-function (private key is from the default memo): uint256 deployerPrivateKey = uint256(0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80); vm.startBroadcast(deployerPrivateKey); vm.stopBroadcast(); any ideas on what is going wrong? the only commands run in 2 separate terminals: anvil --fork-url $RPC_url --fork-block-number $BLOCK_NUMBER forge script script/CLJUpgraderTrial.s.sol:Deployment --fork-url http://localhost:8545 --broadcast -vvvv on a Windows device, if that is relevant no, there are still many edge cases, unsure if we will ever be able to really get something satisfactory just updated foundry, seems like it solved the problem (maybe it was just the IDE restart too) Is there a cheatcode to expect a failing assertion such as an overflow? vm.expectRevert() seems to not catch that This should help: https://book.getfoundry.sh/reference/forge-std/arithmeticError Perfect, thank you No prob :) Hi everyone, I get ""Failed to create wallet from private key: Odd number of digits"" when running the deploy command as follows(while anvil is started): forge script script/Contract.s.sol:ContractScript --fork-url http://localhost:8545 --private-key $PRIVATE_KEY --broadcast PRIVATE_KEY is set in the .env file as follows: PRIVATE_KEY=""0xdbda.."" Context: forge 0.2.0 (084ef3d 2022-09-19T00:07:01.878472846Z) anvil 0.1.0 (084ef3d 2022-09-19T00:07:01.943373921Z) https://github.com/foundry-rs/foundry/issues/2978 change PRIVATE_KEY to $PRIVATE_KEY Got it wrong in the message which is now updated. The problems remains have you tried sourcing your .env file? Yes I did and could you pls run cast wallet address --private-key $PRIVATE_KEY to ensure that the private key is correct? I got a correct address.",491
1261,foundry-support.txt,I think I was missing $ next to PRIVATE_KEY.,11
1262,foundry-support.txt,"maybe we can add this to the docs if others want this feature as well. if set to single that would become if (condition) do(); im not seeing that behavior. it it's already single line it will keep it, but it won't switch a multi-block to a single-block even if it fits maybe i have the config option wrong added single_line_statement_blocks = ""single"" to my foundry.toml under [fmt] having dinner, then will check and report back 🫡 seems like the issue is i am actually stuck on the default preserve it is working with forge fmt but my vscode is not doing it on save oh wonder if forge fmt from vscode is not loading the foundry toml? that must be it not respecting my tab width settings either when i change from default @zeframl https://twitter.com/boredGenius/status/1571931825437814786 they havent been working? hmm integration tests for etherscan pass…for which network are they not working? is it some specific contract? and i thought we forced —slow for optimism/arbitrum so that they work. did you try recently? assuming this is the extension you're using, it'll respect the toml after this PR is merged/released https://github.com/juanfranblanco/vscode-solidity/pull/363 awesome, just what i need. thank you Very nice. Will try it out. is there a way to set the priority fee when using Foundry scripts? ok, found it (there is: --priority-gas-price) this is the script i’m using rn, adding —skip-simulation fixes the gas estimation issue for arbitrum & optimism though simulation is still breaking. verification doesn’t work as well, i tried using verify-contract directly and it didn’t work either if there’s a minimal working example of verification available that would be great lol wait, there's a --skip-simulation? Can you share the actual script @zeframl? A lot of people have been deploying to both with no issue.",419
1263,foundry-support.txt,"Are you on latest foundryup? Is there a way to get cast call to show a trace like cast run? Uh if you remove skip-simulation in the script I linked then foundry returns a gas entimation error, and yes I’m using the latest version of foundry like simulate a transaction? yeah https://github.com/ZeframLou/bunni/blob/1fa099e87913e86285c8fe9c2b4c89079f60e4f2/deploy/common.sh#L5 This is another script that uses forge create https://github.com/timeless-fi/xPYT/blob/86817e585ff1bdaf1df99c78ecbdbabb4c5b0cba/deploy/common.sh#L8 I built it with z3 statically linked. So I am not sure how they are facing this error. Are others facing this too? not yet, open issue for it here https://github.com/foundry-rs/foundry/issues/3038 cool, thank you! I'm using Foundry with Hardhat and for some reason hardhat doesn't recognize the cache (it creates and caches in the folder when running hardhat compile, but next compile doesn't recognize it so it compiles again). Couldn't find a lot of clues online - anyone have clues? thank you change your cache dir to cache_hardhat in hardhat config I have this setup, although problem still persists Solved. The ""preprocess"" script that I copy pasted from the foundry book was missing the cache. I had to add the line {setting: {comment: true}} and cache worked. Perhaps the script in the book can be updated? what’s that setting about? https://www.npmjs.com/package/hardhat-preprocessor it says that the settings object just has to be there. actually it can be an empty object and cache works.",390
1264,foundry-support.txt,"without the field it doesn't ah i see ok didnt knkow about the settings! does anyone know how i can simulate an entire test so tx.origin is from the EOA i’m trying to prank? need some help as some functions im calling in tests require tx.origin to be an EOA ( require(tx.origin == msg.sender)) Maybe try specifying the sender as a param?   --sender <ADDRESS>    The address which will be executing tests  forge script script/Sender.s.sol -f $ETH_RPC_URL -vvvv --sender 0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee [⠰] Compiling... No files changed, compilation skipped Traces: [26671] Sender::run()  ├─ emit log_named_address(key: msg.sender, val: 0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE)  ├─ emit log_named_address(key: tx.origin, val: 0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE)  └─ ← () Script ran successfully. == Logs == msg.sender: 0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee tx.origin: 0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee ahhh makes sense, thanks isn't this just startPrank(eoa, eoa);? didn’t know prank took 2 args it takes just one to prank as msg.sender, you can add the second arg for tx.origin oh nice is there some way of installing a specific folder in a repo as a submodule? for example I just want to install the contracts folder in ethereum-optimism/optimism: https://github.com/ethereum-optimism/optimism/tree/develop/packages/contracts (rather than install the entire repo) Is your need for this out of a remapping issue or local code size ? Or a third, more complex thing ? local code size I'd rather not have the entire optimism monorepo as a submodule how do I decode an event log using cast? Hi ,guy , How can I send a signed transaction in script.sol ? Im trying ffi I am trying to do some simulation with anvil and forge/cheatcode. I fork the chain at specific block height and would like to simulate my custom logic after apply some transaction that happened historically ( ie: oracle update).",497
1265,foundry-support.txt,"I couldn't figure out how to apply historical txn in a black-box approach ( ie: don't need to know its internal and just copy calldata from etherscan) Example txn: I have tried copy the calldata as byte literal. But getting Type int_const 5556...(1506 digits omitted)...7234 is not implicitly convertible to expected type bytes memory. Am I going crazy or is there a way to look at the storage slot layout with forge somehow? Using forge inspect storage-layout https://book.getfoundry.sh/reference/forge/forge-inspect?highlight=storage-layout#forge-inspect does every tx have the base cost 21000gas？ for general tx the gas used foundry count add 21000 is near the real cost？ ths Ah many thanks! is it known that there are still issues with decoding constructor arguments? I'm getting a lot of those errors, I can try to track down a simple repro if it's news. Hello there, Would like to know if some people know how to add source code using forge script when you call external contracts? Cause i got Unknow Contracts but i got the source.. Hey guys, couldn't find this info, but is it possible to show some info during fuzz runs? I've tried -vvvv but it only shows info after the runs have completed. for example, print what run it's on as it's being executed if you make it fail, or you can call your fuzz test in another test with specific parameters as a normal test. getting the following error: error[6275]: ParserError: Source ""ds-test/test.sol"" not found: File not found. any idea? ran foundryup and forge update forge install solved Hello can someone check if the command work for themselves please? I don't understand why it won't work Trying to use the interactive debugger. Seeing a lot of these I have included etherscan apikey in .toml file.",394
1266,foundry-support.txt,"[etherscan] mainnet = { key = ""${API_KEY}"" } Is there something that i am doing wrong ? Also is there a way to set debugger & pause at a particular line in test/ contract / @gakonst I can confirm I still get failed to estimate gas on both optimism and arbitrum even after foundryup —version nightly gm kings Is there a way to reset a forked chain state in the middle of an integration test? I'd like to make an external call, save some values as a result of that call to a variable, then reset the chain, make a similar call, and then compare the values against the previous call. The chain resets between tests but I'd like to somehow persist the data between the tests for comparison. 2 Global vars outside the tests and each test saves to the respective var? Yeah I could probably make that work as long as I can control the test ordering. how are you guys generating the abis? from a foundry deploy they’re all in your out/ dir no? yes, they are there! thanks, was asking because I remember that hardhat deploy plugin had some configurations that allow you to append the network address to the json file and divide it by network even, compile all files in a single contracts.json for FE usage Hey all, potential n00b question, I am having difficulties with the prank command, I am running vs. anvil on a mainnet fork: my test case looks like this: function testPrank() public { console.log(""Start Address"", msg.sender); vm.prank(0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266); console.log(""Pranked Address"", msg.sender); I would expect the second address to be different to the first console.log but this is the output I get: [PASS] testPrank() (gas: 6878) Logs: Start Address 0x00a329c0648769A73afAc7F9381E08FB43dBEA72 Pranked Address 0x00a329c0648769A73afAc7F9381E08FB43dBEA72 i.e.",456
1267,foundry-support.txt,"the prank doesnt seem to have an affect at all, what am I missing? Thanks msg.sender in this context is essentially the test executor the prank would apply to the next call you make if you wanna console log it, you can define a dummy contract with a test func & log and call it after prank hey. getting this weird error when trying to run my deployment script: Contract `/FortressCompounder/src/lp-compounders/FortressCurveCRVCompounder.sol:FortressCurveCRVCompounder` has unlinked bytecode. Please check all libraries settings. the strangest part is, when i run the exact thing again (after the failure), it works as expected. any idea? are you using a library with a public fn? When I use the deployCode cheatcode I get the error UniswapV2Factory.json"" is not allowed to be accessed for read operations. Can you the fs_permissions Config in foundry toml Should we by default allow the artifacts directory to be read? @mattsse Or the cwd https://book.getfoundry.sh/cheatcodes/get-code?highlight=Fs_#description I think there's an argument to be made to allow at least reading from the project dir by default also I'll update the error message so it contains more helpful pointers adding this config still doesn't fix the error nvm I was able to get it Thank you If you could add the same not you have on the getCode description to the deployCode description that would be helpful I'm having a little trouble with verifying a few contracts on Goerli. I'm seeing this message when I run forge script: > We haven't found any matching bytecode for the following contracts: [0xb26c4bf5c0179a78b459c4dd411f2f880d197b02]. This may occur when resuming a verification, but the underlying source code or compiler version has changed. I get this message when I run forge script [script] --rpc-url $GOERLI_RPC_URL --broadcast --verify. Everything works except the verification part Is there a way to enable unlimited contract size in Anvil? COuldn't find docs for this. Thanks! I’m seeing an innterseting thing where when I convert bytes memory response to a string useing string(response), the resulting string has a prefixed empty space.",483
1268,foundry-support.txt,"Is there a better way to cast bytes to a string? fixed it abi.decode(response, (string)) Hi, Why do I have to wait a long time to see the results when I run the script? I need you help,thanks. forge 0.2.0 (56dc746 2022-08-26T00:07:43.474069Z) anvil 0.1.0 (56dc746 2022-08-26T00:07:43.711152Z) Separate question, is there a way to tell compiler to compile different contract with different optimization params within the same forge build run ? The usecase is that I have a set of contract that I would like to compile and deploy together. Within this set, some contract is for simulation only ( so I would like to set optimizaion-run to 1 and minize the contract deployment cost ). Other contracts is for actual execution ( so I will set optimization-run to large number and minimize execution gas cost ). https://github.com/foundry-rs/foundry/issues/3294 Has anyone experienced a slow-down in Anvil deployment? I found that after deploying some contracts (~30-40), the subsequent deployments are slowed down significantly Hej, does someone know an equivalent to ""ethers.utils.parseEther"" with forge-std ? or even better ""ethers.utils.parseUnits"" Multiply by 1e9 etc yes ok Thank you for the (awesome) tool btw :) when i use fork cheatcode, i got this error [FAIL.",318
1269,foundry-support.txt,"I was able to get around the problem by running forge flatten and deploying the flattened contracts directly. I also tried messing around with the imports but didn't have any luck with that. rustup update Update your foundryup Got it - can you open an issue with a. Repro for the contract that was not verified? Maybe our bytecode matching logic isn't right I don't think we do. We should allow running a debug script/test that takes arguments by providing your own CLI args, similar to how forge script works when the function takes arguments wish etherscan had a way to verify contracts as easy as sourcify Forge is not updating the abi on forge build I tried running forge clean also But the abi is not updating It's also compiling contracts even if they should throw error Definitely some bug pls provide some more info on how this is happening ^^ is it on lataest? ya its on latest https://loom.com/share/896ceaca1c004ad28b8177b5b27258a3 Check the video I commented the code but it compiled anyway Not sure, I’d recommend opening a minimal repro. Nothing changed in building and we have integration tests for it, so we really need a repro to identify/fix if there’s soemthing wrong Hello Sers, is there a way to turn on verbosity / echo for forge install? Want to repro an issue run with RUST_LOG=forge,foundry_cli which gives you all the logs Hi, is there a way to simulate a deployment script on a mainnet fork? Does it only takes to add at the beginning of the run() function these 2 lines:   _ethereum = vm.createFork(vm.envString(""ETH_NODE_URI_MAINNET""), XXXXXX);   vm.selectFork(_ethereum); I am aware you can deploy locally (https://book.getfoundry.sh/tutorials/solidity-scripting#deploying-locally), but I want to in the same setup as I will be when deploying on mainnet.",408
1270,foundry-support.txt,"Thanks Thanks You can declare the script as ""address constant nameofscript = address;"" or as ""address nameofscript = address"" example ""address constant alice = 0xaC650E37df74899dDa0CA0AaC65cAd6768458978;"" under contract ContractTest is Test { When you fork the network, functions of the script are available to be called in your test Is there a way to make cast call produce a trace like cast run does? Oh, there's an issue for it https://github.com/foundry-rs/foundry/issues/3038 Has anyone setup codecov with forge coverage? Actually figured this out by uploading lcov report to codecov with Github Actions after all of the specs pass on CI Not exactly a Foundry question but more of a solidity implementation - is there any good guidance or documentation when dealing with different currencies with different decimal points? What are the best practices? Handle everything in Wei has anyone used the find cheatcode successfully?...need an example Is there a way to test that a contract’s function was *not* called. Like a way to do vm.expectNotCalled? @Timidan_x look at forge-std/src/test/StdStorage.t.sol not currently but there's an open issue https://github.com/foundry-rs/foundry/issues/509 Thanks Hi frens , since this is most hotest group in the solidity & foundry & crypto area I joined here and wants to learn something from you guys https://github.com/nomad-xyz/monorepo/blob/main/packages/contracts-core/contracts/libs/Merkle.sol who knows the hard-coded part of the last section of this codebase standing for ? i.e. the following part : Any ideas why this is failing?? % forge test --debug BuyAB  [⠔] Compiling... No files changed, compilation skipped [⠔] Compiling... No files changed, compilation skipped Error: Invalid hex calldata Context: - Invalid character 'x' at position 1 anyone has any knowledge on why forge fmt --check is acting differently on locla and on CI? running forge fmt --check on local returns no errors, but when im pushing the same code to a repo and the CI is running forge fmt --check, the check fails anyone has ideas on what this error means? EOA nonce changed unexpectedly while sending transactions.",488
1271,foundry-support.txt,"Been getting with forge script with a ledger I've figured it out myself , thanks ! In scripts I'm getting a different tx.origin in the contract constructor vs. in the run function. Is that normal? tx.origin should only be set to your selected account after you run vm.startBroadcast I believe and the one used for constructing the contract is always the same no matter the config/env? I'd guess it's the default account. Why do you need tx.origin in the constructor? can't you put setup scripts in the run()? I could, just easier in constructor when inheritance is involved (don't have to remember to write super.setUp() for instance). For context I'm checking tx.origin to see if the script got a special sender or is using the default (0x00a32... I think). If default, we pick the sender from an env var. So in that specific case I can just set it lazily in a broadcast wrapper, so all good. Hello, I'm running into a weird error I can't manage to fix, I'm trying to implement a Vault deposit function but I when I try to approve the transaction I get this error: [FAIL. Reason: ERC20: transfer amount exceeds allowance] test deposit() (gas: 86770) when testing with foundry, any ideas what the problem could be? I'm attaching the my deposit function and consonle output I need to setup an environment for an integration test and I'm trying to combine anvil with a Forge script. ## Step 1 I run anvil as a fork of my mainnet node: anvil -p 8546 -f <MAINNET_ENDPOINT> ## Step 2 I try to impersonate a specific contract address because it's the only thing that has permissions to execute the contents of the script: cast rpc anvil_impersonateAccount <CALLER_CONTRACT> --rpc-url <ANVIL_ENDPOINT> I get null as a response here. Not sure what it means. ## Step 3 I try to run my script with <CALLER_CONTRACT> as the sender like: forge script MyScript --broadcast --rpc-url <ANVIL_ENDPOINT> --sender <CALLER_CONTRACT> However I'm facing the following error: > Error: > No associated wallet for addresses: {<CALLER_CONTRACT>}.",474
1272,foundry-support.txt,"Unlocked wallets: [] Any ideas on how to get this done? Since I'm using broadcast, apparently I can't use vm.prank(). — I've recently updated Foundry with foundryup foundryup: installed - forge 0.2.0 (3a462eb 2022-09-22T00:05:16.281308046Z) foundryup: installed - cast 0.2.0 (3a462eb 2022-09-22T00:05:16.281308046Z) foundryup: installed - anvil 0.1.0 (3a462eb 2022-09-22T00:05:16.282490645Z) Is there anyone who can give me a quick answer how to mock up block.chainid? @joshiedo do we always require a signer? is it possible to send with eth_sendTransaction here? got it. vm.chainId() atm we always require the right signer So currently is impossible to impersonate another signer in a script using broadcast? Stupid question: Since vm.prank() doesn't work after vm.startBroadcast(), what exactly happens when I have something like this? vm.startBroadcast(); // do stuff... vm.stopBroadcast(); vm.prank(<CALLER_CONTRACT>); <CALLEE_CONTRACT>.doSomethingYouAreNotSupposedTo(...args); The script works, but obviously the changes made after vm.stopBroadcast() are not persisted. Hello there, i have two pairs/pools in uniswap. i want to check if there is any arbitrage opportunity between them. and also to calculate how much to arbitrage? anyone help me with this? ""contract **.sol has unlinked bytecode. Please check all libraries settings"" any ideas? it will work fine for the local execution, but you wont be able to push that transaction to anvil correct, they wont be persisted after you script ends Is there any way to make this work currently? Would I be able to use stdstore to shoehorn a variable in a contract in a persistent way? there is anvil_set_storage_at req anyone plz you can do a forge script --fork-url URL for that, and calculate it inside i want to know how to calculate wrong chat for that formula I mean from within the script.",479
1273,foundry-support.txt,"I'm also trying to use cast rpc anvil_impersonateAccount <CALLER_CONTRACT> and then using cast send ... to make the changes I need, but the impersonation seems to have no effect And if I specify the sender with cast send --from <CALLER_CONTRACT>, it fails with: > (code: -32003, message: Out of gas: required gas exceeds allowance: 0, data: None) is caller_account and caller_contract the same? yes sorry, I mistyped it Not sure if it's relevant, but cast rpc anvil_impersonateAccount outputs null. Exit code is 0 though. Hello there, Still the same issue no one has an idea how to solve this one 😭 is this on latest master? i believe we havent integrated forge debug `and `forge test —debug yet no breakpoints supported can you open an issue with a repro? we havent found out why this happens I just tried this and couldn’t repro after starting Anvil in a separate terminal. ``` $ cast wallet new Successfully created new keypair.",220
1274,foundry-support.txt,"Address: 0xe1f9893Cf0cd893b7139dd68B442C482Cb52BFC2 Private Key: a58b863d11b747939354492c46d7eb0a3a7dd926abaf805e800a214b259cd085 $ cast rpc anvil_impersonateAccount 0xe1f9893Cf0cd893b7139dd68B442C482Cb52BFC2 $ cast send --from 0x15d34aaf54267db7d7c367839aaf71a00a2c6a65 0x15d34aaf54267db7d7c367839aaf71a00a2c6a65 --value=10ether $ cast send --from 0xe1f9893Cf0cd893b7139dd68B442C482Cb52BFC2 0xe1f9893Cf0cd893b7139dd68B442C482Cb52BFC2 --value=0.5ether ``` all worked cast rpc anvil_stopImpersonatingAccount 0xe1f9893Cf0cd893b7139dd68B442C482Cb52BFC2           <<< null ➜ ~ cast send --from 0xe1f9893Cf0cd893b7139dd68B442C482Cb52BFC2 0xe1f9893Cf0cd893b7139dd68B442C482Cb52BFC2 --value=0.5ether Error: (code: -32602, message: No Signer available, data: None) Thanks for digging into it. With an account it works fine for me. I'm trying to impersonate an existing contract. Is this possible Pretty sure you can only impersonate an EOA. stdstore is the what I've always used to change variables is it possible to use stdstore from a forge script? I'm getting the following error: Compiler run failed error[7576]: DeclarationError: Undeclared identifier.",443
1275,foundry-support.txt,"--> src/scripts/DeployRwaRegistry.s.sol:42:5: | 42 |  stdstore |  ^^^^^^^^ My contract extends Script from forge-std/Script.sol this is possible, but you can't interact with the contract while it's impersonated: See not for anvil_impersonateAccount here https://book.getfoundry.sh/reference/anvil/ just foundryup locally, they are probably different versions I am not interacting with the contract in the script though however I don't seem to get this working hard to say without having a repro can you please open an issue? Sure, will do I would do it through a testing contract, not a script yeh tried the same forge init add console.log(vm.envString(""PRIV_KEY"")); to a test echo PRIV_KEY=\""0xabc\"" > .env forge test -vvv I'd need to add a bunch of dependencies to a specific repo I don't control in order to be able to do that. Long story short, I have this big-ish repo A in a queue for auditing, so I cannot deploy it yet. There's another entirely different module B, in an incompatible Solidity version, which touches base with the repo in question through an on-chain contract registry C. What I need is to be able to test module B as if a contract from A is registered in C. However only the <CALLER_CONTRACT> I mentioned is able to update C. So what I'm doing with this script is deploying A in the fork. However I'm struggling with registering A in C. Can you impersonate an authorised user to to then register A in C? I'm guessing doing a local fork of mainnet? there is no authorized user in C, only the <CALLER_CONTRACT> is authorized When I run: cast rpc anvil_impersonateAccount <CALLER_CONTRACT>, I get null as a response. however if I try to run cast send ...",399
1276,foundry-support.txt,"--from <CALLER_CONTRACT>, I get this: Error: (code: -32003, message: Out of gas: required gas exceeds allowance: 0, data: None) Is the repo public? If so you should be able to fork it and add the dependencies thanks, this was the problem this endpoint doesn't return anything, therefor null the error ""message: Out of gas: required gas exceeds allowance: 0"" means that the sender doesn't have any funds, you can set this also with cast rpc anvil_setBalance <addr> ""latest"" Thanks... some progress at least. Now I'm getting a different error: Error: (code: -32603, message: EVM error RejectCallerWithCode, data: None) hmm, this shouldn't happen when impersonated because that temporarily removes the code okay, so the order matters here... I need to call setBalance before impersonateAccount, otherwise it doesn't work thank you very much @mattsse Gm foundrians - I'm trying to write a script for local dev that uses vm.warp or skip to set the block time and then call a function. Noticing that these cheats don't seem to get sent to Anvil when called within vm.startBroadcast(). Is there a correct pattern for this? Is there a setting to enable traces for tx's using Anvil ? --steps-tracing is this a flag when running ""anvil""? doesn't seem to add traces. Do i need to somehow enable verbosity when starting anvil this just enables support for parity/geth style tracing api do you mean traces in forge test or get similar output for a mined transaction? there's cast run <tx> that replays a transaction and displays traces got it, thanks. I meant getting similar output for every mined tx (hardhat does this which is quite nice) I see, we could do that as well, mind opening an issue? will do, thank you ! Hello! Is it possible to compile certain smart contracts in a project with a solc version X and the rest with solc version Y ? Yeah but you can’t import non-compatible solidity versions in others, e.g.",442
1277,foundry-support.txt,"a <0.7.0 pragma contract cannot be imported in a >0.8.0, and you typically use deployCode from forge-std (see docs) Thanks! I will look into this further im looking for some good git repos to read/study and learn different foundry testing patterns. Anyone? Seaport Solmate Maple Loans links here https://github.com/crisgarner/awesome-foundry hi there i'm using solidity 0.8.13 i'm using some libraries of version 0.4.0 when i run forge build i'm getting some errors in libraries due to version difference how do i make forge work for 0.4.0 as well? where can i find a list of support chains for foundry? (trying to figure out the right format for `arbitrum-goerli`) is it https://github.com/gakonst/ethers-rs/blob/afdab2a555c10d55a32c5991282b4353a4a81256/ethers-core/src/types/chain.rs#L26 from ethers-rs? nice arbitrum-testnet worked ok nm tks all o hm .. ig that's actually the old arbitrum testnet (rinkeby i think) maybe goerli isn't supported; still the txn went thru will just have to verify manually i think should the json blob at out/{contract}/{contract}.json be working as the std input json for manual verification? hi, i opened an issue for this, but why does foundry parse github ssh urls into github https ones... https://github.com/foundry-rs/foundry/issues/3321 also, the parsing regex looks incorrect, i think? I left another comment on there about that yeah this regex is def wrong, github updated something: https://github.com/foundry-rs/foundry/blob/3a79ab08664185366bd0dd1e18fef43823f18200/cli/src/opts/dependency.rs#L11 anyway im going to bed and this chat is muted but of course github notifications are on...",435
1278,foundry-support.txt,"i can maybe do a pr if someone wants to tell me the appropriate spot tried a bunch of wrangling but can't seem to get forge to verify for blockscout on arbitrum-goerli (https://goerli-rollup-explorer.arbitrum.io/address/0x35563Cf796f894767B45Ab57D5a03a7810DC0447/verify-via-standard-json-input/new & https://github.com/0xSplits/splits-vesting if anyone else wants to try it out) Hi all Why is there no function for mockCall without returnData? I want to check that contract A, calls contract B, (expectCall), without actually having to deploy contract B. In order to run the test without errors and without deploying contract B (i want a simple test), mockCall is needed. Function B has no return values however, so it feels wrong to do a mockCall with bogus returnData in order to run this E.G. vm.mockCall( stakeAddress, abi.encodeWithSelector(IStaking.B.selector), abi.encode(0) // No return value needed. ); Should this be a feature request, or is there a better way to do things Anyone know why forge tests would hang for a long time without failing or giving any reason? The tests are using forks and specific block numbers if that helps. how do you vm.expectRevert(customErr) ? might be if your rpc endpoint is slow or its not the right url w/ params hey team, my CI has been failing recently but was working last week. im trying to run foundry CI on github actions but keep getting the wrong working dir, im seeing Getting Git version info Working directory is '/home/runner/work/my-repo/my-repo' while im expecting /home/runner/work/my-repo/. does anyone know how to fix this? thanks! Tried a few different ones already...",391
1279,foundry-support.txt,"how to fix ""Stack too deep"" compilation error? Would there be any interest in adding an EIP712 validator that actually generates a digest based the types, domain, and values - as defined in client-side hashing spec? https://eips.ethereum.org/EIPS/eip-712 ? I have had a lot of headache recently with false positive passing EIP712 foundry tests because I was computing my digest improperly in my contract, since vm.sign just “works” on any arbitrary digest, event if you compute that digest incorrectly This is the only reason I use hardhat is for these eip712 “integration” style tests. we have eip712 support in ethers-rs that we probably could make available via cheatcodes Would appreciate an issue for ideal DX here For sure, Ill make one now https://github.com/foundry-rs/foundry/issues/3330 Here’s the issue hm using -vvvv on a script that pulls your privKey in from ENV will leak it to the terminal? seems.. less than ideal opening an issue to discuss oh hm it’s the trace showing the return value of the cheatcode i guess we could not show the return value of the cheatcode if it’s an env one? hey Matthias, is the issue with cwd fixed? I tried doing forge config but couldn't see anything weird yeah or maybe have special env cheatcodes that don't show? opened an issue to discuss further https://github.com/foundry-rs/foundry/issues/3333 i'm fixing stack too deep error. But, it looks like never ending process. i'm getting one after another stack too deep errors after fixing one any suggestion? Add your variables to a struct and use a struct in your functioned signatures This also helps use the latest version of solc… via ir compilation… reduce amount of state vars .. thank you lol Somehow forge script is keep using old source code even after forge build —force or removing out and cache directories... It reflects the change in script, but not the change in src omg I was using deployed contract again and again sorry Are your ports exposed / open? How can I see event logs of tested contracts without having to view the stack trace (-vvvv)? I have an ERC20 and don't see events with any verbosity level until that seems like -vv should do it for you or just -v It should but it doesn't.",486
1280,foundry-support.txt,"I think it only shows logs from the test itself instead of the underlying contract being tested Actually I don't seem to even see logs emitted from a test file either hi all, am having an issue with the forge verify-contract command. using the instructions specified here, i ran the following command:  forge verify-contract --chain-id 5 --num-of-optimizations 1000000 --watch --constructor-args $(cast abi-encode ""constructor(uint256)"" 100) <goerli-contract-address> src/Contract.sol:Contract <etherscan-api-key> --flatten this returned the below error: error: The argument '--constructor-args <ARGS>' requires a value but none was supplied I then proceeded to attempt manual verification on etherscan, and noticed that the constructor arguments field was auto-filled (see image below) with the value i included in the command during my attempts to verify, however the actual verification did not go through. any idea what I could be doing wrong? Hello, all. I am using cast behind a proxy. Is there any way let cast know that? I tried to set env virable ALL_PROXY=socks5://127.0.0.1:1080 but seems like cast still cannot get current block number via ""cast rpc eth_getBlockByNumber"". This could be resolved via set env virable ""export ALL_PROXY=socks5://127.0.0.1:1080"". looks like there's a new line before your $(cast ...)? Hey friends, is it possible to use only one script to deploy contracts on several chains? hey frends, is it possible to use the avalanche etherscan (snowtrace.io) to bring in external source files to the debugger? +1 alternatively i am ok with writing my own API get code and having it point to a local solidity file that is the flattened code, is that possible If i'm running forge test and getting this as a response: forge test compiling... The application panicked (crashed). Does that mean my smart contracts are no bueno? Should be yes here's the rest Message: byte index 8226 is not a char boundary; it is inside '…' (bytes 8225..8228) of `// SPDX-License-Identifier: MIT pragma solidity >=0.8.0; /// @notice Signed 18 decimal fixed point (wad) arithmetic library.",489
1281,foundry-support.txt,"/// @author Solmate (https://github.com/transmissions11/solmate/blob/main/src/utils/SignedWadMath.sol) /// @dev Will not revert o`[...] Location: /Users/runner/.cargo/git/checkouts/solang-98203f5abd7a90ef/f850719/solang-parser/src/lexer.rs:927 Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets. zsh: abort  forge test Sounds like a bug Are you on latest? I have forge 0.1.0 (1187c34 2022-02-09T00:37:17.526154+00:00) How do I update? https://github.com/foundry-rs/foundry#installation anyone ever got this when doing forge create? `[⠢] Compiling... No files changed, compilation skipped The application panicked (crashed). Message: called Result::unwrap() on an Err value: builder error: relative URL without a base Context: - relative URL without a base Location: /Users/runner/work/foundry/foundry/common/src/provider.rs:30` the solidity file is close to the 24kb limit and might be over, unclear, but even when i change all the relative urls in solidty files to be absolute it still fails Ok nice, I ran foundryup and the contracts compiled thanks @DaniPopes and @gakonst Youre setting a fork URL somewhere Without Http or Https yup, that was exactly it -- ty, fixed! hey bro, i meet a problem, the forge test pass and print log immediately but block to print the trace, it cost a few minuties to print the trace, has anyone ever met? the console block hear and take a few minuties to print the trace, It bothers me to wait for the trace result for a long time I’m having issues with forge test hanging when I supply -vvv. It runs the test, reverts, but when it’s going to print the summary with the traces, hangs: Running 1 test for test/Contract.t.sol:ContractTest [FAIL.",455
1282,foundry-support.txt,"Reason: EvmError: Revert] testExample() (gas: 7984) …hangs here the old version of forge build from source in my old computer donot have the problem Is it block to print the detail of trace, and take a long time? yeah, only the summary with the trace is blocking test reverts properly same issues Running a confusing error with remappings ; forge remappings @balancer-labs/=node_modules/@balancer-labs/ @ensdomains/=node_modules/@ensdomains/ @openzeppelin/=lib/openzeppelin-contracts/ ds-test/=lib/forge-std/lib/ds-test/src/ forge-std/=lib/forge-std/src/ hardhat/=node_modules/hardhat/ openzeppelin-contracts/=lib/openzeppelin-contracts/contracts/ I can also verify that that the file is present in my node modules .. However when I build.. i get this  Failed to resolve file: ""/Users/samueldare/Parity/parity-contracts/node_modules/@balancer-labs/v2-solidity-utils/contracts/misc/IWETH"": No such file or directory (os error 2).  --> ""/Users/samueldare/Parity/parity-contracts/src/balancer/vault/Vault.sol""   ""@balancer-labs/v2-solidity-utils/contracts/misc/IWETH""  Check configured remappings. Same happens to me, did anyone know the reason ? Which cmd? I try api-key `—etherscan-api-key > /Users/samueldare/Parity/parity-contracts/node_modules/@balancer-labs/v2-solidity-utils/contracts/misc/IWETH could you dobule check your import statement for this, maybe the extension is missing? it is there in Vault.sol pragma solidity ^0.7.0; pragma experimental ABIEncoderV2; import ""@balancer-labs/v2-solidity-utils/contracts/misc/IWETH""; am i doing the remapping wrong? try after adding .sol dammit thank is there a way to enforce the fuzzer to increment by 1 over a range? i'm trying to speed up some tests that run a bunch of times in a for loop by having forge run them in parallel some how How do you revert custom errors with their inputs? ahh got to encode it.",482
1283,foundry-support.txt,"E.g, vm.expectRevert( abi.encodeWithSelector( NoAccess.selector, address(0xBEEF), owner ) ); i need help., how can i have same contract address on different blockchains? Not a foundry specific issue… https://docs.alchemy.com/docs/create2-an-alternative-to-deriving-contract-addresses Haven’t tried it , but there is also this : https://github.com/jameswenzel/foundry-create2-deployer Have a nice day everyone ✌️ Hi, I'm trying to verify my contract on a private instance of Blockscout with a command like this: forge verify-contract --num-of-optimizations 200 --flatten --watch --verifier blockscout --verifier-url <url> --compiler-version 0.8.13+commit.abaa5c0e --chain-id <id> --libraries <lib-path>:<lib-name>:<lib-address> --constructor-args 0x <contract-adress> <contract-path>:<contract-name> But I' m getting this error: 2022-09-26T09:41:57.504644Z ERROR etherscan: Failed to deserialize response: invalid type: null, expected a string at line 1 column 48 response=""{\""message\"":\""Something went wrong.\"",\""result\"":null,\""status\"":\""0\""}"" And it turns out that when I remove the option ""flatten"", the command runs successfully, but the contract remains unverified on Blockscout. forge 0.2.0 (9e29032 2022-09-26T00:04:52.53004411Z) thanks @SamuelDare Hello, I'm seeing Compiler run failed CompilerError: Stack too deep when compiling inline assembly: Variable dataEnd is 2 slot(s) too deep inside the stack. when running forge build. It doesn't tell me which file has this issue, and dataEnd is not in any of my contracts. Any idea? try to compile file by file to break it down thanks - i've tried that and found it in a single large file - wish there was a way to narrow it down to the line, since this doesn't contain a dataEnd variable Hello everyone. I'm facing the following error when caling a payable constructor.",478
1284,foundry-support.txt,"Do you know why is it happening and/or how to solve it? Thanks 🙂 @gakonst latest foundry, cleaned .foundry cache, and I get this when running forge test, this parser.rs regression was introduced in this commit: https://github.com/foundry-rs/foundry/commit/32b32c6e133f7c796e5be3a59242e08b416be220 for me, it won't work unless i specify a eth-rpc-url in config file If you send all the ETH from the contract it won't have enough to pay for fees maybe ? Well from deployer but is the same Or maybe the test contract doesn't have Eth in first place? I have made payable the setup function and the contructor is executed now. But I need to have value in msg.value: If I send 1 ether I come back to the initial error. Do you know how to set msg.value in the setup? Thanks foe the previous answers 🙂 I solved the issue. I just added balance to the deployer address with vm.deal() routine and send its balance as amount parameter and it works. Thanks a lot for helping me I think the test contract has a huge amount of ETH by default Exactly. But I wasn't funding nothing. That was the main problem we can say hi there. I'm working on setting up GH actions for a repository using foundry. We're looking at caching dependencies (esp. foundry itself) as a way to reduce the runtime on our actions can you provide any examples of a repo that uses foundry + caches dependencies? I had a look through a bunch of repos from onbjerg, t11s, etc. but couldn't find any myself you won't find any... just set up the official GH Foundry action and use the cache action... for sure. just kind of surprised no one has done it yet. was trying to sort out the correct ubuntu filepaths to cache; thought someone might have done it already hi guys. what's the chain id for Anvil? need to connect metamask 31337 ty sir :) Hi all, just wanted to gauge check if anybody here has had a problem in a hardhat inside a foundry project in where the result bytecode is different if compiling either forge, or hardhat.",472
1285,foundry-support.txt,"Considering the compiler configurations match (sol version, optimizer, and # of runs) ? if I recall I used the --slow option from forge script , otherwise (my thoughts) it just goes async through the script not waiting for the tx confirmations do you use vm.startBroadcast instead of vm.broadcast? heyo, can you have a nested test within a test? I am testing the internal price calculation for a TWAP pair, and am running through a few scenarios of changing the DEX balances. I'd like to check my ""work"" in terms of the calculations and used to make happyPath helper functions with ethersJS to ensure that all my math was correct. I haven't seen this type of setup done with foundry though what is a nested test? Calling a test from another test? Sure Yes so let's say you have, testFunctionDetails() and then you have testScenario1() --> within testScenario1() can you have testFunctionDetails() called out and the tests within that nested test ran properly? Semantically it's a question of can I have something like testWoah() public { assertEq(0,0); } testSteve() public { testWoah(); } yeah, if it's a public function solc just handles them as internal jump commands anyhow, so there will be practically not much difference to taking the code of testWoah() and pasting it into testSteve(). as long as you're not calling it as this.testWoah() thanks for your feedback. One more thought, more-so a general question on all this. Would the process actually be better as follows, vs having nested tests (especially as foundry treats the words test as a special prefix)? - test the isolated thing independently - create a helper function that then produces the result of said function - use that helper, knowing that you've independently tested it, in other tests I like building up on / composing previous tests. For example you can write a fuzz test for some purchase test, then use that test in other tests. Think it's a matter of personal preference. happy to see that the vscode-solidity plugin supports foundry.toml now but i noticed something odd i hadnt seen before...",446
1286,foundry-support.txt,"setting bracket_spacing = true adjusts mapping/array access to look like this: uint256 allowed = allowance[ from][ msg.sender]; is this to be expected? i would like to have spaces inside of curly braces for imports, but no spaces inside of square brackets for arrays and mappings, is possible ? bug - pls file an issue 🙂 thanks! is it meant to update the square brackets in any case ? no ok cool done is there a way to make anvil block headers compatible with geth? there's a odd block block number padding difference between the two does the state set on external contracts in setUp() not go beyond setUp() itself? we're updating token balances in setUp(), but they arent reflecting the changes when we test them from futher test functions hey there everyone, is there a way to check if array index is in bound to revert with custom error if so? should it return 0 if trying to access an index out of bound? if (idx >= arr.length) { revert OutOfBounds(); } Depends on your use case Maybe try making a user defined value type if you want to set up some different behaviors is there a way to call forge upload-selectors for all compiled contracts? i see that cast upload-signatures support file path to .json, is it possible to support regex filename? out/*.sol/*.json MacBook-Air ~ % forge init ERC20Test Error: This command requires clean working and staging areas, including no untracked files. Modify .gitignore and/or add/commit first, or add the --no-commit option. Use empty dir try adding --no-commit Hey, when running this script https://github.com/bgd-labs/aave-gov-level-2-update/blob/main/script/DeployGovLvl2Proposals.s.sol#L33 which is deploying 5 contracts —verify only verifies the first one and then errors with: We haven't found any matching bytecode for the following contracts: [0x8327ba38f605c1166c0943b931d3c8fa7da3db9a, 0xe181be4b412db6779cbc9a4ff37dfa2498e2f58d, 0x0654ebf8228fd0cb165962660918e05a07581d5a, 0x953090a054856408a97cfdc077c9cabeb13246fe].",493
1287,foundry-support.txt,"What could be the reason for that? edit: weird - removing all caches and redeploying made it work Hello, while creating a Pair on UniswapV2, i have a EvmError:Revert how can i get more info about this EvmError ? (I tried forge -vvvvv) EvmError occurs after the ""emit PairCreated"" at the end of the createPair() method Hello, it seems that foundry debugger doesn’t show stack properly. I tried changing terminal background color to check whether it’s just a theme thing but it didn’t help. Is it a known issue or am I doing something wrong? I updated foundry today Update: Seems to be a terminal theme issue anyway. After running it from a terminal within IDE everything seems to display well. It’s weird that changing the background color didn’t solve it. The issue occurs in the default terminal on Mac. try source ~/.bashrc Then try your forge command in terminal macOS loads bash_profile, not bashrc which is what foundry default sets up under huhhh the way to do this is by pinning your foundry version. Foundry dependencies are git submodules, you would just want to do a shallow recursive clone to speed that up but really you want to cache the compiler downloads probably Solved the issue. Thank you 👍 is there a way to write binary data (instead of strings) to a file? right now I'm passing the hex encoded data to an external program and have it write to the file instead. however, this no longer works if the data is really long. np np 😉 for posterity, found another temporary solution: writing hex string of the data to a file, converting the ascii file to a binary via an ffi to xxd. Let's say I have ABI and bytecode but no Solidity source code. I want to create a contract object with that bytecode in a test. Is the best way to do this to use etch? https://book.getfoundry.sh/cheatcodes/etch?highlight=bytecode#description Good day please how can i resolve this incompatible version error on foundry You’re importing a file that’s <0.8.0 with a file that’s =0.8.0, you cant do that, need to change the versions How to fund contract with constructor which is payable. Is there a command with which I can do that? I can't find it.",496
1288,foundry-support.txt,"Alright, thanks Hey folks is it possible to pass custom errors as params into a function? yeah, error.selector gives you a bytes4 Hey! Any idea what and where should I look around this error. Debugging a file and keep getting this error any ideas what it means? Error: Contract constructor should have no arguments. Add those arguments to run(...) instead, and call it with --sig run(...). Compiler run failed CompilerError: Stack too deep. Try compiling with --via-ir (cli) or the equivalent viaIR: true (standard JSON) while enabling the optimizer. Otherwise, try removing local variables. When compiling inline assembly: Variable headStart is 2 slot(s) too deep inside the stack. i ran —via-ir and now it compiles 55 files instead of 6 and takes a long time. Are oyu using the optimizer? is that different than whats in the foundry.toml optimizer_runs = 1000000 no that’s correct yeah then you gotta fix your stack too deep move things to functions, add { } etc it's just taking a long time since it has to recompile everything, if IR doesn't work then do ^ via-ir takes long yes What repos would people recommend as great examples of forge test suites? Ideally using as much of the tools capabilities as possible (incl fuzzing, invariants, whatever else), and well organized. solmate, maple loans tyvm seaport ^^ https://github.com/crisgarner/awesome-foundry Thanks and can I call this than as revert this.call(selector)? Hey everyone, first time here! Looking to start test testing merkle trees in foundry, can someone point me in the right direction :) you'd probably do something ilke if (errorCondition) { handler(Error.selector); revert Error(); } 😳 thanks dyed optimism also has some contracts and uses foundry Using cheatcodes, is there a way to read a folder? Basically a function similar to vm.readFile() that would list all the files in a folder and then you could loop through the files, for example the deployments artifacts in broadcast, until you find the deployment of the contract address you want to retrieve. i think you can use the ffi with echo command to 'ls' a directory Ah thanks. I’ll look into it.",468
1289,foundry-support.txt,"if you figure it out i will probably use it :) On some tests where I'm forking mainnet and expecting an arithmetic exception, I'm hitting a test failure wherein the test unexpectedly fails with a different exception which is as follows: FAIL. Reason: Error != expected error: Contract <address> does not exist != NH{q] This address is the address of an EOA which I'm transferring funds to in the method being tested using: (success, ) = address.call{value: balance} Foundry hits the arithmetic exception in the stack trace, but by the time it's bubbled up it's replaced with the exception I'm hitting, I think erroneously (Foundry bug). i remember that u could put the remaps into foundry.toml as well, anyone got a quick example for it? i cant find it in the docs maybe it’s related to vm.persistAccount as youre switching forks nvm i found it but, with remappings.txt vscode doesnt give me any import errors, but when i delete it and move remappings to the config file, they come back (compilation works tho) Hey guys, wondering if there’s a way to mock “revert” in tests? or how can i turn a mockCall into “reverting” instead of return data hey team, my CI has been failing recently but was working last week. im trying to run foundry CI on github actions but keep getting the wrong working dir, im seeing Getting Git version info Working directory is '/home/runner/work/my-repo/my-repo' while im expecting /home/runner/work/my-repo/. does anyone know how to fix this? thanks! I'm not actually calling persistAccount anywhere. I fork mainnet once at the start of the test, run my test (only a single test) & this occurs. Stack trace looks like this: https://gist.github.com/ape-dev-cs/1938d8f84281a1226a0203085ed4ce41 Test fails as I've done vm.expectRevert(stdError.arithmeticError); If nothing comes to mind tonight, I can probably get a minimal reproduction set up on GitHub & open an issue if useful.",448
1290,foundry-support.txt,"Sadly I'm not a rust wizard like @devanonon though :D Yeah that's because Juan Blanco's VS code solidity extension only resolves imports from remappings.txt (or node_modules) does forge have a version of the assert_ne! macro? @gakonst any thoughts on whether you'll accept PRs for adding besu private txn support to ethers-rs? Hmm it depends on how big the change would be, eg the Celo support was quite easy Open minded to it it may be substantial as it involves a change in sequence of outgoing requests. but I'll like to avoid changing existing implementation where possible. But that's good to hear! is there a way to execute cast call in revm and print the traces of the execution? similar to cast run <tx> but not for transactions, just any calls could it be possible with a forge script to re-use external lib dependencies ? e.g. if the script deploys two contracts which rely on identical external libs or to have any control over external libs, e.g. deploy an external lib from within the script and then link it to a subsequent contract deployment ? constructor() payable ERC20(""Token"", ""TKN"") {   require(msg.value == 1 ether, ""Must init the contract with 1 eth"");   _deposit(msg.sender, address(this), msg.value);  } how to write test for this? how to initially fund contract with 1 eth? sending eth... ✅ pass how? https://book.getfoundry.sh/cheatcodes/ // Sets an address' balance  function deal(address who, uint256 newBalance) external; Ohh okay with deal cheatcode. I was confused you can try to read the docx and there is also available samples from the site I am not able to understand it for constructor though.",369
1291,foundry-support.txt,"anyone can help? you can take a look on https://github.com/transmissions11/solmate/ for test reference I know this test but it doesn't have what I want or maybe I missed it in docs if it is there is there a reason foundry recompiles everytime even though artifacts did not change? This was probably asked before but can we generate the contract from a given contract address in tests? I want to double check what the contracts rescuer address is when deployed with a factory yes are you sure it is? Wait what This is not flashbots priv tx ser this is EE private tx EE = Ethereum Enterprise yes You need to set your safe directory someone plz help. What command are you running? when you launch anvil there are default prefundeded accounts, use one of those accounts is etch helpful here because it doesn’t return anything forge t although on a forked network This sounds like something’s wrong here. Would appreciate an issue for this with a way to reproduce affirmative Hi frens Revert in setUp Reason Contract=0x62d69…691 Happens when I am doing an external function call during setup stage. I am doing integration testing against mainnet Any ideas? hard to say without additional context. when would this call revert? Is it possible to define the output types of abi.decode dynamically? Can i pass types somehow? @rkrasiuk yo is --via-ir contract verification working already? ty for the help the other day fren it should've been fixed by these 2 PRs https://github.com/gakonst/ethers-rs/pull/1655 https://github.com/gakonst/ethers-rs/pull/1664 amazing, ty my good ser. I couldnt find these my good ser, I'm still failing somehow @rkrasiuk let’s take this to dms Running tests on an ERC1155 contract and when running forge test, get the' transfer to non-erc1155 receiver implementer' error. Looked around but this smooth brain can't figure out how to run the function call from an address other than the Oxb4c... address. Can someone point to somewhere where I can find how to do this? NVM vm.prank was it.",463
1292,foundry-support.txt,"Cheers y'all! Loving foundry! can you add compiler optimizer runs to the foundry.toml or is it only a flag you can add when running forge build? also why aren't the sizes being displayed here? yes you can hmm they should be Any ideas on debugging this ? Encountered 1 failing test in test/Nexus.t.sol:NexusTest [FAIL. Reason: EvmError: InvalidOpcode] test_shouldDepositLiqudityAndMintUSDCavax() (gas: 9223372036854754743 Here is the snippet of the tests  bytes32 poolIDOmniUSDCavax = IBasePool(OmniUSDCavax).getPoolId();   IVault.JoinPoolRequest memory request;   request.assets[0] = IAsset(OmniUSD); // It reverts here   request.assets[1] = IAsset(USDCavax);   request.userData = abi.encode([100, 100]);   request.fromInternalBalance = false; There are multiple solc versions involved and I am wondering if the complier is confusing things? To give context , I am interacting with balancer v2 contraact (^0.7.0), so the test files have to use a similar pragma. [⠒] Compiling 1 files with 0.8.17 [⠆] Compiling 2 files with 0.7.1 Is it possible to identity which version of solc is used to compile each file? Is it possible to get anvil to print custom errors? Currently exploring switching from hardhat to anvil but was hoping to get more information in the logs. hmm, we definitely try to convert Error() to a string, but I think currently only Error(String) what custom error types do you have? try forge tree this info is also somewhere inside the cache file hmm I think the --sizes is only applied to the compiled contracts. adding --force should print them. But perhaps we should just always print all contracts? so would i need to recompile or use force? i think it's good to have them printed anytime forge build is run with the flag or via a separate command like forge size yeh agree, will change this --force is forge clean && forge build essentially ah gotcha.",466
1293,foundry-support.txt,"i'd like to avoid that if possible bc this is a fat repo and it took my slow ass Mac 405 seconds to compile another good argument for always printin all contract sizes https://book.getfoundry.sh/reference/config/solidity-compiler#optimizer This was the error for that screen shot error InvalidSplit__InvalidAllocationsSum(uint32 allocationsSum) I see, we're just missing a decoding check for this, we already have this somewhere, will just enable it here I was an idiot I forgot rpc url lmao Not a foundry issue I gotta say I love how fast this is hey guys, when i started a new project i immediately get the ""Source ""forge-std/Script.sol"" not found: File import callback not supported"" error i then chanaged the default workspace compiler to localNodeModule, which solves this, but then gives another error for the pragma Source file requires different compiler version (current compiler is 0.8.9+commit.e5eed63a.Emscripten.clang) - note that nightly builds are considered to be strictly less than the released version Have your configured your remmaping ? no, is there documentation on this AFK check the foundry book also, i haven't installed anything extra; it's literally just the project given by forge init would i really need a remapping already? Hi there. Does anybody know how I can ignore assert and require statements in the coverage? Is any way to disable assertion in foundry? ah the remapping thing did work, thanks @SamuelDare I think forge init should add the forge std remapping by default as it’s the same for every configuration I’ve managed to build it with the help of a string utils library: https://github.com/pooltogether/ERC5164/blob/main/script/helpers/DeployedContracts.sol Thanks again for the tips 🙂 added this here: https://github.com/foundry-rs/foundry/pull/3404 appreciate feedfack re console message say i deploy an external lib with create (in assembly), can i then link the lib to a contract bytecode and deploy within a script i think i can do this with ffi and forge inspect but would love to know if there's a better way to do it without ffi hey can you pls elaborate on what safe dir is? any example you can share? You question doesn’t really make that much sense ..",489
1294,foundry-support.txt,"do you want want to fund the contract with 1 ether? You need to use the deal cheap code to add it . Now testing it is easy .. read the foundry book it’s all there based bro is there a foundry cheatcode to convert an address to its proper checksum version ? What's the use case here? If it's from a string, I think parseAddress should do copying addresses from tx page the address is not in checksum format Forge fmt your file What tx page? it automatically converts all addresses to there checksum version ?, never heard of this one before , ty for pointing it out The solidity compiler won't let you compile if the addresses are not correctly checksummed, so I guess you are loading them in? like a normal tx page on polygonscan etc not really i did vm.prank(<unchecksummed version>) i do get a compiler error was wondering if foundry had a cheatcode or anything to convert a string address to its checksummed version Oh yeah, this annoys me so much. Wish they did checksum them everywhere so is there an easy solution ? does parseAddress work ? Well, a cheatcode won't fix a compiler error. 😉 But yeah, forge fmt should fix it then forge fmt did not do anything is this a new feature, should i update my foundry ? The compiler error should give you the checksummed address in the output I normally copy from there Or, click the address in Polygonscan and in the top left the address is checksummed nvm forge fmt worked hi i'm getting this error, what gives? thread '<unknown>' has overflowed its stack fatal runtime error: stack overflow is there a way to tell foundry that the next call is going to revert so expect it and ignore it and carry out the execution from the next line after it ? for e.g in a tx am doing its reverting due to an underflow error can i get foundry to expect it and not stop execution ? nvm for anyone else who comes across this,   vm.expectRevert(stdError.arithmeticError); expectRevert is to be used like this with the std errors. Wow, forge utilizes A LOT of system resources... Been running a test for about 5 minutes so far... is this a fork test? can you open a repro? And the debugger? I'm tellin' you. Foundry for life.",481
1295,foundry-support.txt,"ty Might be also due to the debugger in a long trace yeah We’ve encountered that, it’s because we store the entire snapshot of memory/stack per step iirc. We could/should make this smarter (eg not duplicate unchanged data) yesser, fork test. What's the repro? reproduction case which lets us check what the issue is replied in dm is there any case u can think of where like i'd run forge build and i'd get json files in out/ but no artifacts? there's no artifacts folder, no error coming from forge i run forge build and then i run forge create out/BlockTime.sol:BlockTime and i get could not find artifact: BlockTime sorry i haven't written solidity in like 2 years 🙈 does your foundry toml have something set up weirdly? ok i found the issue i should have just been running forge create BlockTime in the meanwhile i caught you a stray unwrap, @gakonst https://github.com/foundry-rs/foundry/issues/3407 not exactly a foundry issue i guess but i found something weird if i try calling a external contract using low level call by manually supplying the calldata it dsnt work for example address.call{}(<func selector + argument in bytes>) how ever using abi.encodeFunctionSIgnature works just fine and outputs the same bytecode i tried passing in manually i passed my calldata in the following way , addr.call{}(bytes(""<calldata>"") , any idea why is the manual way not working ? What'd you change to get it to pass beyond? my issue is looking similar, except it works for any test, other than once it get's to a complex function.. Compiles, shows me some warnings about visibility etc, then memory usage just bloats until system runs out I'm thinking it might be an optimizer settings issue, which I'd dialed in for a previous test case so that it wouldn't fail with a yul issue where a variable was too far down the stack I understood that I can fund with using cast command directly. You're saying using deal cheatcode but in constructor at runtime how should I use deal cheatcode just for testing it without running cast? That's not what I am getting.",458
1296,foundry-support.txt,"Is that possible locally? hi i'm getting this error, what gives? thread '<unknown>' has overflowed its stack fatal runtime error: stack overflow Hello guys! pinging @mattsse after discussing with @brockelmore. I’ve bumped into a weird issue in our testing suite. The error occurs in an initialization test. The test expect the code to revert with the ZeroAddress() custom error but instead it fails with the following: here is the peac of code that should revert by passing address(0) And here the test with expectRevert I can set the complete trace or point to the github repo if needed. Hope you can help me 🙏 for context it’s a fork test as you probably guessed @mattsse. @MerlinEgalite can you show the trace as well? (ideally you cat the file so it actually prints pretty for the screenshot) sure! Are there any plans to add a console.table to the solidity scripts so we can visualize the results? Foundry Support What macOS version are you using git config --global --add safe.directory /github/workspace % forge build [⠊] Compiling... [⠔] Installing solc version 0.8.15 [⠃] Successfully installed solc 0.8.15 Error: Solc Error: I'm getting this error while compiling. Tried foundryup try deleting ~/.svm and then forge build thanks is there a way for me to reproduce this on my end? ah I'm pretty sure I had the same issue, it's not written in the comments but that was the error message I saw here. I think it's a misleading error message / not the real issue, you can reproduce by running these fork tests: https://github.com/ScopeLift/l2-optimizoooors/blob/3e2d15e0d7c6d11f661768a557e3b7cdbb7f5e24/test/Connext.t.sol#L124-L142 cc @brockelmore @MerlinEgalite Hmm I’m not sure I don’t really get why it’s failing there.",442
1297,foundry-support.txt,"You can reproduce it through our repo though if you want a ty, will try there's likely something off with how we check if accounts exists on revert 12.6 but it seems like the hanging and uncontrolled memory growth was caused by trying to add a value to an array, and then feed that array as an input parameter to a function. Seems odd that it wouldn’t work and that it’d cause this issue. Its weird. If I try to build the array, it hangs, if I use an empty array, it doesn't hang but doesn't do the job it needs to do... First image is the create vault function with it's inputs. Second image is the getter for building the address[]. The third is putting it together in the test.",153
1298,foundry-support.txt,"could you please open an issue for this https://github.com/foundry-rs/foundry/issues/3415 anyone want to recommend a sol docgen tool to use w foundry? @rkrasiuk has a forge doc WIP ready for alpha/beta use (i see the pr) or is there a suggested-workaround for the meantime? if you uncomment this test, you’ll face the issue https://github.com/morpho-dao/morpho-tokenized-vaults/blob/8bed0f75f5491320f8b8ee131db55cd0f91e596f/test/compound/TestSupplyHarvestVault.t.sol#L25-L34 I can help you to setup the thing https://github.com/foundry-rs/foundry/tree/rkrasiuk/feat-forge-doc https://github.com/foundry-rs/foundry/pull/2701 that'd be great, would appreciate if could create an issue for this Is forge coverage meant to show coverage from fuzz tests, or if that’s not yet supported? i forget, @onbjerg did we get around that given we have the deterministic fuzzer now? Ok I’ll do and ping you once it’s done 😊 Has anyone seen the above before? Context: I'm trying to create a mainnet fork / local anvil in docker with the following hardhat.config.js https://gist.github.com/xBalbinus/b408712758743d439246d259af2822e9 is there a way to simulate a call (`cast call`) with an access-list? don't see an AL option on the call subcommand help (i don't see a trace or debug option either so maybe there's another subcommand to use) we havent added that shoudl be easy to support no call does not have trace/debug avail unfort hello, strange thing. I'm trying to verify a contract but it fails as some interfaces are missing..",403
1299,foundry-support.txt,"Can't really tell what's wrong, any ideas? Hi 👋 I am trying to create my own Ethernaut repo and I have one quick question: Is there a way to have both the test and the contract in the same folder (called lvl1 or something)? Do I need to create some kind of remapping? When I move the test outside of the test folder forge does not find the test file :< friends is there a way to reset storage slots completely so that they are no longer warm? im using vm.accesses to find the slots that have been written to and then iterating and overwriting them with vm.store and bytes(0) but this keeps the slots warm obviously. hopefully dont have to deploy new contracts 😟 thanks, Sam! do you know how can i find out what is the correct safe-directory or working-directory ? i've been doing trial-and-error for 30 pushes now :(( it's either the same error Source ""contracts/helpers/MY_FILE.sol"" not found: File not found. Searched the following locations: ""/home/runner/work/my-file/my-file"". or Nothing to compile I tried doing - name: Run tests working-directory: /home/runner/work/my-file/ + my-file/ + ../ run: forge test but didn't work we dont have a cheatcode for that, but ive seen ppl ask it a few times now @gakonst will anvil show a gas usage around 30M gas if its a faild tx or is this really the amound that gas would be used if executed onchain? I created a special kind of proxy contract.. in a foundry test (forked mainnet) its working with gas usage ~5M gas.",350
1300,foundry-support.txt,"Using ethers & mainnet forked anvil It results in this: Transaction: 0xbade2b14518d82d6841e805a5f142fb84238a7a7098782bb062a27992d4d42d0 Contract created: 0xbee6ffc1e8627f51ccdf0b4399a1e1abc5165f15 Gas used: 29543083 Error: reverted without a reason string Block Number: 15643070 Block Hash: 0xb56648b8b8518b9b4505f47a425b3b7a010b03970bfb46597e7236ae45fd075f Block Time: ""Fri, 30 Sep 2022 02:08:43 +0000"" Could it be that its because of internal tx vs external tx? Its pretty huge deployment code Hmm can u share the repo? Yes One second I think its because of gas usage internal vs external tx.. external is somehow x3 https://github.com/shadmau/offChainValidation_Public/blob/master/src/OffChainValidation.sol Its working with an empty contract & full deployment with foundry test (forked mainnet), Anvil & ethers(eth_call/deployment) works with empty contract. Full contract fails with ~29M gas usage With foundry test full contract uses 5M gas.. just seems strange that offchain with eoa its >30M gas usage Ok got it.. full contract seems to be to big that is the preset link to a repo? Without a repo have no way of helping you ser you got alot going on there @mattsse here is the issue https://github.com/foundry-rs/foundry/issues/3419 let me know if you need more info 👍seems like using snapshot is the best fix Hello, is there a plan to create another readFile cheatchode which would loading of binary data? Thank you Hey, having a weird behavior on foundry and wondering if that's intended or a bug. When i do: CoolContract contract = new CoolContract(); console.log(address(contract).balance); balance will be non-zero (5656000000000000000 specifically)...",460
1301,foundry-support.txt,"which does not make any sense to me 😅 How can that be? Is there a way to trace a test transaction on anvil that reverts and doesn’t execute/publish? To see where things break that's reasonable and necessary if you have non-utf8 data, if everything is utf8 you could just cast it? feel free to open an issue hmm, i am not sure i really understand this. how would this be different than running forge t -vvvv? How can I use the same test suite, but for different contracts? I have like 50 tests that are done with contract A. Now I want to test contract B (which differs slightly but tests are same) - but don’t want to copy-paste all those tests. TestB is TestA should do it ah, and I just override the setUp function, right? Hey, does forge test works properly on arbitrum forking? The file I am dealing with seems to contain non-utf8 characters so casting is not an option. Submitted an issue https://github.com/foundry-rs/foundry/issues/3421 Thanks it should, but arbitrum specific precompiles are not supported natively thanks, if anyone wants to pick this up, happy to guide within a solidity script, is it possible to pause/wait for tx to complete and read the tx receipts in the script itself? seems like scripts queue up a bunch of tx and publish them at the end of the solidity execution? ultimately I am trying to work with data as a result of creating/deploying a contract (block number/hash, contract address, tx hash, etc) inside the solidity script rather than using the broadcast logs not currently. @gakonst @joshiedo this would also fix that issue I had where tx2 had a wrong input based on tx1 output because the evm state changed between forge's sim and tx1 being mined. what do people think (both in UX and eng feasibility) of something like a vm.waitForBroadcast() cheat which waits for the tx to be mined and returns the tx object and receipt? I've seen requests for accessing this data in scripts a few times and can see the value.",445
1302,foundry-support.txt,"it is a bit tricky though due to diff tx formats across chains, so maybe just need to return abi-encoded data and trust the user to decode it properly? not exactly a foundry question, but, when using solmate with hardhat i'm having to do import solmate/src/utils/SafeTransferLib.sol but foundry docs says you can use it with import solmate/utils/SafeTransferLib.sol why the extra src for hh and not for foundry? becuase of foundry remappings. Those are defined in foundry.toml but i didnt see any remappings in here: https://github.com/Anish-Agnihotri/goblinmode Does fuzzing ignore console.logs? it will show them if the test fails, and if all tests pass it should show the logs from the last test Weird - doesn’t show anything for me… even with -vvvvv I mean I see it in the trace as bytes - but not in regular text oh yea, just confirmed with the latest forge version. I thought this was supported, but either I'm misremembering or there was a regression. want to open an issue to request for this? hey is there a cast call to verify an already deployed contract on Etherscan? goerli using —verify is returning an error that it wasnt expected as a flag Is there any general way to debug EvmError: InvalidOpcode? ty for merging the custom polygon gas fix @mattsse @gakonst! it's forge verify-contract When running fork tests using forking cheatcode, which EOA is being used to execute transactions? I don’t think I’ve setup any EOA to run the tests but it just works. test contract is caller I believe Hi everyone, do you know if there is any method to do signMessage in Foundry tests? Can use foundry for minnet-fork ? Any references have for read more about this? Hi I've found the cast block reference a bit misleading (at least for me :<) 1st screenshot contains commands provided by the reference to get the latest block and the hash of the latest block. They do not work right off the box. In order for them to work you need to delete --block and --field flags. The 2nd screenshot contains working commands. Is it intended? Am I missing something? I hadn’t found it, and so did myself.",492
1303,foundry-support.txt,"GitGist if you will need it https://gist.github.com/azimin/66fd6d9e5616b61c9a3977f5c2653d4c Hey guys I'm having an issue with my remappings I installed openzeppelin Then I adjusted the remapping But I still get errors when I run 'forge build ' I run 'forge remappings' it turns out I have two remappings of openzeppelin-contracts how do I get rid of the old one? What is the error when you run forge build? Getting this, nuking .svm didn't made it work Openzeppelin is not found Unable to resolve import How are you importing it in your contracts, did you installed OZ's library ? Yes Check your imports maybe this will help import ""openzeppelin-contracts/math/SafeMath.sol""; This is the error I have older versions used to import open zeppelin like this openzeppelin/contracts/math probably the blackslash from windows they are inconsistent, check Alright It's working What was wrong? I just kept on running forge build Then it worked 😅 Hi If a source have not test folder or dont developed by foundry can make test by foundry in that? Is there a way to take a snapshot of a certain network locally? Ideally we could even simulate the time going forward and replicate the txs that happened Forking? hiya gang. im forking arbitrum with anvil and then connecting to that local anvil node with ethers. things generally work/look good, but then when I use this anvil provider with Uniswap/smart-order-router module, it gets a revert calling ARBGas (0x000000000000000000000000000000000000006C) any thoughts? i've narroed down the failing call... cast call 0x000000000000000000000000000000000000006c 0x41b247a8 fails with (code: -32603, message: EVM error InvalidOpcode, data: None) doing the same cast call directly on a host arbitrum rpc url works without issue tho hosted* Yes.",443
1304,foundry-support.txt,"Can you point me to a website that explains how to do that? Check forking in the foundry docs Is there a way to create raw txs with cast? If not is there a tool someone can recommend for use on the CLI or in a bash script? Looks like you can do this with seth mktx. Would be cool to have this in cast as well. I am having an error on running forge test What should I do? I have an abstract contract that I am writing tests for. To test the internal functions, I am inheriting it from the test contract. Is there way to call such an internal function which accepts a calldata type argument instead of memory? Running softwareupdate --install-rosetta worked is there a way, in a test, to expect a certain error (as opposed to 'it reverted' alone)? Sure, for instance like that https://github.com/pcaversaccio/snekmate/blob/main/test/utils/SignatureChecker.t.sol#L115 tx @pcaversaccio 😉 handy, as ever Forge is throwing this error Invalid type for argument in function call. Invalid implicit conversion from contract ISetToken to contract ISetToken requested. I am using it correctly although function (ISetToken _setToken) public { call(_setToken) } we notice something similar, after ~40+ transactions It's possible there's some regression Can u share a repro perhaps? Hey team! I'm using foundry for scripting on a testnet. I have a script which ideally spans across multiple blocks, i.e. ""execute transaction in block a, wait till block b, execute transaction in block b"". Is this possible using foundry scripting? I will try to replicate this with some sample code if possible On a public testnet, no. You could try to replicate behavior with this using delays but foundry doesn’t have cheat codes for that yet.",386
1305,foundry-support.txt,"Instead you could use a regular (JS/python) script to run transactions on a delay, but no guarantee of inclusion in a specific desired block You might also be able to use ffi to hack in a delay Interesting, does that mean when I run a script on a public tesnet*, everything within the script is not atomic? For example, looking at the V3 deploy here https://github.com/joshieDo/v3-core/blob/main/deploy/deploy.sol , can I assume that all the operations in the run function occur in a single block in an atomic transaction? Not necessarily, for example contract creations are broadcasted in separate transactions If you wanted to set up a delay between two actions probably the easiest way would just be to call sleep through ffi Ah interesting. That breaks my assumptions. Is there anyway to simulate atomic transactions using scripting or the only way to deploy an intermediate contract which does all the atomic operations necessary Since the script doesn’t actually get deployed on chain every new call/action is another transaction Only an intermediate contract would allow you to do that Amazing, that clears everything for me, cheers for the help It would be cool if foundry could do something like that natively but it would break some assumptions and comes with some footguns Would also hit block gas lim really easily Ah tried this but the forge script simulation fails as it fails to correctly adjust the block number and assumes the same block number, even after sleeping for 60 seconds + . In my case it reverts because the the contract cannot be invoked multiple times in the same block number. Might be worth raising an issue for this if you think its appropriate? Oh yeah it makes sense this would be an issue Maybe just make a quick shell script to control when the scripts are executed then Might have misled you there, didn’t realize it would break the simulation I’m not really sure it’s an issue I would raise since it would require a good bit of work to change and you could accomplish the same general things with a shell script Fair enough. Will leave as is then following up on this. any way to create calldata type arguments in foundry tests? Creating memory variables in your test should allow you to pass as calldata without any extra work I think this works if you are making an external call to another contract. I want to call an internal function taking calldata argument. Reason is that I have an abstract contract that I am writing tests for.",486
1306,foundry-support.txt,"To test the internal functions, I am inheriting it from the test contract. anyways, I figured out a workaround which luckily works for my specific case. anyone else having this issue?: https://github.com/foundry-rs/foundry/issues/3437 not sure here is the good channel to ask (maybe the other one) foundry is licensed by someone/some entity? Running into an issue with a private repo, I am trying to run forge install to pull in a private repo as a dependancy. I can clone the private repo without issue using git clone git@github.com:[name]/[repo].git but when I run forge install git@github.com:[name]/[repo].git it prompts me for my user name and password instead of using ssh. I am not seeing anything about this in forge install -h or searching forge book. Can anyone point me to docs on this or advise on a way allow ssh to be used rather than username and password? Hey folks I have the same question, want to use this as a way to help my Frontend team to debug txns on our test node. Is there a way to add source code ? It’s dual licensed MIT and Apache yes https://github.com/sambacha/foundry-scripts/blob/master/scripts/git/ssh-handler-github.sh or use yaml jobs: deploy:  runs-on: ubuntu-latest  steps:  - name: Checkout  uses: actions/checkout@v2  with:   fetch-depth: 0   submodules: true   token: ${{ secrets.PAT }} where PAT is a github token u create and put in ur workflow secretes settings thanks hey guys, is there a way vm.assume should be used? because if i use two of them, ""forge test"" hang on ""compiler run successful"" tried with ""&&"" too can you please open an issue for this? if you squash this in a single condition, it should work yep! i'll try to avoid forking and some other things, then i'll open the issue =) Is fuzzing allowed in forks? Regarding this 4 byte selector https://sig.eth.samczsun.com/ What is the api address ? Oh never mind , i get 200 ,when I GET to that address , Was used to seeing , api endpoints start with api...",476
1307,foundry-support.txt,"On another note , what Rust crate is used in foundry to handle these api requests ? its an axum server iirc https://github.com/tokio-rs/axum seems it works without any fork, i've done the mocks and removed the need of a mainnet fork and it worked. [⠆] Compiling... [⠃] Compiling 10 files with 0.8.17 [⠢] Solc 0.8.17 finished in 104.6```6s  Any tips for faster compile time ? I have a pretty power dev machine. Is this 100s compile time an indication that I am doing something wrong with my project setup. My config [profile.default] src = 'src' out = 'out' libs = ['lib'] via_ir = true optimizer = true optimizer_runs = 1 Via IR disabled will speeeeed it up ..but then I have to worry about 16 variables in my code.. so compike time going down and dev time going up 🙁 [profile.default.optimizer_details.yulDetails] stackAllocation = true optimizerSteps = '' this keeps stack var lifting and disables the heavier optimizers thanks Compiler run failed YulException: Cannot swap Variable param with Variable param_27: too deep in the stack by 12 slots in [ RET[fun_REDACTED] param param_1 param_2 param_3 param_4 param_5 param_6 param_7 param_8 param_9 param_10 param_11 param_12 param_13 param_28 param_15 param_16 param_17 param_18 param_19 param_20 param_21 param_22 param_23 param_24 param_25 param_26 param_14 param_27 ] memoryguard was present. So this error pops up. Before the config change my project compiles fine. Is there something else I can toggle on to make this go away while still speeds up compilation somehow ? sigh yea... looks like a case that the stack lifter couldn't handle without the optimizers.",429
1308,foundry-support.txt,"Can you open an issue here https://github.com/ethereum/solidity/issues/ will do in a bit Ehy bro hook me up with more recipes oh thats why i c wat ur doing you got anymore compiler blaxk magic you want to test out you can try watchman mode you could also compile solc and foundry from source 💯💯💯 Hey there, trying to use vm.parseJson but seems like this feature is not yet available in forge-std ? Can we use it yet ? Thanks Ups nevermind found the answer Trying out invariant testing. Returning: ERROR forge::multi_runner: error=No contracts to fuzz.",131
1309,foundry-support.txt,"Can anyone help? // SPDX-License-Identifier: UNLICENSED pragma solidity ^0.8.13; import ""forge-std/Test.sol""; import ""@openzeppelin/contracts/token/ERC20/ERC20.sol""; contract token is ERC20 { constructor(uint256 initialSupply) ERC20(""ext"", ""EXT"") { _mint(msg.sender, initialSupply); } } contract ERC20Test is Test { token inv; uint256 initialTotalSupply = 1000000000000000000000; function setup() public { inv = new token(initialTotalSupply); } function invariant_totalSupply() public { require(inv.totalSupply() == initialTotalSupply); } } Am I doing something wrong or is coverage still not fully correct? it literally says lines below “if” are hit 700+ times, and 800 times below “else” - but how is the branch not covered? using forge verify-contract, the key is copied from etherscan, echo $API_KEY_ETHERSCAN prints it correctly, i have saved like this in my foundry.toml: ""mainnet = {key = '${API_KEY_ETHERSCAN}'}"" using -f mainnet flag interesting enough, using froge script with --verify works but verify-contract doesnt lol? Maybe forge verify-contract does not read the API Key from the config does forge have the html page for coverage like hardhat? after running forge coverage oh lmao just saw this- how did you get this page to work? vscode ext forge coverage --report lcov and you need this https://marketplace.visualstudio.com/items?itemName=ryanluker.vscode-coverage-gutters I generated it with genhtml (a part of lcov package - install with brew if you’re on mac) Hey guys, I am doing a loop with a million transactions in it. I am getting a gas limit error so I tried a few things. I tried calling vm.roll every 200 txs. I tried lowering the fee in gwei using vm.fee and I tried setting a higher --gas-limit in the forge test command the gas limit error should be per block or tx so if I roll the block I dont understand why there is a problem maybe it is an issue with my contract when there is a lot of txs it starts looping through an array too large and the individual tx uses too much gas but I dont think that is the case.",491
1310,foundry-support.txt,"I will have to double check if that could be the issue. I can look more closely at the logs from --vv but I suspect it is an issue with Foundry anyone see an issue with this?   vm.mockCall(mockPool,      abi.encodeWithSelector(TransferService.verifyTransfer.selector, (user1, user2, 1 ether)),      abi.encode(true, """", user1, 1 ether)      ); error[2056]: TypeError: This type cannot be encoded. | abi.encodeWithSelector(TransferService.verifyTransfer.selector, (user1, user2, 1 ether)),``` for the args, should they passed in a different format? cant find a good example sorry telegram code formatting always gets me well got closer like this but still not quite there, getting EvmError: revert   vm.startPrank(initialAdmin);   transferService.addVerifier(user1, mockPool);   transferService.addVerifier(user2, mockPool);   vm.deal(user1, 2 ether);   vm.mockCall(mockPool,      abi.encodeWithSelector(TransferService.verifyTransfer.selector, abi.encode(user1, user2, 1 ether)),      abi.encode(true, """", user1, 1 ether)      );   (bool success, string memory str) = transferService.verifyTransferAndCall(user1, user2, 1 ether); Thank you you all are legitimate legends @vicnaum @FreezyDev @sambacha advanced search on github is how I would troubleshoot. look for the file extension and add the startPrank and encodeWithSelector keywords maybe I am not support in here though. waiting for my question to be answered so I saw yours Any plan to support reverting calls with infinite loops in debugger ? This is what happens when a context is reverting and all gas has been spent with debugger Ooooooh just set a gas limit in the call :) Why is it that logs don't get printed when a test passes (even with the -vv flag) Hi there - anyone has ran into issues lately with forge bindings ? using latest foundry, latest ethers, solc 0.8.17, forge binds finishes successfully but cargo doesn't compile the bindings, weird syntax errors like token delimited, unmatched brackets etc (used to work well before).",466
1311,foundry-support.txt,"It's getting quite hard to pinpoint where an error appeared during compilation due to the lack of foundry/ethers versions - would you consider starting to have more longterm stable versions ? hey frenz, can the foundry live debugger be used to go through live transactions ? I remember dapp tool had this command seth run-tx --debug <txhash> which was amazing. Is there a foundry equivalent atm ? Hey everyone, I was trying to deploy a simple ERC20 token contract to a particular chain, but I am getting this error. Is this because of some error on my end or this particular blockchain network is congested right now? maybe I am wrong but that error seems related to your rpc https://rpc-chiado.gnosistestnet.com/ exactly if you need chiaso testnet try this rpc https://rpc.chiadochain.net Aahhh Yes Now I feel stupid I was using the instructions here: https://docs.gnosischain.com/developers/smart-contracts/foundry But apparently I should have realised that the rpc is incorrect Thanks man :P yes I don't know where you found it😅 Wow It just got corrected right now Earlier it was something like this Looks like someone from Gnosis is in this group :p Having an issue with using forks. I setUp a contract (helper) that has a normal Library (libHelper) in it, when I call a test function on that relies on a function in helper.libHelper I get the vm.makePersistent error. I've tried simply passing the address for libHelper in the setUp function but that errors that it doesn't exist. Any advice? ok, I think that I figured that one out, I had used vm.warp() and block.timestamp (which is based on the timestamp of the local network, not that on mainnet). How can I map an array to a bool in rust? What exactly are you trying to do ? Can you give context ? I want to calculate the frequency of the numbers in an array and print it So I need some mapping to increase the counter If 10 occurs 2 times , print 2 in front of 10 thats outside the scope of this chat.",445
1312,foundry-support.txt,"but this should help: https://stackoverflow.com/questions/70234024/is-there-a-rust-function-which-counts-frequencies-in-a-vec https://www.google.com/search?q=count+the+frequency+of+item+in+vector+rust&oq=count+the+frequency+of+item+in+vector+rust&aqs=chrome..69i57.9287j0j4&sourceid=chrome&ie=UTF-8 Do u know any rust groups where I can ask questions As long as you dont tell them you do blockchain you should be fine. There are two main ones on discord , one on slack This is more blockchain focussed , but they dont really do Q& A there : https://t.me/rustinblockchain I am looking for general groups for maintaining this repository https://github.com/supernovahs/Rust--Data-Structure-Algortihms of topic DM me @perelyn_sama I had a minor issue using script. I used to leave vm.startBroadcast() in setUp() and I noticed that if setUp() is being called a couple of times, the generated txs will start from nonce = correct_nonce + x. You should use “vm.startBroadcast()” in the specific code block only. wdym setUp is called multiple times? Is there a way to get all function signatures of a contract during run time? correct me if I’m wrong, I thought setUp will be triggered before calling every function. e.g. function run(){ f();g(); } Anyone know how to handle Could not canonicalize the target path When adding fs_permissions = [{ access = ""read"", path = ""./""}] to foundry.toml More specifically, the full msg is Error: Could not canonicalize the target path Context: - No such file or directory (os error 2) Found the problem.",380
1313,foundry-support.txt,"Passing the wrong path in my cli command, had nothing to do with the toml file is the --verify flag not working for scripts / scripts w deterministic deploys atm? Does verify work with the arb goerli testnet? The only block explorer is blockscout it should -- was able to get it working a week or two ago you can search issues on the repo to see the command i used thx can confirm just did it again w some other contracts; their ui is kind of slow / busted tho forge verify-contract {address} {contract} $ARB_ETHERSCAN_API_KEY --chain-id 421613 --compiler-version {compiler} --num-of-optimizations {numOpts} --verifier blockscout --verifier-url https://goerli-rollup-explorer.arbitrum.io/api Wow thanks so much 😁 looks like forge script is broken on arbitrum rn? https://github.com/foundry-rs/foundry/issues/2941 @joshiedo maybe related to multichain forkign gas estimation? im trying to send tx's through anvil using metamask and the tx's are always stuck pending. Anyone experience this? @joshiedo do we not have traces for a failed invariant run? like what we do for fuzz tests? Is it possible to have a Solidity script ""sleep"" (not warp time forward but rather stop running for some time, similar to sleep in Python/Go)? Check open PR by Alexey We should have..",307
1314,foundry-support.txt,"ye def a bug 🤷🏻‍♂️ i commented on alexey’s branch Hey guys, is there any way to run any OZ upgradeable ""safety"" check in foundry/forge? Like this one for truffle: https://github.com/OpenZeppelin/openzeppelin-upgrades/blob/3069545ba53b8130596ee290a3e8ca71b921b44a/packages/plugin-hardhat/src/utils/validate-impl.ts#L31 @onbjerg any tips to get forge coverage to ignore a folder? @lucasmanuel_eth ^? lcov -r lcov.info ""test/*"" -o lcov-filtered.info seems to do it I am working with balancer v2 and runnng into some permission issues which I am not sure if its due to an isssue with how foundry's test runners work in the context of prank / msg.sender / tx.origin. For users to be able to join the pool, balancer v2 checks to see if the user is sending the tokens directly to the pool, or if its a contracts. If it is a contract , they have to be an authorised relayer, ortherwise you run it returns a BAL401 error i.e. Sender not authorised. I have tried created a user , starting a prank as the user and trying to add token to the vault. Unfortunately, this still returns a 401. I would appreciate any clarity into what might be going on.",306
1315,foundry-support.txt,"for some reason using these calls cause the via_ir optimisations to cause stack too deeps # Test.deal.. function deal(address token, address to, uint256 give) internal { ... } commenting out any calls to these functions and the rest works fine all is well when not using the via-ir optimizer I've played with the various compiler params and this is pretty constant. any thoughts on why these specific calls would do this? this is probably more of a solidity compiler question than foundry, but asking nonetheless (this is prob not enough context to sensibly comment, but pulling my hair out :)) was using 0.8.7 due to slither recommendation, but 0.8.13 sorts this as per https://twitter.com/solidity_lang/status/1506215104660004867 is there a way to use deal (or some equivalent) within scripts when working on an anvil fork to set ERC20 balances? https://github.com/TheAlgorithms/Rust what's the easiest way to migrate an old foundry repo (ds-test times) to a new one? I moved the test dir to the root, removed the ds-test submodule, and installed forge-std. But now compiler is complaining: bash [⠒] Unable to resolve imports:  ""ds-test/test.sol"" in ""/home/leo/devel/dl_symb_exec_sol/lib/forge-std/src/Test.sol"" with remappings:  forge-std/=/my/proj/lib/forge-std/src/ my foundry.toml is as clean as a new one: [profile.default] src = 'src' out = 'out' libs = ['lib'] ok solved it, had to manually install ds-test inside lib/forge-std for some reason having this issue where forge tests slow down A LOT after running a few times -- not sure how to debug or figure out if there's some kind of.. mem leak or something going on? (hard numbers: first time i ran the test it took ~2 sec, most recent time it took ~200sec) forge clean doesn't speed it back up maybe something w the forge sqlite? Hi All, currently I can write to packed structs with stdStorage, given that the complete slot is initially empty. However as soon as one of the two values is already set (or blocknumber or interterest rate) I cannot overwrite the slot.",489
1316,foundry-support.txt,"Is the only solution to manually disable the error ""stdStorage find(StdStorage): Packed slot. This would cause dangerous overwriting and currently isnt supported""? Hi everyone! I ran into the following error when trying to run forge coverage: CompilerError: Stack too deep when compiling inline assembly: Variable headStart is 1 slot(s) too deep inside the stack There's no issue when running the tests as usual. I saw that others faced a similar issue but did not find any working solution.. what solidity version are you using? i had a repo that had this issue and i bumped to 0.8.17 and it was solved 🤷🏻‍♂️ (also make sure you are on latest foundry version) Whats the best practice to assert that an external contract method was called? I understand using mockCall to control the return values from the external contracts and the tests fail if they aren't mocked. I was wondering if there is a cleaner way to simply assert that a given method was called with given arguments? Or would this be a code smell as its testing implementation detail? 0.8.13 Will check everything and come back to you Changing solidity version will not be a solution though 😅 qq about script, can I do start and stop broadcast as many times within a solidity script or just once? say i want to do some calcs or stuff and not send that as Trx as many as u want I'm running a script locally against anvil, specifying the --fork-url and using a private key from anvil for the broadcast, but I'm not seeing the sender for the transactions match the account that should be associated with the private key... the transactions are ultimately failing with this error: (code: -32003, message: Insufficient funds for gas * price + value, data: None). I'm guessing I'm doing something wrong, but I'm not sure _what_ 😬 how are you doing the broadcast / how are you invoking foreg script? forge script script/Deploy.s.sol\:DeployScript --fork-url http://localhost:8545 --sig ""membershipTokenFactory()"" --broadcast -vvvv Interesting. This should have worked. And PRIVATE_KEY is one of the anvil keys? Can you console.log(vm.addr(deployerPrivateKey).balance)? !! well, the balance is 0, so there must be something wrong with retrieving the private key.",492
1317,foundry-support.txt,"In my .env, PRIVATE_KEY is set to the value of anvil's private key (0). I'm retrieving it via vm.envUint() which is what the docs indicated, but maybe that's at issue here? Are you sure the env var is loaded? i.e. is deployerPrivateKey the right value? is it 0 maybe? No, it's present... I can see the integer value in the verbose trace. I can also confirm that the value echoed in my shell is the same as the one I copied from anvil. I think you're on quite an old version of foundry. There was a bug with parsing uints from env a while back, but also sensitive logs are no longer shown. Can you run foundryup and try again? That fixed it? 😅 That fixed it. I really and genuinely thought that I'd run foundryup within the last week. Pretty sure it was just before a business trip, so around the 23rd. Thanks very much to you and @gakonst. eep. Happens to the best of us, all good 👌 No prob, glad it's working! This is suggested to report, but any thoughts on workarounds? just running forge bind (attempts to exclude test contracts have also not worked): > forge bind [⠒] Compiling... No files changed, compilation skipped The application panicked (crashed). Message: ""ATestContract.t"" is not a valid Ident Location: /home/runner/.cargo/registry/src/github.com-1ecc6299db9ec823/proc-macro2-1.0.46/src/fallback.rs:756 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ BACKTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1: __libc_start_call_main<unknown>  at ./csu/../sysdeps/nptl/libc_start_call_main.h:58 2: __libc_start_main_impl<unknown>  at ./csu/../csu/libc-start.c:392 Hi, searched the chat but nothing conclusive. I can see cast offers raw RPC calls.",476
1318,foundry-support.txt,"Are there any utils available for querying event logs (eth_getLogs) available in cast or foundry? Oh this is an ethers-rs bug related to how struct names are derived Could you open an issue for this please? FYI: https://github.com/gakonst/ethers-rs/issues/1770 😓 if i have anvil running for ass time, does the state get saved temporarily to disk or is it always kept in memory? Hey, I'm woroking with underflow/overflow in my solidity tests. How does the current version of solidity work again regarding overflow/underflow? Here's the error I'm getting ""Error != expected error: NH{q != Arithmetic over/underflow"" trying to use custom errors outlining that underflow/overflow is not allowed What's STF ? I have this function  function transferToMe(uint256 amount) external {   IERC20 weth = IERC20(WETH9);   TransferHelper.safeTransferFrom(    WETH9,    msg.sender,    address(this),    amount   );   console2.log(    ""Balance of this contract:"",    weth.balanceOf(address(this))   );  } And I am testing it with  function testTransferToMe() public {   IERC20 weth = IERC20(c.WETH9());   // Amount to swap.   uint256 amountIn = 100 ether;   // Get some tokens.   writeTokenBalance(address(this), c.WETH9(), amountIn);   console2.log(""My balance: "", weth.balanceOf(address(this)));   // Call the function   c.transferToMe(amountIn);  } I am getting this error Test result: FAILED. 0 passed; 1 failed; finished in 9.22s Failed tests: [FAIL.",372
1319,foundry-support.txt,"Reason: STF] testTransferToMe() (gas: 199973) This comes from ERC20 From the helper you're using The transfer is failing Ohh ohk I am checking it when I do forge create on a contract that imports a lot of other contracts, I get `Solc Error: unrecognised option '--allow-paths'` -- any idea if this error is bc of foundry or my directory setup? i get a couple of `[⠢] Unable to resolve imports:` beforehand for irreleevant test/logging contracts in various node modules that arent mine Which solc version is this? Perhaps the we got something when we sanitize for older solc i think it was trying to resolve some garbage imports like Foo.sol in the node_modules that weren't even being imported anywhere, so I just deleted those random floating sol files and then it deployed fine (initially said could not find artifact, but then i removed the path to the sol file before the contractName and it worked) seems strange that foundry tries to compile unused files, possibly when the packages are imported? hard to say with out a repro I'm compiling this: https://github.com/pipeos-one/goldengate/tree/master/contracts/, you can just run npm install && forge build --force in that folder could you try with <path>:name Instead of just name right <path>:name didn't work but name did ah inside the contracts folder? yeah, from src/contracts on the top level, i did ./contracts/Prover.sol:Prover which didnt work but just Prover did (note that theres no foundry.toml file) right, try with —root . in contracts or configure a foundry.toml in the project root folder you use stdErrors.arithmeticError to catch under / over flows Wouldn't expectEmit fail if there is no emit Event follow right after? I have a vm.expectEmit but didn't followup with the emit but it didn't catch it and pass the test. can forking mode be used to take snapshots at a specific block? vm.snapshot i think? unless you eman smth else I want to read storage of a deployed contract from about a year ago.",453
1320,foundry-support.txt,"So if I fork and set the block to 120000 and call DAI.balanceOf(firstAccount); is it going to be reading the state as it was for block 120000? Trying to use it to make RPC calls for historical state cause I dislike javascript I think the section on caching under Forking Mode in the foundry book answered my question gotta select the block when forking hey friends! Trying to remapp a node_modules based package into a foundry project. Specifically superfluid but nothing seems to be picking it up When I did vm.parseJson, it says the function is not found on the package vm. When I tried to do import ""forge-std/StdJson.sol"";, it says the file is not found. What should I do? It seems like in my local forge-std the file StdJson.sol is missing forge update Now all the syntax works, but compilation fails at vm.readFile(<path.json>) and shows the error message [FAIL. Reason: Setup failed: The path ""<path.json>"" is not allowed to be accessed for read operations.]. The combined file path is indeed correct. What could be the reason? try changing the file access permissions with chmod? Hey, anyway to speed up forge test with fork network? even if the contract is already compiled it takes like 15 seconds to fork the current network and execute the test is your forge up to date? it should include a reference to the fs_permission conifg value which provider are you using? does it should up in your forge remappings output? generally you need two things: add node_modules to libs and a new remapping to remappings in foundry.toml. node_modules should be picked up atomatically tho it ""forks"" off at the given block number, so the next block would be forked block + 1 meaning the forked state includes the block. you might be interested in forking at a specific transaction, check the forking cheatcodes which you can use to fork the state right before the tx was executed https://book.getfoundry.sh/cheatcodes/create-fork or even execute it manually is there a way to console.log from inside an assembly block in solidity? this is how all console.logs are emitted: https://github.com/foundry-rs/forge-std/blob/master/src/console.sol#L7 I am using Alchemy (Growth plan), polygon network.",489
1321,foundry-support.txt,"Any better/faster options? hmm, really depends on how much state needs to be fetched from the provider. ratelimiting could be an issue here. if you don't need the latest block, then I'd suggest pinning to a recent block so you can always reuse cached state well I need the latest block/state since I am using this contract test to simulate a swap before executing it. That's why I need to run this test fast enough to avoid been front-runned you can have a look at the logs if you run with RUST_LOG=ethers,ethers_providers forge ... and see if there's something off with requests/ratelimiting Cool, I will give it a try. Thanks I see many eth_getCode call. Seems the TRACE module is fetching the contracts bytecode that I interact with from the network. Could this be a bottleneck? isn't that suppose to be done only if the --etherscan-api-key is provided? anyone know if there's a way to get the exact line of an overflow in the case of a view function panicing with 17? i wrapped both funcctions in unchecked{} to no avail I get ""No bytecode for contract. Is it abstract or unlinked?"" error when trying to deploy a contract via forge script. This contract uses a library with public functions in it, it will have to be linked but I thought this was automatically done since when running the script I can see the deployment of the library (and its new address). So my question is, do I have to do it manually or am I missing something? okay, ignore it. I was using deployCode to deploy the contract which would not do the linking in the bytecode properly. Foundryup is there a way to get init bytecode hash easily for create2 deployment of a contract? Love the product! having some issues RE deploying via scrip[t Trying to use my metamask address to deploy to Gorli. Have the 'sender' field with the address in my toml file but getting the following error when running my script No associated wallet for addresses: {0xf44b95991cadd73ed769454a03b3820997f00873}.",445
1322,foundry-support.txt,"Unlocked wallets: [] you need to add your private key to env file and reference in your toml https://book.getfoundry.sh/tutorials/solidity-scripting#environment-configuration IIRC , foundry adds the .env file to .gitignore so you should be fine . how can I use the interactive debugger on live mainnet transactions ? What does partial coverage of a line with a single condition mean? (removed potato quality previous screencap) Hello do you have any idea of how I could factorize 2 exact same functions that only diverge in the fact that one of them is using ""storage"" and the other ""memory"" for an array passed in params ? I think that only the true or false case was checked but not both pretty sure tests triggered both, saw logs for each branch... will double check Sure I installed the coverage gutters vscode extension you can not use foundry as is with metamask without also using your private key exported from mm Has anyone successfully used ‘forge fmt’ in a github workflow? Alternatively you can use this: https://github.com/manifoldfinance/walletbus gh clone && sh setup.sh you will be able to use metamask to sign foundry txs then Has anyone run into this recently? Found this but it wasn't that helpful https://github.com/foundry-rs/foundry/issues/2468 Contract verification originated from both forge create ... —verify as well as tried forge verify-contract … and this result was from forge verify-check ... Running on avalanche mainnet --chain-id 43114 Waiting for verification result... Error: Checking verification result failed: Context: - Verification is still pending... If it is always a snowtrace (etherscan for avalanche) issue that is alright, I see some people had to just wait in the past. It’s been around 40 minutes since the first attempt though, which suggests there might be some other issue. There’s some flakiness across block explorers, we have a lot of internal error handling + retry logic with backoffs, but new edge cases keep surfacing. Not sure what we can do to further improve reliability here Oh just verified after over one hour… super weird, thanks anyway Is there something special like a foundry.toml config I need to set in order to use vm.envString()? I keep getting environment variable not found despite seemingly doing everything correct.",485
1323,foundry-support.txt,"This is using forge test if that is relevant Same error with forge script as well though it should just read it if it's set, does echo $VAR print it? yeah and I can use the same variable in the script directly like —fork-url $MAINNET_URL. But for some reason in the actual test I cannot Do I need to do something like fs_permissions in the foundry.toml I've been getting the same since a few days. Running on polygon. Though I think most times it's resolved itself after waiting long enough and using --resume. But sometimes I think I also had to wait about an hour can u deploy yul scripts with foundry? seems like i just have to pass --via-ir think🤔 I've got some git status conflicts with these git submodules that I cannot clear. What am I doing wrong? It won't let me add/commit, discard, or stash. Weird it seems the folders as files Go into submodule, checkout all files cd lib/ERC721A && git checkout -- ./ thanks! lol well that fixed my git status issue but borked me in other ways since I had made a change to the ERC721A lib that I had forgotten about, RIP Also now a bunch of my tests are failing that is weird Welp, you can make the change again, but actually commit it in the submidule ahh I see what happened 🙂 Or just ignore that git status message.",295
1324,foundry-support.txt,"That doesn't work because you can't install other submodules with those conflicts I mean I can't push upstream to the original remote, can I change remote to mine I guess? You don't need to oush Push* fixed all my test at least 🙂 I mean, unless you want to It wouldn't let me do anything with those changes Yeah, make toy changes, go into submodule, git add, git commit, go back to supermodule, git add submodule, git commit My git status didnt see into which files were changed in the submodule folders I'll try that flow next time But if you want others to clone the supermodule, it won't work If you push up the supermodule for others to use Because they won't have that submodule commit available to them Only solution then is to make PR into submodule, or make a fork and use that for submodule yeah, makes sense If I write a forge script and fork mainnet in the script, is there a way to give my address a bunch of ETH (100000) to my address similar to how anvil does when you start it up? Using the following  uint256 mainnetFork = vm.createFork(MAINNET_RPC_URL); vm.selectFork(mainnetFork); nvm, found vm.deal() and it did the trick! how do i install openzep for a forge project? forge install OpenZeppelin/openzeppelin-contracts —no-commit might need what about forge-std? for some reason it didnt get installed when i did forge init forge install foundry-rs/forge-std ah got it ty Open grey problem short out ??? this gell type lumps are comming from mixer with prepared sand somebody helps us to know how to control it? I checked and one test goes through true the other through false.",370
1325,foundry-support.txt,"Is there something else I should do? Hi everyone! Is there a way in foundry.toml to have different value for optimizer_runs depending on the contracts ? Like I’d like to have it set to 10k except for one contract that reaches the size limit is anyone experiencing problems with etherscan verification on Goerli? is there a way to do eth_getProof in foundry without going through the ffi forest using several expeectEmit cheatcodes for the same call doesnt seem to work for example vm.expectEmit(true, false, false, true); emit Withdraw(0, uint256(1 ether)); vm.expectEmit(true, true, true, false); emit Transfer(lenderOne, address(0), positionId); revolvingCreditLineInstanceA.withdraw(positionId); fails while expecting one event emission while commenting out the other and vice versa works.. this known issue? Hi,guys , vm.prank(address(0)) can’t work, why ? I want to use nil tx.origin to test with chainlink upkeeper.",214
1326,foundry-support.txt,"vm.prank(address(0)); registry.checkUpkeep(upkeepId, keeper); function preventExecution() internal view { if (tx.origin != address(0)) { revert OnlySimulatedBackend(); } } thanks a lot!! oooooooo // Sets the *next* call's msg.sender to be the input address, and the tx.origin to be the second input function prank(address,address) external; ├── test │  │ ├── fixtures │  │ │ └── broadcast.log.json What is this new file ? when doing a forge init —no-commit —nogit FoundryProject/ I just saw this ? And no mention of it in the foundry manual ? is ethers-rs compiling normally currently @mattsse @gakonst ? what’s the issue thiserror? Just compiled fine for me yea it's weird actually, ethers-rs compiles fine for me locally, but when I compile foundry: Compiling ethers-solc v0.17.0 (https://github.com/gakonst/ethers-rs#f295af1f) error[E0277]: the trait bound `dyn NamingStrategy: std::default::Default` is not satisfied --> /home/leo/.cargo/git/checkouts/ethers-rs-c3a7c0a0ae0fe6be/f295af1/ethers-solc/src/project_util/mock.rs:40:5 | 36 | #[derive(Serialize, Default)] |      ------- in this derive macro expansion ...",311
1327,foundry-support.txt,"maybe documenting it will be enought? like “if you want your gas-reports to be stable - add a seed"" @transmissions11 @msolomon4 anyone seen this error from clippy before i have but i don’t remember the trigger ban i believe it was an actual clippy bug or version difference this is not a concrete mixing foundry support channel ser Instead of showing foundry download metrics we should start showing the number of spammers on our chats positively correlated with success Which one is correct - optimizer_steps or optimizerSteps? either works i think I thought we already do this for snapshots, I don’t think we do for reports though? but agree we should are there any plans to fix forge script on arbitrum mainnet? what is not working again? is it for everyone or just for few cases? hard to say I haven't personally tested a bunch of edge cases but based on https://github.com/foundry-rs/foundry/issues/2941#issuecomment-1239665534 comment i'm inclined to believe it's widespread and not just people trying to use CREATE2 and https://github.com/foundry-rs/foundry/issues/2941#issuecomment-1272567440 I'm writing a fuzz test that takes an address and then expects a revert on some access control with a message that includes the fuzzed address. In order to interpolate the address, I use vm.toString on the address inside an abi.encodePacked with the rest of the error message, but the vm.toString(address) seems to produce an un-checksummed address sometimes, which is causing it to fail with certain fuzzed values.",335
1328,foundry-support.txt,"Is vm.toString producing an address that is not checksummed expected behavior? Maybe I'm doing something wrong? ah yes vm.toString() might not produce a checksummed address https://github.com/foundry-rs/foundry/blob/0c5e82b4c229bd27e00db815b861239802070d48/evm/src/executor/inspector/cheatcodes/util.rs#L147-L164 Thanks for the fast response! Is there a better way to interpolate an address into an expectRevert than vm.toString? Currently doing this: vm.expectRevert(    abi.encodePacked(     ""AccessControl: account "",     vm.toString(nonAdmin),     "" is missing role 0x0000000000000000000000000000000000000000000000000000000000000000""    )   ); where nonAdmin is of type address can you do it w/o the vm.toString? or will it be hex i think that’s the way you do it otherwise Oddly, it comes through as an empty string if not coerced. Same if you abi.encodePacked(nonAdmin). Since I already have OpenZeppelin in this project, I went with using Strings.toHexString and this seems to have resolved the issue 🤷🏻‍♂️ a ""one does not simply..."" meme feels appropriate 😄 Hi this might be a dumb quesiton but deploying contracts to mainnet is way more expensive than I thought. I just tried to deploy somethingn to realize it was underpriced but the script run consumed some ETH anyway Is running forge script without —broadcast essentially the same as just running the simulation? Is there a way to force a solidity script to record that a contract was deployed in the broadcast file? E.g. I am deploying via CREATE3. I can't get verification to work. GM! When contracts are using multiple compiler vesions, is there a way to specify multiple solc versions in the config? When I am trying to run forge init I am getting ZOE ERROR! Can someone help? I am running ubuntu 22.04 Pip3 install solc-select Solc-select install <0.8.13 or your version or higher than> Solc-select use <0.8.13> etc.. That worked for me I run that in VS code with Foundry , slither and git, works like a charm Thank you.",494
1329,foundry-support.txt,"Does it mean that a manual selection is needed for each contract? In a project with 10+ contracts of different versions, is there a way to auto-detect complier versions but pick from a provided list? The default ""auto-detect"" from foundry does not suggest the exact version we used in a deployed contract. Anothe questions: Can forge update update a package to a specific version? It's quite important to lock the version of libraries, as some breaking changes can be introduced in the latest version. I don’t think it’s configured for such activities but I reckon that if you play around with arrays of remappings in the following format: <name>=<target>. A remapping remaps Solidity imports to different directories. Tells solc to allow reading source files from additional directories. This is mainly relevant for complex workspaces. this might work for u If anyone runs into this issue later, I was able to fix the issue by adding alias forge='~/.foundry/bin/forge' into my bashrc Is this not handled by foundryup? having the same on rust nightly definitely a bug in clippy My solution was to forge remove old dependency then forge install <alias>=<GH repo>@tag the preferred on with its version specified. Note that forge remove doesn't automatically remove the submodule from <root>/.git/modules/<path to the dependency>. It has to be manually removed. (as mentioned in one of the discussions above) How to run coverage test? I don't see coverage command in forge --help. Trying to run forge coverage gives me error: Found argument 'coverage' which wasn't expected, or isn't valid in this context foundryup forge coverage doesn't work? can contracts compiled with revertStrings=debug affect the execution? Not in my case... Doesn't work. forge version was forge 0.2.0 (752dd63 2022-05-10T00:04:18.623739+00:00) Which is better? Integrate Foundry in Hardhat project or viceversa? How is the key parameter for parseJson to be used? I've only gotten the function to work when I don't use that parameter. like `jq`-style params check the tests The tests only appear to use parseRaw in StdCheats.t.sol but I think I see how to use that for my purposes.",487
1330,foundry-support.txt,"Oh, the arg for parseRaw *is* the key and you just call it on the json. I wasn't providing the ""."" i cant use forge-std since it says 'error[6275]: ParserError: Source ""ds-test/test.sol"" not found: File not found. Searched the following locations: <currdir>""' then I do forge install and get `error: pathspec '<currdir>/lib' did not match any file(s) known to git` do you have it in lib folder? no neither ds-test nor forge-std were there so i manually pasted in the github repo contents and then it worked, weird that it didnt work w foundry; i dont want git tracking the /lib folder if it can be regenerated is there breakpoint debugging at all Nope Is it not possible to decode JSON into values of bytes6? In StdJson, I only see bytes32 as well. hey guys! help me please. My environment is windows WSL. I can source .env and echo the $TheKey no problem from the terminal but I cannot read it from the forge script test file by using vm.envString(""TheKey""). It raise up the error: Failed to get environment variable `TheKey` as type `string`: environment variable not found is there a way to get “—watch” working on foundry scripts? eg re run this script every time a file changes honestly ig i can just shove it inside a test thread 'tokio-runtime-worker' panicked at 'Should not be called. Code is already loaded.', evm/src/executor/fork/backend.rs:455:9 note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace getting this error while using anvil...is this something i should open an issue for? this doesn't read from an env file https://book.getfoundry.sh/cheatcodes/env-string Yes, bug Pls share repro here...or on gh anyone got a repo using extensive foundry fuzzing best practice way? any pseudo-randomness available via a cheatcode (without having to resort to ffi)? block.difficulty appears to be 0 done Has there been changes to the broadcasting part of ´forge script´? I feel like in the past it could handle large amounts of broadcasts better.",471
1331,foundry-support.txt,"Anyone else with that feeling? nvm just Alchemy that can't handle it I am currently building a Foundry project that imports multiple other Foundry projects that share naming conventions for certain files. For example, both projects share a file at the path interfaces/IERC20.sol. As a result, I am getting the following error when I attempt to run forge build: error[6275]: ParserError: Source ""src/Interfaces/IERC20Metadata.sol"" not found: Ambiguous import. Multiple matching files found inside base path and/or include paths: ""$CALLING_PROJECT/lib/[project 1]/src/Interfaces/IERC20Metadata.sol"", ""$CALLING_PROJECT/lib/[project 2]/src/Interfaces/IERC20Metadata.sol"". --> src/ERC/ERC20.sol:5:1: | 5 | import ""../Interfaces/IERC20Metadata.sol""; | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^  Does the Solidity compiler offer any features for circumventing these naming conflicts? Hi! I'm trying to use vm.load and vm.store in my tests...I get it but not with mappings. Here an example of how I'm trying to do it...hopefully someone can help me: contract Contract {  mapping(uint256 => uint256) public aux;  constructor() {   aux[7] = 8;  } } contract ContractTest is Test {  Contract public c;  function setUp() public {   c = new Contract();  }  function testAux() public {   bytes32 resultEncoded = vm.load(address(c), keccak256(abi.encode(uint256(0), uint256(7))));   emit log_bytes32(resultEncoded);  } } Thanks in advance I don't think that is going be at slot 7? but I used uint256(0)...maybe I'm using wrong order? and should be abi.encode(uint256(7), uint256(0)) ? fuck...this was the reason...wrong order. Thanks @wilsoncusack 😉 Hello sirs. I do not understand why I get an error ""no input file found"" when I use forge script. Also when I use forge build i get a ""nothing to compile"". come habibi to securerpc.com ser public good very nice has mev protecc sure bro Hey, i'm trying to get some test coverage for an upcoming audit.",492
1332,foundry-support.txt,"I'm getting this error when trying forge coverage --match-contract <contract> even though it compiles normally with forge build. Anybody has an idea? Do you guys have a discord? Woud love to meet some of you here in devcon Bogota :) nope no discord sorry Lots of Foundry enthusiasts at Devcon, and several contributors. Files are compiled with the optimizer off when running coverage. So if you want to get coverage, you need to fix this error in your code. More info in this issue: https://github.com/foundry-rs/foundry/issues/3059 Have you figured this out? Ended up using this solution to assert an inequality: assertTrue(txHash != txHashForged); Wonder if it’s the best way though… does Anvil support websocket for local connection? how to format the --libraries argument for forge create when you have multiple libraries I tried --libraries path:name:address path:name:address and --libraries [path:name:address, path:name:address] and --libraries ['path:name:address', 'path:name:address'] and none of them are working for me Do I need to put them in the foundry.toml file in an array once I have more than 1? I managed to find where the stack too deep was happening thanks to the issue you linked. forge coverage is running now ty my man no? Maybe Doesn’t look like it lol for a test trace, is there a way to toggle showing the calldata either in place of or together with the decoded function + arguments? When trying to access a file through a forge test file, I get an error saying it can't be accessed for read operations? This was not the case until I ran foundryup earlier. I'm not sure why it wouldn't have permissions for that particular file. check fs_permissions in foundry.toml That fixed it.",383
1333,foundry-support.txt,"hello when I try forge install to install dependencies from an existing project i keep getting the error: ""error: pathspec '/Users/....../lib' did not match any file(s) known to git "" i even tried after reinstallign foundry via ""foundryup --pr 2634"" as I found this solved an issue on github, but it did not work in my case 😔 I keep getting this error when I try to run any foundry script : ""No input files detected."", so I searched in the source code of foundry and found it originated from a missing file path ""https://github.com/foundry-rs/foundry/blob/28312e7eac3622c8121cc9d2b7a83a6090cf791c/cli/src/cmd/forge/script/build.rs#L189"" This is very weird, I always give a file path when running ""foundry script [FILEPATH]"" , did anyone have this error already? I am using the last version of foundry fyi my issue was finally solved when I downgraded foundry with foundryup —commit [last commit from September] What a mess, wasted 5 hours on this Sorry confused, do we have a bug in latest Foundry? getting a weird error in a test here and not sure what i'm doing wrong. anyone have an idea? error[9574]: TypeError: Type int256[4] memory is not implicitly convertible to expected type uint256[4] memory. --> src/test/Contract.t.sol:84:9: | 84 |   uint256[4] memory nums = [int256(3),int256(683323), int256(171), int256(568847)]; |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ int256 != uint256. you can’t create a list of uint256[4] with int256s add a u before all of the int256s to make them uint256s or change the list type to int256[4] oh god i am blind sry about that lmao happens lol How do I disable this optimization? that’s not an optimization it’s invalid solidity well shit rofl wow i was wondering the same doesnt work? gonna have to wrap them each with uint256 brutal.",484
1334,foundry-support.txt,"thank you! solidity type inference kinda sucks in lists is it possible to test internal funcs, or do i have to set them to public while testing? since theyre called frrom the tester contract my guess is no? typical way is setup a harness contract in the test that inherits from your contract, with a public function that just calls the internal one Ahh i see, thx any idea why this isnt working? (uint256 startX, uint256 startY) = getCirclePoint(curr, 16); (uint256 endX, uint256 endY) = getCirclePoint(next, 16); uint256[4] memory points = [startX, startY, endX, endY]; emit log_array(points); its giving me: Compiler run failed error[9322]: TypeError: No matching declaration found after argument-dependent lookup. --> src/test/Collatz.t.sol:89:18: | 89 |    emit log_array(points); |     ^^^^^^^^^ Note: Candidate: --> lib/forge-std/src/Test.sol:21:5: | 21 |  event log_array(uint256[] val); |  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Note: Candidate: --> lib/forge-std/src/Test.sol:22:5: | 22 |  event log_array(int256[] val); |  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Note: Candidate: --> lib/forge-std/src/Test.sol:23:5: | 23 |  event log_array(address[] val); |  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ How does one debug Etherscan contract verification failures? is there any asserttion library in solidity that lets you assert approximately to get rid of rounding deviations? any ideas why i'm getting this verification issue? confirmed etherscan api key is right You need to convert points from uint256[4] to uint256[] Did they make some breaking change in the api? Can you verify otherwise? This error says that you're forbidden from accessing the resource? There's some in various repos, I think there was an assertApproxEq @msolomon4? Not sure, I created a new Etherscan API key to use and now I'm straight up getting Invalid API Key - curious to see if others are experiencing the same (on Goerli) Pls open an issue which reproduces the bug And we'll investigate my bad was looking in ds-test where there are none.",501
1335,foundry-support.txt,"forge-std has it indeed is there anyway to run coverage on a specific test or path forge coverage --match-path doesnt seem to take effect like it does for running tests for example Anyone have a good system for automatically verifying contracts deployed with CREATE3? Hey everyone ☺️ I am working on a time sensitive project that is using UniswapV3 (0.8 branch) in Foundry. I have installed z3, solc_select and all solc versions using svm. However, the core V3 contracts are in 0.8.12 and the periphery ones are 0.8.15, this gives an error when I run forge b, saying source file requires different compiler version. I have solc_version = '0.8.15' in my foundry.toml for now because auto_detect_solc gave many versioning errors Does anyone here have an idea of what I could try next to compile these files? I am thinking I could possibly make 2 lib folders for the different versions? can you try relaxing the pragma? i.e. ^0.8.12"" there are absolute and relative tolerance assertion helpers in forge-std, assertApproxEqAbs and assertApproxEqRel Thank you I relaxed the pragma in the Uniswap lib and it is working now! is theres a way to forge build with bytecode? With forge coverage I get a yellow if branch if I have an external call in the branch Is that normal? visually: I'm seeing some fairly long slowdowns in anvil w/ my testing suite. I do a lot of: 1. send transaction w/ web3.py 2. wait for transaction receipt w/ web3.py When I start anvil beforehand and watch the logs in stdout, I'll see the transaction received from 1 and then a very long series of ""eth_getTransactionReceipt"" while web3.py polls waiting for 2. It can be as long as 3-5s before a receipt gets returned. It seems like anvil should be defaulting to mining a new block every time a transaction is submitted. Any suggestions for better diagnosing this? Looks like maybe this was the same issue w/ forge scripts? but I don't see a solution Hi! We would like to somehow disable the Anvil non-standard methods.",472
1336,foundry-support.txt,"What is the suggested approach for that? no way to do that rn whats the issue? It does how long does veirfication take? I deployed/verified and it says verify successful in the output but theres no code on arbiscan (using arb goerli) is it suppose to be instant once it says verified in the output? this might be related, but im trying to verify on arbiscan goerli. the output gives me a link to https://goerli-rollup-explorer.arbitrum.io though. and my api key is from arbiscan so i dont see how it could have succeeded on https://goerli-rollup-explorer.arbitrum.io Is there a way to have fixtures in foundry? We want to host an instance for “educational” purposes and only want to give access to standard methods goerli verification (via forge script broadcast) not working for anyone else? Ser, thanks, but how?🤣 I think is ws:// rather than http:// Wut? Thats just a ws and http, how is it connected to producing contracts bytecode 🤣🤣 can anyone point me to a good resource for running chainlink mocks in foundry It’s the web socket protocol have you checked this? https://github.com/smartcontractkit/foundry-starter-kit also the goat Patrick did some video about https://www.youtube.com/watch?v=pgh74-XulXg Is it possible to invoke a function on a contract in tests, with eth attached? I have a function which uses msg.value. I couldn't find any examples of that. use the deal cheatcode to give the caller eth and when I invoke the contract function that amount will be set in the transaction? I'll give that a shot much appreciated You’ll probably want to use the call function so you can specify how much eth to send to the func Thanks Mr. Ash, I'll look for that and give it a shot. Deal doesn't set the value in the txn, just funds the account. Much appreciated. @d4rksid3 that worked. Appreciate it. That said, If the call reverts it's not obvious why, and breaks the vm.expectRevert behavior. I assume the bytes memory contains that info, so maybe I can emulate emit a revert. yeah, revert(string(data)) in a helper function if not a successful call. Ok, onward.",496
1337,foundry-support.txt,"hi, i'm trying to call transferOwnership(address) using cast call. i'm getting the response 0x. what might this error mean? cast call 0x7fFBdc55e4dAB65C5a750fc4E0b499287ff3909A ""transferOwnership(address)"" 0x190803C6dF6141a5278844E06420bAa71c622ea4 --private-key xxxxxxxxxxx use cast send to submit transactions Is there a way to pass a unique array of values as input during fuzzing test? `function testPush(uint24[] memory numbers)` Hey friends, i'm currently doing my first steps in foundry. I'm tryig to write my first test case and want to console.log some informations. i tried importing console and console2, but if i log something, it doesn't show up in my console. any suggestions? you need to run it with the -vv flag ooooh. thanks, it works the foundry book is super helpful. The project is been developed fast but some bits might be out of date https://book.getfoundry.sh/ also see pinned message https://book.getfoundry.sh/reference/forge-std/console-log i was here and couldn't find it https://book.getfoundry.sh/forge/tests?highlight=-vvv#logs-and-traces Using assume doesn't work ? looping for each element - 1 and check that current != next hi all. What is the use of FOUNDRY_FUZZ_SEED when doing forge test? Based on my pro dev expertise it’s the seed for the fuzzer’s random number generator Thx! In what situation would you set it to a particular value? If you don’t like the random numbers that it’s using for testing you can change the seed You could set a script to change the seed everytime you run also idk what the default is tho, maybe it’s already changing every time based on the current datetime or something In that case you could set it to a specific value so you know the exact same test inputs are used everytime (eg you are chasing a bug revealed by a test case failure) makes sense. thank you. Is there a way to deploy contract to a preset address (e.g.",467
1338,foundry-support.txt,"deploy erc20 to address 0x000…3)? Tried using vm.etch but it’s not equivalent to a contract deploy that should be the easiest in a unit test. what are you missing? Hello there, my conracts are taking waaay more time to compile than previously (takes minutes to compile), is there any way I could debug this and find out what's causing this slow down ? Thanks ! Did you use via-ir? Yes I do Try RUST_LOG=ethers=trace forge build Via-ir is too slow I think I've always used it and I only noticed the slow down recently. What would you recommend then ? Currently running I do see it's correctly compiling and linking my contracts and ends with ""Solc 0.8.17 finished in 96.65s"" Mostly using it for stack too deep errors Yeah it’s via-ir i think hm Hi All, need some suggestions on using vm to give ownership of timelock to an address vm.startPrank(address(Timelock)); //Need to give ownership of Timelock to Deployer here vm.stopPrank(); you should prank the owner address not the timelock contract Tried that but keep getting - [FAIL.",253
1339,foundry-support.txt,"Reason: TimelockController: sender requires permission] Btw without the code is hard to help essentially you are right, I am forking a chain so the pranking the owner address should work, I maybe missing something Under the tutorial - https://book.getfoundry.sh/tutorials/forking-mainnet-with-cast-anvil - Forking Mainnet with Cast and Anvil instead to exporting accounts and variables with the export command , in this manner export ALICE=0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 export DAI=0x6b175474e89094c44da98b954eedeac495271d0f export LUCKY_USER=0xad0135af20fa82e106607257143d0060a7eb5cbf Can I save this variable in the .env , like this ALICE=0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 DAI=0x6b175474e89094c44da98b954eedeac495271d0f LUCKY_USER=0xad0135af20fa82e106607257143d0060a7eb5cbf or do i need to define that in foundry.toml ? you can export ALICE=0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 in your .env file then .",314
1340,foundry-support.txt,".env in your shell to access them ───────┬──────────────────────────────────────────────────────────────────────── │ File: .env ───────┼──────────────────────────────────────────────────────────────────────── 8 │ export ALICE=0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 9 │ export DAI=0x6b175474e89094c44da98b954eedeac495271d0f 10 │ export LUCKY_USER=0xad0135af20fa82e106607257143d0060a7eb5cbf ───────┴──────────────────────────────────────────────────────────────────────── ALICE=0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 1686045944718512103110072 DAI=0x6b175474e89094c44da98b954eedeac495271d0f 580635656940801045997117 LUCKY_USER=0xad0135af20fa82e106607257143d0060a7eb5cbf 32333773072760022936490279 Thanks method works Someone posing as you @gakonst Messaged me to follow up about something I posted in here recently Same Hi guys, I have a question, how to do web3.eth.getStorageAt in foundry? Hey everyone, I’m running into a strange issue with forge verify-contract on Polygonscan. It’s working like a charm for my implementation contracts but when I try to verify the proxies themselves it’s not going through No errors when running the command: forge verify-contract --chain-id 137 --num-of-optimizations 200 --compiler-version v0.8.11+commit.d7f03943 0x3cb95635f9b2321e174Cb22f41D13ac1ADD478B0 lib/openzeppelin-contracts/contracts/proxy/transparent/TransparentUpgradeableProxy.sol:TransparentUpgradeableProxy $POLYGONSCAN_API_KEY Submitting verification for [lib/openzeppelin-contracts/contracts/proxy/transparent/TransparentUpgradeableProxy.sol:TransparentUpgradeableProxy] Ok(""0x3cb95635f9b2321e174Cb22f41D13ac1ADD478B0"").",499
1341,foundry-support.txt,"Submitted contract for verification: Response: `OK` GUID: `vzpiiu8d4itntje1dajvc1qbch1krltibr58k7mtqmfq1nwkh4` URL:   https://polygonscan.com/address/0x3cb95635f9b2321e174cb22f41d13ac1add478b0 But it just never shows up as verified on Polygonscan. The strange part is that this only seems to happen with the proxies. Anyone run into something similar before? Yikes thanks, not me obviously vm.load Yes I got that impostor in my dm as well vm.startPrank(Georgios) when i local test i need random number, how i get random number There is a possible scam account in this channel that is impersonating @gakonst same Question, if you vm.prank and address and console.log address(this), shouldn't show the pranked address? god I love you so much! vm.prank is a EOA account, address(this) is the contract address Maybe its my logic reasoning but between [vm.startPrank(address(EOA)) //some code vm.stopPrank();] address(this) should show EOA Hello, I'm MB. A very nice and polite guy. Is there a forge/cast/anvil version for Raspberry Pi 32-bit? @gakonst is there a way to emulate eoa txs through a test? So that its not a contract - contract call but eoa - contract tx.. since gas usage is different can foundry can get transaction or block like web3js ? Check cast how to convert hex to number? Hi All, how to I emit log of current owner of a ownable contract? Seems like there is a _check function in Ownable.sol but contract I am testing does not have a check u can try forge test -vvvv ... https://book.getfoundry.sh/reference/cast/cast--to-base thx ,usefull how does foundry deal with address overload on a forked environment? In one of my tests a contract deploys to 0xCe71065D4017F316EC606Fe4422e11eB2c47c246 and now i found out that this is also the address of an EOA on ethereum. All basic calls to the contract fail in my test.",495
1342,foundry-support.txt,"I cant really find any other reason why they would be failing but this address overload. But im not sure if thats really the root cause. so I have to work with shell command? is forge test the fastest tool to simulate multiple transaction (with a contract test) on a forked network? or are there faster way to do it? start a ganache server and run multiple txs seems slower. I am asking bacause someone is able to run simulation on forked network faster the me and keep frontrun me. Or is there some way to make forge test faster? hi! I want to use console.log in tested (app) contracts during testing phase, and I have added 'import ""forge-std/Test.sol"". should I remove this dependency and all console.log lines before compiling and deploy? if they are in your contract and not in the tests yes, forge doesn't remove anything should be the fastest out of the known/popular tools... your bottleneck would probably be the connection to the fork URL They are probably similuating the entire dapp locally(like rewriting uniswap with ethers) , which would be faster hey been playing around with anvil for mainnet forking - really nice tool I need to simulate some txs at the head of the chain and then get a state change for an account currently using anvil --fork-url and then sending requests to localhost:8545 I need to run quite a few simulations per block to the point where anvil no longer fits the bill really i need a modified geth-client that has something similar to eth_callBundle but instead of getting the coinbase diff enables you to get a specified account diff Ideally looking for a lighter weight implementation if possible for now that doesn't require spinning up a geth node anyone got any ideas on how to approach this or if the geth node is probably the only viable solution Thanks forking is done with anvil , which is the equivalent of ganache but faster is it faster ? Hi guys, Rafael from VHS (zed run) is having issues with his telegram account. I’m forwarding his messages I've also instantiated it properly Im trying to read a json using stdJson. Forge Version: forge 0.2.0 (b554ab1 2022-10-17T00:06:32.259173Z). I've ran forge update (so up-to-date TestStd contract).",486
1343,foundry-support.txt,"I'm following exactly this: https://book.getfoundry.sh/cheatcodes/parse-json?highlight=stdJson#instructions with a few modifications. I've also instantiated it properly but I still get a weird error... Sending screenshots question; at compiling, does SOLC use modifiers by evm`JUMP` opcode, or depends on optimizations runs? ganache-cli vs anvil, forking , benchmarking via hyperfine - command - cast age real benchmark vs EVM execution should be much faster Real u mean like , actual deploys ? I'm still not an expert in all this atm lol I just found out that the behavior of new Contract{salt: s}() in a script varies if we're in a vm.broadcast() or not: - in a vm.broadcast(), it will use the default create2 deployer (`0x4e59b44847b379578588920cA78FbF26c0B4956C`) - outside of a vm.broadcast(), it will use address(this) as the create2 deployer is this expected? (using `forge 0.2.0 (b554ab1 2022-10-17T00:11:04.364067Z)`) I'm not familiar with the internals of Foundry but that sounds correct to me. If you are not in a vm.broadcast then it is just running code inside the current contract like regular solidity, so address(this) will be the origin of the deploy. I could be wrong though but you need to keep restarting anvil to get the latest block/state, otherwise you will just simulate on old data. I think is faster because it cache some rpc request response, like getBlockNumber since once you start anvil the block number is always the same. isn't it? could you expand on this? rewriting uniswap with ethers? Some fake @brockelmore is trying to hack me. Interesting - how? What if I deploy contract with imported forge test deps? Is there some vulnerability maybe? can you send me the copy and pasted username? (likely the name is spelled slightly wrong) Hi all! Does anyone have experience using Ledger with forge script on Windows? I'm getting an error that says ""Ledger Device not available"".",464
1344,foundry-support.txt,"I've updated rust & foundry to latest versions, and trezor appears to work fine for mainnet ye there is a fake with a capital i instead of L in my name i now have a telegram subscription so if you don’t see a little star next to my name it’s not me (and even if there is, it may still not be me) Yikes Hey guys There is no gasreport for fallback calls? oh that’s definitely an oversight can you create a feature request as an issue on the github? Yes will do thanks hey is there a feature for anvil that keeps the server running but allows you to reset the chain back to the head of the ""fork-url"" - ie a custom api call where you can call reset and a block number/""latest"" to drop the current state and switch to the specified block? I know this is a financial burden , but core members should have a star ideally, the scammers r now harvesting information and finding potential targets , for some monkey business Guyz please note i will be blocking and reporting all DMs , please @ me here instead check anvil_reset Amazing thanks, missed this in the docs in case anyone is interested curl -X POST --data '{""jsonrpc"":""2.0"",""method"":""anvil_reset"",""params"":[{""forking"": {""jsonRpcUrl"": ""https://eth-goerli.g.alchemy.com/v2/xxxxxxx"", ""blockNumber"": ""latest"" } }],""id"":1}' -H 'Content-Type: application/json' ""http://127.0.0.1:8545"" From the docs anvil_reset Reset the fork to a fresh forked state, and optionally update the fork config Which means you have to restart anvil to get the latest block , for testing locally , if I want to test a dapp with new contracts , i would deploy to testnet instead of doing it on a local node I use local node only because it is faster and anvil lets you do other things such as impersonate accounts etc Hey all - is there an easy way to save the state of an Anvil VM to disk for future use? Pretty useful for testing, especially when it takes time to recreate the state I want to test. Ganache has a similar feature [here](https://github.com/trufflesuite/ganache) with the --database.dbPath flag which allows you to point to a locally stored chain.",492
1345,foundry-support.txt,"I know that vm.snapshot with revertsTo in the context of tests work, but would like to spawn a new instance of Anvil w/ that state already existing on disk I get this when trying to verify using forge verify-contract error: Invalid value ""celo"" for '--chain <CHAIN> I have an entry in foundry.toml for celo under [etherscan] hey folks, I was wondering what address is used to send test suite transactions, I'm trying to make a merkle tree whitelisting feature which I want to test coming from hardhat I'm a bit new to the foundry regime see the manual there is an option for this what ? are u asking what is the default deployer contract in foundry or something else ? I'm asking who would be the msg.sender in constructor in the tests gm, is out/ not ignorable? it is added to gitignore by default so I have to believe it is Hey all! We got some strange git diff in out/, even after forge cleaning/rm -rf out/, forge test && git diff will return a difference, any idea why? (aka does forge test changes something in the out json's?) it's compiler artifacts, you should not include them in the first place so I can't tell you ya ,those should be in .gitignore yh, not worried per se, but code4arena reviewers are':) they are;) Narrator: they weren’t ~I guess you can recreate on whatever repo, with out/ gitignored, just run ~ stupid typo in gitignore ,:) (I know this is quite irrelevant/low importance but I'm now curious on what's happening there) I think the deployer contract address was indeed what I was looking for. it works now, thanks hey is anyone having the issue with forking arbitrum with scripting to test? I keep getting that my script ran successfully but errored that gas could not be estimated for the tx. I tried setting gas manually and that did not work. Noticed a few people mentioned they were having a similar issue and saw an open issue in the foundry repo but wanted to see if there were updates on this. When testing someting like contract.mint{value: price}(); when the contract requires a certain price like 1 ether, it reverts, but when price is set to 0 ether for require and value on the call, the test passes.",494
1346,foundry-support.txt,"The require statement is require(msg.value == price, ""Not engouht ETH to mint""); Not getting the 'not enough ETH to mint' message, so seems like the prank address has eth to send. Don't know why it's reverting with any value other than 0. Any suggestions? Tyring to debug the function and it crashes with a Message: unknown ic for pc. Thansk for any help! If I have bytecode hex in a file on disk what is the best way to load and deploy it during a script/test in foundry? Simply using readFile gives me the bytecode as a string. Is there a good way to convert that to bytes ready to deploy? deploying the foundry solidity scripting tutorial to arbitrum works , with no errors https://i.ibb.co/4YDsVgZ/ta2.gif yeah i just reran the same command and it worked this time around. Weird can you try vm.readFileBinary? are you sure it has ETH? use hoax (from forge std) instead of vm.prank to make sure, and also foundryup since there may be better error messages lifesaver! Thank you. I had an old version of forge-std that didn't have readFileBinary. Update and we gucci Hi there, is there an easy way to sort of have a foundry scrip that loop on all contract sources and deploy them ? Instead of manually having to write things like ""C1 c1 = new C1(); C2 c2 = new C2();"" etc. Thanks ! @DaniPopes Thank you, that worked! Hey team -- am I missing something here? This isn't really a security issue since it's local, but it's messing up our tests that use Anvil as a backend --> https://github.com/foundry-rs/foundry/issues/3511 could you check if the signer even applies EIP-155, meaning if it sets the v value of the signature accordingly? Yes, this appears to be exactly what's going on. Verifying how this is possible on the Rust side since it appears to set the chainId here https://github.com/gakonst/ethers-rs/blob/ff754263a356fe39bcfb38b1c945fd166fd204dd/ethers-middleware/src/signer.rs#L250 Much appreciate your help.",482
1347,foundry-support.txt,"I'll verify the details and close the issue 🙏🙏 Alright well I'm still stumped on this. In ethers-rs, the v value is being set correctly (v = CHAIN_ID * 2 + 35 or v = CHAIN_ID * 2 + 36) in the signature. But the tx is still succeeding without any issue even if the chain id is explicitly set to be something other than the locally running anvil chain. I no longer think this is something wrong with Anvil, evidenced by the expected failure in the JS code if you explicitly set the wrong chain id. This seems like an ethers-rs issue, but I've been combing through the code and haven't spotted anything yet. Thanks for checking this, will write some tests for that Does forge verify-contract work with blockscout based explorer APIs? hey hey! not sure if that's a proper way to do, but is there a way to fork current mainnet to anvil and execute vm.pranks, let's say I want to have interactive environment to test execution? or better to use something like tenderly it should, you can select the verifier, check --help and book Is there a way to set this in foundry.toml? So if I choose a chain it should know which type of verifier I'm using? did anyone upgrade foundry to the latest version? I cannot test even the example after upgrade. `forge 0.2.0 (fb4a836 2022-10-18T00:07:33.891597Z)` or anyone can help me with your current using version: forge --version, so I can revert to previous version the latest is  forge -V forge 0.2.0 (870da6f 2022-10-19T00:07:47.952582Z) what error are you getting when you run the tests? no error emit works fine for me , but im using 0.7.1 still the same issue try deleting ~/.svm and running test again ^ this. if that doesn’t work, did you literally do forge init followed by forge test? also what platform are you on? windows, linux, mac? it works! @SamuelDare thanks! Quick follow up on this: I've now discovered that it matters if you start Anvil from within a Rust script vs from the command line.",494
1348,foundry-support.txt,"Starting from command line throws the wrong signer error. Starting from the script doesn't. Trying to figure out if this is a version problem or config problem. Here's the config I'm using to start this up: let config = NodeConfig::default() .with_tracing(TRACING) .with_port(0) .with_chain_id(Some(45)); let config_clone = config.clone(); let (api, handle) = anvil::spawn(config).await; can you try set_chain_id instead? I've confirmed that the chain_id is appropriately set (and different). let chain_id = provider.get_chainid().await.unwrap(); println!(""Provider chain_id: {chain_id:?}\n""); But let me try that real quick But I also just build Anvil from scratch from an old commit, ran it and it didn't fail with the chain ID So I'm thinking this may be a version problem (I had a commit checked out from like 6 months ago) there's a difference between the two set/with chain id functions that concerns the dev signers, I can see how this is a potential pitfall Yah this didn't help OK I've just confirmed this is a version problem. Commit 5c078f5 doesn't care about the chainId. Master cares. So I need to upgrade. I have the latest version as the CLI, but my Rust code has an older commit as a dependency. Thanks @mattsse for your help and attention here. Custom errors failing showing in log as EvmRevert. does anyone know how to get the actual revert function in the log> i used -vvvv and it still say generic revert cast w n k1 this generates a new json keystore UTC , if i import this into metamask and supply a password , I can get the private key , is there a CLI method for this ? or maybe a crate I can use and figure out how to write the .rs ? ok i can see web3js has a decryption function, will try it out with that I see that there is a diff function for snapshot. But is there a similar one for gas-report. I ran into a similar situation. What's your solution? I'm using —gas-price 0 in anvil to set the initial gas price and right after checking with cast gas-price shows a super high number like 1 eth.",481
1349,foundry-support.txt,"Is this normal? now each of my tx's consume a lot for some reason Seem like —gas-price isn't working? Raised the following issue https://github.com/foundry-rs/forge-std/issues/194 Would appreciate feedback from the team - would be happy to PR this as one solution could just be to update some imports in forge-std Hey, i've a problem. maybe someone knows the solution. i deploy and verify a contract using the following comment: forge script script/MyContract.s.sol:DeployMyContract --rpc-url ${GOERLI_RPC_URL} --private-key ${PRIVATE_KEY} --broadcast --verify --etherscan-api-key ${ETHERSCAN_API_KEY} -vvvv but i receive the following warning: We haven't found any matching bytecode for the following contracts: [0x....]. This may occur when resuming a verification, but the underlying source code or compiler version has changed. any ideas, why i'm not able to verify the contract? ok solved. idk the actual problem, but i solved it i set the solidity version of MyContract and the Deploy script to an explicit version (0.8.17 instead of ^0.8.17) cast wallet new keystore Error: No such file or directory (os error 2) any idea how to solve ^^? cast wallet new uses outdir path mkdir keystore cast wallet new keystore or just cast wallet new ./ oh, thanks, im dumb lol hmm, any way to get the mnemonic from the keystore? it is actually a bit unintuitive, I was also thinking that you need to give file name I think it stores only the private key. Any reason the mnemonic will be more usable over private key? for some of our scripts we are hardcoded to use mnemonic, but its possible we can change it oh, I see is it possible to run a cast call on anvil that is running on a different server? we have a persistent anvil server on GCP, and we wanna cast call to it --rpc-url so bascially cast --rpc-url $RPC_URL call ....",428
1350,foundry-support.txt,"? Pls check the docs and play around with the params :) options go after the command, cast call --rpc-url alright :) thank you! man the support team on foundry is amazing Hi guys, is there non-CLI inteface of foundry? I'm looking to build a rust/python application and use some of the functionailites of the forge test module Me and my team are trying to run a GCP server that will continuesly run anvil on it. We want to be able to deploy contracts using foundry scripts. The have a server endpoint that exposes the anvil port , but when I make a cast call to it, it doesnt return any respons. the call looks like this: cast call --rpc-url https://mycompany.whatever.come:8545 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48 ""balanceOf(address)(uint256)"" 0x72A53cDBBcc1b9efa39c834A540550e23463AAcB but when I run it directly with the Alchemy RPC, im getting a response I assume I cant use the alchemy url to deploy the contracts because it wont actually direct them to the anvil running on the GCP worth mentioning that when i am saying deploying contracts, I mean running the forge commands on a remote rpc, meaning on the GCP server Hi people, what to do in fuzzing when the following error pops? [FAIL. Reason: The `vm.assume` cheatcode rejected too many inputs (65536 allowed)] Foundry Support Got a clue, use bound. I will try and report back trying to increase the number of fuzz tests. I've got [profile.default] runs = 1000 In my foundry.toml but it is still running the default amount. How else can I debug this? thanks try with [fuzz] runs= 1000 No dice... still 256 runs forge build forge test no files changed, compilation skipped.",422
1351,foundry-support.txt,"and then same result You need to build after changing the toml? anyone ever had problems deploying to a tenderly fork from forge script / forge create? we're seeing message: not supported response try —legacy maybe (not sure / havent seen this issue before) hmm will try thx ok that seems to have worked hahaha getting this error on forge instal error: pathspec '/Users/supernovahs/Desktop/Audit/2022-10-3xcalibur/lib' did not match any file(s) known to git Is is automatically adding lib to the path even though its not there How to uninstall foundry ? rm -rf ~/.foundry confirm here that bound did the job. is there a way to test inherited functions in a contract? i can grab the selector but i am unable to call it on the contract that inherits? i would even be OK mocking it My forge script doesn't work. I am running forge script ./script/DeployDutchLimit.s.sol --rpc-url=https://mainnet.infura.io/v3/XXXXX and I get the attached error. I am on forge 0.2.0 (3858d18 2022-10-20T00:18:19.593714Z) My coworker can run the exact command with the exact same forge version successfully. im just gonna create overrides is your constructor reverting? is there a way to mock functions return values for the contract im writing tests for? like provide a value from the view functions i use within the function im writing tests for so i dont have to do a bunch of stuff to get those returning values? forge fmt currently places a gap between override and the parentheses that follows. I think it looks weird. I checked all foundry.toml options and there doesn’t seem to be any. Is there some way how to not place the space there? Thank you pls open issue ^^ good find not sure I understand this. You're trying to test intermediate values in a function? Or are you trying to force a function to return a specific value? done: https://github.com/foundry-rs/foundry/issues/3522 right, we shouldn’t do that for attributes.",448
1352,foundry-support.txt,"i’ll make it a default unless smb has other pref The documentation says we need to import hardhat/console.sol? Is this correct? Sent a PR to edit this: https://github.com/foundry-rs/book/pull/675 Hi all, is it possible to use foundry with lower solidity versions? if I try to use 0.4.13 in a contract it throws an error saying that the forge-std lib requires version >0.6.0 may I ask why? yes, thank you. My goal is to test smart contracts with an older version of solidity i'm not sure. this script deploys multiple contracts, all with their own constructors How many transaction per second is anvil's mainnet fork supposed to handle? (I'm getting like 0.2 sec per contract call, as opposed to 0.007 sec when testing directly on my full node) Hi, All whats the best way to replicate a contract creation method in Foundry? i.e. Create —> Contract Method: 0x60806040 Hey, is it possible to put some delay between test cases? the man that spent his life trying to get faster tests just died ^we're getting rate limited on RPC calls in our testing runs :) we're using nodereal as it is one of the few BSC node providers that works well with forking, but they have a limit of calls per second we can make Ideally, something like anvil's --compute-units-per-second <CUPS>, if that makes sense ? are you responding to my question? I checked, foundry's repo didn't specify such argument No, I was complementing the question from @lucifer_0125 , we are working together in the same project How can I 'forge create' a contract, in a test contract running on a forked network example: vm.startPrank(EOA); //EOA create contract deploy to EOA2 vm.stopPrank(); well that's my guess.",406
1353,foundry-support.txt,"Might wanna debug by commenting the whole constructor code Found a deplycode function in test will experiment with it, thanks Has the conversation ever come up about using foundry for things such as indexing events over a time period? Also curious about whether it's possible to get all storage writes similar to vm.accesses over a time period or whether anyone would know a tool that would allow me to do that easily it seems it can be done with this - https://web3js.readthedocs.io/en/v1.8.0/web3-eth-accounts.html?highlight=decrypt%20#decrypt , - for the noobs here is short I made on this - https://youtube.com/shorts/5mGLxDybwN0?feature=share ( doesnt take into account every edge case , just satisfying my curiosity about doing it via cli) but more relevant to people here , it can be done with this - https://docs.rs/ethers/latest/ethers/signers/struct.Wallet.html#method.decrypt_keystore Currently running a fuzzing test 10 million times, estimating to take ~1.2 hours.",231
1354,foundry-support.txt,"Anyone have any guide on multithreading fuzzing? I dont see any config options for that hello guys; i have an issue with forge script --ledger command; i get an ""Ledger device not available."" error; any idea? my forge version is 0.2.0 (d896050 2022-10-20T15:10:25.6227974Z) my ledger is connected by USB, and my Ethereum app has ""blind signing"" enabled Is it seen by your computer otherwise? Yes, it is I don't have Ledger Live opened and I disconnected my Metamask just in case hello all, any reason why foundry wouldn't work on a 0.6.X contract ? i have something in production with uses that old compiler and wanted to write some tests and thought i would like to try out foundry i have managed to forge install openzeppelin, cd into the lib folder and i checked out the old tag which I had used back in the day, so that side seems all good, and at first glance it seems to work, the question is, are there any known gotchas ? as someone who wanted to stay clear of JS, i used this goland based testing framework for a long while, https://github.com/tokencard/ethertest, and foundry looks totally awesome, thanks guys ... what do you mean wouldn’t work? what commands did you try, what was the terminal output, etc so far it is working i thought i would check if it is intended to work or if there are known gotchas before i keep investing time that is all and thanks for responding oh. then ye no everything should generally work on 0.5 and above (except in a few circumstances like macOS m1 solc builds but that’s a solidity thing not necessary foundry) ok thanks yeah i have a single, simple test executing, so i am happy and excited by using solidity to test solidity final question, did i do the right thing™ cd'ing into the /lib/ folder and then checking out the version of openzeppelin i wanted post running forge install openzeppelin ? https://twitter.com/josephdelong/status/1583904559860097025 i should have done something like this forge install foozle/barzle@v3 sorry to bother figured it out with a lil custom macro.",483
1355,foundry-support.txt,"100M fuzzing tests in an hour or so conclusion: forge is definitely not the right tool for this Hello all. Loving how fast and simple foundry is for testing. I know how to assert that an event fired with specific values. But is there a way to get values from an event if do not know them beforehand? For example an event about a new contract deploymebt address by a master contract. Onchain?...just return the address Yes that would work, but is there a solution without returning a value? if the info is only externalized via an event Hey, I am trying to run anvil with local graph node and getting the following error: Possible reorg detected, retrying, error: failed to process trigger: block #15774015 (0x10b2…cb6a), transaction a982b984489fc801d077e412e0b3e79f5acf899958ad51c62bccbcab075c4daf: Ethereum node returned an error when calling function ""totalSupply"" of contract ""IndexBetting"": RPC error: Error { code: InternalError, message: ""EVM error CallerGasLimitMoreThenBlock"", data: None } I have tried implementing a solution described here: https://github.com/bluealloy/revm/issues/135 but with no luck. Has anyone encountered this? Hey guys, I am trying to use interactive debugger and this is the error I face forge test --debug ""testStreamCreation"" [⠒] Compiling... No files changed, compilation skipped [⠑] Compiling...",329
1356,foundry-support.txt,"No files changed, compilation skipped panicked at 'byte index 995 is out of bounds of `// SPDX-License-Identifier: SEE LICENSE IN LICENSE pragma solidity ^0.8.15; import ""solmate/mixins/ERC4626.sol""; import ""solmate/tokens/ERC20.sol""; contract TestVault is ERC4626 {  uint256 public beforeWithdrawHookCalledCounter = 0;  uint256 public`[...]', library/core/src/str/mod.rs:107:9 Aborted (core dumped) Can someone help me out? hello guys; i have an issue with forge script --ledger command; i get an ""Ledger device not available."" error; any idea? My OS is Windows 11 Pro 22H2 My ledger is correctly seen by my computer How to test for payable functions? I also get ""Context: response too short. Expected at least 2 bytes. Got [ ]"" right tool for what exactly? guarantee you it’s faster than any other fuzzer in the space currently I have a function that requires you send a certain amount of ether before execution or else it will revert How do I test for that kind of function? call the function passing the value parameter Is there anyway for anvil to support this tracer in debug_traceTransaction calls? https://geth.ethereum.org/docs/dapp/builtin-tracers#calltracer Wanted to integrate an anvil blockchain with blockscout but I'm blocked by this Figured it out.. thanks @FreezyDev 👍👍 Floating this up here from @ChiTimesChi https://github.com/foundry-rs/foundry/issues/3489 How to call a single test function? --match-test Could a verbose integer print be useful? Like logging with decimals and commas so it is easier to read testing output I'm trying to check the values in a mapping with cast index but I get a long hex as output. Also for not-initialized key value pairs. I run: cast index [key-type] [key] [slot].",414
1357,foundry-support.txt,"Is this call complete? https://ethereum.stackexchange.com/questions/138034/check-values-of-a-mapping-using-foundry Answered Nice thanks what's the max block gas limit that foundry tests can be set to run on - is it maxuint256? ah i guess foundry accepts up to u256 but REVM enforces u64? I'm having a similar issue with timeouts when attempting to install solc during forge test . After running foundryup to see if it changes anything, the issue still persists. Is there a configuration issue on my side? Worked around this issue by setting a strict version for solc_version in foundry.toml. Note I was having issues with 0.8.17, but not encountering issues for 0.8.13 Hello, all. I got error on sentence deployCode(""node_modules/@uniswap/v2-core/build/UniswapV2Factory.json"", abi.encode(vm.addr(123))) The error message is [FAIL. Reason: Setup failed: data did not match any variant of untagged enum ArtifactBytecode] setUp() (gas: 0) I have added fs_permissions = [{ access = ""read"", path = ""./node_modules""}] into foundry.toml, although this error doesn't seem to be ralated with it.😢 Additionally, i remember that my code above worked with old foundry version. Hello everyone, i need helo with initializing a new foundry app.",302
1358,foundry-support.txt,"I get an exit error when i use the init command as seen below forge init hello_foundry dyld[22071]: Library not loaded: '/usr/local/opt/libusb/lib/libusb-1.0.0.dylib' Referenced from: '/Users/user/.foundry/bin/forge' Reason: tried: '/usr/local/opt/libusb/lib/libusb-1.0.0.dylib' (no such file), '/usr/local/lib/libusb-1.0.0.dylib' (no such file), '/usr/lib/libusb-1.0.0.dylib' (no such file) [1] 22071 abort forge init hello_foundry see: https://github.com/foundry-rs/foundry#libusb-error-when-running-forgecast brew install libusb You forgot to write new to deploy AuctionAttack Hi, is it possible to return any value from the script? like deployed contracts addresses? i use console or fs module to read/write json files in the foundry solidity scripts? how does that work? vm.writeFile(%path%, %json%); can I write JSON to that file? i mean what is the structure of the $json parameter? a strigifiedJSON? hey folks, any way to deploy to anvil (forking) with pranks? anvil_impersonateAcount callable from a forge script? ffi + cast seems like the only option can I pass parameters to a script> like a foundry solidity .s.sol script probably yes with reading variables pass it as argument like --argument test while running script.",321
1359,foundry-support.txt,"I'm trying to figure out how I can access said struct from my test contract now. I appreciate any help/thoughts on this. Thanks! Inherit the struct from the original contract in the test contract Have you figured this out? Also looking for an answer Hey, are there any tests already written for using governorBravo within a new repo with foundry? I know they've been audited, but thought I'd just ask. Just looking to implement governorBravo in our codebase to play around with it Hello, I am new to Foundry and had faced the same issue with him. Does anyone know any solution on this? Also, i have the same issue when I tried to execute ""Approve"" function on USDT contract on mainnet forking network. [FAIL. Reason: Setup failed: EvmError: Revert] So, it is not Vyper specific issue. that seems mainnet forking issue? Your kind advise is highly appreciated. To add explanation, it does not emit any trace information even if execute forge test with -vvvvv option noticed something weird the contract ordering is all off when running verify-contract now? or maybe only just for deterministic deployments? Tangentially related, one of my repos builds on-top of OZ governance which is built on top of Compound's Alpha and Bravo. It has at least some calls you might need, but I'm not aware of something more comprehensive unfortunately. https://github.com/devanonon/ERC4626Votes @Jide20Karat_Dev to answer your question, you can use dot notation to reference it like so: Struct.attribute = 1. Usually the struct is attached to a mapping so it's like Struct[address].attribute = 1; You can also set a struct like this. Kinda neat trick, you can set your data inside of an event emit The event expects the struct event TransferRequestCreation(TransferRequestRecord record); Just be careful that you're executing the emit before any external calls I am trying to use stdstore as explained in the docs but getting this error: error[9582]: TypeError: Member ""checked_write"" not found or not visible after argument-dependent lookup in struct StdStorage storage pointer.",452
1360,foundry-support.txt,"any idea of what it could be? is there a way to always deploy a contract to the same address on Anvil? Hi guys , want to ask a basic solidity question here What is the meaning of the medium block of the following code snippet constructor( IVerifier _verifier2, IVerifier _verifier16, uint32 _levels, address _hasher, IERC6777 _token, address _omniBridge, address _l1Unwrapper, address _governance, uint256 _l1ChainId, address _multisig ) MerkleTreeWithHistory(_levels, _hasher) CrossChainGuard(address(IOmniBridge(_omniBridge).bridgeContract()), _l1ChainId, _governance) { verifier2 = _verifier2; verifier16 = _verifier16; token = _token; omniBridge = _omniBridge; l1Unwrapper = _l1Unwrapper; multisig = _multisig; } I mean the part : MerkleTreeWithHistory(_levels, _hasher) CrossChainGuard(address(IOmniBridge(_omniBridge).bridgeContract()), _l1ChainId, _governance) found this https://github.com/foundry-rs/foundry/issues/2638 any docs for it? or is it not implemented yet? can anyone please refer me to a good repo that is utilizing foudnry scripts for deployment? another question - trying to deploy a new contract, getting the following error: ├─ [6963] → new <Unknown>@0x185a4dc360CE69bDCceE33b3784B0282f7961aea │ └─ ← 0 bytes of code └─ ← ""EvmError: Revert"" first time im seeing such error, paths and contract name are correct. any ideas? Is it possible to deploy a library contract with forge create? I want to deploy an openzeppelin proxy, but I can't figure out the correct syntax ...",420
1361,foundry-support.txt,"trying things like `forge create lib/openzeppelin-contracts/contracts/proxy/transparent:TransparentUpgradableProxy` getting this when deploying on local fork with scripts: (code: -32000, message: insufficient funds for gas * price + value, data: None) im using the wallets provided by anvil anyone has an idea how to solve this? Hi guys, as I am evaluating a rust EVM implementation for a project, I would like to know the reasons that made you switch from sputnik to revm; is there any discussion or document available about that? I found some information in https://github.com/foundry-rs/foundry/issues/432 and https://github.com/foundry-rs/foundry/issues/654 but I would like to have more insight Hey! On the note of documentation -- are there any docs/wikis that dive deep into the architecture? specifically of Anvil. Ideally, something to help new contributors onboard to the codebase. Have been reading through the codebase which is very clean, but wondering if there are additional resources. Thanks 🙏 Specifically interested in the differences between the InMemoryDB and ForkedDb and how memory is managed during a mainnet fork. Doing some initial benchmarking against hardhat I'm seeing that Anvil dispatches many more archive provider HTTP requests than hh, so thinking there could be a potential win for fork caching. Additionally, would love to create a PR to support anvil_loadState and anvil_dumpState for mainnet forks. Hi guys, any idea why I keep getting the same address when I deploy a vyper contract using the VyperDeployer contract? Hi guys, I have a contract with pragma solidity =0.8.x which calls Uniswap V2/V3 functions through their interfaces. To write tests for my contract, is it possible to create/deploy Uniswap V2/V3 contracts even if these have pragma solidity <0.8 ? I think it's possible to do this with hardhat as you deploy your test contracts independently by using javascript/typescript.",425
1362,foundry-support.txt,"For things like that I'd just copy the interfaces into my directory and change the pragma version I made a PR to add memory safe notation in forge-std, not sure where to ping for visibility https://github.com/foundry-rs/forge-std/pull/196 @brockelmore (Instead of importing directly from the submodule/npm package) I don't have problems using the interfaces. I'm mostly stuck with using the real Uniswap V2/V3 contracts with my tests. I know there is 0.8 version of Uniswap V3 contracts - https://github.com/Uniswap/v3-core/tree/0.8 but I'm hoping to use the original contracts as I want to use them in my tests only. Would it be easier to run a fork of mainnet and use the interfaces with the deployed contract addresses, or does your testing require a local/fresh instance of uniswap? I can definetely try to run my tests on a fork of mainnet and use real deployed contracts. But I can say local/freash instances of uniswap has the advantage of getting consistent results within my tests. What about forking at a specific block? That’s a good idea. is there any way in foundry.toml config to override solc for certain files? a la https://github.com/Uniswap/v3-periphery/blob/b06959dd01f5999aa93e1dc530fe573c7bb295f6/hardhat.config.ts#L89 in hardhat for reference, getting stack too deep in a dependency which is meant to be run w/ via-ir, but i dont want to compile my whole project with via-ir :D asking here bc dont see any such config referenced in https://book.getfoundry.sh/reference/config/solidity-compiler hello, i have a custom error in a contract called ConditionNotPrepared. its very strange, but when i revert with this error in my tests, a PRECOMPILE ecrecover is called and the execution reverts with EvmError any idea what's going on here? is this some weird collision? I can use a different error and it works fine. it also doesn't execute the precompile if i revert with the error in the made body of the test actually, its my vm.expectedRevert that's doing it....",486
1363,foundry-support.txt,"if i change the expectedRevert to a different error, it no longer performs the ecrecover and reverts as expected Hello, I am trying to deploy a contract using forge script but I'm receiving a following error. Am I doing something wrong? (removed path to project) $ forge script script/Deploy.s.sol --fork-url $RPC_URL --private-keys $P_KEY --verify --etherscan-api-key $ETHERSCAN_API_KEY -vvvv [⠆] Compiling... No files changed, compilation skipped Error: ""/path/to/project/broadcast/Deploy.s.sol/137/dry-run/run-latest.json"": No such file or directory (os error 2) Is the possible to get the output directly in ascii format in cast? Ran into that quite a few times as well. Might want to try a combination of running ‘forge clean’ and removing the broadcast folder (back it up if you need it). Can also try simulating it locally on anvil first. For me it at least always worked once I actually broadcasted with ‘—broadcast’ Your constructor is likely reverting @joshiedo there's something off with how broadcast files are read, are non existing files a hard error? i guess so. in this particular case i see that @Czar102 is calling the command with --verify AND without --broadcast in which case, forge assumes that it has been broadcasted before so when it looks for the broadcasted file, it cannot find it tl;dr - remove --verify if you just want to run the script. add --broadcast if you want to actually broadcast it Hello guys~! I am quite new in Foundry and I found Foundry a very useful tool for me to write smart contracts. I found createSelectFork is exstremely useful in my case. I am very curious how createSelectFork works actually. Are there any docs or content about explaining how it works. It was actually the problem, thank you! Wanted to make the command ready to just use --broadcast flag. Maybe ignoring --verify when --broadcast is not set would be a good idea? the error should be better for sure, but that's an intended behavior. sometimes, you deploy stuff and forget to add --verify, or the verification fails so this helps with that @joshiedo I opened an issue for that, thank you.",481
1364,foundry-support.txt,"https://github.com/foundry-rs/foundry/issues/3548 hey quick question - trying to write some data to a file, getting the following error for fs_permissions = [{access = ""read-write"", path = ""./""}] error[6933]: ParserError: Expected primary expression. --> script/InitFortress.s.sol:61:27: | 61 | fs_permissions = [{access = ""read-write"", path = ""./""}] | ^ what am i doing wrong? contract inherits from ""forge-std/Test.sol""; is there Lattice support on cast transactions? (I don't see it in the docs, but thought maybe there's some weird voodoo, like maybe --trezor works for it too or something) Is there any way to use foundry to get a list of the most recent transaction hashes from a given address? @mattsse how hard is this to implement? one blocker is agreeing on a syntax for specifying this, there's a proposal here https://github.com/foundry-rs/foundry/issues/3062 (@mtoda feel free to reply there if you have other ideas). but this granularity over solc config would definitely be helpful for me all, in my case to change optimizer runs per contract you're setting fs_permissions = [{access = ""read-write"", path = ""./""}] in a solidity file, but that line should be in the foundry.toml file: https://book.getfoundry.sh/cheatcodes/fs yo, forge test freezes after it finishes the tests. does anyone else expereince that after running foundryup ? how do you access a private key in a script via forge script --private-key? i'm using environment variables right now Is there a way to be able to use anvil like ganache, have it preserve state after forking mainnet? So that you can test deploying a contract onto it & then make some code changes to update a dummy constant address, then deploy the second batch of contracts utilizing that testnet created address? hi, im getting the following error when installing on ubuntu: ~ ➤ curl -L https://foundry.paradigm.xyz | bash Installing foundryup...",448
1365,foundry-support.txt,"Warning: Failed to open the file /home/user/.foundry/bin/foundryup: Warning: Permission denied curl: (23) Failure writing output to destination can anyone help me out? thanks :D try with sudo same error :( Isn’t that what it does by default if you run anvil —fork-url can u delete dir - $ rm -rf /home/user/.foundry/ then run install again Yup tried that earlier too, still same error ok in that case , su root , then remove then run rm blabla , then change user , and then run install this should be possible to add this, we can compile the files separately. unsure how to deal with contracts used by multiple versions then, I guess just as we do already. yea as long as the pragma for that contract is compatible with both compilation settings, it should be ok to just recompile it like you said I'm running a solidity script and then I'm getting this error Error: 0: ProviderError(JsonRpcError(JsonRpcError { code: -32000, message: ""intrinsic gas too low"", data: None })) does anyone know why? it's literallly just a basic contract deployment @karmabadger you need to manually try changing your “gas” value in your txn since the estimator you used is probably returning gas incorrectly Rn, gas is around 16-18 gwei per gas unit gas price or gas limit? and that's in the testnet, there's still that problem? Sorry, gas limit to be more specific I've tried that actually Which test net? A forked mainnet or Ropsten/Goerli/etc? --gas-limit 1000000000000000000 goerli-rollup of arbitrum Try specifying it in the actual txn payload you’re sending Where the from and nonce fields etc are located wdym? how you do that? Aren’t you sending a transaction payload via an RPC? ni no Whichever txn you sign and send via eth_sendRawTransaction, you gotta add the gas limit to that txn like I said it's a solidity script using foundry ye there is something wrong with l2 burning style txs.",445
1366,foundry-support.txt,"i believe there is an open issue for it Interesting — are you sure your wallet has enough ETH for gas? you could try —legacy Yeah I haven’t used an L2 testnet for a bit so what @brockelmore said is probably it What is the best way to write a gas test in foundry - for example, checking that a function call consumes less that 30k gas? Is it intentional that evm_revert seems to delete the snapshot we revert to (https://github.com/foundry-rs/foundry/blob/6262fbec64021463fd403204039201983effa00d/evm/src/executor/fork/database.rs#L117 )? Is there a way to inject secrets into foundry.toml? I have a project where I want to add keys to such as etherscan api key. To be used with anvil, etc... Our foundry.toml is synced with git so i'd rather not add it there directly I know there's environment variables, but do not see an etherscan env var mentioned in the docs Found it. [etherscan] mainnet = { key = ""${ETHERSCAN_MAINNET_KEY}"" } mainnet2 = { key = ""ABCDEFG"", chain = ""mainnet"" } optimism = { key = ""1234576"" } unknownchain = { key = ""ABCDEFG"", url = ""https://<etherscan-api-url-for-that-chain>"" } Hey folks i tried to run forge coverage but it fails with When compiling inline assembly: Variable headStart is 1 slot(s) too deep inside the stack. Running forge compile actually works fine. I ran forge compile once without any settings for the optimizer and once with 100 runs. Running compile in hardhat works with the 100 optimizer runs. Any idea what that could cause? I tried cleaning cache and artifacts + running foundryup again. Same result Hello, I was wondering how forge coverage handles inheritance. We are running it on our repo and getting back relatively low coverage compared to what we thought and have seen with hardhat coverage. How does forge coverage take inheritence into account like from open zeppelin or rari? Thanks! wrote a small blog around cast might help some https://inc0gnito.medium.com/openzeppelin-ethernaut-part-0x00-be38d7113110 when executing cast run 0x43...",489
1367,foundry-support.txt,"-d the contracts r being compiled , —> Executing previous transactions from the block. Compiling: TetherToken 0xdac17f958d2ee523a2206206994597c13d831ec7 Where are the contracts artifacts located ? i assume they are being downloaded in some tmp location and then contracts being compiled ? as an example , when using the static analyzer slither , contracts are downloaded locally and then being compiled via HH Hey curious if there were any plans in the near future to include support for Proxy contracts w/n invariant testing did you figure this out? nope just went away gm! what's the good way to fuzz-test an array? this looks too contrived and slow, also it says that I reject too many inputs I found out there's a helper function bound(uint256 x, uint256 min, uint256 max) used as: amounts[i] = bound(amounts[i], 1, 100); Cool. I was running into it. Found that normally if I ran forge clean it would usually go away, although not always. I closed & reopened vscode in that instance after running the clean & it worked... just so you know for the future! It almost seemed like it had to do with whether optimizer was set to true or false (true causing the issue) while having constantOptimizer set to true. how can I log out the fuzz testing numbers? Hi! I'm using forge script to deploy an upgradeable contract on Polygon and using the --verify option with POLYGONSCAN_API_KEY set in my environment, but it appears to be trying to use ETHERSCAN_API_KEY instead. The --verifier option doesn't seem to take ""polygonscan"" as an option, so does that mean I should use --verifier-url? If so, anyone know the right URL for polygonscan? I wanna make sure the fuzz testing is actually testing the right balues console.log(value)? if you inherit from Test, console is exposed to you I tried it with --verifier-url ""https://api-testnet.polygonscan.com/api"" and that doesn't seem to work either 😕 nope doesnt work console.log doesnt work with fuzz testing Well, not with passing fuzz tests anyway 😄 Good point. You could force an error with the fuzzed value: require(value != value) and see what the failure shows.",479
1368,foundry-support.txt,"Oh it's here https://i.ibb.co/FHT2btb/image.png I think I'm doing something wrong. I'm trying to get a contract to deploy on a local anvil mainnet fork. The deployment script also needs to call another contract, for which the owner is of a different address. Tried using vm.startBroadcast(owner_address), but that doesn't persist. Tried `anvil_impersonateAccount 0x... `(the address to impersonate), but all that happens is I get a null return value when I run that... Basically, need to be able to allow the script, where the msg.sender is any random address, to be able to call setVariable on the external contract & have the whole deployment persist for further interactions. Or if the whole script could run from an impersonated account & still be persistent on the local anvil network deploying with solidity scripts doesnt have the same bytecode as flattening the contract? any ideas? e.g., `forge script script/Deploy.s.sol:MyScript --rpc-url $FANTOM_TESTNET_RPC_URL --broadcast --verify -vvvv ` the flattened contract i use doesn't have matching bytecode maybe the solidity script adds something? idk how this can happen Forge build Do you guys write only unit tests with forge? Or do you also write mocha tests with hardhat? If both, which kinds of tests in forge and which kinds in hardhat? hi everyone, I can't find docs about deploying a smart contract with Foundry from a NodeJS server, could anyone share a link or quick explanation? @gakonst suggested to run Anvil but I dont see how I could do it without having to specifically have a deployment server for Smart contract build/compile...and I dont see how to do it with an SDK (only CLO examples) forge is written in rust , so there isnt an sdk AFAIK. An option to deploying to a live network would be to have the script set up and use something like child_process to make the shell calls.",414
1369,foundry-support.txt,"to the CLI binary https://nodejs.org/api/child_process.html but if running it off a node server is a hard requirment, hardhat might be a better choice fair, that's what I would like to avoid though but I understand why hardhat would be better? and do you know how Remix does it? (thanks for your help btw) do you need per-session, per-request, per-server anvil instance? I will need to compile smart contract (OZ Payment Splitter) with different input params on a per request basis remix has its own deployment pipleline , so its not really an apples to apples comparison. You can see how they do stuff via there tests: https://github.com/ethereum/remix-project/blob/ff778f25c2a7fe67e55af121c3b1e7af1cf62b51/libs/remix-tests/src/deployer.ts#L14 you probably want some queue system to emit task and then get the result once it's ready, otherwise i guess you have long running http request but what happen if the user refresh in between? you prolly need some kind of taskID at the end to process it async seems to me like it's more of a design/architectural problem than a forge/foundry one right? offtop but there’s also moneypipe.xyz alternative well actually it will be async, my question regarding Remix was misleading sorry, in my case it will be a serverless function (Firebase) which will trigger the smart contract build + deployment not fit for our solution but thanks for that ;) this is what seems to be the solution, which means I will have a dedicated server just to build smart contracts (cause the deployment could be done simply from the nodeJS server), it's just that it seems very cumbersome to have to use the server CLI with a child_process just for compiling a SC...which is why I was looking for other ideas/recommendations is there a way to make forge script or forge create avoid compiling everything, like the --skip option? I don't want those to compile my test folder since that takes a long time Is there a way to use a retry backoff when using createSelectFork? We're running into rate limits when running tests If you pin a block it should cache results Problem is that we're running such tests in CI.",483
1370,foundry-support.txt,"We do pin the block number -- any pointers on how to cache the correct directory in GHA? the actions/cache should work, foundry uses this: https://github.com/foundry-rs/foundry/blob/master/.github/workflows/test.yml#L105-L110 both subcommands should also have --skip? stellar, appreciate it we have backoff+retry by default, by this depends on the provider, infura+alchemy is supported. which provider? We run on a variety of chains, so we use a few different providers. Main one would be chainstack for BSC and Polygon. Though we've also ran into rate limits with alchemy on Polygon ratelimits are handled differently across providers, if they send a 429 then we defnitely catch that, but some send a different status code or a regular json rpc error, it would be helpful if you could trigger a rate limit then send a random verbose curl request and dump the headers+response I'll try getting that done, but just FYI here's the Alchemy logs for a 429 Not sure how helpful this is I saw this issue open on gh, does this mean that you can’t have a persistent change to an anvil local network when trying to execute permissioned contract calls as an address you don’t have the private key for? https://github.com/foundry-rs/foundry/issues/2051 Hey! I’m getting the following issue when trying to run forge test Failed to install solc 0.8.15: Checksum mismatch for version 0.8.15 I' I’ve tried updating foundry and removing my ~/.svm Huh What's forge --version forge 0.2.0 (7b9d3ad 2022-06-18T01:01:23.327305Z) Which seems outdated... having issues verifying on arbitrum gorli testnet... $ forge verify-contract --chain-id 421613 --num-of-optimizations 200 --watch 0x5f37aba6edd0d18b5878ce09dad268d65aec0869 src/Multiswap.sol:Multiswap HRUTIRNZ4RR9Y6NM914ECS8VUDMI3SYI3H Error: 0: Failed to parse chain: 421613 any ideas? i tried with diff chain..",488
1371,foundry-support.txt,"avax testnet chain id 43113 and worked great Do you need to add the address of an account that you want to impersonate to something prior to running cast rpc anvil_impersonateAccount <address> ? thnx for your reply but didnt have to do that for other chains so not sure sorry, this was a question that i've been trying to figure out. not a reply to your inquiry. but for yours, if you deploy it all using a script, you can get it to automatically verify things. this is the command I run for deploying to testnet (it's as a make command, so i put in those values that way) forge script script/$(script) --rpc-url ${TESTNET_RPC_URL} --private-key ${PRIVATE_KEY} --broadcast --verify --etherscan-api-key ${ETHERSCAN_KEY} -vvvv QQ: When you run a foundry script, it gives you a receipt that tells you the estimated gas cost to run the script. Is that cost meant to measure all within the startBroadcast/stopBroadcast codeblock? Or does it measure everything from beginning to end? Thank you ok cool ill try that route, thank you but still wonder why same syntax worked for avax fuji testnet Yes you can fork and run tests https://book.getfoundry.sh/forge/fork-testing Nope You can run the tests locally Yup I don't know why, but even though I'd run impersonateAccount & get null back, it seemed to actually be doing something because my other calls wouldn't work unless I did that first But now I'm trying to call a function on the contract I deployed locally, and I'm getting this error back? Any ideas? Tried it with variations on that, like no return (address) within the quotes. with or without quotes on the array & the 0 uint256, in hex, etcetc If you use fork make sure you pin the correct block number.. also make sure you're using the correct address and network so, I run build with forge build --sizes --skip test everything, compiles except test, then I run script with forge script script/Contract.s.sol:ContractDeploy --broadcast --slow --skip test and it still tries to [⠃] Compiling 5 files with 0.8.17 I see, probably just forgot to integrate this in script as well. will fix.",487
1372,foundry-support.txt,"😁😁 it sounds like you're not pranking the depositIntoVault() call from the address you think you are one idea, do you know vm.prank(address) only pranks the very next call? in order to prank all subsequent calls (until vm.stopPrank()), you use vm.startPrank(address) another idea is something could be wrong with your creating + selecting fork test fixture maybe try simplifying to find where things are breaking down — you could write a test that asserts all the IERC20 functions are working as you expect first balanceOf, then approve, then transfer/transferFrom How is the seed for fuzz testing determined? I've noticed that some tests report large gas usage differences when running forge snapshot --diff .gas-snapshot although the changes made do not directly affect any logic that that test relies on. More concretely I'm making small changes to one function in a library and then other tests that aren't even indirectly using that function but others from the same library are reporting gas differences. I don't think it's the codesize since some of the ""gas improvements"" are quite massive I'm also thinking for the audit we can probably just ask for donations, aiming for a 100k C4 contest we probably only need ~130k total I’ll try it later Ty ser very nice! yw Having an issue where when i run anvil and simulate on-chain txns, my computer storage is taken up pretty rapidly. Restarting my computer resets the storage, but im wondering if anyone else has had that issue? Hey guys I am trying to make getRecordedLogs work but it keeps hitting an error. Can't notice anything off, I'm just following example code from docs Know its something simple, but I'm having a hard time figuring it out :| Is there an easy way to get forge script to dump the entire opcode trace? still getting [FAIL. Reason: Setup failed: The path ""<root-dir>/some_file.json"" is not allowed to be accessed for read operations.] when I use parseJSON.",418
1373,foundry-support.txt,"tried turning on read permission with chmod but doesn't seem to help https://book.getfoundry.sh/cheatcodes/fs?highlight=fs-permissions#description fs_permissions = [{ access = ""read-write"", path = ""./""}] Anyone having problem with forked test taking forever ? I have a test that takes 3 seconds to run in non-forked enviornment (with connection to local geth node) but doesn't terminate for 3 minutes in forked environment ( with connection to remote infura archived node) Is there no way to get a faster experience unless I set up to run a archived node locally ? anvil -a 1 -p 9545 --fork-url https://mainnet.infura.io/v3/XXXX --fork-block-number block_number forge test -vv --match-test TEST --rpc-url http://localhost:9545 Latency and rate limits probably :) Need better API access So can't do much on our end Is there any way to do an OZ upgrade safety check in Foundry? ATM I'm manually copying into a hardhat subdirectory before deploying 😂 @gakonst Any thoughts on this? Try running forge test -vv --match-test TEST -f http://localhost:9545 Instead of passing it as rpc url. Had a couple of test ran on forked network. First test run took like 10s, then it went to ~800 ms Wasn't pinning a block number btw, so it may not be helpful Hi Yijia gm everyone! what's the correct way to expectRevert? it doesn't seem to work for me Replace testFail with testCannot Good morning! Any resources on production level deployment scripts using foundry? Any repos you follow for inspo? In other words @caffeinum, testFail prefix expects the test to fail in order to pass, whereas now that you’re expecting the revert, your test doesn’t fail (because this revert Does happen), and therefore the test doesn’t pass. You could rename testCannot, also seen others do testRevert, or testXyzAbcShouldRevert, etc. Whatever is simple and clear for your project. im also interested! For parseJSON, it seems to work fine for a simple object with no embbed lists but fails when an item is a list of structs.",476
1374,foundry-support.txt,"Is there any support for that at the moment? Didn't find anything on this on the official page If not I'll just use ffi Checking again on the anvil issue Consuming a lot of storage when “mined”. Wondering if this is normal I think it should be supported but could be wrong, cc @odyslam It should work with arrays https://github.com/foundry-rs/foundry/blob/0e1d52d49bb7e71d8d555b020119d3af81776ab1/testdata/cheats/Json.t.sol#L80 seems like that's for string or uint256 arrays but not arrays of arbitrary structs? @odyslam ah, arrays of structs so arrays of tuples The code on first glance should be able to handle it @nanostar https://github.com/foundry-rs/forge-std/blob/2a2ce3692b8c1523b29de3ec9d961ee9fbbc43a6/src/Test.sol#L711 It does handle it ok, let me try again Looking through the assume cheatcode reference , isnt adding the require statement to the test not needed since assume would already do that ? https://book.getfoundry.sh/cheatcodes/assume#examples wat is this the main channel name now ser... have i offended thee? i think the require statement is meant as the one that you’re trying to test You aren’t testing it in that function. I feel like It should be part of your code I.e. function you are trying to test .. so the additional require seems moot Hello, I am getting error while installing Foundry on Vs code, Windows I have also tried on WSL and still getting this error This help ? https://www.jaacostan.com/2019/12/rust-error-linker-linkexe-not-found.html?m=1#:~:text=While%20compiling%20Rust%20program%20in,Tools%20for%20Visual%20Studio%202019.",423
1375,foundry-support.txt,"I have Visual Studio with C++ already Visual Studio 2022 Which rust tool chain are you using ? Wow Just tried foundry scripting Runs smooth! Great! 🙌🔥 Try installing the windows toolchain rustup toolchain install stable-x86_64-pc-windows-gnu Then rustup default stable-x86_64-pc-windows-gnu downloaded from the foundry repo link rust is working on my machine check which toolchain is active i.e. rustup show again installing, lets see if it works now Can anyone let me know why is this happening?? New error I think it was meant as if they're testing require, because there's no other code in the example. It's not a very obvious way, good that it's opensource and anyone can edit it Makes sense, thanks, obviously it works now. However, I'd say it's not very convenient, at least the error message might have said ""test expected to fail but passed instead"" vs ""Assertion failed"". Also I couldn't deduce from traces, which assertion specifically has ""failed"", this would help too. I liked Foundry in that it's really comprehensible and easy to write tests, you don't have to think about how to initialize the environment and all other hardhat boilerplate. I think Foundry is much better for novice programmers than hardhat. That's why I think it's important to lower learning curve try installing bzip2-sys separately probably svm / solc binaries are corrupt. Try deleting the svm folder and running the command again rm -rf ~/.svm thanks. it worked help please, getting me a headache just to install foundry can you try removing hello_foundry directory and running command again? still add --no-commit to your command..",355
1376,foundry-support.txt,"push buddy!! almost there Hey guys, I have been trying to test with debug mode of foundry, and I just wonder is there any way to track value of function variable within the interactive screen? Thx😭😭😭😭😭 If I want to get addresses and execute a specific function from a specific address, is it possible to do in Foundry? you can use vm.prank() from where I will get the dummy addresses? like in hardhat we get it from ethers.getSigners() I'd recommend creating a new directory instead of putting it all into your user directory, where other code is stored too address alice = makeAddr(""Alice""); got it deal is to give money to address, but if you wanna generate a signer, you can use makeAddr it's funny that I have had the same questions yesterday, like ""how do i replicate simple hardhat test in Foundry"", and docs were very unhelpful btw the documentation of Foundry is easy but what to search for is hard, just like If I want to generate addresses I have no idea how to find it in a documentation Hi guys , have a question 🙃 In solidity , if i want to restrict some specific struct into a bytes type . How can i do that ? The purpose if for use to send bytes data in a specific manner , which are in the form of several specific uin256 t or uint256[] Briefly in general case , we might write ""bytes memory data "" , but how can i change bytes into specific inputs @gakonst Should I gitignore my .gas-snapshot file? have you looked into abi.encode()? I wana use the StdJson library but I dont have it in my forge-std lib i tried to run foundryup but it doesnt show anyone knows what might be the issue? nvm, forge update anyone knows how I can save a strut into a json? struct* Hello there ! I'm facing a ""YulException: Variable _2 is 1 too deep in the stack"" but I'm pretty surprised by it being thrown at me while the function body is like 3 lines. Any idea what am I missing ? (Note: it compiles just fine when *not* using ""via-ir"").",463
1377,foundry-support.txt,"Thanks ! hey folks so I'm trying to write a test for a function which takes array of bytes (signed messages) as parameter, when I try to run the test I get error[3390]: TypeError: Invalid rational number and the transaction fails, when I run the same code in remix, it works perfectly fine function disburseAmount( address[] calldata recepients, bytes[] calldata proof, string[] calldata metadata ) external payable this is the selector Hi all, what's the way to deal with nested libs in a foundry project? Basically a nested submodules problem. As an example, I have a set of my own contracts (foundry repo) that I import into another repo (also a foundry project). The imported repo has a set of dependency libs, eg. chainlink or opensea. I can make the symbolic link in the remappings, eg. ""openzeppelin/=lib/my-other-repo/lib/openzeppelin-contracts/contracts/"" Is there a way to install these libs recursivey, something similar to git clone --rescurse-submodules Is it possible to get the environment variables from an .env file which isn't at the root of the repository? My repo is like this: root .env —contracts (contains all forge files) Maybe an approach similar to:  string memory root = vm.projectRoot();  string memory path = string.concat(root, ""/src/test/fixtures/broadcast.log.json"");  string memory json = vm.readFile(path); that doesnt work ^ at least not from a script maybe in a test file it does, but every attempt I had to read/write to files from a script failed hey folks, is there a way I can sign some message via the deployer contract address? getting ""stack too deep"" when running forge coverage -- any suggestions? tests are all passing, clean branch more info on this here https://github.com/foundry-rs/foundry/issues/3357 Hey, I have a problem with rollFork... In setup() I createSelectFork with an rpc and a blocknumber.",425
1378,foundry-support.txt,"While testing the current balance before the rollFork is correct after rollFork i is 0 function testRollFork() public { vm.startPrank(user); IERC20(USDC_TOKEN).approve(address(mVault), SPENDING_AMOUNT); mVault.deposit(SPENDING_AMOUNT, msg.sender); emit log_named_uint( ""Current Balance"", IERC20(USDC_TOKEN).balanceOf(address(mVault)) ); vm.rollFork(34031790); emit log_named_uint( ""Balance after roll"", IERC20(USDC_TOKEN).balanceOf(address(mVault)) ); } does anyone know whats the problem with this code? have you checked the mVault.deposit() functoin, it might be zeroing out the balance yes, deposit is not the problem...even with roll() everything works fine Is it possible to test that events were emitted with foundry tests? https://book.getfoundry.sh/cheatcodes/expect-emit?highlight=testing%20events%20are%20emitted#description im deploying a diamond eip2535 to goerli. i need to call diamondCut() to send facet related config after the diamond proxy is deployed. can i do this in the deploy script or do i need JS I installed foundry but it didnt properly forge, why is this? Can I change the timestamp of the block? Oh. Found it https://book.getfoundry.sh/cheatcodes/warp In which OS? how can I call RPC methods? windows use this command foundry init --no-commit got it, thx! i will try now You can see examples here: https://github.com/Yhtiyar/foundry-diamonds And here: https://github.com/Timidan/Foundry-Hardhat-Diamonds forge init on windows is producing an ""Error: program not found"". A folder is created with the project name, and the content is empty Fresh install Error: program not found Location: cli\src\cmd\forge\init.rs:160:18 forge is telling you to switch to mac :) Can't play my video games on mac! Man, i know, i have the same pain I tried not to be so useless and look at init:rs160:18 I had to install git commandline for windows.",471
1379,foundry-support.txt,"Works now Now I can use forge and play video games! Does function setUp() public allocate a address in a test file during test? There is a random address that keeps popping up in my test I don't think reading .env files has an option for file path does it? this is likely git, can you try with --no-git instead? there's cast rpc to easily send reuests would love to be able to fix this - seems like an issue with the dotenv package you're using? I can submit a PR Okay, I figured it out but still another question. My test is executed from this address 0xCe71065D4017F316EC606Fe4422e11eB2c47c246 and therefore reverts forge init —no-commit sir, it seems to work a little, but still empty folder you are writing forge Do or do not. There is no try write in the same way as I do - -no-commit at the end `forge init --no-commit sir, 'foundry init —no-commit' didnot work neither didnot initialize this time best place to scam people, a chat of security engineers ""Tglobal-pattners"" sounds legit I am getting this error when I try to debug the transactions. What exactly is the issue and how do I fix it? hmm, this could be a simple index of of bounds when idexing source code via offset, could you please run this again directly instead of yarn and share output in an issue, and ideally a way to replicate, if this is public is there any jupyter-notebook style REPL for solidity? i want to be able to write stuff in console, and when finished, auto-export it as tests or deploy scripts Turns out Jupyter supports other languages, but obviously nobody has written Solidity kernel for it. However, it seems from their docs that it's not very hard.",386
1380,foundry-support.txt,"I wonder if anyone is excited about this? https://github.com/jupyter/jupyter/wiki/Jupyter-kernels you have some analysis usecase in mind with a notebook like this ? you can use apeworx or vyper atm , i havent deployed a contract tho using that and a .ipynb i love the idea of inline executing, xcode has brought this to swift playgrounds few years ago, and jupyter notebooks sound like a really handy way to draft-out your ideas Hello, has anyone had luck with the --watch command? forge test --watch test/ I've been running the watch command and looking at test dir Or alternatively, forge test --watch --run-all to re-run all tests However, have had 0 luck with the script re-running tests when I modify and save a test file If I have contracts A inherited by B, inherited by C. Where C is a test. Is the compiled bytecode for B different when running the test compared to when just compiling for verification? it works perfectly for me, do you have correct setup in foundry.toml ? eg if you point to the correct directories I thought this should be automatic, so feel free to open an issue if not, but you can workaround it with forge test --watch src/ test/ script/ Strange, updated to newest foundry version via foundryup Created new repo with forge init watcher Went into repo and ran the `forge test --watch src/ test/ script/` command, but still no luck I'm running these on a Windows Subsystem for Linux (Ubuntu 20.xx) not sure if that makes a difference Hi Guys, I believe this is probably a foundry beginner mistake, however, I have not found any fix anywhere so far. So that brings me here. I essentially with my unit tests.struggle with forge test. 1. I have written the smart contract. 2. Compiled correctly. 3. Import contract into contractName.t.sol . 4. Declare contract as global variable & write setup function: ContractName public contractName; function setUp() public { contractName = new ContractName(); } 5. The error message I get is: Compiler run failed error[7576]: DeclarationError: Undeclared identifier.",457
1381,foundry-support.txt,"--> src/test/ContractName.t.sol:11:9: | 11 | contractName = new ContractName(); | ^^^^^^^^^ I have seen this in many examples, but why do I hit an issue here? The import should be correct. Am I overseeing something? Pretty long, but I wanted to make sure its clear. Thanks for any help. I'm trying to call a function on a contract deployed locally on anvil. If I use cast call $contract_address ""functionName(param..."" param it tells me my proxy is invalid, even though I can call other functions on it. If I encode the calldata and pass that in (witih no 0x.. prefixed), it tells me my contract isn't verified. If I do it *with* the 0x, it gives me the error: `Error: (code: 3, message: execution reverted, data: Some(String(""0x"")))` What am I doing wrong? edit: those images showed cast call, which i was just testing to see if it worked, I use cast send since it writes to state, with the same issue showing. > forge clean The application panicked (crashed). Message: failed to extract foundry config: foundry config error: stream did not contain valid UTF-8 Location: config\src\lib.rs:436 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry >forge build Error: failed to extract foundry config: foundry config error: stream did not contain valid UTF-8 The application panicked (crashed). this started happening after i did a forge config --ffi > foundry.toml i reverted my foundry.toml back to the original and i can't seem to make it work again lol deleting foundry and reinstalling it might help I just build the master from source … is there some hidden folders to delete? are you on Windows? If so that redirect wrote it/set the file as ASCII in your editor, not UTF-8 which is what Rust uses otherwise can you check the text encoding in your editor, for VSCode it's in the bottom right wow i don't think i ever would have found that. thanks ser! that was it.",458
1382,foundry-support.txt,"it was set to 'plain text' in vscode Have you figured this out? It verifies fine on Blockscout but doesn’t want to verify on Arbiscan despite the following configuration in foundry.toml arbitrum-goerli = { key = ""${ARBITRUM_ETHERSCAN_API_KEY}"", url = ""https://api-goerli.arbiscan.io/api"" } I didn’t. I ended up verifying manually Ok thanks. Which technique did you use to verify manually? Trying with --show-standard-json-input but no success so far. Manually = use etherscan webpage to copy paste code, set compiler settings etc Hi all. Wondering if anyone has successfully run slither on a project that uses both foundry and hardhat, and if you did was it a smooth process or did you need to do some workarounds? I ran into an issue and posted it to the slither gh repo here: https://github.com/crytic/slither/issues/1446 First time using the new update and tests are failing. Getting this same error when I comment out the code blocks — so I don't think it's an error on my part.. ? Same code is running fine on a previous directory You’re using multiple compiler versions with Foundry, right? If so, I think it’s related to this https://github.com/foundry-rs/foundry/issues/3450 getting this persistently i've even tried with sudo and i get the same exact error no reason for this that I can gather Nevermind, found the solution... Apparently curl installed via snap is useless. installing via apt solved the problem. most bizarre Linux problem I've faced in a little while I have noticed that during a test setUp function all test are executed from this address 0xCe71065D4017F316EC606Fe4422e11eB2c47c246, this over writes vm.startPrank() or vm.prank(); Problem: this address seems to be an ether address and EvmError Reverts when transferFrom other tokens.",421
1383,foundry-support.txt,"Question how do you set custom address or is there a way around this? When deploying to mainnet, is there any way a private key can be leaked through either the compiler files or development broadcast logs which are typically in the .gitignore? yeah we have multiple versions in our contracts leaked how? like accidentally exfiltrated ? snap installs into a sandbox, you will always have this sort of issue precisely because your able to install without root permissions Hi there! Got not answers and still stuck at it, would really appreciate get some feedback on it, thanks 🙏 you might be better opening an issue for this on git seems related : https://t.me/foundry_support/25071 Yes kind of the same, will try without the optimizer and follow this issue 🙏 Hi, I'm trying to run slither on Foundry project, getting similar error to this one https://github.com/crytic/slither/issues/1007#issuecomment-1202612482 this is my config file { ""filter_paths"": ""lib"", ""solc_remaps"": [  ""ds-test/=lib/forge-std/lib/ds-test/src/"",  ""forge-std/=lib/forge-std/src/"",  ""openzeppelin/=lib/openzeppelin-contracts/contracts/"",  ""solenv/=lib/solenv/src/"",  ""solidity-stringutils/=lib/solenv/lib/solidity-stringutils/src/"",  ""squeeth-monorepo/=lib/squeeth-monorepo/packages/hardhat/contracts/"",  ""v3-core/=lib/v3-core/contracts/"",  ""v3-periphery/=lib/v3-periphery/contracts/"",  ""@openzeppelin=lib/openzeppelin-contracts/"",  ""@uniswap/v3-core/=lib/v3-core/"",  ""@uniswap/v3-periphery/=lib/v3-periphery/""  ] } slither src/Contract.sol works but slither . giving me similar error Somehow sending tx stops at 21 tx ### Finding wallets for all the necessary addresses... ## Sending transactions [0 - 22]. ⠖ [00:00:21] [#######################################################################>--------------] 19/23 txes (5.3s) Stops here 🙏 that’s me polishing my code style while there’s a gaping hole in the middle of the system Can i install Foundry on it? Wasn't aware of this.",497
1384,foundry-support.txt,"Thanks for the added context! Is there a way to run forge fmt or forge gmt --check before every commit ? Yes Sir on foundry mold coting ohhhhh we're in another ""type"" of Foundry 😅 wich product It's a program for PC To write other programs We're not in a real Foundry, it's a virtual thing when doing —broadcast in script, does it also broadcast the read only calls? (or static calls i guess) is there a way to get test coverage from forge or a library i can install that does that? i recall there being something similar for hardhat Forge coverage Ctrl + f in the chat thanks i didn't see it in the docs so was confused any thoughts on a rational way to implement eth_callBundle and eth_sendBundle in anvil? it would help testing those functions, but an execution policy would need to be chosen. static calls are filtered out Didn’t dig into it too much ended up spinning up a custom geth with new api call eth_callBundleQueryAddress which does the same thing as callBundle but let’s you pass in a address to query for the delta balance Would be nice if alchemy offered something similar where you can check some specified state before and after a bundle executes for the generic testing use case, it would be nice to have anvil expose standard eth_callBundle, eth_sendBundle Hey all, When foundry runs a test (gas-wise) it seems that it's all one single transaction? Is there any way to change it in a way that each cross-contract call is a separate transaction? I want to benchmark a contract gas usage and just populating the contract with some initial data causes the rest of the calls have warm storage reads and writes :( This makes benchmarking many test scenarios impossible... using assertEq(uint(1), uint(2)); in a test should cause it to fail, correct? how do you get anvil to be in verbose mode? don't see anything in the docs. i just see eth_call and eth_sendRawTransaction in my terminal. ideally would like to see whether it reverts or not and things like that Who is partricularly proud of their forge script? Looking for examples I think this is only not true on the setUp. The gas costs for setup are computed separately. Can anyone confirm that? Yes. Recently a hot wallet’s private key I was using for deployments was compromised and funds were drained from the wallet.",496
1385,foundry-support.txt,"Still not certain how this happened but I had just recently used foundry as a way to deploy contracts Is there an issue with expectRevert() in fork mode ? Doing   vm.expectRevert(bytes(""Invalid delta after rebalance""));   contract.functionCall()... but getting [FAIL. Reason: Assertion failed.] I also tried to use .call(), and the get the revert message console.log(""returndata"", string(returndata)) I get +Call reverted as expected, but without data Same using   assembly {    returndata := add(returndata, 0x04)   }   console.log(""error"", abi.decode(returndata, (string))); hey folks - has anyone ever used frame as signer with forge script or otherwise is there a recommended approach to using a hardware wallet with forge script the —ledger flag seems to have no effect i've used the --ledger flag with scripts before - two hyphens, for what it's worth can forge scripts directly submit pre-signed transactions (+ wait for results)? without calling out to ffi strange, it didn't want to work with my ledger is there an assertion for whether two values are within a certain range? hardhat/waffle had something like this. suppose expected is .18 and actual is .19 i want it to return true if they are in .05 of each other forge-std has assertApproxEqAbs https://github.com/foundry-rs/forge-std/blob/17656a2fa5453f495d8c1302a0cedded912457eb/src/StdAssertions.sol#L105 perfect, thx! Hello ! Is it possible to have a ""testFail"" pattern that matches on the revert string ? I'm writting unit tests and I can't use the vm.expectRevert cheatcode because the very next call does not revert but I know that the function will revert at some point (after it does several inner public calls) with a given error message. Thanks ! Hello 👋, Foundry printing deploed Contract in log, Is possible to store deployed contract Address separately ? Is it possible to access older releases than the 3 ones available on github? I am trying to debug the issue linked bellow and would like to try older version since I was not facing this issue 2 weeks ago on the same test.",476
1386,foundry-support.txt,"Thanks https://github.com/foundry-rs/foundry/releases https://github.com/foundry-rs/foundry/issues/3596 🥰🥰 you can install a specific commit, branch, PR, repo, etc... with foundryup – check out the options with foundryup -h. foundryup -C <commit hash> will probably work for you howdy! i'm trying to use vm.load() to test a private contract variable. how do i find the slot of my contract variable? tests say they can't find assertEq, however I have them imported and inherit from Test are you sure nft.extensions(0) returns an address? Try with casting oops yes you're right, it returned class-typed contract I'm writing something which parses user input (javascript) to send data and instructions to a smart contract (solidity), and the thing doesn't really make sense without both pieces. Is there a way to test such a combo with foundry, or should I go back to JS testing with hardhat or similar? you have to build from source yes have used metamask foundryup --commit xxxxxx hello, does foundry contract verification support polygonscan? Sorry to post here, is this legit ? nope fake report, whats the name? Ah yeah i didn’t check the username before, it is @gekonst I had similar thing week ago, i actually thought it is legit Same person dm’ed me today. Was helpful actually if what they said was true lol 👋 hey folks. Trying to run anvil_dumpState but getting: code: -32602, message: Dumping state not supported with the current configuration, data: None Can't find any docs or hints in the source for what this could mean.. Anyone know what configuration I have that isn't supported? I started anvil with: anvil --fork-url https://eth-mainnet.alchemyapi.io/v2/KEY --chain-id 1337 As it happens, they said compiler files contain sensitive information and should be on the .gitignore.",427
1387,foundry-support.txt,"Can anyone confirm? Maybe the real @gakonst Ex: cache/ and out/ Hi, is there a way around @0xCe71065D4017F316EC606Fe4422e11eB2c47c246 address when testing with EOA? Currently my test setUp() is from this address but I need it from a custom address. vm.prank() is not helping You want a different EOA? yes, something an address I can prank Just do prank(EOA, msg.sender) In my test contract? This is a contract deployed address You want your contract to be deployed to a particular address? Test contract is testing a function in another contract with msg.value Yea.. I'm confused What exactly do you want to do? This doesn't explain much Aplogies, that is my test contract that test testContract, but each time I run it the from address is @0xCe71065D4017F316EC606Fe4422e11eB2c47c246 Problem I am experiencing is that this address is passed on as transferFrom which messes up test You want the from address to be user? Any address I define .. Yes even user In your case vm.prank(user, user) How would this work should it be in my test function before the call to external function? You have a commented startPrank here Before you make the external call Traces: [401526] ReentrancyTest::setUp() ├─ [346786] → new Reentrancy@0xCe71065D4017F316EC606Fe4422e11eB2c47c246 │ └─ ← 1732 bytes of code └─ ← () Still getting that, very strange address. If I run a single test file I am able to prank any address in test but when I test a contract from a seperate test file this address keeps showing up do this startPrank(user, user) [FAIL.",407
1388,foundry-support.txt,"Reason: EvmError: Revert] testPwn() (gas: 14710) Traces: [401526] ReentrancyTest::setUp() ├─ [346786] → new Reentrancy@0xCe71065D4017F316EC606Fe4422e11eB2c47c246 │ └─ ← 1732 bytes of code └─ ← () [14710] ReentrancyTest::testPwn() ├─ [0] VM::startPrank(0x56A201b872B50bBdEe0021ed4D1bb36359D291ED, 0x56A201b872B50bBdEe0021ed4D1bb36359D291ED) │ └─ ← () ├─ [0] Reentrancy::pwn{value: 951949022215657330726}() │ └─ ← ""EvmError: OutOfFund"" └─ ← ""EvmError: Revert"" Test result: FAILED. 0 passed; 1 failed; finished in 4.53s Failing tests: do vm.deal(user,10000e18) before pranking taking a awhile to compile, will checking soon yep...that's def a contract error . Yeah, let me run more test. Thanks for adding your thoughts🙏🏼 this feature will be helpful, @pbj, were you able to make your function work? yea, this is how i do manual mining function mineBlocks(uint256 _numBlocks) public {  // emit log_uint(block.number);  for (uint256 i = 0; i < _numBlocks; ++i) {  string[] memory inputs = new string[](3);  inputs[0] = ""cast"";  inputs[1] = ""rpc"";  inputs[2] = ""anvil_mine"";  bytes memory res = vm.ffi(inputs);  }  vm.roll(block.number + _numBlocks); } you need to run anvil --no-mining in a separate terminal Did anyone tried before expectRevert() in fork mode, does it work? should work! I m getting weird issues, posted in the Foundry grouo hi, i understand that i can use cast rpc anvil_impersonateAccount.",492
1389,foundry-support.txt,"may i know how can i do that by rust code? for example, how can i impersonate another account in my rust test THis is what I am talking about even if you prank EOA in test set up, it always gets overwritten by another address, strange behavior i think your issue is that pranks do not carry over from setUp to test functions. setUp is called as a separate transaction. by the time the test function is called, the setUp transaction has already ended. you'll have to start a new prank in each test, if that's the issue you're having Hi @emo_eth I tried both variations and the address keeps showing up, 0xCe71065D4017F316EC606Fe4422e11eB2c47c246 seems like an internally generated address by foundry and used in all test setUp(); cases Does anyone have good example of writting smart contract test using typescript ? Appreciate that if you drop me some hey. running Slither in my project takes forever and then fails, any idea why? have a look at the tests https://github.com/foundry-rs/foundry/blob/master/anvil/tests/it/anvil_api.rs#L57 same stuff; moreover, the --initial-balance arg, which is supposed to control the balance of deployed contracts, has no effect on it (same for initial_balance in foundry.toml) have to zero out the balance with deal could you please open an issue for this? when writing a test that start with testFail... does Foundry assume it will fails ? Has anyone used Anvil with GitHub CI? Any idea if that would be feasible? https://book.getfoundry.sh/config/continous-integration Thanks! Anvil is part of our CI, but we manage with native Rust. Happy to give details if it would be helpful.",378
1390,foundry-support.txt,"yes please! Dependency: [dependencies] anvil = { git = ""https://github.com/foundry-rs/foundry"" } Then to spin up the chain in your async tests: let config = NodeConfig::default() .with_port(0); let (api, handle) = anvil::spawn(config).await; Then you can make a provider and pass it around in your tests: handle.http_provider() Awesome thanks so much man! Hey! If I want to build locally the source code for a contract and its dependencies, is it possible to get it automatically from arbiscan? Or do I need to manually copy and paste all code? has anyone ever seen intermittent failures for vm.deal on a createSelectFork test? like 1/20 tests for some reason are not actually dealing so my tests are intermittently failing ├─ [0] VM::createSelectFork(<key>, <block>)  │ └─ ← 0  ├─ [0] VM::startPrank(<address>)  │ └─ ← ()  ├─ [0] VM::deal(<address>, <amount>)  │ └─ ← () ... run test  │ │ └─ ← ""EvmError: OutOfFund""  │ └─ ← ""ExecutionFailed(0, 0x)""  └─ ← ""call failed"" got the job done with deth.net hey how is it going? im unable to verify a contract using foundry. im deploying a contract on goerli using a forge script. im using the —verify flag on the script and after many attemps the output is Etherscan could not detect the deployment. i get the same error with foundry verify-contract.",360
1391,foundry-support.txt,"and some other times with: dry-run/run-latest.json"": No such file or directory (os error 2) this seems extremely unstable..... super frustrating Hi there I'm getting the following error while trying to deploy my contract on goerli. Do you have an idea what is the reason. The command I use is the following: forge script script/HelloWorld.s.sol:HelloWorldScript --rpc-url ${GOERLI_RPC_URL} --private-key ${PRIVATE_KEY} --broadcast --verify --etherscan-api-key ${ETHERSCAN_API_KEY} -vvvv Deserialization Error: expected value at line 1 column 1. Response: error code: 1020 P.S. I live under a sanctioned country. The RPC provider blocks my access. I don't know if this something to do with that It is because of sanctions I guess(1020 code is for denial of access ). Try out other rpcs or even better, use a VPN The problem is that even VPN don't work :( goerli-relay.securerpc.com Ought not to censor iirc can you please open an issue for this with some context when this happens? 1020 is access denied status code iirc, can you try another provider? I'm sure infura blocks. I was using Alchemy, what else would you suggest? it happens when im running it automatically as an entrypoint command from a docker-compose. when i enter into the container and run it manually, i doesnt happen. is this enough context? Has anyone successfully used forge fmt in a Github Action? Yeah we did, but removed it and bow using forge fmt check only We figured its a bad practice to alter code automatically But its up for debate yeah thats a solid point Do you mind sharing what your yml file looked like for that to work? ive tried a number of configs and always complains that it cant find the code Sure is there a tool to download *flattened* verified contract from etherscan? manually copying contracts one by one and then reordering them in the correct hierarchy is quite cumbersome anyone having problems with enabling SMT solver? It's just failing for me for both CHC and BMC. When used with bmc: Compiling 67 files with 0.8.17 Error: Solc Error: Error: Process completed with exit code 1.",478
1392,foundry-support.txt,"with CHC: Solc 0.8.17 finished in 19.34s Error: Compiler run failed Unknown exception during compilation: Dynamic exception type: std::out_of_range std::exception::what: map:at I can build foundry from the latest master branch, but when I import it with cargo to a new project I am building, it fails to compile. How is that possible? foundry-cli = { git = ""https://github.com/foundry-rs/foundry"" } foundry-cli-test-utils = { git = ""https://github.com/foundry-rs/foundry"" } Whars the error? So, apparently the error orinates from foundry-cli Yes but what is it https://pastebin.com/5uj9N8Nx Which repo? Are you on latest rust? yy Built foundry succesfully from master Pls open issue with repro We'll investigate yy, wanted to make sure I wasn’t missing anything obvious error: failed to run custom build command for `svm-rs-builds v0.1.8` i encount this issue when I install foundry who can help me ,thx Latest version? Hi, everyone this maybe a basic question but is there are quick foundry way to check for the return value of a function foo() of a forked contract? does anyone have a quick fix for the forge-std compile time issue? https://github.com/foundry-rs/forge-std/issues/207 edit: downgrading forge-std worked using forge install foundry-rs/forge-std@c19dfd2f2a88a461216b0dd1f4961e1a85dcad46 might help with your issue cargo 1.65.0 (4bc8f24d3 2022-10-20) hi,did you solved it? Yeah I saw the issue recently as well thanks for tagging Hey sorry for duplicate but has anyone faced this usecase already? I did not find any other way to deal with it but that's pretty inconvenient 😕 Not really, I have to write an entire test contract and console log(""return somethin"") to read return value through an event function.",455
1393,foundry-support.txt,"2022-11-06T15:19:29.642847Z ERROR etherscan: Failed to deserialize response: data did not match any variant of untagged enum ResponseData res=""{\""message\"":\""OK\"",\""result\"":[{\""Address\"":\""0x83d392a7be901892a8c861c96ea430b8d9c2bd51\""}],\""status\"":\""1\""}"" I'm getting lots of error logs when running RPC tests. Not sure if etherscan changed their API. oh, might be, can you please open an issue with this error message? https://github.com/foundry-rs/foundry/issues/3621 Hi guys! I've been trying to get to use anvil inside a docker image, in a docker compose set up, and failing to connect to it. So I've simplified to just run it simply and try to curl it from my host. It's still failing. docker run --rm -p 8545:8545 ghcr.io/foundry-rs/foundry:latest ""anvil"" and then I try to telnet localhost 8545 and also curl http://localhost:8545 ....... but it fails ""curl: (56) Recv failure: Connection reset by peer"" I've rebuilt your docker image (even created mine) it seems the anvil process is really rejecting the connection as if the client coming from a different network (docker net vs local ) is the problem can you try --host 0.0.0.0 my tests take forever to run, then they sometimes fail and sometimes succeed, same for my GitHub Actions... really strange behavior. switched the RPC endpoint from Infura to Alchemy, but still same behavior.",356
1394,foundry-support.txt,"and in general Foundry seems extremely unstable lately - am i the only one experiencing it? i regularly make sure to foundryup and forge update here's some error i've been getting sometimes: 2022-11-06T21:32:22.524875Z ERROR sharedbackend: Failed to send/recv `storage` err=GetStorage(0xf02b3a77b1e7775de10294d78a4c3d77772b484a, 0, TimeoutError) address=0xf02b3a77b1e7775de10294d78a4c3d77772b484a index=0 literally one time i get this error, the next time it finishes ok..... super frustrating sorry about that, are those all fork tests? this looks like a request timeout error, which is usually an indicator of a spurious network > my tests take forever to run this would also explain this. Yes You mean my internet connection? yes this is a connection issue still completely unable to verify a contract on goerli etherscan, when i previously had no issue. anyone else? both in forge script --broadcast --verify and forge verify-contract. error message is ""Etherscan could not detect the deployment"". I even went on etherscan and manually verified, and am still getting that message (would expect the output to say that the contract is already verified at that point).",294
1395,foundry-support.txt,"Thanks for the help ! you need to —from $privatekey multiple people with the same issue , if that doesnt solve it , try investigating all the info in the replies When generating a wallet with cast wallet new - Private key generated has no prefix , can be imported and used cast wallet vanity —starts-with (—ends-with) XX Private key is generated with a 0x prefix Is this a bug or intended ? https://i.ibb.co/92kg0G6/image.png just using forge. if you're talking about the actual code repo, here's the branch it's on: https://github.com/vexchange/v3-core/pull/106. You can see all the failed GH actions Thanks ok i sent a tx to sepolia with a message - https://sepolia.etherscan.io/tx/0xfd70faa223657fc74d6f8342aea727215ebc89d1b444fb648a7386f39ba23ca0 cast send \ --rpc-url $SEPOLIA_RPC \ --private-key $SepAcc1 \ $SepAcc2 $Msg Nothing different so far from goerli Hey all. Wilkins from manifold.xyz here. It appears one of the commits and releases in the past week has broken goerli verification. Anyone else notice the issue? bug The verifications fail on goerli with any of the tagged versions in the last 3 days with the message “ “Etherscan could not detect the deployment” Rolling back to older versions fixes the issue. Can you pls open a repro and/or help us wrt where you think the bug may be? We’re trying to identify exactly which version broke right now. ok will open issue But in the meantime is there any way to get precompuled builds from September? Or October? It looks like only the last 3 Nov builds are tagged and installable without a full recompilation which is not great. foundryup -C <hash> Oh yeah without recompilation no We only have last 3 days Ya. I’m doing that. Takes forever. Any thoughts on hosting known good versions? Having things change without versioned numbers is hard to deal with in production. We intend to release 1.0 sometime soon so that should be less of a problem Been getting sidetracked I don’t thin kwe want to host all past versions I see.",492
1396,foundry-support.txt,"The repro right now is that goerli verification just breaks. We are looking for the commit that broke it by going through the hashes. What was your previous foundry version/hash? Maybe Etherscan API changed? That was flagged IIRC @mattsse ? that turned out to be an issue with blockscout's API which returns the wrong object https://github.com/foundry-rs/foundry/issues/3621#issuecomment-1304834588 Noticing that we do TRACE etherscan instead of TRACE blcokscout Looks like we should at a minimum surface a better error And yeah something changed there Can we try to support both types of responses? Suspect there will be some incompatibility This is the commit that broke things. https://github.com/foundry-rs/foundry/commit/6d94a105de767911c630f15c39cb9f2e82dfe078 Thanks guys. Don is working with someone on Twitter to go through it. Can you please share what error you’re getting if you run with RUST_LOG=forge=trace? Don ? tracked it down to commit, try to find root cause. Hi everyone 👋 I’ve an issue with the coverage. I’ve 2 contracts (so 2 files), with only 1 difference which is a constant. When I start coverage for contract B, the coverage report give converage info on the contract A line and nothing on the line B. I’m only testing contract B, but because contract A is ""above"" the B by alphabetical order, so the B’s coverage is showed on the contract A line coverage. Does anyone faced the same issue one day? Thanks a lot in advance 😉 Hi everyone, was using the 'forge create' command to deploy contracts & verify contracts on the polygon network.",375
1397,foundry-support.txt,"had an error on the command, anyone encountered similar issues before? Can you send your full command? give me a sec thank you for the help basically, I was using the command from this link: https://book.getfoundry.sh/forge/deploying $ forge create --rpc-url <your_rpc_url> \ --constructor-args ""ForgeUSD"" ""FUSD"" 18 1000000000000000000000 \ --private-key <your_private_key> src/MyToken.sol:MyToken \ --etherscan-api-key <your_etherscan_api_key> \ --verify similar command like this -> with my personal parameter setting but got the above error lol degatchi@DeGatchi tokenomics-contracts % source .env forge script script/Deploy.s.sol:Interact --rpc-url $GOERLI_RPC_URL --broadcast -vvvv Error: Deserialization Error: expected value at line 1 column 1. Response: project id required in the url any ideas? i have my .env set i think i encountered this one as well, but i havn't figure out how to deploy & verify curious to know if there is any template repo that we can directly use to use foundry combined with hardhat to deploy contract / test contract Hi, we believe we have found the cause of the issue, could you look into it for us please? 🙏 https://github.com/foundry-rs/foundry/issues/3633 forge build [⠊] Compiling...",311
1398,foundry-support.txt,"[⠒] Installing solc version 0.8.17 [⠢] Failed to install solc 0.8.17: error sending request for url (https://github.com/roynalnaruto/solc-builds/raw/ff4ea8a7bbde4488428de69f2c40a7fc56184f5e/macosx/aarch64/list.json): error trying to connect: invalid dnsname Error: error sending request for url (https://github.com/roynalnaruto/solc-builds/raw/ff4ea8a7bbde4488428de69f2c40a7fc56184f5e/macosx/aarch64/list.json): error trying to connect: invalid dnsname Context: - Error #0: error trying to connect: invalid dnsname - Error #1: invalid dnsname make: *** [build] Error 1 can help me? Hi folks, I'm trying to run a test on an arbitrum fork url which calls [0] 0x0000000000000000000000000000000000000064::arbBlockNumber() [staticcall] and then reverts with ""EvmError: InvalidOpcode"" ; looks like 0x0000000000000000000000000000000000000064 is a special contract on Arbitrum? Hoping to find a way around this quirk forge script scripts/LisbonProtocol.s.sol:LisbonProtocolScript --rpc-url $GOERLI_RPC_URL -from $PRIVATE_KEY --broadcast -vvvv like this ? you can patch precompiles with etch cheatcode: https://book.getfoundry.sh/cheatcodes/etch#examples @rkrasiuk unsure what's causing this, any idea? Unsure if pk argument was always mandatory as far as i remember it wasn't. @Dannprinc @m0h4m36xx could any one share the repro? Hi everyone! A quick one, there’s any pattern to follow when testing events? Getting pretty annoying copy/paste same event around tests. P.s - in my code base events are declared at interface level ☹️ We are getting this weird error on std out in our CI even though the tests seem to pass.",475
1399,foundry-support.txt,"&& git commit -m ""your message"" seems git clean -d -f . works or just add --no-commit i did that ... clean the stage but seems still not working so i tried the above git clean -d -f . oh, nice, good to know thank you ser ya It's when u have changes u haven't commited yet but u're trying to commit adding git submodules on top of it. I usually use the --no-commit option Hello sir ! Would you mind giving me your thought on 2 uses case I'm not sure how to deal with with foundry ? First one: How do I test that a function will revert *at some point* with a given reason BUT the very first (public) call inside that function is NOT reverting. Using ""vm.expectRevert"" does not seem to work as the first public call inside that function is not reverting. Seconde one: How can we run coverage on a library/contract that is only exposing internal functions ? I tested all functions within my ut but coverage still show 0%. I do think it's because all calls are internal but not sure though. Thanks a lot, foundry rocks 🤘🔥 Hi everyone. I am doing foundry test now. anyone has idea how to set msg.value(fake eth amount)? when i doing weth.deposit{value:amount}(), output reverts that i dont have enough balance. forge build [⠊] Compiling...",302
1400,foundry-support.txt,"[⠒] Installing solc version 0.8.17 [⠢] Failed to install solc 0.8.17: error sending request for url (https://github.com/roynalnaruto/solc-builds/raw/ff4ea8a7bbde4488428de69f2c40a7fc56184f5e/macosx/aarch64/list.json): error trying to connect: invalid dnsname Error: error sending request for url (https://github.com/roynalnaruto/solc-builds/raw/ff4ea8a7bbde4488428de69f2c40a7fc56184f5e/macosx/aarch64/list.json): error trying to connect: invalid dnsname Context: - Error #0: error trying to connect: invalid dnsname - Error #1: invalid dnsname make: *** [build] Error 1 problem solved. use vm.deal(address,100 ether) @mattsse I see you responded to a similar issue before, I'm getting a Deserialization Error when trying to deploy: Error: Deserialization Error: invalid type: null, expected f64 at line 1 column 207.",256
1401,foundry-support.txt,"Response: {""oldestBlock"":""0x2ffe0a"",""baseFeePerGas"":[""0x3b9aca00"",""0x3b9aca00"",""0x3b9aca00"",""0x3b9aca00"",""0x3b9aca00"",""0x3b9aca00"",""0x3b9aca00"",""0x3b9aca00"",""0x3b9aca00"",""0x3b9aca00"",""0x3b9aca00""],""gasUsedRatio"":[null,null,null,null,null,null,null,null,null,null],""reward"":[[""0xee6b2800""],[""0xee6b2800""],[""0x0""],[""0xee6b2800""],[""0x1defd8a211""],[""0xee6b2800""],[""0x5f5e100""],[""0x0""],[""0x5f5e100""],[""0xa998fa606""]]} from: source .env && forge script script/DeployMoonbase.s.sol:DeployMoonbase --rpc-url $MOONBASE_RPC_URL --broadcast --verify -vvvv any thoughts? I beleive last time you said it was a serde error, but that was a long time ago that's just the provider returning an invalid response, looks like to a eth_feeHistory call I've tried two separate RPC urls, seems odd what chain is that on? moonbase alpha worked with --legacy, looks like an issue with EIP-1559 TXs 1. Hmm yeah. I think also unsupported, @onbjerg? 2. You unfortunately need to expose them right now because we cannot map the call of an internal function's inlined bytecode back to the source this looks like the fee history response by some moon base rpc being wrong It works with legacy bc it doesn't query fee history But that's an issue on the RPC, not us. Is it following the spec for fee history calls? Hey, we use several Mocks in our tests. Is there a way to exclude them from the `forge coverage` command? It somehow polutes our total coverage. Right now we use a JS file to clean the report, but I was wondering if there is a native solution. I already added ""*.t.sol"" as an ending, but it did not change anything.",471
1402,foundry-support.txt,"(saw your message in foundry channel) IIRC OutOfFund is when you don't have enough ETH to cover gas cost, so I think the failure is not with deal but with whatever was truncated in that ...run test section of the trace https://youtube.com/shorts/qiWXseaj_QI?feature=share Hey good people, have a q about using cast and decoding output structs cast c 0x660cBc25F0cFD31F0Bdcaa43525f0bACC6DB2ABc 'getReferenceData(string,string)' 'CELO' 'USD' --rpc-url https://alfajores-forno.celo-testnet.org is returning struct ReferenceData { uint256 rate; // base/quote exchange rate, multiplied by 1e18. uint256 lastUpdatedBase; // UNIX epoch of the last time when base price gets updated. uint256 lastUpdatedQuote; // UNIX epoch of the last time when quote price gets updated. } is there a way to nicely decode the output from cast? Thank you, ser. I’ve followed up with the node providers who are looking into the issue. Can i ask how you know it’s a fee issue in the response? Just by the data returned? 'getReferenceData(string,string)((uint,uint,uint))' so specifing output type as tuple works fine gasUsedRatio is all null's when they can only be float numbers (i think, you'd have to check the official eth jsonrpc spec) Yeah because deserialization fails the type doesn't match the response by your provider We can always make things more loose and we have in the past But rather not do without thinking And first prefer flagging to the providers Hi everyone , I have a problem when I deploy they say that my gas price is not enough how do I set it on foundry ? check the --help there are flags for setting it and one for scaling the deal is how I get the ETH to pay the gas cost, and its failing because i have 0...",415
1403,foundry-support.txt,"also it works in 19/20 test runs on the same fork block so seems like intermittent failure of deal to me? ahh interesting I see what you mean, do you mind opening an issue with steps to reproduce? haven't seen this before so not sure offhand what the cause may be will do thanks https://github.com/foundry-rs/foundry/issues/3651 you should use lcov directly imo, something like: lcov -r lcov.info ""test/*"" -o lcov-filtered.info --rc lcov_branch_coverage=1 this takes lcov.info that is generated from forge coverage --report lcov and produces lcov-flitered.info that strips out files that match the ""test/*"" glob the --rc lcov_branch_coverage=1 keeps branch info in the filtered report (defaults to removing branch info) Sorry the above messages were suppose to be a reply to this this is what i use: https://gist.github.com/brockelmore/ce57ea765baf6ff3ab1c503de6405b7d It runs coverage for a PR, produces the LCOV report, filters it, then posts the results as a comment on the PR nice that's pretty much what mine is but installing lcov directly instead of hrishikesh-kadam/setup-lcov https://github.com/ScopeLift/foundry-template/blob/e5e609e94c0c67046984b738a132420c5284b649/.github/workflows/ci.yml#L55-L68 didn't know this though, thanks 👌 one downside to lcov (vs supporting filtering in forge) is that you can't filter from the summary table Hi, is there the counter of vm.expectCall() , like vm.expectNotHaveBeenCalled() ? Awesome, thanks for the reply. We ended up with a pretty hacky solution that works nice. We add ""testMock()"" to all our Mocks and Fixtures. This filters them out of the Contracts that the coverage report takes into account. Is it possible to add a flag that filters out all contracts in /test? Or is it expected behaviour from lcov (or coverage in general) to include all files without tests? Qusetion for anytone trying to deploy a EIP2535 diamond.. I'm running into the error: The application panicked (crashed).",488
1404,foundry-support.txt,"Message: called Option::unwrap() on a None value Location: cli/src/cmd/forge/script/executor.rs:40 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ BACKTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1: __libc_start_call_main<unknown> at ./csu/../sysdeps/nptl/libc_start_call_main.h:58 2: __libc_start_main_impl<unknown> at ./csu/../csu/libc-start.c:392 Run with COLORBT_SHOW_HIDDEN=1 environment variable to disable frame filtering. Aborted (core dumped) Run with: forge script script/deployDiamond.s.sol --rpc-url https://bsc-dataseed1.binance.org -vvvv --ffi if I try to deploy any more than 4 facets... anything 4 or less properly deploys... I'm running it through a script, and under the run (vm.broadcast) I do 4the deploys, and generate the diamondCut... Any limits on what can be deployed through script? no...i guess not https://github.com/aavegotchi/aavegotchi-gbm-baazaar/blob/main/script/deployGBM.s.sol here is a script sample that deploys 4+ facets, upgrades them and makes calls to the diamond That is basically what I have, but it keep erroring out if I try to deploy the 5th facet... hmm weird i think i had an issue with that too Yup.. have a nice dent in my desk right now.. :O try to split it up then in multiple broadcasts that's a neat idea.. will give it a shot. the wierdest part is the last step is to deploy the actual diamond, and pass in the selectors... which does work.. 😐 hmm...deploying the diamond is last? i think that should be the second step after diamondCut Yup This is a cut down version (mostly removing the facetcut... but if I comment out sdData _sdData new sdData();... it works...",452
1405,foundry-support.txt,":( i might be able to help you in dm tho I believe there's an open issue regarding ape-safe wasn't high on the roadmap, but a thing we can definitely take a closer look now, since there has been some discussion recently: https://github.com/foundry-rs/foundry/issues/1232 would appreciate additional context wrt create command in the issue @mattsse gotta admit that I f** up with the git rebase... https://github.com/foundry-rs/foundry/pull/3634 I've ran git rebase -i <commit_hash> from the first commit of the create2 feature, it's been taking time to fix all conflicts but the result is .... Not has I expected to say the least 😅 Great, thanks for the pointer 🙏 next time try this way: https://github.com/sambacha/gitxxx#git-filter-base I'm getting Nonce too high errors when running a forge script on Arbitrum Goerli. Is there a way that I can just tell it to go super slowly and not try to be fancy by optimising nonce increments (assuming that's what is happening - I could be wrong)? Oh nvm. I missed the —slow option. Will try that out. —slow worked :D Quick Assistance: I just dealed address(alice) a token and pranked address alice to deposit token but I get this ""Balance: Insufficient internal balance"" What internal balance does this error point to? Has anyone ever meet this error:Details: Invalid API Key I am pretty sure that my bscscan's api-key is correct and I used to verify my contract successfully, but this time not, it's so werid does this happen in fork mode? are you on the latest build, there was an issue that might be related couple of days ago yes, my version is forge 0.2.0 (c8431ed 2022-11-07T00:07:44.516285Z) what is the issue?😂 Is that issue in 11-07's version can you try after foundryup it worked now thank you for your answer~ sorry to bother you guys again, when I verify my contract through forge verify-contract, it will show this mistake: Contract verification status: Response: NOTOK Details: Fail - Unable to verify Contract failed to verify.",487
1406,foundry-support.txt,"Is there more details for the fail information? My command is forge verify-contract ${address} ${path} ${api-key} --chain 97 --watch and when I use forge create command, it also shows this error. forge create --rpc-url ${bsc-test-rpc-url} --private-key ${private-key} ${path} --etherscan-api-key ${api-key}--verify Hey there ! Has anyone noticed errors when running tests using ffi ? If a test fails, it seems like the ffi command is ran the number of time specified by the ""fuzz"" setting. I'd expect the test to directly stop on error but instead it keeps running tests (maybe the same ?) and fails at the very end (after running X test with X being the fuzz amount). Would love to have more info about that ! Thanks 🤘 Yes, sorry was offline Where do I find the ABI of my deployed contract? Not very familiar with the folder structure in foundry Is it in the ""out"" folder? Yes a few times in the past couple weeks ive had vm.prank(some address) followed by a one line call not work (like the one line call fails due to access control, msg.sender is not pranked address) but that same one line call between startPrank and stopPrank does work. anyone else? hi, the newest foundryup update breaks my forge script which uses vm.selectFork(mainnetFork); which has been working before yesterday's foundryup. The error is : No associated wallet for addresses: {0xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx...(my test wallet address}.",331
1407,foundry-support.txt,"Unlocked wallets: [] the script command I run is: forge script ForkDeploy.s.sol --broadcast -vvvv hmmm i dont know how that worked before, you have to provide the private key via --private-key $ETH_PRIVATE_KEY or -i 1 followed by pasting the private key when prompted this is part of what's in the ForkDeploy.s.sol , the privateKey is read from the .env   string memory MAINNET_RPC_URL = vm.envString('MAINNET_RPC_URL');   uint256 mainnetFork = vm.createFork(MAINNET_RPC_URL);   vm.selectFork(mainnetFork);   string memory mnemonic = vm.envString('MNEMONIC');   uint256 privateKey = vm.deriveKey(mnemonic, 0);   address deployer = vm.addr(privateKey); @joshiedo did multichain deployment update break this? When I do „forge script” - Can I pass function parameters somehow? Solved it - with bash u first do cast calldata and then pass this with —sig to forge script! Slither takes forever to run and then fails, any ideas why? running slither . from root is it possible to mockCall to a mapping? im trying vm.mockCall(address(_watcherManager), abi.encodeWithSelector(WatcherManager.isWatcher.selector), abi.encode(true)); where isWatcher is defined: mapping(address => bool) public isWatcher; im getting an error: error[9582]: TypeError: Member ""isWatcher"" not found or not visible after argument-dependent lookup in type(contract WatcherManager). --> contracts_forge/messaging/connectors/SpokeConnector.t.sol:62:66: | 62 |  vm.mockCall(address(_watcherManager), abi.encodeWithSelector(WatcherManager.isWatcher.selector), abi.encode(true)); Any idea why I can't run a simple transferFrom ? I am: - calling TransferFrom(Alice, Contract C, qty), inside a contract B - previously calling approve(B, qty) from Alice - calling contract B with Alice address I'm trying to automate my development + deployment workflow using docker containers. Anyone had any success with deploying libraries and linking them to contracts in the same steps/script. Seems like the only option is to manually deploy libraries -> link in .toml -> deploy contracts.",469
1408,foundry-support.txt,"Specifically for linked libraries sorry about that, could you please open an issue for this? this could be related to this issue https://github.com/foundry-rs/foundry/issues/3651 which we weren't able to replicated yet Could you please add any additional context you have? a failed fuzz run does not abort the entire test, because we try to gather as much counter examples as possible There was a verify bug that has now been fixed. Could you check if you are using the latest build? unfortunatelly no, this is all we get from etherscan Seems like it would be great to be able to configure it to abort on first fail. Very long to wait it to abort each time when debuging code. That's reasonable, could please open an issue for this, so we can discuss? Will do 😁 Also while your here, is it expected that msg.sender differs between setup and test functions ? Ive seen this question has been asked before but not really answered so if i run slither SomeContract.sol it fails with file not found exception for contract dependencies, im running from a docker container with a volume to the host. any idea why? I'm actually not sure about this, @msolomon4 is this the case, or did we discuss this somewhere? likely an artifact path issue but hard to say without addtional context, perhaps a remappings issue? IIRC I think they should both be the same that, that 0x00a3 address. @xenoliss what addresses do you get? Well yeah it was the default 0x00a3 address before I change it in the config file. But in the setup function this is a different address this happens when you change the sender? yea, maybe. my vscode paints a red line under the @openzeppelin and forge-std imports, could it be related? in my .toml file i specify remappings = [ ""@openzeppelin/=lib/openzeppelin-contracts/"" ] It's independent of that.",415
1409,foundry-support.txt,"Even when letting the default 0x00a the setup function is called by ""0x1804"" you can dump your remappings to remappings.txt via forge remappings > remappings.txt this should at least fix the vscode issue, depending on the extension but this should be documented somewher would appreciate an issue for this Opening one oh nice!! it creates a complete remappings.txt, but doesnt delete this section in the .toml file, which could have been cool. but yea it fixes the red lines issue thx! ah this is the address that deploys the test contract https://github.com/foundry-rs/foundry/blob/c5791f5c2a2ccdc8d7d1cd5c77175154fb7ad6cf/evm/src/lib.rs#L41 and so if that's not that then what can else be wrong with the remmapings? I guess they also call setup, which I didn’t realize yeh forgot about this need to reevaluate and properly document really hard to say, does this also happen outside docker? https://github.com/foundry-rs/foundry/issues/3661 😁 actually all the errors from running slither are regarding contract dependencies not found. but yea it compiles ok hmm i cant run it outside of docker @mattsse is it worth opening an issue for this? Seems like it would be a useful feature, introduce a cheatcode like vm.linkLib or something to that effect? maybe can i run it on a deployed contract on Anvil? let me try adding it to me github actions worth an issue so we can track+discuss, but likely not a priority at this time Opened here https://github.com/foundry-rs/foundry/issues/3662 🙏 running it in github actions, getting the same errors.. https://github.com/foundry-rs/foundry/issues/3664 Did someone find a way to have a script do the following: 1. fork a chain and do some methods calls in the forked evm 2. switch back to the head of the chain and replay the calls in step 1.",448
1410,foundry-support.txt,"In other word is there a way, after using vm.createSelectFork, to switch back to the real chain ? github actions log: ######################################################################## 100.0% Computing checksum with sha256sum Checksums matched! Now using node v19.0.1 (npm v8.19.2) Creating default alias: default -> node (-> v19.0.1 *) Compilation warnings/errors on src/compounders/AMMCompounderBase.sol: Error: Source ""@openzeppelin/contracts/token/ERC20/IERC20.sol"" not found: File not found. --> src/compounders/AMMCompounderBase.sol:4:1: | 4 | import ""@openzeppelin/contracts/token/ERC20/IERC20.sol""; | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Error: Source ""@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol"" not found: File not found. --> src/compounders/AMMCompounderBase.sol:5:1: | 5 | import ""@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol""; | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ keep in mind that a step before running slither gh actions ran my tests and it passed using createFork doesn't work for me, I can only run tests against a fork when passing CLI flags https://book.getfoundry.sh/cheatcodes/forking I don't have any problem with creating and interacting with a fork on my side. I'm wondering if it's doable to ""switch back"" from the fork in a script file. Does selectFork not work for you? it does work But after I sent everything to the fork I'd like to replay on the real chain function run() public {   // Fork and do stuff.   string memory GOERLI_RPC_URL = vm.envString(""GOERLI_RPC_URL"");   vm.createSelectFork(GOERLI_RPC_URL);   vm.startPrank(msg.sender);   bool solved = solve();   vm.stopPrank();   // If everything worked, leave the fork and send to real chain.",460
1411,foundry-support.txt,"  if (solved) {    console.log(""Chall passed, replaying with broadcast"");    vm.startBroadcast();    solve();    vm.stopBroadcast();   } else {    console.log(""Chall failed"");   }  } Doing something like this 👆 (the broadcasting does not work) so yeah seems that it was a problem with the remappings, when i changed to absolute paths (relative to repo root) it worked Mainnet forking is very slow for me due to provider api being slow. Is there a way to cache a mainnet snapshot so i don’t have to redownload it each time i run a fork test? I tried adding a block-number but it had no effect on test run speed how do you persist the balance of deal outside a foundry script? Every time I run it and deal a balance of 1, the balance remains as one. But I want it to use the locally running anvil instance and keep track of the balances over script runs I am trying to deal erc20 tokens to an address Essentially i want to deal in a foundry script, and then have seperate tests in another language that use the state on anvil yes I have already run the ‘foundryup’ command but it still can’t work. One of my contract can be verified but the other can’t.",271
1412,foundry-support.txt,"It’s weird Looked at the docs and looks like cast might be better suited for this then a script Trying to do that and put this together:  console.log(Number(execSync(`cast call ${aaveTokenAddress} ""balanceOf(address)(uint256)"" ${creatorAddress}`)));  console.log(Number(execSync(`cast call ${aaveTokenAddress} ""balanceOf(address)(uint256)"" ${aaveTokenAddress}`)));  execSync(`cast rpc anvil_impersonateAccount ${aaveTokenAddress}`);  execSync(`cast rpc anvil_setBalance ${aaveTokenAddress} ${10e18}`);  execSync(  `cast send ${aaveTokenAddress} --from ${aaveTokenAddress} ""transfer(address,uint256)(bool)"" ${creatorAddress} ${1e18}`,  );  execSync(`cast rpc anvil_stopImpersonatingAccount ${aaveTokenAddress}`);  console.log(Number(execSync(`cast call ${aaveTokenAddress} ""balanceOf(address)(uint256)"" ${creatorAddress}`))); Everything seems to run, but no Aave is transferred to the correct account. I confirmed that the aaveTokenAddress account also has an Aave balance, so I should be able to transfer. For anyone curious the problem was that I was trying to impersonate a contract and sending from there. I have to do a regular wallet. Hmm I'll look into it in a couple hours But what I find strange is... Were you using createfork with --broadcast flag in a previous foundry version ? You shouldn't even be able to broadcast anything I'm not too familiar with the env private key logic, so can't just look at the code and say if something is missing What is the best way to generate pseudo-random numbers using Foundry? and I can verify my contract manually just use the nightly version hashes kek I get this error in Foundry: ""Stack too deep, try removing local variables."" My stack clearly does not have 16 variables. Could it be that the solidity test I write has a stack thats too deep and not the function call it self? I am testing a ERC20 contract, if I want simple createPair function on goerli from uniswap.",458
1413,foundry-support.txt,"This is how you do it right? this is right address address uniswapFactory = 0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f; And I try to run forge flatten to flatten my file, like this command:forge flatten --output ${path1} ${path2}, it will write an flatten file, then I run forge build, it will show this error:ParserError: Multiple SPDX license identifiers found in source file. Use ""AND"" or ""OR"" to combine multiple licenses. I think the license should be deduplicated Look up eip2535 diamond format. Spreads logic out and you can still use libraries if needed. I spent yesterday trying to find same solution, so add my support as well.... I have some contacts that have multiple libraries that will need to be linked.... That's what the diamond standard does Mine will be graphene standard since it’s a simple diamond standard kek Hi how can I log during tests ? Because I tested console.log and std/log and nothing is printed during test Timdam is right, that is basically what a diamond does. But deploying a proper diamond gives you the advantage of upgrade ability. A bunch of rework but it is worth it. I upgraded a contract that was hitting the 24k limit and it took a couple days. Now split into smaller logical chunks and it gives us space you grow. Be sure to look at the different data storage methods and pick what is right for you. We ended up using app storage method. are you running forge test -vvvv or something or just forge test?? forge test -vv does prints I forgot it thanks hey guys ,when I use anvil to fork the bsc mainnet ,i tried to observe the chi gas token caused gas return result,but anvil doesn't seems to provide the feature that allow me to specify the evm version, is there any solution ? when interacting with my SC that sits on Anvil through metamask, it sometimes work and sometimes stuck on pending. any idea why? hey all, I'm getting this error [FAIL.",439
1414,foundry-support.txt,"Reason: Too many global rejects] test_asset((address[4],uint256[4],uint256[4],int256)) (runs: 0, μ: 0, ~: 0) when trying to run https://github.com/a16z/erc4626-tests Does anyone know what the ""Too many global rejects"" error means? Hey is there anywhere a tutorial/docs on how to run against local version of foundry? Forked and build, but can't manage to use it in my project 😅 what do you mean by local version non forked on your local machine? https://book.getfoundry.sh/reference/anvil/ ah yes, figured it out had to use ~/.cargo/bin/foundry instead of foundry you can run foundryup --local path/to/foundry iirc I'm using a solidity script to deploy a contract that deploys other contracts. Is there any way to verify the child contracts automatically too or is verification limited to contracts deployed directly by a script? it should just be import ""forge-std/console.sol""; then use in a function console.log(""Hello World""); this is a bit tricky, iirc those take a while until they're detected but at least sending the request to verify is supported via --verify cc @joshiedo Any ideas here guys? ""forge inspect Counter irOptimized"" just hangs, not getting anything. ""forge inspect Counter abi"" works, hmm can confirm, checking thanks Ok this is stuck in solc for whatever reason, hmm ah that's related to the solc issue we had https://github.com/foundry-rs/forge-std/issues/207 cc @msolomon4 can you try after forge update lib/forge-std? Will try. I was able to do the update, but still doesn't work.",372
1415,foundry-support.txt,"""forge inspect Counter iro"" doesn't work but ""forge inspect Counter abi"" does getting this error again: 2022-11-11T21:26:40.492190Z ERROR sharedbackend: Failed to send/recv `storage` err=GetStorage(0xba100000625a3754423978a60c9317c58a424e3d, 83012310776703402445838102816375336016949411592174183282577191390251619421363, TimeoutError) address=0xba100000625a3754423978a60c9317c58a424e3d index=83012310776703402445838102816375336016949411592174183282577191390251619421363 I am getting the same issue on the second network I try to deploy to It doesn’t matter which, it’s always the second (against two forking-mode anvil nodes) when you say ""doesn't work"", how long did you wait? compiling via-ir may take some time depending on your contract. is this with the Counter contract generated when you forge init a new repo? ok, I thought foundry was fast 😃 ok will wait. Ok, yea took about 20 seconds. ok great, yea compiling with via-ir is slower than non ir compilation 🙂 Yup was same root cause for me, removing rpc cheatcode fixed it what do you mean remocing rpc cheatcode? How did you switch networks then vm.selectFork I didn’t 😅 I broke the deploy script into 2 ah nice cc @joshiedo but I know that @hexonaut used it succesfully, so curious to see why it surfaces to us @Kepler12 — when did you try it? Okay, I think I found it. Openning a GH issue The bug surfaces with createSelect created a foundry pre-commit hook to automatically run forge fmt and snapshot: https://github.com/0xYYY/foundry-pre-commit inspired by @devanoneth : https://twitter.com/devanoneth/status/1590922732988157952 What are some reasons for using deployCode over instantiating contracts yourself besides being able to test specific compiled versions? Hello sirs. I am getting started with foundry doing a simple test. Invoking ierc 20 balance on forked chain on my wallet. Just says evm error revert.",498
1416,foundry-support.txt,"Any way to get a more detailed revert reason? I am certain the code is correct Does anyone understand this error? [FAIL. Reason: Invalid data] setUp() (gas: 0) also encounter this issue just building new project using forge init and running forge test throw this error [FAIL. Reason: Invalid data] setUp() (gas: 0) I guess there is an issue on forge when creating new project, you can easily replicate it by creating new project and run forge test cast 4byte it uses this: https://sig.eth.samczsun.com/ Cool.Thanks I am getting: No files changed, compilation skipped Running 1 test for test/Counter.t.sol:CounterTest [FAIL. Reason: Invalid data] setUp() (gas: 0) Test result: FAILED. 0 passed; 1 failed; finished in 964.80µs Failing tests: Encountered 1 failing test in test/Counter.t.sol:CounterTest [FAIL.",202
1417,foundry-support.txt,"Reason: Invalid data] setUp() (gas: 0) if I type: forge init Counter /cd Counter/ forge test hey all whenever i run cast or deployment commands, i get custom error: EIP-1559 not activated fixed Hello guyz, Im facing a strange issue running tests, could someone help me? https://github.com/transmissions11/solmate/issues/342 Once in a while, the test suite fails and I can see non-test addresses in the trace solved, calling balanceOf in invariant was a bad idea if you use a function that can revert in an invariant block, then yes, it's intended to fail the test when an instruction revert in an invariant Where is there no storage view in the debugger? Is there a setting to show it? *Why how to test a .yul file? cant include it OK guyz !!! Finally deployed and verified with foundry tools https://etherscan.io/token/0xea6698d636e293f4539f1dfa515936b61ab4af62 foundry is an awesome tool! gg anyone from faundry can verify the fix on this, guess its happening on the new project when creating using forge init thanks thanx added here for forge team reference hi Premm.eth resolved the issue, please do the following # update your faundry by running > foundryup You will encounter solc issue, just go to faundry.yaml and define the solidity version you are using ex: > solc = ""0.8.13"" then run the following > forge clean > forge build > forge test Thanx sorry just go to foundry.toml and define the solc version base on the screenshot ok ok works! Thanks for the help! Great! happy coding Why is there no view of storage in the debugger? i find it strange eth rpc requests , dont have a method for getting all tx for an eth address , and you have to do some complicated search logic to extract it because cast storage does cast wallet sign use EIP-191? it does :) This is just for state after before and after transactions, not during the transaction? So it's not the same as the debugger which will step though each line of bytecode during a transaction. With the remix debugger you can see storage changes in the debugger, seems like this is pretty necessary for the forge debugger as well. Hello fam! Trying to get up to speed on Foundry.",492
1418,foundry-support.txt,"🙂 So I’ve hit a bug, when I try forge build on a vanilla install I’m getting this error: dennisonbertram@Dennisons-Air hello_foundry % forge build [⠊] Compiling... [⠔] Installing solc version 0.8.17 [⠃] Successfully installed solc 0.8.17 Error: Solc Error: dyld: Symbol not found: __ZNSt3__113basic_filebufIcNS_11char_traitsIcEEEC1Ev Referenced from: /Users/dennisonbertram/.svm/0.8.17/solc-0.8.17 (which was built for Mac OS X 12.0) Expected in: /usr/lib/libc++.1.dylib I’ve tried solutions such as foundryup and brew install libusb but they haven’t worked. Is there a way to delete my installation and start fresh, or, alternatively fix this issue? When I try one of the other solutions, I still hit the error: ```dennisonbertram@Dennisons-Air hello_foundry % rm -rf ~/.svm dennisonbertram@Dennisons-Air hello_foundry % forge build [⠊] Compiling... [⠰] Installing solc version 0.8.17 [⠃] Successfully installed solc 0.8.17 [⠆] Installing solc version 0.8.17 [⠒] Successfully installed solc 0.8.17 Error: Solc Error: dyld: Symbol not found: __ZNSt3__113basic_filebufIcNS_11char_traitsIcEEEC1Ev Referenced from: /Users/dennisonbertram/.svm/0.8.17/solc-0.8.17 (which was built for Mac OS X 12.0) Expected in: /usr/lib/libc++.1.dylib are you on an M1 or intel? I’m on M1 @brockelmore are you able to use solc by itself? (i.e. not via forge) Not sure- I normally use hardhat and thats working fine.",461
1419,foundry-support.txt,"Do I need to install solc? what’s the output of: ~/.svm/0.8.17/solc-0.8.17 —version dennisonbertram@Dennisons-Air hello_foundry % ~/.svm/0.8.17/solc-0.8.17 —version dyld: Symbol not found: __ZNSt3__113basic_filebufIcNS_11char_traitsIcEEEC1Ev Referenced from: /Users/dennisonbertram/.svm/0.8.17/solc-0.8.17 (which was built for Mac OS X 12.0) Expected in: /usr/lib/libc++.1.dylib zsh: abort ~/.svm/0.8.17/solc-0.8.17 —version dennisonbertram@Dennisons-Air hello_foundry % okay something is messed up with your 0.8.17 install that’s not getting picked up in svm. not sure if you somehow got the intel install instead of M1 or what Try brew install z3 done If that doesn’t work nuke the svm folder and try running the command again No dice. When I do that, it “does more stuff” when I run forge build but doesn’t succeed. dennisonbertram@Dennisons-Air hello_foundry % rm -rf ~/.svm dennisonbertram@Dennisons-Air hello_foundry % forge build [⠊] Compiling... [⠊] Installing solc version 0.8.17 [⠒] Successfully installed solc 0.8.17 [⠑] Installing solc version 0.8.17 [⠊] Successfully installed solc 0.8.17 Error: Solc Error: dyld: Symbol not found: __ZNSt3__113basic_filebufIcNS_11char_traitsIcEEEC1Ev Referenced from: /Users/dennisonbertram/.svm/0.8.17/solc-0.8.17 (which was built for Mac OS X 12.0) Expected in: /usr/lib/libc++.1.dylib How would I start from scratch? Search dylib there is a comment from Georgiois on this This Still no dice.",483
1420,foundry-support.txt,"😕 dennisonbertram@Dennisons-Air hello_foundry % foundryup foundryup: installing foundry (version nightly, tag nightly-45b9dccdc8584fb5fbf55eb190a880d4e3b0753f) foundryup: downloading latest forge, cast and anvil ######################################################################### 100.0% foundryup: downloading manpages ######################################################################### 100.0% foundryup: installed - forge 0.2.0 (45b9dcc 2022-11-13T00:06:47.422154Z) foundryup: installed - cast 0.2.0 (45b9dcc 2022-11-13T00:06:47.422154Z) foundryup: installed - anvil 0.1.0 (45b9dcc 2022-11-13T00:06:52.217281Z) foundryup: done dennisonbertram@Dennisons-Air hello_foundry % rm -rf ~/.svm dennisonbertram@Dennisons-Air hello_foundry % forge b [⠊] Compiling... [⠢] Installing solc version 0.8.17 [⠔] Successfully installed solc 0.8.17 [⠒] Installing solc version 0.8.17 [⠃] Successfully installed solc 0.8.17 Error: Solc Error: dyld: Symbol not found: __ZNSt3__113basic_filebufIcNS_11char_traitsIcEEEC1Ev Referenced from: /Users/dennisonbertram/.svm/0.8.17/solc-0.8.17 (which was built for Mac OS X 12.0) Expected in: /usr/lib/libc++.1.dylib can you try to confirm if your solc version was built for M1? not sure how to do this off the top of my head Let me check how to do that- Okay, not sure how to confirm what version solc was built for, but I did just reinstall it, and getting the same problem.",459
1421,foundry-support.txt,"Looks like it installed: ==> Pouring solidity--0.8.17.arm64_big_sur.bottle.tar.gz I’m on MacOS 11.5, maybe I need to upgrade to 12+? (I loath upgrading MacOS) oh that’s the issue not sure if any solc binaries are built for macos 11.x (regardless, you should upgrade for security reasons) (off to go try it! will report back!) Hmm, Apples offering os 13. Anyone know if that already works? Or will be I be on the opposite side of this problem? (No ones compiiled binaries for it yet…) hmm ye that’s a brand new release (oct 24th), i unfortunately don’t know off the top of my head. if you find where hardhat has the solc version you need you can reference the specific path and pass it into forge got it, okay- going to update and see where to go from there, will report back... im running into this problem where i have one forge dependency dep-A and i also have dep-B which itself has a dependency to dep-A and i can't compile because both of those are pointing to their own ""version"" of IERC20 (even though its identical code). Any suggestions? Upgraded and it works @brockelmore ! got a mistake mark in VS code,but the solidity file can be tested and passed how to fix it ？ did you follow directions for getting vscode setup from the foundry book? it's ok and no the mistake remark some days ago, I just found it tody today all the sol file can be tested well sorry i don’t understand your english very well. follow these steps: https://book.getfoundry.sh/config/vscode and that should solve your issue i believe ok thanks anyway I have not generated the remapping.txt in roots folder and it's ok some days ago and after remapping the txt file , it's ok ,fix it thank u Is it possible to deploy a contract to a particular address in foundry. For testing purposes. you can use vm.etch to write code at a certain address. or u can utilize the normal create2 behavior to deploy to a predetermined address. but there's no way to force a proper deployment (like through the use of the new keyword) to a certain address via foundry import { IERC20} from I suspect you're importing it twice great. thanks.",497
1422,foundry-support.txt,"that was so simple to do. what a great tool! Hey I'm running into an issue with using vm.createFork with a transaction hash, I'm wondering if anyone might be able to help me debug What's the issue? Forking works with a block number or from latest, but with a trasnaction hash, it just hangs indefinitely at this rust trace: 2022-11-14T03:58:58.863606Z TRACE contract{}:applying cheatcode: foundry_evm::executor::backend: merging database data addr=0x7109709ecfa91a80626ff3989d68f67f5b1dd12d 2022-11-14T03:58:58.863649Z TRACE contract{t}:applying cheatcode: foundry_evm::executor::backend: merging database data addr=0xb4c79dab8f259c7aee6e5b2aa729821864227e84 My contracts names removed This is a chain other than eth mainnet Ah it actually it actually went through after 8 minutes, I hadn't waited this long before It's using my node on localhost, which I doubt is the issue as it's very snappy with block number forks Hi, has anybody noticed significant gas underestimation by using forge test + anvil on a fork env vs a real tx? I am looking for something similar to ""log_named_decimal_uint "" but I want to emit multiple variables in the same line. Is it possible? anyone seeing a difference between the —fork-url ""url"" and vm.createFork()? are they not the same? How can I make my script not fail if there’s no env var? Trying to do either mnemonic or private key deployment - so one can be ommitted in env. (try catch doesn’t work) My test script is working with --fork-url CLI flag but not with createSelectFork inside test script. Hi. I was using Foundry as always but it looks Windows update just break Foundry. Some of you know how to fix it? Thanks :) i believe its your OS ""NT"" , have you tried installing ubuntu and foundryup via wsl2 ? I'm on windows Is there any other WA? wsl = ""windows subsystem for Linux"" Yes I know.",482
1423,foundry-support.txt,"I referred to my SO ok then, thats what i had to do for same issue you are having The installation looks fine but when trying to build the exception still appear. :( Solved. I executed foundryup for second time and it is working in wsl: But in PS it still broken. @msolomon4 we removed LowLevelError from forge-std as deprecated. what’s the proper way to handle it now? Just a vm.expectRevert() When running a script, I'm getting ""Failed to estimate gas for tx"" and I can see on chain that the tx reverted because out of gas, and because the gas limit is super low ! Even after manually setting it in the command line, it didn't worked.... How can I do that please ? hmm I don't remember offhand. I think you want to test that there was a revert with no data, whereas vm.expectRevert() passes fo rany revert IIRC. you might need vm.expectRevert("""") or something figured it out by using the -g flag Do you guys know why moving out code from a modifier directly into the function removes the ""stack too deep errors"" ? Or vice-versa, moving code from function to modifier causes stack too deep errors. Would greatly appreciate the feedbacks of solidity wizards 🧙‍♂️ I've never heard of that happening. How big is the modifier, and where is the error getting flagged? inside the modifier or in the normal function? hey, not strictly related to foundry - i have an annoying problem with a test with a reentrant function on a fork i.e A::func1 => B::func2 => A::func1 using ganache-cli i get a result, with the latest version of ganache and hardhat node another, with anvil another one have you ever experience any issues with fork testing and reentrancy? any other evm supporting forks to suggest? is there a way to pin a dep installed by forge to a specific tag, such that running forge update does not update the submodule hash to HEAD of master? I see this PR (https://github.com/foundry-rs/foundry/pull/2241) that seems to set a branch in .gitmodules, but when I actually run forge install some-dep@some-tag, no branch entry is added to .gitmodules. So running forge update overrides the tag hash.",492
1424,foundry-support.txt,"It seems like from the docs (https://book.getfoundry.sh/reference/forge/forge-update) that the intended behavior is to ""update to the latest version on the ref you specified for the dependency when you ran forge install"", so wondering if I'm missing something here Hi there, My deployment scripts are failing after integrating with StdJson in Docker. When I set up anvil and run forge scripts separately, the scripts work just fine. This is the image i am using: ghcr.io/foundry-rs/foundry:latest This is the error message I am getting: | Failed to deploy script: | Execution reverted: Invalid data (gas: 1551502) Any idea what could be going on? Was not able to find open tickets wrt this issue. Does Foundry currently use Anvil? Wdym? Anvil is part of Foundry Forge doesn't use Anvil, no What script is this? It's a custom script I wrote. I wrote another just for testing purposes. All it does is console.log(""Hi there!"") on run() command. Try with a nightly version of the docker image, i had issues when reading binaries, at the time it just seemed like the :latest was stale Are these the nightly builds here? https://github.com/gakonst/foundry/pkgs/container/foundry Can't be right as they're 7 months old I think? Thanks for the suggestion I forge installed everything and built using the latest container image. Seems to have solved the issue. Thank you still for your help. If it happens again I'll try to find the rootcause Is there a way to measure gas by line of code in Forge? Nope Brock had an idea for this ye i even implemented it in the debugger but it blows up the memory usage (even worse than the debugger already is) And this is because oru debugger is naive and doesn’t store memory diffs right? And just clones entire mem? that and my impl did incremental gas by line instead of end state gas by line (i.e. we stored gas usage per line per op) if all we care about is gas usage per line, that should be relatively easy to yoink out dunno what the best way to output that would be besides a new file or a new tui for it got it! might be stupid question but what's the difference between incremenal gas by line vs.",492
1425,foundry-support.txt,"gas usage per line? in the debugger you could step thru and see gas accumulate on a step by step basis I see, will try that thanks it’s not in a production branch which branch is it on / when will it be merged into develop this behavior might change a bit, check out this PR + the linked issue and feel free to leave some comments/thoughts https://github.com/foundry-rs/foundry/pull/3650 when you use a modifier, the code in the modifier is inlined into each function that uses it, which is why this happens (another consequence is that modifers are slightly cheaper than function, but result in larger bytecode) Yes this is what I was thinking but if the modifier is inlined inside the function I don't see why it raises stack too deep errors 🤔 Like the modifier is literally one line calling a function. I'm not on keyboard right now but will share more details when back. Really appreciate the help 🙏 hello, i am trying to deploy my contract to goerli but i'm getting this error can anybody please help? try adding the --legacy flag or use solidity scriptiing --legacy doesn't help Stupid question, but how to log booleans ? :D without doing if (var) { emit log_string(""true""); else { emit log_string(""false""); } import ""forge-std/console.sol""; console.log(var); because when inlined, that line is now in the same scope as the function, whereas when the modifier is its own function its a separate scope. I think the solidity docs should have more info on this/scoping along with potential fixes 🙂 I'm not sure modifiers create their own scope and if they do then it does not make sens why NOT using a modifier works but using it create a stack too deep error. Trying to find more doc on it but the solidity docs is not very verbose when it comes to modifiers. is this normal? 😄 (sz of anvil tmp after few minutes of fuzzing my contracts (few hundred (maybe lower thousands) of txs) xx@mac ~ % du -sh ~/.foundry 220G /Users/xx/.foundry could you please open an issue for this, looks like you use fuzz tests in forking mode against a anvil instance? will open the issue in the evening. here are some thoughts about this issue.. scenario that lead to 200GB tmp: 1.",498
1426,foundry-support.txt,"at the beggining we create a snapshot X of an empty chain 2. we run our fuzz tests (lower thousands of transactions) 3. we revert to the snapshot X 4. we start fuzzing again from the initial state but with different seed other thoughts how to improve anvil: 1. remove the logs (cache) after revert to a snapshot 2. remove the logs after anvil_reset 3. implement anvil_reset without parametr (ie a reset to a clean dev chain) 4. prune the logs from unneccassary data - even basic tests without reverting generate huge tmp files thanks for this, would appreciate if you could add this to the issue Guys, why whould LINK contract in eth waste this much gas in random operations ? The sum of gas is not the one shown at the begining I'm expecting this test to fail because we are performing a safeTransferFrom without the correct approved amount But not to waste that amount of gas SafeERC20 should revert, and its doing it, but the amount of wasted gas is enormus Any ideas ? Or foundry estimator is broken ? It ran 256 times, and the gas usage was the maximum possible, always Im seeing the same. vm.startPrank(owner); console2.log(msg.sender); console2.log(owner); console2.log(address(this)); [...some delegatecall...] vm.stopPrank(); The delegatecall calls a function that depends on msg.sender and it picks up my original msg.sender and not the pranked one owner Was from using a library so the confusion makes sense (call vs delegatecall) The problem was LINK, using YFI it does not happen question on forge coverage — is there an example of how to exclude contracts from the generated lcov report in a GH action? our lcov report includes libraries, mocks, actors, etc. and therefore our coverage % displays signifcantly lower than it should be. I've looked at the coverage.rs implementation but how it works is bit beyond me. it doesn't appear there are any flags I can pass to forge coverage. I'm going down the path of a GH action step that does text manipulation on the generated lcov report to remove all the TN: ... end_of_record lines for excluded contracts, but this will be fiddly and not robust in the face of change.",478
1427,foundry-support.txt,"any guidance would be much appreciated, thanks was there a solution to this? running into something similar and have run foundryup already from inspecting lib/forge-std/src/Vm.sol I can see that functio rpcUrl() is indeed not on the interface createFork() also doesn’t seem to exist anymore? modifiers are inlined, so their local vars are in the same scope as the function using that modifier update your forge-std version, those methods are there. forge update lib/forge-std 🙂 Yes I understand that. But that does not explain my errors ☹️ can't filter natively, but can filter with lcov like this: https://github.com/ScopeLift/foundry-template/blob/30de4a7a89559de799033833f4ee811549a9d3a6/.github/workflows/ci.yml#L55-L72 sorry maybe I'm not following your question/errors? Oh that makes sense, thanks! Don’t see the interface changed, from running that command there’s no output, is that expected? I think so, you can run git submodule status to check which commit you're on, it should match the latest master here: https://github.com/foundry-rs/forge-std/ (can also just try removing/reinstalling the dep if you need, submodules are weird sometimes) My problem is, I have a function, with modifiers, that raises ""stack too deep errors"". If I remove the modifiers and move the modifers code directly inside the function I don't have the stack too deep error anymore which is surprising if modifier are supposed to be inlined... ahh got it, I see. do you have the optimizer on? my guess is that for some reason the optimizer can do a better job optimizing stack usage when inlined than when in a modifier (but I'm not totally sure) Any idea how to remove it from index? I already ran forge remove I have it turned off and i'm not using ""via-ir"" Figured it out.",421
1428,foundry-support.txt,"Was complaining about the fact that lib/forge-std files were already in working directory as staged changes so just had to commit them and then re-run forge install Thanks @msolomon4 anyone have luck running FFI on windows? it seems to not remember my path when i run it or environment variables thank you @msolomon4! exactly what I needed is there a way to output a stacktrace to a file? for tests Hello, how would I use the cast command to call a function which returns an array of structs? I tried the following and it doesn’t work: cast call 0xB4319947947781FFe91dDf96A32aF2D4693FEf64 ""getAssets()([address,uint256,string])"" --rpc-url $RPC In the screenshot is the relevant piece of ABI. Thank you Hi I'm trying to debug a very specific problem and was hoping for some suggestions. I'm getting a math overflow / underflow error coming out of a UniswapV3 function in some of my local tests. I've managed to replicate the function call that produced this error in tenderly, and there it DOESN'T overflow / underflow. This would suggest one of two issues: a bug in the EVM implementation of forge, or a compiler bug in solidity (the local version is 0.8.13 and the on-chain version is 0.7.6). I can't think of any other options? Maybe it’s the same issue as this one https://github.com/foundry-rs/foundry/issues/3596 changing the solidity version locally would be quite a pain if not quite impractical, as I reply on a bunch of other libraries that I may also have to change the solidity pragma for This seems promising Is there any way to have the name of the contract show up in anvil output? It sorry about these, had some issues on revert with cheatcodes that violate evm constraints, like deal, landed two fixes today does this not work? I think you're just mssing parantheses ( ) around the tuples fields tried these options and none of those worked No problem.",443
1429,foundry-support.txt,"Other than the few bugs we’ve had a great experience working with foundry oh interesting, I would have assumed the first variant would work, mind opening an issue with the signature will do I believe I fixed this bug recently but unsure if the crate was published or patched it's likely this https://github.com/rust-ethereum/ethabi/pull/282 I don't think this is upstreamed yet, will check Here is the issue https://github.com/foundry-rs/foundry/issues/3689 Hello guys I was wondering if foundry has any way to run an external command, like in a hardhat task. I need to run a docker from forge or cast or whatever. With hardhat I did it defining a hardhat task and importing the docker-compose library in typescript... Is there anyway to accomplish the same thing with foundry ? I saw a library called unix for shell scripting. (?) Could that be used ? Thanks a lot https://book.getfoundry.sh/cheatcodes/ffi Hi . Thanks for your answer Is there any example of that ? I found it Sorry I don't see how this helps my purpose. Can you provide me more context on your answer ? Thanks a lot and sorry for the troubles is there an utility in forge to print ether balance formatted like “YYY,XXX”? hi ive been having issues installing foundry i keep getting this error can you try after brew install libusb https://github.com/foundry-rs/foundry#libusb-error-when-running-forgecast Where is the documentation on invariant tests? https://book.getfoundry.sh/forge/advanced-testing?highlight=invariant# seems to suggest it's not out yet, but I've seen quite a few repos using it. could link it? want to follow it Hi everyone.",367
1430,foundry-support.txt,"I've had a look at the foundry book, but something isn't quite obvious to me: is it possible to use the interactive debbuger, combined with say cast? Basically what I want to achieve is send a transaction with certain parameters against a local node state, and be able to run the transaction step by step with the debugger the closest I got is something like this: cast run -r http://localhost:8545 --debug 0x72091370aab3fcac5a4c5a4389e1093049f336aeb8c80387104c60a192eae564 however as we see above, cast doesn't have any of the symbols; Is there a way to pass the ABI to the command above? Hello guys I was wondering if foundry has any way to run an external command, like in a hardhat task. I need to run a docker from forge or cast or whatever. With hardhat I did it defining a hardhat task and importing the docker-compose library in typescript... Is there anyway to accomplish the same thing with foundry ? I saw a library called unix for shell scripting. (?) Could that be used ? Thanks a lot Is there a way to call an RPC method in a foundry test? Specifically eth_getProof there's an open issue to integrate cast rpc as cheatcode https://github.com/foundry-rs/foundry/issues/3362 but not implemented yet there are workarounds like https://github.com/memester-xyz/surl/ + json parsing Transactions structs exist here https://github.com/foundry-rs/forge-std/blob/f50a63aa9ed5e1aed19df1a39a81e005b8ed119d/src/StdCheats.sol we can easily add solidity bindings for Proof types I think i tried running ‘brew install libusb’ first but its not working Hello folks.",393
1431,foundry-support.txt,"I'm trying to run the exact code of the example of ffi function and i get an error saying: Invalid provider url: fi what is that mean ? Hello, is there a way to verify contracts when using a script for multi chain deployment? hmm, I wonder if this is due to missing pkg-config can you try after brew install pkg-config I guess libusb tries to find the lib via pkg-config what's the command you're running? opened it and Matt already fixed it oh awesome lol I'm trying to use a signature from cast wallet sign in my smart contract test I can call vm.ffi(...) with the right inputs, but the bytes I get back are the output in ascii and not the actual bytes of the signature anyone know how to parse an ascii string into the actual bytes? figured it out, just need the right sequence of vm.toString(returnVal) then slicing the string and calling vm.parseBytes(...) Nvm, looks like parseBytes(ascii) is converting the input from string to bytes, but not parsing the contents. so when I log the input and output I see identical values Hi I run into Discovered incompatible solidity versions in following when inheriting to 2 gitmoddules together and those 2 git modules have common contracts is there any work around to resolve this ? Hey I'm trying to use forge but am getting 'error[2333]: DeclarationError: Identifier already declared.' The lib/forge-std/src/console.sol import that I get from importing Script.sol is conflicting with node-modules/hardhat/console.sol A friend of mine on mac is running the same test and not running into this issue. (Im on windows) Hello Guys. I'm trying to put up a docker like this... but i'm getting this error. Even though the docker is working. What is that error ? 2022-11-16T20:35:42.543805Z ERROR foundry_evm::executor::inspector::cheatcodes::ext: stderr err=""Container .......",407
1432,foundry-support.txt,"has anyone here ever set lint-staged to run forge fmt? I'm currently looking at forge fmt from a pre-commit hook Wonder if anyone has .vscode settings for forge-fmt @mattsse what should the result of func_attrs_with_params_multiline under config's [fmt]? Hello, I'm getting very unexpected results from using the vm.createFork feature with a transaction hash I've verified that the state that it expected at this transaction (based on logs from a previous transaction), are not with the state that is observed using vm.createFork Is there any reasons why this might be happening? I've tried clearing the ~/.foundry/cache folder and this didn't help is the feature experimental? No Can you open an issue? Yes, what would be information would be most helpful to put in the ticket to help? Unfortunately due to the nature of the code I can't share Try to make a minimal repro Ok NP I submitted this ticket: https://github.com/foundry-rs/foundry/issues/3703 The transactions aren't getting replayed properly - the state is consistent with head of block but not the specified transaction Ok we'll investigate - cc @mattsse looks like txs aren't getting replayed? hello! I just can't get the log to work. Also when doing the tutorial, if I try to call transferFrom I always get WRONG_FROM... even I checked the owner and use vm.prank to call from the right address. What am I doing wrong? addr1 = address(1); addr2 = address(2); nft = new NFT(""TestNFT"", ""TNFT""); nft.mintTo(addr1); assertEq(nft.ownerOf(1), addr1); vm.prank(addr1); nft.transferFrom(addr1, addr2, 4); [FAIL. Reason: WRONG_FROM] testTransfer() (gas: 1180026) Is there a good reference for how to do multichain deployments with forge scripts? I'm getting an error when trying to use vm.createFork(...); vm.selectFork(forkId): The application panicked (crashed).",438
1433,foundry-support.txt,"Message: called `Option::unwrap()` on a `None` value Location: evm/src/executor/backend/mod.rs:583 I am working with uniswapV2 library and I am trying to convert the tests there with foundry tests.But I got the error when I run the tests Are there ways to work around these old version libraries. could you please open an issue with a way to reproduce this, juggling multiple evm instances is a bit hard so there are still some edge cases is there somewhere a clear description of what is tx.origin and what is msg.sender during tests and scripts, at the constructor time, and at the test/run execution time? I’m having issues installing foundry what issues? Hey guys can anyone help me figure out why I keep getting this error If you were trying to resume or verify a multi chain deployment, add --multi to your command invocation trying to deploy a contract on goreli forge script scripts/DeployPayments.s.sol --sig ""runDev()"" --fork-url https://eth-goerli.g.alchemy.com/v2/$Key -i 1 --sender $Address --verify --etherscan-api-key $key hi i was trying to remove a dependency but I get this error fatal: not removing recursively without -r How are you removing them? forge remove dependency name/git url both options didn't work has anyone faced this before ? No but you can just delete the sub module in the lib directory yeah i know I was trying to do it with the command The installation doesn’t work, tried installing libusb with homebrew also but didn’t work It might be helpful if you asked questions better so people can help you. What is the error message ? For those of you guys who are strugggling with [FAIL. Reason: Invalid data] setUp() (gas: 0) in testing and are on windows, you can solve the problem by updating foundry. First of all make sure you're using nightly toolchain on rust because some dependencies of foundry are using unstable features. Then, since foundryup doesn't work on windows, install foundry via the cargo install command you see on the installation page of foundry book.",442
1434,foundry-support.txt,"It will take a while, but once it finishes run forge clean forge build forge test Hello builders, Would like to no if using forge install we could specify the version? Foundryup -c will specify the commit Foundryup -v for version I don’t think we are speaking about think ahah Lol my bad Ahah no worries 😄 since Ethereum has a block gas limit of 30million, how can i enforce it in my tests? hello I get an error when installing foundry to windows can you help Install WSL on windows first? forge test --help | grep gas-limit  --gas-limit <GAS_LIMIT>  --block-gas-limit <GAS_LIMIT> For people who wants to know how to do that 🙂 Which features of Foundry require nightly? Only on CI right? Foundry.toml has an option! Seeing a lot more Windows users lately, or just me? Into_future As far as I remember Hey guys! Would like to know if there some people who tried to run foundry on old smart contract but still trying to use the cheatcode. I got this explicite error My question is : Do we have another way then deplying it then using the interfaces (cause when you are debugging the contract, you will loose the verififed code). can anyone help explain why i am getting incompatible solidity versions.. my erc20 pragma is ^0.8.15 Hey guys, quick question how to mint ether to a contract in test files? it works if i do ^0.8.0.. should i keep like this? Is there any way to run the optimizer for different number of runs for different contracts? Nope Yep Look at the Deal cheatcode! Hmm is this a limitation of solc? Or of forge? Oh how do you get this? We just haven't implemented it. Found a solution 🙂 Thanks anyway 🙂 Ah ok.",384
1435,foundry-support.txt,"Ty sir 🫡 amazng, thanks a lot! 🙏 Ty all :) how can i vm.rollFork but keep some contracts i deployed in my setUp() still on the fork? do i have to redeploy them every time? Getting this error when trying to run 'forge test' https://twitter.com/gakonst/status/1593297333298417665?s=46&t=01SaLD590NXokiNekmC2CA 🙏 Solidity imports will solve this Can someone help? try import { Script } from ..."" Hey @gakonst would you have a few mins for a quick chat ? I'm stuck on a solidity error that is surprising and I'm not sur it's related to foundry but I've never seen this error before. Would love to have your view on it ! 🙏 pls open an issue with a repro 🙂 or paste the issue here Yeah not sure this is related to foundry so might not be appropriate for an issue @gakonst my issue is basically explained here 👆 Long story short, why moving code from function to modifiers raise ""Stack too deep"" errors ? because functions use the stack to pass arguments around whereas modifiers inline everything so you do not avoid stack too deep errors when u have modifiers one trick is to have a modifier which calls a function This is exactly what I have ah then yeah just use a struct in your function args This is for instance some modifiers I'm using to mock tests has to do with where you’re calling this modifier its prob ina.",318
1436,foundry-support.txt,"very busy function try using scopes No it's not, the function is really simple Number of stack var is low I'll try to get a minimal code to reproduce // SPDX-License-Identifier: UNLICENSED pragma solidity ^0.8.17; import ""forge-std/Test.sol""; contract TestMe is Test {  uint256[] arr;  modifier withCallMe(uint256 v) {   callMe(v);   _;  }  function callMe(uint256 v) internal {   arr.push(v);  }  function testMe(uint256 v)   public   withCallMe(1)   withCallMe(1)   withCallMe(1)   withCallMe(1)   withCallMe(1)   withCallMe(1)   withCallMe(1)   withCallMe(1)   withCallMe(1)   withCallMe(1)   withCallMe(1)   withCallMe(1)   withCallMe(1)   withCallMe(1)   withCallMe(1)  {   assertGt(arr.length, 0);   console.log(v);  } } 👆Here is a minimal example, ofc it does not make any sense and the number of modifier is quite big (it sometime happens with less modifiers) but it kind of shows the problem..",281
1437,foundry-support.txt,"And what's even more surprising is that this code works 👇 // SPDX-License-Identifier: UNLICENSED pragma solidity ^0.8.17; import ""forge-std/Test.sol""; contract TestMe is Test {  uint256[] arr;  modifier withCallMe(uint256 v) {   callMe(v);   _;  }  function callMe(uint256 v) internal {   arr.push(v);  }  function testMe(uint256 v) public {   callMe(1);   callMe(1);   callMe(1);   callMe(1);   callMe(1);   callMe(1);   callMe(1);   callMe(1);   callMe(1);   callMe(1);   callMe(1);   callMe(1);   callMe(1);   callMe(1);   callMe(1);   assertGt(arr.length, 0);   console.log(v);  } } What is the easiest way to use create2 with forge? forge script is not working for me for multichain deployments (will file and issue soon, running into some bugs with forkid), so want to just manually use it with forge or cast? What do you want to do exactly? And what does “not working” mean more concretely? I think we already have pre-deployed Create2 deployer contracts everywhere, but we may be missing some chains? I guess I'm asking if the easiest way to use create2 with forge is to first get the bytecode for a given contract, then call cast send and fill in the args manually with the deployer contract address and bytecode? I'm just wondering if there's some shortcut command for doing this that only specifies a contract's path or something You can use create2 from a script via the standard new Foo{salt: }() syntax When I use a script, it says CREATE2 Deployer not present on this chain. [0x4e59b44847b379578588920ca78fbf26c0b4956c], for optimism mainnet Right, that was my question ^^ ^ So let’s add it! @msolomon4 i thought we had opti mainnet Yeah I feel like you guys probably do which makes me think something is weird / there is a bug in forge script...",486
1438,foundry-support.txt,"(Or I am doing something wrong) Would help if you shared a minimal script that repros the issue Should I open an issue regarding the stack too deep error ? filed: https://github.com/foundry-rs/foundry/issues/3708! tyty Hey folks - any way to manually specify gas on contract deploys? Currently getting Execution reverted: EvmError: RejectCallerWithCode (gas: 0) deploying on the Wallaby testnet I'm running some tests forking the chain and I noticed that my contract deployed on an existing EOA (I've figured it out because the balance was not null) is it strange? Can you give an example reporo? how are you deploying? if I deploy forking the mainnet If I deploy without forking sorry i dont understand the issue, can you please open an issue on github with steps to reproduce? Using a solidity script; for example: contract Tokens is Script { USDC usdc; function initialDeploy() external { address deployer = vm.envAddress(""DEPLOYER""); vm.startBroadcast(deployer); usdc = new USDC(); vm.stopBroadcast(); } } Not sure to understand this ""Gotcha"": https://book.getfoundry.sh/cheatcodes/expect-revert?highlight=revert#description We expect the call to revert, but then assert that the transaction didn't reverted with status == true? ? The call itself happened, but you never checked the result right, but that inverting of the status is a bit odd, why wouldn't we decode the return data instead ? or why isn't foundry figuring out if the low level call did succeeded ? because that’s what the low level call is not supposed to do Hey guys, I've got a local anvil chain running, am trying to use Metamask + Ethers to send a tx to it, provider seems to work for ether's call function, but any eth_sendTransaction calls from the provider always result in a pending transaction. Anyone know what might cause pending TXs on an anvil local chain? May be worth noting that I've set --gas-price 0 so my metamask isn't required to have any ETH to pay for this TX try resetting nonce in metamask / force nonce.",461
1439,foundry-support.txt,"always worked for me when had that error hey all, im pinning some depencies using forge install transmissions11/solmate@v7 is there a way for me to verify the current pinned tag/commit ? Hey all, hope all is well :) Has installing foundry been known to set off antiviruses like Bitdefender? It completely interrupted my installation due to a ""threat detection"" Hey everyone! Has anyone dealt with sharing artifact code inside of a monorepo? And if so any particular advice? In forking mode, what are the ways to obtain a non-zero ERC20 balance? Just query the balanceOf an erc20 at some address Please share an example of your repo structure and what is the hardship you're experiencing Lol never heard of this before- foundryup if downloaded from our website or github just installs the released binaries to ~/.foundry Yeah cd to your submodule Pls open an issue with repro But I want to test transfers. How do I get my test account obtain some ERC20 token? deal cheatcode Look it up in Forge std @gakonst wrt forge fmt, should foundry.toml`'s `func_attrs_with_params_multiline = true convert the following: function myFunction(uint256 one, uint256 two, uint256 three) external returns (uint256) { ... }  to function myFunction(  uint256 one,  uint256 two,  uint256 three  )  external returns (uint256)  { ... } or am i misunderstanding ""If function parameters are multiline then always put the function attributes on separate lines."" This can do ERC20? I thought this only worked for native tokens? It works with erc20 too not the cheatcode, there's a helper In test.sol I think so, can't remember.",368
1440,foundry-support.txt,"hey, forge init command to create a demo project, changed foundry.toml to set via_ir = true then forge build it took 53s to compile Yeah we're looking into it Foundryup And we'll have a fix soon this week or next Via ir causes compilation of forge std to blow up still I have upgraded to the lastest version Cool solc=0.8.17 Yeah it's not you Bug on foundry , looking forward for your good news this should be displayed now via the Installed message and you can see branch in gitmodules Hello frens! Do you know why using cast storage i got this weird errors… but '0x1' has a length of 3 Do you know why I got this error? Normally the size is 32 bytes no? I am using : cast storage --rpc-url http://ctf.mevsec.com:49308/ 0x876807312079af775c49c916856A2D65f904e612 0x0000000000000000000000000000000000000000000000000000000000000001 Not tested nor used it but have you tried simply giving it 1 instead of 0x.....01? from the doc : https://book.getfoundry.sh/reference/cast/cast-storage#examples Yep already tried before, that why i tried to use 0x…..0 [FAIL.",288
1441,foundry-support.txt,"Reason: Log != expected log] testSwapToken0() (gas: 269039) Logs: 9991662497915624478906 9991662497915624478906 Why is it not equal?😂 Nvm My bad Then no idea why, just tried both versions on mainnet using cast storage 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2 0 --rpc-url $MAINNET_RPC_URL cast storage 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2 0x0000000000000000000000000000000000000000000000000000000000000001 --rpc-url $MAINNET_RPC_URL And it just works fine I'm getting a weird error when trying to deploy via forge script to gnosis ""etherscan: Failed to deserialize response: data did not match any variant of untagged enum ResponseData"" I'm not even trying to run verification so not sure what etherscan has to do with it... How can I check if JSON contains a key? For now I’m doing readAddress, and it just reverts if there’s no such key - and I can’t use try/catch cause it says it can be used only with external function calls same with ENV variables - if no such var exists while I’m using .envString() - it reverts, and I don’t know how to make try/catch work Mates. What is best security approach about secure rpc ? is there a way to get an array with no duplicates when fuzzing? Good Q. Don't think we have a way to force that. What do you have in mind? Ok, I found the solution to check for key existance by looking at parseRaw bytes length (it’s zero if key doesn’t exist, and more than zero in (I hope) every other case).",409
1442,foundry-support.txt,"Mind if I create a PR to forge-std with this kind of function? StdJson.sol: function keyExists(string memory json, string memory key) internal pure returns (bool) {  return vm.parseJson(json, key).length > 0; } Should be really helpful in such case is there a way to listen events using cast? https://github.com/foundry-rs/forge-std/pull/226 Created a PR for this Is there a trick for foundry tests to pass a function behind if (msg.sender != tx.origin) revert ? vm.asEOA() Im testing a batch add to an enumerable set, but if some elements are duplicates the call will revert and its hard to catch that in the test did u try vm.startprank(eoa,eoa)? I have a contract that deployed fine earlier today but now is giviing ""cannot find artifact"". Forge clean doesnt help The application panicked (crashed). Message: failed to extract foundry config: foundry config error: unexpected character found: \u{0} at line 1 column 1 Location: config/src/lib.rs:438 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets. Aborted Getting this after foundryup to nightly version, whats up? ideas are welcome awesome, thanks, thats super helpful. but i am confused now about branches vs tags i installed solmate@v6, which i meant to be the tag v6 now in .gitmodules it says branch = v6. as far as i know there is no branch v6, though perhaps there used to be, considering there is a branch called v7 how does forge know between a branch or a tag (or a commit)? what's the safest way to add a submodule at a fixed tag/commit, so that calling forge update will not advance the submodule to the most recent commit in its branch ? Hello guys. I'm running Anvil as local node and deployed a contract with forge create.... I want to interact with that contract and call a function from it I'm trying to do cast call 0xDc666..",468
1443,foundry-support.txt,"""test_nodeInfo()"" test_nodeInfo() is the function on the contract But i always get an error: (code: 3, message: execution reverted, data: Some(String(""0x""))) I tried with cast send also, but getting the same Any suggestion ? Thanks a lot! ah in fact forge update fails after forge install transmissions11/solmate@v6 the docs suggest this should be allowed... are only branches supported by forge install ? This question is not Foundry specific, but there are some bright people here so I figure I'll ask. I'm trying to figure out how blockchain explorers ascertain the ""Tokens Transferred"" from a transaction, as shown in the screenshot. Any ideas? they parse ""events"", there is a event called ""Transfer(address indexed from, address indexed to, uint tokens)"" Ah, that approach did occur to me but I was concerned that it might omit transfers for smart contracts which do not implement or emit an event. I'm also not sure if it's able to detect events emitted from a series of different contracts originating from the same transaction. Or is it as simple as filtering by the txid and seeing all the resulting events? Not completely relevant to Foundry SO a while back , i was wondering what is the easier way of extracting tx from evm(goerli) via CLI w/o writing some complicated heuristics search (as suggested from stack overflow), its also not possible to extract all the tx for a single public key , maybe it can be done with the pro version of etherscan , but I havent looked at that, so I found this I found that is possible by - alchemy sdk - alchemy_getAssetTransfers (this is not a plug) , and it has pagination too —> https://i.ibb.co/JtzVbBH/tx.gif whats relevant is that , as i understand , making an API call with cast is not possible , ofcourse thats not required since you already have curl , xh, httpie, for cli based calls to an API ( i prefer to write a js for this tho) which sort of led me into this area , anyway I'll see how to do this in .rs ,later If anyone else has a similar question in mind Hey, guys.",461
1444,foundry-support.txt,"Is there a way to mock the same function call twice, but supply two differnt return values? Example usecase: [1] get balance, [2] do something that changes that balance, [3] get balance again to see how much it changed by. Hello guys. I'm running Anvil as local node and deployed a contract with forge create.... I want to interact with that contract and call a function from it I'm trying to do cast call 0xDc666.. ""test_nodeInfo()"" test_nodeInfo() is the function on the contract But i always get an error: (code: 3, message: execution reverted, data: Some(String(""0x""))) I tried with cast send also, but getting the same Any suggestion ? Thanks a lot! wheres the best place to post bytecode questions? I'm trying to deploy a contract to Moonbeam via 'forge create', but I keep getting an error. I've made sure that my code compiles and that my 'forge create' command is correct, but no luck. Does anyone know what this error means? Hi all. Is it possible to collect the events generated by ""forge test"" ? I would like to consume them from the Javascript side. Should look into vm.recordLogs() and ffi Is there any way to get a default value from env variable reading cheat codes, when the variable is not set? Or will I have to implement this logic manually? Could not find artifact error when using forge create. Anyone have tips for solving this? The contract is working fine in Remix Will have to implement it manually. Though I think that you can try catch the call to check whether it was undefined (might be wrong) rather ugly but works - you can put in a helper function if you'd like bool internal yourVariable; try vm.envBool(""ENV_VAR"") returns (bool value) {   yourVariable = value; } catch {} OTHER TOPIC Is there a way to do nearly equal assertions when testing? I'm working with dates and leap seconds messing up my calculations, I care about up to certain digit.",424
1445,foundry-support.txt,"assertApproxEqAbs(a, b, delta) I think it’s called Not reallly Whats your use case? Trying to connect to a walllet ? thanks 🤲 live monitoring, i was running watch on cast call with 30s but it would have been better if i could listen to events Write a script with ethers-rs forge-std has assertApproxEqAbs. And my assertions library prb-test has assertAlmostEq. https://github.com/paulrberg/prb-test/blob/710c994845ee369bb2dadf19e3b0a1b530c8ba28/src/PRBTest.sol#L810 Is it possible to check for a custom error revert with vm.expectRevert without passing the error arguments? I think the answer is ""no"" but just want to double check .. Getting ""FAIL. Reason: Error != expected error"" errors. Hey. How do you deployments with ledger? I've been trying to run forge create with —ledger and —from, ledger is connected, unlocked and on ethereum app and all I get is ""(code: -32000, message: gas required exceeds allowance (0), data: None)"" error ok, figured it out, same there isn't any docs on it Hello there, trying to deploy contracts on Arbitrum using forge script but I'm facing the same issue as https://github.com/foundry-rs/foundry/issues/2941. Any update about it ? pruned my problem: forge init forge bind cd out/bindings cargo build bunch of compilation errors any ideas? ethers-rs itself compiles fine, it uses serde-aux 4.1.0. Bindings fail compilation because of some serde-aux 4.1.1 stuff. Nope but we could maybe add it like matches!(Err(_),..) ok tracked this down: seems to be a bug in serde-aux itself, where ethers-rs would need to also import the default-features from serde-aux (currently it's = false) since they commented out some stuff. Hari opened a PR there fixing it Okie Thx for tracking This would be cool Are other people getting an 'Invalid data' error for tests after the update? Old repos still work.",462
1446,foundry-support.txt,"On mac btw Also when I run forge update in a new repo, it attempts to give a global update to all repos for me, I ran foundryup and invalid data error is gone Now I'm getting a Solc error for every test, including old repos Anyone here ever get foundry working with termux? is there a way to pass parameters to scirpts? Use the --sig option and provide params at the end Thanks! I can't be the only one who is having issues with an EXTREMELY slow compiler? https://github.com/foundry-rs/foundry/discussions/3525 Does anyone have any tips. We use a lot of inheritance in the constructor of the tests, could that be what makes it slow? Or use of libraries? But it is really killing productivity that it takes a good 90 seconds for a contract change to compile and have an iteration loop. Tips or ideas greatly appreciated 🙏 Is this with via ir? Any updates on this with gas specifications? No, we aren't using IR. The use of the standard optimizer doesn't seem to make too much difference. The code was made public for the Sherlock audit competition - but made private again. I'll share the code soon though which might give more insight. Is there something like ""bound"" for ""int256""? when forge create \ —-lala \ —- lala \ —-verify —-verifier etherscan - Sometimes the contract fails to verify and sometimes it gets verified in the first pass - Is this an issue with RPC provider or is there a problem with my code ? PS when using Etherscan , the success rate of verification is way higher than , using sourcify (tested) https://i.ibb.co/G7Vv92b/image.png Any color on this error/how to resolve it? EVM error FatalExternalError have u tried with another RPC ? = see here - https://www.ankr.com/rpc/ , its slow but functional (free) thanks, will give it a try i’m running anvil --fork-url [private RPC] --base-fee 0 I’ve initiated several foundry project previously.",442
1447,foundry-support.txt,"Just updated and now I get this error upon running foundry init myProject: Initializing /dev/eth/myProject… Installing forge-std in ""/dev/eth/myProject/lib/forge-std"" (url: Some(""https://github.com/foundry-rs/forge-std""), tag: None) Error: fatal: not a git repository (or any of the parent directories): .git Saw the question asked above once already, but didn’t find the answer. https://i.ibb.co/NmC749z/image.png yes its definitely an RPC issue not currently, if you want PR in an int256 overload I think the easiest way is: shift the inputs from int256 to uint256 domain, use the existing bound, shift result back to old domain Hi there - it seems like the bindings generation (for Rust code) have changed recently. There's no more the MyContract::deploy(client, args) method, and there are new modules deploy_my_contract but there is no deploy method inside... Any docs / links / example to see how it works now ? What's this rpc 🤔 Anyone have any ideas on this? hi does anyone know any opensource projects that does nft with foundry? Hi team, I was trying to delpoy contracts thru forge script, but it keeps give me this error , anyone knows what does it mean? Error: Failed to deploy script: Execution reverted: Invalid data (gas: 2453187) I hope there is a function like kthPermutation(3, 0) -> [0, 1, 2] kthPermutation(3, 1) -> [0, 2, 1] kthPermutation(3, 2) -> [1, 0, 2] so we can use it to index the original array Coming back on this - in fact, all my contracts but one have the ""deploy()"" method - Any idea why this single contract doesn't have it in the generated rust binding ? Any checks on the name etc ? (I haven't touched this contract since upgraded the toolings, it used to work fine before).",439
1448,foundry-support.txt,"how to install openzeppelin and set remappings? forge install OpenZeppelin/openzeppelin-contracts forge remappings > remappings.txt Is there a way to run forge test such that require will not be seen as an error, but more as a vm.assume statement and only assert statements will be checked for correctness when running forge create to deploy a contract, I got a error: Error: (code: -32000, message: execution reverted, data: None) then you have an issue in your constructor I dont see the contract has contructor can you share the code? sorry I can't. but I could create a new simple contract to simulate it as you prefer ok, i knew. I use the vm code like this one vm.envAddress( remove it, then it could be deployed. A contract uses vm.envAddress to get address from env. hello guys... I deployed a contract into anvil local node but when i try to interact with it with *cast* or *send* i get this error: *code: 3, message: execution reverted, data: Some(String(""0x""))* I'm just doing a contract call: *cast call 0xDc666.. ""test_nodeInfo()"" Seems like your contracts are maybe not getting deployed as you might expect. Share more info on the way you deploy them if you still need help. Hey there everyone, how do you manage upgradeable contracts? I deployed like this: forge create contracts/Commands.sol:Commands --rpc-url http://127.0.0.1:8545 --unlocked And anvil returned a success deployment with the hash and contract address No clue then, I think cast already calls localhost by default but may be worth trying to specify —rpc-url in the cast command as well yeah, I already tried that with the same results Hey ! im' having trouble with forge test, everything was working well when all of the sudden ""No tests match the provided pattern"" error started to show... i didnt change anything, i've even rolled back to the last working commit and it wont work either Huh strange thing happening... I cloned a repo I know has passing tests. ran forge update to install dependencies, then forge test and all the tests fail with message [FAIL.",461
1449,foundry-support.txt,"Reason: Invalid data] setUp() (gas: 0) Anybody run into that before? with -vvvv I get the trace: Traces: [1480670] → new <Unknown>@""0xb4c7…7e84""  ├─ [0] VM::9d2ad72a() [staticcall]  │ └─ ← 0x0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c496e76616c696420646174610000000000000000000000000000000000000000  └─ ← 0 bytes of code Did you find a answer to this question? Also running into this at the moment. See more people mentioning it. Hmm note to self: run foundryup and search for your question in here before posting. 🙂 lol i did the latter, but running foundryup fixed the vm.createFork problem for me :) has anyone here worked with typechain and foundry together? Like, does typechain accept the .json files that the forge build is spitting out? i think it does, yes thanks yesterday i manually edited a foundry-generated abi file to make it work with typechain. i had to replace the object in the json bytecode property with a string. then typechain could parse the abi.",301
1450,foundry-support.txt,"Is there a best practice for sharing private keys between team members? We want to allow teams to have a single account to deploy all their contracts from and wondering if there's a better solution than passing around .env files 1password Last pass Etc Shared account One idea Multi sig gpg is another option… these all seem kind of jank Is this the standard for aws keys or env vars? I use 1pass personally but thought large teams would have had some other solution I wouldn't put anything serious on that key Just put 1 eth or whatever And use that for your ops getting this error when testing, any ideas? Is that an unknown cheatcode? I'm simply doing a setUp by creating a new instance and it's failing there this is the setup code Hi, trying to troubleshoot some things on macOS, after doing the curl to get the toolchain installer, all seems well as seen in this screenshot however upon opening a new terminal and trying to install with 'foundryup' , it does not recognize command does that mean the toolchain installer was not imported correctly? not sure if im in right path (the project directory) Any help would be much appreciated 🙏 looks like you're just missing the foundry bin dir in PATH? try: export PATH=""$PATH:/Users/<YOU>/.foundry/bin"" can add this to the init script of your shell, ~/.zshrc if your're using zsh I am not sure if this is normal behaviour but my forge only prints console.log (and emit log..) outputs when test cases fail (or when supposed-to-fail test cases dont fail). Can I somehow set forge to always print console.log output? https://book.getfoundry.sh/faq#help-i-cant-see-my-logs even with verbosity set on highest level, if the test passes, then no log outputs are displayed hmm.. wait...let me withdraw my question. I must have a had a problem in my .env file cause I was setting verbosity level there. But I have two more questions about forge coverage 1) is there any documentation about it? Couldnt find any in the foundry book 2) the coverage report keeps marking a branch as untested even though I clearly have a test case going into that branch and the log that I added there is being emitted.",474
1451,foundry-support.txt,"What can I do to improve accuracy of the coverage report or are there any other tools I can use to get a more accurate coverage report with Solidity tests? does something like a // forge-fmt-ignore comment exist to ignore formatting on specific lines? hello, is it possible to execute a curl command from ffi cheatcode ? im trying to do the following but its giving back 0x: can you check that the response that you log is not empty? i tried logging, it also gives me 0x i mean the curl is successful, but if i do it thru ffi, it doesn’t work does anyone know what might be causing this? cc: @gakonst could you please open an issue with a repro so we can take a look, looks odd, likely related to wrong ABI decoding somewhere interesting, wonder if this is an string/bytes issue, can you try after converting the ffi output to a string? would also appreciate an issue with a repro for ffi(curl) + log cmbination, you can replace your API endpoint with https://example.com/ Hello, I'm facing the same issue as here: https://github.com/foundry-rs/foundry/issues/2941. I though it had been fixed but does not seem to work for me either. Any idea ? Thanks ! Is forge doc available? no, not yet. haven't had time to wrap it, but contributions are always welcome https://github.com/foundry-rs/foundry/pull/2701 Hi, I'm getting execution reverted on an eth_call on anvil (using a fork) that is working on the normal node No, I cannot work with forks unless via the CLI Is there a way to get a script to allow args for the run fn, so I can pass arguments to a base deploy script that's dependent on deployments in parent, meaning I can't just put them in the constructor Anyone know how to use vm.fee()? When I set the base fee in my test and print tx.gasprice it is returning 0 Also after you called foundryup - that fixed it for me. Hmm, okay, so maybe a bug that’s since been fixed Any way to deploy a contract at a specific address every time in setUp()? I essentially need to have creat2.deploy deploy a new contract at a predictable address.",475
1452,foundry-support.txt,"The issue is that foundry seems to be changing the address of the address of the deployer contract every so often and then my tests fail deploy from a contract? Any updates on this issue regarding create2: https://github.com/foundry-rs/foundry/issues/3708 @mattsse pls prio been running anvil for quite a while(running an onchain game locally) and it seemed to have bloated my machine (disk memory). Seems like this is a known issue, am I safe to just yeet .foundry ( rm -rf .foundry ) from my computer and reinstall foundryup again? or is there a better way ppl have gone about this? Don't believe I've ever encountered this error before. Can anyone explain it? My test contract is empty save for the setUp function where all I'm doing is deploying an instance of the contract being tested. I would like to replicate the functionality of vm.prank for use outside of foundry tools. I would like to use vm.prank in my contract deployed onchain via eth_call ( for simulation purpose ) Is there any combination of copy and deploy the correct portion of forge-std source code & make modification to geth client that would make the above possible ? My specific usecase is that I need to perform binarySearch where each iteration I need to rely on vm.prank to check if certain condition holds. Hundred of iterations of binarySearch has to finish within 1 second or so and within a single eth_call @gakonst do you have any suggestion Hey all, I'm running a lot of TXs on Anvil at high throughput, and I think I found an issue with how we're hashing TXs. It seems we're not considering the signer or 'from' address in the hash, which can result in a collision of the same TXs from different signers.",381
1453,foundry-support.txt,"I verified with HH implementation and they're doing it differently and using the signer so they issue didn't reproduce there Oh nice catch, could you open an issue for this please? https://github.com/foundry-rs/foundry/issues/3759 I dug deeper, and I think the root cause is actually when we use the impersonate cheat code: if we use the cheat code we give all the impersonated txs the same signature so they're all matched as coming from the same signer on the hash does foundry not check the max code size of the contracts? I've a contract that is 25396 bytes large, which is larger than the max code size EVM supports. forge test doesn't complain but the legacy frameworks like waffle do Trying to use forge doc for natspec. Getting error: subcommand doc wasn't recognised Any ideas It's not merged and I don't know what's the status of it rn: https://github.com/foundry-rs/foundry/pull/2701 Any ideas on another tool to use? Tried solc but doesn't seem to work. Ah joys of creating documentation Anyone has a framework to deploy upgradeable contracts on foundry? Hey, any ideia on how to clear the current remappings, output by “forge config”? I have conflicts there, which are not specified in my current remappings.txt file I was wondering if there was currently a built in way to import solhint / prettier into a foundry project ? or shoud I just use npm ? Because as I've seen the foundry formatter isn't really strong forge remappings > remappings.txt i have all remappings why is this not working? ^ I have contract with solidity version 0.5.2 and 0.8.2 How to set multiple solc version in foundry.toml? Is it possible to forge build a single contract? It would make single-contract commands suc has forge inspect Contract deployedBytecode much faster if only Contract and its dependencies were built. Even if I already ran forge build, forge inspect Contract ...",424
1454,foundry-support.txt,"is slow the first time, then fast on subsquent invocations make sure you’re on latest foundry and latest forge-std I am Good Day, Grand Wizards of Foundry, how do I call a loop within a foundry test function testSomething() { testContract.doSomething(); //repeat 'testContract.doSomething' multiple times } (6871421) To summarize: forge clean forge inspect Contract bytecode # takes 42s forge inspect Contract bytecode # takes 1.3s forge clean forge build      # takes 42s forge inspect Contract bytecode # takes 42s forge inspect Contract bytecode # takes 1.3s Does forge test respect the optimizer settings? Or does it always ignore them? this doesn't work on windows powershell btw, since the pipe will write stdout as UTF-16 (bottom right): i saw some issues / discussions on github yes one contract deploying another one. Sorry, i meant use a contract (not the script) to handle the deployment. Some protocols use a constant address deployer for this, to get the same contract address on different chaons I believe it is not possible from what I am seeing in the docs, but how would you do parametric testing similar to how itParam is used in Hardhat? Like for example if you want to test a division by passing a list of (numerator, denominator, result) so you can test multiple inputs and check the output in one function I just ran foundryup and forge test is now hanging, i.e. the process never exists though the tests pass. Not using mainnet forking Anyone experiencing the same issue? I believe it is a caching issue. Maybe try forge clean and forge test? Thanks but unfortunately it still hangs even after running forge clean Update: nevermind, the issue was a never-ending for loop Which one? more in general, saw it a few times here and in issues Hey there ! @gakonst I've been facing the same issue (https://github.com/foundry-rs/foundry/issues/2941) for a bit of time now without any feedback on it, could you please have a look at it ? Thanks a lot 😁 While? https://solidity-by-example.org/loop/ This is a really old version of foundry: have you tried upgrading it ? I'm on the latest version I try to run foundry with docker....",486
1455,foundry-support.txt,"Docker run ghcr.io/foundry-rs/foundry But the answer is /bin/sh: -c requieres an argument Someone can help me What command are you running? Docker run And the name of image How commanf must running ..... Maybe our error message is suboptimal You need to provide a forge / cast commans Command Next to docker run image You can show me some tutorial hi. if I want to download a source code from several contract address, I heard foundry has something for that? Hey guys, can console2 log integers? I am using console2.logInt but there is no output in the tests. GM/GN friends, currently 'foundry' has some errors when setting it solc v0.6.12 project and getting errors like below. ""forge b [⠒] Compiling... [⠘] Compiling 15 files with 0.6.12 [⠒] Solc 0.6.12 finished in 2.22s Error: Compiler run failed UnimplementedFeatureError: Nested arrays not yet implemented."" Root cause this error is forge-std library and as default forge init command pull latest libraries. If we init forge project with --no-deps option and then getting dependencies with git commit hash errors gonna be solve, which is I solved with 2a2ce369 commit, ""forge install foundry-rs/forge-std@2a2ce369"" This pretty expectable behavior when we pull last version of dependencies. As a result after commit forge-std v1.0.0 (#184) doesn't working with solc 0.6. /lib/forge-std/src/Vm.sol - Lists out all the available cheatcodes - Where in the manual can I read what each one of those functions do ? Foundry Support https://book.getfoundry.sh/cheatcodes/ lol oops Try using verbose logging (-vvv) Notice you can also use emit cheat code if you find it more comfortable Hey there guys, do you know of any framework to deploy upgradeable contracts on foundry? Hey guys, I wanted to deploy a contract using a different create2 deployer contract.",452
1456,foundry-support.txt,"(the default one 0x4e59b44847b379578588920ca78fbf26c0b4956c is hardcoded) there is a discussion on this issue here: https://github.com/foundry-rs/foundry/issues/2638 but seems like there is not much activity I was wondering if I could take this up and implement a way to let user define create2 factory The reason to do this is that some networks like canto do not support transaction replay (eip155). Hence it’s impossible to get create2 contract address as 0x4e59b… Someone know the command for run foundry with docker I pass —verify to my forge create and get this error: Contract verification failed: Response: `NOTOK` Details: `Fail - Unable to verify` any idea how to deploy my verified contract to etherscan i’m on goerli if that helps how to debug bsc chain with source code support? Is there a good example regarding writing e2e fork tests with foundry? Does foundry support starknet? Nope, not in the roadmap. I believe proto star might be state of the art? What do you mean e2e here? Integration/forking? Or with a Frontend? Hi .",261
1457,foundry-support.txt,"How can i use foundry in windows and vs Code? Forking Should've been more precise Got it done with this for(uint i = 1; i < 99; i++){ (bool success,) = address(testAddress).call(abi.encodeWithSignature(""testFunction"", args));  require(success); anybardy has a clue on this issue with the max contract size? Limit is set pretty high, there’s a setting in the config, I think Has anyone achieved to make slither github actions worked with foundry ? So far I have this analyze:  runs-on: ubuntu-latest  steps:  - uses: actions/checkout@v3   with:   submodules: recursive  - uses: crytic/slither-action@v0.2.0   with:   target: 'solidity/' and the logs are File ""/opt/slither/lib/python3.9/site-packages/slither/slithir/variables/reference.py"", line 52, in points_to  assert is_valid_lvalue(points_to) or isinstance( AssertionError hey! sending write txns to a forked Anvil, the txn is submitted fine, but not executed. tested the exact same setup on Goerli - works as expected. any ideas? been stuck on this for days now I have added auto_detect_solc = true in toml file, still getting this error anyone?? I got that cannot use multiple versions but how to handle 0.5.2 the older version and newer version?? Can u open issue? Check deployCode How to pass a payable constructor value using forge script? new Contract{value: 5 eth}() I was actually asking for the options to add for Cli command if it exists. seems like no CLI option, might use vm.envUint to read from environment varialbles Hey, can I simulate a certain existing txid using forge/cast? Found it, cast run I ran into an issue trying to run slither locally when i had both solc and svm installed.",410
1458,foundry-support.txt,"Addiing the issue / solutions here incase anyone else runs into thsi sltiher src/NexusVault.sol  File ""/usr/local/lib/python3.9/site-packages/crytic_compile/platform/solc.py"", line 474, in _run_solc  compiler=""solc"", version=get_version(solc, env), optimized=is_optimized(solc_arguments) File ""/usr/local/lib/python3.9/site-packages/crytic_compile/platform/solc.py"", line 381, in get_version  raise InvalidCompilation(f""Solidity version not found: {stdout}"") crytic_compile.platform.exceptions.InvalidCompilation: Solidity version not found:  /khalani-core$ solc Error: SVM global version not set Turns out I had to set the global version with svm to get it to work i.e.  khalani-core$ svm use 0.7.6 Global version set: 0.7.6  slither src/NexusVault.sol src/NexusVault.sol analyzed (8 contracts with 71 detectors), 0 result(s) found Using cast run, is possible to debug contracts I don’t have their code/abi locally? does anybody know what this error mean? I am trying to fork polygon net. thx ok I found out why slither isn't worker anymore if you start a new project basically the forge-std lib now have a component.Sol contract which is only imports so slither doesn't know how to handle it Is there any difference between using multiple vm.assume statements vs concatenating them using &&? Also, does it make sense to use both vm.assume and bound at the same time? no difference between the two assume approaches, but prefer bound because it's smarter and more performant than assume oh interesting, we're thinking of removing that file anyway. do you mind adding a comment here with this info about how slither doesn't like that file? https://github.com/foundry-rs/forge-std/issues/239 In fact I am going to try to do some more in depth research to be sure it is it not only me and will leave a review if that's the case. gm, I am having issues with vm.roll in a specific test, it doesn't work with forge latest versions (worked with 0.2.0 107f477).",478
1459,foundry-support.txt,"""EvmError: Revert"" I am using this test for it's respective contract, the error is from this line. I can send full traces if needed. https://github.com/fei-protocol/flywheel-v2/blob/main/src/test/token/ERC20MultiVotes.t.sol#L245 GM foundry frens! I am trying to do some differential fuzzing on two versions of the Compound Comptroller contract, before and after the upgrade that caused the COMP distribution bug last September. My hope is to compare results from two forks of mainnet, since the bug depends on the contract's state leading up to the bug exploit. That being said, after coding up my test contract I quickly ran into the rate limit on my Infura RPC API. In hindsight, I might have checked the [fork tests section](https://book.getfoundry.sh/tutorials/best-practices?highlight=api#fork-tests) of the best practices in the Foundry book, which warns us to ""Be careful with fuzz tests on a fork to avoid burning through RPC requests with non-deterministic fuzzing."" I suppose my question is, how should one go about ""being careful"" to use fuzz testing and forks together safely? P.s. I'm a graduate student researcher, just getting started with a new project. My professor is adamant about doing (targeted) differential fuzzing and applying it to upgradeable logic contracts, an idea which I'm excited about as well. The Compound bug is just one prominent example of a bug introduced in an upgrade which led to millions in losses to the protocol. Ideally we can get fuzz testing to work with forks, since there is usually some preexisting state whenever an upgrade is performed, which could lead to bugs that wouldn't occur with a freshly deployed contract. I'd also like to avoid doing a lot of custom initialization on a fresh contract to replicate a simplified version of the actual contract's state, since that would require a lot of additional work from any dev that wants to use the tool on their own contracts. These are my reasons for trying to fuzz a fork, but I'm open to alternative suggestions if this route just isn't feasible. does the rate limiting happen even when you run the tests locally via - anvil ? I haven't tried that yet. I've been creating my forks in the setUp() function using vm.createFork.",483
1460,foundry-support.txt,"Would I need to modify this to use anvil instead? im still learning about cheat codes, why dont you deploy your tests locally , after forking desired net , anvil -f <rpc> to expand on this a bit (and feel free to PR this info into the book 🙂)—fuzz testing always works with forks, but if you have e.g. an infura plan and need to be cognizant of limits, then some tips are: - if the input to your fork fuzz test is some param which is used in an RPC call to fetch data (e.g. maybe you query the token balance of an address), each run of a fuzz test uses 1+ RPC requests, you'll quickly hit rate limits or usage limits - one solution is to specify a fuzz/invariant seed: this makes sure each forge test invocation uses the same fuzz inputs. rpc results are cached locally, so you'll only query the node the first time - another solution is structure your tests so the data you are fuzzing over is data computed locally by your contract, and not data that is used in an RPC call (may or may not be feasible based on what you're doing) - lastly, you can of course always run a local node or bump your RPC plan Thanks Matt! A little follow-up: Currently, my test function is taking an address as param, and first checking whether that address has assets in any Compound markets (already that's a lot of RPC requests that can't be cached...). If so, using the fork from before the upgrade, it checks the address' COMP balance, calls claimComp on the Comptroller, then checks the COMP balance again to get the delta. Then it switches to the fork from after the upgrade and does the same, before comparing the deltas to make sure they're approximately the same. One thought I had, to cut down on the number of runs using addresses that aren't in any Compound markets, was to run a one-time script to scrape a list of all addresses with assets in Compound at that block. Then I could randomly select an address from that list for each fuzz run, using an index parameter in my test function.",441
1461,foundry-support.txt,"Do you think that would help? Also, re: your last point, would it be possible to run these fuzz tests on a local fork using anvil, as suggested by @m0h4m36xx? My concerns are that a) I need to be able to switch between forks in my test function using cheat codes, and b) I need the forks' state to be reset to the specified starting block number after each run. you can also reduce RPC requests with a multicall, see https://github.com/mds1/multicall — so you can seed the test with a list of known addresses that are in markets, then execute a multicall to obtain all of their balances with a single call currently there's no way to run forge tests against anvil Got it, thanks! One final question (for now): Is there any better way to scrape a list of addresses, which are used as keys in a mapping, from a contract's storage than by iterating over all possible addresses? (edit: perhaps the wiser solution would be to scrape Etherscan's ""Holders"" section on the token tracker page for each cToken?) Hi 👋🏼, Quick question regarding gasprice and setEnv. I see from https://github.com/foundry-rs/foundry/pull/1383 that tx.gasprice can be specified in foundry.toml as gas_price, which defaults to 0. I am trying to keep default behavior, except on a particular test file.",308
1462,foundry-support.txt,"I tried using: vm.setEnv(“gas_price”, “1000000”); but tx.gasprice is returning 0 Anyone spotting any obvious miss on my part? Actually it was my mistake, I wasn't using the latest version of slither which had some issues with foundry overall :) On another note, does someone have a working slither github action with sarif file upload ? I think compound has an API you can use if you check their docs, otherwise just querying for relevant events and filtering from there is prob the easiest yea check here: https://github.com/ScopeLift/foundry-template/ any chance we can get errors in forge script json output? as it is now, with --json the output doesn't indicate anything about reverts I thought it'll work but it isn't still giving same error Getting 'fatal: pathspec '.gitmodules' did not match any files' when trying run forge init Still works, though I'd like to get rid of the error message Does forge coverage only accounts for unit tests? It looks like the fork tests are ignored In the coverage report IIRC it counts all the tests So the command should be: forge coverage --fork-url <> ? Yes forge coverage --help | grep fork-url -f, --fork-url <URL>   See --fork-url.   See --fork-url.   See --fork-url. Hey friends, Assuming I'm running a script on a fork done with anvil, how can I impersonate a multisig account? Pranking would not work with broadcasted scripts and startBroadcast won't work with an address it does not have the private key You can impersonate the signers of multisig Inside the script? How? why would you impersonate and broadcast stuff? broadcasting implies posting a transaction to mainnet / testnet., while impersonations simulations / mocks. Would be keen to understand what you use case is What does the error `No associated wallet for addresses` mean when deploying through a script?! I'm looking to simulate a large upgrade of system of smartcontracts on a fork chain. To do that: - I start by forking mainnet with anvil - I run all the deployment scripts (on the fork) - I run the upgrade scripts which simulates upgrading the implementation on various proxies (on the fork) Because I run those scripts on the forkchain, it would be very helpful to impersonate in the scripts.",492
1463,foundry-support.txt,"Right now I'm force to do that via cast rpc anvil_impersonateAccount and execute all the txs which require impersonation there which works but it's super long and it would take me 2 seconds in the script can anyone recommend a tut on how to use the SOLMATE contracts ? referring to this ? https://github.com/transmissions11/solmate , ie., setup and deploy with FOUNDRY https://book.getfoundry.sh/tutorials/solmate-nft?highlight=solmate#creating-an-nft-with-solmate token contract with 0.5.2 version compiles but while writing tests for it if I use 0.8.0 it does not works. So should I lower my test file solidity version?? But will it work?? As told by Georgios deployCode is not working you need to drop the pragmas to the lowest common denomination to get this to work btw , I am sure most people here in this tg are experts, but for the n00bs , i found this vid which goes over the t11 contracts https://youtu.be/IXzY6yUo1t4 ps: this isnt a plug, i dont give a &^%$ abt the org that made this vid hey guys I've been trying to verify a contract on goreli using forge script to deploy I double checked the etherscan api key but I keep getting this error any advice ? Contract verification status: Response: NOTOK Details: Pending in queue Contract verification status: Response: NOTOK Details: Fail - Unable to verify Contract failed to verify. but what about one contract is 0.8.0 another 0.5.2 And I need to check staking contract test which is 0.8.0 with the token contract having version 0.5.2 So seems like not possible or I have to change the contract a lot. which is troublesome or testing correctly won't make sense And I don't think test file version can be lowered more or it won't be able to compile the forge important files nope , verified fine https://goerli.etherscan.io/address/0xd1604c7098e0fc88a8ab229da682672b7d2e5b9f this is the one file you have alot of flexibility on as the forge specific files have very wide pragmas Yes it ranges from 0.6.2 to latest.",500
1464,foundry-support.txt,"0.5.2 is older so that's why Changing 0.5.2 to 0.6.2 can be done still I'll have to change some things in token contract which I am testing Not sure why people use older version for their tokens For some reason, my deployer on Foundry switched to 0x7F...96 from 0xb4...84 after I updated Hardhat/Solc. Anyone know why this might have happened? so some time back i was wondering how to deploy to a deterministic address , with the salt generated from cast create2 , apparently you can do it with this https://github.com/transmissions11/solmate/blob/main/src/utils/CREATE3.sol , need to really understand whats going on in this code tho pls open an issue with a repro^^ mhm, something strange :o started a new fresh repo, got this error on setup. Copied /lib from another working project, it works now Maybe old forge std? Did you foundryup? Is it possible to debug contracts that I don’t have their code locally? nope, i'm on windows so it's a pain everytime 😂 but yeah, probably i'm on an old version and the ""init"" pull the new repo Has anyone had success with parsing Json arrays of arrays? hi team, I want to figure out how the VM.LOAD work , but I find the code on the github is only shows the function name without the content May I know the code for realizing how that work? Format of the JSON: [ [ { ""id"": 512189, ""beet"": ""0x63726f7373000000000000000000000000000000000000000000000000000000"" } ], [ { ""id"": 512189, ""beet"": ""0x63726f7373000000000000000000000000000000000000000000000000000000"" } ] ] How I'm trying to parse it: bytes memory batchRaw = json.parseRaw(""[:]""); Input[][] memory inputBatch = abi.decode( batchRaw, (Input[][]) ); uint256 id = migrateInputBatch[0][0].id; But I still get Error: Script failed.",460
1465,foundry-support.txt,"if the on-chain simulation of a script run succeeds but then when I proceed to send the tx it fails, what could it be? lol weird, so basically this script would call a function on a contract that executes a batch call on another func, so if I call the function n times in the script it works both in the sim and live, but if I call the batch func the on-chain sim works, but the live tx doesn't I got no clue how to debug this, any ideas? It could mean that the fork doesn't have the same gas limit ? Hey guys, any idea what could be causing the following error to be thrown for all tests and scripts? ""[FAIL. Reason: Invalid data] setUp() (gas: 0)"" ok found it! https://github.com/foundry-rs/foundry/issues/3686 Is this fixed? I can reproduce the bug in ghcr.io/foundry-rs/foundry:latest I'm also getting this same error on goerli Silly question perhaps, but is there any way to “play out” an anvil node over a period of time? I.e starting at block X, stream all blocks (with events, txs etc) until current block (obviously this is an issue if you wish to change the state of the local fork, a lot of the future txs will fail, but it being a virtual playback would be enough - so my txs don’t actually land “on chain”) you mean the block gas limit? I thought so too, but I checked and nope :( What is the best way to read an environment variable depending on what chain you are on. For example if I want to run a test on several different chains using weth but that addresses are for weth are different on each chain Hello there, is it an expected behavior that using ""expectRevert"" within a test make a test PASS eventhough previous assertions within this same tets (i.e ""asserEq"") failed ? Just figured out my assertions were failing but the test was succeeding because of the ""expectRevert"".",429
1466,foundry-support.txt,"Actually it seems like it's linked to the usage of snapshot and the ""revertTo"" cheatcode, would love to have your view on it @gakonst 🙏 // SPDX-License-Identifier: UNLICENSED pragma solidity ^0.8.17; import ""forge-std/Test.sol""; contract TestMe is Test {  function testMe() public {   uint256 snapshot = vm.snapshot();   assertTrue(false);   vm.revertTo(snapshot);   assertTrue(true);  } } Outputs the following: $ forge test --match-test testMe -vv [⠒] Compiling... No files changed, compilation skipped Running 1 test for test/TestMe.t.sol:TestMe [PASS] testMe() (gas: 11436) Logs: Error: Assertion Failed Test result: ok. 1 passed; 0 failed; finished in 540.30µs Without the '-vv' flag it's totally invisible that the test failed. Should I open an issue for that ? https://github.com/foundry-rs/foundry/issues/3055 it's already opened actually mb what happens if you dont put in a fork_url into anvil's AnvilEvmArgs it doesn tfork may be edge case. yes please ah shit yeah thanks, how big of an issue is this for you soon? are many ppl facing this? obviously a bug, but wonder if there’s easy wrokaround like refactoring your tests, if not we can take a look sooner than later @xenoliss can you see if the latest forge-std commit fixes this? you'll need to manually specify the commit since there's no tag yet.",342
1467,foundry-support.txt,"@gakonst I think there still is some underlying forge error that should be a high prio fix since this causes wrong test results, but for some reason we noticed changing inheritance order within forge-std also fixed it in anvil, does ClientFork call the underlying rpc connected to it w/ call() or does it mimic the evm - trying to understand the forking mechanism oh it seems to create a local server that acts as the node oh nevermind, it does call the underlying rpc Hey guys, is there a way to verify contracts on Mumbai testnet (or any other testnet for that matter) using Foundry scripts? I am using this command: forge script script/Deploy.s.sol:DeployScript --rpc-url $MUMBAI_RPC_URL --broadcast --verify -vvvv --etherscan-api-key $POLYGONSCAN_API_KEY --chain-id 80001 --watch hey everyone, i was wondering if Foundry has better stacktrace than Hardhat? Problem with hardhat whenever I get error in my tests, I have no idea what exactly and which row failed, I need to put console.log everywhere to pinpoint the line Error: invalid address or ENS name (argument=""name"", value=undefined, code=INVALID_ARGUMENT, version=contracts/5.6.2) this error doesn’t really explain whats going on and which line, its in hardhat Just a quick note on that, it's even worse when nesting snapshots and revertTo calls as the logs are just removed and don't event show up with -vv. Regarding testing on last commit I tried with forge-std c7d30303fc34b7b2a680c86ddc1cd186bec23614, and failing tests are still passing when combined with revertTo. thanks for checking. can you comment on issue 3055 with these extra details / ask to reopen it? Anyone know why contract verification is failing or can someone please provide typical actions to take when you get a NOTOK response from Etherscan what's the best way to test for a ""non-event emit""? Use Case - a function that emits an event depending on the condition satisfied.",441
1468,foundry-support.txt,"So I would like to test that no event is emitted in one case similar to what @openzeppelin/test-helpers are doing with expectEvent.notEmitted I mean one simple way is to test in one case for the event and in the other not, but that's not really clean IMHO... What's not working here? I've requested this too already. Guess it's on the to do list... Wrong chat :) Unsupported feature yet. Sorry. We track these in a meta issue on github so no need to open an issue from my side right? hi. I'm trying to install foundry on Mac OS, but I can't seem to get past error: failed to run custom build command for `svm-rs-builds v0.1.8 . The error message I see is: thread 'main' panicked at 'Failed to fetch releases: ReqwestError(reqwest::Error { kind: Request, url: Url { scheme: ""https"", cannot_be_a_base: false, username: """", password: None, host: Some(Domain(""github.com"")), port: None, path: ""/roynalnaruto/solc-builds/raw/ff4ea8a7bbde4488428de69f2c40a7fc56184f5e/macosx/aarch64/list.json"", query: None, fragment: None }, source: TimedOut })' if i understand this right, this is similar to a Request Timeout issue, yes? Sure, commented here https://github.com/foundry-rs/foundry/issues/3055#issuecomment-1334118460 Oh yes, this is the error. Figured out a small repro case for an issue I ran into: https://github.com/foundry-rs/foundry/issues/3805 I had a bug in assembly where my mem ptr calculation was wrong, and thought this was a good use case for the debugger to step through but hit the 100% CPU hang repro for super strange issue we've been seeing today https://github.com/foundry-rs/foundry/issues/3806 ah this might be similar to https://github.com/foundry-rs/foundry/issues/1373 ohhhh wow that is so interesting.",462
1469,foundry-support.txt,"so compiler is seeing my block.timestamp + 100 pre-warp and autoresolving my block.timestamp + 100 post-warp to the same value How? I was wondering how foundry’s stacktrace looks when unit tests fail or code has bugs Sorry I thought this was a hardhat debug question, my bad I recommend cloning a forge repo and giving it a try with forge t -vvvv @brockelmore @gakonst maybe worth pushing https://github.com/ethereum/solidity/issues/12951 and https://github.com/ethereum/solidity/issues/12963 with solidity team? I forget offhand if there's a workaround for these via-ir issues but via-ir seems to be getting more popular so guessing these issues will keep coming up Is it possible yet to run diff compiler configs for different dirs? Wonder if a quicker solution is to just turn off whichever optimizer steps do the clobbering for test/dir not yet i think we just should prio that whole workstream But we're unblocked now, thanks - we just have to use different values pre/post warp :D i see 3 things: forge-std cleanup, solidity compiler via-ir fixes, configurable optimizer 1 is easy, 3 might require some refactornig, 2 i dont know anyhting about but we can dig with the sol team does this indicate successful verification? been waiting for a bit how long have you been witing for? can you check etherscan fi it got verified sometimes the api response may be flaky and we hang? Do you guys if there is a way to print in more human readable way number? Like for example printing 1M = using emit log_named_uint(“my number”, 1000000); -> will print like 1_000_000? Do we have a solution now for managing multiple solidity pragmas rather than using deployCode and losing the debugger clear view ? Or is that a solidity limitation ? more like it probably How does deployCode bypass this limitation ? Because deployCode compiles the files ""externally"" before the whole foundry process, and utilizes under the hood the cheatcode vm.getCode in order to get the bytecode at a path.",449
1470,foundry-support.txt,"Has anyone had any luck freezing a submodule to a specific commit, for example if I use chainlink as a lib and what to freeze it at a specific commit/version (mainly because I'm getting merge conflicts in branches because of my libs dir, which is using submodules), eg. something akin to [submodule ""lib/chainlink""] path = lib/chainlink url = https://github.com/smartcontractkit/chainlink commit = f9bd77e36b ? hey, facing this error trying to use forge script, c ould someone help me? im running: source .env && forge script script/MyFile.s.sol:MyFileScript --rpc-url myrpcurl --broadcast -vvvv Try running foundryup That usually fixes most issues Or try ommitting the “:MyFileScript” unfortunately none worked Bumping this so it gets some views 👀 I got a similar error running forge script as well: The application panicked (crashed). Message: division by zero Location: /home/runner/.cargo/registry/src/github.com-1ecc6299db9ec823/primitive-types-0.12.1/src/lib.rs:38 I also get an error trying to install a specific version of foundry (perhaps I'm doing something wrong) uma@succinct-worker-1:~$ foundryup -v 47ba170 foundryup: installing foundry (version v47ba170, tag v47ba170) foundryup: downloading latest forge, cast and anvil ########################################################################################################################################################################################################################################### 100.0% gzip: stdin: not in gzip format tar: Child returned status 1 tar: Error is not recoverable: exiting now foundryup: downloading manpages ########################################################################################################################################################################################################################################### 100.0% We saw this yesterday as a flake - do you have a repro? Get new foundryup via curl and try again This isn't expected Having some issues with the json parsing, which are probably due to my ignorance when it comes to abi-encoding. The caveat is that I’m using solidity 0.5.17 and can’t upgrade at the moment so I don’t have access to the full array of forge-std helpers (I’m using an older forked version that’s 0.5-compatible).",471
1471,foundry-support.txt,"The gist of it is I’m querying a json and getting back an array of addresses and I expected that the json.parseRaw would return the result formatted as a dynamic array, but the only way I can get it to decode is if I declare it as a statically sized array. This is how I read the file: bytes memory contractAddressesRaw = json.parseRaw( ""transactions[?(@.transactionType == 'CREATE')].contractAddress"" ); This is what I get back: 0x000000000000000000000000fd46b16f86449b3e03e516a3632e1919a5ca1a53000000000000000000000000c4b6f7d6d1f05c139d2bfad6b63bd98117e7001a000000000000000000000000cd8b3d34ccf4bd7c81c55ce18d640001ea55a26d0000000000000000000000004daf413b1331faa97e4e565ba6682677b077ded0 This works: address[4] memory contractAddresses = abi.decode(contractAddressesRaw, (address[4])); This doesn’t: address[] memory contractAddresses = abi.decode(contractAddressesRaw, (address[])); When looking at the forge-std helpers I don’t see anything special being done in order to parse dynamic arrays returned from the parsed json, so I’m wondering if what’s plaguing me is a difference in behavior of abi.decode due to my solidity version. hey Georgios, could you please help me with this? https://t.me/foundry_support/28263 Never seen this before. Can you open an issue with a repro? Can anyone tell me if using the vm.store cheat code on a forked chain to change the storage of a pre-existing contract would require an RPC request? Should all be simulated locally When using a fork created in a test contract using vm.createFork(rpc_url, block_number), reading from or writing to a pre-existing contract seems to require an RPC request, though I would have thought it was all running locally once the fork was made. My concern is that using vm.store will do the same.",464
1472,foundry-support.txt,"Does every read/write to storage on a forked chain incur an RPC request? I tried reducing the number of requests by using two multicalls, one per fork I'm using to diff test. Each multicall makes three calls, including one to Comptroller.claimComp. That function does a bunch of reading from and writing to storage, including calls to balanceOf on a number of cTokens, and my test is failing halfway through its first run - before it ever gets to the third call in the first multicall, and never reaching the switch to my other fork. I could share the complete trace if you'd like, but anyway, I got like 15 of these ""Failed to send/recv storage"" errors, each with a different index: 2022-12-02T20:41:17.111440Z ERROR sharedbackend: Failed to send/recv 'storage' err=GetStorage(0xc00e94cb662c3520282e6f5717214004a7f26888, 95921785088066090011252135619370885869871585946035779366904300686814659186028, (code: -32005, message: exceeded project rate limit, data: Some(Object({""rate"": Object({""allowed_rps"": Number(1), ""backoff_seconds"": Number(30), ""current_rps"": Number(1.1)}), ""see"": String(""https://infura.io/dashboard"")})))) address=0xc00e94cb662c3520282e6f5717214004a7f26888 index=95921785088066090011252135619370885869871585946035779366904300686814659186028 I don't think every read/write should be an RPC request, @mattsse would know for sure though this looks like a new rate limit error code, will add this to the retry detection Do you think there's a new rate limit on individual read/writes then? Seems like it is independent of the number of requests made if that's the case, and using multicall may not do any good.",439
1473,foundry-support.txt,"I wonder if I'd have better results using Alchemy instead of Infura added this code to retry logic https://github.com/gakonst/ethers-rs/pull/1921 Excellent, thanks Matthias! When do you think I'll be able to foundryup again to get the update? pinging @gakonst once merged will ship this nightly, in a couple hours will also add the --cups argument to forge we have this in anvil which allows you to control the compute units per second budget Excellent! Is there a somewhat easy way to determine the cups required to execute a complex function like Comptroller.claimComp? not sure about infura, but alchemy's free tier is iirc 350 units/s we make some assumptions when budgeting calls to prevent rate limits in first place, which is usually not too bad, see 1.1 rps vs 1.0 rps, and if we run into an rate limit error we still can retry. infura might be different though Got it, I'll do a bit of research on Infura and/or switch to Alchemy as long as we can identify a rate limit error in order to retry it, it's probably very similar curious how vm.parseJson(json, key) works under the hood. in particular for address. is this true: if the string value starts with 0x, decode the following (hex) chars into bytes, padding to a multiple of 32 (on the left) if necessary? anybody else seeing this in their github workflow: Run forge install forge install shell: /usr/bin/bash -e {0} forge: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.33' not found (required by forge) all my jobs failing now This tx https://goerli.etherscan.io/tx/0x8b557848f0ff7b09d7e7786b7927f4d51c2388551e936a2137b4dea4b055bdc5 As described in this tweet https://twitter.com/gakonst/status/1598809163173617664?t=kHVqI0GRegyugS2EIkJDtg&s=19 What is that 0xaaaaaa....",476
1474,foundry-support.txt,"Address ? Is it a vanity address ? i would assume a random address, you cant generate the private key for that Test not being found? Never happened to me: contract TranferTest is Test {... function testTransfer() public {... message: No tests found in project! Forge looks for functions that starts with test. I just sent to a random addr ye What command are you running? forge test mine too with the latest foundryupdate @mattsse fyi my fuzz test is running now! Thanks again 🙏 I'm curious, how does the retry detection work? Like how long does forge wait before retrying? https://github.com/foundry-rs/foundry/actions/runs/3605973112 Release went off successfully a few hours ago, can you try again? Are you on latest foundryup? I want fork moonbeam minnet with foundry How can do it? forge test -f $MOONBEAM_RPC_URL Issues with foundry suite - https://pastebin.com/raw/CE2ZmwyF problem started when did foundryup , i am reverting to pervious build via foundryup -C nightly https://t.me/foundry_support/28319 issues Maybe using the etherscan api? Edit tried using the etherscan api not working..",265
1475,foundry-support.txt,";( $ forge debug --debug $FILE --sig $FUNC https ://book.getfoundry.sh/forge/debugger?highlight=debugg#debugger btw , mr 0x41 , nice writeup ;) Thanks for notifying me! with the brightness terminal transaprency can leak info! ahah will be more careful for the next time ahah! 🙂 but for this one, how to use it with forge script cause would like to debug with my code, will give a try using forge debug anyway 🙂 eg: forge script \ script/apescript.s.sol \ --private-key $PrivateKey \ --debug assuming you have your .env setup i stil have to understand what the debugger is showing though BTW this issue was resolved , when building from source , i tried foundryup -C previous_release , but i got a wall of errors and just rm -rf ~/path.foundry && rm ~/path/.cargo/bin forge cast anvil , and built from source , also as stated in the README.MD , using foundryup -b main also results in that wall of errors ( https://pastebin.com/raw/t3MfXZ9M ) That’s what, i am already using.. But is more like external call to other contract seems to be implemented with the code source yet! ok i see what you mean now, the operations on the external called contract is not showing up , well i have no idea , i would try pulling the contract down , and then figure out how to have that run in the script , in between the vm.startBroadcast() and vm.stopBroadcast() block , lol anyway , your the expert here , i need to take lessons from you ! loool, i don’t think so ahaha! But thanks for the idea, will wait for maybe others feedbacks 😉 Probably someone already encouter this case! I need to share my contract state between my test cases, anyone can help me? can run 'setUp' just one time ? setUp runs once but all variables etc. of your contract are available throughout all your tests....so you can do some stuff in setIp() which stores some data in variables and in your tests you access these variables...also the contract can have helper functions that are accessible by every test case.",460
1476,foundry-support.txt,"without specifying what you want to achieve, it is difficult to give you more specific advice I think he wants to keep the state of the contract, altered between the tests by the tests, like in hardhat. Instead foundry by default, use a clean state of it on each test function to run Hi there, when running anvil using the official docker image (ghcr.io/foundry-rs/foundry:latest), is there a way to mount a volume or something so the RPC cache is persisted? I tried mounting a volume on the /home folder of the docker container, but it didn't write anything, not sure whate else I can try. yes, i need keep state of the contracts. @DanielHH1986 what is ""setIp"" ? Where can i find Moonbeam RPC? https://docs.moonbeam.network/builders/get-started/endpoints/ https://rpc.api.moonbeam.network/ Its? Thanks❤️ https://moonbeam.public.blastapi.io for example However look to create your own rpc on some provider brief explainer here https://github.com/gakonst/ethers-rs/blob/a88d2d03e3340a4f9dd39fae9dfe094750db13d5/ethers-providers/src/transports/retry.rs#L417-L427 I think you can just mount the ~/.foundry/cache dir 1:1 ? I mounted the whole /home and nothing was written in it :( the default location is $HOME/.foundry unsure what this would be inside the container Hey georgios! Gm, I'm running forge test Yeah I know, the container also defines a foundry user, but then it’s not clear if it’s used or not, so I tried both, mounting /home & /home/foundry to no avail.",380
1477,foundry-support.txt,"I guess I’ll keep trying… Maybe it’d be nice to have a way to specify the cache location via command line arts? For anyone that encounters this CI failure with the forge github action today: forge: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.33' not found (required by forge) please take a look at this issue: https://github.com/foundry-rs/foundry/issues/3827 Hello there, any idea how to get a sorted uint256[] array in call data params of a foundry fuzz test ? Trying to fuzz a function that is taking a calldata array. Thanks ! Just bumping to get views. Is it still happening ? Someone on my team had something similar where it looked like it was a network issue. Deleting ~/.svm seems to have fixed it Yep it is. I will try doing what you suggested. Thanks! Has anyone encountered this before? Failed to deploy script: Execution reverted: EvmError: CreateCollision With forge script against a tenderly fork with ethers and web3js i can read the contents of a storage slot from a test. how can i do this with foundry? im trying to the the data stored in a bytes array, the bytes array is in slot 3 and im looking for index 0. This should be at keccak256(3,0) not sure of the correct way to do this hmm this is as it sounds a create collision (deploying a contract to an address that already has code). you might be able to etch to zero code im trying to access a packed slot, which is not supported ☹️ you can still load the slot but we don’t necessarily know the layout ? how vm.load(addr, slot) just be careful with the packed layout :) gm :DD Hey team, what's the right way to get a Tenderly-style calltrace on a local Anvil chain? I keep finding myself running things through Goerli to look at the Tenderly output (example: https://dashboard.tenderly.co/tx/goerli/0x8146edc5b7b9cb860ae991a63f067bc50373a9b0617d05d3cc35afc5d97fb77b/debugger?trace=0.3), but it would be so much better to do this locally.",489
1478,foundry-support.txt,"Thanks 🙏 this could be really helpful 🙏, specially if we can have it for any custom EVM chain guys, anyone can help me? could you please open an issue for this with what's currently not great/should be improved? the --json format probably needs some work Your tests are not expected to share state That's not how they're supposed to work So... anyone else getting these errors currently with GH actions? ok that's the related issue: https://github.com/foundry-rs/foundry/issues/3827 @mattsse should we add these options to the Foundry GHA? So that people get the pinned version by default realized the job the actually builds the static bin was still on ubuntu-latest, this pins the correct build job, https://github.com/foundry-rs/foundry/pull/3834 can trigger a new release once merged Is it possible to somehow debug remote contracts? yeah you can if you set the etherscan api key iirc https://github.com/foundry-rs/foundry/pull/1532 rtaces also WIP https://github.com/foundry-rs/foundry/pull/3006 So far when I want to debug a deployed contract 1. pull contract with cast etherscan-source ... 2. find func sig with cast sig ""function"" 3. run - forge debug <locationOfContract.sol> -s <func sig from step2> if anyone knows a faster way , without PULL contract , do tell... Does this feature not work for you? It should do it Ah I see We don't have forge debug address I think that's probably what cast send --debug Should do Which we don't have We have everything for it just need to wire them up Would take a PR for that --debug flag for cast send (or cast call) Fixed ! ✨ https://i.imgur.com/OqUs5Iv.png Yup running a long-lived anvil instance, we deploy a contract what is the easiest way to deal ERC20s to the newly deployed contract periodically? Things like calling the RPC with the right transactions is possible, but seems higher effort than anvil deal RPC call of some sort. ? cast call to the vm.deal address maybe ? (looks like cast send to the 0x710..",476
1479,foundry-support.txt,"address doesn't work FYI, as per https://github.com/foundry-rs/foundry/blob/master/anvil/src/eth/backend/cheats.rs only the impersonation cheats are present, just self-answering for posterity) Trying to update submodules with forge update, but getting this: fatal: Needed a single revision Unable to find current origin/v1.1.1 revision in submodule path 'lib/forge-std' What could that be? Tried a lot of commands already with recursive pulling etc - but doesn’t help. When i do fuzz testing, is there a way to display/log the values that the fuzz test has used? unfortunately even with highest verbosity the logs are not being printed. Foundry disables Logs for fuzz tests...your terminal could crash. You can use ffi to write logs to a file for the fuzz tests ok thx you can save them off with vm.writeFile which will be much faster than ff, cc @ASP2k Is there a maintained list of network alias somewhere? Tried to verify sth on mumbai with rpc_endpoints and etherscan field set in toml but on verification it fails with Invalid provider url: mumbai (deployment worked) When i run forge script sth --rpc-url https://actualrpc verification works fine. When i run forge script sth --rpc-url mumbai it does not. I’m having intermittent issues with etherscan verification after foundryup’ing this am, and also —slow flag results in nonce too low in a script broadcasting a few txs Going to work on this today. Is there documentation somewhere for what's currently available for local debugging? Looks like we have debug_traceTransaction as an available method, which just outputs a bunch of logs ... is there another layer of tooling on top of that, or is that the current state? Hello 👋 I am trying to learn more on invariants tests and best practices for it.",392
1480,foundry-support.txt,"Found the talk by Rikard Hjort on formal methods and examples in maple-labs repo « revenue distribution token »but not much else Do you have good ressources / good practices to share ? Would take any suggestions to step up on this subject ! moved this to an issue, as it seems quite generally verification has stopped working for me(not only when using alias): https://github.com/foundry-rs/foundry/issues/3839 Can I have it so my test functions are run in a new block after setup has been completed? or their own transactions. just to stagger the setup from the test itself vm.roll() will move a couple of blocks forward : https://github.com/foundry-rs/forge-std/blob/master/src/Vm.sol#L242 looks like all I needed was a gas report although .. it might already be jumping to the function by that time , so i am not sure it works I'm surprised at the refunds my contract is getting I know there were reductions but I've rigged up a sample function that just returns 5 when I delete some storage state before returning, it costs like 16k gas to call it however calling it without deleting anything costs about 300 Has anyone been able to verify a contract on Goerli in the last 3 days? I can't verify via forge or remix right now. Nvm, seems like an issue was raised here: https://github.com/foundry-rs/foundry/issues/3839 I just verified a dummy contact few mins ago, was rubbish boiler plate code mix , was done using forge create --verify --verifier etherscan Worked normally ? Yep.. it was working fine for me @gakonst How does the gas report work? Does that reflect gas refunds within the methods themselves? Contract verification started working again for me - might've been something with etherscan Etherscan was down from 16:00 gmt to 3 hours ago (On goerli) Seems to be down again. it looks like Etherscan hasn't been able to process any Goerli blocks in the last 2 hours It’s back.",439
1481,foundry-support.txt,"Is there any good way of tracing where among a collection of internal functions within a test that a testing failure occurred? Can function calls be distilled to internal function names themselves? Follow-up questions to this....when a test fails during a fuzz test, it would be very nice to automatically log the value that was used during the execution the test failed. Do you think that makes sense? you can set verbosity to highest level with flag ""-vvvvv"" and then you see all the internal calls and their results The Foundry book recommends caching RPC responses when running mainnet fork tests in CI. Does anyone know of a Foundry template (or simply a Foundry-based repo) that has the cache pre-configured in GitHub Actions? figuring out the correct way to use vm.writeFile() How can I push the logs into a text file? Even though the comments in Vm.sol say that file will be created if it doesnt exist, I get this error message that the file does not exist. What am I missing? I know it's not the right to place to ask but I was wondering if there was someone who could help me with a issue regarding ether-rs Can anyone answer this? I need to see what is happening with gas refunds in my methods. I’m freeing up slots but the gas report says that costs me thousands of gas, not saves me it. Gas refunds from sstore should still exist according to the eips I read but according to the gas report from foundry the method is incurring extra gas Can you send any screenshots or snippets for reference sure let me get that for you Hello there ! I have a solidity script that is calling anvil_mine using ffi. What's weird is that the number of blocks specified to mine (if some) is not taken into account and the anvil node is mining a bunch of block for whatever reason. Any idea what's happening ? If feels like the problem is on the script part which is replaying the ffi command several times 🤔 This is the code I have in question. I do some normal reads, looking into an array and a mapping, and a transferFrom just to get some standard gas usage. Then I delete these storage variables you see above. That ought to yield some refunds....",455
1482,foundry-support.txt,"uint deleter1 = 1; uint deleter2 = 1; uint deleter3 = 1; uint deleter4 = 1; uint deleter5 = 1; uint deleter6 = 1; uint deleter7 = 1; function deleteme() public returns (uint) { Matcher storage matcher = matchers[matcherList[0]]; IERC20(matcher.token0).transferFrom(msg.sender, address(this), 1e20); delete deleter1; delete deleter2; delete deleter3; delete deleter4; delete deleter5; delete deleter6; delete deleter7; return 5; } That code, deleting the storage, yields this │ deleteme ┆ 33500 ┆ 33500 ┆ 33500 ┆ 33500 ┆ 1 │ If I comment out the the deletions, I get │ deleteme ┆ 6817 ┆ 6817 ┆ 6817 ┆ 6817 ┆ 1 │ That seems pretty low for a transferFrom, so I gander that the setup function from this test is within the same transaction going to see now what vm.roll() does for me here ah, actually looks like my test function which invokes the above performs some of the setup, which would describe why the transferFrom is so cheap there, that slot has already been set from cold to hot. But it is basically the same when I move it out of the test function into the setup function, so my prior thought applies vm.roll does not change this either, so I still have my question is that because vm.roll just naively changed the block number? or does it perform all the relevant stuff with a block having progressed such that the ensuing code operates as if in a new transaction? does anyone have anything to say about how the gas report is generated with regard to refunds from setting storage to zero? I'm quite surprised to see it costing gas to set slots to zero, according to EIP 3529 this should still have a refund Anybody have an idea why only my console logs in the setUp() function are showing in the Logs section of the results, above the traces? I can see the other calls to console::log in the traces, but they're not getting formatted.",475
1483,foundry-support.txt,"Running 1 test for src/test/compound/Comptroller-fork-diff.sol:TestComptroller [PASS] test_claimComp_diff_before_after(uint8) (runs: 1, μ: 2924860, ~: 2924860) Logs: Number of addresses: 74 Traces: [4852548] TestComptroller::setUp()  ├─ [0] console::log(Number of addresses: %s, 74) [staticcall]  │ └─ ← () ... [2924860] TestComptroller::test_claimComp_diff_before_after(5)  ├─ [0] console::log(Address %s, 0x000008599eB841e58b3e13305Da3dA5df5Ed8fFD) [staticcall]  │ └─ ← () This would be fine if I were only trying to do one run, but since I'm fuzzing, I'd like to see all of the logs without printing all of the traces Also, on a related note, it would be great if the console logs would print _during_ the fuzzing, rather than only after the testing is complete. Fuzzing is often a long process, and I'd like some insight into what it is doing while it is running. how many vs? Are you referring to my console log question? yup -vv My config file has verbosity set to 3. That would be equivalent to -vvv right? Also tried -vvvv and -vvvvv before yeah hmm never tried it with fuzzing perhaps that changes things Interestingly, I just discovered that console logs are caught in test functions that fail, but not in test functions that pass -vvvvv shows traces for setup functions and passed/failed tests, -vvvv shows traces for passed tests and failed tests, -vvv shows traces for failed tests only, -vv shows logs not sure why console.log shows/doesn’t show outside those parameters Logs in passing functions are not caught even with verbosity 5 (-vvvvv). I just created a new issue for this: https://github.com/foundry-rs/foundry/issues/3843 basically figured out my earlier confusion about gas but still have questions about foundry polling..",469
1484,foundry-support.txt,"the gas report says the max gas for a method I've run is 461364 but I poll the gas before running it and console.log(gas - gasleft()); after it runs, and that says 577269 there's a discrepancy of 115905... which is just about 1/5 of the higher number. which is noticeable given EIPC 3259 saying gas refunds are capped at 1/5th the gas expended does this mean the gas report meters the gas usage at the end of the transaction, factoring in the refunds encountered during that part of the transaction? Can you do a forge build for a single contract? nop drat. that'd be sweet. working with a forked repo & want to only compile the one contract I've modified. there's so many others that aren't relevant or able to compile 😂 oh well I randomly test contracts , so if I don't want to test and compile a specific one , i just move it to another location , ofcourse I'm not inheriting them @mattsse Is it possible that the retry logic interferes with triggering assertions? I have a differential fuzzing project in which I am randomly selecting addresses from a pre-defined list, checking the delta in their token balances before and after calling a function on two forks, and asserting that the deltas should be equal. Strangely, the tests only seem to realize there is a difference and trigger the assertion failure after the second time they test a given address (which is possible because I am using a modulo to reduce a uint8 down to the range of valid list indexes). This behavior seems to be consistent across many fuzz campaigns, with the assertions failing only when the RPC request returns immediately due to response caching.",351
1485,foundry-support.txt,"Here is a snippet of the file I'm logging to, in which you can see that the first and second runs should have failed the assertion but only the fourth one (with the same address as the second) fails: Index: 3 0xbFB31966dCfdf3787649bFEe5266F1D0d634aB47 Delta before: 0 Delta after: 7610855283937821 Index: 1 0xFe4443CF2e6D1b6C2cc48aFBA89961dA935A6b61 Delta before: 0 Delta after: 1489517144731 Index: 0 0xC0Bc7bBc9AFA9B0577D10bd3eb636C8D3AB841d3 Delta before: 0 Delta after: 0 Index: 1 0xFe4443CF2e6D1b6C2cc48aFBA89961dA935A6b61 Delta before: 0 Delta after: 1489517144731 And here's the final output logs: Running 1 test for src/test/compound/Comptroller-fork-diff.sol:TestComptroller [FAIL. Reason: Assertion failed. Counterexample: calldata=0xe1b8622c0000000000000000000000000000000000000000000000000000000000000001, args=[1]] test_claimComp_diff_cheat_upgrade(uint8) (runs: 0, μ: 0, ~: 0) Logs: Number of addresses: 611 Index 1 Address 0xFe4443CF2e6D1b6C2cc48aFBA89961dA935A6b61 Delta before = 0 Delta after = 1489517144731 Error: a == b not satisfied [uint]  Expected: 1489517144731  Actual: 0 On second thought, I don't think it's the retry logic. When I rerun the fuzzing campaign multiple times in quick succession, the RPC response caching from prior runs seems to make both the first and second request for 0xFe4443CF2e6D1b6C2cc48aFBA89961dA935A6b61 return immediately.",493
1486,foundry-support.txt,"Also, it is odd that the addresses are still getting a second chance at all, since I added a persistent array of addresses that have already been checked, and used vm.assume to toss out any second checks on the same address. Yet time after time, the address gets checked a second time and only then does the test fail. I'm quite puzzled. (edit: now it's not even consistent about needing to check an address a second time... but it still won't trigger the assertion failure the first few times it encounters a large delta, even though assertEq is comparing 0 with numbers that are in the trillions or even higher...) (edit again: still, most of the time it needs to check an address twice...) P.s. Can anyone tell me if vm.store increments the block number? Hi ! Would be really nice to to implement an anvil_loadState that takes a file path instead of the state directly to bypass the limitation of params length in shell when state start getting big. Seems quite simple to do as the load_state is already implemented, only a matter of reading a file I guess. What do you think of that @mattsse ? Thanks for the great work foundry rocks 🤘 Can you please open an issue for this so we can track this? Can you have a look at the new —load-state —dump-state cli args first? Ow, was not aware of that ! Is that on the anvil CLI ? Oh NICE ! My bad, was looking at the anvil reference, did not see it was already available Hey, Is https://github.com/foundry-rs/foundry/issues/3759 issue being actively worked on? We are currently doing a lot of hacky patches to work around the impersonating issue from breaking our workflow. We also noticed that impersonating accounts boosts performances if you don't care about authenticating the signatures, as it removes a few cryptographic computations both on the Anvil side and on the client side. If help is needed coming up with the best solution, we'd love to help as this is a high priority for us 🙏 Sure can! I just opened an issue (https://github.com/foundry-rs/foundry/issues/3848). In it there is a link at the top to my project, and a link at the bottom to a minimized test contract (without any forking or RPC requests) which reproduces the same issue.",496
1487,foundry-support.txt,"Hey I am trying to deploy a contract to a private polygon-edge instance and getting this error. Anyone knows what the issue? Failed to get account for 0xb8aa26439cb203eeb13b81582e846f6442428d17: 0xb8aa26439cb203eeb13b81582e846f6442428d17 Full Trace `$ forge script script/SimpleDeploy.s.sol --ffi -vvvv --rpc-url ${ETH_RPC_URL} —broadcast --private-key ${PRIVATE_KEY} --legacy [⠆] Compiling... No files changed, compilation skipped 2022-12-07T15:32:58.585814Z ERROR sharedbackend: Failed to send/recv basic err=GetAccount(0xb8aa26439cb203eeb13b81582e846f6442428d17, (code: -32600, message: unable to fetch code, data: None)) address=0xb8aa26439cb203eeb13b81582e846f6442428d17 Error: Failed to get account for 0xb8aa26439cb203eeb13b81582e846f6442428d17: 0xb8aa26439cb203eeb13b81582e846f6442428d17 ` Can anybody help me understand why setUp() is reverting when I call dai()? pragma solidity ^0.8.0; import ""forge-std/Test.sol""; interface mgrLike {  function dai() external view returns (address); } contract MgrSpellTest is Test {  function setUp() public {   mgrLike mgr = mgrLike(0x1F5C294EF3Ff2d2Da30ea9EDAd490C28096C91dF);   address dai = mgr.dai();   console.log(dai);  }  function testCast() public {   assertTrue(true);  } } What is a Privat Polygon Edge Instance ? Is that a rpc service ? Did you remember to pass an rpc _url to it ? I.e forge test -f $RPC_URL? I did not! Thank you 😄 I have run into issues with forge script where trying to deploy to an unknown network. Not 100% polygon edge is supported in forge scripting .",481
1488,foundry-support.txt,"Can you try forge create to see if it works ? Hey Samuel, Yes forge create works, but i gotta run a script bez there are multiple contracts to be deployed. You need to submit a PR to add polygon edge Haven’t looked into ti , but it might have to be treated as a special case , but it might not use an existing chain/network id Worth creating an issue for IMHO Ok let me check, do you think forking polygon on anvil and using forge script on anvil make it work? You could try that But it won’t answer the fact that you won’t be able to do real deployments with forge script A good point, do you think if polygon-edge dont have then polygon main chains wont have it either? there is support for polygon main chain I can't find where they list the supported networks in the source code right now I'm generating some encoded data with abi.encodeWithSignature(). How would I go about writing a test for this? Any examples? Help? Already tried cloning PRBMath and fetching tags. Didn't work. you need to use the github url when running forge install? Or when cloning? could you give me the exact command I need to run? forge install https://github.com/paulrberg/prb-math@v3.0.0 Installing prb-math in ""/Users/samueldare/Code/<>/lib/prb-math"" (url: Some(""https://github.com/paulrberg/prb-math""), tag: Some(""v3.0.0"")))  Installed prb-math v3.0.0 I think your issue was that the tag is v3.0.0 not v3 Not working for me forge clean and try again just following the instructions of the README you can also use this for error tracing RUST_LOG=error forge install https://github.com/paulrberg/prb-math@v3.0.0 hmm there is something wrong with your local version as it works for me what version of forge are you running? Not working Actually for a weird reason, load-state is not working and it seems like the state is not loaded. Using --state works though and does load the state but I don't want to use it as I don't want to overwrite my saved state.",468
1489,foundry-support.txt,"Do you have any idea ? ?? forge --version @SamuelDare I'm running: forge 0.2.0 (b1f6a6c 2022-08-23T00:07:04.829899Z) Not rn, please open an issue. run foundry up. its really old did it, now I'm running: forge 0.2.0 (427c1b5 2022-12-07T00:09:22.004732Z) but still not working tried both @v3 and @v3.0.0 also tried ""forge clean"" before but keep getting ""tag not found"" try this RUST_LOG=error forge install https://github.com/paulrberg/prb-math@v3.0.0 and open an issue . Not sure what's happening @paulrberg? https://github.com/foundry-rs/foundry/issues/3849 Done here 🙏 @SamuelDare thanks. Issue here: https://github.com/paulrberg/prb-math/issues/147 Hey guys, when I call balanceOf view func, I face EVM Revert error with no reason. How to fix that? @eastwood227 this ? But I’ve already configured rpc url in foundry.toml Okay I will try this Even when I set --rpc-url it fails [FAIL. Reason: Contract 0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c does not exist on active fork with id `1` But exists on non active forks: `[0]`] testExploit() (gas: 8789) The ironic part is that it reproduces both on my Macbook and my Linux server (same error) I found solution, I had to put `chain_id = 1` in foundry.toml it’s the problem only with BSC chain Thanks Antonio for opening that issue, I replied now Could I ask someone else in this group to run this command to see if it works? forge install paulrberg/prb-math@v3 It works on my end, I can't reproduce @antoniopgoncalves's error. Works for me.",469
1490,foundry-support.txt,"I meant open the issue in the foundry repo @antoniopgoncalves Thanks @SamuelDare for checking This does indeed look like an issue with Forge itself (or at least, Antonio's local installation/ configuration) rather than prb-math That would be great Can forge cast be used to invoke functions on contracts by providing an ABI and address? Anyone have an example ? you dont need the full abi .. just the function you are calling without the variables https://book.getfoundry.sh/reference/cast/cast#examples also ctrl + F here there are loads of cast samples in this chat hi, is this how to go about working with vyper contracts in foundry? https://github.com/0xKitsune/Foundry-Vyper is there a way to modify a contract variable on fork mainnet ? or would i need to redeploy the contract and set up everything again Yep vm.store what about for mappings im using etch rn Hi guys, I am trying to test the mempool tx decoding locally. I am running anvil in a fork network on a specific block, then using ether-rs, I am connect to my local anvil endpoint and subscribing to mempool txs, and finally I use cast call to send a tx to anvil, but it seems this tx is just execute on anvil evm state, they won't go through the newPendingTransactions. Is there a way simulate it? actually I use the wrong command, should be cast run -q <tx_hash> but still the tx will be applied/publish to my local anvil env, but without going through the newPendingTransactions. solved. with first cast rpc anvil_impersonateAccount then with cast send using the same sender and calldata as the tx_hash I want to run on my local fork is there a way to copy state from one contract into a different contract with foundry, perhaps using cheatcodes? For context, I have a contract with existing state and then a similar contract but instrumented with several invariants. I'm wondering if there is an easy way to migrate the existing state from the original contract into the new one. is there an easy way to derive the public key associated with a private key on foundry? cast wallet address [PRIVATE_KEY] What about in a script ? I installed from source and have forge —version and cast —version.",485
1491,foundry-support.txt,"However when I try forge init it always shows: Error: program not found Location: cli\src\cmd\forge\init.rs:160:18 not sure if i still need to run the curl command to get foundryup which OS are you using ? is there are reason why you're avoiding foundryup? Hi beautiful people 👋 Is there a way to set tx.gasprice in a test ? It is equal to 0 by default. you can pass it as a command line arg to forge test The problem is that i need to update it during a test as it conditions the execution of a call... you would need a cheat code for this . I dont think we have any that do these at the moment Yeah i thought so. Thank you for your help anyway Anyone seen this error before when using vm.etch? writing to 0x0...08 Probably shouldn't be using etch with fuzzed addresses but still Worked it out - trying to etch to contracts with existing code Follow up question. The performance of vm.etch is really, really slow. My tests go from <1s on a 64GB 16 core to >20s Any idea what might be causing this? Looks like the issue only manifests if using etch in a for loop I'm wrong again. etch is fine writing to other contracts, but it can error out if writing to EOAs (I think). However, contract accounts seem quite sparse, to it takes a long time to find them. use the addr cheat code . // Computes address for a given private key  function addr(uint256 privateKey) external returns (address); when I do assertEq (string, string) wtih two urls that are identical... i'm getting a failed test Logs: Error: a == b not satisfied [string] Expected: https://f8n-production-collection-assets.imgix.net/0xdBB9fA1BD6c6da7f7f71b8E6494Cb5be06791936/pre_reveal/nft.gif  Actual: https://f8n-production-collection-assets.imgix.net/0xdBB9fA1BD6c6da7f7f71b8E6494Cb5be06791936/pre_reveal/nft.gif Why would this be the case? ""SIMULATION COMPLETE. To broadcast these transactions, add --broadcast and wallet configuration(s) to the previous command.",496
1492,foundry-support.txt,"See forge script --help for more."" Whats this error? forge script script/polygonContractScript.s.sol -vvvv --rpc-url=$HTTP_CHAINSTACK_ENDPOINT —-broadcast --private-key ${PRIVATE_KEY} --froms $OWNER_ADDRESS I am running this command and some how its a simulation ... i would like the contract to be deployed though... move --broadcast to the end , sometimes the position of those options makes issues @m0h4m36xx Thx, I tried rearranging --broadcast to the end and then some few iternation with other parameters but all gave me the same error. I meant, same simulation successful output while i was hoping for actual deployment do you have a broadcast in your script? I have a script to deploy a contract called Deployer, and when I run this script and deploy the Deployer contract to Goerli, I get the address of the contract. Then when I run forge verify-contract --chain-id 5 --watch 0xc072b08559421B6F409157Ed19d0EbB1767Cd638 <Path to deployer in src> <Etherscan API Key> , it always tries to verify then fails. Is this a verification issue or is my logic incorrect? Updated MacOS and now I can install PRBMath V3 Goerli has been quite troublesome recently However, now my contracts that import other contracts in the same folder are messed up. Help? Would appreciate a minimal repro of the issue on github And we can investigate I'm just doing import ./Math.sol Why is it looking for Math.sol in lib/prb-math/src instead of the current folder? yes , relying on mumbai/bsc/sepolia now , id try some other l2s but finding a faucet for them is quite challenging , check your remappings the name of the library isnt just map.. you have to tell forge where to find it or call your file something else Do i need to add the ""current folder"" to remappings.txt? How do I do that? ./=./ ? Hey friends. How can reveal dapp’s smartcontract address with js? Or another way Thanks the remappings just tell the compiler / forge where to look at your imports. do forge remappings to see what your current remmapings are .",469
1493,foundry-support.txt,"My hunch is that the Math.sol is confusing it this is out of scope for this chat, but if you are interacting with a dapp then dont you already know its address? Yes i do not know it’s address Ok, I think I see the problem I created a new remappings.txt, and re-wrote my remappings But the problem remains, and when I do forge remappings > foo.txt I still get the same old remappings I thought writing a remappings.txt would update my remappings, but it isn't. So how do I update the remappings? Just keep a remapping.txt file or add them to your foundry.time A lot of this is in the foundry book I know: https://book.getfoundry.sh/projects/dependencies?highlight=remappings#remapping-dependencies This is why I made a new remappings.txt But the new remappings.txt isn't changing my actual remappings foundry.time? You mean foundry.toml? Don't think I've ever seen a foundry.time lol .. toml but its always foundry time Samuel i am sorry for ask a question out of scope If you know a way for revealing contract address of a dapp I appreciate it So I should add auto_detect_remappings = false to foundry.toml? So that it only uses my remappings.txt (instead of inferring stuff)? holy shit, it worked finally fixed it thanks @SamuelDare Hey team -- what's the timeline for releasing a major version of the Anvil crate? Every time I go to update, it's incompatible with the latest version of ethers-rs. I have to think this is a super common pairing and it would be nice to have it be stable. --> https://github.com/foundry-rs/foundry/pull/3860 Hey Samuel, yes that was the issue, i had only vm.broadcast() in my script, which i read, will broadcast only on the first transaction. using start and stopBroadcast() helped me I am trying to deploy to local polygon network but its giving me Failed to get account for 0xb8aa26439cb203eeb13b81582e846f6442d28d17: 0xb8aa26439cb203eeb13b81582e846f6442d28d17 Error.",478
1494,foundry-support.txt,"THough deployments are successful when using chainstack polygon Hey! I’ve hit a point where my foundry tests are giving me ‘Stack too deep’ despite the tested contract being able to compile without issue. Any ideas on things I can try? I’ve messed with code scoping {}, removing local state variables and ensuring I’m up to date on foundry and solidity. Is there a setting within forge test to ignore this or increase the stack depth? Is there a way to mock blockhash to use mainnet blocks in a test? ah, using --fork-url solves my problem @msolomon4 re: your simplifications to test_assert.sol in the issue I opened about assertions, since you moved the vm.writeFile(LOG_FILE, """") from the constructor to the setUp function, does that mean setUp is called only once per fuzzing campaign, not once per run? I had thought it was the latter! Also, I left a response to your comment, challenging the notion that the culprit is vm.writeLine :) not fully related to foundry , i notice that whenever I deploy a contract with forge script the function signature is always the same , what is the way to change that ? also does anyone know how to search for contracts by func sig ? constructor and setUp behave the same, but the constructor in tests was never meant to be used so sometimes it has some quirks (e.g. if a test fails in the constructor, it used to panic or not show the trace, though that might be fixed by now) Why was the distinction made in the first place? backwards compatibility with dapptools, which relied on setUp, I'm not sure why dapptools used it over the constructor though I am getting a ""command requires clean working and staging areas"" Error when I try to init into a github repo. What is the design pattern for starting a new project in a github repo? Is foundry a framework that wants to make a new src folder which wants to then be pushed to a new repo? how do people usually start new projects in a git repo??? add the --no-commit flag your init command I cant create a variable for private key . It gives me an error.",440
1495,foundry-support.txt,"How to create a variable in terminal ? This command gives me an error export $PRIVATE_KEY =0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d drop the $ PRIVATE_KEY=0xabcd You reference the variable using $PRIVATE_KEY did it but same result ok i will check again export PRIVATE_KEY=""0xabcde"" then echo $PRIVATE_KEY to see it Thanks lot. it works fine every time when I declare a variable should I use echo ? no that's just if you want to print it out if using as a parameter value you just do like so command --priv_key $PRIVATE_KEY Uhhh, you should probably delete that That looks like a legit pk... @Yasprx no its generated one. I run anvil and there i got that pk oh default pk yeah I see yes I dont get this. please elaborate more. you mean here like this ? --private-key 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 I just need to put privatekey in a variable and later i can use it conveniently If you did this export PRIVATE_KEY=0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 and then execute `command --priv_key $PRIVATE_KEY` you will end up with `command --priv_key 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80` In generally, this is a great read to get gud at bash https://linux.die.net/man/1/bash Thanks i will go though this Highly recommend checking out the bash expansion section My terminal is not showing after running anvil.",419
1496,foundry-support.txt,"how to go it back ? is there a shortcut key to back to terminal or should i open another terminal ? i hope it is not your main wallet yes this is generated pk given by anvil well it is a real wallet https://app.zerion.io/0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266/overview so or you used your own, or Anvil hide a way to steal money😎 Don't share your pkey man hey, updated my foundry and got this /Users/dmtri/.foundry/bin/foundryup: line 136: /Users/dmtri/.foundry/bin/chisel: No such file or directory i think i have missed something new released or wat? ok thats repl, but how do i install it? foundryup does not install it forsome reason you have to update foundryup itself too how to i do that? i simply took the regular installation script from the book. Never heard that theres a special update for the foundryup run the install command again: curl -L https://foundry.paradigm.xyz | bash yeah thats what i did fren) ah I see, the releases don't contain the chisel binary, you have to build it from master for now foundryup -b master thanks fren fixing rn we can't get chiesel on win correct? :( Hey there! I noticed that when using a library inside of a contract, the ABI generated for the contract does not include the events defined inside the library. Would it be possible to include them in the generated ABI files when building a contrat ? Thanks ! Hey thanks, but this seems like a work around.",348
1497,foundry-support.txt,"What is the aspected design pattern for starting a new foundry project in a git repo?? I have the following test that failing struct PackedSlot { uint64 item1; // slot 4 uint64 item2; // slot 4 uint64 item3; // slot 4 address item4; // slot 5 } PackedSlot public packed; test c.setPackedSlot(Discovery.PackedSlot(10, 11, 12, address(0x123))); this works bytes32 data = vm.load(address(c), bytes32(uint256(4))); // 0x0000000000000000000000000000000c000000000000000b000000000000000a this fails uint256 slot = stdstore.target(address(c)).sig(""packed()"").depth(0).find(); // [FAIL. Reason: stdStorage find(StdStorage): Slot(s) not found.] any ideas why? Anyway having issue deploying contract on an arbitrum fork? I keep getting: │ ├─ [8937393460512900551] → new <Unknown>@0x104fBc016F4bb334D775a19E8A6510109AC63E00  │ │ └─ ← 0 bytes of code  │ └─ ← ""EvmError: Revert"" Started from a fresh install / repo / foundry, still happen, when I remove the fork it works I tried different Arbitrum RPC with the same issue Are you calling any of arbitrum system contracts? Has anyone written foundry-arbitrum like that foundry-celo package Which vm.etches the precompiles iirc this is an arbitrum example: https://book.getfoundry.sh/cheatcodes/get-deployed-code Yeah ig would be nice if somebody wrote arbitrum utils and exposed them in vm etch on test setup ArbitrumTest is forge-std/Test no, nothing fancy, I remember it was working at some point? https://github.com/Abracadabra-money/abracadabra-money-foundry/blob/glp-auto-compounding-cauldron/script/GlpCauldronComp.s.sol anything deployed after GmxGlpVault (line 69) results in the ""0 bytes of code"" error. and also when simulating the deployment, results in failed gas estimate.",481
1498,foundry-support.txt,"In a previous deployment, I had to comment script code and deploy one by one or it couldn't deploying many contracts at once it this something related to how blocks are structured / gas caculated on arbitrum? Hey friends, do you know if there is a way to fast-forward a few blocks when you're testing in a fork? vm.roll or createSelctForkk if you want state to update Thanks👌 Hi guys i am trying to write fuzz testing on smart contracts And there is assetId which should be 0 initially , how should i constraint it I've checked the whole codebase , espectially for the constructor , and found nothing So i guess there might be some vulnerablities So currently i want to make sure the initial value of this var , assetId and its relative one , lastAssetId are both set to be 0 at first Any ideas to check that ? hey @gakonst Solidity devs made a survey for us all, if you want and it's not off topic, please pin it so we can help o/ https://hardhat.org/solidity-survey-2022 Long shot .. but maybe setting them in storage before the might work, so the fuzz tests are just updating those values ? Not actually , i just want to use fuzz testing to keep track of those vars , through a series of tx being processed and to see if something weird happens @gakonst here is a simple repo reproducing the issue: https://github.com/0xCalibur/foundry_arbitrum_fork_issue I think I found something, If I remove vm.start/stopBroadcast it deploys correctly You don’t need to use broadcast for forge test afaik Only for script yes but how I've always been doing it is use the same deploy script for deploying and test (forked) for all other chains. This way I've ensuring it will go smoothly once it's live. And so far this method pretty much resulted in flawless chainops https://github.com/foundry-rs/foundry/issues/3874 I filled up an issue about it anyone know what is this error: Invalid type for argument in function call. Invalid implicit conversion from struct A.ConfigureReserveInput memory[2] memory to struct A.ConfigureReserveInput memory[] memory requested.",470
1499,foundry-support.txt,"You are trying to convert / store a dynamic struct in a fixed one can send me a link/doc for read and more information and solutions? Google the error messsage you would get loads on stack overflow thanks man :) I noticed that when i change the the types to uint256 (no longer packed). it works as intended. this appears to be an issue with packed data hey, is it possible to deploy to CELO using foundry? couldnt find on docs Hi ALl, I am new to foundry and so far I love the fast iterative development experience, however I am running into an odd solidity versioning issues when trying to incluse uniswapV3 files. // SPDX-License-Identifier: UNLICENSED pragma solidity >=0.5.0 <0.9.0; pragma abicoder v2; import ""@uniswap/v3-periphery/contracts/base/PeripheryPayments.sol""; Gives me the following error: forge build [⠃] Compiling...2022-12-12T03:07:06.139034Z ERROR ethers_solc::resolver: failed to resolve versions [⠊] Compiling... Error: Discovered incompatible solidity versions in following : src/PairFlash.sol (>=0.5.0 <0.9.0) imports:  lib/v3-periphery/contracts/base/PeripheryPayments.sol (>=0.7.5)  lib/openzeppelin-contracts/contracts/token/ERC20/IERC20.sol (^0.8.0)  lib/v3-periphery/contracts/interfaces/IPeripheryPayments.sol (>=0.7.5)  lib/v3-periphery/contracts/interfaces/external/IWETH9.sol (=0.7.6)  lib/v3-periphery/contracts/libraries/TransferHelper.sol (>=0.6.0)  lib/v3-periphery/contracts/base/PeripheryImmutableState.sol (=0.7.6)  lib/openzeppelin-contracts/contracts/token/ERC20/IERC20.sol (^0.8.0)  lib/openzeppelin-contracts/contracts/token/ERC20/IERC20.sol (^0.8.0)  lib/v3-periphery/contracts/interfaces/IPeripheryImmutableState.sol (>=0.5.0) Any ideas? I thought the range I specified was obivous Nevermind.",493
1500,foundry-support.txt,"after some digging I saw that I need to install a specific version of the uniswap V3 library. Sorry How to extract revert reason from transaction output of delegatecall ? sample: function deposit(uint256 amount, address token) public payable {  bytes memory impldata = abi.encodeWithSelector(<selector>, token, amount);  (bool isSuccessful, bytes memory response) = bridge.delegtecall(impldata); } i want to lookup for revert errors in response say in case the call returns fail (isSuccessful == false) using forge how can we do that? Any help that I can get on this ^^? Hi everyone, i was trying to include the dependecies to a different parent folder (monorepo structure) using remapping i always get the entry point of the actual folder project and not the monorepo one. eg. monorepo/packages/myproject -> trying to remap end up with ""monorepo/packages/myproject/../../node_modules"" Question: Can i define the entry point to be another file and not the project folder itself? Hi. I want to read some files or get some database data or send some http requests in test. I think solidity does not support it, so please does anyone know how to do it. Thanks. Hi guys, is there an anvil config available like hardhat.config.ts? To set the rpc + block num I mean hi im running Anvil locally and i keep getting a ""could not detect network"" when connecting with ethersjs. And if i go to localhost:8545 in my browser, i get an error ""Connection header did not include 'upgrade'"" The exact same script was working fine a few days ago My Coverage from my contract is to 0 despite I have written some test that trigger Contract Method, Does anyone already had this issue ? Found it. You can define root at config file. eg. root = '../../../' I was trying to re-install a submodule but getting this error ""lib/juice-contracts-v1"" already exists in the index, you can update it using forge update.",425
1501,foundry-support.txt,"any clues around this ^ ? try with ffi cheatcode , the manual gives example of how to use it its already there , thats what the error is saying yeah but I removed all the submodules my lib folder is empty is it still listed in .gitmodules tho? I removed by forge remove that would be my first thought delete the .gitmodules I removed the content there doesn't work any idea why it still give the index existing error ? not sure if it helps, but you might try forge clean and then proceed that only removes build artifacts yeah doesn't work in which folder are submodule indexes stored when installed with forge ? hey all, is there an example of using forge script with CREATE3 (solmate, 0xsequence, lifinance, etc)? using solmate CREATE3, my script is failing because either proxy == zero addr or deployed.code.length == 0, depending on the flags I set. feel like I'm missing how they fit together. a simple example would be super helpful. thank you 🙏 how can I remove the submodule index with forge? forge remove doesn't work which example ? what is this CREATE3 now ? last resort , backup contracts folder , make new forge init and do things yeah looks like the only option https://github.com/transmissions11/solmate/blob/main/src/utils/CREATE3.sol https://github.com/transmissions11/solmate/blob/main/src/test/CREATE3.t.sol thanks, no idea whats its doing , gonna have to ask chatgpt for an explanation lol Hey there ! Is there a way to use anvil with dump-state so that emitted events are also part of the save dump? Thanks ! is it possible to deserialize and empty json field without crashing? I'm trying to construct a json file like this: { ""a"": { foo: 2, bar: 55}, ""b"": {} } found a pretty big bug Got this error: Transaction dropped from the mempool: 0x...",399
1502,foundry-support.txt,"when deploying on arbitrum with forge, so I kept trying, however all the transactions actually went through even if foundry told me they were dropped this is on arbitrum btw Pls open an issue with a repro^^ CLI says the contract is already verified on Arbitrum Goerli, but it's not the case on the Arbiscan site https://goerli.arbiscan.io/address/0xB36A0b8391e8CD38827cEE887E114EcDB152D030#code the console.log() formatting options are exciting. I'm looking to format fixed-point values as scaled decimal values for readability when logging - is this possible in the current setup? truncating trailing zeros is also a nice-to-have. e.g. 1020000000000000000 as 1.02 I feel like this would be a commonly desired feature for readable output on token values, etc, so was curious if it's doable using the current built-in feature set. found this on optimism as well maybe its no mempool access that triggers it to fail? When you have the custom error rather than a revert message, is there a way to get it to show which error it is, rather than just EvmError: Revert, like when you don't know where it is reverting & you don't expectRevert? Sorry , i didn't get result from google so come here for help output : ERROR:CryticCompile:Unknown file: @chainlink/contracts/src/v0.8/VRFConsumerBaseV2.sol This is when i was trying to run echidna for fuzz testing. Anyone has insight on this ? look like this CryticCompile can't pull this chainlink file ? Or else , how should i fix this Given the command below, is there a way to omit the --rpc-url flag and instead setting that within the script itself? I would like to have a deployment script deploy to multiple networks without having to run the command below multiple times with a different rpc url. forge script script/NFT.s.sol:MyScript --rpc-url $GOERLI_RPC_URL --broadcast --verify -vvvv I second this question. Do anyone know how to get the code that isn't covered by test? Tried running forge coverage and it says I have a statement that is not covered.",475
1503,foundry-support.txt,"I want to find out which one is it I think forge coverage --report lcov brings me closer to what I want but I'm looking for something graphical to let me know which section of the code have I not covered with tests Found what I need! Thanks to the person who DM me on how to get it out. genhtml lcov.info -o report --branch-coverage He's shy to type in the group but just sharing in case someone else finds it useful next time. any updates with this issue? it looks like etherscan veification is still broken is cast able to sign a transaction and not publish it? just get the raw hex has anyone got a contract verified using forge create with the —via-ir option ? in my case , I am unable to verify the contract , but when i drop it , it gets verified - chains - Sepolia , binance , matic posted by mistake on ethers-dev, please no ban see foundry.toml config Is there a way to view storage layout? Something like this https://www.npmjs.com/package/hardhat-storage-layout https://book.getfoundry.sh/reference/forge/forge-inspect#forge-inspect Is there any way to broadcast from existing contracts in scripts? It doesn't seem to work but that breaks that entire use case of testing a call sequence for a proxy/multisig/admin contracts and then giving the generated calldata to the contract. Yeah we haven't implemented that flow, there's an issue tracking it for gnosis safe Hello! I am working on migrating a project from prettier to fmt. I need help with retaining multine function parameters. fmt currently clubs them all together like this: I saw that there are options like multiline_func_header and single_line_block . I tried them but not sure if they can help me retain multine function parameters i have vm.createFork() and vm.selectFork() in setUp() to avoid having to pass fork url everytime when running tests but it doesn’t seem to be using the fork How do you use it? It should work if you have configured it in rpc_endpointd i pass the url as arg, so dont think need it in config? Hi, My name is Pedro and I’m a smart contract dev for FujiDAO. I was testing an integration of a protocol on Optimism and other L2s. Im having some issues with testing locally (throwing errors) vs deploying and using it live (no errors).",498
1504,foundry-support.txt,"When testing locally, I’ve noticed that the errors are thrown in functions that are add ons to that specific L2. For example in Optimism, there are errors being thrown in L1BLOCKNUMBER (“Unknown opcode error”). I was wondering if you guys create a fork of L2 with the standard EVM and dont add some of the addons. How can I solve this? Any help would be approciated 🙂 hi guys, i have a simple contract that have a fallback: fallback() external payable { revert('Fallback not allowed'); } and in test case i call my contract with a wrong function: address(myContarct).call{value: amount}(abi.encodeWithSignature(""wring function"")); but it passed, i expect to be fail. anyone can help me ? Are there any SLOC metrics that foundry offers? Would be great to have a forge inspect sloc or alike, maybe I missed that release 😅 you can use cloc https://github.com/AlDanial/cloc Thanks! any way to serialize a json file without specifying a key? (ex: top level array) ex: uint[] memory test = new uint[](2) test[0] = 1; test[1] = 2; // serialize resulting json is: [1, 2] @odyslam is this possible? Hey guys, is there any way to run forge install in verbose mode? It takes a good while, or maybe it hangs, dunno. Some installs are instantaneous, others… not so much Can I get cast to force send a reverting tx? I assume foundry enjoyoooooors like rust thing's , so keeping that in mind , I use this https://lib.rs/crates/tokei Sadly it doesn't have a lib for integrating into foundry , I'm no expert in crab lang tho I just saw an error running forge script that looks to be a false alarm. Error states transaction 0x**** that was ""dropped from the mempool"" but actually succeeded and can be seen on etherscan, but the process failed. Ran: forge script script/TestnetDeploy.s.sol --rpc-url $GOERLI_RPC_URL --mnemonics ""$MNEMONIC"" --broadcast --verify -vvvv Logs: Script ran successfully. == Logs == Peripheral Address: 0x*** ## Setting up (1) EVMs.",486
1505,foundry-support.txt,"========================== Simulated On-chain Traces: [3364258] → new Peripheral@0x*** └─ ← 15327 bytes of code ========================== Chain 5 Estimated total gas used for script: 4373535 Estimated amount required: 0.01312255391717256 ETH ========================== ### Finding wallets for all the necessary addresses... ## Sending transactions [0 - 0]. Transactions saved to: /home/runner/work/peripheral-v1/peripheral-v1/broadcast/TestnetDeploy.s.sol/5/run-latest.json ## Waiting for receipts. Transactions saved to: /home/runner/work/peripheral-v1/peripheral-v1/broadcast/TestnetDeploy.s.sol/5/run-latest.json Error: Transaction dropped from the mempool: 0x**** Error: Process completed with exit code 1. Hi, I'm trying fuzz using Foundry, Is that same Echidna? Will it create many cases and sequence call from other contracts be imported? Thanks any bigbrains here that know the reasoning behind this? Hello Everybody! so great to find this place! I haven’t deploy my project for a while now, and when I tried to do it again, I’m starting getting an error without a description when using envUint(). Here’s the trace: any leads how to debug this? Hey Guys, if I want to fuel some account with a specific ERC20 token for testing in a forked environment, the current way I use is find an address that holds these token, startPrank for this address and then transfer funds. Is there any easier way to fuel an account with an arbitrary token (vm.deal only works for native asset)? If not, that would be a really helpful function to add... Deal also works for arbitrary erc20 .. search the code base it has a different signature with the third parameter being the erc20 address iirc Hi guys, I encounter a issue.",392
1506,foundry-support.txt,"I install a dependency, and the sol file from that dependency import openzeppelin contract by npm, so when i command forge build it occured error like : Unable to resolve imports: ""@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol"" i try to add remappings on it but it doesn't work like this : @openzepplin/contracts/=lib/openzeppelin-contracts/contracts/ anyone faced the same issue before? `@openzeppelin/contracts-upgradeable=lib/openzeppelin-contracts-upgradeable/contracts/` forge install https://github.com/OpenZeppelin/openzeppelin-contracts-upgradeable @tihec ^ Yeah I already install that dependency so if you did those two things, then you can import: import {ERC20SnapshotUpgradeable} from ""@openzeppelin/contracts-upgradeable/token/ERC20/extensions/ERC20SnapshotUpgradeable.sol”; I think in your case you’re creating the mapping with contracts not with contracts-upgradable @tihec ^ How can we check the stacktrace of transactions done in an anvil fork ? Thanks for the hint, I found this function you mentioned in Test contract but for some reason I cannot call it even though I inherited from this contract - compiler does not know that function. Not sure why, but will keep trying. Hello Team! I am reaching out regarding help with understanding multiline_func_header option that was recently developed for fmt as per the issue discussion here: https://github.com/foundry-rs/foundry/pull/3252 https://github.com/foundry-rs/foundry/issues/3713 I am unable to format my solidity code to have function paramters on individual lines even when using this flag with different values.",358
1507,foundry-support.txt,"Maybe it's a bug or I misunderstand the usage? I would really appreciate some help with this! Thank you very much! CC: @gakonst @rkrasiuk how do you pass api key for the --rpc-url on forge script ? lol coral_cable_news() is back :) Include the key in the RPC url like https://mainnet.infura.io/<API_KEY> and read from the .env file in your script maybe worth to consider adding ignore list like this one? https://github.com/ethereum-lists/4bytes/blob/master/ignored.lst oh no hmm we’re using sam’s list though i think he missed the filter I guess he displays everything (would expect that at least), so the filtering should be probably done separately btw, upgradeTo is present in my source code - I was expecting that function names would taken from there first How do I fund my contract with some ether to send to another wallet while testing? deal(address, amount) What would be the default address of the contract? Which hasn’t been deployed on test net yet deal can be imported from forge standard library I presume? Yes @ASP2k ? Not sure what do you mean..share some snippets for clarity So, when a user signs and send a string to one of my contract functions, it will send the user some ether. So, the contract needs to have some ether balance to do this. How do simulate this? s that doesnt work for me, i have my network under an AWS API Gateway, Is there a way to add it to the header using forge script? i meant to the request header. the forge script doesnt have any options to do it.",338
1508,foundry-support.txt,"Are you aware of any work arounds? Is it possible to write a script that will send transactions to multiple chains? I'll see if it works with vm.createFork & vm.activeFork atm i write a bash script , which calls the forge script with relevant —rpc-url $foo & --etherscan-api-key $bar (this I have done ) if you use the foundry hardhat template - you can use https://www.npmjs.com/package/xdeployer written by @pcaversaccio ( i dont know how to use hardhat that well ) Thx for mentioning my plugin 😁 actually you can use my Hardhat template that also uses Foundry to use everything smoothly in one repo https://github.com/pcaversaccio/hardhat-project-template-ts hey man u know a lot of this eth stuff , what would you do , if you want to use forge to deploy to multiple networks ? i routinely do that on several testnets using the method i described ? well my recommendation is using Hardhat for that deployments using xdeployer but if you want to use forge only take a look here https://github.com/foundry-rs/foundry/issues/2518 https://github.com/foundry-rs/book/issues/520#issuecomment-1347390974 also that can be helpful hey guys - was anyone able to solve this error when running forge script: Error: Transaction dropped from the mempool: 0x...... I have around 30txns queued but it doesn't get past the first one man can you help me? @pcaversaccio Hey all, is there no way to run tests for a single folder? To be more specific, is there a command that allows specifying a directory to run tests? Say one directory is for integration tests and another unit tests forge test --match testFounctionName my testFunction name are like this: testMath_1 testMath_2 and i run all of them with this: forge test --match testMath I see. Clever solution. Is there no way to just specify directory? I know how to do it in hardhat --match-path <GLOB> Only run tests in source files matching the specified glob pattern [aliases: mp] type ""forge test -h"" in terminal and see the help information Hey, seems that my remappings suddenly stopped working, CI pipeline is completely stuck because of that.",492
1509,foundry-support.txt,"Any ideas? Failed to resolve file: ""/MyProject/lib/forge-std/lib/ds-test/src/test.sol"": No such file or directory (os error 2). ........ entire team is stuck because of that (got the same error for my deployment scripts, changed path to absolute seems to solve it) my remappings: ds-test/=lib/forge-std/lib/ds-test/src/ forge-std/=lib/forge-std/src/ actually, I installed regular and upgradeable, and here's my remappings.txt @openzepplin/contracts/=lib/openzeppelin-contracts/contracts/ @openzepplin/contracts-upgradeable/=lib/openzeppelin-contracts-upgradeable/contracts/ it still occurs the same errors for mapping Yeah, looks like vm.selectFork() doesn't do this. Is it possible to put the VM to sleep for a specified amount of time? it works, the reason is typo... thanks~ What is the args part here? forge script [options] path [args...] I try to accept args in my run function, but it complains I haven't implemented the run()public {} ... (without any arguments) if you use forge script then you should implement the run function on script/{yourscriptname}.s.sol otherwise, if you want to deploy with command line directly, the command is forge create Hi i want use StdStorage How can using this? EvmError: FatalExternalError Trying to test on forked polygon node.",306
1510,foundry-support.txt,"Anyone had this? up :) Has anyone tried to create a docker image with a custom installation of foundry? My Dockerfile is pretty simple: FROM rust:latest ADD https://raw.githubusercontent.com/foundry-rs/foundry/master/foundryup/foundryup ./ RUN chmod +x ./foundryup RUN ./foundryup -C d9965ef65cab71a96a5efaa5e88c3800634e277c But after 20 mins of waiting, it fails with error: could not compile 'foundry-cli' Any idea of what might this mean? Has anyone tried something similar before? do you have the same issue with other commits? Not sure if this was posted here yet: https://twitter.com/solidity_lang/status/1603699716792803330?t=bRU0YH30rkpEZbsMleDfkg&s=19 Solidity devs, please fill out the Solidity survey 2022 , only takes 10 min :) I get this when i try to run it locally: foundryup -C d9965ef65cab71a96a5efaa5e88c3800634e277c remote: Enumerating objects: 6045, done. remote: Counting objects: 100% (1726/1726), done. remote: Compressing objects: 100% (11/11), done. remote: Total 6045 (delta 1715), reused 1715 (delta 1715), pack-reused 4319 Receiving objects: 100% (6045/6045), 7.51 MiB | 942.00 KiB/s, done. Resolving deltas: 100% (4393/4393), completed with 385 local objects.",374
1511,foundry-support.txt,"Then if I enter the user/password it throws Support for password authentication was removed on August 13, 2021. remote: Please see https://docs.github.com/en/get-started/getting-started-with-git/about-remote-repositories#cloning-with-https-urls for information on currently recommended modes of authentication. maybe try passing the auth parameters in the url ? or this ? https://stackoverflow.com/questions/68956741/terminal-is-recognizing-pat-as-a-password-and-not-a-token hmm.. if you git config is properly set up , you should actually need to do this https://stackoverflow.com/questions/60161297/clone-the-git-repository-non-interactively-by-passing-token-in-the-command It is, I'm able to clone the same repo that I'm trying to install It's weird, because after running the command it shows: Installing [repo-name] in ""PATH"" (url: Some(""https://github.com/[name]/[repo]""), tag: None) but i'm using git@github.com:[name]/[repo].git in the command, which should be using SSH Hey there I'm facing an issue using forge scripts. The script simulation is working but the broadcast is not and one of the TX revert (while it should not) leading to a ""Failed to estimate gas for tx"" error. Any idea ? Hey Sers, what is the easiest way to generate a private key for deploying contract purposes ? what is longest an argument list can be with cast send. 850 is too many Heyo .. where would be a good place to have network based vars? I want the deployer script to inject the DAO address, and this address might depend on the network hardhat you can in the config file hey, am having an interesting issue, trying to sort out if it's foundry's fault or not. We have a bunch of functions using vm.toString and stdJson.readString when compiling, solc gives me the warning ""warning[2018]: Warning: Function state mutability can be restricted to pure"" however, trying to change the functions to 'pure' results in compilation subsequently failing with the error ""error[8961]: TypeError: Function declared as view, but this expression (potentially) modifies the state and thus requires non-payable (the default) or payable."" as defined, the`toString` and readString functions are not marked to guarantee they don't modify state.",494
1512,foundry-support.txt,"seems like this could maybe be a solc issue? I'd like to get it fixed because all our CI runs now just show like 20 warnings found it! https://github.com/foundry-rs/book/pull/736 <== Created this the contract version is 0.5.17. forge coverage gives me InternalCompilerError: Assembly exception for bytecode. forge build and forge test works perfectly fine. i know that this particular error might be caused by a bug in solidity compiler. but i don't understand why only forge coverage triggers this bug what does Contract './RewardToken.sol:DividendTracker' has unlinked bytecode. Please check all libraries settings. mean? o.o wasn't that an error that occurred when using standalone sol files without contracts and fixed back in Sep so it's working fine. the issue is the compiler warnings I'm seeing — there is no way to clear them — I either have warnings or things won't compile, but there should be a way to compile w/o warnings found a message from @gakonst saying that dynamic linking of libs with public functions ain't supported so I checked all my deps and there's indeed a lib defined with public functions, what if I just make em internal? are there any caveats? Anyone have advice on the best way to generate random numbers with/using Foundry? Use case is I want to generate a bunch of attributes randomly in my contract deploy script with random values like 0-10, 0-60, etc. which will be stored on chain upon deploy. Any suggestions? QRNG Look into api3's QRNG airnode I was hoping for something simpler that can run locally, like a Foundry equivalent of Math.random(). Doesn't have to be quantum resistant, just reliably random. hey guys - can i execute a shell script from a Foundry Script? have you tried calling a shell command from script, to read a random number from whatever you want? ^ can you test a function of an abstract class? How do you get more info than this: [FAIL.",419
1513,foundry-support.txt,"Reason: Setup failed: EvmError: Revert] setUp() (gas: 0) like some kind of stack trace to see what is wrong? Just write a function that returns keccak of some pseudo random number like block.hash(block.number - 1) and then just keep on hashing it to get a next new value if it’s only for deployment Are you using -vvv? a hunch: are you running forked test and not passing a provider url? Shot me in the foot many a time this might be a nice cheat code .. ffi to echo $RANDOM or /dev/random ffis : https://github.com/foundry-rs/forge-std/blob/master/src/Vm.sol#L43 an example of how to execute a python script: https://github.com/kjr217/foundry-python-template/blob/master/test/Counter.t.sol#L36 https://github.com/foundry-rs/foundry/issues/3901 @gakonst Hi All, I am unable to forge build [⠒] Compiling...",217
1514,foundry-support.txt,"[⠒] Installing solc version 0.8.15 [⠢] Failed to install solc 0.8.15: error sending request for url (https://raw.githubusercontent.com/roynalnaruto/solc-builds/ff4ea8a7bbde4488428de69f2c40a7fc56184f5e/macosx/aarch64/list.json): error trying to connect: tcp connect error: Operation timed out (os error 60) Error: error sending request for url (https://raw.githubusercontent.com/roynalnaruto/solc-builds/ff4ea8a7bbde4488428de69f2c40a7fc56184f5e/macosx/aarch64/list.json): error trying to connect: tcp connect error: Operation timed out (os error 60) Context: - Error #0: error trying to connect: tcp connect error: Operation timed out (os error 60) - Error #1: tcp connect error: Operation timed out (os error 60) - Error #2: Operation timed out (os error 60) another stange thing is the blank src, script, test created by default are in 0.8.13, while the error is about 0.8.15?? forge --version forge 0.2.0 (95bbad6 2022-12-17T00:09:19.194094Z) Delete ~/.svm And build again just forge build? Gives the same error but now it is trying 0.8.17 instead of 0.8.15 earlier Foundry is creating files pragma solidity ^0.8.13; , error is about 0.8.17. If i change it to explicit pragma solidity 0.8.13; , error is about 0.8.13, as expected. But the errors are same... Similar to https://github.com/foundry-rs/foundry/issues/3649 but different error slightly ok, so i removed ~/.svm and then foundryup and then tried again...",443
1515,foundry-support.txt,"now, the error is closer to #3649 referenced above Context: - Error #0: error trying to connect: dns error: failed to lookup address information: nodename nor servname provided, or not known - Error #1: dns error: failed to lookup address information: nodename nor servname provided, or not known - Error #2: failed to lookup address information: nodename nor servname provided, or not known does anyone know how to use sol2uml with foundry? the diagram doesn’t find the dependencies cast etherscan-source <ShitCoin Address> \ —chain <chain_name> \ -—etherscan-api-key <RelevantChain> \ -d <local destination> doesnt DL the settings.json visible on chain<scan> , Can this be classified as a bug ? Huh..thanks for flagging.",173
1516,foundry-support.txt,"it doesn’t find openzeppelin contracts neither, it connects the test contract with the one in src but it doesn’t inherit the openzeppelin import (erc721) https://svgshare.com/s/As6j the token is not connected to erc721 wat is the correct way to set the gas_limit higher? do I just add like ""gas_limit = x"" to foundry.toml? Hi, i wanna check my data after low level call: console2.logBytes(data) >> 0x000000000000000000000000000000000000000000000000000000000000001446616c6c6261636b206e6f7420616c6c6f776564000000000000000000000000 console2.log(string(data)) >> Fallback not allowed console2.logBytes(bytes(""Fallback not allowed"")) >> 0x46616c6c6261636b206e6f7420616c6c6f776564 assertEq(string(data), ""Fallback not allowed"", ""Error in Assert"") >> Error: Error in Assert Error: a == b not satisfied [string] Expected: Fallback not allowed Actual: Fallback not allowed yup yeah you want to do abi.decode(data, (string)), the string(data) will cast w/o adjusting hte padding etc., so while it renders the same as string(..), the actual underlying representation is different, hence it fails LMK if that helps - I think that’s it thanks, can have your github account? Hello there ! I've been facing this issue for a while now and that's pretty blocking. I created an issue yesterday about it, could anyone from the team have a look at it: https://github.com/foundry-rs/foundry/issues/3897. Thanks a lot for the help 🙏 looking.. GM! BTW, a question about forge version.",390
1517,foundry-support.txt,"anyone know my solution is best way or not? can use abi.decode @gakonst, @pcaversaccio Try without the selector: https://solidity-by-example.org/abi-decode/ how do you deploy a solidity library from a script? any examples? what is the command to simply compile a contract in the current folder? forge build —contract.sol doesn't work for me We dont have that It's auto deployed and linked for you Yes but i am looking to deploy and have dynamic link instead of a static link with library address directly encoded within bytecode Yeah it does that It will auto deploy the library And do the linking By replacing the placeholders how should i proceed if i want to customize a dependency? i need to replace one contract from the open zeppelin dependency, but i can't just fork it into my project because the github repository is too big and there are too many import from that specific open zeppelin contract. I would need to rewrite a script that override automatically the open zeppelin script https://stackoverflow.com/a/5427432 seems great ty! No problem lmk if it works When running a script on a fork, I'm not getting CALLs decoded arguments in the broadcast log. What does foundry need to get the decoded arguments? fwiw i updated macos and xcode, still doesn't work what didnt work? Is it possible to fuzz arguments in the setUp function? ah this Yes, also please see this @SamuelDare long shot , but it sounds like a network issue , we run 0.8.17 with m1 and dont have this also the url is available Nevermind, found this: https://t.me/foundry_support/17898 this is similar to https://github.com/foundry-rs/foundry/issues/3649 Unlikely, but any advise to check network? I have tried on diferent network connections through separate ISPs Hi guys. We are looking for tool (like ganache) which can setup multichain testnet (eth, optim, avax, binance, avalanche, fantom, arbitrum etc), fork state from mainnets (contracts, balances), mints native token, exec txs (contracts deploy, contracts call, money transfer) and saves new state, in case if node has been crashed, we can restart it with saved state.",479
1518,foundry-support.txt,"Now we are testing Anvil (build nightly-95bbad6e361fe58461022045ba8ab66f805ba46d), it's look good (faster then ganache), but have some issues: doesn't save new forked state. cmd for launching anvil: anvil --host '<server_global_ip>' --port 'port' --accounts 3 --balance 1000000000 --block-time 10 --mnemonic 'phrase' --fork-url 'alchemy_url_to_optim' --fork-block-number 51862469 --gas-price 10000 —fork-chain-id 10 --state ''~/path_to_folder Opt: —state doesnot save state if I transfer with metamask tokens from account1 to account2 Opt: —fork-chain-id (from build nightly-67ef930378973965db589b7c5e8c8860ba79f475) doesn't work. When I try to transfer tokens in metamask I have error: ` Transaction: 0x7028702faae466f78acad0d1da53f0c3e8b847b379440360acdf92a08e5d8769 Gas used: 0 Error: failed due to PrevrandaoNotSet ` We tried many combinations of opts, but noone give us necessary behavior. May you help us with this problem. Maybe someone have solution with another tool? Is there any way to reuse vm.assume statements? Kind of like a setUp function for assumes wrap them up in a function and call it in your tests? i.e. ``` function assumptions() { vm.assume(foo) vm.assume(bar) } function testItShouldPass { assumptions() tests ... } ``` or you could try adding the assumes in the setup No you can't do this unfortunately because the setUp is only called once This works, but you must also pass the arguments, which can get a bit verbose really? I thought set up was run before every test? It is, but you can't fuzz arguments in the set up function, as you said here: https://t.me/foundry_support/17898 Please dont take anything I say as cannonical as Im learning too. vm.assume is just setting fuzzer arguments. which should be ok. What i was referring to was the actual fuzzing ; which requiires you to pass the parameter as an argument.",494
1519,foundry-support.txt,"What that would look like is function setUp(uint256 x) {} AFAIK , the setup function does not take arguments , and it doesnt make sense to fuzz the set up function Gotcha, thanks for explaining Samuel You were right, it was connection issue. Damn! Largest internet network in india (Reliance Jio) blocked parts of github since last week. Biggest facepalm ever. Thanks for support. How do I get forge script to broadcast as an impersonated account? When I run it after anvil_impersonateAccount is set it keeps trying to find a keystore file, but obviously that doesn't exist. I'm using 0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38 this address to get the proof for merkle tree in my tests but it's failing for some reason, anyone can help? Can you post a snippet of your code ? It’s hard to help without some insights into what you are trying to along with the error message sounds like --unlocked is what you want error: The argument '--unlocked' cannot be used with '--froms <ADDRESSES>' oh one sec ETH_FROM is set Anyone who has experienced with louper.dev for diamond? https://github.com/zdenham/diamond-etherscan/issues/4 Please help me with this ok cool this did the trick - thanks Hello sir, did you figure out anything ? i'm confused on how to run a specific testfunction and ignoring the others use match flag Foundry Support generally, in a big repository, how do you proceed to deploy all smart contracts at once? i have learned to deploy them one by one but i'm used to hardhat for chained deployments using forge i mean this is the code snippet, I'm using solmate merkletree lib what is the error messahge? I have a custom error IncorrectProof which is thrown when the merkle proof library returns false this same code with corresponding proof works fine on remix Have a testing question.. I want to have a contract persist between all my tests in a file.. I'm forking the chain, and deploying the contract inside the constructor of the test contract. But it looks like each test isolates the state changes from the other tests.",467
1520,foundry-support.txt,"Is there a way to override that behaviour? maybe snapshot at end of function then revertTo in setUp? what is the correct way to call the pauseGasMetering() function? Doesn;t seem like cheats.pauseGasMetering() works? Can I use stdstore to write to an internal mapping? I tried this but it didn't work stdstore.target(addr).sig(""_mappingName(address)"").with_key(token).checked_write(value); FAIL. Reason: stdStorage find(StdStorage): No storage use detected for target. One more question.. Is there a way to increase the block number during a test... vm.roll https://github.com/foundry-rs/forge-std/blob/eb980e1d4f0e8173ec27da77297ae411840c8ccb/src/StdCheats.sol#L447 This doesn’t seem to work not enough context... what doesnt contribute do? what does toggelcontribution do? doesnt look like its exposed to be consumed in forge.. more like an intermediate function to the test stuff : https://github.com/foundry-rs/forge-std/blob/a5ecf5dbbfb96fd3430f489d01ec6c5145da0039/test/StdCheats.t.sol#L222 its used in the noGasmertering modifier https://github.com/foundry-rs/forge-std/blob/a5ecf5dbbfb96fd3430f489d01ec6c5145da0039/test/StdCheats.t.sol#L249 If it can be added as a standard cheat code, that would be splendid open an issue with it on github Found it... roll Is it possible to perform a cast send for fallback functions? Anyone had problems with addresses balances being wrong on Mumbai from inside deployment scripts? nope I’m trying to download a source from Etherscan and inspect it, comparing it to existing repo.",395
1521,foundry-support.txt,"Before this worked, but now all that compiles is the existing repo… I save the source to oldImpl folder and specify —contracts oldImpl in forge inspect - but still the new source in root is compiled… I even try to “cd” myself into oldImpl and run forge inspect from there - but still the root is compiled 🙂 I even tried doing —force and forge clean - but no luck But a month ago this worked - I’ve made a bash script for comparing implementations storage slots during upgrades UPD: Tried reverting to the version where it worked - it’s still doesn’t work reliable. Back then it probably worked because contracts were quite different Seems like it does compile the source in the folder, but only if it differs “at least a bit” from the one in the root. I still don’t know the criteria of “at least a little bit” - adding an extra storage var in the end doesn’t seem to trick it. But moving it up does. Still doesn’t seem reliable enough. The only reliable way of doing this that I’ve found is this: copy foundry.toml to new dir, compile it with —root, then cd into the new dir, and run forge inspect from there but would love inspect to have —root and build from there like forge build does (cause doing “-c oldImpl” doesn’t help - still uses root and builds everything from there) Id do it this way- # Dir Tree <DIR>contract_compare |_ NewDIR # via forge init , put dl contracts under src/ |_ srcproject - Then just run build and inspect inside individual dir - Use some tool to compare different files https://book.getfoundry.sh/tutorials/solidity-scripting georgios, sorry for pinging but could you remind me what are the common causes of ""EvmError: NotActivated""? its reverting on a transferFrom You are using an old hard fork, this should never happen Pls open repro if a big issue toggleContribution simply updates a bool to check if contribution period is active and contribute checks if the merkle proofs are correct and then does some state updates can we specify to use the dev / nightly version of solc? Hi all, I opened an issue (#3870) for this last week but its kind of holding up everything i'm doing so i figured i'd ask here too. I am attempting to use forge scripts to deploy something through a factory contract that has an ownership check.",500
1522,foundry-support.txt,"For whatever reason, neither the vm.startBroadcast() nor vm.startPrank() cheat codes change the msg.sender in the pre-tx simulation, which I also raised an issue for today (#3917). This wouldn't be such a problem if the —skip-simulation flag worked, but it just doesn't do anything. I'm simply unable to skip the reverting simulation and send these transactions. Anybody else experience this? edit: figured it out. i was doing something really stupid. I've been running into a weird issue - I've been using the pauseGasMetering to run a loop where I do some computation (signature verification). Despite the gas not going down, I get a Evm Error: Out of Gas at exactly the 40th iteration of the loop regardless of whether or not I pause the metering or not. I have set the gas limit to uint64 max and even with metering, there seems to be plently of gas left. Hi, what is best practice for lib in project? add lib in project or add in .gitignore and write commands for install in README ? Thanks a lot team for closing https://github.com/foundry-rs/foundry/issues/3897 🙏🔥 Hi everyone is that possible to deploy smart contract json using forge ? didn't find in the doc Wdym smart contract json? the abi Hey there, is it expected that a solidity script using ffi actually calls several times the ffi command ? I added a small function that tracks in a file the number of time the command is called and prints it and its confirming that the command is called a lot of times (6 times I think) for whatever reason. Here is the issue described: https://github.com/foundry-rs/foundry/issues/3921. Thanks a lot for the help ! my script successfully broadcasts all 3 transactions (2 CREATEs and 1 CALL). but the verify step only attempts to verify the first contract. any idea what the issue could be? they are deployed the same way one after the other ( Contract a = new Contract() ). the run function is properly bookended by vm.startBroadcast() and vm.stopBroadcast(). i use forge script a lot to deploy multiple contracts and have never experienced this.",462
1523,foundry-support.txt,"if its helpful, im running forge script src/pathToScript/Script.s.sol:Deploy --chain-id 5 --rpc-url <goerli rpc url> --broadcast --verify and my .env file exports ETHERSCAN_API_KEY you cannot deploy a contract via an abi alone. it's an interface that defines things like functions and events, so a client knows how to interact with the contract. but it doesn't contain any internal variables, logic etc. Ow okok figured it out Is there a easy way to use another already deployed contract by a previous script inside another script ? probably just interface(deployedAddress)? I mean to get the deployed address You could find them in the run json files (I think) But can I use them directly inside another script ? if its deployed and you have the address and the interface, yes Does anybody know if vm.activeFork() reverts when a script is run past simulation - I.e. can i use it to alter script behavior between simulations and final script runs, akin to a vm.isSimulation() cheatcode? hi folks - new to foundry here. im using tenderly's ""simulate"" api in quick mode (just use bytecode) and wanted to replicate that in foundry. is there an example of a script that does this ? i will be calling this remotely and not locally. just hoping on the off chance that someone has a similar usecase. maybe useful for some of you - the selfdestruct call has currently no effect in forge tests https://vxtwitter.com/pcaversaccio/status/1605488735444905984 how to show source code of external contract in forking mode debug? or how to show call trace of internal function? Same question, I want to invariant fuzz external contract in forking mode.",363
1524,foundry-support.txt,"I'd recommend always pranking and not relying on address(this) or msg.sender Yeah it's called anvil This seems odd. Pls open an issue if still a problem. Shouldn't happen on new projects, unless you have a borked git setup hmm I'm confused though, how do I properly test scripts? I got this deployment script that deploys a token, adds liquidity for it on a dex, and then enables trading, so in the setUp function of a test I put DeployToken deployer = new DeployToken(); and then called deployer.run(); so then I wanted to write tests for buying/selling/etc. problem is that because the script uses stuff like msg.sender to get the user balance when adding liquidity it won't work because when the script func gets called the owner is obviously not the EOA with the tokens and perms and other stuff so I ended up copypasting the script in the setUp function of the test and pranking the correct address lol Is it possible to directly get a contract address from a broadcasted transaction ? have you tried checking the broadcast folder? I mean directly inside another script to have real migrations yes. you can parse json files in scripts i.e.",243
1525,foundry-support.txt,"check previous broadcast json logs for previous deployments, pull address, use in script Heyo, is there any way to make the autocomplete work for imports / code? I'm loving the concept but hard to make it ide friendly for vscode https://book.getfoundry.sh/config/vscode?highlight=vsco#integrating-with-vscode iirc jetbrains has baked in support hmmh weird, im using webstorm and no support, anything extra i should do with the remappings or smth? wut jetbrains ide u using ah was only remappings.txt https://github.com/intellij-solidity/intellij-solidity/pull/331 oh no i have those properly set up like the build works, it's just that imports or autocomplete are neglected and rip auto-complete been manually importing lol same on vscode welp i'll keep fiddling dw at least i know it is solvable does anyone know how can I decode an error from cast? (code: 3, message: execution reverted, data: Some(String(""0xdeee7edf0000000000000000000000008156715d27e1b9bcfb0b1ff820321b9cdf1961480000000000000000000000000000000000000000000000000000000000000000""))) you can try cast 4d <data> if it's in the database, otherwise you have to cast ad <sig> <data> but i dont know the signature for that... idk what it is I use forge test on windows, it is very slow, does anyone know what is the reason? thanks fork eth-mainnet IIRC , there is a an open issue in the jsonrpseeee repo about this .. Then I can't use it in windows? i cant find the issue .. you can but its low.. on my last team we tried to optimise it but to no avail So horrible.",392
1526,foundry-support.txt,"ok thanks at least i know syntax is correct as a corollary, r u building a web 3 beatemup ? yea haha its ongoing. was a failed project i took over and rebuilt.. discovered foundry and forge in the pocess and loving it... actually looking for help with deploying to zksync in a separate project coming up.. wonder if any has experience deploying to zk with foundry? sweet , yes I did look into deploying to zksync , sadly its not possible as per my understanding with foundry-rs, zksync docs recommend using a custom HH plugin they built yea thats what i am seeing too, just trying to avoid hardhat if possible. well if ur not a purist , there are some foundry hh templates too , im not too much a dev yet , but what i see is , we need to mix it up a bit yea agree i use the dual foundry/hh project currently but would love to just use foundry tho. hello everyone, someone knows how to catch custom errors with expectRevert cheatcode ? Thanks in advance https://book.getfoundry.sh/cheatcodes/expect-revert#examples 😊Thank you very much Anyone could explain how to initialize an UUPS upgradeable contract using this library? https://github.com/odyslam/foundry-upgrades/ Like how to initialize during the deployment here? proxyAddress = proxy.deploy(address(impl), admin); i'm trying to reduce a contract size, is there a way to find out size by functions? similar to what gas reports do for gas cost per function forge build --sizes that gives contract size, not the size of the different functions inside the contract -- thats what i'm trying to figure out Should I temporarily downgrade ethers to avoid this error? `use ethers_core::types::{ParseChainError, U64}; | ^^^^^^^^^^^^^^^ | | | no ParseChainError in types | help: a similar name exists in the module: `ParseI256Error`` Hey, is there documentation for the ‘forge coverage’ function some where? Couldn’t find it in the foundry book. Trying to find a way to see a full line level coverage report instead of just the coverage % output on command line.",460
1527,foundry-support.txt,"is there any rust tracing in evm? i am trying to figure out what caused a revert on evm level Maybe you had a specific panic message Hey! Is there’s a plan to allow more fine-tuning of the fmt formatter? For instance allowing this: if (true) returns x; instead of: if (true) {  returns x; } is there a plan for async API call support in the case several view functions are queried in loop? Here for example, I try to fetch all the NFT of a collaction that are owned by an address and it takes an really big amount of time async in solidity? The EVM is synchronous and it would be virtually impossible to do this within it . However you could cheat with an ffi Don’t even think an FFI would work without multiple forked instances.. doesn’t seem feasible You can’t even do this with hardhat Huh we don't use jsonrpsee in foundry? In scripts I meant I was thinking about something similar to Multicall from Banteg that would be used in the background for the view functions in scripts or else using a cheats Hmm will dig it up.. couldn’t find the issue but on my last project there was a considerable performance different between Linux and Windows have anyone tried this sucessfully? Trying to clean up our coverage report: https://github.com/foundry-rs/foundry/issues/2988#issuecomment-1298602707 What's the syntax to read from a storage slot using StdStorage? not sure where to pass the storage slot number.. For example, I need to read from the storage slot 4. I tried stdstore.target(address(target)).read_bytes32(4) looks like the syntax is wrong if you want to specify a slot number you can use vm.load directly. StdStorage has helper methods so you don't need to provide a slot number, and can specify the slot by e.g. a getter method's name https://book.getfoundry.sh/reference/forge-std/std-storage#std-storage Thanks..vm.load() worked! re std-storage: > can specify the slot by e.g.",434
1528,foundry-support.txt,"a getter method's name How do we read private vars since there'll be no getter method? you can't currently, though this may be doable in the future if forge-std has access to storage layout as being discussed here: https://github.com/foundry-rs/foundry/issues/3869 right now the way I handle private vars is use forge inspect to find their slots, save that off as a constant in the test contract, and write custom getter/setter helper methods as needed. of course, this needs to be updated if the slot changes, which is usually simple to keep up with because tests fail in that case Got it! thanks for the quick response :)) has anyone found that running the coverage on the same code produces inconsistent results? I have just had my coverage increase on the same code and have done anything to increase it Is multicall not an option ? hey friends How can I use anvil_dumpState and load state? if I try to call the rpc method I get Dumping state not supported with the current configuration but I cannot find a way to configure it Hello, Getting this error after running forge fmt Failed to parse Solidity code for <filePath>. Leaving source unchanged.",244
1529,foundry-support.txt,"Debug info: [Diagnostic { loc: File(0, 11638, 11639), level: Error, ty: ParserError, message: ""unrecognised token '.', expected \""!=\"", \""%\"", \""%=\"", \""&\"", \""&&\"", \""&=\"", \"")\"", \""*\"", \""**\"", \""*=\"", \""+\"", \""+=\"", \"",\"", \""-\"", \""-=\"", \""/\"", \""/=\"", \"":\"", \"";\"", \""<\"", \""<<\"", \""<<=\"", \""<=\"", \""=\"", \""==\"", \"">\"", \"">=\"", \"">>\"", \"">>=\"", \""?\"", \""]\"", \""^\"", \""^=\"", \""calldata\"", \""case\"", \""default\"", \""error\"", \""leave\"", \""memory\"", \""revert\"", \""storage\"", \""switch\"", \""|\"", \""|=\"", \""||\"", \""}\"", identifier"", notes: [] }] is it stupid to use echidna if i'm using foundry? like maybe echidna can do invariant testing and forge can't, or it kinda seems like echidna is for people using hardhat but i don't rly know i'm still new to foundry Is it possible to have advanced vm.assume assumptions for fuzzed arrays? e.g. each array element should not be greater than X, or the array elements should be ordered in ascending order I guess I could iterate over the array items and do a vm.assume on each, but I suppose that I would quickly go over the max global rejects threshold. You can use both. Echidna is better with invariant testing and not tied to hardhat, foundry can do many things echidna can’t, like scripting/broadcasting, better cheatcode support and unit testing Just make them conform to your requirements, i.e. use bound() on all elements, sort the array (recommending solady) Are you perhaps using a //forge-fmt: disable-line somewhere? Had an issue where that was causing confusion, but should probably open a pr nonetheless Yes, I could do that, but it's likely that I will hit the maj global rejects quite quickly.",445
1530,foundry-support.txt,"Anyway, I will report my findings I was suggesting not to use vm.assume, but to modify your input to be valid How can I share an anvil node with a team? From the look of it, forge geiger finds unsafe cheatcode usage in forge-std? Current forge-std commit hash is eb980e1d4f0e8173ec27da77297ae411840c8ccb. what is geiger? Some kind of ""danger detector""? It's flagging tests + the cheats definition. Should be false positives then ah I see.. that's your point :P yes its the ant-crier tool Looks like forge geiger doesn't ignore the lib folder. It should Will open issue! hm why should it? the intent was to be similar to npm audit and warn of risks in both your own project and its dependencies. original idea here for context: https://github.com/foundry-rs/foundry/issues/2360 Maybe it should just ignore forge-std? I am typically not interested in running any tool on dependencies, though if the intention was to mimic npm audit, this might be an exception Did not open a new issue as I found a similar issue. Updated on https://github.com/foundry-rs/foundry/issues/3720 this feels like a good compromise since forge-std is trusted. maybe there should be a way to specify additional trusted submodules too deleted my note because i wasnt sure but can confirm that a recent nightly release broke vm.writeFile() in scripts, and not just for me also having a lot of trouble installing any of the prior releases 🤬 finally felt zen after spending several days writing workarounds for foundry's weird script bugs only for something else to break again after updating. fool me twice...",366
1531,foundry-support.txt,"stable release wen? if anybody knows how to get past vergen panicking when attempting to build cli, anvil, chisel from source please lmk What error are you getting ? vergen crate failed to generate version information! could not find repository from 'D:\foundry\foundry-nightly-d3d8c0bb2135368520e232a4b4373ed68587a0a4\cli' same for anvil and chisel getting the same error regardless of which nightly release i attempt to build What Os are you on? windows what’s the script bug? is there an associated issue? Windows never builds from source easily . Can you either use WSL or see how they get past in the ci ? are you cloning the repo from github? you can do gRPC stream yeah i raised a few issues this past week - cant really judge their severity though. Biggest one is that libraries dont mix with broadcasts - forge script deploys libraries even if you call functions outside of start/stopBroadcast so my convenience utils get deployed onchain unnecessarily now im just trying to rollback to a release where vm.writeFile() still works with scripts. somebody posted an issue for that this morning anvil isnt designed to be a full fledged client just downloading the release and running cargo build build script assumes we're in a git repo when building so i guess just git init at the root of the project or clone the repo directly cargo build attempt after git init at root: vergen crate failed to generate version information! the reference 'HEAD' cannot be peeled - Cannot resolve reference; class=Invalid (3); code=NotFound (-3) i would clone repo but i need older release since new release broke a feature i need just checkout the tag? ok that fixed it lol. i was doing something very stupid. thanks! fixing the script library deployment stuff if so, an array in foundry.toml like remappings, gas-reports, etc would make the most sense IMO okay impled the fix, have a local branch, will push it and try to get it across the line. basically we now filter the predeploy libraries based on broadcasted txs. i.e.",442
1532,foundry-support.txt,"if we are deploying contract A and it has a library L, but the deploy contract has library M, only L and A will be deployed by detecting that A is gonna be deployed Hi guys! So I’m trying to run “forge init ” to start using foundry but I’ve been facing the following error. Do someone know how to fix it? Thanks in advance “Error: This command requires clean working and staging areas, including no untracked files. Modify gitignore and/or add/commit first, or add the --no-commit option . “ sounds like u are trying to init it in a directory that already is part of a git directory post a repo if you want help reproducing the issue ur having This isn’t the syntax for matching a single test . Check the docs . It shouldn’t panic though this does not help amigo, i cant read this I can’t read through that indentation error 😂 There is nothing on the repo That’s the bug I checked and followed it but it didn’t work I ran “forge” and “cast” It’s working normally But the forge init haven’t It only creates the folder but there is nothing on it forge test includes test files from libs if they are explicitely imported in another solidity file. is that expected behaviour? Anyone know how to fix the ""failed to solve reversions"" error when using repos that used old solidity compiler versions? What error? its uniswap v3 contracts that are the issue. they place a strict pragma.",301
1533,foundry-support.txt,"while Helper.t.sol (and everything else ) has a floating pragma The work around I use is to define interfaces to univ3 and not call the actual contracts or try using a strict pragma on Helper i.e =0.7.6 Use the deployCode Cheatcode And wrap your address in an interface i run"" foge test —fork-url https://bscrpc.com"" ,IERC20(bscToken).balanceOf(0x...) Revert，but -—fork-url ethmainnetrpc ,,IERC20(ethToken).balanceOf(0x...) is ok, why? you might be forking the wrong address on bsc you mean bscTokenAddress or acountAddress wong？ 0x1AF3F329e8BE154074D8769D1FFa4eE058B1DBc3 0x55d398326f99059fF775485246999027B3197955 please help me again：） Verify your contract exists on bsc and that the rpc is working fine . BSC is notorious for having rpc issues Thanks！ Thanks team for closing and shipping https://github.com/foundry-rs/foundry/issues/3921 🙏 Just made my deploy script 600% faster (about 2 mins faster 🔥). Keep up the good work you guys rock 🤟 hey guys. i want to verify to etherscan when running a script - saw that i should be using the --verify flag. problem is, not sure i understand the description of how to use it in the docs. how should i supply the API KEY? as a environment variable call ETHERSCAN_API_KEY so simply set this as environment variable? should i also specify in the foundry.toml ? the foundry.toml should not have any sensitive information, you should be able to commit it without issue, this is why API Key are set as env, reducing chance of committing them to github by mistake Will try.",406
1534,foundry-support.txt,"Ty ser! Hello, I'm having an issue with using createFork / selectFork on a particular transaction when tracing, the tests just hang indefinitely at the following line : 2022-12-27T01:26:45.825051Z TRACE contract{name=test/<TEST>}:test{name=test_rpc_37308694_v3iter_0() should_fail=false}: foundry_evm::executor::backend: allow cheatcode access account=0x7fa9385be102ac3eac297483dd6233d62b3e1496 This happened to me before and it unfroze after 10 minutes or so - however this time I've left it waiting for over an hour without unfreeze hey i am getting error like Solc Error: dyld: Symbol not found: __ZNSt3__113basic_filebufIcNS_11char_traitsIcEEEC1Ev @brockelmore Huh what platform are you on MacOs z3 strikes again .. brew install z3 It this doesn’t work then deleting the ~/.svm folder usually works @rksunny Hi How to install foundry in window 10 Also how to run forge in existing projects Waiting for your reply you can use docker or wsl https://book.getfoundry.sh/getting-started/installation#installation Wsl ? https://learn.microsoft.com/en-us/windows/wsl/install Okay Why this error ? you are trying to init foundry in a directory that already has a .git file .",310
1535,foundry-support.txt,"pass the --no-commit flag to bypass this error just read it if you havent init the forge , these libraries dont exist Yes i don't understand Hate to be the guy - try to take a screenshot instead of a photo of your pc ^^ Ah This last error might be your git version being old unknown option recurse-submodules https://github.com/Yggdroot/LeaderF/issues/211#issuecomment-418596532 Okay I'm having issues with rollFork, if i have:  uint256 constant initialBlockNumber = 16_082_690; // Nov-30-2022 12:05:23 PM +UTC  uint256 constant finalBlockNumber = 16_155_490; // Dec-24-2022 03:28:23 PM +UTC  I should be able to:   mainnetFork = vm.createFork(MAINNET_RPC_URL, initialBlockNumber);   vm.selectFork(mainnetFork);  and later in my tests:   emit log_named_uint(""timestamp before"", block.timestamp);   vm.rollFork(mainnetFork, finalBlockNumber);   emit log_named_uint(""timestamp after"", block.timestamp); However, any calls to contracts once rolling all revert without a reason: ""EvmError: Revert"" Whereas the function calls work fine without the rollFork - any insights or additional info I can provide to assist debugging @gakonst ? hey team, im trying to do cast call on my contract on Goerli and i'm getting Contract ... does not exist error. interestingly, the script contains the same contract address that i was able to run cast send on.",342
1536,foundry-support.txt,"any idea why? thanks! are you sure you provide the rpc-url correctly? what do you mean by 'the script' i'm running these commands from my .sh script yea it's the same rpc url as my cast send command can you share the full command? cast send $SSOV \ --rpc-url $GOERLI_RPC_URL \ --private-key $ADMIN_PK \ ""bootstrap((uint256)[],uint256,string)"" \ ""[(88800000000), (77700000000)]"" 1703684425 DEC cast call $SSOV \ --chain 5 \ --rpc-url $GOERLI_RPC_URL \ ""getEpochTimes(uint)(uint,uint,uint,uint)"" \ 1 maybe try uint256 same error haha not sure then, the --chain-id flag isn't necessary tho can i verify contracts on Arbiscan? Guy's what's the syntax for debugging a test contract I tried the syntax on the docs It keeps crashing What is the best way to use cast in a Python script? Or alternatively, is there a better way (i.e., a library) to query a contract's storage in Python? sub process? Presumably yes, since it's just a fork of Etherscan maintained by the same team. I've never needed to, but could you use the --verifier-url with the Arbiscan url? also if you are bound to python you might just better offf doing it in ethers.py That's what I tried first, but I'm getting some errors, like FileNotFoundError: [Errno 2] No such file or directory: 'cast' and Invalid provider url: ""https://mainnet.infura.io/v3/<key>"": relative URL without a base Good suggestion, I'll check it out. Thanks! can you copy a snippet of your python code here? Sure, it's pretty simple rn, since I'm just getting started.",388
1537,foundry-support.txt,"import subprocess if __name__ == '__main__':  bash_command = 'cast storage --rpc-url=""https://mainnet.infura.io/v3/<key>"" 0x3d9819210A31b4961b30EF54bE2aeD79B9c9Cd3B 13'  process = subprocess.Popen(bash_command.split(), stdout=subprocess.PIPE)  output, error = process.communicate()  print(output) When I run it in my virtual environment, the script can't find cast at all, despite running curl -L https://foundry.paradigm.xyz | bash and foundryup in my venv terminal. When I run it outside the venv, it complains about the url not having a base, but that doesn't seem right. that out the quotes from the rpc-url or escapte them i just did it and it works python foo.py b'0x0000000000000000000000000000000000000000000000000000000000000014\n' not sure why you can't find cast though try which cast is it in your path? Bingo! That did the trick, thank you 🙏 It is in my path, and outside of venv I can find it with no problems. But I'm not the most knowledgeable about virtual environments, and cast seems to have only been installed outside of venv live a little.. forget about the venv 😉 Lol can do gm, I’m trying to deploy a contract on eth goerli and optimism goerli. Is there a way to change the chain_id in anvil so that I can do the calls from there and not have to use HH? pass the fork-url with anvil .. i.e. ``` anvil --fork-url <YOUR_GOERLI_OR_OPTIMISM_GOERLI_URL> ``` thanks a ton. Will try out have a look at the vm.*Fork cheatcodes .",397
1538,foundry-support.txt,"Would make your life alot easier with testing multichain stuff https://github.com/foundry-rs/forge-std/blob/master/src/Vm.sol#L351-L367 Bruh this is fucking retarded shitte z3 is the most reinstalled / issue prone application via homebrew 7.6% reinstall rate if you look at the statistics https://formulae.brew.sh/analytics/build-error/30d/ your better off installing it manually with proper pyenv configured ApeWorx. https://github.com/ApeWorX/ape forge coverage is not using foundry.toml config for —via-ir? I mean like this way is gonna have problems most likely 😅 is there a way to forge init without the Counter stuff? how to get only 'number' and 'hash' when useing 'cast block latest ' yes use a foundry template that is empty ser make a github repo with what you only want basically :0 ah nice, thanks np np np np np np Though this would be a legit feature —empty flag would make more sense than using an empty template When i use rollFork then it's showing this error With rollFork it's working good Do you use an archive node? How i can know that node is archive or not Using official rpc https://forno.celo.org This was due to having a variable called error Is there a way to select/exclude files from forge coverage ? This usually means that you cannot fetch all data But i need to do it for POC Need archive node, old full data is lost if not How i can get one for celo Run one You could reproduce it locally too or quicknode: https://www.quicknode.com/chains/celo any good service? google thanks Google also provides node service? i did but not works and also installed libusb as you said in doc => If you use macOS and display below error, you need type brew install libusb to install Library @SamuelDare I think it do only for eth I meant you can use www.google.com to find celo rpc providers .",427
1539,foundry-support.txt,"Thats what i did brother quiknode worked Thanks do you get the same error after installing z3 and deleting svm? I would open an issue on the repo yes i installed again by curl and foundryup and also deleted .svm but still not works open an issue on the repo what is best way to consume x amount of gas in a test? ideally there’s a cheatcode for consumeGas that just deducts available gas by that amount but whats the next best workaround? function loopUntil() public { uint256 i = 0; uint256 times = (gasLeft - 23330) / 117; for (i; i < times; i++) {} } something like dis ya make function consumeGas call loopUntil etc etc assuming 117 is gas for 1 loop execution, whats 23330 for? :))))))))))))))))))))))) how can i add a coverage badge in the readme of my repo? I have a json file looks like this {  ""values"": [  [""alice"", ""1""],  [""bob"", ""2""]  ] } what would be the best way to input it as string[][] using StdJson.sol? I'm getting evm revert error when I try to do string memory elements = vm.readFile(path); string[][] memory values = abi.decode(    elements.parseRaw("".values""),    (string[][])   ); Is there any equivalent for forge to hardhat's npx hardhat test --network localhost so you can pass to etheno and record a complex contract/state setup? Specifically can I run forge test --match-test and send it to etheno? ""stdStorage find(StdStorage): Slot(s) not found."" - is this a generic bug or that truly a slot is not found? Hello guys. I submitted a pr adding a debug_traceCall api to anvil https://github.com/foundry-rs/foundry/pull/3990/files. I hope someone could review this. Guys, i’ve looked through chats history and found out few ppl had similar issues but I can’t find anyone answering them. I’m trying to use Ledger with forge for deployment. forge create works like charm with explicit private key.",445
1540,foundry-support.txt,"But changing it to -l flag ends up with this message every time: “Ledger device: APDU Response error `Code 6a80 ([APDU_CODE_BAD_KEY_HANDLE] The parameters in the data field are incorrect)`” Any ideas?e your talking about the Trail of Bits app? github lets you generate status badges for workflows now ![](https://github.com/<OWNER>/<REPOSITORY>/actions/workflows/<WORKFLOW_FILE>/badge.svg) Sigh Hello, does anybody know of a way to hide submodules in vscode source control and have the change committed in a project wide setting? I am working in a big monorepo and most of my colleagues don’t touch smart contracts and this is causing a lot of mess. .gitignore If I add them to .gitignore then the versions won’t be properly tracked, no? what are you wanting to do? Hide the foundry submodules from source control UI and have the settings saved on github so that all my colleagues have it automatically. What VSCode extension are you using? try adding them to the file ignore settings like node_modules is treated that’s the default source control embedded in vscode iirc You will have to have a workspace configured for your repo i never seen that view 🤔 I have it too. I just close the ones I don’t care about and then it stops taking up space ""git.repositoryScanIgnoredFolders"": [""node_modules""], // Controls whether to automatically detect git submodules.",300
1541,foundry-support.txt,"""git.detectSubmodules"": true, https://code.visualstudio.com/docs/getstarted/settings#:~:text=git.detectSubmodules Hello there, Everyone already just read a public string using foundry? I have this weird error : ``` 2022-12-30T17:33:33.193415Z ERROR sharedbackend: Failed to send/recv storage err=GetStorage(0x874f54e755ec1e2a9ea083bd6d9c89148cea34d4, 0, (code: -32603, message: Failed to get storage for 0x874f54e755ec1e2a9ea083bd6d9c89148cea34d4 at 0: (code: -32602, message: Errors encountered in param 1: Storage slot argument must have a length of 66 (""0x"" + 32 bytes), but '0x0' has a length of 3, data: Some(Object {""message"": String(""Errors encountered in param 1: Storage slot argument must have a length of 66 (\""0x\"" + 32 bytes), but '0x0' has a length of 3"")})) ``` Slot should not be 0 cause it's a dynamic type 🤔 Wrong calculation of slot ? Does it work with bytes ? Tired sorry forgot the payload… No idea why s.flag() Should work no? I am thinking it’s coming from the string type, I am not using string a lot for this kind of operation ahah Can you try with bytes ? Is there any shorthand for --match-test? --mt ty Yeah I am looking to fuzz some endpoints with Echidna and would rather use Foundry to create the deploy script or better yet just play Foundry tests into etheno and record them for fuzzing state. Crytic compile has an issue if your using foundry just set ETH_RPC_URL to localhost and have anvil pointed there I appreciate the new stdJson JSON writing features, but any chance of an improved API when used from Solidity? it took me a while to get the incantation correct when writing multiple keys to an object I would suggest some API alternatives but I don’t know Rust well enough and how it ties into Solidity compiler/runtime/vm The issue with this is it doesn't ""create"" the contracts for some reason like npx hardhat test --network localhost does.",501
1542,foundry-support.txt,"In the output from etheno for hardhat there will be `ContractCreated` and all the bytecode but when I run forge test in this way it doesn't create the contracts. hardhat test invokes the hardhat provider which handles the creation and broadcast run hardhat —verbose test and you will see step by step can you open an issue with the API ideas? Heya I'm just starting up with codespaces. I can get foundry installed but stuck on forge install, keeps saying lib folder not found when the folder is clearly there. Any suggestions? Slash do you have a link to any codespace template that has foundry setup? i almost have never encountered this error , can u give me the src link of the template ? thanks for looking: https://devtooligan-bookish-system-5pjq74vjqp2v9w7.github.dev/ Has anyone paid attention to foundry's gas calculation method? Usually, the entire test function will be treated as ONE tx in foundry test. However, there are actually MULTIPLE transactions on the chain. Considering the gas consumption of evm cold and hot loading is different, this leads to the inaccuracy of the calculated gas. So I can only run the fork node locally first, and then execute the ""script"". However, this makes it impossible to use cheetcode to change the vm state. Is there any more convenient way? are speaking specifically about forge script? also don’t know what you mean “use cheatcode to change the vm state” - what cheatcode? what state? Yes. ""Forge script"". For example, i can use vm.warp() to change blocktime in forge test. But it doesn't work for script because script is specifically for interacting with a real node so it uses VmSafe which removes cheatcodes that let you change the environment like that because in all cases except a local network u can’t perform those actions I know that.",391
1543,foundry-support.txt,"So how can I execute multiple transcations involving vm stat changing and get the correct gas report? (Tx1, 2days after, Tx2) in a normal forge test just deploy two versions of the contract you want to test in the setUp function and execute whatever you need to for the second tx i.e.: setup: a = new A(); a2 = new A(); a2.exec(); testA: a.exec(); testA2: vm.warp a2.exec2() function test() public { contract.fun1(); vm.warp(block.timestamp + 1 days); contract.fun2(); } that will keep the contract warm mine won’t if you don’t care about warmness then the above works but i need the stat changed in fun1() see my setup function. the state will be the same Fine. Thanks! fwiw i doubt you need the level of gas resolution you’re shooting for but if you do the above should be a pretty dece estimate All I was looking for was to separate the different transactions. Your scheme works!😘 Thanks for this. But is there a way to get Foundry to do the same? or you need to write a deploy script? Hello everyone, I've just tried to install foundry from source using ""foundryup -b master"" command in my Debian VPS. But the build failed, and now I have 2.3G of additionally occupied space. How to get rid of that? I'm not too much of a Linux wiz and have no experience with cargo/Rust. So it's a bit of a pain now for me. So where to find these 2.3G and how to delete it? Next time I'll better go with Docker 😌 rm -r ~/.foundry should do it i believe things get installed into ~/.foundry yes I've seen that folder, but it only has 1.1G of space. not sure don’t think we touch anything outside of that folder .cargo has 0.4G would use a disk util to determine further ok thanks ye if you use a specific branch w foundryup stuff does go into .cargo as well (but rust dep specific stuff) Actually I've checked the whole space of my VPS directly before and after trying to install foundry, using ""sudo du -hs /"". So .foundry and .cargo adding together still have only 1.5G.",494
1544,foundry-support.txt,"So wondering what about the rest, which is like around 0.8G. Just saying. Of course could also be that I've made a mistake. Will have to live with it probably. Best wishes and thanks for your help! And happy new year! 🙂 ah ok, riddle maybe solved(?) There's also .rustup folder, which holds 1.2G. Stuff was added there only a few minutes before added to .cargo and .foundry. I've first ignored that folder cause I've thought it's only about Rust installation which I've installed directly before foundry. But foundry build went a while, so could be, maybe stuff landed in that folder, too? I'll probably better try to uninstall Rust. Cause actually I want to learn it soon, need a clean install for that. it is indeed your rust installation aka toolchain: binaries like rustc, cargo, etc installed by rustup ok, thanks. I think I'll better start using a lot of Docker on my VPS. Because space is more scarce there. And when there's a space problem like this one, a docker container can be deleted easily. That's probably easier in total with my mediocre linux skills 😌 Uninstalled Rust via ""rustup self uninstall"" and deleted .foundry folder. That solved my space issue by 100%. So the additional space was not only occupied by foundry, but also by Rust. A bit my mistake. Now Im happy again 😃 Thanks for your help! Hi How can i make contract with ETH balance into foundry? vm.deal new Contact {value: 1 ether}() I want fork a mainnet But for my transaction need ETH With your explain can do it? write script read the book before asking this is all in there docker images will persist even intermediate layers, also if your using macOS docker has a hidden folder they use that hides volume and other image related data that wont be deleted even if you delete them via the command line or docker desktop dashboard Hmm, honestly I've never really used docker a lot. Because it's an additional abstraction layer to deal with, which I've never really had the need for till now. But I've always thought that docker will bring an isolated environment.",458
1545,foundry-support.txt,"So is it not possible to install stuff into docker to isolate it from the rest of the system and delete it with one command if I want to, having a clean cut without any worries as a result? There's no way to do that? docker is best thought of as a packaging manager for containers rather than some secure sandbox virtual machine docker inherits the host computers networking stack as an example you can delete the artifacts yes ofc https://github.com/jwasham/docker-nuke/blob/master/docker-nuke.sh why r u building from master to begin with jc ok. I've heard before that the isolation is not like 100%. But if it's possible to delete artifacts, then this sounds good enough to me maybe. Thanks for the little lesson. Will check out that nuke thing. Always too much to learn in IT lol. I had a known issue while installing foundry. On foundry's github, installing from source was one of the given workarounds. Docker was the second workaround. https://github.com/foundry-rs/foundry#out-of-date-glibc-error-when-running-forge-from-default-foundryup-install GLIBC Error what was the error and on what OS? Same one like given in the link above: ""version 'GLIBC_2.29' not found (required by forge)"" Debian 11 you need to install prerequisites: apt-get update && apt-get install -yqq gcc libc6-dev git software-properties-common; libc6-dev is needed, its not included on base deb/ubuntu distros Was there a config setting for a single line if statement? single_line_statement_blocks = 'single' i'm getting (code: -32003, message: Insufficient funds for gas * price + value, data: None) for mainnet polygon although im 100% have the required funds any ideas? i've updated to latest version and now it works Deploying from the correct account? Deploying to the correct network? Yep all was fine, after upgrading to latest foundry it worked Oh didnt read the last msg I've tried that now, unfortunately doesn't work, error stays the same: isi_sudo_user@debian-vps-frankfurt-01:~$ forge forge: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.29' not found (required by forge) Ah ok, maybe that's it.",490
1546,foundry-support.txt,"When doing the below: $ sudo apt-get update && sudo apt-get install gcc libc6-dev git software-properties-common ... I'll get: libc6-dev is already the newest version (2.28-10+deb10u2). Looks like newest libc6-dev available on Debian is 2.28. But 2.29 is needed, considering the error message when trying to use forge command. So maybe Debian hasn't included the newest version yet? Because the system has been updated by me before, so it's not my mistake. I anyhow want to use Fedora in future, is more up-to-date as I've heard. Though not sure if it's good for a VPS. Ok, personal summary: Standard installation not working because of this GLIBC_2.29 error. Installing from source workaround failed. Now docker not working too on my VPS for whatever reason (is a docker error). My alternative Fedora VPS where GLIBC_2.29 might be working not available because Google Cloud is really a bit unreliable in general. And I don't want to fire up a new paid VPS on Digital Ocean just for testing foundry. Installing an older version of foundry? foundryup --help suggests this is possible. But the release page on GitHub shows only nightly builds. So dunno which are the former version numbers to pass to foundryup -v. That's a bit too much running against the wall for me now lol. Especially cause I only wanted to test a certain thing of foundry. No offense meant, just describing my experience now. Will try again in a few months. Best wishes! P.S. That's by the way why I love Python based technologies. Less hassle, more control. which version of debian are you using? you need to be on bullseye to download GLIBC_2.29 How to send a transaction with lower gas price using Foundry(`forge create` or `cast send`)? According to https://github.com/ethereum/go-ethereum/issues/24661 , a tx with both gasPrice(Even if it's low) and gaslimit should be accepted by geth, but anvil rejected it. oh damn, you are right. I've always thought I'm using Debian 11 on that VPS. But it's Debian 10 (Buster).",476
1547,foundry-support.txt,"Ser have you heard the good word of nix? It literally solves all this mess https://nixos.org are you sending a legacy tx? Whether it's EIP1559 or legacy, cannot work are you deploying or doing a transaction ? deploying a contract what field are you leaving empty exactly , r u trying to simulate the deployment or actually do it I cannot understand what’s your question.When I run forge create --gas-price 10gwei --gas-limit 600000 src/MiniXen.sol:MiniXen --legacy There is actually no gasprice in tx. i would file a bug report then 🫡 Thanks,i very glad to provide if u need any other info. Hey! Is there a way to write/add some tests in rust to a ‘test.t.sol’ file ? hey there! so i am new to foundry and need a quick help here, my exploiter contract is have interface with functions from another source contract and takes that source contracts address as constructor param, now i want to test that exploiter contract , but i dont know how to pass the address of the source contract.. could anyone help me with that ? Read the book on how to write tests https://book.getfoundry.sh/forge/writing-tests it would be alot easier to help you if you presented some code that shows an attempt at your issue. Your question requires someone to write the whole thing also check out this repo for inspiration : https://github.com/SunWeb3Sec/DeFiHackLabs thanks alot for these, i guess now I have an idea to do what i want to do i will surely provide the next time , if i have any more issues Is there any downside in using constructors over multiple setUp functions? It's become difficult to keep track of inheritance with setUp, I have lots of super.setUp() statements. I am not sure, for instance, if the setUp function does anything special for the caller (msg.sender), or if there are any cheatcodes not available in the constructor? setUp doesn't do anything special really, but I'd still avoid using the constructor because there have been issues/edge cases with them in the past (since it's not the recommended way to handle setup and not widely used).",453
1548,foundry-support.txt,"Does rollFork not persist the state of whatever contracts are called? i hope someone like leo sees this pure insanity Goated Also means we don't import the full library ? Less deployment cost for unused function s Haha what do you mean? Hey , back to the foundry/rust grind - from some much needed down time the link is dead - https://postimg.cc/PpHGMdST Note - codespaces has been erratic all day today , even though the github codespaces status twitter bot says, theyve fixed it (LIES) https://twitter.com/githubstatus/status/1609591481890754560?s=20 I am also unable to repro the error - https://pastebin.com/raw/37YcPEbY - so far my tests passed if you can give the src template , i can have a look see Hi everyone! I've been looking for a way to test a payable function in a contract, to no avail. Any idea where I can find a thorough tutorial on testing with code examples? thanks pragma stdlib another fucking pragma declaration @leonardoalt pls ser at this point this is harm reduction for the benefit of the community for some reason my forge script is only deploying the first contract in the run function, any clue why this is happening? https://github.com/aroralanuk/themis-contracts/blob/main/script/ThemisController.s.sol does forge build support pre/post compilation hooks if we need to run scripts or something? broadcast() only deploys the first . you should be using startBroadcast() ohh shit, you're right. Thanks! HI, am getting error while doing fuzz testing while doing fuzz testing  function testDeductERC20FuzzyFees(uint256 bridgeAmount, uint256 feesAmount) public {   vm.assume(bridgeAmount > 900e6);   vm.assume(bridgeAmount < 990e6);   vm.assume(feesAmount > 10e6);   vm.assume(feesAmount < 20e6);  ...... } this is to chose random amounts for 2 variables and with in a range. this throws error: [FAIL.",439
1549,foundry-support.txt,"Reason: The vm.assume cheatcode rejected too many inputs (65536 allowed)] testDeductERC20FuzzyFees(uint256,uint256) (runs: 0, μ: 0, ~: 0) i have set the foundry configuration: fuzz-runs=500 fuzz_max_global_rejects=100000 what am supposed to do to fix this? seems like it might be a limitation fromm proptest ( the crate foundry suses for fuzzing): https://github.com/foundry-rs/foundry/issues/1901 use forge-std’s bound method instead of the assume cheat Let's open a PR about that ? Guys, is there any way I can get a struct to the deployment script? The only way I’ve found data “passable” to the script is via environment variables. And - I admit - I have no idea how to parse a stringified version from the env to something digastable in solidity 😕 Hello there ! Facing compile error with forge bind, for some reason the type I256 is not correctly imported, see screenshot. It's an easy fix as it only needs to be qualified as ethers::core::types::I256 Opened an issue for this: https://github.com/foundry-rs/foundry/issues/4011 weird because in the bindings' context there should be a use ethers_core::types::* at the top which should cover it I'm using the default ""crate"" mode which generates a shared_types.rs file which does not contain a use statement. Ah that would do it, thanks for reporting, can you also open it in ethers-rs? Yes my bad opened it on foundry. is there a way to check gas usage in chisel? https://github.com/gakonst/ethers-rs/issues/1999 opened here thanks a lot 🙏 how to install on windows? done Indeed I have. Do you mean the package manager or the distro in this case? Actually I'm currently constantly thinking about switching from macOS to Linux. After a ton of tests, I've decided that Fedora might be my best bet. But I like the idea of NixOS that you have a lot of control over single packages and updates. Unfortunately they don't have a live distro for testing. Only a virtual box image with KDE. But actually I would need a live USB stick with gnome for real testing. But good reminder now.",499
1550,foundry-support.txt,"Because I'm not totally sure any longer if Fedora will do the job for me. I'm now also in the position to do a full install on my older Mac. So maybe I should try installing NixOS. both is there a way to display the maximum gas used during fuzz testing (alongside mean, median)? try --gas-report that only shows me one run as far as I can tell Hi, im trying to figure out why one of my contract bytecodes is building with linked library placeholders... All library calls are pure functions, and using hardhat there were no link placeholders Has anyone configured VSCode to run forge fmt on save? Looks like this is not possible without a bespoke Foundry VSCode extension One has set the name of an extension in the editor.defaultFormatter setting https://marketplace.visualstudio.com/items?itemName=JuanBlanco.solidity requires this Worked, thanks Georgios! Looks like Alexey added support for forge fmt with this PR: https://github.com/juanfranblanco/vscode-solidity/pull/359 yep I've been looking for a way to test a payable function in a contract, to no avail. Any idea where I can find a thorough tutorial on testing with code examples? thanks Guys I’m new to Foundry. I have this public global array of struct Apartment called apartments. How can I access the first position in my test? contract.apartments[0] throws an error Try with parantheses () Hey fam. The Solidity team is running a survey on the state of Ethereum tooling. Needless to say that you jumping in and sharing what you’ve been using (esp. if it’s Foundry) would be super valuable 🙂 Here’s the link, it’ll take you 5-10min: https://cryptpad.fr/form/#/2/form/view/HuPIRv4gvziSV0dPV1SJncKzYJXTVc8LGCaMfLUoj2c/ It throws the same error ser this is an anti pattern use pre commit hook if you must Why is it an anti-pattern to format on save? I have that as well 7 pages of questions only to get cucked with a POAP at the end fml you have no idea what processes are additionally running in the IDE for one.",473
1551,foundry-support.txt,"two: depending on how the formatter is sourced and invoked you could be using something other than the local instance installed by you and instead use a globally available one for the IDE these both stem from lack of environmental context the motivating issue behind maintaining this https://github.com/contractshark/vscode-solidity-extension#motivation Hi! Is there a way to deploy contracts to anvil directly from my unit tests instead of copying the setup to the deployment script? I already have the correct state setup in unit tests and would like to know if it is possible to use it for interactions with cast etc. yeah, from rust? How about wrapping it in a bash script.. IIRC, the application will exit 1 if the tests fail , so you can trigger your script off that Could you elaborate on that? This is actually my use case. I want to deploy the tests for Etheno how do you access addresses in the test suite? I am not seeing this in the docs? Like what are the available list of addresses that can interact with contracts? how come anvil doesn't let you --load-state or --dump-state when using a fork? Does Anvil emit events that can be actioned on with filters on the local node? Can’t seem to get this working Figured it out! Dumb mistake with my RPC connection The answer is yes, of course, Anvil does emit events as expected, and you can filter on them as usual. Hi all. I'm new to Foundry. Having problems running 'forge install': error: pathspec '/mnt/c/src/membrane/euro-stablecoin/lib' did not match any file(s) known to git - Running WSL2 - Trying to run tests provided by our project auditors - The funny thing is that this works on a git fork created by auditors but not when I bring the changes to the main repo. Can't figure out what the difference could be - Tried all tricks I found in google and in this group this isnt a foundry issue , its something do with your paths , 100s of articles on this , consider parsing thru those turns out I was missing submodules and had only created empty folders - hadn't realized foundry relies on submodules. working now.",457
1552,foundry-support.txt,"how to programmatically run forge test like hardhat? my goal is to run forge test from javascript and it'd return the final states (passed and failed tests or if it throws any other error) spawn it as a command with --json how should it be parsed? child.stdout.on(""data"", output) pls look up how to do that in js^^ out of topic for this channel and i dont remember all the apis by heart Hallo, is there a way to set environment variables in the .env file in a script? vm.setEnv only sets them during the script im running or if not, a way to change RPC in a script Hi, I'm mocking a erc20 call in my test but it still reverts I'm using the right address & the selector are there any other reasons a mock call can still revert ? Heyy everyone, happy new year! I was wondering if there is a way to debug a ""reverted without reason"" message that I get when I interact with a contract in a locally deployed mainnet copy You deployed with anvil --fork-url? Or inside a forge test Anvil! it’s an already existing contract - specifically the uniswap v2 swap router Do we not propagate revert reasons on forked anvil? Is there a way I can debug through the call stack? Does anyone have any insight on this? can be many reasons, hard to pin it - Is the function being called correctly in the right context ? is it passing the required checks ? without seeing the code ,we can only imagine I'm just mocking a erc20 transfer with mock call and returning true and that call reverts I'm using etch() & the args are correct too Resolved it nvm cc @joshieDo i thought we did Is there any way to get --state (dump-state or load-state) to work with when forking? working with a big subgraph, and while its indexing against anvil fork, anvil becomes unusable to other clients. Want to see if I can split this into two parts: A) run a script to just ""preload"" anvil's state by reading events, store that state, then 😎 reload it later when indexing Im not sure about anvil's but ill take a look tmr Anyone have some educated guesses as to what might be going on here: Running Anvil locally, using fork off of eth mainnet.",490
1553,foundry-support.txt,"We are running a local Docker image of the subgraph. When we deploy our graph, it starts indexing. This takes hours and hours, and eventually the process crashes. We suspect it's Anvil, but are having a hard time proving it. We suspect it because while it's indexing, before things crash, other clients cannot connect to Anvil (like a local webapp). If anyone with more knowlege of the internals... is there anythying in the way Anvil is architected that would cause this? Low memeory? Not enough threads to handle the concurrency? Is there any way to turn up logging in Anvil to see everything it's doing? Check memory usage .. docker x anvil seems like both will eat a lot of your ram So probably an OOM being thrown Hi guys Is BSC supported and are there any handy tutorials on how to use this? I am interested in emulating transacions to detect honeypotes/figure out token fees and using contract bytecode to determine the token name and symbol. chhecking the checklist now, sorry HI all, can I use anvil to fork and run a local ethereum network? AFAIR you can. Hey! Has anyone ever faced this error: ERROR foundry_cli::cmd::forge::script::transaction: Failed to decode constructor arguments constructor=(rest of the constructor) constructor works fine in the tests but receiving this error while trying scripts ah yea this had come up a while ago and was fixed https://github.com/foundry-rs/foundry/issues/3229. are you on the latest version of forge? Do you have to enable a web socket connection ? I guess it depends on what do you want to connect to Anvil. Btw, what did you mean as ""local ethereum network""? It's more like simulation, a network where you're alone, not Hyperledger style. Thanks for your response. I’m looking to connect a local chainlink node to it. Hm... As an opinion: it should be quite ok, it should simulate RPC of a node, which you can widely control (`prank`s, you know?). But I really didn't touch it for a while. =( PS Btw, would you mind if I send a question on Chainlink node to you? sure thing. Might not know the answer as I'm just starting to develop on it.",484
1554,foundry-support.txt,"But got a local one up today fixed ty Hi how do I verify a contract on Arbitrum Nova? Forge verify-contract seems to not understand its chain-id hi, how can i debug tests using vscode? You can not, altho i think there was a team working on that 🤔 We need to add it to ethers I think? Why not use an actual client ? Yeah same q, why are you using Anvil to do your local subgraph instead of the actual node? Hello, In my tests I have some tests that are writing and reading txt files to differential test it in a python code. When running independently the test are passing, but when running forge test, it seems there is collision tests are writing at same time. I guess how foundry is working is testing in parallel to speed up. Is there a way to run sequentally the test to avoid this kind of collision ? When I run forge build or forge install it always shows a connect error, how to solve that, I'm in China.😭 YIKES is this domain banned in China? yes😭 If I use hardhat I can write proxy codes in hardhat.config to solve this. So is there any way to set proxy in foundry? How does it work in Hardhat Config? You can manually download your Solc version and it might avoid that Hello guys I have problem with installation on MacOS BigSur can someone help me ?? Are you able to reproduce this over multiple installation attempts? Do you have any kind of firewall running? every time Ive try there is same error. No I dont have firewall Sorry had one attivir turned on and that was the problem thank you for suggestion bruh get iterm2 dont use default terminal you can download them and configure a cache dir Looks like this error has been posted a few times, but never really been answered apart from ""nuke it and start over"", which doesn't seem to be working for me. But any idea why I'm running into fatal: Needed a single revision Unable to find current origin/v2.1.1 revision in submodule path 'lib/memview-sol' when running forge update.",440
1555,foundry-support.txt,"I can forge install summa-tx/memview-sol@v2.1.1 just fine, but trying to update always throws an error What is the alternative for github doesnt gitee not even support public repos ? by nuking it are you updating the .git/modules or just rm the lib/ dir rm the specific module in .git/modules/lib mkdir test cd test forge init forge update throws fatal: Needed a single revision Unable to find current origin/v1.2.0 revision in submodule path 'lib/forge-std' You need to init git first 😐 GIT_AUTHOR_DATE=""Sun, 01 Jan 2023 00:00:00 +0000"" GIT_COMMITTER_DATE=""Sun, 01 Jan 2023 00:00:00 +0000"" git commit --allow-empty --allow-empty-message -m '' Forge fmt doesn’t seem to like this library used in diamond proxy implementation. https://github.com/mudgen/diamond-3/blob/master/contracts/libraries/LibDiamond.sol Had to work around using ignore in the toml. Anyone know why fmt can’t parse this? Assembly?? What exactly is an ""invariant"" in Foundry? I see that there are a couple of settings that can be changed with [invariant] but I am not sure what they do, in practice.",277
1556,foundry-support.txt,"There's no example in the Foundry Book about this Oh wait, I just saw there's an open issue about documenting invariant testing https://github.com/foundry-rs/book/issues/497 Has anyone experienced this issue when trying to connect to an anvil fork (using --fork-url) via metamask for the local http://127.0.0.1:8545 rpc url? usePilotBalance.tsx?1d60:18 processing response error (body=""{\""jsonrpc\"":\""2.0\"",\""id\"":45,\""error\"":{\""code\"":-32603,\""message\"":\""EVM error PrevrandaoNotSet\""}}"", error={""code"":-32603}, requestBody=""{\""method\"":\""eth_call\"",\""params\"" I believe this is related to the hash of the previous block's random seed, but not sure the anvil fork is experiencing it what chain Id are you configuring it with you should set chainId to be 31337 Will open a PR soon, working on an example repo to easily demonstrate different patterns The ChainID comes from the fork I'll see if I can change the chain id gm, is there a way to do a deployment of 2 contracts on different chains from the same solidity script or a way where I could export the deployment address of one contract into the constructor of the other contract at deploy time using solidity scripting? metamask will see that your using chainId for mainnet and it will send additional requests to etherscan to ensure that the rpc isnt doing shady thingys Yeah i just changed the anvil chain id with --chain-id like this what does this mean, 'unexpected end of file'🧐 https://github.com/chugsplash/chugsplash Hi, there are some errors when I init a new proj. But it doesn't seem to have any effect on the build, because I successfully built the proj You can use the vm.createfork vm.selectfork to change inbetween chains, and just call the broadcast cheatcodes. The current limitation is that it doesnt support libraries. Otherwise should work fine nice update your git got it. Thanks Anyone know how to solve this？ Please download solc manually adn use SOLC_PATH=<…> forge b i.e.",448
1557,foundry-support.txt,"Reason: Setup failed: No bytecode for contract. Is it abstract or unlinked?]. I’ve read in a couple of places that foundry test should be automatically linking libraries. Any conditions where that’s not the case? Auto linking wont work with deployCode :/ Known limitation We should document that You can probably split your script in 2, non ideal Can you open an issue if none exists and we can discuss a right solution yep, thanks! done: https://github.com/foundry-rs/foundry/issues/4049 Is Anvil known to be broken now? Tried running anvil --mnemonic $MNEMONIC and getting this error: > error: The argument '--mnemonic <MNEMONIC>' cannot be used with '--mnemonic <MNEMONIC>' I'm sure that the $MNEMONIC is loaded as an env var Can we not use words like broken 🙂 sorry bad choice of words Sorry just annoying and you understand the nuance^^ Anyway, turns out I made a mistake, the mnemonic was malformed See 🙂 To be clear it’s fine if it’s actually broken and we’ll rush to fix, but in general we’re trying to build a stable and robust brand here, so any 1 usage of the word “broken” turns away 10 potential happy customers/users Glad it works^^ thanks for all the quick responses today @gakonst foundry support reporting for duty.. 🫡🫡🫡 I've done a lot of work with the diamond and forge.. works nicely but you have to do some acrobatics to get it to deploy, initialize/update the facets.. buzz me if you need a bit of help.. This is kinda bizzare but when I fork bsc-main (from my node) it works for 5 minutes then stops working impossible to deploy contracts like I did before Anvil: reverts does not provide a further explanation this is for BSC did not check ETH so in order for my script to work I just need to restart anvil every 5 minutes, together with my script that connects to it, it's a continual script , running all the time after about 5 minutes it stops working Just bumped into this as well on Goerli. It said ""Transaction dropped from the mempool"" even if the contract creation txs went through. I will make further deployments and open an issue if I manage to reproduce the issue.",491
1558,foundry-support.txt,ser foundry doesnt support cairo wut u doing here here this should work in china maybe idk https://borg.nyc3.digitaloceanspaces.com/solc/macosx/aarch64/list.json https://borg.nyc3.digitaloceanspaces.com/solc/macosx/aarch64/solc-v0.8.10 solidity binary server likes to shit the bed every now and then anyways I think this is bad RPC management mostly changing RPC a few times was very annoying but fixed it I have correctly put imports for OZ lib but it is giving me parse error.,120
1559,foundry-support.txt,"First, it looks like they load the rpc URL into the environment. Is that the recommended way of handling deployments? I would rather just put the RPC into foundry.toml and use it there instead of having to put it into the command to deploy. Second, how does the RPC alias system work? I can’t seem to get the verification to work on Moonbase Alpha. I have this in my foundry.toml: [rpc_endpoints] moonbase = ""${MOONBASE_RPC_URL}"" [etherscan] moonbase = { key = ""${MOONSCAN_API_KEY}"" } And I use this to deploy, which does deploy, but doesn’t verify the contracts: forge script script/Container.s.sol:ContainerDeployScript --broadcast --verify -vvvv --rpc-url $MOONBASE_RPC_URL try —rpc-url moonbase Are you sure your env vars are set? Somehow using this flag fixed both issues at the same time Thanks for the help! Sorry had to log off yesterday. Tried this and am still getting ``` fatal: Needed a single revision Unable to find current origin/v1.2.0 revision in submodule path 'lib/forge-std' ``` can you please not give random advice. this isnt relevant. this may be related with your git setup. im not sure. are you in the latest foundry version?, whats the output of forge --version? Yah that seems likely, but I can remember changing my git config or anything. Forge version: forge 0.2.0 (a44159a 2023-01-03T00:08:56.803411Z) forge init Initializing /Users/georgios/lol... Installing forge-std in ""/Users/georgios/lol/lib/forge-std"" (url: Some(""https://github.com/foundry-rs/forge-std""), tag: None)  Installed forge-std v1.2.0  Initialized forge project.",398
1560,foundry-support.txt,"this just worked what’s your OS? uname -a? forge init works for me too, but forge update always throws an error Darwin Adams-MacBook-Pro.local 21.6.0 Darwin Kernel Version 21.6.0: Sat Jun 18 17:07:25 PDT 2022; root:xnu-8020.140.41~1/RELEASE_X86_64 x86_64 forge init forge update throws fatal: Needed a single revision Unable to find current origin/v1.2.0 revision in submodule path 'lib/forge-std' Um ok I can repro that, quick q why do you forge update after you’ve forge init'd? Just as a test. Trying to reproduce it in the simplest environment. I'm also getting this issue in a working repo with other submodules I think its more foundry looking for the tx in the mempool and not finding it is there a way to get a different block.timestamps in local node testing? even when i use cast rpc anvil_mine, i see the same block.timestamp Wanted to say, I think it would be helpful to have a new flag --rpc-endpoint that is an alias for --rpc-url. It's not quite intuitive that the --rpc-url can be an alias, too cast rpc anvil_mine <timestamp> works i think? block.timestamp seems unchanged i tried cast rpc evm_increaseTime 10 as well, but doesn't seem to change hi team, i was thinking i'd like a expectNotToCall method to test conditions where there might be a loop that's skipping over, or something like that. i don't really know rust so i started looking in the repo to see if i could reverse engineer the expectCall and submit a PR. do you think it'd be doable? if so, could somebody point me in the right direction of where i'd add it. https://github.com/foundry-rs/foundry/blob/master/evm/src/executor/inspector/cheatcodes/expect.rs thank you maybe is there a way to manually update the block.timestamp like vm.roll does for block.numbers? ahh nvm, warp does that...doh So I'm doing some forked testing. I have this setup that calls an address to clone another contract. I've etched some of these, but I can't really etch the one that manages that logic.",494
1561,foundry-support.txt,"Unfortunately, it seems like, even though I've etched over that cloned implementation logic, when it is called by an on-chain, not overwritten contract, delegatecalling it, it still references the on-chain deployed logic and doesn't re-route to my etched version. Am I crazy? I don't want to have to overwrite that contract, because that would wipe all the actual state variables and I need those to remain in place. It seems like the forked environment should catch that any call to that etched address would be intercepted & redirected to the etched logic. If I deploy a contract with a Solidity script, is there a way to get the deploy transaction hash and block number within the same script? hi - when I restart Anvil and then try again to connect with Metamask, I get a BlockOutOfRangeError, where it looks like the request is asking for the last block from before the restart. What might be causing the old height to persist? EDIT: resolved - turned out to be a Metamask caching issue, similar to https://ethereum.stackexchange.com/questions/111863/received-invalid-block-tag-1698-latest-block-number-is-xxx-smaller Why is changePrank marked internal? 🥺 It's meant to be used only by inheriting contracts is there a way to understand the state mutability of a function from bytecode? Sure you can statically analyze it See if it has any storage ops Or any calls That's what the old Optimism sanity checker did basically Thank you hey team, is there a site where i can input a function and calculator tell me how much memory it consumes? can't reproduce this anvil -b 1 cast rpc evm_increaseTime 10000 You need to mine a block This auto mines Im writing a test to verify a modifier modifier ------- if (!isMinter) revert notMinter(); test ------- function testMint() public { // can only be minted if minter role is granted vm.expectRevert(""notMinter()""); contract.mint(address(this), 1); } error ------- [FAIL.",425
1562,foundry-support.txt,"Reason: Error != expected error: ˑȖ != notMinter()] is this not supported? you'd have to call expectRevert with TheContract.notMinter.selector because it's a custom error see;https://book.getfoundry.sh/cheatcodes/expect-revert#examples this is exactly relevant to init a git repo what are you talking about IDK if he even has a git config setup, that init repo without need of proper config ser try more than 13 seconds my guy Is Tests are not updating (5) completely fixed? forge clean && forge test didn't work. The way to work around is to paste the tests to the working repo. How can I run coverage for fuzz tests, or tests in generally? forge coverage is not doing this by default. There is nothing about coverage in Foundry book. It's been a while, but I'm getting back to dev with Foundry. I just did my rustup and foundryup. No issues, but am getting this when trying to initialize: ➜ solidity forge init multiswap Initializing /Users/eric/Development/CavalRe/solidity/multiswap... Error: xcrun: error: invalid active developer path (/Library/Developer/CommandLineTools), missing xcrun at: /Library/Developer/CommandLineTools/usr/bin/xcrun I switched form Windows to Mac, so this is my first project using Foundry on Mac. This is probably just a Mac issue, but any help would be appreciated 🙏 You need to reinstall Xcode command line tools 😱 https://ma.ttias.be/mac-os-xcrun-error-invalid-active-developer-path-missing-xcrun/ forge test works fine on a previous project Did you upgrade your os? Yeah Read that article TLDR : it’s to do with Xcode and git. Forge test doesn’t use git, but init does So Xcode is required to run Foundry? It’s required to run almost anything on a Mac. Not the full blown one , the command line tools Chances are you already had it > xcode-select --install xcode-select: note: install requested for command line developer tools Thanks. This is going to take a minute 🙏 All my previous dev work was on Windows.",464
1563,foundry-support.txt,"Just getting started with Mac 🙏 Oof! forge init using git submodules 🤦 On the bright side, it worked 🙏 Beautiful! https://github.com/dapphub/ds-test/pull/45 This ☝️ was a challenge I faced last time. We got a package.json with forge-std (🥳), but it didn't really help because ds-test didn't have a package.json. Now they both do, so we don't need submodules. Is there a template that doesn't use submodules? If not, I could publish one easily enough. WIP, but just FYI: https://github.com/EricForgy/foundry-template any ideas why i would be getting `Contract C.sol:C has unlinked bytecode. Please check all libraries settings.` ? i have some external libraries that i am using, i get this message when i run forge script it doesnt actually appear to affect anything, im still able to deploy and call that contract... You dont need package.json first of all anyways you dont need submodules either you can use subtree instead or vendor them in a different mgmt system Hola I want call functions for create multiple tx with different time How can do it? hello, am getting stack to deep errors compiling with forge. optimizer runs are set to 1000, anyone got an idea maybe nvm ^ hey @jacejai, just making sure, which solidity extension do you have installed? there are multiple out there forge formatter is integrated with the one by Juan Blanco. there are others by Nomic Foundation, Eleven01 etc I installed Juan Blanco that one trying to exclude obvious suspects: - do you have other solidity extensions installed? they might conflict with the target one - did you reload vscode after installation as prompted? Oh yes i have installed other extension, let me try to disable them Thanks for the help Not sure what you mean. We should probably remove 5 as our cache invalidation is correct now Can you open an issue if you can reliably repro this? Can you expand ? IIRC Forge coverage reports covered lines regardless of them being fuzz tests or not I wanted to ask if it is possible to do coverage but for test contract, if that makes any sense. I had some fuzz tests that had extreme edge case with if-else statements, and I didn't know if some branch in test was executed or not.",485
1564,foundry-support.txt,"It turned out that some branch was not executed at all, because input never satisfied that scenario. i can try but not sure if i will be able i ran into issues the following type of setup i have one repo with the external library, this is a dependency of the main project i have a second repo which also has the external library as a dependency, and which is itself a dependency of the main project i actually have a third which is just like the second, but im curious if the problem could arise with just this setup in diagrams, if A is the main repo, E is the repo with the external library, and B is the second repo, we have A / \ E B \ E Hello there, I would like to make a clear foundry.toml with my API KEY BSC, ETH, and for example Avax. I would like to know if someone knows how to make the it? Everytime when using cast cast tell me to use ETHERSCAN_API_KEY but i want also to use BSC api key if someone has an idea? Forgot the screenshot I think cast might not be wired up to read the etherscan section? Maybe it is. Not sure.",239
1565,foundry-support.txt,"Can you open an issue? Cc @mattsse Oh will do it can be amazing in the future then for going faster without playing always with the rpc and api key that a nightmare lol^^ hello sers, I was trying to verify a contract on a chain whose explorer is a blockscout fork, so I did forge verify-contract --verifier blockscout --chain 18159 --verifier-url https://memescan.io --optimizer-runs 200 --compiler-version 0.8.17 --retries 1 0xb4d74D6ad8d06289e646Be3DE2CD7000EBa5B09F src/WildWestToken.sol:WildWestToken failed to submit contract verification, so then I added --show-standard-json-input and grabbed the stdin stuff and submitted the thing manually and it worked; any idea why it didn't work thru the cli? Could you please open an issue for this Could you try .io/api as the url? Usually blockscout’s api is <url>/api Will improve error message for this ahh yes that's the url for the api indeed, I thought I just had to put the root domain without any path my bad I’ll make this clearer with a warning/error Yep probably tomorrow bit late ahah Done sir https://github.com/foundry-rs/foundry/issues/4057 Hi all! A noob question here. I try to run anvil with a fork, use cast call to send a tx to anvil, then want to inspect the failed tx with cast run. How do I get the tx hash for a failed transaction from cast call or anvil? hm you can do cast block latest and get the txhash from there we may not log the txhash, maybe we should thanks! gonna try this.",375
1566,foundry-support.txt,"one more question - what can cause this? (code: -32603, message: EVM error LackOfFundForGasLimit, data: None) I've tried one of the Anvils accounts as well as an account that should have enough gas in the forked chain No Signer available error when I try to use an account I don't have the private key for you need a signer to be able to acceess an account, privateKey or mnemonic what are you trying to do ? how would i add an older version of a repo to a project? i want to add the following https://github.com/OpenZeppelin/openzeppelin-contracts/blob/release-v3.0.0/contracts/math/SafeMath.sol https://book.getfoundry.sh/reference/forge/forge-install Foundry Support Hello. Please advice I’m tring to deploy SC via foundry script and I have array of structs(TokenData[] struct below) in constructor. How will be better to send the array to script? and second one. I’m tring to do it like json and decode it. but I met strange bug abi.decode reverts when in structure I have 2 property with type boolean. what wrong did I do? struct OracleData { address aggregator; bool isOk; bool isCompatible; } struct TokenData { address token; OracleData oracleData; } Does anyone have any good suggestions for code reviews? I spent the last month writing a contract using foundry and I’ve been loving the experience.",307
1567,foundry-support.txt,"It’s one of my first contracts and I want to make sure I’m going down the right path in terms of getting to prod deployment https://github.com/atomizexyz/fenix This week I’m having converstaions with our commuinty so the code isn’t 100% final, but I’m sure I’m messing somethign up lol what do you mean? The idea is to deploy this contract on 10 EVM chains with foundry? is ‘vm.broadcast’ expected behaviour to only handle one broadcasted call per block? (deploying to mainnet) ‘vm.startBroadcast’ … ‘vm.stopBroadcast’ only ever seems to deploy one contract (if i deploy multiple) from a single code block wrapping each call in a new (broadcast, stopBroadcast) pair gives expected behivour Hi everyone I just wanted to know if there a anvil equivalent of the hardhat-live-fork? what?? yes and no OMG please show me how Sorry mate, are you, like, sick? do you need my seed adress mate trying to scam a dev groupchat on technicals is not the smartest thing shocker Uh do I ban anyone Ah shit. Sorry folks.",244
1568,foundry-support.txt,"it's either a ban or a complete collapse of the entire industry, the dude is trying to explain that he found a way to transfer the ether from the dev to the mainnet Roger i'm just here trying to an anvil equivalent to the hardhat-live-fork? lol Hey all, I'm confused: what is the difference between Anvil and the hEVM? Why does foundry use the hEVM when anvil exists? Foundry doesn't use hevm It uses revm Anvil is a bunch of RPC and some state held in memory around revm Just like ganache and hardhat node why does anvil like die after 5 minutes I swear that for my script to work I have to restart anvil and my script which connects to it every 5 min I am deploying contracts on forked bsc mainnet to emulate them and the script works for 5 min then it's impossible to deploy any contract to it, untill I restart everything Don't have this problem with ganache but ganache is slow as fuck anvil ftw It shouldn't, please open an issue with steps to reproduce and we'll investigate It's possible there might be a memory leak Or something Or some unbounded cache @gakonst σας παρακαλούμε, any tips for setting a live fork net for testing with real time tx's? Can't seem to find anything, probably looking in the wrong place but if you could point me to any resources that would help alot Anvil doesn't do it live You want to keep resetting to latest block as it arrives? I would like to truly simulate the tx's Pls give an example 😅 yh sorry was miss clicked 😅: I would like to have tx's coming in for each block but have my actions in the fork net be persistant to do analytics later You should consider using revm directly Without committing ok, don't know much about revm. What do you mean by : without commititing ? thanks for the help btw To simulate without writing to the database So you can do multiple Sims on the same state is anvil using revm under the hood? Yes oh i see. Are there any good ressources that you would recommend to learn more about revm? Try the examples in the repo It's easy thanks! I’m having an issue where when using vm I am unable to access any prank functions.",495
1569,foundry-support.txt,"I have access to vm.label and other functions - just not any prank or cheat code functions. If I attempt to import Vm.sol and use it like Vm vm and vm.startPrank(), I will get an error of conflicting ‘internal constant vm’ Anyone have any idea why I cannot access .startPrank within a contract that is inheriting Test.sol ? It seems as though VSCode is only showing me VmSafe functions. I don’t get any IDE errors when I use vm.prank(), or startPrank(), but prancing also doesn’t seem to work, as a simple isOwner test won’t work. I am getting EVM revert on vm.prank on any random public Fantom server. Is it supported? Does anyone know a public RPC with fork support? Would like to know if there is merkle tree generator, would like to audit a merkletree but i don’t know if you guys have some merkletree generator directly in solidty or online? how do you mock delegatecall return values? Does Forge bubble up revert reasons when fork testing? I am trying to test a call to the aggregate function of Multicall, and the call definitely reverts, but I cannot make the test pass. I tried passing the exact revert reason string in vm.expectRevert, passing an empty string, passing nothing - in all cases, the test failed. how are you passing an empty string ? there was some issues doing this with ABI encode before vm.expectRevert(bytes("""")) trying to get slither work with foundry project, are there any repos that have the config file set up correctly? the one from the foundry book doesnt work for me I just find an interesting behaviour / bug. If I try to run my tests againts a forked chain (e.g. Goerli) and declare sender address (via `--sender`), the nonce of the address is not taken from the chain, but is rather 0. In that case a CreateCollision error can happen bc in tests I am trying to deploy a contract with some nonce, but I already used that nonce to actually deploy a different contract on that chain (in this case Goerli). Guys, can you help me, why am I getting using console.log full bytecode? I just want console ""data"" var.",474
1570,foundry-support.txt,"Just response from .call It should be 0x0F there It should work - I recently went through the Foundry Book guide for Slither and it worked. Just make sure you run slither . instead of passing the path of the contract. See the explanation I left in the PR: https://github.com/foundry-rs/book/pull/762 solved. 608060405234801561001057600080fd5b5060b68061001f6000396000f3fe deployed code run was here. No need it anyone experiencing slooooow GitHub Actions today ? was testing out some foundry ? Pls open an issue @paulrberg maybe related to your caching changes? Can you expand what you're experiencing? oh i am just experimenting with using github actions , trying to deploy a contract via forge script , and then using https://github.com/actions/upload-artifact , to get a tarball of the artifiacts , replicating what is being done with reth's github action of book.yaml i dont think this is a forge issue , its that pulling down of the docker image of the github action hope im making sense No, definitely not. Happened locally and in forge-std (I was working on a PR) so anyway , all u devopsy guys , it seems this is a known problem with github actions , if you get fedup come back after a few hours Hy everyone i have a question. I'm not good at javascript i know very little. so i don’t wanna learn javascript to test my smart contract. Is foundry enough? Or i have to learn javascript also to test on heardhat. Foundry embraces Solidity-only testing And in general covers all teh testing use cases the hardhat does Oww that's great 😍 So i can do almost everything with foundry? Yep - give it a shot 🙂 Yeahh 😁 Love it ❤️🥰 Could someone share an example for a GitHub Actons set-up that successfully loads a MNEMONIC as an env var from GitHub secrets, and calls forge script? export MNEMONIC={{ secrets.MNEMONIC }} thi sshould work? Thanks. nevermind, the problem was that I set the env: key at the workflow level instead of the job level heya thanks for ur response! today i tried again and didn't have any problems. maybe i just had some of that erratic stuff going on.",494
1571,foundry-support.txt,"thanks for checking and prompting me to get on it again! can i ask if you've been using codespaces a lot? is it really the future? do u think it will replace local dev like Google Sheets replaced Excel for example? let’s do a stackoverflow q&a for that? 🫡 Yeah, when I solve it haha Currently getting another error: > /home/runner/work/_temp/53dbd25d-11e3-4466-91b5-ec0b3a879008.sh: line 1: scheme: command not found not sure what this is about, I'm quite sure the env vars are set correctly My step is this: yml - name: ""Deploy the contract"" run: >- ETHERSCAN_API_KEY=${{ secrets.ETHERSCAN_API_KEY }} INFURA_API_KEY=${{ secrets.INFURA_API_KEY }} MNEMONIC=${{ secrets.MNEMONIC }} forge script script/DeployComptroller.s.sol --broadcast --rpc-url ${{ github.event.inputs.chain }} yes vm.expectRevert(bytes(""''"")) I think you need to add an additional pair of quotes within that Meaning for empty string add '' oof use run: | also you may want to set permissions with secrets permissions: contents: read pull-requests: write unless its a throw away mnemonic it can be read potentially Is this a local runner ? Gm good sers. What would be the easiest way to setup a deploy script that reads some of the parameters from other chain? Say I want to deploy and configure a few contracts on Avalanche. But I need to get the parameters from Eth Mainnet first. Can't figure out a way to do this in one deploy script. I need to do vm.createSelectFork(ethRPC); to read the params, but I can't ""switch back"" to Avalanche for broadcasting later. The best workaround I came up with was separating the scripts. Run the ""fetch the params"" script, save the data locally. Then run the deploy script, read locally saved data. Am I missing a better way to do this? Nah, it has to be "">-"" for a single command split on multiple lines ""|"" is for multiple commands No, it's GitHub you can use both i use | ; yaml is always iffy ya Thanks, I'll try Pinging to check if you found a way to do this, having the same problem.",492
1572,foundry-support.txt,"you cant do that im pretty sure grafting why are you not loading it through env: Does Test.sol no longer ship with forge_modules? This file doesn't exist anywhere after running forge install name: script deploy env: ETHERSCAN: ${{ secrets.ETHERSCAN }} run: | forge <etc> Nah did not manage to achieve that Oh, that's what I did first, and it didn't work github actions had outage potentially earlier today or you were rate limited from your IP this occurs occasionally forge_modules doesn't exist. Perhaps you meant forge-std? https://github.com/foundry-rs/forge-std Define ENV before jobs in your config docs do mention rate limiting via api , i have also read , the problem is with how the runners are on azure , so some bottleneck or issue from that perhaps - name: Check snapshot_mev2 continue-on-error: true id: snapshot_mev2 run: forge snapshot --check -f ""$ETH_RPC_URL"" -vvv --fork-block-number 15025412 --allow-failure Yeah, that's what I did I'll reach out to GitHub Support https://gist.github.com/sambacha/ccc7f735fd51bdabf656c9c50af61e4b are you sure your putting it in the correct github secrets place There are two ways to load environments in actions https://gist.github.com/sambacha/18ddbdb4069ec3343717a02466d26b19 There is an issue with crytic compile they should be publishing a fix for it this week this uninstalls it and installs the patch to fix it if slither is the issue , github actions marketplace has an action already , see if that is executing , and put it as a seperate yml and whatever your are trying to do as another yml do you have a link ? 🙏 Trying to write some jsons with writeJson and getting the keys scrambled every time.",397
1573,foundry-support.txt,"{ ""second"": {  ""a"": 10,  ""b"": 20 }, ""first"": {  ""a"": 1,  ""b"": 2 } } On the next run with the very same script: { ""first"": { ""b"": 2, ""a"": 1 }, ""second"": { ""a"": 10, ""b"": 20 } } Is this known behavior, or am I doing something wrong here? Example script: https://gist.github.com/ChiTimesChi/1ed011e4d18eb41413bdc4d1fae4554c json standard doesnt enforce object ordering we can *technically* force the impl to do so but in general json is considered unordered might be nice to enforce it just for git diffs Yeah, I guess.",168
1574,foundry-support.txt,"How do I figure out the address of the contract I am testing (on a local forked network) so that I can send it erc-20 funds like LINK to pay for their fees? if --sender is the address that executes the tests, which call the contract, how do I set the address of the contract when using forge test to test the contract? Kind regards u deploying on anvil? No, I'm developing on ganache I don't think my local chainlink node worked with anvil ngmi my guy How to with Anvil sir? just run anvil in a terminal. if it doesn’t support some rpc u need plz open an issue you can read more about configuring anvil in the foundry book, see pinned comment thanks sir. I mean, How do I figure out the address of the contract I am testing with forge test, if i'm using anvil? there is a util function in forge std that will compute the address of the contract you are deploying i believe checkout forge-std/StdUtils.sol. it has computeCreateAddress and computeCreate2Address Hello there, once we identified a bug using a fuzzing test, is there a way to start again the fuzzing test but directly as run number X ? Test is hard to reproduce so I can't really setup all things so I'm relying on re-running again the fuzzing test but since that's the 12K+ run that is failing it takes a considerable amount of time to reach. the best thing to do is indeed make a concrete test with teh same inputs. I recommend copying the body of the fuzz test into a new function, and have the fuzz test call the function and have the concrete test call teh function with the faulty inputs my hero 🥺 THank you kind sir. I'm testing a ERC721 contract. The test file needs to implement the ERC721Receiver interface like so (to test the transfer function) : function onERC721Received(address _operator, address _from, uint256 _tokenId, bytes memory _data) external pure returns(bytes4) { return bytes4(keccak256(""onERC721Received(address,address,uint256,bytes)"")); } but of course I ""unused parameter"" warnings.",454
1575,foundry-support.txt,"Is it possible to silence those or to change something in the code, to avoid getting such a function ? Those warnings come from solc and not foundry and there isn’t a way to silence them Maybe with the new hardhat foundry plug in for stack too deep errors any way to get the compiler to tell exactly which file and where the error is at? CompilerError: Stack too deep. Try compiling with `--via-ir` (cli) or the equivalent `viaIR: true` (standard JSON) while enabling the optimizer. Otherwise, try removing local variables. When compiling inline assembly: Variable value0 is 2 slot(s) too deep inside the stack. Stack too deep. Try compiling with `--via-ir` (cli) or the equivalent `viaIR: true` (standard JSON) while enabling the optimizer. Otherwise, try removing local variables. hard to debug it without any info about where the error is at there is not, this is a limitation from solc unfortunately https://github.com/ethereum/solidity/issues/11638#issuecomment-1057526542 this is even without via-ir? there shouldn’t be yul ir without that option right? this is without via-ir. there has been a yul based optimizer present in the last few major versions of solidity (since 0.6 it was enabled by default) i see, interesting any tips on making iterative update test and run flow that doesn’t take 5 minutes every test run with via-ir enabled? damn what is foundryup -P 2701 doing...reinstalling every library on my machine?? it's called building from source good sir I had this issue while running the forge coverage analysis is 0.5.17 not been supported by the forge coverage? i do noticed that there is an issue about assembly exception for bytecode but seems this issue already fixed.",385
1576,foundry-support.txt,"https://github.com/ethereum/solidity/issues/8656 any tips the build is all good ~ but the coverage feature is not working any one can share some tips If you fork mainnet using anvil at a specific block (say 16370900), can you simulate the next blocks that happened on mainnet? Like simulate all the transactions coming in on block 16370901? Hello I am wondering how to deal with combinations of @openzeppelin/contracts and @openzeppelin/contracts-upgradeable when I use the foundry install openzeppelin command (git submodules inside the lib directory). For example, I have the following tree structure: lib/ ├── forge-std ├── openzeppelin-contracts ├── openzeppelin-contracts-upgradeable And in the contracts (I was using npm before): import ""@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol""; import ""@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol""; import ""@openzeppelin/contracts-upgradeable/token/ERC1155/ERC1155Upgradeable.sol""; import ""@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol""; Now I would like to keep the contracts the same using the remappings. Currently they look like: @openzeppelin/=lib/openzeppelin-contracts/contracts/ @openzeppelin/contracts-upgradeable/=lib/openzeppelin-contracts-upgradeable/contracts/ But this doesn't work. I get the following mapping error: [⠊] Compiling... Error: Failed to resolve file: ""/home/.../evm/lib/openzeppelin-contracts/contracts/contracts-upgradeable/access/OwnableUpgradeable.sol"": No such file or directory (os error 2).  --> ""/home/.../evm/contracts/v1/markets/ConditionalTokens.sol""   ""@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol""  Check configured remappings.",412
1577,foundry-support.txt,"Is there a way to configure the remappings in a way I keep the contracts the same? everything works on my end Use this @openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/ @openzeppelin/contracts-upgradeable/=lib/openzeppelin-contracts-upgradeable/contracts/ Still having an issue :/ With: @openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/ @openzeppelin/contracts-upgradeable/=lib/openzeppelin-contracts-upgradeable/contracts/ I get: Failed to resolve file: ""/home/.../evm/lib/openzeppelin-contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol"": No such file or directory Surprisingly if I set: @openzeppelin/contracts-upgradeable/=lib/openzeppelin-contracts-upgradeable/contract/ Note it is wrong (`contract` should be `contracts`). With that I get: Failed to resolve file: ""/home/.../evm/lib/openzeppelin-contracts-upgradeable/contract/access/OwnableUpgradeable.sol"": No such file or directory no idea I can't riproduce it Apologizes. The error is that on my contracts I have inconsistent paths. Hey is foundry coverage working ? yes oh yes, it works !!! Anyone? Or this is potential new feature. Hm I thought cov report was also generated for the tests? It should be Or it should be possible Yeah, coverage reports should always be generated for tests, too As per the discussion here: https://github.com/foundry-rs/foundry/issues/1961#issuecomment-1368823521 Does anyone know a good solidity ast parser in rust ? (ether-rs one is not very advanced) Solang? I don't think it feets my needs, basically I am trying to create a solidity linter in rust and I wants a 1 to 1 equal to solidity ast Hey, anyone having problems with optimism forks. More specifically on the getL1BlockNumber throwing and error “Opcode not found” What’s up guys! I created a new automate tool that can identify some vulnerabilities in smart contracts. It’s better than Slither(With not many false positives).",457
1578,foundry-support.txt,"So if you are interest to try it out for free and let me know your feedback, please send me a message Is it open source? What can be error? testing by forking network Not initially, but maybe in the future Can you run with -vvvv and send a screenshot here? It should work smooth Don't know what is error Tested this using tenderly working smooth Let me know if you know reason hello, keep coming across this error that I can't resolve, would really appreciate if you guys can help 1) I have a library with external functions, so my plan is to deploy the library contract and then link it. So I did the following forge create --rpc-url http://localhost:8545 contracts/structs/Pool.sol:PoolLibrary --private-key 0x... The output was following Deployer: 0x... Deployed to: 0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9 Transaction hash: 0xe95748f07c4c4ef21690fa7e6f892c9f12b43803a139744ca32a90d8154fce97 2) Then I tried deploying the smart contract that depends on it forge create --rpc-url http://localhost:8545 --libraries contracts/structs/Pool.sol:PoolLibrary:0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9 --private-key 0x... contracts/PoolFactory.sol:PoolFactory 3) This leads to me getting error Dynamic linking not supported in `create` command - deploy the following library contracts first, then provide the address to link at compile time   PoolLibrary: contracts/structs/Pool.sol I suspect I am not deploying the library contract in a correct manner? Apart from that, I can't come up with any conclusion @ASP2k Can you send the code snippet as well? Only forking and calling function Very simple Maybe make sure you mention the correct RPC and block number I think it's correct rpc Are you calling the correct contract (address)? 🥲It was wrong address Hello 👋 I am attempting to use Foundry to test a function that utilizes Hedera's System Contract functions.",478
1579,foundry-support.txt,"Being that Hedera uses a different EVM to interact with native Hedera services, Foundry is unable to test these functions. I was brainstorming and was wondering if it is possible to configure Foundry to leverage a different locally hosted EVM or if anyone has thoughts? What are the hedera system contracts (can’t find any info on them). Are they like pre compiles ? Yeah theyre the precompiles Foundry should work out of the box with any evm compliant blockchain. Chains like celo which have their modifications might need to be handled specially . These changes are usually propagated through ethers.re im going to do some further digging inot this and will come back if I have any further questions. thank you! The above link seems to be broken but did you mean https://github.com/gakonst/ethers-rs This is a slightly old issue but I was hitting this same problem yesterday when trying to deploy to Polygon (mumbai) and the fix was to open the Ethereum app in my Ledger instead of the Polygon app Hey there, I have a bit of a niche question. I am helping Austin Griffith with implementing foundry into the tutorials that new devs to the ethereum ecosystem go through. Currently devs submit smart contract challenges as solidity files && get them autograded. We'd like to use foundry to autograde said challenges: Can we use env vars in solidity files? ex.) import {DEX} from ""../../contracts/CONTRACT_ADDR.sol""; where CONTRACT_ADDR is an env var defined in .env? happy to chat offline so as to not spam the group chat here Hey all - I was wondering if there was a way to have an anvil fork that allowed you to assume different ""from"" addresses so you could perform admin functions on deployed contracts. Didn't see anything on the readmes / foundry book Yep - you can use the env* cheatcodes.",385
1580,foundry-support.txt,"They will load the env vars and cast them to a type: vm.envAddress(“CONTRACT_ADDR”) See this page for more details: https://book.getfoundry.sh/cheatcodes/external You should be able to just use vm.prank() as normal, no? I was moreso looking to do it in a cast call But I guess I could use solidity scripting in this case There is Look in the docs for anvil impersonateAccount Or something like that Or cast impersonateAccount i cant remember You run this before you run the cast and it does what you wanted https://book.getfoundry.sh/reference/anvil/ There you go my man - thanks so much! Thank you for the reply! Hmm, so this looks like a way to get the variable into a string format within the test file or code itself. I'm not sure it solves what I'm looking for. I'm looking to: 1. Generate a new contract called CONTRACT_ADDR.sol via a script (it copies code from etherscan that the challenger submitted) 2. Import this newly created CONTRACT_ADDR.sol into a foundry test file, Setup.t.sol where it is doing the following: import ""forge-std/Test.sol""; import ""@openzeppelin/contracts/token/ERC20/IERC20.sol""; import {DEX} from ""../../contracts/CONTRACT_ADDR.sol""; abstract contract Setup is Test { . . . } 3. Where the above Setup.t.sol is used in a final DEX.t.sol file As you can see there is no coverage of 'ERC721YulTest' contract, there is only coverage in that file for mock contract that I created for testing Huh, I would imagine you could simply put all of that logic into its own bash script, no? curl for the contract code >> CONTRACT_ADDR.sol then use cut or sed to process Setup.t.sol and save it with the new imports? This is where my lack of bash script experience is showing haha. Thank you, that make sense I think. Only a solidity dev (came from mech eng to crypto 2 years ago haha) I'll check it out Good evening everyone, was going to tweet this question but it seems i might have a better luck here.",454
1581,foundry-support.txt,"Has anyone else tried writing tests for solidity in rust using foundry as a library? yep pls open issue answered in the main chat Hello, i was wondering if anyone knows how to solve this error : Invalid implicit conversion from struct ITradeIssuer.IssuanceParams memory to struct ITradeIssuer.IssuanceParams memory requested. can you provide the actual code involved in this? Solved already! Tks! Guys, I think I used to debug my tests in Visual Studio Code before, but I might be mistaken. Is it possible to debug foundry tests using VSCode? I was able to fix my issue by doing ./contracts instead of contracts (for the library flag in second step) I think this can be identified as something that can be fixed? or is it intended behavior? do lmk so that I can create an issue Hey guys, I am trying to track test coverage via the forge coverage command. I am getting an InternalCompilerError using solc 0.5.17 is the version supported or to old? just ran a pipeline in Github with Foundry and oh boy that shit is flying ! Running the latest version of forge I see that function signatures are decoded into human readable format when I have verbose mode on. However, if I run with —gas-report the function signatures are not decoded. This is inconsistent. It would be nice to always have them decoded. Question related to solidity. Can some explain me about getting dynamic struct values if only value is present in that specific type variable inside struct? Hey All, Anyone knows, any method to disable warnings in foundry testing? Thanks in advance Hey, Is it possible to extract revert message of a mined transaction without having to simulate an ""eth_call"" .. it appear to show in the console like in pic attached but not in the anvil rpc response (just tx hash) / nothing on ""evm_mine"" is there a way to change rpc url from within a solidity script? Maybe vm.selectFork is what you are looking for i'll check it out, thank you! Hello everyone! So I compared the HTTP tx simulation (eth_call) speed of eth mainnet-forked anvil, mainnet-forked hre node and my own full node. The results are: anvil 390 ms, hre node 870 ms, full node 10-50ms. 1. Are these speeds expected, or am I doing something wrong? 2.",500
1582,foundry-support.txt,"Is there a way to make forked versions faster? I know that anvil's unit tests run ultra fast, is it because the anvil instance is spawned *inside* the script? (does it comm with localhost anvil instance at all) 3. Is it possible to beat full node? Does anybody here know if Solidity 0.8.17 with full optimization and with all code inside of ""unchecked"" is faster than 0.7.6? Or are they equivalent? In other words, is it worth spending time understanding which parts of the code should be checked vs unchecked or should I just use 0.7.6? Or maybe I should rephrase, is solidity 8 faster than 7 but has native overflow/underflow checks or are they the same? Are anvil and hre using your own node as backend? Have you tried after the cache is warm? Is there a way to load a JSON, then get the value for one of the keys without deserializing it, and write this value to the file? The usecase is that I'm trying to load contract's ABI from local artifacts and write it somewhere else. Right now I am only able to load and write the whole artifact (abi, bytecode, etc) without having to parse it, though I'm only interested in the ""abi"" value. has anyone ever had difficulty with deploying contracts to Arbitrum local dev node using forge script? keep getting intrinsic gas too low and have tried a few different CLI flags related to gas I was able to avoid the error by using --skip-simulation and providing --gas-limit 20000000 (20 million) https://github.com/foundry-rs/foundry/issues/3487 Would be great if evm_mine return those console messages anyone know how to provide multiple private keys to a forge script? there's --private-keys flag, but it doesnt seem to like comma separated or quotated PKs @transmissions11 might know Why multiple keys? Open github issue ser This use case has been asked many times and probably documented in the foundry book i'm trying to deploy two contracts: one on mainnet and one on arbitrum. using a local dev node (geth + nitro node). using vm.selectFork() to switch between the networks and it seems to work.",476
1583,foundry-support.txt,"the problem with using a single key & switching networks is the nonce doesnt seem to recalculate before the vm.broadcast() do you want to use multiple keys or just one? want to use multiple keys. one for deploying to arbitrum, and another for deploying to mainnet. i want to see if it is a work around for my nonce issue will try using a test mnemonic Would be great if @transmissions11 could shed some light. Hey guys, is it possible to do a normal eth transfer in foundry script? From whichever address we provided the priv key to run the script with you should be able to use these 2 lines in your foundry script: (bool sent,) = address(weth).call{value: 0.5 ether}(""""); require(sent, ""Failed to send Ether""); i checked the balances of the contract & private key (using cast), and it worked as expected. 0.5 ether from the wallet to the ""weth"" contract there is no guarantee from anyone and pls lets not spam people I regret at ing him now 😕 Ok, sorry. I was just curious. It's quite hard to ""google"" this kind of info and this chat has a lot of very knowldegable people. Generally 0.6 and 0.7 have better (smaller) bytecode output https://gist.github.com/sambacha/151b45d05fe463ae06640f079e8d522f if you publish a repo with the contracts in question would be easier to answer ur question Looking at UniV3 right now. Trying to find gas-efficient ways of interacting with it. The router is inefficient you can write your own for a specific use case, even generalized could be optimized especially if it’s personal use not for protocol That's what I have come to realize. I just want to use it personally, not for protocol. I am looking for advice as to which solidity version would be best suited for gas optimization. Suppose that I remove all SafeMath checks, etc. Faster in terms of what exactly? Development / auditing time? Execution on nodes (wouldn’t matter to you really, just the gas it takes). Generally don’t do unchecked math unless you are 100% certain that a number won’t overflow / underflow or have any other unexpected errors (someone correct me on the last point).",479
1584,foundry-support.txt,"For example if you’re tracking the age of users in a contract, you could squeeze efficiency out of (if using solidity ^0.8.0) unchecked incrementing their age because the number of years that can fit in 32bytes is unfathomably farther away than the heat death of the universe I’m not rlly an expert on the compiler / transpiler / whatever so I couldn’t tell you a definitive answer Faster in terms of consumed gas. I want to make calls on-chain. I understand the risks involved with unchecked math. I have a strategy for tackling that. The biggest optimizations you’ll find are just in some unnecessary safety checks and erc20 transfer / approval (forgot which one) the router has. You can just bake a custom one directly into your contract and avoid the transfer / approval / whatever and that would make a much bigger improvement on gas compared to marginal stuff like unchecked math Ok, good to know! Past the major optimizations, you’d be lucky to get 5% gas improvements on the granular stuff like safe math. If you wanted to mess around with yul / huff low level wizardry *maybe* you could get like 10% more efficient on top in the case of a router It’s worth the investment to learn more about the evm if you want to spend time on the granular stuff tho! Routers are a great hands on project to learn Can you recommend an article for me to read to get started on understanding these yul / huff optimizations? I just know there exists —via-ir option but I don't actually know what it does... On a plane rn maybe you can ping me later with a link :). I would really appreciate it. solved this by specifying two flags: forge script ... --private-keys A --private-keys B Hey guys, with the gas reports is there a way to get the full gas cost from an EOA’s perspective? Seems like the gas reports from hardhat and foundry differ Any way to traces something like this better? You would think so, but there's only option for writing the entire json (overwriting the whole file, or as a value for one of the existing keys). There is no option for getting the value for one of the keys in a form rather than abi-encoded struct. At least I wasn't able to find it. The only workaround I'm seeing is using ffi. getting EOA nonce changed unexpectedly while sending transactions.",495
1585,foundry-support.txt,"on arbitrum btw, any quick fix? Hello guys, I am using VS code with foundry. I have followed the instruction of integration but the import path cannot be autocompleted. Is it normal? yes. AFAIK , it helps with your remappings , but not auto complete. If you didnt have it , it would show red lines under the import I saw that there is a feature of autocomplete in the github page of the extension suggested by foundry. Is it not available for us? anyone know how to get rid of this red squiggle import your remappings into your vscode config not sure havent notcied it working but i have copilot turned on too Oh copilot🤣 are you getting nonce too high or literally nonce changed unexpectedly? been battling the former when testing multichain/crosschain operations, and the only way i've been able to avoid it is using multiple PKs Emmm seems foundry is till improving the gas estimation functions I am doing something similar too. My use case is I want to relay the transactions on other people's behalf on the same/different chains.",228
1586,foundry-support.txt,"I wrote a simple PoC script to simulate the scenario on Goerli, you can see I manually incremented the nonce count on each iteration const main = async () => { await Promise.all(  Array(5)  .fill(0)  .map(async (_, idx) => {   console.log(`Retrieving the transaction count for relayer ${relayer.address}`);   const transactionCount = await provider.getTransactionCount(relayer.address);   const nonce = transactionCount + idx + 1;   console.log(`Transaction count on chain ${chainId} is ${nonce}`);   console.log('Signing the transaction');   const signedTransaction = await relayer.signTransaction({   to: toAddress,   nonce,   chainId,   type: 2,   gasLimit: 21000,   maxFeePerGas: 1500000000,   maxPriorityFeePerGas: 1500000000,   value: ethers.utils.parseEther('0.000001'),   });   console.log(`Sending a transaction on chain ${chainId}`);   const txn = await provider.sendTransaction(signedTransaction);   console.log(`Dispatched a transaction ${txn.hash} on chain ${chainId}`);  }), ); }; main().catch(console.error); No errors were thrown and the transactions were dispatched, but they were never confirmed on chain. I got these transaction hashes but none of them were processed (i.e.",293
1587,foundry-support.txt,"the transaction hash was not found on etherscan or tenderly) Dispatched a transaction 0x88d92833e7b59b894c17fcf453eaa8c4f3744d5a15bc6d067f5da9f9339b8afb on chain 5 Dispatched a transaction 0xe424874f9c0e455abb64e0916330de0b1de64be388c16ef483217821db3b3f0d on chain 5 Dispatched a transaction 0x3ed571a906dc78a6c81d71c861fb27d303a7defd1904c431df6131f78e3bcd4a on chain 5 Dispatched a transaction 0x041dc989597b5e402cd0b9550c780284e7b34aaa80341fd3491ce11691d5daf2 on chain 5 Dispatched a transaction 0x07900ddd55b9850687052abc84251f8baf2d5c92be49f4a1258074c4e30f6e80 on chain 5 looks right to me, can you try logging what your nonce is and getTransactionCount? wonder if you have an off-by-1 error iirc provider.getTransactionCount() might return your next nonce cant remember if nonce is 0-indexed or 1-indexed might not be your issue, but worth trying provider.sendRawTransaction too.",319
1588,foundry-support.txt,"been a bit since i've used js to send txns Transaction count on chain 5 is 47 Transaction count on chain 5 is 46 Transaction count on chain 5 is 45 Transaction count on chain 5 is 48 Transaction count on chain 5 is 49 the transaction count was 44 sendTransaction is the same as sendRawTransaction Is it because I can't include multiple transactions from the same address in the same block? i think you can certainly have multiple transactions in the same block let me DM you directly because we should refrain from non-foundry related discussions No it is not There was a confusion, I am sending a raw transaction in my code snippet using provider.sendTransaction, but yes, the json-rpc method of eth_sendTransaction and eth_sendRawTransaction is different hey does anyone know if foundry works with fvm 🙏 What's an example? Foundry is built for the EVM FVM apparently emulates the EVM and supports solidity contracts and EVM bytecode. could be a whole lot of work to support, was just curious if anyone’s looked into it. thanks 🙂 https://fvm.filecoin.io/#evm-compatibility-3 https://github.com/filecoin-project/fvm-specs/blob/main/04-evm-mapping.md You could try it and let us know perhaps No Its not EVM equivalent *hides* Haha thank you latter are you using cast, forge test, or forge script? not too familiar with the issue so not sure How are people creating upgradable proxies in Foundry? Any example repo? Hey any update on this? Getting ""needed a single revision"" on forge update Hey it seems the gas reports report lower than what is reported back from remix, i.e from an EOA. Do you have to add 21k gas to accomodate for the transaction cost too? Hmm looks like if I wrap the function I want to test in a test method, that gives me the most accurate gas cost. Yes tx needs to be added Hmm I see, Foundry do mention forge test —gas-report is the most granular, and it seems like adding the median number along with 21k gas seems most accurate. Yes, in general gas usage is a little bit off.. also estimate gas vs onchain But +21k provides reasonable results for me Do you guys have autocomplete feature while coding with foundry in VS Code? Hello. Why I get this error? Lib installed successfully.",500
1589,foundry-support.txt,"And the same error, when I do forge init Isn't there a way in the Forge cheatcodes to say set this byte code at this address? Yeah, vm.etch why I get this error. when i do forge init? in empty directory can you run forge --version ? I am trying to debug fork tests, which RUST_LOG flag do i need to use? I have tried RUST_LOG=forge and its far too verbose. forge --version forge 0.2.0 (427c1b5 2022-12-06T00:11:37.947665Z) no clue why you are having that , its the most recent build.. maybe a regression slipped past. I would advise that you open an issue in the repo Maintainers are quite responsive RUST_LOG=error,debug helps did you mean like this? Hello, everyone, I want to ask me what questions I have about the use of the deal function here? I can't debug the error reported by Foundry You are probably not passing a fork url. You want to deal dai, so it need to be connected an account with dai deployed at that address RUST_LOG=crate[,crate2,crate3]=error/warn/info/debug/trace update your git hey hey! i'm trying to import foundry-evm as a crate in my rust project and i get this strange error while building the crate: error[E0599]: no method named `set_compiler_severity_filter` found for struct `ProjectBuilder` in the current scope this is how i'm adding it to dependencies: foundry-evm = { git = ""https://github.com/foundry-rs/foundry"", rev = ""af681f4"" } anybody knows what can be wrong? 🤔 run cargo update, maybe you have an old version of ethers-rs cached / in your Cargo.lock that doesnt have that method Ah yeah, that is it! thx im trying to update the forge std library but it doesn't do anything when I run forge update and i think i need to update it because i keep getting the following error TypeError: Member ""createFork"" not found or not visible after argument-dependent lookup in contract Vm.",454
1590,foundry-support.txt,"while trying to do fork testing are you on the latest forge version? ive run foundryup so i believe so forge 0.2.0 (b2baca3 2023-01-16T00:04:06.417962174Z) i cant fathom another reason why the createFork method would be missing from the source files Vm.sol file i even checked it manually i tried deleting the library and reinstalling using forge install foundry-rs/forge-std --no-commit but keep getting the error ""lib/forge-std"" already exists in the index, you can update it using forge update. can you try forge update foundry-rs/forge-std. recently updated a dependency and sorta forget the exact command That command fails because it can't find the package w that name. The package was installed under lib/forge-std Which is the only name not throwing an error HI! I have a question about Forge and it's Fuzzing functionality. From what I seem to understand from the docs I believe Forge's fuzzing is primarily intended at fuzzing function/method arguments. I was wondering if there was also a way to fuzz a contract's functions call sequence to reach unintended states ... I believe this is what echidna does... However I prefer Forge's way of initializing state using setup alongside cheatcodes ... Do you guys support what I'm looking for ? I also see that Invariant fuzzing is in the pipeline and nearly implemented .. is there a way to test that ? https://github.com/lucas-manuel/invariant-example/ Some examples returns the error message `Error: error: pathspec 'foundry-rs/forge-std' did not match any file(s) known to git` Can you try resetting the repo from scratch if it's a small one not rlly. i might just try and rebuild from source. if i delete the forge-std library it doesn't want to let you reinstall difficult to create a trace tui with folding functionalities? or even just a way to jump from child frame to parent frame can be enough Has anyone seen that a 2x of gas consumption in a test leads to a 28x increase in time? I've got quite a beefy script which chunks an array into smaller pieces and then processes it on-chain. However when the array size doubles, gas also roughly doubles but the test takes 28x longer to run.",495
1591,foundry-support.txt,"I'm calling the script from a test btw. Thanks! Okay, if I split the processing across two script files / invocations (i.e. chunks 1-10 in one script and then chunks 11 - 20 in another script) the test completes really fast, just a few seconds more but not 28x Are scripts simulated in tests also? I think this is worthy of a GitHub issue. If no one gets back with any ideas soon I'll open one I'm starting to think actually it might just be the RPC cache, lmao. Please ignore the above for now 😄 hey, is there a way to have gas profile for each line locally while running forge test? Sorta how tenderly does it On this one all I can say is Multicall inside Foundry scripts is very powerful! Kudos @msolomon4! I think one feedback here though could be that if a foundry script is taking really long due to lots of RPC requests, we log a warning maybe? yea it's super useful for performance there! on the latest forge-std master the multicall3 address is provided (https://github.com/foundry-rs/forge-std/blob/405727dc7580aaaa6e5b626638dd37ff171beae3/src/Base.sol#L16-L17), and the interface + a getTokenBalances helper will be added soon (https://github.com/foundry-rs/forge-std/pull/271) yea this makes sense to me, do you mind opening an issue to track? Very nice @paulrberg! Sure, will do shortly awesome, thanks! 👌 Any tips/tricks as to why foundry has started recompiling all contracts anytime I make a change? Even if it is at the top of the dependency tree. Used to be only 1 file is compiled on a change, now its all 125 files. Wondering if there are some tips to make sure foundry doesnt get confused. (Maybe import styles or some complexity limits etc) Seems to be an intermittent issue if that makes a difference. If someone could point me to where in the codebase the files get marked for re-compilation that would work too. Happy to jump in and do some debugging myself haram this is What filesystem r u using and do you have a git repo for producing a mvr AFS on Macos M1. Dont have mvr.",501
1592,foundry-support.txt,"Did do forge clean to no avail run ETHERS_SOLC_LOG=in=in.json,out=out.json; forge build this will output verbose build arguments you can see if there are changes between changes thank you sir will give this a go and see how we do there is a fork i think maybe with this feature actually Hi there, I’m trying to install openzeppelin as a lib dependency but I get this error Tag: ""v4.7.1"" not found for repo: ""https://github.com/OpenZeppelin/openzeppelin-contracts”! The tag does exist on their github repo -> https://github.com/OpenZeppelin/openzeppelin-contracts/releases/tag/v4.7.1 What’s the problem? What am I doing wrong? You Have piqued my curiosity! Anybody from the team can chime in on this maybe? Will try to find that fork Not sure if someone replied this, but i found this to be useful reference. Helped me a lot when i was developing that. https://github.com/beskay/UUPS_Proxy/blob/main/src/test/Implementation.t.sol gm, is there a way to clear out forge remappings cache? For some reason it is remembering all the old remappings I’ve had in the history of the project and is not using remappings.txt as the only source and my build is failing because of it Did you try forge remappings > remappings.txt this only writes the inferred remappings to a file. I’m saying that for some reason I have a remappings.txt and forge remappings is outputting every element that once was in that file, but not the current state of remappings.txt. My expected behavior of forge remappings is to always use the current state of remappings.txt and nothing else don't think it's cached, are you also changing it in foundry.toml? I think If it is outputting elements that were previously in the file but not the current state, then it may be due to the file having been edited manually. The (forge remappings) command works by reading the (remappings.txt) file and then applying the appropriate changes to the project. If the file is manually edited, then it will not be aware of any changes that have been made and so it may output elements that were previously in the file but not the current state.",475
1593,foundry-support.txt,"To ensure that the (forge remappings) command is always outputting the current state of the (remappings.txt) file, it is important to ensure that any manual edits are performed in a way that does not conflict with the existing format of the file I’ll try this, I’m not aware of having broken the format of the file, but let’s see I don’t see any issues in my remappings.txt file, the new additions are also part of the output of forge remappings, as well as the old ones Yet this is the output of forge remappings Some of these I have never even defined Ok, apparently forge remappings is using the inferred forge remappings of one of the dependencies and I don’t know why. Is there a way to exclude it? Try using the ""blacklist"" option. This will prevent the dependency from being remapped and allow you to use your own custom remapping configuration , youll need to specify the name of the dependency you want to exclude in the configuration file For example, let's say you want to exclude the dependency ""@openzeppelin/contracts-upgradeable"" from your remapping configuration. You would add the following line to your remapping configuration: blacklist: ""@openzeppelin/contracts-upgradeable"" is it possible that run a test that takes a long time ? eg. It runs 1 milion times to generate a contract address function testGenerateCreate2Address() public { address deployer = address(0xEEEE); vm.startPrank(deployer); _generateCreate2Address(deployer, 1000000); vm.stopPrank(); } I thought the test script is not really consuming gas, as it runs locally. Turns out it did cost gas. I got an error: EvmError: OutOfGas I set it as a view function, but it still raise an error: OutOfGas: function testGenerateCreate2Address() public view { address deployer = address(0xEEEE); _generateCreate2Address(deployer, 1000000); } My bad, Foundry does not acc have a feature to blacklist dependencies. However, it is possible to blacklist dependencies by manually editing the manifest file for the project. in the root directory of the project, “manifest.json”. In this file, you can add a ""blacklist"" section, which contains a list of dependencies that you want to exclude from the project.",493
1594,foundry-support.txt,"For example, if you wanted to blacklist the web3 library, you could add the following to the blacklist section: ""web3"": true Once this is done, you can run the Foundry command to update the project's dependencies. This will ensure that the blacklisted dependencies are not included in the project. Hope that helps I will try it’s been a pain to build my contracts I feel u, It’s one helluva difficult process , making sure they’re secure enough itself, keeps ppl up at night forge script can I skip some files while using forge test? is —skip test like test1.t.sol? It’s just a flag that can be used so no No just --skip test to skip all tests but I want to skip some tests not all Is this still happening? Yep Let's open an issue, maybe regression https://ethereum.stackexchange.com/questions/141643/foundry-skip-specifics-tests Here’s a solution for excluding specific tests that solves the issue Try all lowercase wut what uses manifest.json Could be Foundry.toml too , just that I ran into Issues around dependency remappings few times before and is why I resorted to manifest.json 😄 Hello guys, do you know if it's possible to run an ""archive node"" style locally? The reason for this is that a local subgraph I'm running needs an archive node for an important feature to function correctly. Since I dont care about data consistency, and this is just for E2E testing, I actually dont need archive data.... any ideas how to work around this? when i run the below without the gas report all test are successful, however when i add the gas report flag the below happens. forge test -vvvvv --gas-report [⠒] Compiling... No files changed, compilation skipped Killed has anyone encountered this? fixed with foundryup 😂 Interesting, I think setting up a local node thats connected to a remote archive node, would somewhat resonate with what running an “archive node” style locally would be like? Can’t say for sure tho, if it would be effective as haven’t tried this before tbh , just my 5 cents I actually tried using a fork url with an alchemy endpoint, which according to them is an archive node, and did not work. Not sure if this is about ""old data"" beyond 128 blocks or this has to do with internal mechanics and logic of the node it self...",496
1595,foundry-support.txt,"Yeah , it could possibly be that it’s the endpoint is not compatible or configured with the alchemy endpoint , to accept the specific fork URL you are using. Don’t see why they wouldn’t wanna support this and configure it if this was the case Maybe their support team can help with this Unless you find a different endpoint that does support it 😜 The thing is that I really dont want to have to sync with a remote endpoint... it would be so sweet to have the flag —archive 😄 And to be fair this is kind of needed if you really want to have a full-stack local development... not only theGraph complains about this i think would be nice 😄 maybe it Might happen one day , I often wonder how much of an impact a quantum computers will have on blockchain technology. Them being qbits both a 1 and a 0 at the same time , and be in superposition, might introduce a solution to having a full-stack local development and even be able to use it as a proxy, so that if it has any request timeouts for eg.. it’ll mirror the whole thing to keep up with the data feeds having trouble verifying on gnosis / chiado anyone successfully done this recently? also forge verify-contract & verify-check don't appear to be respecting the etherscan config in foundry.toml probably easier to open an issue on the repo I'm trying to run a script to deploy to anvil mainnet fork. One of the contracts I'm deploying tries to launch a Curve Metapool using the factory address and then call get_price_cumulative_last on the new pool but it reverts every single time. Is this because it's Vyper specifically? ello guvna anybody know best way to deploy & upgrade upgradeable contracts with foundry? used to rely on hardhat to do it forge script but we dont have pre-amde utils for making it “safe” like OZ what's the recommended way of doing it? i thought there was some form of open zeppelin for foundry people were using?0 > Unable to process the standard-input-json you uploaded.",424
1596,foundry-support.txt,"ErrCode: Only literal contents of the source file, Source using URLS are not supported are the json files in the out/ folder not approriate for uploading manually for contract verification? and is there a way to manipulate them for that purpose (since the verification commands aren't working for me rn) nm found --show-standard-json-input Contract verification status: Response: NOTOK Details: Fail - Unable to verify. Compiled contract runtime bytecode does NOT match the on-chain runtime bytecode. Contract failed to verify. running into an issue verifying a couple contract through etherscan after deploying from a script. Any idea what im doing wrong here? forge script ./script/NCA.s.sol:Deploy --rpc-url $INFURA --private-key $TESTKEY --verify --etherscan-api-key $ETHERSCAN -vvvv --broadcast this is my command sepolia or try the ephemeral testnets Without a git repo hard to say did you have metadata set to none ? —match-test and —match-contract, which one takes precedence? Hey guys, I have some issues with a websocket connection which is dropped by the server (Infura). Is there a way to automatically reconnect once that happens? https://github.com/foundry-rs/foundry/pull/3916 why u are guys removing regex? it's working fine but removing it will be a massive breaking change Hello, do you have the contact information of hardhat's telegram Foundry Repo - Achievement Unlocked - https://i.ibb.co/mytcTGD/image.png hey guys, is there any way to debug contracts deployed on chain (by providing the source ofc)? the way to solve this is to define remappings inside of foundry.toml for the main project and each dependency that way the remappings in the main repo get prioritized. solved it yesterday with a friend Is there a foundry library to handle easely ERC2535 ? tenderly i don’t really like their ui, would prefer to attach external contract sources on foundry tried it again this morning and it worked. must of been an etherscan issue.",424
1597,foundry-support.txt,"i ve faced this NOT OK on testnets , on one occasion i cycled through some rpcs via ankr and on etherscan it suddenly got confirmed , i need to see what this ""byte formal verification"" process is exactly We've not merged it yet but seems like it'll be, I won't argue glob vs regex but Regex is already working fine for foundry no need to break it for many existing projects Yeah I'm sensitive of that and I think we had a discussion in the PR Can you give some example regexs You use my deploy wallet ran out of ETH halfway through a multi-contract deploy script. last time this happened, i sent more ETH and resumed the script only to get an error message because the nonce was incorrect. what should i do in this situation? aside from making sure my wallet has enough ETH before running it : ) i really would like to be able to run it with --resume so the script can finish verifying all the contracts deployed during both runs hey all. I was testing a low-level call to the seaport contract (passing in the calldata directly), and in my test script, I kept getting an ""Invalid Signature()"" error, but when I simulated it using my script file, it worked completely fine. would anyone have ideas on why that is? I assumed it might've been a msg.sender issue, but I also used vm.startPrank before triggering the call in my test file. (am also using a fork url for both, so the saved state should be the same) Is there a way to get cast wallet new to output a mnemonic phrase? Try other tool Was more for convenience, setting up scripts in a repo and don't want to import / require other tools. Didn't know if it existed or not within foundry, not a big deal if not.",369
1598,foundry-support.txt,"Well there is rust wallet gen crate , u could write that feat, maybe I'll look into that ,after some time yo My contract stores the address to the uniswap router and interacts with it… how can I test it in foundry? I can’t even launch the test script because my contract dies in the constructor when it tries to get the uniswap factory I don’t want to test uniswap stuff yet, I want to test my other funcs but I can’t even instantiate my contract unless I comment out all uniswap stuff you can fork from mainnet? or you can refactor your code to not depend on the mainnet unis router? or deploy a mock contract which implements the fn claled in the constructor? a lot of ways ty > Failed to get EIP-1559 fees seeing this in a script simulation on aurora testnet -- anyone know if I need to find a different rpc or set something up specially? know their gas system is .. funky seeing the same error on aurora mainnet If it’s a solidity version thing then use an interface for uniswap and instantiate it with the address when u fork I had to find an esoteric balancer branch once bc of that and they deleted it, it’s so precious to me Hi folks I've run forge init for a new project and when i ran forge test it keeps saying Solc Error: dyld: Symbol not found: __ZNSt3__113basic_filebufIcNS_11char_traitsIcEEEC1Ev nothing's worked so far - any clue? Did you rustup and foundryup? i mean i have a couple of other foundry dirs that are running just fine foundryup didn't help Hi I notice that in the docs - https://book.getfoundry.sh/forge/traces - that the test will automatically try to decode transactions. Is there a way to turn this off, so I can see the raw tx.data field in the traces? Does forge test --debug help? https://book.getfoundry.sh/forge/debugger Maybe z3 is missing from your system, here's how to install it on macOS: brew install z3 Yeah tried that. Didn’t work. Had to upgrade the entire OS Then it worked --debug didn't give me the information I was looking for.",473
1599,foundry-support.txt,"Was able to get it through forge test -vvvvv --gas-report and making sure I used an interface, rather than a smart contract deployed within the test what are these numbers inside [] I am guessing gas, but the numbers don't add up. Can someone explain 😅 Hi ! Is there a place to know what are the default accounts / addresses that are used by forge when running tests ? Are they the same as Anvil ? Thanks! Hey Frens! As you might have seen Optimism recently started nominations for the second round of Retroactive Public Goods Funding. It would be great to see Foundry nominated! Anybody can nominate projects, including projects themselves. https://gov.optimism.io/t/nominations-for-retropgf2/4636 Nominations close at 19:00 GMT on Jan 31st. For more information see the project manual with guidelines, FAQ etc. https://oplabs.notion.site/Optimism-RetroPGF-2-Project-Manual-0a2e741133cd49b0b005ff759934b998 Let me know if you have any questions, and sorry if this is the wrong channel 🙂 any startupp-y folks here ? flashbots is reverse pitching 🤯 , also are members of Foundry associated with paradigm in anyway ? that org seems to have fingers in many pies the owner of this chat is literally the CTO of Paradigm yes i know gakonst is CTO , but from what I understand , paradigm is some sort o f umbrella org with many division under different leaders, assuming that is That is not apart of the official WS specification but there is some variants that have this, look at sturdy websocket (nodejs) forge snapshot --no-match-path "".*.*"" --diff forge snapshot --no-match-path "".*.*"" forge test --rpc-url {{ MAINNET_RPC }} --match-path ""*.t.sol"" {{ commands }} forge test --match-path ""*.t.sol"" {{ commands }} its a fund that does some open source development, its not Weyland Yutani. Imagine a competent Consensys with General Partners They are defined in foundry.toml just run forge config you will see it there do not do this, bad way to install z3 for macOS.",463
1600,foundry-support.txt,"Solidity uses a specific version which may have breaking changes from the version you install on homebrew Should we submit here? Cc @msolomon4 who may have thoughts Yes submit as a comment to the post on the governance forum 👍 https://gov.optimism.io/t/nominations-for-retropgf2/4636 I'm noticing third parties nominating other projects too? I'm getting ready to submit a PR to add a feature, but when running cargo test --all --all-features I'm seeing these long running tests test executor::fork::backend::tests::can_read_write_cache has been running for over 60 seconds test executor::fork::backend::tests::shared_backend has been running for over 60 seconds Is this normal behavior and I should just let it run? For reference, I've only changed the cast/wallet/mod.rs file so not sure that'd conflict with these tests Yup, anybody can nominate a project. All the nominated projects will be asked to opt into the program and provide their own information I'm looking for good examples of this as well. Any good Foundry JSON examples out there? Do you know why Gas estimates differ comparing with Foundry vs Remix IDE? I have a mapping(uint => address[]) public myMapping that I want to query but doing cast call <contractAddress> ""myMapping(uint)(address[])"" yields a (code: -32000, message: execution reverted, data: None) error. Any solutions ? It works well for uint to uint mapping Also facing this issue, were you able to fix it? no. I just updated the files by hand from source. not ideal but ill deal with it again in the future later. The public getter for this mapping should be myMapping(uint,uint): first uint being the key, and the second one the array index If you want to have a getter for the full array, you would need to implement it yourself. Keep in mind this will cost tons of gas for large arrays, which is okayish for an off-chain getter, but a no-no if actually you want to use that on-chain how do you do that? did u try rm -rf <dir>/lib/forge-std/ && forge install foundry-rs/forge-std yea the issue is that ""lib/forge-std"" already exists in the index, you can update it using forge update.",485
1601,foundry-support.txt,"i dont know what this index is , what about just init another proj , move contracts , and run tests bit of annoyance to do that i can wait wait for... ? potential fix perhaps does cast wallet sign prepend args with the '\x19Ethereum Signed Message:\n32' prefix? having a lot of trouble getting cast and wagmi's signer hook to give me the same output, but from reading the wagmi source it doesn't look like wagmi's adding that prefix, so I'm wondering if that may be the cause of my issues nvm... had different wallets connected to wagmi and cast 😅 long day That was my issue Hey not sure if this is an appropriate ask, but is there anyone who’s down to pair program something simple-ish tonight? An on-chain game of bingo Not sure tbh. In general gas estimates are varying alot Hmmm wonder why, the opcodes are the same is using the same EVM fork. Hmmm did you try it with the same state? And same state changes All gas estimates which i did could be influenced by different states, so not sure about that.. but if the state is the same, mempool same & state changes the same Should result in same gas consumption ( +-21k) But i didnt check it so thoroughly. Just saw that in my cases it differs alot and added some % to address it Have been getting this error while trying to run a deployment script and verifying. Am I missing something? hello guys, i'm trying to use VScode plugin for working with storage (by Pranesh https://marketplace.visualstudio.com/items?itemName=PraneshASP.vscode-solidity-inspector&ssr=false#overview) but it doesn't work. Do you know any other solution to very quick view at storage layout with hints? (like at Pranesh). how to check calldata on foundry debugger? This one is working for me. Are you getting any error? yes bro but there are artifacts..error at any sol forge test -vvvvv? Hey all, what's the best way to have a different fuzz run amount on github as compared to local testruns? Adding 'runs=2000' under a [profile.local] with a FOUNDRY_PROFILE=local env doesn't do the trick Hello, everyone.",472
1602,foundry-support.txt,"I want to ask if the cast command can get the abi of the contract according to the contract address check cast interface thank you, sir The TOML syntax has been updated, you need to set fuzz = { runs: 2000 } now See how I do this in my Foundry template https://github.com/PaulRBerg/foundry-template/blob/adcec923c68ae25c01b81214ef2a35d78f00783c/foundry.toml ahhh great, thanks for that info & the example! there is no forge test --profile local anymore right, only works with env vars? I don't think there is a --profile flag anymore, no You'd have to write it as FOUNDRY_PROFILE=local forge test What you can do is add this to your .env or .envrc file, so that it gets loaded automatically when you are in your Foundry project directory I recommend using direnv for stuff like this https://direnv.net/ guys, can anyone help me with this issue? does anyone use this plugin? I don't suppose anyone else is experiencing this behaviour in Forge? https://github.com/foundry-rs/foundry/issues/4139 hey! Is there a way to write tests with rust ? Maybe like an example of the folder structure etc? check this maybe QQ, you used Forge as a Rust lib here, why? https://github.com/polytope-labs/solidity-merkle-trees/blob/main/tests/src/lib.rs following up here for posterity -- need to use --legacy yup, about 100-250 gas difference between foundry and remix. is there a way to manually set the acct nonce in forge scripts? actually ig i can just test this brb interesting -- it appears to..",367
1603,foundry-support.txt,"half work in the simulation? i am guessing this means it ~wouldn't work in the real broadcast but if anyone knows please hmu Yea how would you modify the nonce in prod You can't So it'll work locally but naturally won't in prod yeah i wasn't actually sure if it was possible to send a txn w a manual nonce makes sense if it isn't, can just do some small burner xfrs to get my address nonces to match appreciate the response your submodules mate Some RPC providers have an uncheckedTransaction Rpc method Taichi had this as an available RPC method before they shut down https://github.com/Taichi-Network/docs/blob/master/api_en.md#6-broadcast-tx--eth_senduncheckedtransaction :))))))))))) Hell yes my guy Hi! I created a new automate tool that can find vulnerabilities in smart contracts and I would like to introduce it to you all. Most people in the community are really liking it so I believe you all gonna like it ether It’s just the MVP(First version of the product), it’s really easy to use and very useful. You can use it as your best friend to make money on bug bounties as Immunefi & Code4rena or to protect your own smart contract Let me know your feedback Yes works fine for me Does my base repo foundry.toml override all imported library settings or does each get compiled with their own settings? Mostly thinking about compiler version and optimizer settings. It doesn't even override them - it completely ignores the Foundry config settings in the submodules Where does foundry install solc compilers? ~/.svm Hi guys ,does someone know to solve it on visualbox ubuntu ? Solve what? It looks like you installed foundryup successfully Thank u , i failed many times and not find out it's ok 🙏 Is this using Foundry? No, not for now.",381
1604,foundry-support.txt,"but this helps to make the web3 a safer space and against hackers Got it - no advertisements here then thx :) Ok, Didn’t know hey guys, how do i test a simple deposit() payable function? or rather, how do i pass msg.value deposit{value: amount}(); thanks a lot! also, if i have: simple contract{  bytes32 public constant Company_ROLE = keccak256(""Company_ROLE""); } how do i reach the Company_ROLE constant from the test? i tried contract.Company_Role but i receive the error: TypeError: Invalid type for argument in function call. Invalid implicit conversion from function () view external returns (bytes32) to bytes32 requested. try contract.Company_ROLE(); ugh, silly that i didn't think about it. Thanks for help! Btw a good convention to have for constant variables is to put them in all capital letters That’s good to hear that yous fixed the issue 😊 Hello. How I can upgrade my foundry to latest version? mac os foundryup first one https://docs.github.com/en/issues/tracking-your-work-with-issues/assigning-issues-and-pull-requests-to-other-github-users why i can't install foundry ? what i missing ? foundryup doesnt work for windows... its a bash script. Are you able to use WSL? Teslas r garbage Also Also on windows https://book.getfoundry.sh/getting-started/installation https://learn.microsoft.com/en-us/windows/wsl/install is there a way to check the trace of a ""cast send"" on anvil? I only saw the flag for ""cast run"" RUST_LOG=cast,trace cast send ....",344
1605,foundry-support.txt,"might give traces , alot of them would be traces of the program (not neccasrily evm traces) im not sure why, but everytime i try to deploy via foundry script, it adds 1 to the actual nonce, so i have to do a self transfer for the contract deployment to go through, i then figured out why, if u have vm.startBroadcast(); in setup() it adds +1 to nonce for some reason, but if u remove it from there and add it run() it then works lol, is that intended or a bug @gakonst Hello everyone! Have you ever experienced this on the script execution? ``` [24027] Example::run() ├─ [0] VM::envUint(""PRIVATE_KEY"") │ └─ ← 0x1111111111111 └─ ← 0x1111111111111 ( changed the number to publish it here, and this little arrow is red) Script failed. Gas used: 24027 == Return == Error: Script failed. ``` `forge script script/Example.s.sol:Example -vvvvvv` not sure if I can look for some logging with extra params are you sure the env var is actually defined, and is a valid uint256? if it's in a .env file it should be autoloaded, or you can do PRIVATE_KEY=<key> forge script .... hard to say otherwise without more details about the script code cast run gives you a trace if you have the tx hash even if the tx is only on anvil? cast run <txHash> --rpc-url <anvilUrl> @FreezyDev ^ thank you thank you for the answer! Here’s a gist … it’s pretty minimal https://gist.github.com/lucaslain/dc2bc058614f5db8cee4b28991fe62dc `forge 0.2.0 (f817db3 2022-08-16T00:04:34.401357Z)` can you try prefixing the private key with 0x? I think metamask gives the value without that prefix Same problem.",434
1606,foundry-support.txt,"forge is throwing error when using --use 0.8.0 error sending request for url (https://raw.githubusercontent.com/roynalnaruto/solc-builds/ff4ea8a7bbde4488428de69f2c40a7fc56184f5e/macosx/aarch64/list.json): error trying to connect: tcp connect error: Operation timed out (os error 60) Other people on my team don’t have the same problem. What else can it be? The empty error blows my mind are you on the latest version of foundry? `forge 0.2.0 (f817db3 2022-08-16T00:04:34.401357Z)` I just did foundryup ah this is very old, first try updating foundryup, then re-running it hmmmmmm curl -L https://foundry.paradigm.xyz | bash to update VERY OLD 1269 curl -L https://foundry.paradigm.xyz | bash 1270 foundryup 1271 forge --help still that version GREAT, don’t worry I think It might be path related … does which forge point to your home .foundry dir? it not, agreed it's path related YES! that was it … thanks @msolomon4 !! 🙏 there was a .local/ version that I had. Blew it up and reinstalled.",296
1607,foundry-support.txt,"Like a charm! awesome, glad you got it fixed! hello, sorry for bothering with my question, I'm pretty new with foundry I would like to know if you have any repository to carry out simple invariant tests Thank you If I understand correctly, what is needed https://github.com/lucas-manuel/invariant-example/#readme https://github.com/maple-labs/maple-core-v2/tree/main/tests/invariants Gm Trying to do a cast send If the function has msg.value Does it need to be sent in as a parameter? yes! thanks! i have been looking at the files and doing some tests and they are just what i want Nvm Found the book —value Why does checking owner append some arbitrary 00000 In local If I deploy via script with forge and —verify flag Verify not working What command are you running? What error are you getting? hello I'm trying to deploy from Trezor and am getting transport connect: Access denied (insufficient permissions) struggling to find any info on this error Forge verify-contract … I get response OK and the goerli url but when I check etherscan it doesn’t show verified. It is an NFT contract with 3 imports (from solmate and openzeppelin) If I just pass in the main contract to verify-contract is that enough for it to do it correctly given the imports Doing —watch I see now I get NOTOK please check if correct constructor Argus Nvm it was the abi encoding, used only encoder am good now Online abi encoder any chance of getting this D-easy issue progressed? https://github.com/foundry-rs/foundry/issues/2673 Being able to trace transactions before the fork block will be super helpful. https://github.com/foundry-rs/foundry/issues/2686 It would allow tools like tx2uml to trace transactions against a local fork node. This is not something Hardhat or Ganache support as their debug_traceTransaction does not support the tracer param.",409
1608,foundry-support.txt,"That's odd, can you please open an issue? hey all, I'm trying to call this function with cast `function getUserPoints(uint256 stream, address user) public view returns (uint256) { return pointsTotal[stream][user]; }` with this cast call cast call --rpc-url $GOERLI_RPC_URL --private-key $GOERLI_PRIVATE_KEY 0x104D7e73ba2CF955A813da67c37f5631aFc89619 ""getUserPoints()(uint256,address)"" 1 0xED1144847Ec1a08Fca702bDC4d6fb0a9c828F2d5 but keep getting this error (code: -32000, message: execution reverted, data: None) any ideas? ah, realize there is an extra () in the function call. solved following up, how would one accomplish a nested abi encoding in a cast call? ie. for function execute(bytes memory arguments) where (uint256 _stream, address _system, bytes memory _arguments) = abi.decode(arguments, (uint256, address, bytes)); and the bytes _arguments is further encoded Is there a way to override tx.origin using cheatcode ? ( similar to how prank overwrites msg.sender) The second argument in prank function is tx.origin Is there any command in Forge for listing out all public functions in a contract? this is useful for contracts with complex inheritance structures forge inspect <contract_name> methods What should I do if the stack trace is too long to read even after matching the specific test function? Awesome, thanks I got this error (code: -32000, message: execution reverted, data: None) when I tried to deploy a contract to Optimism Goerli using the forge create command. But the command worked for Goerli, Arb Goerli and Mumbai does anyone has an example of a repo with stdstorage reading structs? Consistently getting slot not found struct looks like this in the fuzzing config what does dictionary_weight = 40 do exactly? 40% of the time fuzz values will come from the dictionary, 60% of the time random values hi all, is there a way to make a query on a smart contract similar to the etherscan ""read contract"" functionality? I am trying cast call but I'm not sure if this is the right command I need.",487
1609,foundry-support.txt,"Thank you! yep cast call is what you're looking for! okay awesome ! I might be doing something wrong then, I'm not getting any output for my command - cast call --rpc-url=... 0x6c6Bc977E13Df9b0de53b251522280BB72383700 factory() is there a flag or some argument im missing? make sure to specify the return data you're expecting, so you should have ""factory()(address)"" (I think you'll need the quotes around the sig too) ahhh gotcha, that seemed to do the trick thank you!! has anyone been able to spin up an anvil node on perhaps a VPS for persistent chain tests? or are there repos i can look at? thanks in adv! what are you looking for? it works oh...i was actually looking for the best approach towards this maybe a container or just a straight up deployment looking for a repo that has this implemented so as to try it out first Hey, would this be considered a bug? forge fmt changed a style which I can't explain. please see the changes everywhere my code has now: before running forge fmt function approve(address /*owner*/, uint256 /*amount*/ ) after running 'forge fmt' function approve(address, /*owner*/ uint256 /*amount*/ ) Notice the comma is moved and it's not what we get used to. Hi, I changed the anvil gas limit (mainnet fork) to 100M but when I make an expensive call using cast, the limit still seems to be 30M (e.g if I cast call with --gas-limit at 50M, I still get the CallerGasLimitMoreThenBlock error) . How can I make a call with a higher limit ? Not sure if it's a bug yes, that’s a bug. pls open an issue I am facing this weird issue. The test cases won’t execute. In first image it only runs testIsNotPrime. But if I uncomment second test, TestCases dont run. In second image as well tests don’t run. It just compiles and stops. Am I missing something? Smells like an infinite loop Shouldn't it stop due to gas limit? depends on how much gas your loop is consuming I guess share the isPrime function if you want Yep. It was a infinite loop in some assembly code. :// Thanks a lot.",492
1610,foundry-support.txt,"i am having an error with forge init - forge init Error: This command requires clean working and staging areas, including no untracked files. Modify .gitignore and/or add/commit first, or add the --no-commit option. when i used --no-commit flag i get this error - fatal: pathspec '.gitmodules' did not match any files how to get rid of this error? Do you have unstaged files stash your changes and then hard reset i have blank folder new could you tell me plz how i can share my foundry project to my github repo don't want to screw up the modules, what files should i edit? I am getting the above error when sending any transaction to some forked chains. The following networks seem to have issues (from the ones I tried) - celo : anvil --fork-url https://rpc.ankr.com/celo - moonriver : anvil --fork-url https://moonriver.public.blastapi.io - moonbeam : anvil --fork-url https://moonbeam.public.blastapi.io - fuse : anvil --fork-url https://rpc.fuse.io (it needs the --legacy option in the cast command) Sample failing transaction:  cast send 0x70997970c51812dc3a010c7d01b50e0d17dc79c8 --value 1ether --rpc-url http://127.0.0.1:8545 --from 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 Am I missing something or should I open a bug report? please do, probably setting prevrandao incorrectly if not mainnet how to pass an enum when doing a test? simplecontract { enum blabla {one, two}; } and in foundry's test: simplecontract.blabla().one ? simpleContract.blabla(0) Or simpleContract.blabla.one any help???? Hello, I was wondering if I should expect to have the same values in my machine and in CI when using gas snapshots? I’m getting different values. It’s using mainnet forking, and I’m anchoring to a block number.",451
1611,foundry-support.txt,"consumed ""(gas: 214677)"" gas, expected ""(gas: 214679)"" gas it’s minimal consumed ""(gas: 1360201)"" gas, expected ""(gas: 1360203)"" gas etc Is there a way to check where the stack too deep error is? Does deal work with USDT or is there something obvious I'm missing? you will have to call your own mint function just mock a ERC20 will do Run test with -vvvv it fail on forge build AFAIK, there is no way to do this just start chopping local vars from whatever function if it's in the test, same vs the base contract and whittle it down that way. Wish there was a more precise way afaik there isn't tho Ah, wasn't aware deal used mint. I know USDT uses issue instead. Erms i mean have another function that deploys a ERC20 and give yourself some tokens anyway to spin up and manage anvil from node/js? Actually, it does work with USDT. Was a separate issue I was having. There is a repo that has this functionality From 0xTomoyo https://github.com/sambacha/anvil-persistence wat are you wanting to do simulate transactions against local fork git push-u origin master —recurse=check i know can do it via rust package, but wondering if anyone has written any wrapper packages or there is some way i can use it via wasm or something just run it via shell command execution in nodejs there is a hardhat plugin i think too git config --global status.submoduleSummary true git config --global fetch.recurseSubmodules true I want to migrate from hardhat, so I have deleted all the files except for ""contracts"", I have installed foundry using foundryup. What do I do next? I want to get all the boilerplate in my directory. Hi, I was wondering how to print the variable value in the assembly part by calling forge test -vv. What I am thinking I should do is from the above directly, above my hardhat project, with all files except ""contract"" deleted. forge init —no-git —force --vscode? I am using vscode. Oh and do it from inside the project folder, messed that up, but it seems to work. how do I trouble shoot getting openzeppelin contracts imported.",480
1612,foundry-support.txt,"I did forge install openzeppelin-contracts which got the package, I changed all the imports from ""@"" style to openzeppelin-contracts, but they still appear as broken imports. Does someone have a guide on configuring neovim to work with foundry? Ok, I fixed the openzeppelin issue, Tells how to do it here: https://book.getfoundry.sh/tutorials/solmate-nft?highlight=openzeppelin#compile--deploy-with-forge How can I exclude directories temporarily from being built using forge build hey guys, I have a question, are addresses 0x0 through 0x9 reserved for internal use? I noticed while testing something that calling transfer on some of these addresses either fail or show some unrelated function in the stack trace, e.g. payable(address(0x1)).transfer(0) fails with PRECOMPILE::ecrecover(), on address 0x1 with PRECOMPILE::ecmul() and even on the ones that pass, some unexpected function name shows up instead of going to the fallback anything above 0x9 works fine though couldn't find anything in the docs related to this reserved use They are precompiles and perform different operations. Address(1) is ecrecover You find them in any evm I believe nice, TIL 🙂 for future ref https://www.evm.codes/precompiled?fork=merge not directly a foundry problem but: what's the status on remappings.txt and solc? I see some history on this channel of people being able to use the solc --lsp in vim without those annoying ""source not found"" errors, but I've tried every combination possible (including harcoding those remappings such as solc --lsp ...",355
1613,foundry-support.txt,"@openzeppelin/=./lib/openzeppelin-contracts/contracts), and seems to have no effect I don’t think the solc LSP supports that yet? Or maybe it does But it’s generally giga vanilla yeah, for solc I found this, which was scratched last month: https://github.com/ethereum/solidity/issues/12603 but I also found this in this channel: anyone else using vim? how to i get the LSP to recognize the the remappings? which seems to be working after a few msgs in theory I should be able to plug the remappings as suggested here: https://docs.soliditylang.org/en/v0.8.17/path-resolution.html#allowed-paths but so far no luck might be solc bug? could be. manually running solc with those same remappings seems to work maybe it just doesn't consider them when adding --lsp. I'll try to check further Is it possible to do stateful fuzz testing? e.g. not have the state reset every fuzz? Hey! Launched a Foundry library for deploying and managing upgradeable contracts. We think it's great for developers who'd like to switch to Foundry, but want the support of a tool like OpenZeppelin's Upgrades plugin. https://github.com/chugsplash/chugsplash-foundry/blob/main/README.md I got a question, on a foundry project what is the best way to handle proxy migrtions ? like is there any library that is good and some exemple of projects that use it ? oh actually can be cool but like is there somone that use foudry-upgrades or OZ-Upgradeable-Foundry ? Not that I know of Or someone who use foundry and hardhat for proxies ? The only thing that annoys me with foundry right now is that the deployment if we wants to keep the address and make multiples calls to the same address is not simple.",397
1614,foundry-support.txt,"some more investigation: the only workaround I found for now was to not use remappings at all and just add include-paths = [""./lib""] to the lsp config, and using the raw paths from there the PR that would implement this (https://github.com/ethereum/solidity/pull/13423) on solc was closed by a PM for lack of time, but it seemed review & almost fully reviewed, which is frustrating not sure if @gakonst or anyone else is up-to-date on what is the overall official direction regarding remappings? if it would be worth it to attempt and dig that PR out and finish it? (is the nvim+solidity community that small? 😰) I've left the nvim community since discovering github co-pilot 🫡 well, I'm a happy copilot user on nvim as well 😅 Is anyone successfully checking gas in CI with “forge snapshot —check” and network forking? Diff in “Module::testBaseline()"": consumed ""(gas: 35199)"" gas, expected ""(gas: 35200)"" gas 1 GAS 🤏 what does vm as in vm.warp(endTime); means in foundry Is there any way to get the value of an immutable private variable in a solidity code from a test ? this could be a nice cheatcode, by reading the bytecode map from solc Yes you need to now the key if. Its a mapping not for immutable Otherwise just use getStorageAt and a index from 1 to 17 it's not in the storage per se it's in the bytecode Truee Immutables are replace by value at compile time yee True one So using the byte map we could read it using the same mechanism as getCode when you cargo test on the foundry-rs repo it takes 30mins , am i doing something wrong ? or is the time based on the system specs ? Nothing wrong .. I am assuming you have already built the package ? You can look at sccache to try to speed things up, but it’s pretty much down to specs It has to first run cargo build .. there is no way of by passing this Getting this error while testing invariants. > EvmError: RejectCallerWithCode Does this happen when Foundry fuzzes a msg.sender that is a contract? Yep it relates to EIP 3607.",485
1615,foundry-support.txt,"https://github.com/foundry-rs/foundry/issues/2963 Thanks, Pranesh What is the solution until this issue gets fixed? Exclude all known contracts with excludeSender? you can use targetSender similar to this: https://github.com/lucas-manuel/invariant-examples/blob/master/test/WrappedTests.t.sol#L76 excludeSender should work as well, haven't tried that yet Does targetSender act as an allowlist - Foundry will only fuzz using the targeted senders? Yeah looks like there's a 80% chance that the contract address will be chosen from the list Just tried excludeSender, didn't work. I guess that's because I didn't exclude the test contracts themselves - though it would be rather overkill to do that. I will stick with targetSender - which does work fine Interesting .. so EIP-3067-related reverts are still possible According to the spec, yes I think you can also use targetContracts() That's for something else (cherry-picking the contracts that get fuzzed) Where is this pic taken from? Checkout the ""Filtering"" section in this PR: https://github.com/foundry-rs/foundry/pull/1572 Oh yes..",252
1616,foundry-support.txt,"you're right ah that 80% is outdated, it was changed here https://github.com/foundry-rs/foundry/pull/3439, cc @PaulRBerg Thanks for chiming in to mention this - I edited my comment below (with my documentation requests): https://github.com/foundry-rs/book/pull/760#issuecomment-1400321536 trying to fix that here https://github.com/foundry-rs/foundry/pull/4174 how to uninstall foundry?? i want to fresh install it im getting the below error when i deploy, any ideas? versions ———— foundryup: installed - forge 0.2.0 (b83b316 2023-01-25T00:08:08.536376815Z) foundryup: installed - cast 0.2.0 (b83b316 2023-01-25T00:08:08.536376815Z) foundryup: installed - anvil 0.1.0 (b83b316 2023-01-25T00:08:32.829588811Z) script ———— forge script script/DeployAuth.s.sol:Deploy --rpc-url $RPC_URL -vvvv error ———— Error: Deserialization Error: expected value at line 1 column 1. Response: invalid project id forge init Error: This command requires clean working and staging areas, including no untracked files. Modify .gitignore and/or add/commit first, or add the --no-commit option. [22:12] having this error can anybody help me with this please my best guess is your API key is linked to an outdated project? im stuck for 2 days anyone???????????????????????????????????????????????????????????? Hey 🙂 Chill, it’s all going to work out.",391
1617,foundry-support.txt,"Did you read the error message? can you try after cleaning your git repo? what does git status print? should be empty can also try --force Try going up on directory, rm -rf your project, try forge init again, or try what Matt says git status prints this, i did rm -rf but still having the error uh, there's a lot going on here unsure what to recommend, safest would be to commit all your changes first, but I guess forge init --no-git --force should work as well, why a fersh directory showing this ?? your entire documents folder or whatever parent directory that is, is a git repo your best guess was 100% correct... respect due, thx so much What does foundry use as a default FOUNDRY_FUZZ_SEED? How can one make it dynamic to produce different results each time? a question concerning invariant testing. I need the msg.sender that calls the invariant tests in contract BatchDistributorInvariants is Test, InvariantTest {} to be the same as the msg.sender that calls all state-mutating functions in targetContract this is code snippet where it's needed: https://github.com/pcaversaccio/snekmate/blob/feat/fuzz-tests/test/utils/BatchDistributor.t.sol#L401 the reason is that I have to mint some tokens in the invariant test contract to the msg.sender to make the targetContract contracts work as intended (need to call approve) the invariant I'm testing is that no tokens are locked in a contract When I run ""forge test"" all source code files are compiled instead of only compiling the ones included in the test code i.e. *.t.sol files. Is there a way to avoid this? Ideally I would like to be able to run different tests that require different compiler versions against the same library (library is a subdirectory to the src directory) i think that $ forge test --match-contract $contract I tested this. Created a file (an interface) not used by any of my contracts and set a compiler requirement of >=0.8.0. I then tried to run my test with compiler 0.7.6. I get an error in compiling this interface. But the interface is not used anywhere (it's freshly created just for testing this)! To clarify, the problem is that unused parts of the src code are being compiled.",485
1618,foundry-support.txt,"I would perhaps expect such behavior when running 'forge' but not 'forge test'. I think it would be better if 'forge test' could limit the compilation to the chosen test dependencies. Hello guys I created an issue 5 days but I have no news how much time do we need to wait before having an answer ? Thanks a lot can you just use prank instead of relying on msg.sender? it also scales better to multiple users that way if not, you can add a single targetSender that matches the default msg.sender https://github.com/foundry-rs/forge-std/blob/0aa99eb8456693c015350c5e6c4f442ebe912f77/src/InvariantTest.sol#L54 default sender: https://github.com/foundry-rs/forge-std/blob/0aa99eb8456693c015350c5e6c4f442ebe912f77/src/Base.sol#L12-L13 I actually wanted to use prank but can't use it within the targetContract because I don't inherit from Test. Very interesting - I think that solves it you don't have to inherit from Test, just create a vm storage variable with the right interface inheriting from CommonBase is a one way to do this: https://github.com/foundry-rs/forge-std/blob/0aa99eb8456693c015350c5e6c4f442ebe912f77/src/Base.sol#L7 🤔 I remember that there was a more elegant way to do it - implemented something similar using dapptools.",331
1619,foundry-support.txt,"Let me try to find it Maybe it was targetSender - not sure whether it was available tho in dapptools a follow-up question @msolomon4 - my understanding is that ""Contracts that are deployed in the setUp function are automatically added to the set of target contracts."" -> so why do we add them here again https://github.com/maple-labs/revenue-distribution-token/blob/main/contracts/test/Invariants.t.sol#L47 and --match-contract and --match-test? for foundry projects integrating w uni v3 is best practice to just copy/paste necessary interfaces or helpers into our own files? (`forge install` on the uni v3 repo won't work bc it uses hh right?) is there a way to run forge fuzz tests in multiple cpu cores? the default is ""all contracts deployed in setUp are automatically added to the set of target contracts"". BUT if a targetContracts method is present on your contract forge will use the array returned by that method instead Foundry Support so in this example, by adding those 4 contracts with addTargetContract you're making the list of target contracts exclusively those 4 contracts nm this was stupid & can be solved w remappings was not immediately clear from here: https://github.com/foundry-rs/book/pull/760/files#diff-5f876c7464db48512b3601ce558f836e1d6136e067a36c5ac59069098518cce0R123 and I assume targetSender serves as a whitelist of msg.sender ah good to know, can you leave a comment about this confusion on that PR so lucas sees it? note that in that link (1) is exclusive, and (2) and (3) can be used in tandem yep exactly! thanks that clarifies a lot @gakonst @brockelmore spam ty Hey guys, I made a lib for interacting with Gnosis Safes in foundry tests. It abstracts away deployment, transaction signing, EIP1271 sigs, and more. Docs are WIP, but it should be ready to use in some basic tests.",437
1620,foundry-support.txt,"https://github.com/colinnielsen/safe-tools does anyone know how to decimal shift in ABDK64x64Math Did this help? Try Pauls Math Library I think he has an improved library for this @PaulRBerg PRB Math library https://github.com/PaulRBerg/prb-math Your within a git repo of a git repo my guy there is a git directory your inheriting from, possibly two directories outside your current directory The CI workflows are slow because @gakonst refuses to implement any fixes for PRs I open @PaulRBerg would love your feedback :) Anyone work with JSON serializing in Foundry? I think I might have found a bug when trying to create a JSON object with multiple entries at the same level. See gist for details: https://gist.github.com/joejordan/a944ba7558b24e0d2f0d7f79f7601fb8 Anyone know if it’s possible to use forge install to install a single package from a monorepo? is there a good way to decode custom errors in test traces? :( no you have to crawl the entire git tree Your alternative option is to use a service like this: https://gitpkg.vercel.app/ though you will have to use pkg manager like npm Ok, thanks for the tip! does this compile? Hi team, I was wondering if there are options to run some of the foundry tests (particularly coverage) and set the number of threads to execute on. I've got 16 cores and I can see that typically one of them will light up to 100% usage for the 30 seconds it takes to generate a coverage report. If possible I'd like to distribute the workload a bit Haven't tried it out yet Thanks for the shill, @sambacha. @refod, PRBMath is tested with Foundry, which means you can see at a glance how to use all functions. ABDKMath, by contrast, does not have any open-source tests.",415
1621,foundry-support.txt,"Separately, I would argue PRBMath is more intuitive than ABDKMath, since I use base-10 numbers and 18 decimals, just like 1 ETH = 10^18 wei decimal shifting is difficult in ABDK because it uses binary numbers, whereas decimals are base-10 Awesome work, I will share with my colleague who handles our periphery contracts build foundry with the rustflags RUSTFLAGS=""-C target-cpu=native"" cargo build --release --bins --locked --target x86_64-unknown-linux-gnu i think thats all you need to do for the rust compiler to leverage your chipset though i dont know rust to be able to tell you if foundry leverages it ymmv alternatively use foundryup —branch master this will build foundry locally with those same flags That new banner is hideous my god Is there a utility function to do console.log in assembly? 🤔 Oh actually logging is just a function call internally, nice beautiful, thanks Anyone have an answer to this? Try catch and log the message    catch Error(string memory reason) {     console2.log(reason);    } Ah this only logs the final error. The custom error I encountered was nested. Can you share the trace? it's a large trace but here's the error (the catch statement just logged Transaction reverted silently Outside of further context not sure im afraid Hey, is there anyway to speed up forge script 's simulation? I've been stuck at ""## Setting up (1) EVMs."" for a while and I can see anvil is getting hit with a bunch of eth_getStorageAt requests, but it looks to be one at a time. If I skip the simulation the transactions revert on anvil. Thanks! Can you try nexttest? It's what we use on CI to go a bit faster. The first time without cache is going to be slow. If it reverts on Anvil then we should error on the sim? Yeah, surprisingly it doesn't. I wonder if some state is changing on the sim that's not happening when I skip it. But it's weird, with --skip-simulation it reverts on the 2nd tx, when I do the sim it takes a long time to setup the EVM but then it works Yes, it should.",472
1622,foundry-support.txt,"Not sure if I've overlooked something as there are no examples with more than two JSON entries at the same level, but the logic *feels* sound. What’s up? Can I use foundry to build a new evm? And integrate this evm with ZK to revolutionary the web3 space trying to use vm.createSelectFork and getting the following error The application panicked (crashed). Message: called `Option::unwrap()` on a `None` value Location: /home/runner/.cargo/registry/src/github.com-1ecc6299db9ec823/revm-2.3.1/src/journaled_state.rs:548 What's the max number of fuzz_runs allowed? u64::MAX i think? but you won’t really get much from going that high I think Can you open an issue with a repro case? Yes, and it is cast sig Is there an easy way to see what storage is being requested with all of the eth_getStorageAt calls forge is making to anvil? Any kind of request logging on either side? Thanks! If not I can of course just recompile with some logs but wondering if there is a quick flag RUST_LOG=ethers=trace Thank you! Okay, it's doing a bunch of storage checks at the address of where my contract will be deployed, before it's deployed. Is there any good reason for forge to do it aside from if my contract was a mutable CREATE2/selfdestruct contract? Or anyway to get the connection between forge and anvil faster? Seems forge doesn't support IPC yet. In my tests this script runs very quickly on forge's local evm fork Hello. Can I convert solidity code to yul, using foundry? or maybe other tool You can use forge inspect Is there a way to import different libraries depending on the compiler version? Like a C++-preprocessor macro? Or something similar. In particular I want to try compiling my contract with solidity v7 and with v8 to evaluate which compiler version is more gas efficient. But when I compile with v8, I want it to use a different version of a library (with an identical interface) so that the code is gas efficient (solidity 8 needs manual 'unchecked' statements). Right now 'forge test' just compiles everything, even libraries that are not imported in any of my tests (but are in the source directory).",491
1623,foundry-support.txt,"The v8 libraries can't be compiled with the v7 compiler due to the unchecked statements... Where could I find docs on what the 4th argument of vm.expectEmit does? bingo: https://book.getfoundry.sh/cheatcodes/expect-emit The only workaround I can think of is to only specify a subset of my contracts as the 'src' directory and use different profiles with different compiler versions and different 'src' directories. forge —version? For a test that takes arguments (for eg, testgetSum(uint256 a, uint256 b ) , how does one run a test with the arguments included ? I'm running forge test, but it only runs test without the arguments (for eg, getSomething()) Pro tip - you might want to add an underscore between test and getSum (test_getSum) to comply with the Foundry best practices. There will soon be a linter that will check for this test function name format, and this is useful for filtering functions when generating gas snapshots Now, regarding your question - you will need to provide more details. Forge should always run your test function with fuzzed args Consider using named args to improve readability: https://twitter.com/PaulRBerg/status/1613498076702072832 — Is there any way to bias the functions that get called during invariant testing? I would like one particular function to get called more often than the others function testLiquidity( uint256 strike, address to, Timestamps calldata time, //snip ) public {} that's how the function looks. @PaulRBerg Looks good to me, it should be fuzzed. I suggest you use console2 to debug: import ""forge-std/console2.sol console2.log(""strike"", strike); console2.log(""to"", to); And use the --match-test flag to run only this test forge t --mt testLiquidity And also -vvvv to see the console logs. Thanks. I'm trying to test a function that takes a message and a signature and verifies that the signature for that message came from an approved address. I'm having a hard time figuring out how to do this in the test contract. it requires producing a signature on chain, which I'm not sure is possible.",461
1624,foundry-support.txt,"Any clues/cheatcodes I could employ? try this https://book.getfoundry.sh/cheatcodes/sign Is it possible deploy bytecode in foundry? use CREATE through an inline assembly does vm.sign do any preprocessing to the digest? No, it just takes the hash and returns the signature. This test is failing, which is telling me that there is an additional transformation happening in vm.sign unless I'm missing something: ``` function testIsVerifiedData() public { bytes memory message = ""this is a test""; bytes32 hash = keccak256(message); (uint8 v, bytes32 r, bytes32 s) = vm.sign(1, hash); assertTrue(ecrecover(hash, v, r, s) == address(1)); } ``` But in vm.sign privateKey, in assert you should check == vm.addr(1) instead of address(1) Look at example here Ah of course, test is now passing. Thank you! one idea is, if using the handler pattern, you can create multiple versions of the function that all delegate to, e.g. add1(x,y) and add2(x,y) both call add(x,y) thanks for the reccomendation but I figured it out. you can use ABDKMath64x64.muli or mulu to interact with regular 256 ints here's a blog post: https://mikhail-vladimirov.medium.com/the-author-of-the-library-is-here-regarding-2%E2%81%B6%E2%81%B4-limitation-72060d7c760 can I call a foundry script inside of a foundry script? for example I have base-deploy.s.sol and that trigger part-a.s.sol, part-b.s.sol, and part-c.s.sol ? so i ran into some weird issue testing with the wrapper contract. i am using foundry to debug but it's not helping that much.",391
1625,foundry-support.txt,"I tried cast run —debug 0xhash It works but i see that ""unknown contract"" you know how i can force it to use a local contract source? there is an issue that best describes what i'm looking for https://github.com/foundry-rs/foundry/issues/1723 is there a way to use a local contract source code or fetch it from an explorer other than etherscan since this is on another chain? I think you should be able to import and run code from there, yes, that's also how you test scripts, did you try and did it fail? You can just inherit from the parent script and call super.run() or Parent.run() Not sure if this addresses your need but you can deploy an artifact from the out folder with the deployCode cheat https://book.getfoundry.sh/reference/forge-std/deployCode Thanks, this is an interesting idea I ended up doing something else, though - instantiate some struct instances in the constructor, and others via handler functions, so that I get invariant test coverage over many instances, but I also cover the creation of the said instances could you expand a bit? not sure I totally follow / see how the structs fit in It's related to my custom business logic. The point is - most of the protocol functions need certain struct entities to be created before they can be executed But there are also creation functions that instantiate structs, so I want to get the best of both worlds - invariant test all protocol functions, while also making random calls to the create functions. Hello, I just started playing around with foundry and I'm already loving it. There is just one thing that I can't get my head around, structs, arrays and mappings are working differently in tests than in my actual contracts... First I need to use ( ) instead of [ ] for indexes and second I cant get values from a struct[] array. I'm doing struct(id).whatIneedToRead but it doesn't seem to work...",403
1626,foundry-support.txt,"I'm using 0.7.5 btw, is it about the solidity version? I guess I should find the >0.8.0 libraries and update it? Thanks Is there any explorations done for how foundry could potentially work for evm with precompiles ? this came up in at least one issue but can't remember and unable to find it rn generally, I'd but happy to add support for network specific precompiles, however the main work is getting all of them. If you want additional precompiles baked in for a specific network, please open an issue with a list of address+code+reference where they're documented got it, thank you Any good example repos that use a lot of the testing features. All the ones I have found only use a few features. I did updated solidity to 0.8.17 but the tests still behave in the same way... to access the members of a struct[] i need to treat them as tuple and do (,,,,,address name) = struct(id) to get the sixth member of the struct at the index position... also still need to pass indexes with () and not [] with arrays, mappings and such... is this normal behavior or did I mess up something in the project? thank you I know that structs are treated as tuples in ABI but I guessed it would work the same way in tests as it works in normal contracts Indeed, the compiler in vscode doesn't see the problem, it just come up when I forge build and say I can't access the type members etc when calling an array variable from another contract use (), because the scope public for the variable creates a getter that takes as an argument the index of the array you want to get It's the same with mapping, the argument is the key you want to get the data from Can we somehow mimic a reorg in anvil? what are u trying to do ? Testing some infra stuff.",390
1627,foundry-support.txt,"Modify .gitignore and/or add/commit first, or add the --no-commit option.' i mean foundry project Add the —no-commit flag This error has been occurring frequently lately. May I ask you what was confusing about the message and how we can improve it to make it more helpful? I'm new to git, and i'm working from a folder that doesn't have .gitignore in it. Do git status If it shows untracked files The error you get makes sense And you should do --no-commit thank you!!! this is exactly what I was looking for 🙂 Hi, I know this is not the right group for this question, but I really like the forge tool, do you know of any rust programming guide that follows more or less these lines? Is there a way to console.log addresses from a live deployment? So far, it seems to only log the addresses stored when it runs the script in its internal VM, resulting in console.log values which != those of actual deployment now I'm just gonna try from linux, I'm getting 'ZOE ERROR (from forge): zoeOpenFile failed to open file (hello_foundry) ZOE library version 2013-02-16' when trying to forge init hello_foundry this should be mentioned in the book somewhere, but this is actually not foundry forge, this is different bin that's also called forge, check which forge /usr/bin/forge ye that’s the wrong location likely resulting from not using foundryup to install. in general should be in ~/.foundry just rm /usr/bin/forge since it has priority over ~/.foundry The right solution is to make your foundry path take precedence in your PATH Over usr bin yeah sorry just new to paths and bins and linux. So im not sure what any of that means. But I got it to work by typing /home/jporporino/.bashrc after curl -L https://foundry.paradigm.xyz | bash trying to use openzeppelin contracts I've added remappings = [""ds-test/=lib/ds-test/src/"", ""@openzeppelin/=lib/openzeppelin-contracts/""] to foundry.toml fixed by making remappings.txt Hi, is it possible to either 1. Save the output of a call to a variable to then use in a cast convert? 2. Or make a call and a cast convert with one command on cli e.g.",492
1628,foundry-support.txt,"cast call <contract addr> ""function(uint256)"" 1 && cast --to-ascii I can't find the answer in here btw, Im using this as I do my little project but couldn't find a reference for concatenating commands, for want of a better word You can do: cast --to-hex $(cast block-number) So is it possible to do cast --to-ascii $(cast call <contract addr> ""function(uint256)"" 1) YES!!!!!! Thanks, this is brilliant, I didn't think that would be a thing, appreciate the quick response Asked ChatGPT because thought that using pipes | would be working but no Hehehe nice one, I didn't think of that 😂 I've got it on one of my tabs too haha Is there a way to specify the number of fuzz runs to use in your tests? Changing from the default 256 yea it's the --fuzz-runs cli arg Or in your toml `error: unexpected argument '--fuzz-runs' found note: argument '--fuzz-seed' exists` on forge test or something else? ok nvm [fuzz] runs = 256 in your foundry.toml Would be awesome to be able to specify as an arg tho Hi, could someone confirm to me the expected behavior of block.timestamp and block.number when using createFork() with a transaction hash? I'm getting a weird test failure because a contract I call into has a timestamp that's in the future from the block.timestamp, which shouldn't be possible The transaction in question executed in block 38652490, which has a timestamp of 1674968832. However, the block.number and block.timestamp are those of 38652489 My test succeeds when i set the timestamp with the warp cheatcode, but it looks to me like this is probably a bug since the contract i'm calling into only ever uses the current block.timestamp to set it's last executed timestamp Hi, am trying to run invariant tests on a contract deployed behind a proxy. Wondering what the best approach is when it comes to restricting which functions to call. I don't want to ""waste"" calls on getters and view functions so I'd ideally like to pass the selectors for all the state-changing functions only on my contract.",467
1629,foundry-support.txt,"I've been calling targetSelector(FuzzSelector(myContract, myContractSelectors)); but if I try doing that on the proxy, foundry tells me that the proxy doesn't have the selectors. I've attempted: 1. Target Contract == Proxy, Target Selectors == Implementation 2. Target Contract == Implementation, Target Selectors == Implementation 3. Target Contract == Proxy, Target Selectors == Proxy 1 gives me spurious results that I think are incorrect 2 works, but is not an accurate representation of my final contract architecture 3. doesn't work Wondering if anyone has any examples they can share? hello there, I got this weird error uh, the good ol' source maps @gakonst as u were saying, we desperately need a rewrite of the debugger ahah so i suppose here for me there is no solution than patience right ahah? cast bn | cast th after this: https://github.com/foundry-rs/foundry/pull/4229 getting a strange error that occurs sometimes in fuzz tests with fuzzed addresses that receive ETH.",221
1630,foundry-support.txt,"It looks like the fuzz test populated the console address? is this expected? the address is 0x000000000000000000636F6e736F6c652e6c6f67, which doesn't seem to be anywhere in the docs, not sure if this is what's actually happening that address is the console.log address, forge-std has an assumePayable method which it sounds like will help your use case ah, made the address payable in the param but sounds like I need assumePayable on top of that you can find a list of known forge addresses here too: https://github.com/foundry-rs/forge-std/blob/master/src/Base.sol assumePayable doesn't seem to be a method, maybe it got renamed? if you update forge-std it should be there, was included in the v1.3.0 release https://github.com/foundry-rs/forge-std/releases/tag/v1.3.0 I'm on the latest nightly maybe hidden bc it's an internal method? update the forge-std submodule 🙂 Oh look good! ah, found it, need raw assumePayable() instead of vm.assumePayable() ah yea exactly, it's a helper from forge-std and not a native cheatcode thanks! hi! is there any way to accept user input from within a Solidity script? I've been trying out vm.ffi but can't really get it to work. there are env* cheatcodes if your input is sufficiently small.",312
1631,foundry-support.txt,"otherwise, there are readFile & parseJson cheatcodes Hello foundry is available on bsc network? Yes, sure does anyone know how to console.log an uint like 1000000 (1 million) as 1_000_000 or an easily readable version of a large number hi is there a programmatic way to log state changes for all the states(slots) in the contract? Im thinking to insert log statements inside the IR, but can't seem to find a way to get foundry to use my customized IR 10e12 depending on the length of the number a million 1e6 im working with large numbers, multiplying and dividing by 1e18, seeing 100000000 is so similar to 1000000000, i need it just for console logs You want to log large values in a readable version? Not sure if foundry logs will allow you to do that, they usually just display full length number. Any docs on how forking mode works under the hood? Convert to a string, then you can write some logic to put ""_"" every 3 chars You want to log all slots at once? or only when failing log all slots at once; it's for a tool to inspect how the contract changes state ideally for every function call in the contract (my alternative seems to be adding a modifier to each function) does foundry have any utility to get a function signature from a sol file? cast? oh yeah i will look into that, thank you https://t.me/foundry_support/31041 Try this that was perfect, tysm How would I go about using nodejs with foundry in vscode. I tried creating the package dot Json and adding devDependencies then npm install however the node-modules folder didn't appear. I'm trying to follow a tut to develop a very simple dApp, however they are using truffle instead. Why would you use NodeJs with Foundry since Foundry is in Rust ? I'm following a tut, the nodejs is for the app code.",412
1632,foundry-support.txt,"I also do not know rust https://book.getfoundry.sh/config/hardhat?highlight=Hardhat#instructions Try this I actually thought that a minute ago, was just reading through that setup, it may just work, thanks Looks like just run npm init :) Yeh I did that but it didn't make the folder, but I'll have a read through and try some stuff Oh okay, maybe it was just delayed as now I see the damn folder hahahaa! False alarm then, thanks for responding both of you anyway Anyone run into this when deploying to an anvil forked node?  Error: failed due to PrevrandaoNotSet Trying to deploy a contract to a local forked Moonbeam node using anvil --fork-url https://moonbeam.blastapi.io/<api_key> eth_sendRawTransaction  Transaction: 0xd76504b4c53e2f0051c26f106469a0d47d1807fb3cc865aab50f064e017991cc  Gas used: 0  Error: failed due to PrevrandaoNotSet  Block Number: 2844721  Block Hash: 0x98f3806dff433e5c3d38550262854e0763980f3fa32bb0287356ff228df44964  Block Time: ""Tue, 31 Jan 2023 00:30:23 +0000"" Using the latest nightly builds: foundryup: installed - forge 0.2.0 (31f945c 2023-01-30T00:05:12.356073Z) foundryup: installed - cast 0.2.0 (31f945c 2023-01-30T00:05:12.356073Z) foundryup: installed - anvil 0.1.0 (31f945c 2023-01-30T00:05:13.098127Z) created an issue Can you change the gas token of your local anvil network? It would be whatever the native token the forked network is I'm running into some issues using the --match-contract flag in the latest version of foundry.",461
1633,foundry-support.txt,"In previous version, the command with the filename would work, in the current version, I just get this error even when I pass the correct contract name: `No tests match the provided pattern: match-contract: `UnitTestMarketGovernance`` Version is 31f945c, freshly updated today. Is there a concept of ""tree shaking"" in foundry? For example I have 2 dependencies instaleld with ""foge install"" and they both happen to have a shared dependency that is showing up in both deps. e.g. both have ""ds-value"" here Nope it doesn’t do that (dont think any framework does it) hrmm okay so my issue is Compiler run failed script/BaseDeploy.s.sol:7:1: DeclarationError: Identifier already declared. import ""geb-tx-manager/TxManager.sol""; ^------------------------------------^ lib/ds-value/lib/ds-thing/src/thing.sol:23:1: The previous declaration is here: contract DSMath { ^ (Relevant source part starts here and spans across multiple lines). that is saying that TxManager is importing something that has already been imported? is there anyway to alias one. seems these two have a common dependency import ""ds-value/value.sol""; import ""geb-tx-manager/TxManager.sol""; this is in a forge script fwiw I have an idea! Or use explicit imports i.e.",283
1634,foundry-support.txt,"`import { Foo } from ‘Bar.sol' or you could just not import ds-value/value.sol and just use it in your script since TxManager already imports it This error isn’t related to tree shaking, it’s just solidity imports being a PITA it's not in the general context of the script I need to explitly import it form the TxManager lib directory? What imports do you ahve in your script? import ""forge-std/Script.sol""; import ""ds-compare/compare.sol""; import ""ds-value/value.sol""; import ""geb-tx-manager/TxManager.sol""; import ""geb-deploy/GovActions.sol""; Yea remove the 3rd line, the error is syaing the TxManager.sol already imports that (and you get that for free, since you’re importing the whole fiel), so you dont need to reimport it again alternatively you can keep it and do import { TxManager } from “geb-tx-manager/TxManager.sol” okay so remove the line and I get script/BaseDeploy.s.sol:28:9: DeclarationError: Identifier not found or not unique.   DSValue coinOracle = new DSValue(); okay that makes sense Yea so do what I said here then Compiler run failed script/BaseDeploy.s.sol:8:27: ParserError: Expected import path. import { TxManager } from “geb-tx-manager/TxManager.sol”;       ^ I didn't know you can destructure in solidity think I might need to do remappings Hi guys does anyone ever meet this error when trying to verify contract:Failed to deserialize response: expected value at line 1 column 1 res=""Page not found"" Is there a RPC URL for the anvil spawned during forge test for using with ethers FFI? 👋 Hi!. Maybe someone can help with a question I can't find an answer to: Trying to verify an already deployed contract here. The constructor takes custom types, e.g. one IERC20 and one of a locally defined token. But I cast abi-encode these types with cast without running into an error.",429
1635,foundry-support.txt,"forge verify-contract --constructor-args $(cast abi-encode ""f(IERC20)"" <an address>) <contract address> ERC20Wrapper The call to cast fails with this error message: Error: UnrecognisedToken 2:8 `IERC20` The IERC20 type definition is in the repo and I can import it in solidity, but maybe I don't know how to tell cast where to look. Any advise on what to try? IERC20 is an internal type which would be encoded as address So even though I defined the constructor as expecting IERC20 in the solidity file, I should encode the argument as address here? So even though I defined the constructor as expecting IERC20 in the solidity file, I should encode the argument as address here? yes, cast doesn’t know what IERC20 is I have tried that already. The cast call yields a result, but forge verify-contract still fails. I might have another mistake somewhere. Thank you for helping me! I find it easier to pass constructor args to verify as an arguments.txt file delimted by space Will try that, too. Thanks! Guys how to compile only contract inside a project directly into bytecode? multiples times everytime i finishing to using cast to get the bytecode etc but would like to have a better way using forge build If you know it feel free to share have a good week 😉 There is a call_override option in the [invariant] section of the Foundry config, which is documented like this in the Foundry Book: > Allows overriding an unsafe external call when running invariant tests. eg. reentrancy checks. I am not quite sure what it means to ""override"" in this context.",346
1636,foundry-support.txt,"Does anyone know? forge inspect is your friend Ohh forgot thanks! Will keep it for the next time ahah my invariant tests are not failing on revert even after including fail_on_revert = true in my foundry.toml: [profile.default] src = 'src' out = 'out' libs = ['lib'] no_match_path = ""*/integration/*"" ffi = true fs_permissions = [{ access = ""read-write"", path = "".forge-snapshots/""}] optimizer_runs = 1000000 fail_on_revert = true [profile.integration] no_match_path = """" match_path = ""*/integration/*"" [profile.lite.optimizer_details.yulDetails] stackAllocation = true optimizerSteps = 'xca' fail_on_revert needs to be under the [invariant] section, you have it under [profile.default] gracias! that worked what that option does IIRC is: when your contract has an untrusted external call, it will sometimes (don't recall how often) just replace that call with another random call into your contract, basically simulating if an attacker had full control of that external call and decided to reenter (@joshiedo can you verify this is correct?) Yeah that's correct! In the foundry test suite there's a reentrancy example Stdout is messy tho Submitted a bug report for the forking issue i had a while back https://github.com/foundry-rs/foundry/issues/4236 yo do yall know if we can call functions on a sc after we deploy it like you can do in hardhat and if so.... does anyone have an example of that like an example deploy script that does that i haven't found any example of this yet online its not constructor arguments, its calling functions in a programatic way right after the sc gets deployed Hey would like to have your opinion, if there is a way to fork an call private and internal functions/variables? Can be cool sometimes for incident analysis etc to get some value direct throught the function result with the state of the storage at a given time. Hoy, is there any possibility to emit log of an entire structure ? you would have to write a deployer contract that bundles these transactions together if you want / need them to be atomic Is there any cheatcode to call internal / private functions ? No as of now .. you can create harness contracts and expose the internal methods to test them Right I did that, thanks.",496
1637,foundry-support.txt,"Good evening guys, how can I fix this error, can you help? I have a f() that has an onlyOwner modifier. in the modifier i added a console.log for msg.sender and owner vm.prank(address(contractOne)); onlyOwner 0x34A1D3fff3958843C43aD80F30b94c510645C316 0xFa0a90784A1A77e41115BA22dc17B1c409a8665B vm.startPrank(address(contractOne)); onlyOwner 0xFa0a90784A1A77e41115BA22dc17B1c409a8665B 0xFa0a90784A1A77e41115BA22dc17B1c409a8665B can anyone explain why the msg.sender is different in the two cases? I am trying to simulate a tx on an anvil fork of Mainnet and then get the logs of this tx. Everything seems to work but the logs Array is empty. I tried eth_getLogs and also eth_getTransactionReceipt Are the logs not intended to be generated by the anvil fork? Or is there another way to access them? Hi! Is there any example repo/project implementing merkleTrees generation (used for an airdrop p.e) from a JSON in foundry? I'm thinking in how to implement it but dont know which way is better...I mean: a. Using parseJson and https://github.com/dmfxyz/murky (the problem here is iterating after parsing JSON isnt trivial) b. Using ffi and having JS script (I'd prefer not needing npm packages but would be mandatory here) Either works, I pref murky Did some debugging. Seems like the txs fail with status 0x0 instead of 0x1 even though I replay the exact same tx as on Mainnet But am I right that it should work? Thanks for confirming Could you link to this example? vm.prank is only valid for one statement. A good example of what this can lead to is console.log(contract.owner(), contact.sender()); If you used vm.prank only the call to owner would be affected by the prank and the call to sender would be not ""pranked"" Vm.prnkStart is in effect until you do a prankStop, so both calls would be covered...",486
1638,foundry-support.txt,"Is there a way to do performance tests and benchmarking with Foundry? There used to be a tool called https://github.com/Giulio2002/bsol Where you able to find a resolution to this issue? I'm having into the same issue. Running forge test returns that no tests were found even though there are hundreds of tests in the repo. This issue started after updating foundry. I then uninstalled and rolled back to the latest stable version 5c2db0b, and tests still will not run. Deleted all cached files, recompiled all 220 files, tests still will not run for a specific contract or the whole project. searching through the support chat, both errors No tests found in project! Forge looks for functions that starts with `test`. and No tests match the provided pattern: match-contract: `UnitTestMarketGovernance` never seemed to have resolutions. Tests are still working as usual on CI. I deleted the entire wsl2 and pulled my repo again, it worked afterwards I'm on a mac and I don't want to format my system. I deleted and reinstalled foundry from commit hash a44159a and everything is working smoothly now can I push blocks on a standalone Anvil instance? Good to know, thanks so much for your reply. https://github.com/foundry-rs/foundry/blob/master/testdata/fuzz/invariant/common/InvariantReentrancy.t.sol Only works with the flag on Another example on what it can detect (assuming the MockToken is untrusted): https://github.com/Rari-Capital/solmate/blob/fb582d2edfc4ec42981cb371c6692a25dd54b98d/src/test/ERC20.t.sol#L491-L524 Hello, I have a problem, I set the interval mining behavior, which is required,evm_setIntervalMining, and then I send a number of transactions within this interval, and I want to get the results of these transactions, and I have to wait until the specified mining interval is available; Can I get the return result of the transaction before the interval mining block, i.e.",441
1639,foundry-support.txt,"immediately after sending the transaction, rather than waiting for the interval mining block to complete; how to run test cases of the specific folder? Is there a way in foundry to only make a script runnable on a certain network? Let's say i have a deploy script dedicated for polygon and want to prevent ppl from accidentally running on mainnet. Hey guys. Anyone succesfully running foundry docker on macos? I'm trying to create an image which imports foundry base image, starts up anvil and deploy a couple of contracts. But the issue I'm facing is before deploying the contract via script, foundry does a compilation (i.e forge build) and for some reason its eating up a lot of ram and the process eventually gets killed with 137 exit code The wierd part is, it doesn't fails all the time. 1/5 times it gets compiled succesfully and everything works as intended guys how to run tests which are in exactly folder? or, for example, exactly *.t.sol ? forge test --match-path test/folder1/herearemytests/ does not work, it still trying to compile .sol at /src at the beginning of your script you can put require(block.chainid == 137, ""polygon only"") I am unsure how to read the gas-report. Some of the gas numbers are really low. I have one function that stores a value in storage, but the gas report says it only uses 5315 gas. What am I missing? Hi everyone, I have a function that I would like to test that takes in a struct which has a calldata payload field, and I’m not quite sure what the idiomatic way of setting up my test environment. Problem is similar to this: https://ethereum.stackexchange.com/questions/133355/how-to-test-a-function-that-has-calldata-parameters-using-foundry Would love to know what the most common pattern is for this kind of situation.",392
1640,foundry-support.txt,"Also the payloads is being generated in ether rs does logging not work for fuzzing tests that revert ? Hi everyone, would there be a reason why a contract deployedBytecode in the `/out`folder would be different than the on-chain bytecode (for the same contract)? Is there a difference in compilation between test and script files? (Maybe something to be set up in the founfry.toml) Thank you What is the point of the `rpc_endpoints' in the foundry.toml? It seems that I can access that in a script/test but I can't find anything useful to do with it. I can't change the RPC that I'm using from a script, it's not an alias that I can use in --rpc-url. So what is the point? Also how do you handle larger deployments? Doing anything more complex than simply deploying contract with script is a miserable process. You can create forks in scripts https://github.com/ethereum/solidity/releases/tag/v0.8.18 I am forking anvil from mainnet, and trying to call get_block from web3.py. When I call it for a given block number that is present on mainnet, I get Block with id: '0xfac7da' not found. Anyone know why there is a discrepency between this working on mainnet but not on the forked network? Does anyone know where the solc used interanlly by forge is stored? Also trying to call the contract from web3.py, and getting 'Could not transact with/call contract function, is contract deployed correctly and chain synced?' Figured it out. Nvm With foundry can fork-minnet ICON Network? if it’s evm compatible ya I’m able to succesfully run tests, but am getting this error when trying to run the debugger… Has anyone seen this before? forge test --debug ""testFlow()"" [⠒] Compiling...",396
1641,foundry-support.txt,"No files changed, compilation skipped Error: cannot install provided Shell, a shell has already been installed running on a mac m1, and here’s my forge version: forge --version forge 0.2.0 (cd7850b 2023-02-01T00:04:58.420758Z) I write code with solidity but contract writed by java its possible to fork? do you mean the client is written in java? Hey guys, anyone know of a foundry repo where they are writing dao code? Want to have a look and see how some of the tests are write? Maker DAO has some l1 to L2 governance stuff that might be written in foundry IIRC Can you use stdstore in a script? Need to modify a variable in an external contract running on forked environment/Anvil, but don't have permissions with the given address running script. Sweet ill check it. Thanks you'll need to use anvil RPC methods like anvil_setStorageAt to modify it's state, cheatcodes/stdstore only can modify the forge VM so when deploying a contract with forge create I dont need to abi-encode but when verifying I do ? Is there anyway to get source mappings from on chain contracts into the foundry debugger this would be huge, it make it really difficult sometimes not being able to see inside what a deployed contract is doing when debugging your own https://github.com/foundry-rs/foundry/issues/4246 Yes Hey guys , can i use foundry & hardhat in a single one project ? since previously we are using hardhat , but want to use foundry for testing as well as other stuff is this possible ? Yes how can i do that , sir ? https://book.getfoundry.sh/config/hardhat?highlight=hardhat#integrating-with-hardhat thanks. on it anyone knows what is ganache ntk ? googled it but nothing useful In this case you can use it just for the solidity contracts. The client languages does not matter. However there be dragons.. some things migth not work if they arent implemented properly on ICON e.g.",435
1642,foundry-support.txt,"EIP 1559/ Type 2 transactions, Or the clients doesnt follow the RPC spec properly Does someone know how to select solidity version in chisel ? i guess my friend just means ganache , don't know what is ntk network? ohh that's it , i am not native english speaker thought it was some toolkits before Hey there, is there a way to plug foundry tests with the chisel framework somehow to be able to evaluate arbitrary solidity statement (like being able to test private functions) ? Thanks ! I have the same error on ubuntu. Did you fix it ? You need to install GLIB check the readme No search results for 'glib'. Apologies this is an issue with Ubuntu version IIRC. Ctrl + f in the chat for resolutions I fixed the ""cannot install provided Shell, a shell has already been installed"" error by running foundryup -C 31f945 Something is wrong in the nightly build nightly-5c2db0babf02e1f1016b1471de3b21593cb06b56 Is there a way to set the verbosity on Anvil? I'd like to see events that are emitted get logged, is that possible? Thank you for the workaround ❤️ Thank you so much! This helped me!! Hi. Just got foundry to reinstall to latest after my first install a month ago. Disk requirements ballooned.",286
1643,foundry-support.txt,"Is there any downside to removing the 7.1G of seemingly intermediate files left here in this dir? Like are they only useful for quick rebuilds via foundryup, maybe? > .foundry/foundry-rs/foundry/target/release/deps/ For fuzz testing , anyone has used etheno ? the case is after i successfully pip3 installed etheno , the output when i ran etheno is command not found anyone has idea for this ? the link : https://github.com/crytic/etheno yep, you don't have python's bin in your $PATH What OS are you on? macos , sir ls ~/.local/bin guess i should check it is ethno there? yep add python's bin to my path variable next ? but python is working , i guess it is not the matter ? u know foundry does this right ? https://book.getfoundry.sh/forge/fuzz-testing#fuzz-testing yep ,but echidna has it own advandges so i use both ohh got it running , by manully run the setup.py guess the readme should changed then Hey everyone, maybe dumb question - is it possible to see console.log output in anvil? If I have console.log in my contracts, it is possible to see it when running, e.g. forge test. However, if I run those on anvil and interact with them externally, is it possible to see these logs somehow? In the anvil logs through a flag? Perhaps some other output file I am not aware of? Thank you hey @gakonst ur last invariant stream didnt get recorded on twitch , maybe its not like youtube with a default record of all streams ,fyi Looks like someone else also asked the same question: https://t.me/foundry_support/20829 . However, looks like at the time (august 2022) the `console.log`in anvil was not implemented. I did not find any issues mentioning this on github. I see this commit in a pull request that supposedly adds the feature to anvil: https://github.com/foundry-rs/foundry/pull/2786/files. However I do not see any console log activity. Are there any flags that I am missing? hacky way - https://i.imgur.com/KWp06Sh.mp4 Maybe I'm misunderstanding - I see that you are looking at anvil's logs.",497
1644,foundry-support.txt,"My issue is seeing the output of `console.log()`statements in smart contracts that are running in anvil if that makes sense What about just capturing the output with , forge test -vvvvv ? Hey, facing an issue on foundry for solidity 0.8.18 (my glibc is not 2.32). Foundry is using the previous binarries that were only compatible with glibc2.32+. Eventually this just landed: https://twitter.com/solidity_lang/status/1621226794371239941?t=nJyXX1XeabFbm_bNOxtThw&s=19, any chance to have it in foundry ? Thanks I'm not running forge test . I am deploying some contracts that have been compiled by forge on anvil. Interacting with them over RPC on anvil. Those smart contracts have console.log statements in them. Would be great to see the output of that on anvil cast calldata 'constructor(bytes)' 0x returns this error: UnrecognisedToken 0:11 constructor -- when I search for this error here, I see a reference to this PR: https://github.com/foundry-rs/foundry/issues/2176, however, cast calldata _should_ include the function selector. Is this a bug? is there a way to broadcast transactions to multiple chains from one script? yeah vm.selectFork how do I make forge consume gas on transactions in tests? e.g. vm.prank(addy) foo.bar() should deduct the gas cost of the transaction from addy I'm testing a function which is dependent on block.basefee and the gas cost of the transaction but the although I set the basefee using vm.fee(100 gwei), it doesn't consume the sender's balance.",367
1645,foundry-support.txt,"alternatively, is there's a more appropriate method for testing this, I'm all ears anybody knows why solmate's safeTransferLib checks for if the returndatasize is greater than 31 bytes? It's already checking for if the returndatasize is 0 so I'm trying to understand the value of this additional check Gm fam, did I dream that forge had formal verification test support - similar to the fuzzing ones? Can't find it mentioned here: https://book.getfoundry.sh/ it's the same like this https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/utils/SafeERC20.sol#L90-L93 but instead length > 0 just checking length > 31 but in solmate's they are ALREADY checking for length >0 so why the additional check for length > 31 ? right found it is not documented yet, any ETA? whenever someone is kind enough to submit a PR for it 😉 No, they check length == 0 OR length > 31. And if > 31, they check that the return value is true. yeah of course, I meant if anyone from the team is planning to work on it okay understood. So the checking of > 31 bytes, is it to guard against other types other than bool being returned? e.g. an uint8 with a value 1 being returned No, just checking non-standard tokens such as USDT, which do not return any value, the ERC20 standard should return a bool, which takes 32 bytes I'm asking in the context of comparing to solady's impl, which also checks if the returndatasize is 0, but solady doesn't check if the returndatasize is more than 31 bytes https://github.com/Vectorized/solady/blob/7143fa2d068537c8a2692c9612f7a1c67cb0e185/src/utils/SafeTransferLib.sol#L162 How do I use the new pauseGasMetering and resumegGasMetering are they available in the most recent version of forge-std already? yes they are in the newest forge-std, just call vm.pauseGasMetering() and vm.resumeGasMetering(), or use the noGasMetering modifier in forge-std.",484
1646,foundry-support.txt,"Token here is just an OZ ERC20 f script contracts/script/LZSandbox.sol:DeployTokenTwice --broadcast --keystores mekeystore --password `mepassword` --sender `meaddress` --rpc-url $MAIN_RPC if I do it without --rpc-url in the command, nothing happens if I rearrange vm.selectFork to start with the one I passed in for --rpc-url then the first token successfully appears in the trace but then optimism fails just like above Anyone know how to pause/delay between blocks when executing a script? all of this is on forge 0.2.0 (152e200 2022-09-13T00:16:06.130512Z) anvil 0.1.0 (152e200 2022-09-13T00:16:05.904894Z) definitely need to foundryup, which should fix your issues ye that’s an extremely old version you can use --slow, which waits for a tx to be mined before broadcasting the next one thanks, my issue is that the transaction fails on the first block because block.number is 0 and I get an underflow revert, need to either set a starting block time, or mine a block in the script before the function call. setting --block-time to anything, even 1s means my script takes ~35s to run which is not ideal thanks working great now can you share more context? not sure what chain this is running against (anvil?) or why the default block number is causing underflow (also I thought the default block number is 1, not 0, so maybe you need to update foundry?) anvil, yes. I have a PRNG that uses block.number - 1 so if anvil started at block 1 instead of 0 it would fix your issue? I think it should start at 1 anyway since that's what forge test does, cc @mattsse c it's possible it happens somehwere else, but there's no indepth stack trace but the same script succeeds when i set anvil --block-time 1 Is it possible to develop an app in foundry that uses html, JS, anvil for the local blockchain with webjs to connect. I'm following a tutorial by dApp university who uses truffle, nodejs and lite-server.",486
1647,foundry-support.txt,"I've got a out 60% through but I'm now stuck as it seems I can't get the web3.eth.accoints[0] to work in my app.js file. When I deploy on the local blockchain with the lite-server running my html page, I'm getting undefined. I thought it may work, so I just want to clarify, if you can't, then I'll complete the tut using truffle and move on. I'd like to do it with foundry since I enjoy the framework especially the testing and scripting in Solidity is good practice for me Has anyone ever tried to Mock a ERC20 token? I’m getting strange issues due to using SafeERC20, which does some funky address(token).functionCall behavior that i think is screwing up the mock. hmmm wonder if i can mock out functions from the SafeERC20 library ok that’s a strange rabbithole will instead just instantiate a ERC20 token in my tester instead of mocking everything how do I generate bytes[] calldata? try after wrapping it in quotes: ""[0x...]"" doesn't work cast calldata ""multicall(bytes[])"" ""[0xffffffff,0xaaaaaaaa]"" ah get it after comma no spaces 😅 thanks! Hii where can I learn foundry from start . Is there any video tutorial which is useful YouTube Is there any way to ignore certain revert strings or error codes when running tests with Forge? I am fuzzing USDC transfers on a mainnet fork, and I am occasionally bumping into this error: > Blacklistable: account is blacklisted not sure though those are for the compiler i would just wrap it in a try tbh Yeah, bad choice of words on my part, i was referring to user-defined custom errors, not compiler error codes Sounds good thx 😅It was under forge test section, so I thought Installed foundry on a fresh environment and tried running cast 4byte ""myFunctionSig()"" Got the error: cast:17: maximum nested function level reached; increase FUNCNEST? Seen this before? use cast sig ""myFunctionSig()"" instead 4byte are needed to get the function name from selector yeah, same error on cast sig as well would anyone know what's the etherJS equivalent in Go? trying to do some abi.encoding and decoding.",472
1648,foundry-support.txt,"thanks! hello, I have a simple script that deploy a contract and trying to verify it using the following command: forge script script/AccessController.t.sol --rpc-url $GOERLI_RPC_URL --broadcast --verify -vvvv but the verification doesn't run my .env file looks like: PRIVATE_KEY= INFURA_KEY= GOERLI_RPC_URL= ETHERSCAN_KEY= and my foundry.toml has this: [rpc_endpoints] goerli = ""${GOERLI_RPC_URL}"" [etherscan] mainnet = { key = ""${ETHERSCAN_KEY}"" } goerli = {key = ""${ETHERSCAN_KEY}"" } hey! how can I do if I want to get full traces of a transaction but its so big that i cant scroll up further in terminal? can i like export the traces Does anything look obviously wrong with these simple invariant tests? They revert with ""EvmError:OutOfFund"", even with fail_on_revert = false https://gist.github.com/horsefacts/a850f07bbfad39b94a1904c35884339a I guess that's a low level, fatal revm error, rather than a real revert, isn't it? If I wrap deposit in a try/catch it works fine:  function deposit(uint256 amount) public {   try weth.deposit{value: amount}() {} catch {}  } what is the difference between rollup and warp when using a fork RPC *rollfork @elawbek so you do have any thoughts on this? is there a good way to console.log (or some alternative?) while doing invariant testing? I think solmate is safer because if the call returns nothing and there is something in memory slot 0, solady will pass the call Checking for returndatasize is safer Is there a way to dump the transaction opcode shown in debug console? how do I get around this? Use solidity version that matches your solc compiler.",401
1649,foundry-support.txt,"It shows you that you have a contract set with 0.5.0 and another with 0.8.0 it’s not a foundry issue this also happens when I try to run other tests which has nothing to do with this 😅 Any ideas why this returns Invalid Data cast call 0x0c6e14a548F14C8B3926eDd8B478f9EbD478eFD7 ""validatorCount(uint32)(uint256)"" --rpc-url $RPC_URL --private-key $PRIVATE_KEY --legacy I am trying to call this function  /**  * @notice Returns the number of validators enrolled in the validator set.  * @param _domain The remote domain of the validator set.  * @return The number of validators enrolled in the validator set.  */  function validatorCount(uint32 _domain) public view returns (uint256) {   return validatorSet[_domain].length();  } 1. You don't need to provide a priv key for calling a view function in general, nor for cast call 2. You need to supply uint32 _domain argument. This should do the trick for domain == 1: cast call --rpc-url $RPC_URL 0x0c6e14a548F14C8B3926eDd8B478f9EbD478eFD7 ""validatorCount(uint32)(uint256)"" 1 Hi ! About Fuzzing : I was wondering if it was possible to direct the fuzzer towards using certain values in it's random input generation. For example I would like the fuzzer to at least try a couple of addresses that I pick myself alongside other random input values when at least one address is present as function parameter. Is that possible in any way ? Thanks ! This fails once amount > 120_000_000 ether, as this is the depositor balance. You might want to trigger weth.deposit only if amount <= ETH_SUPPLY Hey ! Any plan to allow vm.expectRevert to work for non-directly-succeeding calls ? I have a bunch of uses case where at some point I expect an external call to fail, deep within my transaction, but I can't use vm.expectRevert because it is only expecting the very next call to fail. I end up with a lot of testFail tests which is kind of bad as it might fail but for an unexpected reason.",496
1650,foundry-support.txt,"Look and see if roll or warp will help you.. hmm, yes—but if fail_on_revert = false in config I'd expect those reverts to be ignored Does anyone have an example of a repo using the diamond standard with foundry only? I only know of hardhat+foundry repos We are but no ready to open source yet. Please share any if you find Oh.. There are tons 1 sec https://github.com/aavegotchi/aavegotchi-gbm-baazaar/tree/ff6828047f1da2a2c22e8e0c4420b6d46706dd43 We temp removed support for it but you can check the past versions thank you ser, but was this pure foundry? Yes... All tests and deployment scripts were in foundry... You might find some hh there tho Thanks a lot 🙏 You can use this for your diamonds too https://github.com/Timidan/Foundry-Hardhat-Diamonds Hey, I made a quick repo example here with only foundry: https://github.com/xenoliss/foundry-diamond-deploy. I kind of improved the script since then but it's a decent example I guess Thanks a lot ! Nice mous Hello everyone Is build to abi support obsolete? The json files produces by foundry are not recognized by abigen to produce bindings. how do I make forge consume gas on transactions in tests? e.g. vm.prank(addy) foo.bar() should deduct the gas cost of the transaction from addy I'm testing a function which is dependent on block.basefee and the gas cost of the transaction but the although I set the basefee using vm.fee(100 gwei), it doesn't consume the sender's balance. alternatively, is there's a more appropriate method for testing this, I'm all ears for anyone that might use invariant tests: the contract is not anymore called InvariantTest but StdInvariant.",399
1651,foundry-support.txt,"https://github.com/foundry-rs/forge-std/commit/b4f121555729b3afb3c5ffccb62ff4b6e2818fd3 hi guys i've just installed foundry, how to fix this in vscode @dimasriat https://book.getfoundry.sh/config/vscode thanks! @rkrasiuk : hi, I'm working on this (just a simple NFT contract) https://goerli.etherscan.io/address/0xb5281858ef371dc751a0a25ae19d1c4abc3c77b5#code (I deployed on Goerli because my address on Polygon was drained before I could deploy any contract on Polygon) Not sure if it can help you to detect the cause hey @Oxh8h, is the project you've been interacting with public? we'd need more context to look into it I was following Brock's foundry videos, and i had a test with the code // setUp() mockERC20.mint(address(this), 1000e18); flashloaner.depositTokens(100); // fuzz test vm.assume(amount <= mockERC20.totalSupply()); vm.assume(amount != 0); // ... flashloaner.depositTokens(amount); i changed the fuzz test into this: // fuzz test amount = bound(amount, 1, mockERC20.totalSupply()); and that is failing, but this works: // fuzz test amount = bound(amount, 1, mockERC20.totalSupply() - 100); so why exactly doesn't fuzzer consider the 100 diff when using just assume? am i missing something? Not sure I follow.. IIRC, forge bind generates rust bindings via abigen was more interested in the project settings. i see you've been using the same private key on goerli, did you use it on any other non-testnet network and have funds been drained there? what do you mean by ""project settings""? did you use it on any other non-testnet network and have funds been drained there not before yesterday.",431
1652,foundry-support.txt,"But I also think that my private key was exploited before (I only use this address to deploy on testnets, yesterday is the first time that I used it to deploy on 1 of the mainnets - Polygon) I'm just surprised that the fund of that address was not drained before yesterday (I actually had some swap txs before yesterday, don't know why the hacker did not drain my address at that time). Maybe the hacker has a script that detects when my address is attemp to deploy a contract FYI on mainnet basefee min is 700 cant go lower than that also base fee is constrained by the previous blocks basefee its limited to how much lower pr higher it can go its not able to be arbitrarily set at least in production environment not sure if testing respects that (i would think it should) dynamic analysis tools like fuzzers cannot produce an arbitrary complex value for fuzzing without some assistance/hand holding but whats the diff bw vm.assume and bound thats causing this behaviour? both are used to assist the fuzzer, right? and arguably in the same way? how do we mock a send ether, not using vm.deal()? by project settings i meant file permissions, whether ffi is enabled and any dependencies that might (ab)use those also, i see that address activated 4d ago, maybe it just waited for some action taken by the user in order to drain the address any chance u stored your dev key in lastpass? that might explain things a bit oh yeah, maybe this is the reason. My dev key is stored in Lastpass a long time ago (I switched to Bitwarden for 2 or 3 years) and I totally forgot about Lastpass for now this is the only reasonable explanation i’ve got, will keep your issue in mind if we receive any similar reports thanks a lot Hi again! Anyone can chime in on this ? By reading the various github issues on the subject I can see that this is being discussed by the devs. Is there a way to manipulate the fuzzing dictionary for example in the TOML file. Thanks for the help. I'm getting this error running cast wallet sign --private-key $PRIV_KEY ""hello"" error: the following required arguments were not provided: <MESSAGE> Usage: cast wallet sign --private-key <RAW_PRIVATE_KEY> <MESSAGE> I've defined the PRIV_KEY on the .env file.",487
1653,foundry-support.txt,"Any idea what am I doing wrong? try this ``` cast wallet sign ""hello"" --private-key $PRIV_KEY ``` just tried it and it worked cast wallet sign ""hello"" --private-key $PRIVATE_KEY Signature: 0x8523d62ddfa85fb261ad8db6473e850e4fc507bb2c8b0c72a89108b94cf3e023721967c96bc10dd9eca6d5be54d25aba803a2911983e652dadae6f488e1641641b Didn't work for me: error: a value is required for '--private-key <RAW_PRIVATE_KEY>' but none was supplied ah your private key is in an env file? have you sourced it i.e. . .env ? or export PRIV_KEY=0xfoo Hello! When using ffi to run an arbitrary script in shell I can return the output of the script to my solidity file right? Do I need to return something on script? Or do I need to print the result to terminal? How can I pass the output of script to my solidity file? yes, they're in the .env file. should i store it somewhere else? if yes, in what file? (it worked with ""source .env"", thanks) inside my Lib imports there are some files that gets compiled how can I exclude them from solc compilation? this is unreleased (will be part of an upcoming v1.4.0 release) so currently this change shouldn't anyone unless intentionally following the laster master instead of the default approach of using the latest tags well if you use the foundry CI it will pull it but yes this is unreleased and I was affected because I wanted to use the latest master code hmm wdym? the submodules should be pinned to a tag when you forge install foundry-rs/forge-std just wanted to give a heads-up my bad yea makes sense, just wanted to clarify / make sure there was no bugs or anything I checked out the latest master branch in the ci config that's why When using anvil with --fork, it will update fork every 45seconds, right? nope it will pin on a block is there a way to attach an existing deployed contract address to an instance of it in a forge test ? (.attach with ethersjs) To avoid the constructor part and easily get data in storage with objects in the contract.",500
1654,foundry-support.txt,"ContractName contractName = ContractName(address); How to test single test file? Looks like a script that tries to place multiple transactions on multiple chains, moving from one chain to another, again placing transactions after switching back to a chain, doesn't amount to all the transactions being assigned the correct nonces and it all fails --match-path fp thanks What is the environment variable for this? Error: You seem to be using Foundry's default sender. Be sure to set your own --sender. No associated wallet for addresses: {0x1804c8ab1f12e6bbf3894d4083f33e07309d1f38}. Unlocked wallets: [0xa600adf7cb84750482a828792849ee026446aa66] I have ETH_FROM set but that is not working hey guys, noob question from who are just starting with foundry: - after deploy a contract using anvil, how do I get the ABI to use on my dapp? the command I'm using to deploy is: forge script script/MyScript.s.sol:MyScript --fork-url http://localhost:8545 --private-key=0x0 --broadcast --verify https://forum.openzeppelin.com/t/using-automatic-analysis-tools-with-makerdao-contracts/1021 Hello, I have a solidity script and I would like to submit a proposal to execute a batch of txs to gnosis safe. Does anyone have any experience with this? One simple way would be to produce a JSON file which could be imported in the transaction builder web UI but I wonder whether there are already some Solidity utilitites for that. Thank you I think someone was working on this with a cli flag? Anyone aware? I'm just thinking a nice API for this would be if the address in vm.broadcast is a safe, we push the tx to the Gnosis API and queue it there. I'd be happy to build this out does anyone have a good way of compiling contracts within the same foundry project with diff compiler versions? Thanks Sam but I'm not sure I understand how this relates to Foundry and forge fuzzer hey quick question does startPrank() only set msg.sender and tx.origin only for external calls? I'm testing an internal library thingy Read the entire thread, fuzzers gonna fuzz.",475
1655,foundry-support.txt,"you have to spoon feed a fuzzer sometimes pragma ^0.6 | ^0.7 | ^0.8; then either create a specific toml config for ur wanted version and point foundry to that or use cli args In the walkthrough they explain how adjusting the testing contracts for providing an input echinda can better utilize uncovers the invariant as opposed to using the function as is implemented in the contract they are testing yeah I see what you mean now ... I had a similar approach in mind by creating a specific ""proxy"" test function that accepts the randomized params from the fuzzer and replace the address param with my own set of inputs before calling the real test function ... but I thought that was a bit hacky clunky ... was just hoping that foundry had that built in already . Thanks anyways! hey Sam, I wasn’t asking how to change the basefee, I know how to do that already. I was asking how to get the sender of the transaction to consume gas for the cost of the transaction. When I tested it, account balances in forge don’t decrease when sending transactions. hey solidity frens , i just saw someone's code using array[].pop without bracket () followed it , it is legal ? echidna has proper support for foundry fwiw now what do you mean by *transaction* https://github.com/simpledefi/SimpleDefiDiamond I swear it escapes me, and I may have done this before, but is there a way to abi-decode raw encoded params with cast? i.e get direct access to abi.decode(data, (Struct)) with no function selector cast --abi-decode -i '(address, address, bytes)' '0000000000000000000000000000000000085d4...... I guess I can do cast --abi-decode 'bleh()(address,address,bytes)' '0000000000000000000000000000000000085d4....' so like in my example above.",401
1656,foundry-support.txt,"In a test case, when I run vm.prank(Target_Address); foo.bar(); I expect Target_Address to have their balance deducted by the gas cost to call foo.bar(); Does that make sense? want to ask dumb question: if alice call FooContract.someMethod() and FooContract.someMethod() call FooContract.anotherSomeMethod() — is the msg.sender still alice in FooContract.anotherSomeMethod()? try passing --private-key ${YOUR_PRIVATE_KEY} to the CLI Hi guys, a question: - I have a contract deployed at Goerli - I do not have the code verified at etherscan (I don't want to do it yet) - I need to debug some stuff - I wrote a test case to reproduce the issue So I run: forge test -vvvvv --fork-url <rpc url> --fork-block-number <block number> --debug ""myTestFunction"" That's alright, I can debug and I can see the test source file, but within the test I am calling the contract I actually need to debug (it is actually a library) and when I reach that point in the debugger, obviously I cannot see the source code Isn't there any way to tell the debugger something like: ""ok, the address <0x...> source code is at contracts/XXX.sol ? Thanks! I don’t want to pass anything.",277
1657,foundry-support.txt,"This may be the result of installing 'forge' using another method, like Cargo or other package managers. You may need to run 'rm ' or move '/Users/philogy/.foundry/bin' in your 'PATH' to allow the newly installed version to take precedence! ./.foundry/bin/foundryup: line 139: /Users/philogy/.foundry/bin/cast: No such file or directory foundryup: installed - foundryup: warning: There are multiple binaries with the name 'cast' present in your 'PATH'. This may be the result of installing 'cast' using another method, like Cargo or other package managers. You may need to run 'rm ' or move '/Users/philogy/.foundry/bin' in your 'PATH' to allow the newly installed version to take precedence! ./.foundry/bin/foundryup: line 139: /Users/philogy/.foundry/bin/anvil: No such file or directory foundryup: installed - foundryup: warning: There are multiple binaries with the name 'anvil' present in your 'PATH'. This may be the result of installing 'anvil' using another method, like Cargo or other package managers. You may need to run 'rm ' or move '/Users/philogy/.foundry/bin' in your 'PATH' to allow the newly installed version to take precedence! ./.foundry/bin/foundryup: line 139: /Users/philogy/.foundry/bin/chisel: No such file or directory foundryup: installed - foundryup: warning: There are multiple binaries with the name 'chisel' present in your 'PATH'. This may be the result of installing 'chisel' using another method, like Cargo or other package managers.",364
1658,foundry-support.txt,"You may need to run 'rm ' or move '/Users/philogy/.foundry/bin' in your 'PATH' to allow the newly installed version to take precedence! foundryup: done ``` Note that I tried running it with and without having the main foundry folder in my PATH Direnv will load your env dotfile into your current she’ll automatically ffs try source ~/.bashrc or sourcing bash_profile if that does not work reinstall foundryup Don't have a ~/.bashrc, zsh was the default, also I already tried reinstalling foundryup, running it while the directly is both in and not in my PATH Sourcing my .zshrc after reinstalling foundryup also didn't change the error does echidna with forge support allows to start form forked state ? Looks like I found the culprit, the most recent nightly build is somehow duplicated and doesn't have a build for the Apple M-Series CPUs? Looks like latest M1 release failed due to some server error triggered new release, should be available in 30mins Sorry about that If anyone knows how to auto open an issue when this happens, I’d appreciate a PR 🙏 How can I set the starting block number with anvil? and it's not a fork —block-number @gakonst any idea about this one? Thanks :) This should be auto-detected as of late. What’s your version? git:(feat/foundry) ✗ anvil --block-number 100 error: unexpected argument '--block-number' found 0.2.0, had to rollback because of this issue: https://github.com/foundry-rs/foundry/issues/4253 0.2.0 - 31f945c I guess it checks the bytecode right? can I force the autodetection somehow? otherwise I can wait for that fix, update and try again @gakonst --block-number doesn't exist.",396
1659,foundry-support.txt,"How would one manually mine a block in script using --no-mining? this is fixed on latest foundryup right thx ot sure that there’s a bug even, so i would open an issue with a repro and exactly the things that are not working OK I think I did modifications so if forge is looking for bytecodes in my workspace that match with the runtime bytecode of the contract I'm debugging, it won't find any so yeah I need to double check that first Is it possible to see the events emitted in the anvil logs? i need it too at the moment I am checking the logs with cast run tx Question related to forge-std: How come the default flag for adjust when calling deal() is false? Shouldn't the totalSupply be adjusted by default: https://github.com/foundry-rs/forge-std/blob/master/src/StdCheats.sol?#L549 there's arguments to both defaults, you can see them discussed here + in the linked comment there https://github.com/foundry-rs/forge-std/pull/258 Hey guys, new to foundry and just wondering do ppl use 'forge script ...' or 'forge create ...' for deployments? I started going down the path of using 'forge script ...' and then just found 'forge create' but cant see the value or difference in that approch and am not too sure what I am missing? with forge script you can do multiple actions running one command yeah you can program your workflow right, and doesnt look like you can do that with 'create'? but create has some verification stuff Script has too. There is talk about deprecating forge create .. it predates script and not sure anyone still uses it ah ok thats great context. I continues as I am any advice on using Slither in a repo that's set up for use with both Foundry + Hardhat? seems like Slither defaults to using the HH compilation pipeline as long as there's a hardhat config file in the repo for anyone interested, I resolved by adding ""compile_force_framework"": ""foundry"" to my slither config file.",432
1660,foundry-support.txt,"the relevant flag is a crytic-compile option: https://github.com/crytic/crytic-compile/wiki/Configuration#general-compilation-options Forgive me if this is a dumb question, but can you use cast to deploy and interact with mainnet contracts or just anvil contracts I think just anvil I’m new too I think cast is a function symbol specifically installed into the local environment and it works only with anvil, correct me if I’m wrong And thus it’s just trying to find the process and memory stack of the specific local environment @gakonst closed my PR that addressed this issue awhile ago it’s entirely self contained cast does not need anvil to work so long as you have an RPC endpoint that you can connect to We dont use script at all Oh so just to be super clear, you can point to a mainnet or any rpc, that’s awesome yup, make sure you setup shell completion too will make using cast easier Is there a way to convert hardhat project to foundry https://book.getfoundry.sh/config/hardhat what wrong with it? just trying to deploy uni factory using deployCode. Do you know what is it? are fork-url and rpc-url alias? hello guys. I don't know why I'm not able to use vm.deriveKey. I'm always getting a generic ""Invalid Data"" error hey, is there a changelog or sth for foundry on can follow to keep up with changes? Seems over the last week all our foundry projects started breaking because of some internal change on remapping - not sure if this was an intended change or not. Seems like foundry no longer has some sort of ""default remapping"", so projects without remappings.txt started failing. Hi , when I did my initial setup and did install forge-std lib too , then why it is not able to detect/read forge-std/Test.sol file,as you can see in screenshot? try with forge remappings what do you mean? is it a command? Do I need to install forge-std again? yes, sorry, it's a command.",430
1661,foundry-support.txt,"Try this forge remappings > remappings.txt So , I need to delete that forge-std folder and from command line run the following command: "" forge remappings forge-std "" ? no, you just need to run the command ok it should create a txt file like this: forge-std/=lib/forge-std/src/ yes error is gone !! Thanks!! 🎉 Hey guys does any one have idea on how to call a function with specific address in foundry Precompile contracts? Yes While testing a particular function https://docs.klaytn.foundation/content/smart-contract/precompiled-contracts Is it possible with foundry to simulate execution of different blocks within the same test? you can use vm.prank(<address>) and the msg.sender of the next call is going to be the specified address https://book.getfoundry.sh/cheatcodes/prank or you can use hoax if you want to ensure that the given address has funds https://book.getfoundry.sh/reference/forge-std/hoax Thanks mate Is there any chance makeAddr() and makeAddrAndKey() (functions from StdCheats) can be renamed into makeAddress() and makeAddressAndKey()? They seem out of place compared to how verbose the other function names in forge-std are: https://github.com/foundry-rs/forge-std/blob/master/src/StdCheats.sol#L402-L412 Hi, I tried to verify contracts that has been (all) deployed with via-ir == true, via forge verify-contract …. And one of them can not be verified Fail - Unable to verify. Compiled contract deployment bytecode does NOT match the transaction deployment bytecode., while neither the code nor the compiler version changed. Anyone encountered that? https://book.getfoundry.sh/cheatcodes/roll I think that my problem is about selfdestruct not being supported by foundry If I want to constrain a fuzz test to a narrow set of boolean values, is that possible? Seems like bound is uint only and assume is not ideal to restrict narrowly — is there another alternative? you'd have to test those by setting up a node like anvil and then broadcast transactions separately.",443
1662,foundry-support.txt,"I don't know what the status on vm.finalize is what does bounding boolean values look like? You can easily convert uints to bool: bound(myBool ? 1 : 0, lower, upper) > 0 My assumption was that this would still have performance degradation, but maybe I'm wrong. well as long as it doesn't land on-chain I don't think it matters much Basically I'm looking to constrain to a situation where a specific address owns a specific NFT, so looking for ownerOf(x) == addr(y). I can definitely force into uint that way, that's a good idea if it works. sounds like you'll get a lot of rejects though, can't you ""force"" the owner being that particular address? actually just had this as an example, but I still don't understand how you would ""bound"" booleans, i.e. if you did have a boolean bound function, then bound(true/false, 0, 0) = false // => always force false bound(true/false, 1, 1) = true // => always force true bound(true/false, 0, 1) = true // => do nothing so it wouldn't make much sense I think got it, I’ll try to do it as soon as I have a little time. so it would work only with a forge script and not via a simple test right? Sorry if I was unclear. I'm looking to always force true but without the large number of rejects. But yeah, I'll just hardcode it that it ""forces"" it by pulling that address instead of using msg.sender. That's a great idea. Thank you. yes, but it would actually need to be done in 2 separate script calls (because foundry still simulates scripts in a single transaction and because of that the selfdestruct won't have an effect) and you would have to use a --fork-url pointing to anvil would it automatically simulate 2 blocks when 2 script are executed separately? I’ll give a try as soon as I have time I think so. I've had to test with selfdestruct before and that was the only way I could get it to work. It's a bit of a bad setup, but it works. gm everyone. I'm getting a foundry development environment set up this morning. I went through the typical installation process for MacOS and things worked well.",487
1663,foundry-support.txt,"I was able to create a forked mainnet node using the anvil --fork-url ... command. However, I now want to reset my worked node by running anvil_reset but my terminal (zsh) can't find the binary for this command. I'm wondering if anyone else has run into this issue, bc it seels like this binary isn't on my path but I'm not sure where it exists on my machine. Is this the best technique to check if a contract is deployed in a forge script? // Use cast to call out to ETH_RPC_URL and determine if contract has been deployed function isContractDeployed(string memory name) public returns (bool) { address addr = vm.parseJsonAddress(addressesJson, name); if (addr == address(0)) return false; string[] memory inputs = new string[](3); inputs[0] = ""cast""; inputs[1] = ""code""; inputs[2] = vm.toString(addr); bytes memory res = vm.ffi(inputs); return res.length > 0; } Can't you directly use addr.code.length > 0 I believe it's an RPC call and not a binary I get that you can invoke it like this (assuming you're using alchemy for jsonrpc): curl -X POST -H 'Content-Type: application/json' -d '{""jsonrpc"": ""2.0"", ""method"": ""anvil_reset"", ""params"": [{""forking"": {""jsonRpcUrl"": ""https://eth-mainnet.alchemyapi.io/v2/<API_KEY>"", ""blockNumber"": ""latest""}}], ""id"": 1}' http://HOST:PORT/ But there should also be a way to just run the command anvil_reset in my terminal to get the same effect. One of the engineers on my team can use the command this way So, in the forge script Im using vm.startBroadcast to deploy to the rpc chain, so I can just look at my local state (AFAIU), as the contract isnt deployed until after the script runs.",415
1664,foundry-support.txt,"I just tried this function run() public {   string memory mnemonic = vm.envString(""MNEMONIC"");   uint256 privKey = vm.deriveKey(mnemonic, 0);   vm.startBroadcast(privKey);   console2.log(address(token).code.length);   token = new Token();   console2.log(address(token).code.length);   vm.stopBroadcast();  } And this is the log I got == Logs == 0 2362 Was broadcasted on a forked chain over anvil. So I guess it should work the same? @TBIQ It'd also be optimal if this could simply update the block to most recent from mainnet without wiping contracts deployed to the anvil fork A command like: anvil_reset --rpc-url <RPC_AND_KEY> --block-number ""latest"" would be amazing as there can be oracle issues as time passes on one & not the other. Yea thanks, I was not grokking how it all works. Im good now! 🙏 Does Anvil have instrumentation to get a callstack from a transaction? I know forge is capable of showing this if you pass the -vvv flag during a test, but I'm trying to simulate a tx off a fork and get a call trace from the local chain if that's possible. again the foundrup installer is misconfigured for macOS my PR fixes have been closed addressing this I am running a foundry script in which I use vm.startBroadcast(privKey); Is it normal that after this statement msg.sender is still not the address of that privKey in the script but some other random address? facing above error while using forge script.how to resolve this Hi, I narrowed down why contract verification didn’t work. The only one that did not verify was the only one whose code would have been too large without the via-ir flag. The error message when trying to verify directly at deployment: We haven't found any matching bytecode for the following contracts: [0x…] is there any way to set precompiled binaries at specific addresses using foundry? Got it. Closed as in they weren’t interested in integrating the proposed fix? yes that is normal —`msg.sender` in your script refers to the caller of the script contract itself, which is that ""random address"" (not actually random of course), whereas the caller of external calls from your script is what is changed by startBroadcast.",490
1665,foundry-support.txt,"in your case you can access the deployer's addr with vm.addr(privKey) @joshiedo wen docs page explainer for this 😅 Hey guys, is there any way to write assertions for emitted events inside of tests? Hi everyone, is there any way to debug smart contracts developed in Foundry in VSC using breakpoints using the native VSC debugger? 🥲 What about a warning if you use msg.sender in a script? I actually cannot think of any reason someone would want to use it, so even an error? In scripts we should be really specific with addresses we use for everything, receiving from Uniswap is one example where it could bite people sometimes msg.sender can be the deployer though, if you set the sender (and I think also private-key) CLI flags Yeah that's true, I just think it's easily missed because the vm.broadcast is declared right there in the script and could be misleading. I think it should be in the docs but I don't think that's enough yea that’s fair, I agree with that So, maybe a warning on compile of the script? I'm trying to think where is the best place to hook in, in terms of actual effort in Foundry, but also dev ex. It should be low barrier (if I know what I'm doing, shouldn't annoy me) but also safely holding their hand (if I'm about to make a mistake). I guess if msg.sender is in the script but you don't pass sender in the CLI? Hey there, facing problem with a fresh install of foundry using solidity 0.8.18 with the glibc version: developer@ec180bb6683e:/com.docker.devenvironments.code$ chisel Welcome to Chisel! Type `!help` to show available commands.",367
1666,foundry-support.txt,"➜ uint256 a; thread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: SolcError(""/home/developer/.svm/0.8.18/solc-0.8.18: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.32' not found (required by /home/developer/.svm/0.8.18/solc-0.8.18)\n/home/developer/.svm/0.8.18/solc-0.8.18: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.33' not found (required by /home/developer/.svm/0.8.18/solc-0.8.18)\n/home/developer/.svm/0.8.18/solc-0.8.18: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.34' not found (required by /home/developer/.svm/0.8.18/solc-0.8.18)\n"")', chisel/src/session_source.rs:386:71 note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace Aborted Anyway to solve it ? Thanks 🙏 what is the reason for creating a remappings.txt file and also having remappings in foundry.toml? 👀seeing a lot of projects doing this there's also tx.origin to consider too, so maybe we: - wait for @joshiedo to update the book to explain the current situation (it actually is pretty intuitive once you get how it works, the confusing part is just that it's not documented so people don't know how it works) - open an issue to track showing a warning. I think the approach here is: if msg.sender and tx.origin are the default foundry addresses, not ones you provided, you probably shouldn't be using them.",423
1667,foundry-support.txt,"so IF they're the defaults AND we find the CALLER or ORIGIN opcodes in the script's method being executed THEN log warning? likely for vscode extensions that don't (yet?) pick up remappings in foundry.toml Its from dapptools-rs days thats how dapptools did it Its also why foundry supports DAPP_ prefixed env parameters this is due to musl alpine Sounds like a very belt and braces approach, I like! I can open that issue and also happy to work on implementing it? Will prob take me longer than someone else doing it as my rust game is still not the best yea that sgtm, thank you! Can you tell a script to replace a transaction ? hm good question — @joshiedo if you use the setNonce cheat on the deployer before a broadcast, is that respected and it will broadcast with that nonce, or does broadcasting always automatically set the nonce? No prob, opened this: https://github.com/foundry-rs/foundry/issues/4317 - let me know if you spot anything I should change Mh and what's the fix ? Hey guys do we have any command in foundry to get the list of all the functions on terminal Using “cast” command or something Hi there! Can I use foundry with L2s like zkSync? Would love to have any feedback on this @msolomon4 if you can give it a quick look🙏 I think foundry's 0.8.18 should be up to date with the updated binaries https://github.com/foundry-rs/foundry/issues/4199 Running foundryup and then: developer@ec180bb6683e:/com.docker.devenvironments.code$ chisel Welcome to Chisel! Type `!help` to show available commands.",374
1668,foundry-support.txt,"➜ uint256 a thread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: SolcError(""/home/developer/.svm/0.8.18/solc-0.8.18: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.32' not found (required by /home/developer/.svm/0.8.18/solc-0.8.18)\n/home/developer/.svm/0.8.18/solc-0.8.18: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.33' not found (required by /home/developer/.svm/0.8.18/solc-0.8.18)\n/home/developer/.svm/0.8.18/solc-0.8.18: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.34' not found (required by /home/developer/.svm/0.8.18/solc-0.8.18)\n"")', chisel/src/session_source.rs:386:71 note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace Aborted Still throwing. Should I totaly uninstall/reinstall foundry ? I'm not sure, can't hurt to try it though. if that doesn't fix it I'd suggest opening an issue Will do thanks 🙏 What’s your uname -a? Linux ec180bb6683e 5.15.79.1-microsoft-standard-WSL2 #1 SMP Wed Nov 23 01:01:46 UTC 2022 x86_64 GNU/Linux I'm on docker FROM rust:latest What are the environment variables for the various chains? Like if I deploy to Mumbai then it will look for my POLYGONSCAN_KEY instead of my ETHERSCAN_KEY.",416
1669,foundry-support.txt,"What about Arbitrum? I haven't found a place in the docs that lists all the possible environment variables, they are all scattered around Looks like this is helpful: https://book.getfoundry.sh/reference/config/etherscan But how do I know the names of all the chains? How do I include goerli optimism? Is that optimisim-goerli = { key = ""12345"" } ? or is it goerlioptimism or what have you? Verification is not working from a script that deploys to multiple chains Hey guys does anyone know how to get all the functions list after deplying the smart contract using foundry If there any cast command bash completions https://gist.github.com/sambacha/3c5924868b1f4cda61506c6db8e1dba5 Pls no caps 🙂 I think his issue is unrelated to foundryup 🙂 Hey guys does any one know how to get the necessary files of uniswap in foundry With using npm I think its respected when ""building"" the transaction. But during broadcast, there is a nonce check that expects it to be the next one if i recall Will have to re check Anybody here know how to have forge fmt run on save in neovim / vim? Hey guys! Im looking into trying out Foundry for my project, which is already running Truffle. Truffle outputs a json file with ABI and which network/contract addresses the different contracts have, which make it very easy to manage where the contracts are deployed when using it in my dapp. So far it looks like Foundry doesn't provide anything like that and i'd have to manually copy the contract address from the output and store it somewhere myself. Does somebody have a nice solution for keeping track of where contracts are deployed? Haven't seen anything that would handle this. I dropped foundry for deployments and wrote myself a custom python script for deployments. I tried to write forge script that would do that but it was pain to write (json/file support is lacking). In my experience forge is awesome for development and testing, but really lacking when it comes to deployments. Could I output gas reports from my tests to a file like with Hardhat? this is part of truffleDB Thanks for the reply, yeah I realize. I was just hoping there was an equivalent so I could easily manage my deployments.",486
1670,foundry-support.txt,"There are a few different approaches Hardhat is working on a deployment library called Ignite There is https://usecannon.com/ There is also MakerDAOs ChainLog approach Those are really good pointers! I will research, thanks a lot :) Hi everyone! I'm currently having trouble signing forge script BNB testnet transactions with a Ledger. I'm getting the Ledger device: APDU Response error Code 6a80 ([APDU_CODE_BAD_KEY_HANDLE] The parameters in the data field are incorrect) error. The suggested solution from my research seems to be to enable blind signing on the Ledger device itself, which I've already done. I'm still getting the same error though. Does anyone know what might be going on / what would cause the error to show up with blind signing enabled? Thanks for your help You can see the results here: https://chainlog-ui.vercel.app/ what OS ? you have that option its called snapshot Linux (Fedora 37) Red Hat? In this Economy? Haha tell me about it, I hate btrfs with a passion, but procrastinating the next distro hop Are you sure you have the correct drivers ? How do I make Anvil continue from where it stopped on restart I'm running the latest version of Ledger Live. not sure what else I could be doing (Ledger live seems to work well is my point) Also I've done some deployments on Solana using on the same computer using the same Ledger So I doubt it's a driver issue Hey guys, is there a way to get the fork_block_number in foundry.toml in a test file akin to vm.rpcUrl method for RPC URL? As an update @sambacha, we tried it on another computer running Linux as well with another ledger and got the same error This is the command we're using btw forge script scripts/Deploys.s.sol --broadcast -l --mnemonic-indexes 1 --legacy --rpc-url https://data-seed-prebsc-1-s1.binance.org:8545/ --tc DeployScript --chain-id 97 How does foundry make compilation speed gains when compared to hardhat? Is it just a result of using solc vs solcjs? hi, i'm getting `We haven't found any matching bytecode for the following contract` when trying to verify a contract with foundry.",479
1671,foundry-support.txt,"forge script script/DeployContract.s.sol:DeployContract --rpc-url ${RPC_MAINNET_URL} --verify --etherscan-api-key ${ETHERSCAN_API_KEY} -vvvv i have the generated run-blocknumber.json file in broadcast/DeployContract.s.sol/dry-run/run-latest.json any tips to be able to verify the contract? ``` This may occur when resuming a verification, but the underlying source code or compiler version has changed. ## Start verification for (0) contracts All (0) contracts were verified! ``` Pls open issue w/ repro^^ done Is it okay that naming differs between requests? According to txpool_status there is one queued transaction But txpool_inspect shows one pending transaction Requests were sent to anvil Hi. When i want run this command: forge init I will get this error: foundry This command requires clean working and staging areas, including no untracked files. Modify .gitignore and/or add/commit first, or add the --no-commit option.",204
1672,foundry-support.txt,"How can fix it? commit your changes to git I dont do any changes And you have all files tracked and commited? Yes Yesterday i will used this command easy But today i get this error does anyone know how to make vs-code recognize my remappings.txt so it doesn't highlight my openzep import as invalid? everything builds correctly I think the linter just doesn't know about it is there a foundry cheatcode that returns me the pub key of a given address? vm.addr(private_key) is there a way to tell if the my external calls in the script are being broadcasted or not like if it's between vm.startBroadcast() and vm.stopBroadcast()? *within the script run() function itself? it does return the address not the public key I'm using anvil, i would like to test a tx, mine it to see if succeed, if it does, goes back to the previous block and add another transaction to that block, and mine it again to see if it succeed (ending up having 2 mined tx in the same block, with block position 1 and 2) is this possible? can i use evm mine -1 or something similar? or should i handle it with saving the state and dumping it and reprocess both tx? Hey guys how to setUp a test function if your constructor is calling a on chain data in foundry?? any tools yall recommend to build a tx from scratch? So that I can sign it with cast wallet sign not exactly sure I understand that correctly mind opening an issue with more details. there's a setting to restrict how many transactions can be included in a block, but I don't think we expose that on the cli, but can easily add this. I'm bubbling a revert in a fallback function, and I'm getting this error: > EvmError: NotActivated Is this a bug in Forge? This is the code that triggers the revert: assembly {  let returndata_size := mload(response)  revert(add(32, response), returndata_size) } Note: the revert is due to a panic, specifically an arithmetic overflow. Non-panic reverts work fine hey there, I'm running into this common issue:  Compiler run failed error[6275]: ParserError: Source ""ds-test/test.sol"" not found: File not found.",477
1673,foundry-support.txt,"Searched the following locations: ""/Users/steve/Documents/1.0-WORK/etcetc"" --> lib/forge-std/src/Test.sol:5:1: | 5 | import ""ds-test/test.sol""; I checked in the chat search for import ""ds-test/test.sol""; related errors and poked into my past commits to see where this compiler issue started happening but I'm not sure what's up any suggestions? Try this: git submodule deinit -f . git submodule update --init --recursive I use the commands above in a bash function, like this function reinit() { git submodule deinit -f . git submodule update --init --recursive } Rebooting submodules is often necessary when switching between branches Worked like a charm. Thank you so much! When I have used match contract why does it try other contracts and give errors? How can I get around this? Hey @gakonst, I've sent you a DM with next steps on your nomination for RetroPGF. You need to submit a form (https://app.optimism.io/retropgf-manager) - deadline is Feb21st how do we do beforeEach, before, after and afterEach in foundry? Same thing If I send contract through eth_sendRawTransaction and then mine it, it completes successfully But if I send it through eth_call it fails I checked through ""trace"" logs that anvil receives exactly the same transactions in both cases Hi. How do I put as tx.origin my address in the scripts? Is there a way to get an account nonce during script execution? is theres a way to sign like “eth_sign” with prefix via foundry vm for testing purposes? basically do i really have to concentrate strings to do it foundry? Also seems like there is no error in evm.env Is there any ""matchers"" library style Hamcrest in Java for Foundry/Forge? the vm.getNonce cheat Generate digest to sign using OZ's ECDSA library, then feed it to vm.sign(privKey, digest) https://github.com/OpenZeppelin/openzeppelin-contracts/blob/5a00628ed3d6ce3154cee4d2cc93fad920e8ea30/contracts/utils/cryptography/ECDSA.sol#L157-L186 great, thanks! Hey Everyone, Deal cheat code leads to this EVM error.",484
1674,foundry-support.txt,"2023-02-13T19:03:44.547990Z ERROR forge::runner: setUp failed reason=""EvmError: Revert"" contract=0x7fa9385be102ac3eac297483dd6233d62b3e1496 I’ve read that the default foundry Sender create the TestContract at this address 0x7fa9385be102ac3eac297483dd6233d62b3e1496 anybody know what’s up? The issue happen on a mac, but the code runs just fine on my linux. Thanks for your help in advance From the traces, sounds like the error happens at this line: // update stdstore.target(token).sig(0x70a08231).with_key(to).checked_write(give); how do i do eth transfers from the deployer address in forge script? nvm figured it out having issues with multiple test contracts — forge test only tests the functions in the first contract and it compiles the second, but ignores its test functions (even when I try ""forge test --match-path test/Contract2.t.sol"", ""forge test --force --match-path test/Contract2.t.sol"", etc.). I don't think I'm missing anything too obvious (external visibility, ""test"" prefix, file ends in "".t.sol"", in the same /test folder as the other contract file, cleared cache). I've looked through the pinned message resources to no avail. Any ideas? Is Contract2 an abstract contract by any chance? it is not I have a functions that takes bytes32[], and I would like to avoid duplicates inside the bytes32[] array. Is there anyway to tell the fuzzer to not include duplicates in array arguments? I got it to work — tbd how exactly, but I got it to work 😂 If anyone got a hint for this install related issue, that’d awesome, thanks 🤩 Any echidna expert here ? want a help , if you accept a dm I’d suggest opening up an issue in the github even if it’s just for help.",430
1675,foundry-support.txt,"Otherwise send me a dm Hey Guys, can any one please tell how to resolve the estimated gas error Error: (code: -32003, message: Out of gas: required gas exceeds allowance: 0, data: None) i'm trying to use transfer function and getting this error you can use setUp() function and initialize the value inside it Foundry Support And how do I do after? Hello, trying to verify some contracts I just deployed via foundry (part of run-latest.json), but receiving: > We haven't found any matching bytecode for the following contracts: [0x1d69c48a35ddd241e72a31db0e637676d89fc553, 0x15196d30bc37d2fc5c718ffcd9d7687d76f3ad1f, 0x3e05eb6e12a3c9ed5e46a710bcf052efd6d73fbd]. This may occur when resuming a verification, but the underlying source code or compiler version has changed. —- Any idea what could be wrong? I didn't --resume, but directly verified via --verify for 17/20 contracts it worked, for these 3 it doesn't. With --resume --verify two more contracts got verified. The third one uses libraries & a constructor which i think is the reason for foundry not finding the matching bytecode. Will move to github issue as it seems to be a bug. Hi there, I've created this modifier to run isolated fuzz tests within a fork, but it seems that it makes the tests not run at all, maybe it is also resetting some internal state of the fuzz?  modifier withinSnapshot() {   uint256 snapshotId = vm.snapshot();   _;   vm.revertTo(snapshotId);  } Is it possible to read a json file directly in a test ? parseJson with readFile? https://book.getfoundry.sh/cheatcodes/parse-json?highlight=parsej#parsejson thanks a lot :) Whats the foundry equivalent for openzeppelin hardhat upgrades plugin Paricularly trying to replicate the deployProxy() in a foundry solidity test setup There isn't one afaik.",458
1676,foundry-support.txt,"You have to write a script which deploys implementation and proxy separately any reference repos available for that? https://github.com/foundry-rs/foundry/issues/2666 https://github.com/odyslam/foundry-upgrades/ is there a after, afterEach equivalent in tests? If I have 2 state variables in the same slot, how to read only 1 with vm.load ? Accessing packed slots is not supported this means I can't right? https://book.getfoundry.sh/reference/forge-std/std-storage#std-storage I'm trying   bytes32 l = vm.load(address(x), bytes32(uint256(0)));   (int256 a, address b) = abi.decode(l, (int256, address)); But it just revert I'm probably missing something, but how do you pack int256 and address into 1 slot? Slot 0 have a bool and address, so the bool will be 0 or 1 right? Hi everyone! So was trying to read some data from a json and process it with a foundry script. I cannot seem to vm.readFile. Error is: The path ...... is not allowed to be accessed for read operations. If i run ls -l on current file i have -rw-r--r--, so i really don't think its a perm issues. What am I missing here? Here is my code: // SPDX-License-Identifier: UNLICENSED pragma solidity ^0.8.13; import ""forge-std/Script.sol""; import ""forge-std/StdJson.sol""; contract ParseJsonFile is Script { using stdJson for string; function setUp() public { string memory root = vm.projectRoot(); console2.log(root); string memory path = string.concat(root, ""/test.json""); string memory json = vm.readFile(path); bytes memory processed = stdJson.parseRaw(json, "".test""); console2.log(processed.length); } function run() public { console2.log(""will run""); } } My file test.json: { ""test"": [""test1"", ""test2""] } Solved. For anyone having this issue be sure to configure the filesystems permissions on foundry.toml file. More infos: https://book.getfoundry.sh/cheatcodes/fs?highlight=read%20permission#description Not sure I understand.",473
1677,foundry-support.txt,"You are trying to ""unpack"" a slot – which is always 256 bits – into int256 (256 bits) and an address (160 bits). Did you try abi.decode(l, (bool, address))? https://twitter.com/apoorvlathey/status/1621986610068996096?s=46&t=iL3k8GiAgi0zC4XvxWhY5w Hi All, I have a scenario where i need to run the same tests against various setUp configs. is there a harness or pattern that is established to accomplish this? traditionally this is a one to many relationship - 1 setup and many tests we need to run a many to many scenario where we have many setups and many tests where the same tests are being used against each setup Is it true that Etherscan is unable to verify binaries compiled with via-ir? I deployed using forge create, via-ir, and verify. The contract deployed successfully, but then I get this error in forge Fail - Unable to verify. Solidity Compilation Error: Compiler error (circleci\project\libsolidity\codegen\LValue.cpp:56):Stack too deep. Try compiling with `--via-ir` (cli) or the equivalent `viaIR: true` (standard JSON) while enabling the optimizer. Otherwise, try removing local variables.",273
1678,foundry-support.txt,"eth_call pointed me to this issue which looks like the same thing 🫡 https://github.com/foundry-rs/foundry/issues/3507 Hello, will vm.createSelectFork(string memory, uint256) cache data similarly to providing the equivalent command line arguments? is it not possible to log a boolean value? nvm, used console.log how to format bytes32 to string? toString() is just stringifying the bytes32 value looking for an equivalent for the cast --to-ascii ig You can use a ffi cheat code or something like that bytes memory a = new bytes(32); assembly {  mstore(add(a, 0x20), bytes32value) } string memory b = string(a); so there isnt a cheatcode to do that atm? Might just be able to string(abi.encode(bytes32value)) @phazze May you look at this issue that i have posted ? https://github.com/crytic/crytic-compile/issues/379 Since i can't messsage to someone who isn't mutual fren at the moment https://www.justinsilver.com/technology/programming/slither-echidna-remappings/ i've tried remappings as in this post , but it is not useful Hi! how do I force a higher gas limit for a script execution (I mean the broadcasted tx)? I get Script ran successfully in simulation but then TX run out of gas (bsc-testnet). If I simulate on Tenderly with higher gas TX goes fine so is a gas limit problem. I run script with forge script --gas-limit 400000 but TX always has lower gas limit. Thanks! uhhh okay we plan to move into foundry can't bear it anymore guys , i am coming https://hardhat.org/hardhat-runner/docs/advanced/hardhat-and-foundry looks like we can integrate foundry into our hardhat if we want to integrate foundry into our hardhat project , any consideration s on this ? like the impact of current construction ? Or any existed repo doing the same hybrid way ? Hey, not sure if you want an issue filed BUT I had an issue with forge complaining about Contract has unlinked bytecode. Please check all libraries settings.. I tracked it down to a public function in one of my libraries but the error went away once I commented out some test code.",480
1679,foundry-support.txt,"Turns out: - Public functions in libraries used in contracts defined in the src folder ————- OK! - Public functions in libraries used in contracts defined in the test folder ————- NOTOK! (An example might be a Mock contract that grants access to internal functions) i have one question let's say i want to add foundry support to our existing hardhat project but i only want to use it for our test part can i just put lib/forge-std into our test folder and then add foundry.toml configuration file also in our test folder finally create test/foundry subdirectory and write foundry test in it is the hybrid combination expected to be as so ? Yes you can do that is there a way (e.g. via foundry.toml) to exclude certain test contracts from execution? Checked the book and didn't find sth 😅 Hey there, if I want to get a JSON file for a vyper file, how I would go about it? I know it's not a direct foundry question, but I am trying to import a JSON from a vyper file to use in a foundry project. Basically my tests aren't working and I'm wondering if this vault.json file: https://github.com/umphams/yearn_mellow-gearbox-strategy/blob/master/artifacts/Vault.json is not up to date vs this vault.py file (from Yearn's latest vaults repo): https://github.com/yearn/yearn-vaults/blob/master/contracts/Vault.vy I've created new artifacts from a fresh clone of the yearn vaults repo, but it only generates vaultABI.json and seems to be several hundreds of lines shorter compared to the JSON shown in the first link Trying to do this  let formatted=(ETH_BALANCE / 10e18); It is throwing error the trait From<{float}> is not implemented for ethers::types::U256 What is the meaning of this ? I am new to rust you can't divide a U256 by a float. Is there any name to this concept in rust , so I can search it Its the type system..",435
1680,foundry-support.txt,"about the crux of working with rust (ior any other typed language) so cast either the number as a float , or the denominator as a U256 let formatted=(f64::from(ETH_BALANCE) / (10e18)); | --------- ^^^^^^^^^^^ the trait From<ethers::types::U256> is not implemented for f64 You can’t do this. Why are you casting to f64? Just do ETH_BALANCE / 1e18 if it doesnt work you should do 1e18 as u64 to cast it to u64 and that’ll let you divide the U256 with it Please read up how types work in Rust and other languages as would like to avoid doing Rust support in these channels ^^ People don't reply in other telegram channels I know of in rust 😅 This is not Rust specific. You have two issues: 1. Computers don't really know how to handle fractions, so there's a special type called ""float"" (and ""double"") that kinda mimics fractions. You can't mix floating-point and integers in a single arithmetic expression. I suggest researching ""floating point arithmetic"" 2. You are trying to cast a 256-bit variable into a 64-bit variable, which won't work regardless of the above I'm trying again in case anyone knows - is there a way to prevent duplicates in fuzz testing? getting an error in parseJson after updating foundry ( path error ) - perhaps some updated file permission thing? were trying to read a value from package.json. this test worked fine before updating. already have fs_permissions = [{ access = ""read-write"", path = ""./""}] in foundry.toml, can anyone let me know if theres anything else i should do? or if the error is caused by something else? how are you specifying the key? most likely that path error is referring to the JSON path for the key, not the file path. there was recently a fix that requires paths to be specified similar to jq, i.e.",411
1681,foundry-support.txt,".key and not key Has anyone had the issue of anvil eating up all hdd space when running a local node is there a cache I can clear? Wow, 40GB+ in ~/.foundry/anvil/tmp Still hoping there's a way to set the starting block on anvil WDYM? Hi, I got the following error: Compiler run successful Error: Invalid hex calldata Context: - Odd number of digits Here's my script: forge script --rpc-url $POLYGON_MUMBAI_URL --private-key $POLYGON_MUMBAI_PRIVATE_KEY -c script/Deploy.s.sol Deploy --sig ""run(0xE097d6B3100777DC31B34dC2c58fB524C2e76921)"" --broadcast -vvvv ./script/Deploy.s.sol and here's my run() function: function run(address _usdc) external {   USDCAddress = _usdc;   vm.startBroadcast();  SoonNFT soonNFTContract = new SoonNFT(USDCAddress);   soonNFT = address(soonNFTContract);    vm.stopBroadcast(); } Is there a way to pass custom arguments into a script from the CLI? e.g. forge script script/MyScript.s.sol amount=1000 —fork-url http://localhost:8545 -vvvv contract MyScript is Script { function run() external { payable(someAddress).transfer(amount); } } I manage to use the ENV of address instead. But I got the error similar to this issue: https://github.com/foundry-rs/foundry/issues/3880 Transactions saved to: /home/rizary/smart-contract/broadcast/Deploy.s.sol/80001/run-latest.json Error: Transaction dropped from the mempool: 0xc6a1f6cec634ad525bd75c916224fb594621113235b5c276c6f8dc5977b1a1e3 Hi! What would be the best way to convert the bytes returned from ffi into an integer? I find it weird that the output value is stored as bytes but is not converted (e.g.",445
1682,foundry-support.txt,"42 would be 0x42) Hi is there a way to grab additional logging to debug RPC connection issues? Working with the Llamanodes team and we want to get some more detailed traces RUST_LOG=debug Or trace might help I'll try debug - I put full but it didn't help a ton Is there a way to set gas price inside a test? I know you can use the flag --gas-price, but that doesn't allow you to use a gas price of zero for other transactions (which is convenient in tests). Replying to myself just in case someone has the same issue in the future: best way to do it is to abi.encode the output value in the external program, so you can abi.decode the bytes it in the tests I'm having issues where some of my transactions on my local anvil node never get mined - no error message, they just get stuck as pending on the front-end and never show up as transactions in the anvil logs. Any advice on debugging this? Is there a way to run forge script and see console output in a ""live mode"", rather than all at once once scripts completes? I’ve been using env vars to pass args. Hi all. I'm new to solidity. In Foundry how can I create a script to interact with a contract on the Goerli test net? Anyone find a work around for this issue? https://github.com/foundry-rs/foundry/issues/3507 Is there a way to access private variables of smart contracts in forge tests? Or will I need to write getters? load cheatcode Which one? Oh you mean literally load Ok I’ll have a look thx https://book.getfoundry.sh/reference/forge-std/std-storage This would be better.",359
1683,foundry-support.txt,"Does forge script simulation ever modify msg.sender? Expect it to always match the private key passed on the cli, but seems to switch printing msg.sender in the Script contract is correct, but changes when you log msg.sender in the actual contract called Is there a flag to not make the Script its own contract, and just pass through msg.sender? Nope It should Well yeah in script you'll want to prank or broadcast ah nvm, i'm an idiot, was using vm.broadcast() instead of vm.startBroadcast() lol Hehe 🙂 First time I ever see you anywhere outside Twitter @gakonst idk why, but sometimes it recompiles all the files :( I used foundry while solving damnvulnarabledefi and everything was ok, strange sent an environment variable at the command line and use vm.envString or one of the others to pull that variable into the script https://book.getfoundry.sh/cheatcodes/external is there a way to export gas reports to a csv? would make my life easier rn You can write it yourself Hey is there a way to output the events when doing deployments/script when using anvil? What kind of events? emit events hey is there a way for forge script to take command line arguments? I think that would be a good idea See above, you can fake it with environment variables. Is there a Forge runtime environment like Hardhat? Something I could use as per of a Rust codebase What's the best practice to deploy multiple contracts at once. Should we have a separate script for each contract and have a bash file to execute the scripts in desired order or should we just deploy all the contracts using a single script per network? I'm using one Solidity script which automatically switches forks. I just provide an array of chains(enum) I want to deploy to & it creates&selects forks, and deploys my contracts.",381
1684,foundry-support.txt,"Also I have runLocal function which does the same but with local instances, so that I can test deployment locally Not sure if there is ""best practice"" yet Hi, I’m trying to use foundry for forge test but I was blocked by the 6275 error [ParserError of File not Found in Source “contracts/*.sol” in search location of superior foloder of contracts in absolute path when I try to import solidity file in *.t.sol and my remappings is like @openzeppelin/=node_modules/@openzeppelin/ @uniswap/=node_modules/@uniswap/ ds-test/=lib/forge-std/lib/ds-test/src/ forge-gas-snapshot/=lib/permit2/lib/forge-gas-snapshot/src/ forge-std/=lib/forge-std/src/ openzeppelin-contracts/=lib/permit2/lib/openzeppelin-contracts/ permit2/=lib/permit2/ solmate/=lib/solmate/ Can I get some references from here?? Hello there, I would like to be sure is there any known tricks or vulns to rce anvil/Read on the disk? I am remember something like that during the ParadigmCTF but cannot find out the challenges via the unintended thanks for people who knows.. I am speaking in case you want to expose anvil has a blockchain node rpc ^^ Any idea why cast call cannot resolve an actual Ethereum address? It seems like it thinks it's an ENS domain, when it's clearly not. Failed to resolve ENS name: ens name not found: 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48 Hello everyone! 👋 For a newly-installed Foundry project with running tests (confirmed on the other machines), I cannot make the test run successfully: they fail during the setUp() execution, with [FAIL. Reason: Invalid data] setUp(). I'm currently running forge 0.2.0 (cb925b1 2022-11-21T16:24:05.0674358Z) on Windows 11. The general advice for this issue both in this group and inside the Foundry Discussions on GitHub is to update Foundry.",465
1685,foundry-support.txt,"However, when I try doing this (by building from source via cargo install --git https://github.com/foundry-rs/foundry foundry-cli anvil chisel --bins --locked), I keep getting the error from the screenshot above. What's wrong and how can I fix this? Thank you in advance for any help! Anyone knows how to run anvil with cheatcodes on? I need to run a script without broadcasting that sends some tokens but want to use deal And I can’t deploy a mock is it possible to send a raw transaction from inside a test using the cheats? basically trying to deploy a contract using a raw transaction calldata instead of etch or deployCode is it possible to evaluate raw bytecode within a test? hello, I'm sometimes seeing issues with expectEmit failing, but checking the traces I can see the expected event _is_ emitted. Not sure if it's one to raise on the GH repo, but thought I'd ask here first in case it's just a rookie error on my side. Tried to pair it back to a minimal example (https://github.com/another-dave/expect-emit-mcve), so I've got a test case that's doing a mint on an ERC721 and just checking that there was a Transfer. Can see both the expected & actual events in the verbose logs and the args to each are identical. Appreciate any thoughts or insight. is it possible to fuzz inputs to the set up function? if not, is there a reason for this? i think it could be quite useful Has anyone encountered a situation where they can't verify a contract deployed via a Foundry script because of apparently deployment bytecode mismatch? Might be related with the fact that it's 0.6.12 and ABIEncoderV2 is used in some of the contracts in the inheritance chain. I've tried generating standard json input using forge verify-contract --show-standard-json-input to verify the contract manually, but even then the bytecode is different. I am 100% positive that there were no changes in the repo since the deployment. Hey everyone! Everytime I try to use chisel, I get the error Invalid EVM version requested.",447
1686,foundry-support.txt,"Does anyone know if I should configure something locally? how do i run example in workspace? In https://github.com/bluealloy/revm i am not able to run cargo run —example cargo r -p <..> —example <…> Does someone has a repository in order to test OZ Governance function in foundry ? where does forge download the compiler to? Trying to find the file location like the binary? yes check with which cmd-here itll show you location ~/.svm This doesnt work fwiw, it shows me an older version i downloaded via homebrew Anyone had any luck executing scripts using a ledger ? U mean this ? Which was patched , allowed access to local path , https://twitter.com/elyx0/status/1568258205309878272?lang=en gm gm Has anyone had an issue where cast commands think that an actual Ethereum address is an ENS domain? I can't talk to any contracts because I get an error like the following: Failed to resolve ENS name: ens name not found: 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48 can u share more code? I'm simply running the command below in my Mac terminal as a test to talk to the USDC contract on Ethereum. It should return zero. What's weird is that if I swap out the USDC address for usdc, the command actually works because usdc resolves to the correct address. However, this doesn't help me when I need to talk to contracts that don't have an ENS domain.",331
1687,foundry-support.txt,"cast call 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48 ""balanceOf(address)(uint)"" 0x4203401C73d56B984c5cDb0b248faEf7C9919632 --rpc-url https://rpc.ankr.com/eth tried that but cargo is not able to find examples/ as package Possible packages/workspace members: revm-test revm revm-interpreter revm-primitives revm-precompile revme maybe blocked by this issue? https://github.com/rust-lang/cargo/issues/7467#issuecomment-538551782 Thanks sir exactly!! I believe this was patched in the latest nightly release, foundryup should solve your issues I feel very stupid right now, but can't get blockscout verification work even on the mainnet. The foundry book and —help has been no help.",197
1688,foundry-support.txt,"I've tried forge verify-contract --chain 1 --verifier-url https://blockscout.com/eth/mainnet/api --verifier blockscout <ADDRESS> <CONTRACT> forge verify-contract --chain 1 --verifier-url https://blockscout.com/eth/mainnet/api --verifier blockscout --compiler-version 0.6.12 --optimizer-runs 200 <ADDRESS> <CONTRACT> forge verify-contract --chain 1 --verifier-url https://blockscout.com/eth/mainnet/api --verifier blockscout --compiler-version 0.6.12 --optimizer-runs 200 --constructor-args 0x1234 <ADDRESS> <CONTRACT> Getting the same Failed to deserialize response: data did not match any variant of untagged enum ResponseData With actual values for address an contract, of course :) can u recommend some writeups for that CTF ? it was a very advanced level We are building a CTFs with progressive Steps i can share with you if you want i don't have so much writeup for ParadigmCTF ahah Unfortunately nop ahahaha oops maybe i got confused with that duck character who was tearing it up lol Foundry uses which lib for printing the table for gas report and formatting them ?Can u point me to the code is there a way? or do I need to build the check on the input and filter with assume? https://github.com/foundry-rs/foundry/blob/master/forge/Cargo.toml#L32 but there are many crates that do this , see which one is easier for you to work with Is there any recommended way to resolve relative dependency paths using ffi? E.g. in my project I have a bash script that I call using ffi in “Test.sol”, however if my project was installed as a dependency and the main project imports/calls “Test.sol” I’m assuming it will look for the bash script in the main project’s folder when it should look in the dependency’s folder.",418
1689,foundry-support.txt,"Any solutions out there for this? Only other solution I know of is to rewrite the bash script in solidity but wit wouldn’t be the cleanest solution there’s a helper called proejctRoot iirc in forge-std have you tried that? https://github.com/foundry-rs/forge-std/blob/a2edd39db95df7e9dd3f9ef9edc8c55fefddb6df/src/Vm.sol#L121 https://book.getfoundry.sh/cheatcodes/project-root?highlight=projectroot#projectroot maybe helps Ah, I had assumed that would resolve to the main repo's path as well but will test it out, thanks! does foundry docgen create markdown files? also how do we specify configurations for the docs tool? Hi, someone has an example of how to use vm.env cheats with a github action? Did you ever figure out a solutoin to this? I’m seeing this on X1 and I know they disabled EIP-1559. I need to disable the EIP-1559 check ah --legacy https://t.me/foundry_support/30880?thread=30782 ah see you already figured it out Hmm yeah, it does seem like this cheatcode still evaluates to the main project's root folder. All good though, planning to rewrite in solidity Yep — just deployed my contract. Running smooth as butter I am having some problems with Foundry dependency installation. After initialization and I install transmissions11/solmate, it works perfectly. However, if I want to install OpenZeppelin/openzeppelin-contracts afterwards, I get the error: ""lib/openzeppelin-contracts' does not have a commit checked out"". If I delete the empty /lib/open-zeppelin folder and try again, I get the error ""You are on a branch yet to be born"". How do I fix it? I use Windows 10. Even —no-commit doesn't fix it. And if the error persists and I try reinstalling solmate, it works fine.",422
1690,foundry-support.txt,"gm gm may I ask if its possible to assert enum on foundry seems thats not possible? nvm I just need to do assert(uint(enum), uint(enum)) convert to uint How do I define the gas price within the t.sol file? Or can it only be set as an arguement to forge test? just put together a custom plugin for zksync era: https://github.com/omurovec/foundry-zksync-era curious if this is something I should submit to add to awesome-foundry? Did you figure out the clue of Memory allocation overflow? No idea... sorry that was too long ago, I don't remember Hey, has anyone ever tried to deploy contracts on Polygon's new zkEVM using Foundry? I'm getting the following error: 2023-02-20T10:08:07.123879Z ERROR sharedbackend: Failed to send/recv `storage` err=GetStorage(0x5b73c5498c1e3b4dba84de0f1833c4a029d90519, 1, (code: -32602, message: Invalid Params, data: None)) address=0x5b73c5498c1e3b4dba84de0f1833c4a029d90519 index=1 Looks like contract-level variables don't work for some reason. When I get rid of them I end up with Failed to get EIP-1559 fees Well, got rid of contract-level variables and added --legacy and it works 👍 What are contract level variables? That would be interesting if it uncovered a bug Probably not the right term for them 😅 contract DeployScript is Script { address thisVariable; function run() public {  address asOpposedToThisOne; } } Yea weird this should work Made sure to foundryup right before, I'll quickly check if the forge init example also doesn't work and open an issue on GitHub if it doesn't Well, the test repo works, now I have no clue haha. My other repo works for Goerli, just not for zkEVM 👋sers.",443
1691,foundry-support.txt,"1) How would I read bytes4 from a JSON file using the stdJson lib? I've tried using `bytes4(json.parseRaw(jsonFile))` however `json.parseRaw` parses `0x02001020` to `0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000040200102000000000000000000000000000000000000000000000000000000000` and then `bytes4` butchers it to only `0x00000000` Forge install of openzeppelin takes too much time and never installs the dependency - can someone help? I have forked mainnet in an anvil instance, and now I'd like to transfer some tokens in a deploy script. Is there any 'vm.prank' or 'vm.deal' that actually broadcasts a transaction while impersonating another address? vm.startBroadcast ? assuming you have the priv key yeah without having the private key 😅 Like in my fork, I want to have a few million USDC to play around with, if it were a test, I could do a vm.prank or vm.deal, but that doesn't get broadcasted in forge script I can send u a few mill USDC If u want on mainnet? I'll send you my address right away! 😅 i think you should use anvil_impersonateAccount from its rpc then and then run your foundry script ohh that might work, thanks for the tip I'm sorry to be a pain in the butt, but could this issue get some visibility? https://github.com/foundry-rs/foundry/issues/4301 Not being able to verify contracts on any chains with a blockscout explorer, including mainnet itself. After I have created env variables, how do I pass them to forge create when deploying a contract? It doesn’t pick up my env variables. Can someone tell me what I am doing wrong in the test in the gist here? Initially I thought it was a problem with the smart contract itself, but when I deploy locally with anvil and call functions with cast the refundPayment call doesn’t revert, which leads me to believe that I did something wrong in the test.",478
1692,foundry-support.txt,"The idea is that someone makes a payment and if it’s not claimed by the intended receiver before the deadline the initial sender can reclaim the payment. https://gist.github.com/czepluch/1b1d9935ce2c36f8e2bdd0d49ddf2fbc What happens when you forge test with -vvvv? Should give you an idea of where the bug is. It reverts. in the payment.sender.call{value: payment.amount}(“”); call. So it passes alle the requires. is the caller a contract? the payment.sender It shouldn’t be. In this case it’s just the default address used by Foundry in tests. then it is a contract so that issue is caused by the absence of the fallback/receive function Oh. Thanks. I must have missed that fact. Tests are deployed to 0xb4c79daB8f259C7Aee6E5b2Aa729821864227e84. If you deploy a contract within your test, then 0xb4c...7e84 will be its deployer. If the contract deployed within a test gives special permissions to its deployer, such as Ownable.sol's onlyOwner modifier, then the test contract 0xb4c...7e84 will have those permissions. You might want to create an EOA for testing stuff like this. E.g. address alice = makeAddr(""Alice""); vm.startPrank(alice); // Test stuff as if Alice EOA interacts with your contracts vm.stopPrank(); Yeah. Will do that for sure. I just falsely assumed that it already was an EOA. But as @FreezyDev just pointed out it quite clearly states something else in the docs. I just managed to read it and ignore it Yeah not sure what the issue is, do u have a repro? Would be surprised if blockscout just broke but maybe they did some upgrade? Thanks for the help. @FreezyDev and @ChiTimesChi ! That was indeed the problem. What would be the best way to send custom data (EIP-712 typed txn) through eth_sendTransaction in forge? Will probably have to do a bit of work to add support for it properly but just trying to figure out where to get started.",470
1693,foundry-support.txt,"Was looking through forge-std and found the structs for EIP-1559 type transactions but can't seem to figure out exactly where they get parsed from the broadcast artifacts or where the transaction is sent when broadcast is active. Any pointers appreciated 🙂 Hi all, I am quite new to Yul and Foundry. My question might be very simple but cannot find solution yet. Question: Do I need an abi json file in order to test yul file with forge? (I know abi file is required for hardhat testing and I wonder if it's the same case with foundry). Basically I am looking for a way to test yul file with forge! Thanks in advance! Hey @gakonst, I’m having trouble getting the file output for `forge build —via-ir —extra-output-files=ir. I saw that you added the option here: https://github.com/gakonst/ethers-rs/pull/2055 , and it is working perfectly for ir-optimized and asm, but for some reason ir doesn’t work. Would appreciate any help,thanks! Can u pls open an issue with a. Repro of the exact problem you're having? Is there a way to access external contracts storage slots in chisel? Say how is CHISEL installing the latest version of SOLC , i can see its somewhere here - https://github.com/foundry-rs/foundry/blob/edf15abd648bb96e2bcee342c1d72ec7d1066cd1/chisel/src/session.rs#L46 , but which crate is it using in foundry to do that ? 3 lines above that https://github.com/roynalnaruto/svm-rs Lol what’s this? :)))) [FAIL.",365
1694,foundry-support.txt,"Reason: Error != expected error: 0x68a6f9a4 != ﶤ_] 0xefb6a45f hi all, where can I find documentation about the reasoning behind the Vm and VmSafe distinction? Is it just ""safe cheatcodes can be used in both scripts and tests, while unsafe cheatcodes can only be used in tests""? Edit: nvm found it here https://t.me/foundry_support/29644 Hi guys, quick question: is there any way to compile using via-ir: true JUST the unit test contracts and deploy the rest without that flag enabled? The reason is that I have a few complex end to end test casses and I'm getting stack too deep errors. Removing vars could work but will make the tests highly unreadable And via-ir main issue is obviously how long it takes to compile everything, so I wonder if it is possible to specify via-ir: true just for the test case contracts, and via-ir disabled for the rest cc : @gakonst Will it recompile unchanged contracts ? I guess it will, not sure if there is some way to avoid it via config, e.g. make forge to compile twice, first contracts, then tests If contracts are unchanged, they shouldn't compile again because they are cached by default. Try it out Yeah, they will be recompiled, I tried it before I think just reading it as bytes32 and then casting (or shifting?), @odyslam can you confirm? https://github.com/foundry-rs/forge-std/blob/5bbb2aa82d86456dbf03305c3704cbd4fa93473f/src/StdJson.sol#L52 Hey :) I’m getting the error [FAIL. Reason: Memory allocation overflow] on one of my tests. it happens when I run abi.decode() like so:   (    address voter,    uint256 proposeId,    Choice choice,    IndexedStrategy[] memory userVotingStrategies,    string memory reason   ) = abi.decode(data, (address, uint256, Choice, IndexedStrategy[], string)); This code used to work perfectly before I added the string memory reason.",452
1695,foundry-support.txt,"Are there any size limitation to abi.decode()? Or something else I’m missing? Will try thanks I think yes chisel says that it would work Also bytes4(json.parseBytes()) should work as well pls open an issue with a repro this is a bug The reason it didn’t work is because json.parseRaw will deduce it’s a bytes type, so it will take the bytes(0x..) and then abi-encode it to the bytes type. So what youa re reading is the bytes of the abi-encoded bytes. So, first we have to decode that to type “bytes” abi.decode(data, (bytes)) and then you can cast it to bytes4. yy I know, I need to write more docs Is there a way to use foundry to return the key of all entries in a mapping? Thought I was onto something with cast index but that just gives me the storage slot of a known key Opened an issue with steps to reproduce here https://github.com/foundry-rs/foundry/issues/4406 Even the mighty MultiCall3 can't be verified on the Blockscout ETH explorer via foundry right now. Or I am totally missing something here is there a way to reset a contract's state after its been etched? currently etching an ERC20 implementation to an address (provided by the fuzzer) and it looks im colliding with some previous state Wild thought: what if you etch an implementation that has a selfdestruct function. Calling that function should reset the contract state, right? Then you etch the desired new implementation, and you will get a totally clean storage (which unfortunately also means that variables set in ERC20 constructor will be left empty). Except that vm.finalize is still not here yet You can use diamond storage and update the storage structs location. That will basically reset all state variables haha this sounds like it would work for me. only issue is self destruct is getting dropped in a future version I'm working on a ~token fuzzer, where a fuzzed unit test has to use one of the many weird ERC20 impl (USDCs 6 decimals, USDT fee-on-transfer, etc) Hi everyone And it wouldnt work because state wouldnt be finalized yet and the code would still be there? is there a way I can assert bytes a is greater than bytes b?? Does it fit into 32 bytes? If so then just convert to uint256.",495
1696,foundry-support.txt,"If not you’ll have to load it in 32 byte chunks and compare values ill try this No Then first convert to uint256(bytes32(data)) and compare. If they are equal, then you have to load the next 32 byte word and compare error[9582]: TypeError: Member ""startBroadcast"" not found or not visible after argument-dependent lookup in contract Vm. --> contracts/script/LZSandbox.sol:259:3: | 259 | vm.startBroadcast(PRIV_OMEGA); | ^^^^^^^^^^^^^^^^^ 24 uint PRIV_OMEGA = vm.envUint(""PRIV_OMEGA""); you likely have a very old version of forgestd. run forge update I ran foundryup and looked at the docs and the docs portend this is in fact a method forge update ok hmm, still complaining the forge update command prints nothing to the terminal how did u add forge-std as a dependency? forge install? long time ago, I don't remember. it wasn't even me I don't think what’s the path to forge-std if you started the project with forge init it also would have been correctly added these are my dependency imports in this script 3 4 import ""openzeppelin-contracts/contracts/token/ERC20/ERC20.sol""; 5 import ""forge-std/Script.sol""; 6 import ""forge-std/console.sol""; 7 if you run forge remove foundry-rs/forge-std then forge install foundry-rs/forge-std it may fix ur problem this is a monorepo with a contracts directory with these relevant remappings ds-test/=contracts/lib/forge-std/lib/ds-test/src/ forge-std/=contracts/lib/forge-std/src/ remappings.txt in the root dir libs = ['contracts/lib'] in toml ah monorepo i don’t have a ton of experience with. git may be acting weird because of it I'll try the above see if it helps Still having a problem delete the forge std folder and run forge install - this may fix it it may not. if it doesn’t you’ll have to do some git surgery i think wait actually you may be able to just update git submodules google the command for that i forget looks like I'll need some git surgery.",466
1697,foundry-support.txt,"submodule update didn't work nor did removing the std folder and reinstalling it actually after that, running forge update seems to have done the trick thanks for the help does rollFork(txHash) reset the fork? seems like i have to make my contracts persistant otherwise they gone Oh yea you need to make your contracts persistent if you want to keep them across forks think that’s documented? missunderstood the comment, thought it would keep state, also i found a bug, if i transfer weth, then do rollFork(hash) with a tx which also transfers weth, and then do another weth transfer myself, the program panics is it just me or the forge fmt integratio of the Solidity VSCode extension isn't working? Not sure Can you unpack what is not working? I have ""solidity.formatter"": ""forge"", and run format on VSCode does nothing. Change it to prettier and it is working as expected using prettier Hey , the forge build works but vscode gives this error. Do I need to install some extensions or add some setting to remove this error? Hmm where's your openzeppelin dir This is odd What are steps to repro? lib/openzeppelin-contracts forge init , then forge install openzeppelin/openzeppelin-contracts Are you on latest version of the vs code plugin? yup recently installed the plugin when coverage report? I fork bsc-testnet, IERC20(usdt).balanceOf() is ok, but IERC20(usdt).approve :EvmError: Revert. why? i got it , thx is there a less hacky way to directly decode results from a cast call than command substituting? eg  cast --abi-decode ""function(input-parms)"" $(cast call addr ""function(input-params)(output-params)"" --rpc-url url) might definitly be an oversight on my part Just wanna say thanks for foundry Done, cheers! https://github.com/foundry-rs/foundry/issues/4409 Isn't it already outputted as decoded? That's why we specify the output params.",432
1698,foundry-support.txt,"If output params is not given, it'll return in abi encoded form yes it was an oversight Hi, in order to test internal function of a smart contract, aside modifying the solidity source code, is there any cheat code to bypass function visibility and execute it ? Hi There, is it possible to use Forge to create a contract using the binary output from a not Solidity compiler? I think there's no. bc solidity internal function doesn't have function selector ofc. u don't need forge, just send it as a payload of a transaction with the to address set to 0 If you want to have an internal function exposed, and you have the source code for the contract, you could do the following: contract A { uint256 private a; function _bar(uint256 b) internal { a = b; } } contract AExposed is A { function bar(uint256 b) external { _bar(b); } } Then use vm.etch() to set the bytecode for deployment of A to AExposed instead: https://book.getfoundry.sh/cheatcodes/etch?highlight=etch#etch This will also work in a forked environment, i.e. you could additional features to contracts that already exist on Mainnet. Ok thanks. Yeah that's what I was thinking of, thanks. Can we not use fuzzing params in setUp()? setUp(uint num1, uint num2) ain't working for me setUp doesnt take params nope you should put your params in the test Why is this script failing with this output when all my console.logs indicate there is no zeroth address? Script ran successfully. == Logs == HUB 0x6CE69f9d8DBCf47D624385bcf4d3973e12e2b511 SPOKE_0 0xaB85b7927864a98403224Cffa2Ed3c5ce7dc9594 SPOKE_1 0x8363858F385E693d20b9a711bAc20F2453D15271 PRICER_0 0x4E214A044cBb3A182491e59D9335B9f18FA463Ca Multi chain deployment is still under development. Use with caution. ## Setting up (3) EVMs.",474
1699,foundry-support.txt,"[0] 0x0000000000000000000000000000000000000000::fallback() └─ ← () Error: Transaction failed when running the on-chain simulation. Check the trace above for more information. For the script 344 contract ArmSystem is Info { function run () public { 345 346 console.log(""HUB"", HUB); 347 console.log(""SPOKE_0"", SPOKE_0); 348 console.log(""SPOKE_1"", SPOKE_1); 349 console.log(""PRICER_0"", PRICER_0); 350 351 vm.selectFork(RPC_HUB); 352 vm.startBroadcast(MASTER); 353 354 HUB.call{value:1 ether}(""""); 355 356 vm.stopBroadcast(); 357 358 vm.selectFork(RPC_SPOKE_0); 359 vm.startBroadcast(); 360 361 SPOKE_0.call{value: 1 ether}(""""); 362 PRICER_0.call{value: 1 ether}(""""); 363 364 vm.stopBroadcast(); 365 366 vm.selectFork(RPC_SPOKE_1); 367 vm.startBroadcast(); 368 369 SPOKE_1.call{value: 1 ether}(""""); 370 371 vm.stopBroadcast(); 372 373 }} A pattern like this has been working for me for the past week then all of a sudden when I made some seemingly insubstantial alterations it started to fail like this. Then I made this stripped down example, and it is still failing. It's because I did not have enough ETH at that target chain to transfer. Very confusing revert message here hey guys, getting the following error without location specification: Error: Compiler run failed CompilerError: Stack too deep. Try compiling with `--via-ir` (cli) or the equivalent `viaIR: true` (standard JSON) while enabling the optimizer. Otherwise, try removing local variables. When compiling inline assembly: Variable headStart is 1 slot(s) too deep inside the stack. Stack too deep. Try compiling with `--via-ir` (cli) or the equivalent `viaIR: true` (standard JSON) while enabling the optimizer. Otherwise, try removing local variables.",477
1700,foundry-support.txt,"shouldnt it tell me where this happens? How do we call SC function using foundry? I usually use cast, but I think I can use foundry so I can create function called ""callFunc(arg)"" or somenthing like look up forge script also why does using the --via-ir flag makes build take so long Is it possible to start a local Anvil fork and then roll it forward to a tx? eg fork from the previous block and then roll the state forward to the desired tx in the next block? I’m wanting to trace transactions using Anvil I can use npm to install chainlink successfully, but use forge to fail What's the fastest way to get the original constructor calldata for a contract address using cast? forge install smartcontractkit/chainlink thank you Still i have this error hey guys we are using foundry to write our tests under monerepo that is using hardhat framework , and we use foundry as sub-module one . and basically there is some imports or dependencies that are written with ts , is there any way that we can use them as bindings or some way else without converting them to sol ? Hey guys, has anyone here experience with forking arbitrum goerli? How does the blocknumber that you put into the terminal translate to the block.number? I have the impression, that there are some issues. Like does it take the ethereum block (that has multiple ARbitrum blocks)? And if yes, how can you access an arbitrum block directly? https://github.com/ProjectOpenSea/seaport just found this one Hey, getting a FatalExternalError when calling an external contract within a constructor when deploying a contract using forge script. Any idea what would be error? Hey, I don't know if this is by design but when I'm in forge test --watch and I edit a file while foundry is still compiling it ends recompiling the whole codebase instead of only the file I just changed. It becomes really frustrating with big codebases where compilation can take up to 1 minute.",418
1701,foundry-support.txt,"Is there a way to mitigate this problem or should I file an issue? is there a way to clear recorded storage read/writes? if i override 90% of a an abstract contract how does that affect the size of my contract? Do i add any bloat with the abstract? or does it make no difference? Im wondering if i should simply write the last 10% also myself or keep the abstract in Hello. is there tool(plugin) for foundry, which past pragma and licence comment in new sol files? or maybe plugin for vscode ide optimizer only includes parts you are using assuming here you are using a recent version of solidity I replaced 0.8.18 with 0.8.19 in my solidity files, then I ran forge build and got this error ""[⠢] Failed to install solc 0.8.19: Unknown version provided"" So reverted the changes to 0.8.19 but now forge build keeps returning the same error I have tried to remove ~/.svm, the out directories as well as .foundry/cache but still getting the [⠢] Failed to install solc 0.8.19: Unknown version provided fyi 0.8.19 support should land today Is there an issue already open I can track? it should only recompile all contracts affected by the change but if the change is in a contract deep in the tree then this will essentially include the entire tree https://github.com/foundry-rs/foundry/issues/4412 will trigger a release when added Hello, is it possible to get exact contract line where rever occours during foundry test? Say I have error error NotApproved(address) and I am writing test for that how should pass the address to that error in vm.expectRevert()?? As the revert selector is like vm.expectRevert(NotApproved.selector) have you tried adding -vvvv ? yes, and I receive information about the function where the error occours, but just wondering if it is possible to get exact line somehow That makes perfect sense. However I'm quit sure I'm only modifying contracts that are at leaves of the tree. Like unit tests from which no other test is inheriting. Does anyone know where I can find the implementation for test forking CI has been breaking lately on FAIL. Reason: Setup failed: Could not instantiate forked environment with fork url: ***] but it hasn't been updated.",496
1702,foundry-support.txt,"Any recent changes that might account for this? Tests work fine locally. this usually means it's a flaky RPC that couldn't be connected to, it happens in the forge-std repo a lot when we test the public RPCs Is it common for this to happen to previously working RPC's? depends on the RPC, for public RPCs that have no auth it's fairly common, for a standard e.g. infura RPC that you need an API key for it's not common From own experience: some of the non-ethereum ""archive"" RPCs throw if the block height you're using is too old. At least I've observed this for some of the Canto, and I think Klaytn public nodes I was using an Alchemy RPC for the CI so that's pretty strange. And an Infura RPC for testing locally which worked fine. I'm going to change out the Alchemy one used by the CI and see if that works. Is there a way to fetch all events emitted on the contract in all its existence in a solidity script look up vm.recordLogs cheatcode If this persists let’s investigate recordLogs allows me to only get the events out of the calls I do in the script but not from its historical activity, no? oh yea For that only with ffi would possible I guess? I also came to here looking for ways to customize a forge script with command line args. Are env vars the only option? did you run forge script —help? it has the command line options available. it’s quite extensive if it’s not listed there, it is only available via env variables. in general there shouldn’t be anything that is env variable only except for picking a profile iirc anyway to mock a call revert? I'm working on writing a forge script to deploy and initialize some state for a contract. I'm using the following command / settings to run my script. forge script script/fillorders.s.sol --rpc-url ${LOCAL_RPC_URL} --private-key ${PRIVATE_KEY} -vvvvv --broadcast --slow --ffi Here is some psuedocode (I can't share the actual repo) for how the script operates: vm.startBroadcast(); orderFiller = new OrderFiller(...); address alice = 0x...; // Creates a time-locked locked staking position. // When this function is called, the passed // in duration is added to the block time to compute // the maturity of the locked position.",499
1703,foundry-support.txt,"  uint256 index = stakingContract.stakeForDuration(200 ether, 360 days); // external function uint256 maturity = stakingContract.getStakeMaturity(index); // external function // This function checks that the passed in // value of maturity matches the maturity of the // referenced locked stake. To do this, this function // internally calls stakingContract.getStakeMaturityFor(alice, index); orderFiller.fillOrder(  ...,  alice,  index,  maturity ); // external function vm.stopBroadcast(); During the local simulation phase, I have some logs set up within the implementation of fillOrder that have shown that the passed in value of maturity does in fact match the actual maturity (result of calling `stakingContract.getStakeMaturityFor(alice, index`)). However, when foundry starts broadcasting the transactions from the script to my forked node, the call to orderFiller.fillOrder is reverting, with the issue being that the passed in value for maturity is not matching the true value. - The value being passed in is the value computed during the simulation phase. - The actual value ends up being a larger timestamp then the value passed in, causing the revert. So I believe the issue is because the variable value maturity is computed at the time of simulation, and this is the value that is being passed into the call orderFiller.fillOrder. The behavior that I'm looking for is for the value of maturity passed to orderFiller.fillOrder to reflect the state of the chain after the transaction representing the call to stakingContract.getStakeMaturity occurs during broadcasting. Is there some way to accomplish this using forge cheatcodes or some other method? I tried some stuff using vm.warp preceding both my calls to creating the locked stake and filling the order, but had no luck. Is it possible to directly debug calling a function just using bytecode from the command line with cast? Thank you for your reply! I was asking about customizing my scripts behavior. I.e. I have a script that let's say deploys a contract and initializes it and I want users of said script to be able to specify the initilization arguments. We currently use ENV vars to do that (which then get read in the script), but felt that it was a bit brittle and not the most developer friendly e.g.",477
1704,foundry-support.txt,"forge debug --debug 0x363d3d373d3d3d3d363d73 --sig $FUNC - trying to figure out the fastest way to dig into custom assembly Hello guys, may I know can I check the base gas fee and priority fee by cast tx? Also, can I send a transaction with lower gas than current base gas fee in order to let it be pending? sir , in foundry , do we have something like etheno that helps us catching the infos during running tests overt local anvil and automatically write them into some json files or so is there any plugin like this ? actually i've found no results on corpus support on foundry , just like etheno's job on echidna is there any alternative for this ? Hi 👋 Is there an forge script example using --ledger to deploy a contract somewhere ? As far as I know env variables are the only way... You could make it easier by setting up a bash/sh script or alias that will take it as arguments and then set the environment variables.. may make it a bit easier Can I send a transaction with cast send without checking the wallet balance? Hello, I set the —gas-price value in a forge script to 37GWEI and the command doesn’t allow me to broadcast it because the simulation fails due to insufficient fund but the issue there seems to be that the 37GWEI gas price is not used for simulation. Should I report a bug? And is there a way to “force broadcast” the transaction? Changing out the RPC worked. What's the best way to impersonate an EOA account? To test .iscontract() You mean to impersonate not an eoa? An EOA 🙂 So I could use ! or expect revert or whatever vm.prank() How would I tell it its an EOA tho Is there a generic term for EOA or just use an actual EOA address prank method takes an input address.",396
1705,foundry-support.txt,"Give whatever value you like over there So an actual EOA address? Is that best practice? Not sure if that's the best practice but I just use address(0xdeadbeef) :) lol ok, thx I think 🙂 😂 yeah that was gonna be my work around for now, thanks # Go paths #export PATH=$GOPATH/bin:$PATH #export GOPATH=/Users/$USER/go export GOPATH=~/go export PATH=$PATH:/usr/local/go/bin:$GOPATH/bin # export PATH=""$PATH:/Users/<MYUSERNAME>/.foundry/bin"" # export PATH=""$PATH:/Users/<MYUSERNAME>/.foundry/bin"" export PATH=""$PATH:/Users/<MYUSERNAME>/.foundry/bin"" when i install foundary the PATH seems to overwrite the .zshrc PATH for go and that stops working ? any ideas ? Token private usdc; NFT private nft; function setUp() public { usdc = new Token(""USD Coin"", ""USDC""); nft = new NFT(""NFT_tutorial"", ""TUT"", ""baseUri"", usdc.address); } give me the error ``` Compiler run failed error[9582]: TypeError: Member ""address"" not found or not visible after argument-dependent lookup in contract Token. --> test/NFT.test.sol:17:57: | 17 | nft = new NFT(""NFT_tutorial"", ""TUT"", ""baseUri"", usdc.address); | ^^^^^^^^^^^^ ``` can i deploy two contracts like this and reference the addres of the other ? address(usdc) Hello, How can I send a transaction using cast send --gas-price with lower gas price than the current? Could you share script? ty Never came across this issue , Can u try in another env ? Manual install go , source path , then do foundry install proc think from memory i installed go via homebrew and it set the PATH in the same way forge does so they conflicted, thought i'd mention it, will update if i find any more info.",421
1706,foundry-support.txt,"gmgm, wondering if its possible to debug storage slots or memory slots in foundry? Anyone know how to run cast send --create for deploying a contract but also pass in the constructor args? cast send --rpc-url goerli --private-key $PRIVATE --create $BYTECODE $CONSTRUCTOR_ARG is not doing the trick (for a constructor with 1 arg) hey @gakonst i notice that in our foundry book , there is no description about fuzz_seed option , https://github.com/foundry-rs/foundry/issues/991 but according to this , it has been done For querying live storage you can use cast storage $CONTRACT SLOT_# e.g.",142
1707,foundry-support.txt,"cast storage 0xf99CC43dF160b7185F0c2903D1c87bC8300D7a94 1 For debugging storage and memory you can write up a test and forge test --match-contract ""ContractName"" --debug ""FnName()"" Or on a past tx via cast run $TX_HASH --debug https://github.com/orgs/foundry-rs/projects/1?pane=issue&itemId=7880495 found this was still ongoing Hello, is there any development on this? https://github.com/foundry-rs/foundry/issues/4060 what are the alternatives to verify a contract? I have all the code setup in foundry and there are some dependencies I find it easier to create a script FYI: the link of docker container is broken here https://book.getfoundry.sh/reference/anvil/#usage-within-docker Hey 👋 I just found this and also read about this in the docs but I get a different output after using vm.prank: Thats the source: vm.prank(address(5)); erc20.balanceOf(msg.sender); Trace Output: [72421] erc20Test::testTransfer()  ├─ [0] VM::prank(0x0000000000000000000000000000000000000005)  │ └─ ← ()  ├─ [2655] ERC20::balanceOf(0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38) [staticcall]  │ └─ ← 0 Am I doing something wrong? hey is this still being a thing? https://github.com/foundry-rs/foundry/issues/272 can I encode packed with cast? maybe if I cast --concat-hex two addersses it will be equivalent to abi.encodePacked(addr1,addr2) How do I write a function signature that returns a bytes array? ""spokes(uint16)(bytes)"" - this gives could not decode output.",429
1708,foundry-support.txt,"did you specify the wrong function return data type perhaps? no, but you can open an issue concat hex looks to work yeah but only for hex values how do I encode a signature that returns bytes? spokes(uint16)(bytes[]) and spokes(uint16)(bytes memory) both don't work as well I guess if it is raw bytes, I don't need to specify a return type Hmm though there is a little more in that output than I would expect 0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000280ccb2df4109140afd8baeba7f9aed3795efeb0ec2405812b40952e4606beac3578727394781218e1000000000000000000000000000000000000000000000000 when I would expect a packed encoding of two addresses Hey team, wanted to ask if it was possible to add eth_maxPriorityFeePerGas to the Anvil Node? My team is using the Golang Geth generated bindings to interact with the chain, but we are adding integration tests using an ephemeral chain. We tried hardhat node but they don't implement this method as it's Geth Specific. When we tried todeploy a contract using the geth bindings pointing to a hardhat node, it fails for this reason. Would be great if the anvil team could take an edge here, even if it's hardcoded to any value for testing How can I solve this situation? The contract I need to test is version 0.5 you need to build foundry with debug configuration setup https://github.com/sambacha/foundry/pull/27/commits/c426ebc0b3ff95c170c99d851e7f3f9883964ca5 see the local profile Hi, Does anyone know where i can access the information as to what is stored in each slot? Like slot1: someVar slot2: someVar ...",430
1709,foundry-support.txt,"I can parse files but I cannot find the info! hi, has someone built an helper to convert wei units in a human readable format? (like ethers.formatEther) echo 1000000000000000000 | cast --from-wei https://eth-toolbox.com/ U mean ‘’’weiNum / (10**18)’’’ ? msg.sender won't change in the test file itself you should use deployCode instead of importing the contract and using the new keyword https://book.getfoundry.sh/reference/forge-std/deployCode?highlight=deployCode#signature https://book.getfoundry.sh/cheatcodes/load I need the other way round.. i want Variable X is in Slot Number Y readLine https://book.getfoundry.sh/cheatcodes/fs?highlight=readline#signature followed by https://book.getfoundry.sh/cheatcodes/parse-json?highlight=json#decoding-json-objects-into-solidity-structs Hello, is there any solution to this? I am having same issue but after reading documentation and issues don't have a way to actually do that. This. Have you tried --skip-simulation Sometimes scripts take a long time to run, and they will say ""script ran successfully"". Then right after that, it says they are spinning up N evms - for the .selectForks. But didn't the script just run successfully? I have something weird happening in my forge scripts. It seems like the tx.origin keeps getting overridden and replaced with 0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38 Im using startBroadcast, and it usually works well. I just updated foundry. Did something change recently? Ah yes, we can. Can you open an issue to track? Should be easy On both forge scritp reports above please open issues, it’s a bit too general to know We don’t havea that yet; should be simple fix to log the hash even on reverts. Can you open an issue? actually it's even weirder. From my script, I deploy a contract and call it. And it seems like the tx.origin is changed in between.",456
1710,foundry-support.txt,"How is that possible? And we also don’t have cast call —debug although I suspect somebody should be able to hack it together from teh cat run code the code looks like that import { console } from ""forge-std/Script.sol""; contract MyContract {  function test() public payable {   console.log(""before"", tx.origin);   contract2.xxx();   console.log(""after"", tx.origin);  } } before and after log different values alright, just opened an issue. https://github.com/foundry-rs/foundry/issues/4434 weird, I'd like to know too how do I properly test scripts for contracts that use msg.sender in their constructor (i.e. contracts implementing Ownable)? I got this deployment script that deploys a token, adds liquidity for it on a dex, and then enables trading, so in the setUp function of a test I put DeployToken deployer = new DeployToken(); and then called deployer.run(); so then I wanted to write tests for buying/selling/etc. but the owner turns out to be 0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38 and not the test contract and I cannot prank the script call because then I get Setup failed: You have an active prank. Broadcasting and pranks are not compatible. Disable one or the other How does forge handle reverts in its gas report? I'm getting outrageously large numbers for functions I call with expectRevert Calls should revert with the expected amount. Maybe some weird interplay with expectRevert? Yeah my tests are passing with expectRevert Just the gas amounts that are off by 1e12 Sounds like a but, issue with repro and we'll fix Hello everyone, I'm new here, please take care of me Hi, Is there a way to use --strict-assembly during the Forge test? Or any other 'solc' options while I use forge test. hey guys , any way that i can run my ts tests(for deployment ) on anvil ? is there a way to change it within the test files? Morning All, can some kind soul please point the direction for interpreting the cast revert message e.g. data: Some(String(""0x08... Up. Still got the issue, even after re-installing everything from source.",481
1711,foundry-support.txt,"Is there anything else to configure on chisel? I'm running into weird issue where test fails with [FAIL. Reason: Assertion failed.] but there are not assertions left and test finished successfully Code: Output: any ideas? this is super wierd now, removing vm.expectRevert() makes the test pass even though the test reverts changing the expectRevert() so that it expects wrong revert value (change 0 to 1) - properly gives error that it reverted with wrong error this super wierd, probably a bug, but I'm unable to come up with small test case for this When using expectRevert, no need to use testFail as function name ffs totally forgot that forge does that thanks @grimreaper619 Been there, done that xD Hello, when I compile my contracts and test them I dont get any error, but when I try running forge coverage i get stack too deep error. Does someone know why this happens? Maybe you are compiling with —via-ir Hey, I'm getting this error, which is weird because I'm not even using the fuzzer or invariants Should I open an issue? How do I force it while running coverage? I’m not sure try to just add that flag But regardless I recommend trying to fix it directly and not compile using via ir it gives mad issues imo I tried but it doesn't work I tought I had fixed it already, I was getting the error while testing too before... I didn't started using via-ir to fix in testing/building It seems its another function that it was giving the error, but its weird that I dont get the error while testing or building.",340
1712,foundry-support.txt,"you might just need to add pragma experimental ABIEncoderV2 to your test contracts (they inherit from StdInvariant by default) This worked, thanks Matt! When --rpc-url ${RPC_URL} is used for tests / scripts, how is the affected chain state stored? Or does it only read the relevant data and infer the state changes? @msolomon4 saw that you were the author that propose corpus saving and fuzz seed option over github discussion Can we run typescript tests from hardhat (since we are working on hardhat-foundry hybrid) over anvil and save them into some json files and feed them into our fuzz testing files to run ? Currently from i reading foundry book , we can only run tests on either foundry & hardhat seperately but i wonder if we could run those tests in a cross manner Yeah.",170
1713,foundry-support.txt,"I prepared a repo for that https://twitter.com/timurguvenkaya/status/1630251561971773440?s=20 你们这个在windows中，安装不上 能不能解决一下 ？？？？ it's a rust binary so it should work ok on windows, you may just need to rebuild- cargo has instructions for how to retarget but this support channel is in english 我知道，我们中国时间现在凌晨1点 我的意思你们可以把弄得好用一点 😭 等下我给你发下我的报错 Is block.timestamp supposed to always be 1 in tests? 安装就是问题 just send the error report and people can point you to the right documentation it's probably a very easy fix 好的，感谢您 我英语实在不好 try git pulling from this https://github.com/foundry-rs/foundry alternatively do you have WSL 我就是在这里面提取的 没有 你可以用谷歌翻译，它会比我的 HSK 1 好 🙂 666 你真好 👍 我的就是这个报错 我实在解决不了啊 谷歌出来的，都是Liux的 can i see more error message further down 帮下忙朋友 oh wait no i know why okay you absolutely have to use WSL dude sorry maybe a regression? we should definitely be supporting windows native build WSL是啥啊 https://github.com/briansmith/ring/blob/main/BUILDING.md this might help 好的👌🏻 朋友，感谢你 that's also, yeah that's what you want 明白 next time english pengyou 这个能不能做到windows兼容性好点 好的，我一定好好学习英语 🙏🙏 ask @gakonst that but the answer is probably ""they have better things to do"" 🙂 我是不是用mac M2 兼容性会好点 不会出现这种问题 yes....",490
1714,foundry-support.txt,"that will work very easily you should just start with that honestly windows，我已经诚实的开始了 都是坑啊 https://github.com/rust-lang/rust/issues/63939#issuecomment-1288154718 Check this guide out, seems to be issue with musl-gcc 雾 好的，感谢你们 我的朋友 算了，我不试了 这个也不行 你们回头出个改进方案吧 感谢我的朋友们 以后，我都是你们的支持者 交个朋友🤝 交个朋友 🤝 你们一定要好好弄，要和hardhat，truffle，他们竞争 你们update，记得通知我奥，来自中国的朋友 虽然，今天问题没解决，我还是会给中国的朋友说的，foundry是个好团队 👍 Can you try this? cargo install --git https://github.com/foundry-rs/foundry --profile local --locked foundry-cli anvil chisel — Or download binaries from here: https://github.com/foundry-rs/foundry/releases/tag/nightly and move forge.exe to C:\Users\ your username \.cargo\bin\ Hey - this is an English chat so please translate your messages 🙂 Understanding it’s not alweays convenient You should use WSL Okay, I understand. I'm sorry I have tried this, but there will be other problems If you need to repeat, I can let you remote my computer to solve this problem, which is also helpful to the community Hi Team Foundry! I'm having issue with installing a specific commit of a remote repository using forge install.",400
1715,foundry-support.txt,"Command: forge install https://github.com/Toast-Market/core-protocol.git@34f35fe Error Installing core-protocol.git in ""/Users/megan/git/periphery-protocol/lib/core-protocol.git"" (url: Some(""https://github.com/Toast-Market/core-protocol.git""), tag: Some(""34f35fe"")) Error: Tag: ""34f35fe"" not found for repo: ""https://github.com/Toast-Market/core-protocol.git""! However the commit definitely exists in the repository, see image. Weirdly it works for some older commits. Do you have any idea why this may be? did you end up trying to do a standard git clone? of the commit I cloned the repo and the commit is there but haven’t tried cloning a commit, good point will try now actually not sure how to clone a specific commit, i can clone the whole repo and checkout that commit can you suggest how to test if it's a git issue? isn't it because it's private? that might interfere somehow i have access and why would it work for older commits never had this happen before i mean aside from this, if i forge install wihtout specifying the commit i end up getting an older version as well i didn't change any configurations or anything between the commit that works and now actually having the same issue when i add a git submodule so is a git issue, anyone come accross this before? currently you cannot feed inputs from a file into to the fuzzer, the best you can do right now is use the seed to get deterministic fuzzing yes, this is the default value, but if you fork the timestamp will match that of the block you forked at FYI this fixed it Tried some solutions shared here but nothing worked… trying to update a lib dep with latest commit but nothing works. forge update doesn’t do anything, removing all the deps and reinstalling doesn’t do anything either, « rebooting » the submodules too… anyone experienced that? Try removing the lib dir and do a git submodule init && git submodule update Is it supposed to reinstall the submodules? Yeah.",436
1716,foundry-support.txt,"Had the same issue before when forge-std wasn't updating Because it didn’t for me 💀didn’t even created a new lib directory How does your .gitmodule look like Try specifying branch branch = ""master"" didn’t change anything Hey folks anyone know how to properly expect a standard arithmetic underflow/overflow error? It's showing that it reverts with ""NH{q"" hey guys, am trying to use ignored_error_codes = [5159] on foundry.toml to avoid selfdestruct deprecated warning but seems it doesn't works, any thoughts? selfdestruct"" has been deprecated. The underlying opcode will eventually undergo breaking changes, and its use is not recommended.solidity(5159) is there a way I can mute this warning? @grimreaper619 managed to make it work, but completly removed all submodules and reinstalled all manually from scratch im working on a project which compiles without issues using forge build no optimizer, no via ir running forge coverage it complains about stack too deep is this known or should i raise an issue? this is a known limitation of coverage, it ignores your build settings because it only works with no optimizer and no via-ir Is there a way to roll+warp together so that if I want to roll forward 1000 blocks, as an example, it'll roughly warp the ""correct"" number of seconds assuming average block time Eg.  function _rollWarpByBlocks(uint256 rollToBlock) internal {   uint256 currentBlock = block.number;   assertTrue(currentBlock < rollToBlock, ""Can only roll forward in time"");   uint256 diff = rollToBlock - currentBlock;   uint256 warpTime = diff/12;   vm.roll(rollToBlock);   vm.warp(block.timestamp + warpTime);  } Is there anyway to strip ANSI color codes from forge build? Raw text output like ^[[31merror[4937]: ^[[0m^[[31mSyntaxError: is hard to parse if writing custom editor error parsing around forge E.g.",419
1717,foundry-support.txt,"would be nice to have a --no-color option Hey guys, what are some top foundry project/repos everyone should review as part of there learning to use foundry? seaport Uniswap permit 2 and universal router every makerdao codebase How does import ""forge-std/console2.sol"" work out of the box without any explicit remappings, given the actual file is in lib/forge-std/src/console2.sol? Does the same apply to ds-test? @msolomon4 https://github.com/foundry-rs/foundry/issues/991 yeah i have read about determinitic fuzzing on our foundry before just wonder if we could feed some json files to our fuzz testing one day if so , that will be helpful When testing using Foundry, I'm getting some odd behavior on custom error reverts. I use expectRevert with the selector, i.e customError.selector but it actually reverts with the custom error formatted as a string, i.e ""customError()"" or ""customError(param1)"". After looking at the bytecode only the selectors are present and not the strings, therefore I can only assume Foundry is doing this conversion internally.",240
1718,foundry-support.txt,"If so, why is it doing this? How do I turn it off? hey guys i was running npx hardhat init-foundry in my contracts folder , and it outputs that module not found in index.js , how can i fix this ? i was running npx hardhat compile on our hybrid foundry project and here is the output : Error in plugin hardhat-foundry: User-configured sources path (./contracts) doesn't match path configured in foundry (contracts) what does the user-configured sources path here mean? Hey there, am getting reverts when fuzzing This should show the bug I'm seeing I am summing 2 random u64, and they somehow overflow even though I'm saving them into a u256 Nvm, hari came in clutch shouldn't this be uint256(initialAmount + secondAmount)? Your expression in this sense is weird in terms of my error on this i've checked my toml file as well as hardhat config, they are both ""./contracts "" so don't know why this persists , anyone have any thoughts ? vm.prank is there a way to run a piece of code after all tests run? like a setUp but after the tests interesting question , never thought about it before btw, why do you need such thing ? It is because we have remappings.txt , see this https://book.getfoundry.sh/config/vscode?highlight=remappings.txt#1-remappings this is how it looks like inside of it : ds-test/=lib/forge-std/lib/ds-test/src/ forge-std/=lib/forge-std/src/ is this a bug for real like it says at the bottom, or could just be a bad rpc? though it was all working up until 10 seconds ago lol and I tried 5 different rpcs and nothing works anymore without changing anything obviously the node is running tendermint btw, if that makes any difference you could also just have a concrete test and read in the JSON file then loop over the values since it's not really a fuzz test if the values are hardcoded anyway 🙂 I am running fuzz tests and storing each run's output as a json file. Then I use vm.writeLine to write the json to the file. In the end I get the following structure {jsonInfo1}{jsonInfo2}{jsonInfo3} and so on, which is not formatted.",483
1719,foundry-support.txt,"I would like to put an opening [, then a comma after every json and in the end, a closing ] Maybe you need an archive node RPC? It says node is pruned, so probably the block data of the block you're trying to access is not there anymore but it was working just moments ago, shouldn't it have cached the mainnet fork? since I specified the block number at which to fork and all of that 🤔 How can I keep --via-ir from compiling all files whenever I change a single one? Just bumping that I'm having some issues expecting underflow/overflow errors, getting a revert message ""NH{q"" lol If anyone knows what's up, if not I will create an issue. What's the repro? Is this supposed to happen when I change a file but the watcher is still compiling? Because if it's not the case it might be the source of this problem Have any of you noticed forge coverage giving incorrect results (e.g. 0% coverage for a contract when all functions it's checked in a test file)? I've seen thing happening and suspect it's something related to project structure or import paths, but if any of you have ran into this please let me know! hi frens, any idea how to cure? just rm everything is meh but if thats the only option… i get an ""Index out of bounds"" error — even with -vvvvv, it doesnt tell me the line number and loop iteration count; how can i get that? edit: just commented out code till i got it sorry for bring it up again , as i am still stuck at this issue any view on this for me to cure ? @gakonst me and my friend are both on this issue I found the relative description in hardhat's doc : Two of Hardhat's paths are updated: the sources path to make it match the one used by Foundry, and the cache path to guarantee that a different one is used, preventing potential issues.",408
1720,foundry-support.txt,"what does this mean not clear about this yet , but it is about path management in hybrid project from my understanding , in hybrid , hardhat and foundry's cache are using different path , so that they don't conflict with each other i changed the source path defined in foundry.toml into src = './contracts' but it still outputs that Error in plugin hardhat-foundry: User-configured sources path (./contracts) doesn't match path configured in foundry (contracts) where the path in foundry is still contracts even though i change it back to src = 'contracts' the result is the same okay , resolved i change the hardhat.config.ts 😘 @msolomon4 Instead of just one random input value to our foundry fuzzer , can we do it in the speace of structs ? in terms of this , i think it is more like of doing those random inputs in parallel , any thought ? thanks can i run forge coverage on only part of the project that compiles without optiizer on? as in can i specify a path ot something for which the coverage should run? hello, I have a problem with “cast nonce 0x111Dc940C7de9546Ff64E700FeeF2CC666Cf9960 Error: ens name not found: 0x111Dc940C7de9546Ff64E700FeeF2CC666Cf9960” IIRC all the code get compiled before going to coverage, so you'll have to find a method to separate your code for your coverage. Naively i would use stub/mock for the parts of your code that doesn't compile and use a specific compilation target that does this separation e.g: copy to a temporary directory/change include path of your required code and test/coverage it using this context. The goal being able to compile the code without actually touching it. My 2ct hm ok seems will rather try to make the ful project run without the optimizer on thanks 🙂 That's an other option, enjoy! on another topic the coverage run against all contracts that dont have Test in their name ? but i dont want it to run against mock contracts, set up contracts etc..",449
1721,foundry-support.txt,"can i specify against which contracts to run the coverage (to include in report) ? https://gist.github.com/0xask3/66423cfb78bae37db1e539d7fd3324a0 A small utility script I use for coverage. You can strip out unwanted files from the report. Might be helpful You'll need to install lcov beforehand though Thanks for the amazing script! Nice! We go with another solution: We add an empty function like testMock() or testFoo() to every mock file that should not be considered as a test file, this also removes these files from the console output of the coverage command. Does Forge have a ""verbose mode""? The forge snapshot commands hangs indefinitely while running our invariant tests. We let the command run for 30+ minutes, typically it takes 1-2 minutes to finish locally I need it to investigate why the command hangs Passing -vvvvv doesn't help, no output gets written to the console Yeah that's a nice workaround as well. I use this mostly for the html output yep you can use structs as inputs for the fuzzer you can use RUST_LOG=forge=trace,foundry_evm=trace,ethers=trace forge test to get more info on where it's hanging @msolomon4 tagging you since it seemed you know quite a bit about the coverage feature. couldnt find anything in the docs on it apart from the basic command In my tests, what would be causing:  └─ ← ""stdStorage find(StdStorage): Packed slot.",322
1722,foundry-support.txt,"This would cause dangerous overwriting and currently isn't supported."" I'm not explicitly attempting to overwrite a slot in assembly etc, so what could be causing this? IIUC you are asking how to exclude certain contracts from the coverage report? you can't do it natively in forge, but you can with the lcov command, for example: https://github.com/ScopeLift/foundry-template/blob/f7591b2450cb5d5af23a5d7e26e86889f3ec2579/.github/workflows/ci.yml#L38-L78 (L59 specifically is where the filtering happens) solidity will automatically pack variables for you if they fit into a 256 bit slot, for example: contract MyContract { uint32 timestamp; address owner; } address is 160 bits, and since 256 > 32 + 160, solidity will automatically pack those both into a slot, but stdStorage does not currently support writing to packed slots @msolomon4 the error is coming from trying to deal tokens to an address with an existing balance on a mainnet fork ah thanks for this very helpful. So i can only filter in CI. Cant have the coverage report filtert when forge displays it So I assume the token balance exists as part of a packed slot in that case, the token contract is packing balances so you probably can't use deal with that token. I think aave's aTokens are one of the tokens that do this you can filter locally with lcov too, just won't be able to filter the summary table yeah, makes sense, thanks for the explanation happens with SNX, but not DAI/USDC you can manually still do it via stdstorage if you know the layout There a hack for this where you copy it , and the. Exclude those files , so they don’t show up in the summary. true yea that works also Did we talk about this neat future already, where forge test can be limited to compile only certain contracts? So that not all test files will get compiled? Like -m, but before compilation. 🙂 Background is that our test suite now takes 19.16s to compile, when we change one of our chore contrants. This is because this chore contract gets imported by so many test files.",468
1723,foundry-support.txt,"Would be awesome for development, if we could basically narrow down the compilation to one file with unit tests, and then, after the development of the feature, let the whole test suite compile and run. I think we already do that? We only compile the necessary files to match, but naturally if you’re importing files in your test, all of them will get compiled how ser? By default when you filter like you said, maybe needs --match-contract or --match-path instead of -m though Ah yes, but these 26 files take enough time 👆 chore contract changes, ""only"" 26 files get recompiled. 👆Comparison to forge test --force, obviously this takes longer. But not way longer. Would be awesome to narrow down the list of contracts in the test folder that need recompile. You know, what I mean? And obviosuly, still way better then the 20 minutes or so with Hardhat! ""Tests need to run fast."", Uncle Bob, https://blog.cleancoder.com/uncle-bob/2014/09/03/TestTime.html What is your expected minimum amount of files that would be compiled in this case? What does the dependency graph look like here? If you change 1 file that’s imported by 10 other files, then you’ll recompile 11 files; there’s no way around this Yes exactly, all of those files import the chore contract. All of them depent on the chore contract. We did a lot of tidying up of the dependencies on the way, as we had 40s compilation time. But now, with all the e2e tests it gets hard to remove the dependencies. So I want to double check, if there is REALLY no way around it 🙂 Yeah that seems to be about as good as you can get Are you using via-ir? Like, maybe, with a command, removing the test folder from the compile list, and only add one whitelisted test file. forge build --skip test oh and adding only one file that’s erhm No, that was way too long. idk we could force building of only 1 test if that’ what you mean but idk about this yeah something like this! From a user perspective, it would be awesome to have forge test --compile-only test/unit/this-one-file.t.sol .",481
1724,foundry-support.txt,"And then, everything in src gets built after a change, but nothing in test gets built, except this-one-file.t.sol Sure. Please open an issue with the feature request^^ you would run this in watch mode, obisously. So maybe the same logic that checks which tests to re-run in watch mode could apply here to check which test files to compile? with --fast-compile-mode. Argh damn ^^ Trust the process ah feature request, no pull request. Ok that I can do Done, thanks again for this awesome toolkit. What a luxus to optimize seconds at large test suits ❤️ Why in the trace logs output is set of numbers? Can I fix it? You are logging bytes? That is weird, can you try with console2.log()? it helps, thanks! Is there a way to execute RPC custom methods in a deploy script pointed to Anvil? I'd like to deploy a contract to a specific address using anvil_setCode. Hey everyone. I’m trying to test with custom errors but I am having issues with (1) the vm.expectRevert function and more importantly (2) have little idea of how to acquire the selector for the following custom error: Error SlippageOut(uint amountOut, uint minAmountOut); Thanks in advance Nevermind I think I figured it out why does forge's build output's bytecode include non hex characters? that contract includes a library that needs to be linked or an immutable variable so that’s a placeholder for that value this is direct output from solc iirc ohh I see, thank you! Any time I have a value that underflows, this happens If it means anything, the contract where the revert occurs is called via delegateCall, I'm investigating if it has to do with how the error message is bubbled up Shouldn't be the case. If any FE peepz here r doing that ANVIL FE , pls see https://github.com/emilk/egui It's very nice looking gamey one I am not going to attempt it since I'm still trying understand the foundry code base This is still a mystery to me, comes up 0 lines covered in libraries where all the functions are called in a test contract.",452
1725,foundry-support.txt,"Any ideas? What tool r u using for the coverage ? https://twitter.com/gakonst/status/1630740291648094208?s=20 Context Is there a way to use forge build --sizes to show the bytecode size WITHOUT the creation bytecode since that doesn't count towards the limit it already returns the size of the deployed bytecode only, not the creation code was facing this, then just saw on stackexchange to comment out branch in .gitmodules and then forge update, it worked but now i cant compile and it throws `Compiler run failed YulException: Variable _28 is 1 too deep in the stack [ JUNK JUNK _28 _3 _18 memPtr_2 srcEnd _22 src _2 _21 _23 _25 dst memPtr_3 srcEnd_1 src_1 dst_1 value_2 ] memoryguard was present.` Any idea how to fix this 😭 was running 1.1.0 wanted to bump up for some sweet features of 1.5.0 forge coverage Mm maybe update foundry ? Haven't seen errors of 0 coverage so far , but i work in an isolated env for forge stuff Ah jeeze. yikes! At least it's only yellow and not red! haha tried foundryup'ing already 😢 is there a way to execute a pure library function from the CLI? Similar to forge script but without a Script contract as wrapper? in a foundry test is it possible to get the current block number? void that found it. block.number is the only way to move to the next block in a test is with vm.roll? Otherwise its all in the same block? I am trying to test a governance dao process and for some reason when I governance.castVote its not getting registered. Any course for learning Foundary.? Hello, how could I install a PR from ethers-rs within foundry ? (this one https://github.com/gakonst/ethers-rs/pull/1687) Is there any helpers like the -pr from foundryup utility ? Hello. Is it possible to contextualize a contract in a Foundry test? e.g.",443
1726,foundry-support.txt,"have a portable test that verifies ERC721 compliance for backward compatibility of ERC721 mods? Easy enough to do in hh, because JS, how about Foundry? Can I have one regression test for all of my modified implementations without having to copy the testing code over and over again? https://github.com/foundry-rs/foundry/issues/407#issuecomment-1008291455 Found this discussion, would this be the only way currently? @msolomon4 Do you know any example integration tests that is open-sourced for me to learn about ? when using foundry coverage libraries internal methods are reported as not coveredl. external methods are. Is this a known issues or should i create a ticket @msolomon4 ? another unrelated question, do invariant tests get included in coverage? Hey all, do you know if it's possible to use stdstore to write to a constant variable? Hey, when enabling reverts in invariant tests, sometimes I see a revert from a fallback function call - how does that happen, considering that it was never added to the targetSelectors. also having a discord would be nice 😄 correct, use vm.roll. we have some DAO governance tests using cast vote in this repo which may help you. if it seems like the cheat isn't working, make sure you are on the latest forge version https://github.com/ScopeLift/flexible-voting/tree/master/test wdym exactly, can you be more specific about what you are looking for? there are lots of good foundry test suites these days, maple, optimism, seaport, etc i mean i am looking for the test suits that contain not only the unit tests , but also integration tests . as unit tests only about single functionality , but integration is about contracts whole behaviour. there are various known issues/limitations with coverage, I don't know all of them offhand so I'd recommend searching the github issues and open an issue if you don't see yours not currently, but this is being tracked in https://github.com/foundry-rs/foundry/issues/4007 check out the repos for the protocols I mentioned, I know maple has lots of integration tests and I'm guessing the others do also good support , sir if there is any article summary for the considerations , would be better but none is also fine lots of great resources in https://github.com/crisgarner/awesome-foundry Re: libraries.",492
1727,foundry-support.txt,"You'd need to have a separate helper contract to expose library functions for testing. See this comment for more details: https://github.com/foundry-rs/foundry/pull/3128#issuecomment-1241245086 @msolomon4 any idea for my question above ^ ? 🙂 Hi guys, cant build foundry, i try it on 2 machines and this packages doesnt building not sure why, but it can take a while sometimes so you just have to wait... Also you can try just building forge to see if it works cargo build -p ./forge sorry, im not that helpful 😂 someone else might know better it depends on your exact setup, fallback functions are part of the contract ABI though so forge will recognize/call them thank u 🙌 @msolomon4 even when using targetSelectors? isn't that the point that it only does calls to those listed? I believe so, but it may not always be exclusive, e.g. contracts deployed during the test are added by default. I'd suggest opening an issue with some code to repro plus your expected behavior Guys, how do you exclude mock files from coverage? Either like this or with the quoted script. Please use search before asking a question 😉 Add this to mock files, and you should be fine. Still my (personal!) prefered solution. When using vm.expectEmit is there any way to check for multiple events being emitted? For example, if I wanted to ensure a mint transaction is emitting both a Mint event and a Transfer event? Currently I'm just writing duplicate tests, but would be nice to consolidate into 1 event test Hey invariant test experts, is there any way to replay an invariant test sequence if we have the sequence? I have an invariant test that's failing sometimes, it prints the sequence in which the test failed but I'm not sure if there's a good way to repro it deterministically. I tried calling the exact sequence of functions in a separate test but that doesn't actually fail like I thought it would. You can vm.expectEmit for multiple events, e.g if I have some function that does emits like: function foo() external { emit Event1(); emit Event2(); // ...",450
1728,foundry-support.txt,"etc } then you can do a test like: function test_foo() public { vm.expectEmit(); emit Event1(); vm.expectEmit(); emit Event2(); // ..etc } and the expectEmit calls will check that the calls in foo are emitted in the same ordering as they appear in the test! (see the end of https://book.getfoundry.sh/cheatcodes/expect-emit) Ah great! It must have been an ordering issue for me, I tried the expectEmit and the test failed 😄 how can i read file line-by-line and using this lines in tests? Looks like my issue was caused by the invariant fuzzer calling the tested contracts with the address of one of the contracts under test, which was causing unexpected behavior... I think ideally there would still be a way to repro a failing invariant test sequence with the exact same set up as the failing invariant test sequence by calling the fuzzer with a seed or something so the behavior could be easily deterministically replicated. how can i fix it? Ah this is an issue in your RPC usually What are you using? Hi everyone Can I run “forge test” without compiling all the contracts? Anybody?? It should be the case by default unless you changed a contract on which all the others depend... That’s not the case by default sadly, forge test —mc Add Compiles all contract and run test for only Add contract I want to be able to compile and test a single file u could make 1. Make new repo 2. Put target .sol in SRC/ 3. Make test in test/ 4. forget test -vvvvv Is there any build-in support for testing with ENS, or are you best off just registering one on a testnet and forking it in the test? Hi all. I am facing a bug in forge invariant testing. I have added a github issue here https://github.com/foundry-rs/foundry/issues/4470 If someone could have a look that would be really helpful! Thanks in advance. why? You don't seem to be selecting the forked chain: https://book.getfoundry.sh/cheatcodes/create-select-fork thanks!! Maybe you can help with this?.. i have a problem with instaling foundry here, can you please help me? Maybe consider using WSL on windows works well You should dig on your own really.",493
1729,foundry-support.txt,"What's ""ourContract"" ? it is contract that implements getTokenReserves function From what I can see ""ourContract"" might not be initialized on the forked chain. Yes That's why what does that mean? It doesnt deploys? You deploy the contract before selcting the fork and you're not persisting storage how can i do this? https://book.getfoundry.sh/cheatcodes/make-persistent#makepersistent thanks🙏🙏🙏🙏🙏🙏 Did you figure out the gas refunds? I need to know, if the —gas-report counts in the gas refunds - cause I’m also clearing storage (and without clearing it’s even cheaper!) has anyone successfully used SMT solver with the github ci? Hi together, I try to write some tests with foundry and want to fork at a given block X including transaction A. When I do: vm.createSelectFork(URL, tx_hash_A); vm.transact(tx_hash_A); It does not seem to correctly execute the transaction A. If I use vm.createSelectForm at tx_hash_A+1, everything works as expected. But I don't want to manually look up every transaction behind my target transaction on a block explorer. Can someone help me? Thanks! @karmacoma_eth @brockelmore I went to create an issue for https://twitter.com/brockjelmore/status/1631466434936332288 but can't replicate the original examples in that thread any more. They all look like they decode OK now: https://gist.github.com/horsefacts/ebae1f2583953113b0909766dcd3c1dc. Where were you bumping into these, @karmacoma_eth? it is decoded properly in the trace, but not at the top level if you do vm.expectRevert(""SOME_ERROR""); [FAIL.",392
1730,foundry-support.txt,"This makes me wonder, do we have a quiet mode for anvil? Like the one ganache have with no logging at all. I just want anvil to be up and running, no need to see what's happening on the node Is there a way to completely remove gas limit for gas snapshot ""tests""? Greetings folks! Have a specific use-case where I need to watch-on-file changes and redeploy the script to the anvil (trying to make recompile on-watch along with wagmi/cli hooks work), but it just looks like that the --watch mode does ... nothing? Only a —silent mode for startup. Though you could start it as a background service Hey guys, I'm following https://book.getfoundry.sh/tutorials/solidity-scripting but I'm getting an error when running the script: ""expected newline, found an identifier at line 7, column 14"". Any idea? The warning in the import is: Source ""forge-std/Script.sol"" not found: File import callback not supported Foundry Support I think it usually happens to me when I import from the incorrect place Maybe try reloading ur vscode also it sometimes solves that I thought so too, but this is my layout. It *should* work Did that too. Maybe a PC reboot will work Then use relative import path instead and it should work I fixed the import problem, but I still get the same error 😂 I will reboot my pc and if that doesn't work I will create a new foundry application Having trouble installing foundry on my MacOS using the cmd line in the official doc page, is there an alternative? Wdym? How’d u fix it I’m pretty sure it’s an issue w solidity files in vsc when using these kinda alias path imports, so relative import usually works The reboot didnt even help I fixed the import warning, not the actual problem can u send the full errro I already deleted the project lol.",395
1731,foundry-support.txt,"Give me a couple of minutes and I will have the example running again That seems to have worked :) Can i give my token_address into arguments of function? Or maybe how can i read some file and get all data from it and call function for every element? Is it possible to deploy a contract to a specific address when testing? I know there is the vm.etch() cheatcode, but as far as I understand, this only sets the code but does not call the constructor, right? are there any good guides on converting hardhat projects -> foundry? can't seem to find any anywhere really. docs are pretty iffy in relation to that too. Does anvil come with VM cheats enabled or do they need to be enabled separately? hey guys, does anyone tried to use Foundry with TRON network (TRX)? Going to deploy my contracts there and don’t want to mix up my environment 😕 we are going to be so rich guys Hi guys, I can't find the signature for vm.deal function to deal ERC20 tokens. Is it still supported ? (2nd & 3rd function in this link https://book.getfoundry.sh/cheatcodes/deal) Use just deal Without vm Hi All, I am try to create a new contract using cast send but always ends up with just transfer to null address. I am using below command cast send --private-key=*** --rpc-url=*** 0x0000000000000000000000000000000000000000 --create 0x60806040****bytecode for the contract I dont know what I did wrong The function is not recognized I had to import the ""forge-std/StdCheats.sol"" and it was indeed exported as deal. Thanks man. Actually if you import forge-std/Test.sol it should also contain deal Afaik, you don’t need to change anything for vm cheats. Unless you mean impersonating an account in anvil? Indeed, I dont know what went wrong :/ Using functions like vm.prank() directly in Anvil (no forge) Hey sers, solidity noob here investigating erc721A need some help pls. So I created a contract that Mints 10NFTs and transfers four of them.",461
1732,foundry-support.txt,"I want to view the storage slot of the contract to see what each tokenID points to, how would I go about this cast storage <address of deployment> <slot> is just giving me 0x000 even when it should be the address minting the nfts (if done right) but forge create will not support raw bytecode right? Hi sers, can I create batch transaction using foundry cast? See this article: https://mirror.xyz/horsefacts.eth/Jex2YVaO65dda6zEyfM_-DXlXhOWCAoSpOx5PLocYgw Ethereum doesn't support transaction composition (batching) by default. You'd need to use smth like PRBProxy to do this: https://github.com/PaulRBerg/prb-proxy Hardhat and Foundry are different paradigms. I'd suggest working your way backwards from popular Foundry code bases (templates, Seaport, Maple, etc.), and reverse engineer according to your needs thanks sir ,this detailed article is much helpful Can I send two consecutive transactions at once, while the 2nd tx requires the success of 1st tx? E.g. tx2 spends the eth from tx1 In this case, you just need Solidity scripts. See the ""Solidity Scripting"" tutorial in the Foundry Book: https://book.getfoundry.sh/tutorials/solidity-scripting thanks man Is there any example to send transactions using solidity scripting? Do we use cast command in it? I added forge on StackOverflow https://stackoverflow.com/tags/foundry-forge/info Also Foundry https://stackoverflow.com/tags/foundry-rs/info Can i call test function with my arguments in cli? or maybe i can do it in another way? Details: Fail - Unable to verify. Compiled contract deployment bytecode does NOT match the transaction deployment bytecode. Is anyone else getting similar errors? fixed scripts and contract solidity versions didn’t line up now it works when i need to paste this? fs_permissions = [{ access = ""read-write"", path = ""./""}] This often happens when u deploy, and make a small change to the code Or compile, make a small change, deploy what does it mean?) what difference between test and script? different config and purpose.",466
1733,foundry-support.txt,"I thin managed to fix ty Yea I saw - just in case someone searches for the same issue in the gc :) can i call script with custom arguments in cli? can i paste arguments from cli to function? Hello guys, would like to know if this possible to launch the foundry debugger on real transaction and using api_key of etherscan get the solidity contract to debug step by step? For real transaction debugging you can use https://tenderly.co/ I recommend debugging w tenderly as well ^ I will say that I do like the truffle debugger. sometimes it helps a lot to step through a transaction.. When I was using Truffle, I would fork the chain, and run my transaction against my contract on the forked chain, and then step through the transaction. I've added my ""support"" to the issue in the tracker to add a ""cheat code"" to trigger the debugger from inside a test ifle.. that would be very useful! The debugger with forge is very low level.. any possibility of stepping it up a level to emulate what truffle has? Sometimes It's easier to follow the logic by stepping through and actually seeing the variables without having to decode the stack.. :O Unfortunately Tenderly sometimes doesn't cut it... Good reason for cheat code is that right now I'm running 200 randomized transactions and only one of them will fail... If I could trigger the debugger on the ""last transaction"" that would make my life much easier... hey, is foundry etherscan verification expected to work with testnet.arbiscan.io (goerli arbitrum)? I am using the flags --etherscan-api-key MY_API_KEY --verify, but when I check the testnet site, my contract code is not there, just the bytecode.",361
1734,foundry-support.txt,"full command + output below: ``` forge create --rpc-url https://goerli-rollup.arbitrum.io/rpc --etherscan-api-key MYAPIKEY --verify --private-key MYPRIVATEKEY src/core/NPVSwap.sol:NPVSwap --constructor-args 0x52d2d79D2F2E7e04775Bcd44F74588Aac0635A63 0xC77bda405Bd94C04d402869302445c4a32f7ADba 0x82b9e44cDfcB52ADeA5Dc7B24fF13E9e49AC27A1 No files changed, compilation skipped Deployer: 0xD8Dc00e6744D41730b907Dc859827B90c46226a8 Deployed to: 0x0bD9d272050d4edf09dCA24C830144FA076E5154 Transaction hash: 0x5e2dec9891ade288a55aae9e23aae95437a317d93f4efd1182a2f6f4983bf2bf Starting contract verification... Waiting for etherscan to detect contract deployment... Start verifying contract `0x0bd9d272050d4edf09dca24c830144fa076e5154` deployed on arbitrum-goerli Submitting verification for [src/core/NPVSwap.sol:NPVSwap] ""0x0bD9d272050d4edf09dCA24C830144FA076E5154"". ``` I'd suggest starting from a hardhard+foundry template (e.g. https://github.com/mattstam/solidity-template) then pasting in your contracts and hardhat tests into there. was just dealing with this. i think arbiscan uses a different subdomain / path to their API? this works for me for verification - forge verify-contract --watch --chain 421613 --verifier-url https://api-goerli.arbiscan.io/api <ADDRESS> <Contract> $ARBISCAN_API_KEY hi 😀 I am attempting to expectRevert on a custom error with MULTIPLE parameters. I am able to get it to work with a single parameter.",486
1735,foundry-support.txt,"But as soon as I add a second parameter to the custome error I get an error. Does anyone know what could be causeing this issue? Any direction would be greatly appreciated. Contract error MaximumContributionExceeded(uint256 isIndividual, uint256 temp); revert MaximumContributionExceeded({isIndividual: 1, temp: 2}); Test (Foundry Test Contract) bytes4 selector = bytes4(keccak256(""MaximumContributionExceeded(uint256, uint256)"")); vm.expectRevert(abi.encodeWithSelector(selector, 1, 2)); ico.contribute{value: 1501 ether}(); Error [FAIL. Reason: Error != expected error: 0xd38ddc2300000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002 != 0x1d3d86b700000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000003] Full code https://gist.github.com/bd9b4964bc96e88cb6da5a2d59e5672c https://ethereum.stackexchange.com/questions/146993/foundry-expectrevert-on-custom-error-with-multiple-errors I tried that just, and now it says my API key is invalid: ```forge verify-contract --watch --chain 421613 --verifier-url https://api-goerli.arbiscan.io/api ADDRESS CONTACT MYKEY ... Encountered an error verifying this contract: Response: `NOTOK` Details: `Invalid API Key` ``` my key is from https://arbiscan.io/, according to their docs the key is same on testnet.arbiscan.io im also using the same API key for both. idk! used this today and worked just fine.",418
1736,foundry-support.txt,"forge verify-contract \  --chain-id $chainid \  --num-of-optimizations 200 \  --verifier-url https://api.polygonscan.com/api/ \  --constructor-args \  $(cast abi-encode \   ""constructor(address)"" \   ""$impl"" \  ) \  $beacon \  lib/openzeppelin-contracts/contracts/proxy/beacon/UpgradeableBeacon.sol:UpgradeableBeacon \  $POLYGONSCAN_API_KEY arbiscan is a clone of polygonscan/etherscan so maybe its your usage of --chain instead of --chain-id? Is this even possible? Foundry testing for custom errors with multiple parameters ? do you care about the temp value here? you're expecting 3 and receiving 2 so test fails That was a typo I change it to: vm.expectRevert(abi.encodeWithSelector(selector, 1, 2)) What do you mean do I care about temp? Temp is just temporary while I try to get it to work with a second param. Ultimelty I sway uint256 temp for Phase phase. Is there a trick to etherscan verifying contracts compiled with --via-ir thanks that fixed it. two issues: (1) flag is --chain-id, not --chain and (2) constructor args must be abi encoded these seem like issues w/ forge, since the help text is wrong and the construct args input is different from when you do forge deploy Can I pass an Enum value into an event emit? enum Phase { SEED, GENERAL, OPEN } event Contribution(address indexed contributor, uint256 amount, Phase phase); I'm having difficultt getting expectEmit to work with this how do i fork from a certain block? is it --block? oop got it Hey guys, building a dao contract for the first time and when I run this code: vm.prank(user1);   console.log(governance.castVote(proposalId, 1));   vm.roll(block.number + 1); the console.log is returning 0 for the voting weight. When this address have about an 8th of the total supply of the voting token. Anyone know what I might be missing here? it seams like my votes are getting registered for some reason and im not sure why this is. Its a pretty standard dao contract.",481
1737,foundry-support.txt,"also when I do console.log(token.getVotes(address(user1)); I am also getting 0 as well? hi guys if my smart contract's dependency and imported contracts are not deployed to mainnet yet , they only exists on testnet like goerli , but i want to do integration testing on it , by testing the interaction between our contract and the imported contract . what is the strategy for this ? hi, Is fountry support verify contract on binance chain or I use fountry develop a contract and want to verify contract what should i do ? would be nice to mention in the docs Etherscan gas oracle doesnt support Fastest category Hi guys! I'm trying to install foundry, but after ""foundryup"" I get this: foundryup: installing foundry (version nightly, tag nightly-1d9a34ecfe265d49b4237c9eb670d5aec389b646) foundryup: unsupported platform: MINGW64_NT-10.0-19045 What should I do? Thanks a lot! hello guys, can I use `cast`to send a transaction that with the gas price lower than the current? Use wsl or cmd Thanks you very much! Wsl helped a lot! I’m tryin gto enforce —deny-warnings on my CI but it’s failing because one of the libs I’m using (`forge-gas-snapshot`) has a warning that pops. Is there a way to specify on which folder I want this option to be active? After I updated foundry using foundryup I get this error while trying to init a new project Is Github.com accessible from your computer? yes Are you using a proxy or other special Internet settings? or might there be something wrong with your ISP? no and no it worked fine before I did foundryup can you access github.com using ping github.com from the terminal? from wsl no your Internet is not configured properly yep fixed thank you ello Does anyone know what causes ""[FAIL. Reason: Call reverted as expected, but without data]"" on 'forge test' for testing the SCs? One usual reason would be having contract address/ABI mismatch. It tries to a call a function on an address that does not exist.",460
1738,foundry-support.txt,"thank you friend Changed compiler version on some files, got this: Removing the out directory, and running forge build again, same problem 🤷‍♀️ Hmmm, but now it has more output info about missing files. Think I can make progress. Ah, foundryup also gives better error message now. Thanks! Quick question, how could you get the current chainId inside of a forge script (which changes based on the `forge script --rpc-url`)? uint id; assembly {  id := chainid() } can also do block.chainid right Yes, you can do that too 😅 I tried to remember how to get chainId without assembly, but I couldn't) oh yeah duh, I forgot block info was still exposed in scripts. Thanks guys! Is there anything built into forge to compare two outputs from forge inspect Foo storage and ensure that one is a superset of the other with no conflicts? E.g.",193
1739,foundry-support.txt,"for checking storage collisions when upgrading a contract, so comparing the currently deployed impl's storage to the changed implementation's storage when I do `forge create --via-ir`, I get the error '(code: -32603, message: EVM error CreateContractLimit, data: None)’ — any idea how to fix this? I didnt get it before i changed this contract and add my library functions to library in the .toml file it’s because one of my contracts is too big, but i’m not sure how to make it smaller — is there some profiling for each function? or some what to list which library functions are getting inlined? ok i changed library frunctions from inline to public and then it all worked does foundry support address ? why it always say ENS error try after updating with foundryup hmmok now I get “contract creation code storage out of gas” even though ""forge build --sizes --via-ir” says everything is fine (one is yellow) ok nvm i added more goerli eth and then it worked Does anyone know, in a script, how to get an estimate value of total gas for a specific transaction before executing it ? (basefee + gas needed to exec a transaction) thank you ,it works does fountry support verify contract with binance smart chain? Run it without broadcast? Hi guys, can I send transaction bundle using cast with flashbots? and without running it two times ? I want to get an estimation withtin the script in order to decide to trigger or not the transaction. Try using cast estimate with ffi cheatcode.",326
1740,foundry-support.txt,"Not sure if that'll work --interactives 1 should prompt you to input private key after simulation, but before execution is there any way to do console log like console.log() in javascript in our scripting file? so when we ran our script, we can show some line in command line? also, when I try to mint my NFT in my script after creating the contract, I got the following error: (code: -32000, message: replacement transaction underpriced, data: None) I only run the following code:   MyNFT myNFTContract = new MyNFT(USDCAddress);   myNFTAddr = address(myNFTContract);     myNFTContract.ownerMint(OwnerAddress, 1); You can check emit log_xxx in the foundry book Ok I'll try to look on that way.",177
1741,foundry-support.txt,"Thanks If anyone is working with Python integrations and Web3.py, we are now offering Anvil support with support for Solidity stack traces, and all other developer experience features https://web3-ethereum-defi.readthedocs.io/api/_autosummary/eth_defi.anvil.html I'm running an invariant test and getting ""calldata=failed()"" - what does this mean? Does anybody know if there's a convenience function built in for console.logging numbers in format of 1e18 instead of wei, something like ethers.formatETH Hi everyone I am trying to do the exact same thing, anyone found the answer? I didn’t see any or if you find out @PaulRBerg 👌 AFAIK that is not possible, though you may want to ask @brockelmore to confirm Thanks, any idea how to do that @brockelmore ? I know how to do it in hardhat but I would prefer only use one stack 👌 if you get the storage layout you can storage layout will tell you base slot for the map then use solidity conventions for a map to get the specific key slot then vm.store(addr, slot, value) no but sounds doable this was just merged, though you can't specify the exponent: https://github.com/foundry-rs/foundry/pull/4482 — a follow up PR to support %ne where n is a arbitrary number to specify the exponent shouldn't be too hard You may check emit log_uint_decimal() in the foundry book is there a good solution/framework for deploys using foundry? hardhat-deploy is v nice, and shell scripts/etc. with forge create are not as good forge script check the docs for solidity scripting yea, but hardhat-deploy has things like re-using previous deployments if nothing changed, outputs deployment info, etc. I can write all that but would be nice to use an existing library Does anyone know of an article that guides through deploying to testnet ideally with Infura with Foundry? I am trying to use the Foundry book but I'm getting the following error: https://book.getfoundry.sh/reference/forge/forge-create ❯ forge create --rpc-url https://sepolia.infura.io/v3/....... --private-key <private-key> src/contracts/ICO.sol:ICO [⠒] Compiling...",482
1742,foundry-support.txt,"No files changed, compilation skipped Error: Failed to create wallet from private key: signature error I switched to scripting What should I make of this error? ❯ forge script script/ICO.s.sol:MyScript --rpc-url $SEPOLIA_RPC_URL --broadcast --verify -vvvv              ─╯ Error: (code: -32002, message: rejected due to project ID settings, data: None) There's nothing about project ID settings in the docs. https://gist.github.com/currenthandle/d5d308cfbeb954613786e24d910e454b#file-ico-s-sol-L14 You need to enable the Sepolia testnet in your Infura dashboard Dashboard? How do I do that? @gakonst I don't see a dashboard or any Seoplia related settings? I got the RPC url from here and selected Sepolia I'm able to get it to work with forge create but not scripting.... forge create src/contracts/ICO.sol:ICO --verify --etherscan-api-key $ETHERSCAN_API_KEY --rpc-url $SEPOLIA_RPC_URL --private-key $PRIVATE_KEY --constructor-args ""0xA247e0BCEb1a503a290e39BE7310C7B2C253fd80"" ""[]"" hallo hallo, is there an easy way to create a bunch of addresses to test an NFT mint out where there's a max # of tokens per wallet limit? Would prefer not having to change the max supply in the contract itself Been working on a GUI for anvil, can’t do much yet but it also can’t break anything else. https://github.com/sameoldlab/anvil-ui What features would people want, other than the stuff in Ganache UI? Amazing, I'll let you know when I try it out just write a simple deploy script and user vm.startBroadcast() Hi all..",393
1743,foundry-support.txt,"playing with chisel, and keep getting the error: Failed to find REPL contract! This happens any time I try and import something: // SPDX-License-Identifier: UNLICENSED pragma solidity ^0.8.17; import {Cheats} from ""forge-std/Vm.sol""; import ""iSimpleDefiStaking.sol""; contract REPL { Cheats internal constant vm = Cheats(address(uint160(uint256(keccak256(""hevm cheat code""))))); /// @notice REPL contract entry point function run() public {} } is this supposed to work? Could you please open an issue with this example? Failed to execute command: No such file or directory (os error 2) I'm getting this error when trying to deploy contracts in forge testing. this is the line of code: deployContract(""src/contracts/Router.vy"") any idea on it? I have a script with two transactions in it, when I broadcast the transactions to the network (using —broadcast), I had an error about the nonce ""EOA nonce changed unexpectedly while sending transactions. Expected 0 got 1 from provider."". I also added the —slow in order to wait for the first transaction to finish before the next one. Any idea why forge considers that it is an error that the nonce chances between the two transactions ? Will do...",269
1744,foundry-support.txt,"https://github.com/foundry-rs/foundry/issues/4516 for deployments, say I want some fixtures for local deployment should these go in a seperate deployment file or is there something like the hardhat skip functionality gm question, Im using 712 but not for permit I saw that vm.sign returns v,r,s may I ask how to convert that to bytes Im trying to test my method which accept signature which is bytes not v,r,s anyone has idea how to do it? to basically what I want is to convert v,r,s to bytes in solidity abi.encodePacked(r, s, v);? thanks, let me check ive got some tests for EIP712 sigs here if helpful - https://github.com/sbauch/chapter_1_season_4/blob/46b6ac4aeef19d9cc4b5c3edf52bb171406bd521/nft-global-entry/contracts/test/unit/utils/SigUtils.sol cool! thanks man, still testing hmm its not working my mistake, its working now LOL thanks man really appreciate it @sammybauch I hit a limitation with cast today. Windows only allows so many characters for a command line operation, so I am unable to anvil_setCode the Seaport bytecode to the canonical Seaport 1.4 address, i.e. cast rpc anvil_setCode 0x00000000000001ad428e4906aE43D8F9852d0dD6 6101c060405234620... because the contract bytecode is larger than the command line will allow. FYI it fails with ResourceUnavailable: Program 'cast.exe' failed to run: An error occurred trying to start process 'C:\Users\user\.cargo\bin\cast.exe' with working directory 'C:\Users\user'.",375
1745,foundry-support.txt,"The filename or extension is too long.At line:1 char:1 Is there another way to execute anvil_setCode that will allow me to bypass this Windows limitation? The revenge of Bill Gates! anyone ever have trouble getting an ERC1967Proxy to verify via a forge deploy script? the implementation deploys and verifies just fine, then the proxy is deployed but i get this output on the verify step: We haven't found any matching bytecode for the following contracts: [...] vm.pause/resumeGasMetering() seems unstable, is there a better way to selectively measure Forge test gas usage? What does unstable mean? That’s the main method ppl have come up with, we’re happy to improve it. Can you give an example It gives me different results compared to a simple gasleft() diff I'll try to come up with a simple reproducible case tomorrow and will share Hey guys I wanted to get a better understanding of foundry's event log recording. https://book.getfoundry.sh/cheatcodes/get-recorded-logs?highlight=reco#description Was wondering how topics and the data field of the Vm.Log struct is filled? I'm trying to extract information from an event with multiple parameters. I understand the first topic is the eventSignature but I have 5 parameters in my event and only 2 topics total in my log. How can I decode to see what values those parameters actually hold? Hi guys,I was wondering if you could recommend any good resources to learn about the ""cast"" command in a detailed and comprehensive manner. Thank you. topics and event args are two separate arrays if I recall correctly. It's only topic if indexed=true The first three args are for the 3 indexed topics, the fourth is for all non-indexed topics. I see. Thanks both. I wish I had some material or practice to recommend in terms of node, type casting, etc. this is how we learn here haha if anyone doesn't know - the above is scam, do not fall for it I think this is related to an error with the JSON-RPC. I am also bumping into this error quite often.",432
1746,foundry-support.txt,"Is anyone from Alchemy here that could confirm this? I am from chainnodes.org and can confirm that this is a geth bug Awesome, thanks @koraykoska! anyway i can do a vm.broadcast that returns me the to and calldata? i want to write a script that will take my private key, create a safe tx hash, sign it and push it to the safe tx service to queue it for other sigeners. everything else can be done other than being able to record the “action” with cheatcodes and ffi Hi, I install Anvil, and send a transaction (eth_sendRawTransaction) to the fork network, and the execution time is ~4 sec on the FIRST run always... What am I doing wrong? How to speed it up? for example: ~300 ms - hardhat ~250 ms - ganache at first start Sers, could this issue get some attention? https://github.com/foundry-rs/foundry/issues/4406 Not being able to automatically verify contracts on blockscout means we can't automatically verify new deployments on ~half the chains we support. The repro is hilariously easy: @msolomon4 Multicall3 can't be verified on Blockscout ETH explorer :) Did something change in the api? This used to be working Are you running ganache / hardhat in fork mode too? Can u pls open an issue if so - might be an edge case which we'll fix yes, I use ganache/hardhat as a fork… I tried to install Anvil on another server, but the same problem... I install only Anvil according to this instruction: https://github.com/foundry-rs/foundry/tree/master/anvil on Ubuntu 22.04 I run the command: anvil --fork-url {URL} --fork-block-number {NUMBER} Maybe something else needs to be installed or some parameters to add? Don't know. :( Any experienced blockscout verifiers out there? Haven't used it before.",413
1747,foundry-support.txt,"On the unrelated note, how does one supply array of tuples to cast call? I have (string,uint256)[] as a function parameter, neither of this is working: [(""abc"",123)] [""abc"",123] Will fix the serialization issue asap But no idea what „something went wrong“ means tbh this is like just all the request it takes to execute the tx 4s sounds more realistic than 300ms if you don’t have the state cache tbh I noticed the same as well while running tests on forked network. Initial test run always takes a couple seconds Not complaining though, test run will be finished by the time hardhat compiles the contract so...",139
1748,foundry-support.txt,"xD We do some rate limit prevention which is perhaps too conservative There‘s a —no-rate-limit (not exactly sure what it’s called) option that opts out of this Could you try this and report back? By default we assume default alchemy cups if use it for development, then it's not critical, but I want to use Anvil in the arb bot to simulate real-time transactions, and 4 seconds is very slow))) but hardhat/ganache cope with this task much faster in ~300 ms, interesting why is that?! sure, just a moment… This almost exclusively depends on net IO if you don’t have the data So for executing tx depends on the number of slots and accounts your tx touches Happy to look at a repro though Can you also try running without rate limits (check anvil —help or the config struct if you run it programmatically) For example assume your tx touches 100 slots, eth_storageAt is I believe 17 units, so your tx comes in at ~1700 units, default budget is 350units/s, so it takes ~5s I just run: anvil --fork-url URL --fork-block-number 16798640 --no-rate-limit The result is the same: ~4 sec Input data: - ubuntu 22.04 - an example of a running transaction: https://etherscan.io/tx/0x39e064a6260fddf6a09d3c1866a7c23a681aca8a3e8d00be027bcc9011f17d92 - server parameters (screenshot) hello, anyone faced an issue with autocompletion on vscode? when i switch between .sol and .t.sol, it seems that the IDE forgets all about the file and takes around 2 minutes to do the first autocomplete. Works fine as long as i'm in the same file or only switching between files with .sol extension. All gets messed up when I switch to a .t.sol. highlighted errors also take forever to update.",415
1749,foundry-support.txt,"If you run with logs enabled: RUST_LOG=api,backend,backendhandler,ethers You should be able to spot where it spends most of the time That’s a lot of hardware but what’s your provider compute unit budget? I just tried: anvil --fork-url URL --fork-block-number BLOCK --no-rate-limit --compute-units-per-second 10000 the same result ~4 sec How to run with logs and where to see the logs? Put the RUST_LOG option before the command or set as env var I use my own node Geth (snap+archive)...",120
1750,foundry-support.txt,"For work I use NodeJs (v16.17.0) and EtherJs(v5+), here is the code to interact with Anvil let provider = new ethers.providers.JsonRpcProvider(""http://localhost:8545""); Please attach to the issue I’ll have a look implementation of sending transaction for Hardhat/Ganache is the same I will try to make an implementation without ethers.providers.JsonRpcProvider, maybe this is the problem ... if the problem is not solved, then I will create an issues on the github, ok? Anyone know if there’s an easy way to use foundry with a specific execution client? Like let’s say I want to run foundry tests on geth or something else that conforms to the standard JSON-RPC. Is that possible, or would I need to implement some foundry-specific RPC methods? any node/provider will do So I just point it at my local node and it will use that node’s state transition functions? I figured foundry included an EVM implementation already. you only need a provider/node to get data access if you want to fork a network at a certain block everything else is handled internally It’s not so much about the data as it is that nodes implementation of the EVM That’s what I really need I'm not entirely sure what you're asking I’m not trying to fork a specific network - I want to run tests on a different implementation of the EVM than the one foundry uses there's no way and plans to swap the evm impl or make it evm agnostic how does it differ? It’s the filecoin FEVM. They have additional precompiles, some minor tweaks to some opcodes, and a different gas model, among other things Though they do support the standard Ethereum JSON RPC so I was hoping to be able to plug that into a test framework to test contracts on it. And I like foundry’s fuzz testing so i was hoping to use that as well At this point I’d take anything, though. The only option right now is to test on their public testnet and that’s not gonna be great for serious testing. useful to have some insights re fevm, so please open an issue with relevant context re gas/opcodes for precompiles, I mentioned this a number of times: https://t.me/foundry_support/31376 I see.",478
1751,foundry-support.txt,"I’m not sure you’ll be able to integrate Filecoin’s precompiles, since they perform state lookups that are really specific to Filecoin’s whole system You’d really need to implement a lot of stuff to get the full behavior I see, yeah then this is like not possible Thanks anyway, appreciate the answers. Do you have any idea if there’s another project that might be better suited for this? hmm I'd start here https://github.com/filecoin-project/ref-fvm/tree/master/tools/solidity-tests but looks like you wrote this lol Hah, yeah. I’m pretty much at the point of using that 😔 this is actually an interesting problem, because I assume this problem will come up with all the zkevms as well Oh, that’s a good point. Maybe I should ask someone building that I feel like there have to be similar situations out there Lots of L2s that have custom sauce yeh but most are just regular evm and not something else that mimics evm but tbh, no idea how fvm works Yeah FEVM is way too different to just make a few tweaks. I was hoping to use their existing JSON RPC and maybe implement a few additional RPC methods to do stuff like “impersonate address,” but… Would it be too crazy to fork foundry, rip out anvil, and add in the ref-fevm? Like if it’s just an interface I need to conform to, that might be doable.",301
1752,foundry-support.txt,"But idk enough about foundry internals to know if that’s feasible cheatcodes only work because we can modify evm internals while executing a transaction Yeah but I figured you implemented cheat codes via some RPC method, and maybe I could just implement that cheatcodes are essentially just intercepted calls to a specific address which can modify evm internals: https://github.com/foundry-rs/foundry/blob/93aa2d071b635a838030aa29ad85b52d361f5728/evm/src/executor/inspector/cheatcodes/mod.rs#L389-L399 but this means, this is specific to the evm implementation this would require that ref-fevm is also somehow able to apply cheatcodes Yeah, so I’d have to implement a precompile at those addresses, and one that can do weird things to the FEVM Might be possible, but a lot of work yes I guess this would be the ""easiest"" way actually Whenever i add anything to my vscode extension settings, the linter and autocomplete stop working. Any help with that? Same issue on windows and mac I have added my remappings to the foundry.toml, all compiles and run fine but i can't add a remapping.txt nor change the settings.json to integrate with vscode, it freezes the linting, code completion and error recognition Hey what is actually the different between prank and broadcast ? Prank is for testing, broadcast is for deployment Thanks, one more question, my contract have an event and i want to check the emit data, how can i get the past logs? I keep rubbing into this error. Is this an rpc related issued? my remappings.txt aren’t respected by vscode syntax highlighting so i can’t tell if my contracts compile or not when i import i.e. @openzepplin, and remappings.txt defines it to be lib/openzepplin, so idk if anything compiles.",397
1753,foundry-support.txt,"any idea how to fix this? I opened a ticket with a reproducible example: https://github.com/foundry-rs/foundry/issues/4523 yes thats non standard i think https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1474.md#error-codes https://github.com/sambacha/vscode-zen These VSCode settings dont have conflicting extensions/ settings may help to use as a reference Thank you will take a look If you can post ur config that would help hi guys, just want to ask regards on foundry if its possible to have visual on storage and memory layer including stacks when interacting on function, like whats on evm playground does like for example interacting on certain function I will see what it the stacks, memory and storage layer looks like does anyone know why its complaining? must be solhint i think... Do any free CI tools exist for GitHub with foundry - just committed some failing tests into master by accident, would have been nice to prevent the PR from being able to merge I'm capable of running my own Jenkins server if it requires a bit of elbow grease once i generate the remapping txt, or do anything related to foundry in the settings as simple as in the picture forge init should have automatically created a github workflow for you (in .github/workflows/test.yml). You can just edit when you want it to run, for example: on: push:  branches:  - ""main""  - ""develop"" pull_request:  types: [opened, reopened] Sweeeeet i didn't know things were that easy, tsym You need to enable branch protection rules so that it wont merge on failing CI Check or will require an override Figured it out, you have to move the file to a workflows directory and change it to run on pull_requests but I eventually got it. Thanks folks It was in .GitHub not .GitHub/workflows by default for some reason. And the action needed to be edited Ok but now I have to set up some status check thing in order to get branch protection working? yes If anyone is wondering this, I just found you can't use stdstore to access constant variable because they are not stored in the contract's storage. hey i am seeing this today too. but it works fine on an older foundry repo that i have. any ideas? no clue...",482
1754,foundry-support.txt,"i've been looking for two days already >.< Are you using juan blancos extension for vscode? I think I had this issue too and reinstalling the extension fixed it yes, i tried reinstalling it, also tried reinstalling vscode again, and different OS 😆maybe the issue is with the extension... If your setup is a hybrid (foundry x hardhat), try solidity plugin from hardhat. That works too i'll give it a try that works way better! thanks man, my day starting good. (besides that USDC...) You mean LUNA 2.0? xD Creepy Hi guys Could somebody tell me if there is an option to use a regexp for the profile.default.model_checker.contracts option in foundry.toml ? Right now we have to pass all contract names like this https://github.com/jpldcarvalho/ubiquity-dollar/blob/development/packages/contracts/foundry.toml#L39 Perhaps there is a way to use something like 'src/**/*.sol' = [ '*' ] so that foundry could find all the contracts and run smt on them Auto-completion works fine in contract code but it's NOT in inside test contract. Anyone knows why? Look a few msgs above https://t.me/foundry_support/33722 Thanks👍🏼 Can any of the foundry CLIs generate a table of storage slots? Hey I am facing a few issues 1. When I tried installing foundry using the curl command it throws an error saying curl: (35) error:02FFF036:system library:func(4095):Connection reset by peer I worked around it by connecting my phones hotspot for installation but 2. I can’t run forge or any other commands. It throws the following error zsh: killed forge I am on a MacBook Air m2 Any help would be much appreciated, thanks! For anyone that uses the short contracts flag -c, e.g. like forge build --root . -c contracts --optimize --out forge-artifacts, this commit broke the low-letter case: https://github.com/foundry-rs/foundry/pull/4496/commits/d63a25b14bf080f8ea8e6c6637511cefb4a950ba. So you need to use -C instead of -c.",484
1755,foundry-support.txt,"Hope this helps some folks debugging faster (was pretty annoying this morning to figure it out). forge test --gas-report doesn't generate gas reports for me. Is there anything I need to further configure apart from adding gas_reports = [""*""] in the .toml file? you need to install curl libssh2 and libgit2 using brew install (homebrew) Thanks a lot @sambacha I re ran the foundryup command last night, it seems to be working now.. Shall install these libraries and ping you if I face the same error again. PS: my hunch is this is something is going on with my wifi.. as soon as I shifted to using my mobile network (hotspot) the curl commands were working Hi everyone, I wonder if you could help me, I am using foundry in a dockerized project and I am having some trouble getting the foundryup working: RUN curl -L https://foundry.paradigm.xyz | bash RUN source /root/.bashrc RUN foundryup the 3rd line fails, however: this works: RUN /root/.foundry/bin/foundryup but later foundry is not available when the dockerfile continues (in my case i am building the optimism stack) How do you use foundryup in yourdocker files? thank you! I have this - give me some minutes to get to the computer to send it to you found it! this works: # Getting foundry ready RUN curl -L https://foundry.paradigm.xyz | bash SHELL [""/bin/bash"", ""--login"", ""-i"", ""-c""] RUN foundryup We consume the output of forge build, which already calculates if it needs to re-run when called again. Is there some way to get a ""digest"" of the build, which we can ask for? Then we can have a pattern where we check forge digest, and if that changes, we know the build changed things, and we need to re-read the output of forge build. My current plan is to just read each file in the out directory and store a hash of its contents, and check if those hashes change, but I assume Forge can do this a bit smarter and is somehow already computing this.",454
1756,foundry-support.txt,"Does it already exist? I see in cache/solidity-files-cache.json some stuff that amy be relevant, but it would be really nice to just have one quick way to tell ""did any build artifacts change"" Anyone know why forge install might be taking so long vs. git clone? Maybe because forge install recursively pulls the submodules? not sure tho.. always seamingly takes 20-50x longer if not more Git clone won't get the submodules Forge install gets them U need the deps to run the tests Pretty sure forge update will install everything (and update to the most recent version) more quickly than forge install I think there’s a file hash in the cache and is used by ethers-solc to determine if the content changed. So you could use that API if you’re using rust. If you’re just reading the file, IME the cache file has bugs and I would rely on the hardhat-style artifact which can be obtained with “forge build —build-info” Oooooh, thank you. Just looking at the hashed filename output in out/build-info/... seems ot be the hash I want. Unfortunately, if a bunch of those accumulate, I'm not sure what I can do to determine which is the ""current"" one.... It would be nice if forge build --build-info output that hash on the CLI or something. How can i run anvil with hardhat-deploy? bro just add the docker image to your dockerfile use it as a base https://github.com/foundry-rs/foundry/pull/2221/files#diff-79a844de4d6869f243ecd1e7ca4d9532d9a4987f85ca63d9f4af85aa227ecb38R15 such smol fix for foundryup I needed to use another base the most recent created one? Is it running alpine? no, that is the issue, optimism stack does not play well with alpine Sure, but I don't like depending on file timestamps, not reliable if you're running multiple processes, and why rely on that if we have hashes anywa? ahh so i had to get creative It's OK though, we have an internalized representation of Foundry output data anyway, just created our own custom digest fields for those, and are writing them down in our own spot.",485
1757,foundry-support.txt,"Is anyone in for EthDubai? Hey Evan, Did you find the answer? how do i add the lib prb-math to my repo? Oh I think I know why: https://book.getfoundry.sh/forge/cheatcodes The indexed attribute can be added to a maximum of three parameters of an event to form a data structure known as a ""topic."" I guess that's why there are only 3 topics on expectEmit? forge install https://github.com/PaulRBerg/prb-math ? ah got it forge install PaulRBerg/prb-math --no-commit Hey, is it normal that —legacy and non legacy transactions diverge so much in gas? When trying to submit sth on mainnet using alchemy rpc, with —legacy flag, the estimation is ~18gwei right now which seems correct. Without —legacy, it's estimating a ~42 gwei base fee which seems weird. On other networks they seem to kinda match, so might be a mainnet issue? (also checked other rpcs which yield similar behavior) Correct, if you want to check for an event and if you have 3indexed you can pass true on param, the forth if you want to include the data which means to check the non indexed and the fifth is optional but that's the contract where to check that events is there a way to serialize a json with multiple keys? Anybody seen this error before: ""Error != expected error: NH{q2 != Index out of bounds"" Traces seem to indicate the error is correct but not sure what that weird text is Trying to flatten a file and getting ""Failed to flatten the file: cannot resolve file at "" - it seems like this issue is flatten specific, as there are no issues on build or inspect. Is there a feature flag i can enable to get a bit more logs on what is actually the issue? created an issue with reproduction as it seems to be not unique to that repo & contract: https://github.com/foundry-rs/foundry/issues/4545 Does forge test have an option to exit as soon as a test fails? I was trying to avoid importing hardhat to do one specific thing (calculate a merkle root & proof list) and I have it working, but when I increase the size of the list to 5000 members the script runs OOG.",485
1758,foundry-support.txt,"Is there any way to set an unbounded gas limit on running scripts (this is not being broadcast, it's purely local computation) └─ ← ""EvmError: OutOfGas"" Gas used: 9223372036854775807 you can set the gas limit to ""Max"" which should double it not yet, but I wanted to add this together with warning messages for slow tests Should I open an issue or is this tracked somewhere? please open I'm writing some integration tests that I want to make sure will stay within gas limits, so passing --block-gas-limit flag to forge test. I'm hitting an issue though where the setup & test combined is pushing me over the limit (even though the test itself would be fine) I thought I could get round it using vm.roll to change the block number (and, I hoped, reset the gas left) but it seems like that doesn't work. Is there a better way to do this? Do I need to fork a chain state with stuff already deployed? Have you considered deploying stuff onto a local instance of anvil, and then using it for tests? That would require some extra effort for setting up the tests, but would be easier to reuse the setup. Cool yeah that makes sense! then the block gas limit could kick in per statement with automining, right? I'm not an experienced anvil user, but in theory ""the setup"" is usually deploying a bunch of contracts and followed by interaction with them via exposed configuration functions. I am going to assume that this is not merged into one big-ass tx (i.e. the prod setup would take a bunch of txs, not just one). In that case setting up a local anvil and deploying there (just once, outside of your test contracts setup) would pretty much mimic the real deployment and you should be fine gas limit wise. I believe the default anvil configuration would get you there, but don't quote me on that :) Good shout, will give that a go. Thanks @ChiTimesChi! 👍 In unit tests, how can I simulate calling a certain function after a certain number of blocks passeD? Sounds like you might be looking for something like vm.roll thanks! how can I compute the natural exponent function? like exp(1) = e OR normal exponent function?..",472
1759,foundry-support.txt,"exp(a, b) = a ^ b ? In Solidity? Have you tried a ** b or are you looking for something else? oh! Thanks… I thought I have to use SafeMath.. If Solidity < 0.8 use SafeMath if an overflow is possible atlast forge working hardhat very well, so far never use forge for deployment as I like more hardhat-deploy is it possible to deploy vyper contracts inside forge test contract? yes https://github.com/0xKitsune/Foundry-Vyper https://dev.to/nazeeh21/compiling-and-testing-vyper-contract-using-foundry-3h0k https://youtu.be/Z7JZ-Qm4Vo0 anyway to skip test folder for forge coverage ? Has anyone used Foundry and Quiknode before? Trying to deploy something and I'm getting railed by rate limiting lmao - how can I improve my flow? Error: Deserialization Error: unknown field `code`, expected one of `id`, `jsonrpc`, `result`, `error`, `params`, `method` at line 1 column 7. Response: {""code"":-32007,""message"":""25/second request limit reached - reduce calls per second or upgrade your account at quicknode.com""} Script: forge script -vvvv --froms $ETH_FROM script/Create2SafeFactory.s.sol --fork-url $ETH_RPC_URL --broadcast --sender $ETH_FROM hi guys, anyone here know any debugger tools or extensions that can visualize the stacks, memory and storage layer when executing function in solidity guess that will very useful tools on testing and development How can I get fields off a struct in foundry tests? This isn't working for me dao.proposals(proposalId).proposer ^ I use model_checker in foundry. The environment is libz3.so.4.14 , bmc engine and solc 0.8.15. When I use the forge bulid command, I find that the solc compilation process never ends. Even if the running time far exceeds the timeout configuration. But the chc engine is normal. https://ethereum.stackexchange.com/q/147361/28407 Your return type is (uint256,address,uint256,uint256,uint256,bool,bool) Structs don't go cross contract unfortunately Kind of a drawback on soliditys side.",482
1760,foundry-support.txt,"Even if I want only one element from the struct, the compiler copies the whole struct and if the struct have more than 14 elems, it'll throw stack too deep (Goes away if optimisation is turned on though) If you want some contracts to be excluded from coverage, the easiest way IMO is adding testA() function explicitly to every such contract. By explicitly I mean that function needs to be defined in the contract itself, inheriting from a contract with such function will not remove it from coverage. I just add empty testContractName function to every such contract. After forge fails to verify a contract on polygonscan, how can I find out number of optimisations and used compiler version to retry the verification? Inside the foundry.toml file Hi everyone 👋 I’ve this issue when checking coverage. I don’t understand why the line 48 stay in yellow. When I check the coverage.txt I can read this : - Branch (branch: 1, path: 0) (location: source ID 27, line 48, chars 1771-2033, hits: 0). I don’t understand how this can be hits 0 time, but can be in green on the else side. Thanks a lot for your help 😉 contract verification is really unpredictable , for all chains I have noticed , sometimes it works the 1st time , and then it doesnt for several tries , maybe its a *-scan issue, i dont know other 3rd part API that also do this Are you testing all cases? >, <, =? Does someone know how, in a forge script, to be sure that a transaction did not reverted before emitted a second one ? I know that —slow while broadcasting waits for previous transaction to be mined but I want to react on it in my forge script. Firstly, thanks for you reply 😉 I’ve tested if the statment inside the if is true or false. So I’ve only test > and < not ==.",403
1761,foundry-support.txt,"But it should not be require, because we just test if the statement is true or false no? In this test, I can just test < and >, and achieve a full coverage What I really don’t understand on my previous post is how can I get both ""path 0, not hit"" and a green line for ""path 0"" 😅 Is it possible to print the compiled sizes without exiting with code 1? gmgm! question regards on testing naming convention if for example I want to test MyFileTest.t.sol but I want to test different functions as individual test for example withdrawa, buy etc... MyFileTest.withdrawal.t.sol MyFileTest.buy.t.sol how to run all my testfile under prefix MyFileTest, I know that we can run specific file using the following command forge test --match-contract SolFile but its possible to run it by file name prefix like MyFileTest Where would I go to report a bug Github issues! I think there might be a problem with celo, specifically the cGLD precompile. Seems like this is also present in viem hi guys again trying to run slither but because my project is hardhat with foundry it runs hardhat not foundry how to force slither to run foundry not hardhat running slither . runs npx hardhat compile --force If you’re using the latest release it should favor foundry over hardhat. You can use “slither . —compile-force-framework foundry” to override it though thanks! will try works like a charm thanks man Hello, is it possible that anvil doesn’t support create2 opcode? it def does - what steps are getting you this error? forge script will deploy the create2deployer if it doesnt find it on the chain is there a way to get the past event logs for a contract? another projects contract, not mine in cast? forge? forge / forge script hi there, another question, Im using mythril on this case, and seems its taking so long to execute? is this normal? no clue - would open an issue iwth a repro no not really, why do you want to do that? we have the recordLogs / expectEmit cheatcode which is useful for testing the events from a call using the event data to initialize a contract. I can pull it via python etc. but would be nicer to have everything in forge/foundry/etc.",496
1762,foundry-support.txt,"i would pull it from an outside script and parseJson it in Any idea why expectRevert stops working when I convert test to a fuzz test? https://ethereum.stackexchange.com/questions/147415/fuzz-testing-in-foundry-expectrevert-not-working-call-reverted-as-expected-bu just question regards on slither and foundry it seems I cant run slither src/contract.sol to analyze only a single file also can't find on docx how to output the result on external file? is that possible? It fails here https://github.com/AztecProtocol/aztec3-l1-contracts/blob/32f853b7deac1ff0e70bc9a7a9409ebe4aa3e802/test/GenerateActivity.t.sol#L45 and this is the command I ran: // 1. run: anvil // 2. run: forge script --fork-url ""http://127.0.0.1:8545/"" --ffi GenerateActivityTest --sig ""testGenerateActivity()"" --private-key 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 --broadcast i fetched newest foundry today. yes, that's an unexpected Panic rather than Error. Try import {stdError} from ""forge-std/StdError.sol""; vm.expectRevert(stdError.indexOOBError) Does anyone have an idea on this? is this bug or error when lib dir and src dir has same contract ? DeclarationError: Identifier already declared. IERC20 in lib/v2-periphery/contract/interfaces/IERC20 and src/interfaces/IERC20. SafeMath in lib/v2-periphery/contract/libraries/SafeMath.sol and src/libraries/SafeMath.sol We just dropped our first Foundry based hackathon submission. Awesome toolkit - thank you for all the maintainers for the hard work ❤️ Soon one day we will have mature smart contract development tooling https://devpost.com/software/sushiswap-portfolio-optimiser-defi-trading-strategy forge inspect is extremely slow, does anyone else have that issue? You need to use named imports when there's a name collision in the imported files.",472
1763,foundry-support.txt,"import {IERC20} from ""path/to/file.sol""; Does anyone have an example to verify a deployed contract using an externally linked library? Can't seem to figure out how --libraries work in forge verify-contract Hey guys, Does anyone have an idea why for me console.log(""this: %s, sender: %s"",address(this), msg.sender); returns like this instead of replacing the %s? Try to do named imports, so you don't import everything from a contract file you import Slither relies on Foundry to compile everything so you need to run it on the root of the repo “slither .” There isn’t a way to filter by contract yet, but we have it planned Ser this isn't C What do you mean? https://book.getfoundry.sh/reference/forge-std/console-log Lol mb, didn't knew this was possible. Maybe try console2 instead of console? Or the other way around no problem haha I already tested that + changing the verbosity. Doesn't work. Thank you that's a great help Is it possible to read a json file where there is one key and the value is an array of json key pairs and store that into an array of structs? 🤔 Searching the docs for ""external library"" only tells me about stuff that is ""external"" and anything about the forge standard library Got my contracts in line and it appears to deploy an external library ahead of its respective contract with a script targeting only a single chain. But it is super buggy. I had to repeat it 10 times to get one to go through. Half the time it complained that it couldn't estimate the gas correctly. The other half it complained that it got unexpected nonces from the provider. I've been trying to deploy it again. I got it again on maybe the 10th try. Half the time it errors that it can not estimate the gas before sending any transactions. The other half it appears to deploy the library in the first transaction before going onto the rest of the transactions I define in my script. Then at the second transaction that deploys my contract, it complains that the max fee per gas is less than the block base fee.",443
1764,foundry-support.txt,"Hi Fixed it by reinstalling Foundry Is there a way to set tx.gasprice with a cheatcode? Similar to vm.chainId sets block.chainid https://github.com/foundry-rs/foundry/issues/4566 Is there a way to generate bindings with a specific ethers version? Anyone have a list of all the chains that the default CREATE2 factory used by Forge (Arachnid's deterministic-deployment-proxy) is deployed to? https://github.com/Arachnid/deterministic-deployment-proxy thanks Hey need help here, i just success deploy and verify contract with goerli, and when i try to deploy it on bsc testnet i got error Deserialization Error: unknown field `message, expected one of id, jsonrpc, result, error, params, method at line 1 c olumn 10. Response: {""message"":""Internal Server Error”}` what is that mean? is this the issue that needs to be addressed for the bindings to not always be breaking? https://github.com/gakonst/ethers-rs/pull/2263 I just need to know what i need to do not break bindings. I'm down to go in on the issue but the semversion break has been blocking a few things on my work. for some reason i cannot fix this problem. i have no issue with lvim when it comes to viewing .sol files, or the solc compiler itself. forge test & forge build both work fine. but viewing a .sol file in vscode this is a constant problem that i cannot fix even with the solidity extension changing global remote version etc?? Linter: Compiler version 0.8.17 does not satisfy the 0.8.15 semver requirement [compiler-version] I saw this repo, but wasn't sure what the command would be to get it to actually install into a different lib_solidity-version directory? I was only able to get dependencies to install into the normal lib directory...",404
1765,foundry-support.txt,"https://github.com/hbarcelos/forge-multi-version Hi there I have this really weird case where this test doesn't revert if I call a specific function twice however it reverts if I only run it once: function testVulnerable() public {   vm.prank(address(1237687687874));   idManager.setMyIdentity(""B""); \\ If I comment this (or the line under) line the final call reverts   idManager.setMyIdentity(""B"");     assertEq(gate.letMeIn(""!""), ""Welcome, B"");  } setMyIdentity is a very simple setter function setMyIdentity(string memory name) public {   identities[msg.sender] = name;  } hmm tested with getIdentity and apparently it's being set only on the 2nd call. However this doesn't make sense for testnet cause I called setMyIdentity a block before and I verified that getIdentity returns the required value. oh does prank only change it for one call lol? You probably need startPrank() instead of prank() yeah that was it. Why doesn't vm.startPrank also prank address(this)? Anyone ever have an issue with Github Actions where: optimism = { key = ""${ETHERSCAN_API_KEY}"" } and CI fails bc it cannot find ETHERSCAN_API_KEY? note: (`ETHERSCAN_API_KEY` is defined as a secret) you need to do ${secrets.ETHERSCAN_API_KEY} iirc - you're missing the secrets In the .toml? I don't think so ` Is this repo public? [etherscan] mainnet = { key = ""${ETHERSCAN_MAINNET_KEY}"" } mainnet2 = { key = ""ABCDEFG"", chain = ""mainnet"" } optimism = { key = ""1234567"" } unknown_chain = { key = ""ABCDEFG"", url = ""<etherscan api url for this chain>"" } ` Yes https://github.com/Kwenta/margin-manager/tree/Delegated-Trading secrets aren't in the env so you have to add to the workflow env i think So this has been working fine until a few days ago. Nothing has changed and it just stopped working I'm almost certain now that we have a regression @DaniPopes but you also don't set the env var in CI like ETHERSCAN_API_KEY: ${{ secrets.ETHERSCAN_API_KEY }} Hey everybody.",487
1766,foundry-support.txt,"Does anyone have an idea how to write tests for functions that use structs array that are passed with the calldata memory access modifier? I cannot really write them as the literal if the array is dynamically sized. Is there a cheatcode I may be missing? It is bizarre that if I manually run CI for a branch that was passing all checks that it now fails despite nothing being changed. Yeh I think I found the regression Will confirm and fix when setting up custom addresses in anvil what's the format for the --mnemonic option? Took me two days to find this lol Why it's so hard to find social media on Founday? no twitter, no discord I have contract A and contract B I will deploy contract A first, For my contract B, deployed address of ?contract A is needed How do I get the contract address of A i’m trying to use a brownie keystore file with forge script and it’s saying the decryption is wrong, i’m certain i entered the password correctly. Has anyone experienced a similar issue? I’ve run foundryup to the latest i’ve tried to use forge bind and facing this error. How to debug this? You should see it in terminal output when you deploy or from transaction history of the address you deployed from Does foundry install to $HOME/.foundry/bin on macOS? FYI I've started working on a GitHub Actions workflow for building a Foundry project with multiple Solidity versions It's a WIP but it should be usable: https://github.com/PaulRBerg/foundry-multibuild this is an open-source initiative ser, not a company You need to write scripts https://book.getfoundry.sh/tutorials/solidity-scripting But how do I get that on the test so I can deploy both contracts side by side Any way to use vm.assume() on a sum? Tried to do vm.assume(a+b <= 2**256-1) but a+b overflows before the test case is discarded.",404
1767,foundry-support.txt,"when i pull a project the lib folders are empty (forge-std and openzeppelin-contracts), is this normal? can i have them installed somehow? forge install? oh didn't know about it! thank you :D is there an example on how to add(not alter existing keys) to a json via https://book.getfoundry.sh/cheatcodes/serialize-json#how-it-works Struggeling quite a bit with this 😅 you also have to check out the repo recursively vm.assume(a <= 2**256-1 -b) https://t.me/foundry_support/33958 this would be better then cool, I wil check that out I am actually trying to achive something like this let cFactory = await ethers.getContractFactory(""aa""); contract = await cFactory.deploy(addr1.address); console.log(""Contract "", contract.address) contract.address >> gives you the contract address that just deployed Any update? Opened a PR Will trigger release once merged Brilliant. Ty! function run() external { vm.startBroadcast(); TestnetERC20 busd = new TestnetERC20(""TestnetBUSD"", ""BUSD""); OtherContract other = new OtherContract(address(busd)); Nice Thanks Hello everyone there is a flag in scripts that allows the transaction to be sent to the network even if it revert? for forge script? you can just send it with —broadcast try --skip-simulation I set this flag and still the transaction ran a simulation and was not sent Does anyone know an alternative to get the storage slot number for a contract? I have a contract with the solidity version 0.5.X but my Foundry test contract has 0.8.13. I can't go lower to 0.5.X as then I get the error ""not implemented yet"" but if I would need to raise 0.5.X it would lead to other errors 😅 I use vm.record() and vm.access() and both seem to only work with calls where the contract code is available (right?).",414
1768,foundry-support.txt,"Hello guys, when fuzzing arrays what's the best way to have arrays without doubles? Hello Folks! Can a public library be deployed from foundry scripting? Bump, anyone an idea how verifying contracts with external libraries works? Can you open a minimal issue that reproduces this? The library shoudl also be auto-verified by Forge Yeah they are WDYM doubles? Unique only elements? We don’t have a great way to do that, one thing you could do is fuzz(uint256 seed, uint256 len) and generate in-place an array of [keccak256(seed + i) for i in 0..len]`, every element then shoudl be unique Yes, only unique elements. Your solution is really good thanks. For now I've been using the generators library from Matt Solomon and turned a linspace into an address array. Any updates on this? Don't think so - did u open an issue? Just filed one here, thanks is it possible to check inside of a script weather or not the --broadcast flag was used for invocation? i.e. I only want to write results of script to file if it was actually broadcasted to the chain Is there a way to broadcast the generated ""run-latest.json"" corresponding to the dry-run of a script with forge cli ? Yea just --resume bumping this in case anyone stumbled upon this. I bet i am not the first one Ok thank you, I had to had a fork-url argument to make it work. Thanks for the help guys. Keep up the good work This may help: https://github.com/simpledefi/SimpleDefiToken/blob/master/test/easyToken.t.sol Look at the mint function.... You could do the ""push"" multiple times.. Hi I followed the documentation to install and got an error executing the forge init hello_foundry command. why the tests not coming as I have function written, the first function is getting passed at the last does it matter how long it takes to run? check your path and make sure forge is there echo $PATH If not then you need to add or run directly from the folder where the forge is I will install it by way of the source code. Then try again. Is it possible to put a deley in solidity script for post depoly funcitons? you mean time lock contract? No, I just want to wait 60 seconds before calling a function.",489
1769,foundry-support.txt,"Not sure if you can put a delay like that you want to have something like sleep(60000) like that just like javascript Just use cheat codes https://book.getfoundry.sh/cheatcodes/ Mock the block.timestamp How can you order the tests? Test a, b, c,d written like that but it shows a, c, d, b 🙏 is there a place where I can get an example? new Library() should work? vm.warp(block.timestamp + 60) might work I have kind of a complicated project with multiple contracts that get deployed at once. The addresses of previous contracts are used as constructor args into the next set of contracts deployed. Is there an easy way to chain these together in bash using foundry cli? I'm using the forge verify-contract after a forge script since often etherscan cannot handle the verification speed at which the contracts get deployed and thus the deploys fail after some time. I just don't know how to use the forge verify-contract --libraries command 😅 Difficult to make a verify PoC as it's with onchain deploys etc but I'll make an issue for it on gh ""vm.warp(block.timestamp + 60) might work"" ok thx Hey! Is there a cheat to generate Solidity code from a raw transaction? Given that all the contracts are verified on etherscan/I have the definition in my project. In the end I would like to be able to generate forge test of a function I found in a wild. But the input should be as typed parameters rather than raw bytecode, so the user can mess around with the inputs. Hey guys, I was trying to do some time based assumptions on my invariant tests but it seems like things like warp or skip are not working. Is it supported ? Here is an example, maybe I'm doing something wrong: https://gist.github.com/Mathieu-Be/868e7d89bcc6cc030b7df864d731986b yea currently timestamp changes are not preserved automatically.",413
1770,foundry-support.txt,"it's being tracked in an issue, in the meantime you can work around this with a handler contract that has a modifier—save the desired timestamp in storage and use a modifier like this on functions: https://github.com/maple-labs/maple-core-v2/blob/00f01ae7175885f8d49ac201a1c72465e320b2f6/tests/invariants/BaseInvariants.t.sol#L34-L37 Oooh awesome ty Hey, I could not find any code documentation which config to set, to avoid this gas errors at Arbitrum Goerli. When broadcasting, it is either a failed gas estimate, or a wrong max fee per gas. It's a lot of transaction (106), but I hope there is a way around 🙂 Anyone? I do it by naming them with a leeding 001 number. Maybe there is a better way. or actually test_001 I will try that and see if it works Does anyone know how to deploy a contract in a test from an address? For example, if I want to deploy a contract with address(1) as the msg.sender Anything wrong with vm.prank here? I am trying to create a deley between two function calls, using a ffi call to a JS file, but it doesn't really work. The delay seems some come in at the end of all the solidity script calls, but not where between the two functions calls I want to have a delay between. Nothing. Except I don't know how to deploy the contract afterwards. In the contract, there is code in the constructor to identify the msg.sender as the owner.",333
1771,foundry-support.txt,"When I use vm.prank, and then say contract = new contract(); in my setup, it doesn't work mind screenshotting the code? have you gone though this? https://book.getfoundry.sh/tutorials/solidity-scripting?highlight=script%20deploy#deploying-our-contract this should work SMART_CHEF_FACTORY is just a public address My setup which fails try printing out the value of versa.SMART_CHEF_FACTORY() after you deploy the contract, maybe something is wrong with the initialize() function Finally the traces if initialize() is permissionned to only deployer then you also need to do vm.prank(owner) before that call vm.prank() only sets the msg.sender for the immediate next call if you want to have that persist use vm.startPrank() and stopPrank() yeah so owner is fine, just add vm.prank before initialize() and you should be all set Thanks that helped I am trying to write a script that deploys a contract and then another script that calls a function on that contract and I get this error: I am defintiely not getting the broadcast concept. :-/ sorry just a bug, ignore that last q. whats the best way to increase the gas when using forge script cmd? Hey friends, I'm trying to deploy a contract to a specific address, to do so I'm using the vm.etch cheatcode. However I have the impression that while the etching works correctly the storage of the contract is not copied with it. All the attributes inside the contract are set to 0. Any idea on how to fix this? The library @openzeppelin/contracts, imported from src/Contract.sol, is not installed. Try installing it using npm.",355
1772,foundry-support.txt,"I am trying to run hardhat into foundry project I already install openzeppelin using forge and npm rampings fixed that Did you specify the rpc-url in cmd line or created and selected the fork from your script before etching your code ? is there a way to do justtnpm install to get all dependencies install on Foundry everything on foundry is installed on lib if I put lib on .gitignore, it wont' show up I am trying to run the following command cast send --trezor --rpc-url https://mainnet.optimism.io 0x1ec50880101022c11530a069690f5446d1464592 0x39509351000000000000000000000000c5a4fec44fbde08a7c9de6e07b60de60ac074ab900000000000000000000000000000000000000000000006194049f30f7200000 but it fails with the error No wallet or sender address provided. Consider passing it via the --from flag or setting the ETH_FROM env variable or setting in the foundry.toml file. How to use a hardware wallet in this case? fatal: repository 'https://github.com/redstone-finance/redstone-oracles-monorepo/tree/main/packages/evm-connector/' not found This is so wried git exists but it throws an error, not found forge install url can't link to a file in a repo I manually copy pasted the folders, and now I mess up everything haha fie is there, and looks like the link is not the main repo openzeppelin-contracts/=lib/openzeppelin-contracts/ why my ramping giving this, rather than openzeppelin-contracts/=lib/openzeppelin-contracts/contracts Manually edit remappings.txt to fix issues Here is one hack I did https://github.com/tradingstrategy-ai/ethdubai-2023-hackathon/blob/master/forge/remappings.txt Nope It was working but I tried to install redstone oracle, now all messed up looks like its working yea, ramping messed everything up Thanks Hi! I'm setting up Foundry but I think I might have installed something else called forge that is overlapping. I'm not entierly sure tho as this is all a bit confusing. I'm on a Debian system.",485
1773,foundry-support.txt,"FORGE - training program for SNAP (version 2006-07-28) usage: forge [options] <ann> <dna> [options] Forge is the correct utility Foundry has a subset of applications that makeup the suite Forge is the testing and building thingy Cast is the interaction and introspection thingy Ah okay. I was mostly lead down the path of confusion because of the ancient version date I suppose. Anvil is the ganache alternative thingy did you use foundryup to install ? Yep. Initially I did. But then I tried running forge init and was prompted with an extra installation suggestion by the system. ref this and also commands like forge —version and forge —help not working. open a new terminal window and run which -a forge, which will list all the locations of the forge binary the one in .foundry/bin is correct So I suppose my theory was right? Now how do I clean this up? why not blockNumber Fixed. Nothing works better than some aggressive sudo rm -f Thanks guys. :) The problem I is that I think all the transactions are bundled into a broadcast and then just sent all at once. Now I made a second script and just wait 60 seconds to run the second script. But I would like to see if there is a way to do it in a single script. is there a tool that helps identify unused imports in solidity? That's the thing, I'm trying to etch a contract on an address before forking because I need the contract to be specifically deployed at that address what's the best practice to have some helpers javascripts in the project? is it ok to have node modules and lib? (i need some keccak and merkletree functionalities to generate some test values) hahahahahahahaha your best bet is to do named imports as opposed to global naked imports Can you somehow add a Comment in the remappings.txt Looking forward to the solution, as well! Hey guys, has anyone run into this while attempting to use the Etherscan API via forge? > Context: > - The Requested prompted a cloudflare captcha security challenge to review the security of your connection before proceeding. It looks like there's something wrong with Ehterscan's API but was curious if anyone has run into this before Likely low reputation of your IP address Hi everyone! I read that forge test displays colored trace if the terminal supports color.",492
1774,foundry-support.txt,"But I can't get colored trace, why? https://book.getfoundry.sh/forge/traces are you on windows 10? Yes, I am using windows 10 Rust console texts are colored. Anyone can help me? can you open an issue with more details, like what terminal, OS and terminal versions. I'll try debugging it later It is not showing in windows default terminal and powershell of windows 10 as well I set up a value to true on one function, but on next function the value is not set up..looks like tests are running in sequences what was the solution to this error Update: I think it’s just not enough gas in the first derived wallet on the ledger How come the mint is false on Test 13, but the moment it goes to function 14, it is true..if it is set up on first function, it should stay on that state (true/false) There is no state preservation between tests. If the state change is not made in the setUp(), it won't persist so if I change the stats to true on function 1, it only works one function 1, not on function 2 but if you change the global variable status, it should stay same for the whole test, right? If I change the mint to false on function 13, it should stay like that for rest of the test, so when I am in function 14, it should still be false, right? It won't be ok, but that does not make sense tho .... the state should be the same in one deployment, what happens if I mint 20 tokens in function 1 Do I have to mint again in function 2? or I get total token 20 for rest of the test..? Unless its on the setUp or you called fn 1 from fn 2, you won't Technically we are changing the state on contract....so once the contract is deployed, and you change the state, it should stay like that until the end of the test ok, thanks for the info I am having hard time to wrap my head around this concept tho :) Just came from HH Foundry doesn't follow a particular order on test runs, its parallel.",448
1775,foundry-support.txt,"That's possible because of no state preservation (not sure, but that's how its in mind :) ) That totally makes sense When using forge create is it necessary to use —unlocked to use —from <ADDRESS>? I’m trying to deploy using a specific address on a ledger. When I call forge create --rpc-url $GOERLI_RPC_URL --unlocked -f 0x1234…789 -l --etherscan-api-key $ETHERSCAN_API_KEY --verify src/Libraries/StringSlicer.sol:StringSlicer I get the error (code: -32601, message: The method eth_sendTransaction does not exist/is not available, data: None) How to know if the vm.prank is actually working? Check msg.sender I guess? But it does You can also do start prank and stop prank. Vm.prank only works for the next call yea, but then I have to know what is ms.sender for that, I need a hardhat console. and I could not install hardhat consol in foundry yea, i tried that too, but not getting the result that I need so I just wanted to make sure that I got the prank working You have console.log in foundry, take a look at the docs yes, they do, I might just import test I guess Well if you're using any cheat code then you should be importing test yes, I directly put test on my main contract uint256 numberOfTokens,   bytes32[] calldata proof  )   public   payable   nonReentrant   returns (uint256 _totalPrice, uint256 _totalPower, uint256 _totalBonus)  {   console.log(""msg sender "", msg.sender);   // Sale must be active    require(    mintPaused == false && publicMint == false,    ""WhiteList sale not active""   );   bytes32 _leaf = keccak256(abi.encodePacked(msg.sender));   require(    MerkleProof.verify(proof, whitelistMerkleRoot, _leaf),    ""Not in whitelist""   ); I have this code....",428
1776,foundry-support.txt,"No matter I do, I get not in white list I am sending the right proof and sending the MerkleRoot contract.setWhitelistMerkleRoot( 0x76a2c8f5d539966d96980e5cda5ee13fdc83990b435a0feadda20c05e0c0e618 ); Like that.... it works on HH, so not sure I can't console.log root so I can tell what is happening Hi, found a strange bug with forge script Having a setUp hook seems to affect the balance of one of my accounts Adding an empty setup hook increases the balance Removing the hook decreases the balance is this a known issue? Does anyone know how to define sub-path in remappings.txt? @openzeppelin/=lib/openzeppelin-contracts/ @openzeppelin/contracts-upgradeable/=lib/openzeppelin-contracts-upgradeable/contracts/ I want to define the path as sub-paths Who can help my current issue? I should not change the import path in src since it's deployed using hardhat. I just posted that issue in stackoverflow. https://stackoverflow.com/questions/75788954/how-to-define-sub-paths-in-remappings-txt-in-foundry Hey! I don’t think this is possible but is there anyway to prevent foundry from stopping the runs when fuzzing and the tx reverts? Like finish all runs and show all the values that reverted at the end of the execution any idea why abigen! might be panicking? try catch and write info to files is there a way to do forge remove for all dependencies Remove them manually from .gitmodules maybe I imported the Implementation.sol, but it seems like not working in vscode but it works in forge I mean the red underline in vscod What error? Just vscode integration problem Try to reload workspace How to reload workspace in vsc? Ctrl+Shift+P Developer: Reload Window Oh, seems like it worked I was using hardhat before, but I was started using forge a few days ago When I use hardhat, I felt the convenience of listing candidate files But I can't see the candidate list in importing and even in script. I think it's because of vscode integration or solidity extension problem in vscode I am using this extension now according to the foundry's recommendation.",476
1777,foundry-support.txt,"Juan Blanco But I was using Nomic foundation's solidity extension before Which extension is better? or is there another best extension? I think there is a bug in forge test --debug related to encoding an array of structs in a function signature. The following returns ""error: unclosed character class"": cast call <address> ""updateWeightsGradually((address,uint256)[],uint256,uint256)"" --rpc-url $POLYGON_RPC_URL [\(""0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619"",'990000000000000000'\),\(""0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063"",'10000000000000000'\)] 1679330303 167934459 7 Note that the same function signature compiles successfully in cast call, e.g. cast call <address> ""updateWeightsGradually((address,uint256)[],uint256,uint256)"" --rpc-url $POLYGON_RPC_URL [\(""0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619"",'990000000000000000'\),\(""0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063"",'10000000000000000'\)] 1679330303 1679344597 I wanted a programatic approach Is there a way to override compiler settings just for specific contracts? I want to enable via-ir only for certain contracts, which will reduce the overall compilation time. Hardhat config allows to override such settings on per contract basis. This is Error, why? event Accept(uint256 indexed impactId, address indexed charityPartner); Guys how config .env file? And may send me a to z guide to deploy contract to mainnet Try with vm.expectEmit(true, false, false, true) instead.",416
1778,foundry-support.txt,"Check the documentation to know why foundry.toml extracts automatically the ENV variables, to access ENV from solidity you have some cheatcodes https://book.getfoundry.sh/tutorials/solmate-nft There's a deployment example here Any idea on how to fix this? How do I copy the storage from one contract to another etched one? forge install is hanging for me all of a sudden anyone seen this / know how to fix? tried foundryup & opening a new term getting ready to reboot comp ig rebooting didn't work either could be an issue w chainlink repo in particular? idk forge install smartcontractkit/chainlink --no-commit hm just went thru -- either something temporary or just.. took a couple minutes Chainlink is just a gigantic repo 🙂 i'm trying to compile a project that should work straight after npm install, but apparently i have incompatible solidity version in every file within the project after running a forge test? what would the solution around this be? 🤔 ""Discovered incompatible solidity versions in following : src/AdminFacet.sol (0.8.18) imports:"" and it goes on for every single file. thanks in advance guys. still not working btw, it's not working in UUPS proxy? I also had lots of issues with dynamic library linking not working for deploying contracts (and the same error with Dynamic linking not supported in create command when doing —libraries).",285
1779,foundry-support.txt,"when I tried to add libraries = [] to foundry.toml, all of my tests broke, so this was the only solution that worked for me instead (ugly i know but it seems to be the only way to do it in foundry, idk why libraries in .toml and —libraries operate so differently): forge create --rpc-url $ETH_RPC_URL LIB1 --private-key $SK --via-ir --force | tee /dev/tty | export LIB1_ADDR=$(sed -n 's/.*Deployed to: //p') forge create --rpc-url $ETH_RPC_URL LIB2 --private-key $SK --via-ir --force | tee /dev/tty | export LIB2_ADDR=$(sed -n 's/.*Deployed to: //p') echo ""libraries = [\""src/LIB1.sol:LIB1:${LIB1_ADDR}\"", \""src/LIB2.sol:LIB2:${LIB2_ADDR}\""]"" >> foundry.toml forge create --rpc-url $ETH_RPC_URL MainContract --private-key $SK --libraries LIB2:$LIB2_ADDR,LIB1:$LIB1_ADDR --via-ir --force | tee /dev/tty | export MAINCONTRACT_ADDR=$(sed -n 's/.*Deployed to: //p') sed -i '' -e '$ d' foundry.toml Achievement unlocked! Should I create an issue in github or something? check if you have some really deep recursion in your contracts, otherwise yes why foundry is not installing on my vs code? it shows ""unsupported platform: MINGW64_NT-10.0-19045"" Use a different cli Hi guys is there anything in foundry to deploy the token through api ?? Like from react we can deploy our contract on click of a button you’d probably want a factory contract for that but if you dont want to (for whatever weird reason), youd probs need to make ur own endpoint to run the build command, and then use ethers or smth to build a deployment calldata, and send that overto yoru frontend Can you please describe your use case in a little bit more detail? Here is a quick tutorial how to ask questions about programming: https://xyproblem.info/ I’ve added docs about model checker. Ask for review.",468
1780,foundry-support.txt,"TKS https://github.com/foundry-rs/book/pull/825/ hi, I've got an error deploying large contract TX fee (2.7 ether) exceeds the configured cap (1.00 ether) how can I pass --rpc.txfeecap flag to forge script? (can I?) if I have if (condition1 || condition2) ... and condition1 is true, is condition2 also evaluated? I am trying to spare storage reads just found it, nvm The operators || and && apply the common short-circuiting rules. This means that in the expression f(x) || g(y), if f(x) evaluates to true, g(y) will not be evaluated even if it may have side-effects. Can you load env vars from your terminal environment with envString, or must you include them in the .env in the repo itself You're looking for a factory contract.. google ""factory contract solidity"" Is it possible to specify the address of a library in a deploy script, rather than redeploying every time? is there a way to use forge to download/copy a deployed contract to my local machine? What do you want to do after copying it? Please see https://xyproblem.info/ thanks let me rephrase. i would like to use foundry to completley copy a smart contract that another team of developers deployed onto ethereum so i can make a few minor modifications to it and pass it off as my own. how can i use foundry to do that? cast etherscan-source is that better @miohtama ❤️ ty @gakonst oh wow. was not expecting it to be able to output the expanded source. i keep getting blown away by how awesome foundry is. Is this intended behavior or a bug? sounds like bug 🙂 ok 👍, will report 🪲 I get this error when trying to mine an anvil block to advance the timestamp by 60 seconds. cast rpc anvil_mine 1 60 Error: error sending request for url (http://localhost:8545/): operation timed out Context: - operation timed out Currently I am just waiting for 60 seconds and then mining the block without paramaters, and it works but then I have to wait for 60 seconds.",464
1781,foundry-support.txt,"Is there a flag or a way to get the dynamic gas cost from a transaction? (like calldata gas) Is it possible to use the cast cmd to get the different tokoen balances of a smart contract? void, that just worked it out lol Hey guys, why do calls like this ` > cast call --rpc-url $ETH_RPC 0xdAC17F958D2ee523a2206206994597C13D831ec7 ""totalSupply()"" 0x0000000000000000000000000000000000000000000000000079cd07aa4032d5` get returned in hex? u can specify the return type of totalSupply() ha, thanks. worked prefectly. Hello! Tried to install from github and received an error (see picture). Use Visual Studio Code. How can I fix it? Didn't find an answer in your book( the third line on console: VS Code is a different product, and is not sufficient. what does it mean? the problem begins with link.exe The install is trying to use tools from Visual Studio on Visual Studio Code they are different IDEs So I need to reinstall rustup-init? I have done it twice. Maybe you can send VS Installer to me? I don't develop on Windows, I guess you should use Visual Studio 2017 or further to install from Github ok. thank you windows set up is terrible( has anybody installed on windows already? Hi all, stupid question probably and related to Ethers but I'm not sure where else to parse it. I'm trying to create a Transaction (response - not request as there's no clear way for me to recover sender as its an eip1559 as doesn't have the hash method like the legacy req) and trying to create the struct - what's the proper way to pass through 'None' in an Option struct? Are you interested in earning through crypto investment dm for more information can you help me with fuzz testing? Hi everyone. I cannot seem to get Foundry recognize contracts when creating a contract instance from an address against a fork of a network. As a result, the contract name and its functions are not rendered properly in the traces and not included in the gas report.",455
1782,foundry-support.txt,"Am I doing something wrong? To run the tests, I am using the following command: $ forge test -vvvv --fork-url https://eth-goerli.g.alchemy.com/v2/${ALCHEMY_API_KEY} --gas-report Code could be found here: https://github.com/marchev/ethernaut-denial/blob/main/test/Drainer.t.sol Ur a dude right ? With a fake image ? Why do you think so Is there a way to call a function on a contract in cast without passing the sig? If the source is on etherscan, intuitively feels like like i should be able to say <ADDRESS>.<FNNAME> (<ARG>) Finding it impossible again to use a script to deploy to arbitrum goerli https://github.com/foundry-rs/foundry/issues/4566 Having same issue. I just spam the forge script command with --resume until all of them goes through gm. I’m having some issues with the expectEmit cheatcode. I’m getting: [FAIL. Reason: Log != expected log even though my events are indeed happening and match the execution trace emits.",229
1783,foundry-support.txt,"happened with optimism goerli for me a week ago can you share a repro or the full trace? a bit hard to tell what's going on from the individual screenshosts will share the full repo and correct branch, give me a sec https://github.com/worldcoin/world-id-state-bridge/tree/dcbuild3r/more-unit-tests to repo: - make build - forge test --match test_sendRootMultichain_succeeds -vvvvv https://github.com/worldcoin/world-id-state-bridge/blob/c289d43adadf90bc829fd0f6b98134eb80ee7f41/src/test/StateBridge.t.sol#L100-L112 these lines specifically ah, you want to expectEmit before the call that emits the events and you'll need one expectEmit call for each event you want to test god damn I’m blind thank you so much 🤦🏻‍♂️ heh np, just confirmed this passes: function test_sendRootMultichain_succeeds() public {  uint128 timestamp = uint128(block.timestamp);  vm.expectEmit(true, true, true, true);  emit RootSentToOptimism(newRoot, timestamp);  vm.expectEmit(true, true, true, true);  emit RootSentToPolygon(newRoot, timestamp);  mockWorldID.sendRootToStateBridge(newRoot);  assertEq(mockWorldID.checkValidRoot(newRoot), true); } you can also use vm.expectEmit() as shorthand for vm.expectEmit(true, true, true, true) awesome, TIL Are compiler warnings broken for everyone? I get no sizes and no spdx warnings for source code. Although the docs say that it’s only ignored for the tests by default. Unless I do FOUNDRY_IGNORED_ERROR_CODES=[] in .env They should be working, not sure what the issue is Check your foundry toml perhaps? toml is default. Issue is - I assumed the default doesn’t hide any warnings? If it hides - then only for tests at least? Warnings are being suppressed for ""source"" as if it were ""test"".",445
1784,foundry-support.txt,"Basically SPDX and Contract Size warnings are not showing up when compiling the source code through forge or am I reading it incorrectly? (“none for source”) It seems that default config is silencing them as well? https://github.com/foundry-rs/foundry/blob/master/config/src/lib.rs#L1768 Ah --resume ey? Hi, new to foundry. If i have several contracts that are all interrelated should I make a separate ""migration"" contract that deploys them all and links them up? And then have my tests inherit that migration contract? you can do that yeh just start with a big contract and then split it in smaller ones as u see fit cool thanks When deploying using broadcast within a script how do you specify the specific address. I am passing the private key broadcast(pk) but it is using an address of that pk with no funds? Hi all, is there a way to disable all warnings for forge test by any chance? --ignored-error-codes error_codes ? Hm, thanks for that :) asked this question in the other foundry chat earlier; but is there some kind of afterAll hook that can be run after all the fuzz runs are completed? what other chat is there? Hey when using anvil and trying to test out your own contracts how do you give yourself some eth for gas? I'm trying to understand the bound cheat code, but I found the docs lacking: https://book.getfoundry.sh/reference/forge-std/bound Do the second and third inputs to bound specify a range or options? Anyone able to help with this one? hi guys, gm! just wonder if there is concept of abstract function on solidity like on java, kotlin etc I know there is like virtual keyword but it doesn't force you to implement that function Im not using interface as this internal function only nvm, I got it now :D Is it possible for forge test to deploy a contract at a specific address to perform tests? I know I can use etch to set the code of any address and prank to set the caller. But didn't find how to set the contract's address when testing. Could you please help? Foundry Support What do you feel isn't clear? Eg. function testValue(uint256 value) public { value = bound(value, 0, 10); } Your value will always be 0 - 10, you can think of it as being similar to using modulo operator (`%`), eg.",501
1785,foundry-support.txt,"`someLargeUint256 % 10` will always return a value between 0 and `10` because the remainder is bound by `0-10`. With the testValue example above, you'd get: input:output 0:0 1:1 2:2 3:3 ... 9:9 10:10 11:0 12:1 13:2 ... 18:7 19:8 20:9 21:10 22:0 ... @gakonst anything to prevent me doing deployments using salted contract creation directly from my foundry deployment script? Instead of having to deploy a constant-address-deployer contract? Is there currently any way to wait for a block to be mined in Scripts? sorry I don't understand, can you just deploy the contract to any address then just etch that contract's code to your target address? there is not, but you can use --slow to have each tx wait for the previous one to be mined before broadcasting if you deploy with new MyContract{salt: salt}() in your scrit it will automatically use a create2 deployer contract Nice Thanks has the behavior of stdJson.readString changed recently? Trying to read a missing key used to revert, and now I get an empty string:   // this used to work, now test fails with ""didn't revert as expected""   // vm.expectRevert();   // stdJson.readString(json, "".properties.property_name2"");   // now returns an empty string   assertEq(stdJson.readString(json, "".properties.property_name2""), """"); (or maybe vm.parseJson changed?) If i use anvil to start a local network, is it compatible with hardhat network? (if I deploy a contract in hardhat env on local, this contract could be use the anvil local env too?) Yes, all EVM JSON-RPCs are compatible, minus their internal RPC calls you can even connect your Metamask Got it, Ty! I am Looking for some advice. I am writing a test that I want to fail if a callback is reached.",432
1786,foundry-support.txt,"In the callback method I tried adding fail() and assertTrue(false, ""Callback should not be reached"") and a log to confirm the callback was reached easily $ forge test -vv -m testMaxBorrowCheckBeforeCallback [PASS] testMaxBorrowCheckBeforeCallback() (gas: 563734) Logs: Fail test if callback is reached Error: Assertion Failed Test result: ok. 1 passed; 0 failed; finished in 13.39ms My guess is the call is made within a prank and thus the caller is not the Test contract address and thus its ignored. Any tips or suggestion? Gm, any update on this? Gm, unfortunately have not had the time to work on this yet Ok, thanks 🙂 let me know if you find the time though, would be super useful for many people 🙂 Have you found the format of the json that can be uploaded to the Safe UI? Can i use deal cheatcode in hardhat? nop https://github.com/foundry-rs/foundry/discussions/4475 I'm trying to use the vm.sign cheatcode and then verify the signature via ECDSA.recover. However, the signature never matches.",241
1787,foundry-support.txt,"I'm not super familiar with toEthSignedMessageHash or the expected formats, so perhaps I'm missing something there? Any help would be appreciated!  function testSigning() public {   uint256 BOB_PRIVATE_KEY = 1;   address BOB_PUBLIC_ADDRESS = vm.addr(BOB_PRIVATE_KEY);   bytes32 dataToSign = keccak256(abi.encodePacked(""somedata""));   (uint8 v, bytes32 r, bytes32 s) = vm.sign(BOB_PRIVATE_KEY, dataToSign);     bytes memory sig = abi.encodePacked(r, s, v);   bytes32 hash = dataToSign.toEthSignedMessageHash();   // THIS ASSERTION FAILS   assertEq(BOB_PUBLIC_ADDRESS, ECDSA.recover(hash, sig));  } Thanks! this assertion works: assertEq(BOB_PUBLIC_ADDRESS, ECDSA.recover(dataToSign, sig)); you want to sign and recover from the same hash https://hackmd.io/HFHohGDbRSGgUFI2rk22bA?view there is a proposal for batchTransactions Rpc method you could probably run anvil in a docker container using libfaketime to cheat and speedup block production i have done this though i was using Parity client Thanks. I. need to make it an Ethereum Signed Message because that's what is expected from within the function I'm calling. I'm trying to implement a signature validation method like the example here https://github.com/eth-infinitism/account-abstraction/blob/develop/contracts/samples/SimpleAccount.sol#L111 and in there it is converting the passed in hash into a ESM. Do I need to sign the ESM itself? Did you figure this out? Running into the same issue So what are people doing then? New private key for every address. Don't use multiple addresses from same key Anyone know how to get the foundry invariant tester to also fuzz reentrant calls? Hi, all of a sudden I am getting the error Invalid character 'x' at position 1 when trying to use the —debug flag. I reinstalled foundry and tried to reduce the size of the testing functions. this even happens on empty tests that just have parameters. Some other peopole in the chat have had this issue but there is no solution listed. There's an open issue with this error but no comment on how to fix it.",495
1788,foundry-support.txt,"Thanks in advance Does forge build work? Yes Could you share a gist of the code & error to provide more context? ideally the whole repo I think that some work may have been added to the debugger due to fuzzed tests. Are you debugging a fuzzed test @addisonthunderhead ? Yea its a fuzz test Getting the error just with this haha forge test --debug testFuzz_Calculate -vvvv For fuzz functions I'd recommend you use forge debug --sig ""yourFuncSig(a,a,a)"" <arg1> <arg2> ... kk trying now This breaks it apparently: https://github.com/foundry-rs/foundry/blob/master/cli/src/cmd/forge/test/mod.rs#L190 can have a look tmr Yep that is working. Appreciate it! Bit annoying to have to manually type in the sig along with the args but I guess that will suffice for now thanks appreciate it yes, in that case convert to an ESM first, sign that, and then recover from that too  function testSigning() public {   uint256 BOB_PRIVATE_KEY = 1;   address BOB_PUBLIC_ADDRESS = vm.addr(BOB_PRIVATE_KEY);   bytes32 dataToSign = keccak256(abi.encodePacked(""somedata""));   bytes32 hash = ECDSA.toEthSignedMessageHash(dataToSign);   (uint8 v, bytes32 r, bytes32 s) = vm.sign(BOB_PRIVATE_KEY, hash);   bytes memory sig = abi.encodePacked(r, s, v);   assertEq(BOB_PUBLIC_ADDRESS, ECDSA.recover(hash, sig));  } Is there a difference between forge debug and forge test --debug Unclear from the docs. https://book.getfoundry.sh/forge/debugger#debugger forge test --debug lets you target a specific test function, forge debug lets you target any function in any contract (code: -32000, message: already known, data: None) Getting this error, which is apparently a nonce issue on Polygon Mumbai (Alchemy RPC) anyone have any idea why my foundry gas reports are about 10x less gas than identical hardhat benchmarks? the numbers i’m getting really don’t make any sense hi sol folks , got some questions for you background : i am mocking smart contrct using smock library .",479
1789,foundry-support.txt,"and typically i am using their .setVariables() method to set some values into my defined variable . like here : it.skip(""should revert if the user's voucher balance is equal to zero"", async () => { await mockPMC.setVariable(""userPoolInfo"", { '0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC' : { 1: { cycle: '1', phase: '1', voucherBalance:'0', assetBalance:toUnit(0), rewardDebt:toUnit(0) } } }); ... }); Here for the first 1 , i set it to be a static value since there are some issues with it , which i want it to be a dynamic key-value here , i.e. mockWethToken.addres , etc as for each contract deployment , the address would be different , so wonder how we can set it dynamically here hey there how would I do a multichain verify? can tracing including internal function calls/jumps too? gm I have a question about fork testing behavior, wasn't sure if this was a bug, so thought I should bring it up here. When you are executing a function of deployed contract of the forked network, is the intended behavior supposed to execute the code that exists on the forked network or will it execute the updated contract in my local environment. currently, it is doing the latter How sent ether to contract in script file when deploying it? new Contract(...){value: 1 ether} what do you mean by ""updated contract"" here? Do you update the already depoloyed forked contract? no, I have not updated the already deployed forked contract, but the tests seems to be running the logic contract that I would like it to be updated to hello, foundry has Smart contract upgrade testing and deployment of lib？ like OpenZeppelin Hardhat Upgrades when using `forge coverage` command can I configure it in order to not have coverage on my scripts/ but only on my src/ files ? https://github.com/chugsplash/chugsplash Hi everyone, is there a way to generate random numbers in foundry without depending on block timestamp or difficulty.",452
1790,foundry-support.txt,"This is a link a I found https://github.com/joejordan/foundry-random/blob/main/src/FoundryRandom.sol Does this work Thanks in advance https://t.me/foundry_support/33827 Thanks I realize this has been asked before, but I haven't seen a clear guidance for it. What's the best way to write tests for internal functions? What some people do is that they create a separate test contract inherting one with internal functions and then stress the target contract using special test related methods that can call internal. Unfortunately Solidity is a bit inflexible language, so I am not sure if there is better way you can check maple labs test files Hello, if my forge script broadcast bradcasted only 2 out of 4 transations, how can I sent the remaining 2? I have them in run-latest.json Hi, when I use ""forge verify-contract"", it cannot be successful, and the output HTML prompts ""verification enable javascript and cookies to continue"". Does anyone have any suggestions? What is the difference between vm.roll and vm.rollFork roll just mutates the block number without otherwise affecting active chain state? Hi, I'm getting the stack too deep error with forge coverage. I'm not getting it with forge build tho and I have no value0 variable so this may be an issue with coverage? We are working on an AI tool to speed up testing creation, can someone give me a list of well tested repositories and which cheatcodes are the most useful in your opinion? We have created one that generate NatSpec doc for solidity functions pretty efficiently and we are looking to integrate more stuff... As I love foundry myself I would like to build stuff that works with it. Any other ideas? checkout solmate, seaport https://github.com/ProjectOpenSea/seaport/tree/main/test/foundry Thank you, will check it and use as reference for the tool performance In my handler contract for my invarient when I add a vm.prank or vm. Assume all calls revert. Did I need to load the vm contract or something. Is this a bug? Followed the docks but doesn't seem to work? If you remove the isOwner modifier no reverts but with it everything reverts. Doesn't make sense. It's not even calling my contract. theres a list somewhere in the docs of repos with good tests. The details you provide are not very clear.",497
1791,foundry-support.txt,Shall I paste the code? I don't know how to be clearer than sharing the code and result? My question is when doing invarient testing how to tell the handler to call a specific function only with specific address? vm.prank(address) will make msg.sender = address in the next function you call Or vm.startPrank / endPrank as you have is there a way to do deal on SNX token? But it reverts all the invarient calls. Why? what is the revert reason? I'm not sure what you mean by invariant in this context. there is no invariant in your code OK i'll just keep trying to work it out. I'm following this article: https://mirror.xyz/horsefacts.eth/Jex2YVaO65dda6zEyfM_-DXlXhOWCAoSpOx5PLocYgw The invariants are in the test file. The code I shared is my handler contract. Repository? Doesn't work with standard deal function? no it doesn't. foundry-std yells that it is packed slot Because your env is not set for CI. You need `CI=true` Is the address a proxy? Usually when it doesn't work I fix the forking block and I impersonate a SNX whale to get all the tokens I need. Might not be the cleanest solution but the easiest for sure I have solved it by exploiting the unique proxy which the token has Proxy and TokenState as separate address and Proxy can call setBalanceOf to set it to whatever I wanted Thanks btw Std-storage doesn't currently support writing proxy storage An deal uses std-storage to override the balance variable good to know! Synthetix proxy isn't really a proxy lol 😂 Disable Via IR OK solved it. I had an active prank open in my test contract so vm. Prank was failing and reverting all the calls but in foundry.toml fail_on_revert was set to false so didn't see the error. What a dumb mistake lol Thanks 👍 still stumped on this. bumping if anyone has experienced anything similar. tl;dr forge gas report showing -1000% of identical hardhat reports (21k base transaction units accounted for).,456
1792,foundry-support.txt,"I don't have any idea but might be able to take a look if you share more information (what are the tests, etc) Is it possible for forge etherscan verification to give guarantees on file ordering? For example if you deploy Contract.sol with two dependencies IERC721.sol and Context.sol, sometimes file 1 will be Context and file 2 will be IERC721 which makes it hard to see the core entrypoint. Would be nice to have the main contract being verified always appear first on Etherscan Heads up for those of you seeing Error: Error: certificate has expired: a bunch of github certs seem to have just expired: https://news.ycombinator.com/item?id=35295216 oh that's been for a while in fact some of the organization-level gh pages stopped working like a month ago ah, interesting, maybe a cache just expired or something? seems to have just started for foundry-rs/foundry-toolchain on our CI ah sorry, I have NET::ERR_CERT_COMMON_NAME_INVALID (seems to be fixed now) Possibly an ignorant question. Why cant foundry show the line number of a revert? Annoying to keep having to go into the tracer to find it. I’m an expert in Forex trade/Cryptocurrency and I help individuals make good profit weekly,  I work with one of the best forex trade and binary option trade platform, I can guarantee you of good profits if only you’re ready to begin I will help you earn over $5000 in few days inbox me for more tips How can i do equivalent of deal cheatcodes using only anvil rpc methods? How hard would it be to implement such a cheatcode? I'm imagining something like vm.waitForBlocks(10). This is currently a hard requirement in our project (Gitcoin Allo Protocol), where we would love to use Foundry for deployment.",381
1793,foundry-support.txt,"Cast impersonate account then transfer from an eth whale I think the method is anvil_impersonateAccount I need get erc20 token without getting holder address anvil_setStorageAt Lol its been 6 months since I asked this lol What do yall use to autogenerate the natspec boilerplate? Does Anyone has a repo where I Can find some examples about Unit testing for script ? I looking for that I could not find it theres a list somewhere in foundrybook https://book.getfoundry.sh/tutorials/best-practices?highlight=natspec#comments bottom of the page I'm getting these errors: I dont know what cell keep erc20 balances This is my Toml can someone point me to the right direction in the docs>? calculate it, keccak256(address + slot of balance mapping) I'm not clear on why its not importing { GovernanceToken } is there a specific way I need to add this to my toml file so that it deploys? what is it that im missing from y toml so that this error can go away? fixed* address(this).call{value: 0.019 ether}(""""); I just got a bug 🪲 How you did this beautiful output? I fixed it by changing https: to http: and it worked! vm.startBroadcast(private_key); sets the owner of the private key as the sender but this entry is of course incorrect, since the currency will be sent to the script contract I don't know. what you're even doing? which contract? BNB? Yeah i nemed it BNB address(BNB).call{value: ... }(""""); or if you set the constructor as payable, you can make BNB = new bnb{value: ...}(); what is the error? address(BNB).call{value: ... }(""""); that didn't work either? Can you share bnb.sol in DM? im trying to understand how to write a deploy script that uses network specific values for constructor args. for example, if im using chainlink vrf, i need to use a different LINK token address on avax and fuji. id like to be able to put these in .env and have one script for deploying to either network.",456
1794,foundry-support.txt,"feels like a dumb question but im really lost how to do this? should I be using foundry.toml profiles? should i store these values in json files named per network so i can parse them in my script? is it possible to set an explicit address to deploy to in forge? sorta, depends what you mean by explicit. you can follow this guide to mine a vanity address you can deploy to - https://0xfoobar.substack.com/p/vanity-addresses thanks! was kinda hoping for some cheatcode magic but this will have to do Is there a precommit hook for forge fmt deployed anywhere? https://pre-commit.com/ Can't you go with npm project initiation and husky? im trying to help a project build a bioletplate of contracts with just use of npx. For example, npx create-web3-dapp creates a whole dapp with UI and contracts, and we use hardhat currently. I was thinking of some ways to integrate foundry. Any ideas what can I do here? How do I update the GasLimit for FEVM? that means there is something wrong with your contracts. run whatever you're doing with -vvvv to get a trace and see where things are going wrong. or use debug vm.envAddress() to get addresses from a field in .env Do you all manually generate your natspec comments? copilot? Or is there something that exists that will autogenerate all the boilerplate. New to solidity so not familiar with best practices. would be great if someone could share some insight Personally try to avoid boilerplate comments. Copilot is good as is gpt and derivatives but natspec for natspec's sake is mostly noise okay thanks. was thinking to comment everything with natspec and then autogenerate markdown documentation from there so that there are inline docs as well as more readable ones doesnt quite get me there by itself. got a hacky solution but think its not right why? works fine for me here's more info - https://github.com/0xEssential/NFTGiveaway/issues/1 i want to pull a different var from env depending on what chain we're running a script against.",445
1795,foundry-support.txt,"i dont want to edit the script source or .env when i want to run against a new chain oh i see what you mean what you have seems fine tbh Instead of putting the token addresses in .env file, why don't you create a config.json file that would looks something like { ""MUMBAI"": ""0x123..."", ""MATIC"": ""0xabc..."" } And then just read the value for the currently selected chain? In fact you could specify every deploy parameter this way, and use a common script for deploying everywhere fwiw you don't really need CHAIN in .env as well, just do forge script -f MUMBAI script/Deploy.s.sol instead. You could get the alias for the currently active chain using getChain() method in the script (assuming you have a fresh enough forge-std library) yeah im running with $ CHAIN=MUMBAI forge script script/Deploy.s.sol so its not in .env, but will check out getChain again, felt like it kept returning 0, so maybe im out of date. and haven't seen -f before. but super helpful, thanks! how to deploy on forked local network? forge create --fork-url https://Test.com but I want to make sure it get deployed on local node..not the mainnet.. something like --fork-url https://test.com --node localhost seems like interactive mode for the signer (-i) does not work with cast send despite being listed in the help file. I’m getting No wallet or sender address provided. Consider passing it via the --from flag. is this expected or am I missing something? Interactive will let you enter the password interactively, but you should pass the --from in your command Hmm… on forge script for example, -i works without —from Are you using a keystore and trying to enter a password for it? Or trying to enter the private key interactively? enterering the raw PK interactively Hmm good point, it does seem like this is handling it differently. I noticed some bugs recently in similar commands that got fixed. Might be an underlying logic bug/difference here hi guys, question it is possible to test private or internal function on sc https://book.getfoundry.sh/tutorials/best-practices?highlight=internal%20functions#test-harnesses thanks! okie, I guess already got this before, looking more way to test it without extending etc..",499
1796,foundry-support.txt,"btw thanks! I want to test it on actual implementation if possible How do I run the getTransactionCount(address) in foundry test? I want to recreate this in my foundry test.   after(async function () {    expect(await victimContract.balanceOf(attackerWallet.address)).to.be.equal(5);    expect(await ethers.provider.getTransactionCount(attackerWallet.address)).to.lessThan(3, ""must exploit in two transactions or less"");   }); https://book.getfoundry.sh/tutorials/forking-mainnet-with-cast-anvil?highlight=impersonate#transferring-dai do I really need to use CLI for testing? Is there another way I can test these mainnet addresses locally by forking? https://book.getfoundry.sh/forge/fork-testing how to interact with mainnet addresses? impersonate like hardhat lets you do it in test file? This is quite weird. Does anyone know how to make it work by any chance? vm.deal(token, to, 1000000000000000000); (via forge test) error[6160]: TypeError: Wrong argument count for function call: 3 arguments given but expected 2. Don't use vm Just deal Haha wow didn't think about it, thanks! Just received that from a friend trying to learn to use foundry what the heck Hey is there any way to check the values of the assertion that is failing on a invariant test? I'm using assertEq which would normally print the left and right values but doesn't seem to be the case with invariants Nvm, I didn't knew vm.assume was not supported with invariants! Do you know if there is a global cache for forge? My forge stating to be really slow each time I want to compile since days? On my side, It was caused by the rpc endpoint, are you forking any network ? I'm trying to understand how [Wallet Options - Remote](https://book.getfoundry.sh/reference/forge/forge-script#wallet-options---remote) is intended to work. Is it correct that the accounts to sign from must first be unlocked on the RPC endpoint? And, is the number of signatures returned == number of addresses passed in? Is this to support multi-sig wallets? Pardon if this is obvious.",471
1797,foundry-support.txt,"Is there some mechanism to run a trace for a specific transaction hash on mainnet/fork? sorry I don't understand what the hard requirement is here / why you need this to deploy? note that you can just use vm.ffi to call out to e.g. a node script to wait and probably call the script again recursively if the block is not the needed one @vacekj that's a good idea, i'll try it out still just curious why you need to wait 10 blocks between script txs though? 😅 i'm in call rn, will write it down in a second no rush, just want to make sure there's not a better solution cast run vm.warp(uint256) will work for local deployments though, right? I think it has a good use case on localnet for easier e2e test setup. by ""local deployments"" do you mean anvil? if so, no, cheat codes only work within forge. with anvil you use special RPC methods to make changes, similar to hardhat yes, I use anvil rpc methods to change the timestamps direclty, but that doesn't work for normal testnets. So, we have a deploy script, currently written using Hardhat and Ethers, that deploys a bunch of contracts. One of these contracts is a quadratic funding voting contract, that has two period - application period, where you can apply with your projects, and voting period, where anyone can vote on projects. The reason I need to wait for blocks, is that when I deploy the contract, the application or voting periods are not yet open. So I need to listen for blocks, wait and only apply or vote when the periods are open. this is a special case, as we are not only deploying contracts, but also doing some scripting, but given that Foundry advertises solidity scripting, I think this is a valid use case. I'm imagining some kind of waitForBlocks(blockToWait) method.",399
1798,foundry-support.txt,"pseudocode would be: vm.startBroadcast() deployContract deployAnotherContract vm.stopBroadcast() // at this point we need to wait for 5 blocks until voting is open vm.waitForBlocks(5) vm.startBroadcast() contract.vote(1, 2, 3) vm.stopBroadcast() it would sound logically fitting to me to have a uint256 blockNumber parameter in vm.startBroadcast() in this case is the vm.ffi call synchronous? so if I call a nodejs script that just statically waits for 10 seconds, will the deploy script also wait? yea it waits for ffi to complete Hey all -- is it possible to manually set the contract address when calling force create? Trying to set up a Docker container that spins up a local node and deploys a contract -- would be super handy if I can manually set the deployment address `forge create`** (for further context the local node is using `anvil`) I have a fuzzing test that bound 5 variables The goal of the test is to test some math and I end up with unequal math I log the parameters that are fuzz and I reproduce in a test without fuzzing and I got an equality Any idea how ? want to share the snippet? For anyone else wondering -- the address is deterministically generated based on the account's nonce (https://ethereum.stackexchange.com/a/761) Resolved, thanks Hey, does anyone know if it's possible when etching a contract to also copy its storage and not only the code? I'm trying to deploy a contract on a specific address that is part of a merkle proof to do some testing. Are there any npm packages to install foundry and use forge? 🤔 Not the hardhat plugin that uses foundry Yep just forge clean works nice now 😉 Did the address used for the test contract change? The Foundry Book says that it should be deployed at 0xb4c79daB8f259C7Aee6E5b2Aa729821864227e84, but in my tests the address I'm getting is 0x7FA9385bE102ac3EAc297483Dd6233D62b3e1496 it's not, you'll have to do it manually, the main issue with automating this is determining all storage slots in use (e.g.",479
1799,foundry-support.txt,"all mapping keys) are you changing the --sender or anything? hard to say without more details, maybe open an issue with steps to reproduce Do you have some resources to learn about the memory layout of the EVM? based on your previous question I think what you want is to learn how solidity arranges things in storage, which can you learn about in their docs https://docs.soliditylang.org/en/latest/internals/layout_in_storage.html Thanks a lot! No, and I've confirmed I'm getting the default sender 0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38. Actually, it seems that 0x7FA9385bE102ac3EAc297483Dd6233D62b3e1496 is the expected address that gets calculated when deploying a contract from that sender with nonce 1, so I'm confused about which of them is supposed to be the right address for the test contract seems the book is outdated and you have the correct address https://github.com/foundry-rs/foundry/blob/518e8919f93a09497f778843baed797be23a6c2a/testdata/core/ContractEnvironment.t.sol#L16 Yeah, looks like it. The other address is still used here, though https://github.com/foundry-rs/foundry/blob/518e8919f93a09497f778843baed797be23a6c2a/evm/src/lib.rs#L46 @joshiedo do you remember the difference in each address here? I recall this is related to the sender vs. caller change where we made them the same, so surprised the 0xb4c79daB8f259C7Aee6E5b2Aa729821864227e84 is in the code.",392
1800,foundry-support.txt,"Is that outdated and should be changed to 0x5b73C5498c1E3b4dbA84de0F1833c4a029d90519? I'm also seeing that the test contract addr is 0x7FA9385bE102ac3EAc297483Dd6233D62b3e1496 (nonce 1 for sender of 0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38) and not 0x5b73C5498c1E3b4dbA84de0F1833c4a029d90519 (nonce 0 for same sender). What's happening at nonce 0? Looking at the logs it seems contracts are deployed at both addresses Anyone know why forge script would have networking issues? I'm getting the error below when I try across three different hosted providers: error sending request for url (https://goerli.infura.io/v3/abc123...): error trying to connect: dns error: failed to lookup address information: nodename nor servname provided, or not known Anyone know if there’s a way to run coverage on a fuzz test? Seems like it only runs once by default for every fuzz test ? i think for coverage in particular you only need to know how much code was covered and therefore the cumulative results should suffice although im not sure if its the cumulative result, but yeah you get the idea, one result should be fine hey guys, am trying to use ignored_error_codes = [5159] on foundry.toml to avoid selfdestruct deprecated warning but seems it doesn't works, any thoughts? Please any help 🥺 If I give an already verified address to forge verify-contract will it check that my contract matches the contract on etherscan? Hello guys Anyone doing zkSnark? Also anyone that it's using foundry in non obvious way? I'm doing some research Hello, I have an issue with chisel, I'm trying to replicate behaviour from chisel readme.md. But in my local env call to contract view function doesn't print any output. I'm missing something? How about removing semicolon? Unless I explicitly retype to string, it wont print the name in correct format.",475
1801,foundry-support.txt,"if my project lives in myproject/contracts/foundry.toml and I have another myprojec/frontend, is there a way to not include the .git inside my myproject/contracts? or what is my option here? Has anyone faced an issue while switching branches with different submodules? And how did you overcome it? Hello Community, I've got ~20 end-to-end tests that need to verify different aspects of my application's configurations. The tests focus on outcome verification given a specific scenario. While the initial setup (setUp()) for each test is the same, the parameters or arguments differ. Each test case looks like the below, where TESTCASE identifies the given test case to load. **Test is inherited via TestSetup contract FailTest1T0 is TestSetup { uint256 constant TESTCASE = 1; function setUp() public { testSetup(TESTCASE); } function test_FailTest1T0() public { create(); enter(); eval(); assertEvalFail(); } } I want to reduce the number of test files to 1 if we can find a way to interface setUp(), place setUp() in a for loop or have it accept an argument. Has anyone run into this situation? And if so how was it overcome? c send 0xE2CbfAF63B0722576743B53403EEc940AdC727fa --value 1ether --from $ETH_FROM --password $ETH_PASS this gives me (code: -32000, message: unknown account, data: None) why? and I have the rpc in there too even though I forgot to put it in this example Hi guys! forge test hangs when testing invariants through a fork. I opened an issue about it: https://github.com/foundry-rs/foundry/issues/4656 I have witnessed hangs sometimes because the source node is broken somehow It hangs for me in every attempt.",388
1802,foundry-support.txt,"Do you know by any chance a workaround I could use? First try another node if you can repeat the issue Does forge docs support “custom:asdfasdf” natspec tags? yeh What does forge script —resume do? WIll it resend with the SAME NONCE or create new txs? Or, is it possible to resend deploy txs in the mempool sent with`forge script` by calling —resume and passing a different `with-gas-price? Do I have to add anything in the command line? Cause I don’t see my custom tags in the docs 🙁 I’m using it like this: @custom:permissions Governance Is there a way to deploy with a script and link a library that’s already onchain, rather than redeploying it? polygon zkevm is fun lmao >oversized data >data: None wtf (contract bytecode is <24kb) downside of zkevm is you get zk about your error messages 👌 /s > fatal: Unable to find refs/remotes/origin/v1.2.0 revision in submodule path 'lib/forge-std' if forge update fails do you just remove the folder & re-install? nm read the open issues in the repo hey how do I get a json abi file with foundry? ha. found it. lol hey guys. I got issues using --ledger --mnemonic-derivation-paths ""m/44'/60'/0'/0"" it gives me the wrong EOA General development question as someone using Hardhat but considering a change over.. does Anvil behave more like a real blockchain than Hardhat? I built a ""faucet"" utility which sends money between a central bank and different custodial accounts. I was able to fully build & integration test this thing with Hardhat and only realized once I got to testnet that I had a major bug -- no transactions were being signed, and somehow Hardhat was automatically signing them for me.",403
1803,foundry-support.txt,"Would testing against Anvil instead have prevented this bug? hey i usually done contract deployment with foundry, but i dont know why this time i got this error (code: -32000, message: contract creation code storage out of gas, data: None) i have enough eth for deployment size < 24kb i guess no because its a standard contract Try providing a manual gas limit then how can i do that? in foundry.toml ? Provide --gas-limit along with forge create okay thanks man! Tried with 4 diff nodes and same issue 😕 does anyone know how we can use Quicknode in foundry? Quicknode is not different from any other JSON-RPC provider yea^ It was commented on my issue that pinning a block number + a fuzz seed would resolve it, but it wasn't in my case No Do you have Via IR enabled? If you mean passing --viar-ir to the CLI when running forge test, I hadn't. But I tried right now and same result. If you meant a different thing, please let me know and I'll try your way no i mean using optimizer can cause issues Ur issue is arbitrum related Arbitrum related in like the issue is from the arbitrum network itself and there's nothing that I can do to fix it? I haven't enabled the optimizer can only guess if there is no repo or way to see if the error is reproducible but if it were a generalized arbitrum issue with forge, then everyone forking arb would have this problem and it'd be fully known by now, which I don't think it's the current situation Like i said ser, can only guess without more info Also the issue is with invariant tests only. Property-based works fine Is this info you need something that I can give you? Someone suggested cache issues. When I do forge cache ls, I get an output of 0.0B for arbitrum, but there's data on ~/.foundry/cache/rpc/arbitrum/<blockNum>, but I don't what to do from there Is there a way in foundry to deploy a library manually? Trying to workaround https://github.com/foundry-rs/foundry/issues/4339 by deploying my external library beforehand and setting up linking in via the compiler, but getting TypeError: Invalid use of a library name.",474
1804,foundry-support.txt,"when i try to manually deploy a library :/ Any ideas / suggestions? Any thoughts on this: https://github.com/foundry-rs/foundry/issues/509#issuecomment-1478719558? I could work on it after it's agreed on which UX to move forward with? hey folks in fork tests my approval for usdt fails even though the allowance before was 0 contract Tester is Test { IERC20 usdt = IERC20(0xdAC17F958D2ee523a2206206994597C13D831ec7); function setUp() public {  uint256 forkId = vm.createSelectFork(vm.rpcUrl(""mainnet""));  vm.selectFork(forkId); } function test_approval() public {  emit log_uint(usdt.allowance(address(this), address(0x44444))); // 0  usdt.approve(address(0x44444), uint256(1)); } } any idea why thats happening? i thought it should only revert if the allowance is higher than 0 Can I debug an on chain transaction using a local contract that has the same storage layout and logic except a bunch of console.logs I’ve added to tell what’s up? Maybe you can do a mainnet fork and etch() the bytecode with the log statements onto your contract. Haven't tried it before so not sure if that would work. Have you considered using tools like tenderly to debug the tx? Nice idea, maybe I will give that a go. Will take a peek with tenderly too U can do this in hevm Still an edge for the hevm huh Hey i want to build many solidity files with different pragme version in forge build , how can i achive that? Is there any way to check the call trace for invariant testing even if the tests pass? ran into a weird ..",380
1805,foundry-support.txt,"already handled by foundy https://github.com/foundry-rs/forge-std/blob/master/src/StdCheats.sol#L196 not in the book/docs yet tho ah ig assumePayable was actually the helper i wanted name seems a little off but maybe im not thinking about it correctly I want to ask this question as well. in addition, I am writing invariant test for ERC4626, and I add a additional function to rebalance the total assets but this function wasn't triggered by invariant test. mint, deposit, redeem, withdraw were running smoothly. here's the log I changed the assertion from Ge to Eq then the rebalance function was called Hey Folks, do we have anything in foundry through which we can verify a contract that is deployed by a factory contract. technically a codehash check cannot satisfy or infer that certain invariants are maintained because contracts can write to their state during construction time. so really depends what you need to be able to satisfy for ur use case Hi how do I inspect private variables of a contract in Foundry, say I have uint256 private num .",223
1806,foundry-support.txt,"Hello everyone, what does gas-reports section mean? What is configured here? contracts you want to be included in a gas report Hey guys I'm trying to verify a contract with foundry - doing it all in one step with the create command And I am getting this error: Submitted contract for verification: Response: OK GUID: wt28zi8xsmzbgnyeryvtau2gbb8k5yepwi1jzdwjrzmfdekrtf URL: https://sepolia.etherscan.io/address/0xbaca359e5291d07401d9d4be4c5eb127febd8797 Contract verification status: Response: NOTOK Details: Pending in queue Contract verification status: Response: NOTOK Details: Fail - Unable to verify. Solidity Compilation Error: Source ""node_modules/@openzeppelin/contracts/utils/Context.sol"" not found: File not found. Searched the following locations: """". Contract failed to verify. My contract compiles locally and I can deploy it on anvil and it works - it seems the issue is with using @openzeppelin via node_modules - anyone run into this and have any solutions? Also obviously compiles because foundry compiles the contracts before it deploys them, and the contract is successfully deployed to sepolia. It's just the verification that fails Can I share a test file’s ‘setUp’ function in a file ‘A.t.sol’ for other tests in the other files? Hi, using cast run to debug transactions on mainnet; however none of the contracts/function sigs/ events are decoded properly.",332
1807,foundry-support.txt,"how to fix? Why my foundry dont run fork mainnet! I dont get and src builded and i havent any error just dont work How are you debugging with cast? Cast run <tx> congrats to the team on the optimism thing anyone having issues deploying on arbitrum? I'm trying to make persistent changes with a script to local anvil, while impersonating account I don't know private key to, using forge script script/prepare-pairs.s.sol:PreparePairs --fork-url http://localhost:8545 --broadcast --sender 0x8894E0a0c962CB723c1976a4421c95949bE2D4E3 --unlocked Script simulates properly, but doesn't execute, gives error (code: -32602, message: No Signer available, data: None). What am I missing? forge test —fork-url= bsc-test is so slowly is goerli quick than bsc test Is there a guide about how to using cast? https://book.getfoundry.sh/reference/cast/cast Then ask a more specific question lol what are you trying to do good ser? cast --help  is a great place to start given that you need to copy state I would say yes. Maybe it's an rpc problem Hi can anyone help me? I want to deploy a library and then use its address to link in a smart contract before deploying it.",293
1808,foundry-support.txt,"Is there any example or doc in foundry for this Hi team, I am running some fork tests but I am getting an issue with an existing mainnet contract on arbitrium that ""This contract does not exist"" I ran foundryup too Haven't faced this issue before Hi, I am also running some fork tests on arbitrum and encounter some errors also with nightly-0f1dea4f464b07539c66f3ca37f89ad0e7c34356 By downgrading to nightly-7398b65e831f2339d1d0a0bb05ade799e4f9d01e those errors are not present @Viraz04 could you test by downgrading also to see if it might be linked ? nightly-0f1dea4f464b07539c66f3ca37f89ad0e7c34356 is the actual nightly from 20 hours ago whats the most industry standard way of deploying upgradable contracts with foundry? Deploy the proxy, set the implementation. If you have permissioned contracts call the initializer in the same transaction as the contract is deployed I have a repo with examples if you need https://github.com/jordaniza/OZ-Upgradeable-Foundry no need to have a proxy admin and other peripherals The just deploy as uups or just use a vanilla proxy Related to this would you be open to remove the normalization version in foundry-toolchain to be able to pin a specific nightly version ? It would allow to not be blocked between fixes https://github.com/foundry-rs/foundry-toolchain/blob/master/src/utils.js#L18 @Viraz04 did downgrading worked ? Dm'ed you Can you mention the downgrade command in fact already possible to pin a specific foundry version already my bad Someone have forge coverage that is working with invariant test ? I implement some invariant and forge coverage is running infinitely and I am no longer able to get a report ? I set the msg.sender 0x123,why it not work hey! is there an alternative to vm.warp that instead of using UNIX ew use block? vm.roll try making the address full length.",445
1809,foundry-support.txt,"add 37 zeros ok still the old result This changes msg.sender for external txs, not for test contract vm.prank will make the next call from the address you specify it doesn't change msg.sender in the context of the test function OKay,I see.Thanks contract test_A { function foo() { vm.prank(0x123) A.bar() } } Contract A { function bar() { console.log(msg.sender) } } running this test will log 0x123 any idea why forge verify-contract keeps saying this even though I put the key? tried setting it as an env var as well as by using the --etherscan-apy-key or -e flags, to no avail Guys, can't see any storage section in debug mode, is it alive? No storage in debug mode. It's harder to implement the UI ig because slots keys are ""unbounded"" compared to stack & memory Any idea ? why remix has it? source .env How's it like? yeah it doesn't work even if I use env vars as I said I just need this stuff in foundry and life be better😄 How did you get this table ? https://github.com/naddison36/sol2uml/blob/master/examples/storage/usdcData.svg forge inspect --storage-layout pls give that a try and if not what u need lets work towards making it better Hi I want to test create2, re-deploy to to an address after selfdestruct. According to openzeppeling, it has to be two transaction: https://forum.openzeppelin.com/t/selfdestruct-and-redeploy-in-the-same-transaction-using-create2-fails/8797/4. Is there a way to do test it in Foundry? tks. Ive been searching in the fourdry doc for several hours cant find a solution Our CI fuzz tests have started taking a long time. Have there been any recent changes in the fuzzing algorithm in Foundry? Hey, there's a bug when using the createFork() with a transaction hash cheatcode.",418
1810,foundry-support.txt,"The timestamp of the block isn't set correctly, it seems to inherit the one from the block before not the current one Open an issue: https://github.com/foundry-rs/foundry/issues/new?assignees=&labels=T-bug&template=BUG-FORM.yml Whats “a long time” u have workflow file ? 4x increase, @mattsse identified the problem already https://github.com/foundry-rs/foundry/pull/4678 was a perf regression with larger fuzz tests, proper fix coming up Hey guys, probably offtopic but can someone give me a proper roadmap for learning rust? Not just blockchain oriented, the whole thing. Courses, videos... would be helpful too :) Id say wrong channel for that bud curious, why does run-latest.json expose a contractAddress with different capitalization than the forge script cli output denoted by ""Contract Address: <addr>""? assuming its something checksum related Hey all. Has anyone run into an issue with forge tests throwing an “Evm: NotActivated” error when you try to make view function calls to a proxy contract? I don’t seem to be encountering this with non-view functions and my workaround right now sucks. Is there any clean way to automatically hide all the sub-module repos in VSCode for a Foundry repo? For example, if I've installed a couple dependencies, I'll have 8 repos in the tab unless I manually hide them.",295
1811,foundry-support.txt,"Why i cant fork arbiscan?? etherscan team much jewish I get EvmError revert wu r u forking arbitrum or arbiscan lol What's different?😂 Lol😂😂 arbitrum is a blockchain network… arbiscan is just a product that indexes information about the arbitrum blockchain I have a contract on arbiscan.io and want fork that its on arbitrum, not on arbiscan aarbiscan just lets u see info on arbitrum And how can fork this? what do u want to do exactly fork the network? Yes Fork a contract in arbitrum network Do u want to fork arbitrum or redeploy an existing contract to arbitrum Fork https://book.getfoundry.sh/tutorials/forking-mainnet-with-cast-anvil I will use this but i get EvmError revert I will run forge test -vvvv --fork-url $FORK_URL How call contract whit cast use private key Cast call <contract-address> <function> <input> <private-key> <rpc-url> Is this true? cast call -h where is the implementation of vm contract? I only saw interfaces here: https://github.com/foundry-rs/forge-std/blob/master/src/Vm.sol Or I want to customize the newly cheatcode, is there any tutorial for reference? Cheatcode are done by intercepting calls to the cheatcode address by foundry in the interpreter. You can check how it's done in a readme There was one how to add cheatcodes, but don't remember where Hey all, does optimization enabled by default on test in foundry? I wrote a quick tutorial on how to get started with Foundry's code: https://dev.to/teddav/foundry-open-source-contribution-1k2d I also prepared a 2nd article on ""how to add a cheatcode"" but haven't published it yet. I'll try to finish it tomorrow if I have time and I'll post it here if you want @mattsse told me I should add it as a new section on Foundry's book but I was waiting to finish that 2nd article. I'll try to do it soon as it could prob be useful to a few people Hello everyone!!! I'm getting started with Anvil. When dumping/loading state, should it also load transaction and block hashes? It seems to load balances just fine, but it loses the txs and blocks generated.",501
1812,foundry-support.txt,"Thanks! Hello, I have a payable function in my contract. function deposit(address reciever) payeble returns (uint256) I have deployed my contract locally with anvil. I am trying to call this function with cast, but can’t make it work. This is the command I use: cast call --rpc-url=http://localhost:8545/ --private-key=$PRIVATE_KEY_USER 0x5FC8d32690cc91D4c39d9d3abcBD16989F875707 ""deposit(address)(uint256)"" 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 --value 100000000000000000000 And I am getting this error: (code: 3, message: execution reverted, data: Some(String(""0x""))) How should I debug it? Do I send eth when calling the function correctly (with —value argument)? Can i execute 2 million transactions in anvil without bugs? The easiest way to find out is to try that’s great. Thank you! you will be waiting awhile In ur settings json file ""git.detectSubmodules"": false answer is: use `cast rpc anvil_impersonateAccount 0x8894E0a0c962CB723c1976a4421c95949bE2D4E3` before calling a script Amazing, thank you!! Hey all, does optimization enabled by default on test in foundry? Gm everyone. I feel like this issue request is lost from track, it was closed then I prooved why it still should be opened but it never was.",342
1813,foundry-support.txt,"I really need this feature to be able to use forge fmt: https://github.com/foundry-rs/foundry/issues/4478 It's both a bug and feature request hi guys, I got this error when trying to use Foundry on Windows: Error: program not found Location: cli\src\cmd\forge\init.rs:183:18 I can run forge build, but forge init doesn't work smh you need to install git, or use WSL tyty, will try that https://github.com/foundry-rs/foundry#installing-on-windows Did something change for `Deployment`/scripts in the last couple of days? I did a foundryup and tests started failing ``` ├─ [0] SZNSDeploy::getConfig() [staticcall] │ └─ ← () └─ ← ""EvmError: Revert"" ``` my last working version is nightly-94777647f6ea5d34572a1b15c9b57e35b8c77b41 will keep you posted if I discover something Did you resolve the verification of libraries? On of our libraries still is unverified, and even verification with a direct command does not work. Unfortunately didn't get it to work, had to do it manually through etherscan can anyone help me about how to write a ERC721a smart contract? What a problem? https://github.com/search?q=erc721a%20foundry&type=repositories how to write a smart contract and deploy on erc721a wrong chat for that For coding assistance tutorials please try here https://www.reddit.com/r/ethdev/ Hello, how can I send ETH with cast from one test account to another? Been getting lots of EvmError: FatalExternalError errors in our fork tests lately. Any bug recently introduced in geth or other major Ethereum client? Are you using some crappy SaaS node provider? two different ""crappy"" SaaS node providers, yes.",407
1814,foundry-support.txt,"But they have been working mostly well for >6 months, today is the first time that all CI runs have failed in a row https://github.com/search?q=repo%3Afoundry-rs%2Ffoundry+fatalexternalerror&type=issues hmm Hey everyone! Thought this would be a good place to ask, does anyone have metrics on proportion of teams using upgradeable contracts, or prevalence of upgradeable contracts over time? i have a fuzzed test. can i pass it an argument inside another test? does foundry have any way of testing with raw ETH, not WETH? Yes, why not? Try to use deal cheatcode @pcaversaccio might have done an analysis on this recently comrade have you heard of securerpc.com how do i fix this? i tried both HTTPS and SSH urls for my submodules What's the dependency? And what's the exact command the dependency is forge-std. by exact command, what do you mean? I'm trying to run ""forge compile"" You may wanna configure your git with ssh in ur git config [credential] helper = osxkeychain [url ""https://github.com/""] insteadOf = git@github.com: [url ""https://""] insteadOf = git:// great, it's fixed. thanks for your help seems to be a problem, when RPC is bad/getting rate limited. occurs randomly, sometimes change of RPC is needed, sometimes just rerunning script is sufficient If the RPC fixes itself then our output should work We can't do much about badrpc ig Maybe improve the error but it's in revm and I'm not sure the code path that triggered it for you If you can open an issue with a repro we can investigate running into this weird vague error thread '<unknown>' has overflowed its stack fatal runtime error: stack overflow i think its bc im trying to fuzz on bytes ? any good resources or patterns for achieving that? Figured it out myself.",403
1815,foundry-support.txt,In case if some other noob will be searching for this 😅: cast send --rpc-url=http://127.0.0.1:8545/ --private-key=$PRIVATE_KEY 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 --value 100000000000000000000 --from 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 or can we? hey! i just published a quick article to get you started.,121
1816,foundry-support.txt,"Hope it will be helpful ! 😊 https://dev.to/teddav/foundry-add-a-cheatcode-5hc8 How do you upgrade forge-std seems forge update does nothing (empty), commenting the branch in .gitmodules doesn't solve it either might be useful for some of you who combine HH and Foundry with Slither Github Actions: https://vxtwitter.com/pcaversaccio/status/1643177160948035584 damn, that was always there? how come I missed it lol thanks for sharing the alpha well because it's not well documented, but now will be: https://github.com/crytic/crytic-compile/issues/414 Warning, spammers underway Does expectCall also look at `STATICCALL`s? How does evm_mine work? I send multi txs in mempool then evm_mine, but they are disordered.I expect them to perform in the order I submitted them Does anyone know of any reliable way to test smart contracts for Hedera without having to deploy them to the testnet? As long as it's EVM compatible foundry should be fine You might wanna have a look at the differences in the implementation of the EVM Yeah, but Hedera has custom precompiled contracts eg Token service The code that uses those precompiled contracts doesn't seem to work, not even when forking hedera mainnet Did you try to test in a forked environment? Yeah, still not working Which is weird because I thought when forking it uses the RPC for the precompiled contracts too But doesn't seem to be the case, it's like if precompiled contracts were treated locally Using this method: https://ethereum.stackexchange.com/questions/132323/transaction-gas-cost-in-foundry-forge-unit-tests I assume I need to add 21000 units of gas to the measruments? Hey trying to run the following command: forge script script/Foo.s.sol:Foo --rpc-url $RPC_URL -vvvvv --ledger --hd-paths ""m/44'/60'/$ACCOUNT_INDEX'/0/0"" --broadcast --sender $ADDRESS I'm getting: Error: No associated wallet for addresses: {0x0000000000000000000000000000000000000000}. Unlocked wallets: [$ADDRESS] Any thoughts on how to resolve? Has anyone had this error? Im just running a script that has multiple contract calls: contract1.call...",499
1817,foundry-support.txt,"contract1.call contract2.call that creates multiple txs The workaround is to manually execute 1 call per script run Is it possible to call expectEmit, but only for one specific variable? Is there something like afterAll or setDown for tests? Hi, is there any way to set the gas at any point of a forge script / test (and not setting it via the solidity {gas} parameter) ? Pinging on this, anyone know if console.log supported in Anvil? Quick question - I can't recall right now... but do the args in an event being tested w/ expectEmit need to be indexed (thus topics)? And if dealing with an event that has no indexed args, then one can only check that the checkdata matches? also if I want to extract an arg out of an event... is that possible? Aside from writing the solidity contracts differently so it returns the args or something. I'm wondering if there's ways to use foundry cheat codes or bash or something Trying to test-run a deployment script to be executed by a gnosis safe but keep getting ""Failed with EvmError: RejectCallerWithCode:"" since the address has code. Is there any way to ignore this so I can still output the dry-run logs? Where is good to find foundry jobs? Can anyone share a repo that uses foundry and rust? I want to have a monorepo with foundry (contracts, tests, deployments) + a cargo package with ethers.rs to interact with the deployed contract but not sure how to structure it a foundry project with ethers/wagmi.js would also be appreciated 🙂 Bumping this. I asked around in my circles and was pointed to this for parsing args and/or topics from event emissions.",355
1818,foundry-support.txt,"https://twitter.com/d1ll0nk/status/1639965090769256453?s=20 Yeah, you want to use recordLogs and then decode them @gakonst I'm assuming recordLogs is relatively new? you guys push updates at such an impressive pace - is there some sort of change log? Would love to try and hook that up to a twitter bot to automatically tweet about improvements and/or new features https://book.getfoundry.sh/cheatcodes/record-logs?highlight=recordlogs#recordlogs it’s been there for a while! there’s a nightly changelog on github thank you so much! Will dig into it more sweet Found it: https://github.com/foundry-rs/foundry-rust-template/tree/master Foundry +100 has anyone else noticed compiler issues w submodules when using absolute paths? i really prefer them but the compiler can't seem to handle them very well in some cases how to use MAC keystore when run forger cmd? are you on macOS? solc creates virtual file system Literally the Go Ethereum geth Folks. If the files don't appear in the coverage report, even with 0% branch, does it mean that they weren't tested? Is it possible to use unchecked blocks in chisel currently? ofc I. set the block number,why the balance is not correct yes fortunately nothing i haven't been able to work around yet w some ~finagling -- just annoying it sometimes gets confused by topline import / re-exports yea it should be supported This worked great is it possible to convert an int256 hex value to a negative decimal value with chisel? It can convert it to decimal as a uint256, but not an int256? is there an issue w saving complex / nested dynamic objects to storage? trying to do it for a test & getting UnimplementedFeatureError: Copying of type struct DiversifierFactory.Recipient memory[] memory to storage not yet supported. am trying to find a workaround w/o much luck yet (short of just saving all the building blocks to storage & re-creating in a fn for each test) It's a solidity error because the literaloverflows the type, you have to do int256(uint256(0xFFF...)) same reason as why you can't do uint8(256) Hey folks - looking for some insight.",485
1819,foundry-support.txt,"I noticed that the rustls_native_certs feature is in the cli cargo.toml file for foundry cli but not for cast, anvil, or binder. Is that intentional because it's meant to cascade down the other tools? error[4649]: TypeError: Invalid type for argument in modifier invocation. Invalid implicit conversion from contract ISplitMain to contract ISplitMain requested. -- any tips/tricks for handling these? keep running into them w the full imports even though both places are pulling from the same full import I tried to make a cast call and it gave me a peculiar response due to the rpc url not accepting the cert I have set to it. I also have ssl_cert_file pointing to the cert in question i'm seeing a drastic difference in contract size for the same # of runs (1000) in foundry vs hardhat. are there any tips on why this is, any flags i should be passing in? fyi, i'm using 0.7.6 solc hardhat vs foundry Are you using via ir? any reason why `console.log`s wouldn’t show even with -vv ? https://github.com/foundry-rs/foundry/issues/3843 probably this? just saw this. Thanks Matt! no unfortunately because of modifiers? Oh weird what Hi When i run an script get this error: │ │ │ └─ ← ""EvmError: OutOfGas"" │ │ └─ ← ""EvmError: Revert"" Test result: FAILED. 0 passed; 1 failed; finished in 2.79s Failing tests: Encountered 1 failing test in test/TestScript.t.sol:TestScript [FAIL. Reason: EvmError: Revert] testCall() (gas: 9223372036854754743) I search in google but dont see any results. How can i fix it? i want to use a random number during setUp like the fuzz test does, but I have no idea how to pass a random number into setUp you could use ffi maybe Thanks! I just read the docs about invariant test. running the bounded test should get 0 revert, If I get reverts under bounded case, then i should modify the bound range right? I get such an error in tests after calling a contract that is deployed from raw bytecode.",477
1820,foundry-support.txt,"Does anyone have any idea why this happens and how to fix it Probably non-existent method call Or whatever, screen is lack of information The method definitely exists, apparently the transaction completes normally and an error appears immediately after completion What other information should I provide? Is there anybody who worked on aave v1 contracts? hey i was reading our foundry book about differential fuzz testing and have one minor question : // Build ffi command string runJsInputs[0] = 'npm'; runJsInputs[1] = '--prefix'; runJsInputs[2] = 'differential_testing/scripts/'; runJsInputs[3] = '--silent'; runJsInputs[4] = 'run'; runJsInputs[5] = 'generate-root-cli'; runJsInputs[6] = leaves.length.toString(); runJsInputs[7] = packed.toHexString(); how does these command string come from ? since i was confused by its use cases . I was thinking about whether i could make use of this cheatcode to read some ts files and use them to perform some utilities . source : https://book.getfoundry.sh/forge/differential-ffi-testing having a very hard time installing dependencies, specifically OZ's upgradeable lib have tried: - forge install @openzeppelin/contracts-upgradeable - forge install Openzeppelin-contracts-upgradeable and a variety of others also, it seems i have to commit all changes to git before being able to install any package? You need to do remappings.txt e.g. https://github.com/tradingstrategy-ai/web3-ethereum-defi/blob/master/contracts/in-house/remappings.txt Also you can simply do manual git clone or git submodule add - no need to use forge install Not supported in 0.7 Forge needs it for git Makes sense. Is it possible to enable it for the other tools? hows ur setup r u trying to use a custom ssl cert? or u trying to mitm ? Yeah, I have a corporate cert on my machine and ssl_cert_file is pointing to it already.",417
1821,foundry-support.txt,"When I run cast the rpc endpoint doesn't invoke the rustls_native_cert feature and then just times out or gives me a cert error hi! curious why console.log with forge-std/console.sol doesn’t print to terminal when being called from a Test contract although it works when being called from a Script contract? is this expected behavior @sambacha have you had any verification issues using absolute imports ? having some now that disappear when we switch to relative probably the straw that breaks the camels back for me love the absolutes but verification is annoying enough as is https://book.getfoundry.sh/forge/tests?highlight=verbosity#logs-and-traces how are you writing the absolute import? you may have to define SSL_CERT_FILE env value and compile from source What OS? import {X} from ""src/X.sol""; is there.. another way? MacOS 12.6.2 yah, we're in that stage right now but still getting the ssl cert error Is there any easy way to save all deployed contract addresses to a file on running a deploy script, ideally grouped by network? How can I use Foundry to obtain the current block value of cheatcode How to obtain the detailed cause of failure how to resolve this error? Does Foundry have a cheat code similar to hardhat for manipulating time https://book.getfoundry.sh/cheatcodes/warp thank you When I fork to a certain block, I want the time to advance by 1 day. Foundry seems to be able to only change the timestamp through wrapping, but when block.timestamp changes, block.num does not change Is there any way to increase time while simultaneously changing block.timestamp and block.number https://book.getfoundry.sh/cheatcodes/roll Roll only changes block.number, but block.timestamp does not change I want block.timestamp and block.number to change together over time there's warp for setting the timestamp but looks like a cheat code that does timestampt += duration would also be useful. feel free to open an issue for this, adding this would be trivial Hey guys ... I am new to foundry and when i am running forge install openZeppelin/openzeppelin-contracts It throws me a this error The target directory is part of or on its own an already initialized got repository, and it requires clean working and staging areas.",470
1822,foundry-support.txt,"Including no untracked files Can someone help me with this u need to make sure there aren’t uncommited/unstashed changes in git i believe (no untracked files) forge install is just git clone or git submodule add - you can get the same effect by simply using git to clone projects under lib I'm having error on ubuntu. I fixed the ""cannot install provided Shell, a shell has already been installed"" error by running foundryup -C 31f945 Something is wrong in the nightly build nightly-5c2db0babf02e1f1016b1471de3b21593cb06b56 Please who can help? Can you please open an issue with the cli output/error? Hey guys trying to deploy a big contract with around 30 txs on testnet I get this error 2 times Error: (code: -32000, message: future transaction tries to replace pending, data: None) Any idea why ? Nonce? It send some tx but not the whole package Can it be because the rpc endpoint is not fast enough ? Hey, has anyone got any issue with context variables while doing invariant tests ? I'm facing an issue where some calls in the sequence have a timestamp that depends on the value set via vm.warp, and some are not seeing the same value (so it looks like we go back in time in the sequence) --no-commit option will work for you also happening with state values not having the value ser in the call right before, feels like a race condition in the way the calls are running but it's consistent (always getting the error when running the same seed again) trying to use cheatcodes in my test contracts, i imported forge-std/Test.sol and forge-std/Vm.sol. compiler doesn’t recognize vm in ‘vm.prank()’ and wants me to use ‘Vm’ with a capital ‘V’ but thats an interface so also causes on err. any suggestions? It's easier if you start from a template, e.g.",413
1823,foundry-support.txt,"forge init your-project Or you could use my template: https://github.com/PaulRBerg/foundry-template oh if ur on macOS you need to add it via Keychain ngl foundryup is pretty fucked Is there a way to console.log the label of an address instead of its actual value ? lol Im having this issue for a long time too if you look in the trace it will show the console.log statement with the label, however this is not currently supported in the logs section a vm.getLabel cheat would be useful to allow this though, if you want to open an issue Yeah I know but sometimes it's annoying because I have a lot of tests and I'm forced to make them revert even tho it's working fine (-vvvvv would display a huge setup) + I have to isolate the test I'm looking for with —mp and —mt. So yes, I'm filling this issue soon ! awesome! if you wanted to PR this yourself, it should be easy—you can see where the label is set here (https://github.com/foundry-rs/foundry/blob/e0b57365e43cca68755ff4584c6bebe79027e633/evm/src/executor/inspector/cheatcodes/util.rs#L150-L153), so this PR would read from that variable instead I honestly would love to, this way I can learn more about foundry and rust. I'll try to do it the next week but no promises on the ETA ahah love it 🔥 if you get stuck, feel free to open a draft PR and ask any questions there 🙂 Does forge really have to recompile everything each time you make a small modification? Feels like there should be a setting to only recompile modified files As far as I know forge build only recompiles modified files by default [⠑] Compiling... No files changed, compilation skipped Maybe try here https://xyproblem.info/ Forge test automatically rebuilds everything There is no option to only build edited files in forge test.",417
1824,foundry-support.txt,"My attempted solution is a flag for forge test that would only build edited files, but I couldn’t find it forge caches things and only re-builds the required files based on what changed, but if you change a file deep in the dependency graph then it has to rebuild a lot of contracts It recompiles all contracts every time after ""forge test"" hm it shouldn’t, can you open an issue with steps to reproduce? Steps to reproduce: “forge test”, “forge test” I’ll open up an issue 🙂 I am not able to repro: - cloned forge-std, run forge test, compiles 35 files - make no changes, run forge test, compiles 0 files - add comment to StdAssertions.t.sol, run forge test, compiles 1 file make sure you're on the latest forge version too I've been executing local code with robust logging against remote storage state with scripts using vm.etch, but is there a way I can do the same for a transaction replay? Best I can think of for that is to perform the same call as is in the transaction but at the immediately prior block to the transaction Would be great if I could just do the call in the transaction itself if there were a flag like --label that could be passed to cast run that replaced the bytecode of an address in the transaction with local contract bytecode, that would be great --contract 0x40950267d12e979ad42974be5ac9a7e452f9505e:MyContract replace bytecode at 0x40950267d12e979ad42974be5ac9a7e452f9505e with my local bytecode wait, you're saying that ssl_cert_file should point to the cert straight from the keychain's directory? Is there an answer to this question? That’s configurable via query params for most providers. If yours doesn’t support this config, try another Could someone describe how I can initialize a struct within a foundry test forge remappings appear to be global across repos rather than self-contained, which leads to a bunch of cruft on etherscan verification because unrelated remappings from other projects get included into the settings metadata.",445
1825,foundry-support.txt,"any way to clean this up & enforce self-containment? Not using remappings? Are you talking about this one, right? https://github.com/foundry-rs/foundry/issues/1855 Ah I might be wrong, there was a library that I thought was unrelated but it turned out to be from a nested dependency Hey, is it possible to pass the state from a deployed token to an etched token address? I'm deploying the token via the getCode approach recommended in the docs:   bytes memory args = abi.encode(_tokenDeployer);   bytes memory bytecode = abi.encodePacked(vm.getCode(""TestToken.sol:TestToken""), args);   address deployAddress;   assembly {    deployAddress := create(0, add(bytecode, 0x20), mload(bytecode))   }   vm.etch(targetAddress, deployAddress.code); However, when I then call stateful methods like totalSupply() on IERC20(targetAddress) the returned values are incorrect, seemingly due to incomplete state etching I need to be able to access the token at a given address hardcoded in a smart contract, and I'd prefer not to use forking (which is our current approach, but which adds too much time to the tests) how to specify which network to deploy to with forge create? I tried flag --chain-id 5 to deploy to goerli, but it deployed mn Switch via the —rpc-url flag Different RPC endpoints for different chains I am getting a lot of error while trying to deploy Such as (code: -32000, message: transaction would cause overdraft, data: None) (code: -32000, message: future transaction tries to replace pending, data: None) (code: -32000, message: replacement transaction underpriced, data: None) Any idea how to optimize my deployment to make it a smooth process ? I'm running into issues running fork tests in github actions. I have my rpc url loaded into github secrets and (I think) I'm loading it correctly into my workflow, but I'm getting an ERROR forge::runner: setUp failed reason=""invalid rpc url *** error when the workflow runs.",443
1826,foundry-support.txt,"my github workflow yaml has the following: env: ETHEREUM_RPC: ${{ secrets.ETHEREUM_RPC }} and this is the relevant line in my tests fork = vm.createFork(vm.envString(""ETHEREUM_RPC""), my_block_number); The fork tests work just fine when running forge test locally. Is there something I'm missing? Can i get deal cheatcode source code? How this cheatcode find mapping slot to give erc20 tokens? is there a way w forge cheatcodes to predict the next address that will be created by a contract? nm figured it out w vm.getNonce is there a better way to check that a call _didn't happen_ other than using testFail & expectCall ? (know testFail is an ~anti pattern generally) good Q - dont think we have expectNoCall? KEVM implements account and storage slot whitelists for verifying no access to resources you shouldn't. Where can I find an implementation of cheat codes? KEVM's whitelist cheatcodes: https://github.com/runtimeverification/evm-semantics/blob/master/include/kframework/foundry.md#restricting-the-accounts-that-can-be-called-in-kevm cheatcodes in general: https://github.com/runtimeverification/evm-semantics/blob/master/include/kframework/foundry.md Not sure where Foundry's are, or HEVMs. Hey, I was playing with Anvil trying to replicate a race condition, but ran into an issue and at this point i'm not sure if i'm missing something or if this is an unexpected Anvil behavior (contract's state is altered while the state-altering tx is still pending in the txpool).",340
1827,foundry-support.txt,"Here is a gist showing the process on a simple contract: https://gist.github.com/NaviNavu/6e56dac7518bc6120e57a5c0518f74a2 Is this a normal Anvil behavior? Thanks! Hey everyone, I’ve been working on a fork of anvil that connects to a db and simulates historical mempool activity using historical mempool data and I have been encountering problems when it comes to mining blocks on schedule I have an async task that calls api.mine_one().await; And I think it might simply be an issue with the shitty computer I have been running this on, so I wanted to know how intensive the mine task is? I am not getting any errors and all the tx are being sent correctly so it doesn’t seem to be a problem with that, would appreciate any kind of help. Thanks in advance! For reference ^ When can i see cheatcodes source? Try putting it in an env and running source .env, forge test —fork-url $rpcVar anyone has had this bug: Context: - Ledger device: APDU Response error `Code 6985 ([APDU_CODE_CONDITIONS_NOT_SATISFIED] Conditions of use not satisfied)` When trying to run a forge script using ledger? guys, how do I track the transaction cost after call contract.function() in a test? it works locally, but not in ci / github actions. I managed to get the runner to recongize the env var, but now it throws the following error: Could not instantiate forked environment with fork url. Again, this doesn't happen when I run tests locally in the cli with the same config. Has anyone gotten Foundry to work with the new zkSync? I am getting strange evmerror reverts on basic calls like transfer? 😮‍💨 Deploying contract to mubai polygon and foundey gets stuck at waiting for receipts Is there somethin nt am doing wrong or does this mean testnet is down Now its giving me replacement tx underpriced..",419
1828,foundry-support.txt,"not sure if i need to set custom gas price not sure how is it possible to deploy from foundry while pushing the deployment sign to my ledger? I have tried interacting with views of other contracts Is it Foundry that needs to take action in this case or the zksync team? Zksync is very hot right now and only hardhat works Hey everyone, is it okay to ask Solidity questions here? If not, any recommendations of online communities that can be joined for that? hey is it there any cheatcode that mines an empty block? let's say i fork mainnet in block 100 and i would like to roll to block 101 but without having the txs of block 101 replayed, is there a way to do that? vm.roll no? Generally try to avoid easy solidity q's, but fire away this time. Gpt4 is pretty good at solidity fwiw Ha, thanks. I'm wondering: is Foundry doing anything different when it comes to compilation and a contract's creationCode, or is this entirely `solc`'s doing? Reason I'm asking is that, I have a contract function that returns the creationCode of another contract. And that bytecode I get from that function looks different when called via Remix vs via foundry/cast Namely, the byte code I see returned in remix starts with the typical 0x608060 while the one in my local deployment using foundry seems to have 2 bytewords coming before the 608060 code. Hello. I have a problem with installation of foundry. It seems to me, that forge-std hasn't been installed. An error appears after forge build: error[6275]: ParserError: Source ""forge-std/Test.sol"" not found: File not found. Searched the following locations: ""/home/vaskonst/Projects/FoundrySol/kruk"". May be it is an installation bug because the expected results are following: creation of the folder ""forge-std"" with ""Test.sol"" and other necessary files inside my project.",424
1829,foundry-support.txt,"Operation system - Ubuntu Do you have your remappings configured correctly? forge-std/=lib/forge-std/src/ It is written in my remapping.txt Due to remappings, the files have to live in lib/forge-std/src/, not actually in forge-sdt/* So if you created that Test.sol file, you need to move it to lib/forge-std/src/ for it to be picked up correctly Remappings ensure you can use a different import path/alias There is no Test.sol file. It hasn't been created at all during the installation So do I need to download forge-std manually from github repository? lol nevermind. It's of course the ABI encoded offset + length byte words. Seems like remix removes those in the UI automatically. I'm sorry, I misunderstood your message then.. Does the lib/forge-std/src folder exist? And if yes, is there a Test.sol file in there? No, the folder lib is empty because nothing has been installed there Yes, indeed. Then installation went wrong. Did you use foundryup to install foundry? And how did you initialize your project? I've run the command foundryup and then I've run ""forge init kruk"" I think the problem may be with creation of new github repository So I downloaded manually forge-std, using git clone. And I got another error: Compiler run failed error[6275]: ParserError: Source ""ds-test/test.sol"" not found: File not found. Searched the following locations: ""/home/vaskonst/Projects/FoundrySol/kruk"" I'd try re-initliazing a project usign forge init your_folder and then see if there's any errors in that process, because that's where stuff seems to fail for you I also manually downloaded ds-test and put it into the correspondent folder. And only after that everything worked for me Yea, so it really seems like installation of forge-std went sideways during forge init So I'd run that one again and see if you can reproduce that issue.",420
1830,foundry-support.txt,"Im saying you need to import it via Keychain GUI first you should be able to do so in shell I’m trying to install this forge install superfluid-finance/ethereum-contracts@ethereum-contracts@1.5.2 But I get the following error repo URL: 'ethereum-contracts' must be absolute or begin with ./|../ I guess the problem is the second @ in forge install. How do I escape it? Hi, on the topic of zksync, has anyone found a working solution ? Hi, how can I send raw eth from eoa1 to eoa2 in tests? Without deal cheatcodes..? call call will be implemented in this case at test SC, so msg.sender of tx will SCtest, right? Don't need it so =( I assume there is another way (call). just sign message and broadcast it, but hz kak eto sdelat foundry Change msg.sender with prank cheatcode but eth will be send from testAddress, as i know but I need to send from eoa address No, this call will be made from eoa to eoa2 With eoa as msg.sender Is there an easy way to get the length of a contract's bytecode in forge? I know I can do address(contract).code ofc or write a script using ethers.js or another library, but I'd like to know the size before I deploy my contract to mainnet so that i can compare it. ty!! It should live somewhere in the out folder after doing forge build forge install GITHUB_USER/REPO_NAME should do it I checked the artifact but didn't see anything. Is there a way to deploy contracts locally and send information about the address and the ABI to an API? is deploying contracts to aurora using foundry a known issue ? i keep getting this error ```(code: -32602, message: nonce is too small, data: None)``` previously i was getting a eip1559 error which i resolved by using the legacy flag in forge script. if you're doing more than one transaction, you could try using --slow flag to make sure the transactions were not dropped anywhere.",439
1831,foundry-support.txt,"This helps with the complex scripts on more exotic chains aha yes in my script i deploy the contract and in the next line i call initialize so two transactions This worked like a charm , ty not sure why I’m getting this error with foundry, anyone know why? what did you try to do? function setUp() external {   vm.createSelectFork(""goerli"", 8591866);   nft = new GoldNFT();  } below is the failing test docs and i also tested the setUp with https://goerli.infura.io url, i never ran foundry on forks or actual chains so wanting to learn that Failing tests: Encountered 1 failing test in test/GoldNFT.t.sol:Hack [FAIL. Reason: Setup failed: invalid rpc url goerli] setUp() (gas: 0) sounds like you have a bad RPC URL, if using infura you need an API key and can get the full URL from your infura dashboard solved it pasted an public rpc from chainlist can you expand on what you need? not sure I follow why those solutions are insufficient (another approach is just count the characters in the deployedBytecode.object field of the artifact) I was simulating a test using the function setUp() public { cheats.createSelectFork(""mainnet"", 17018036); } The cert is first installed in the keychain then we create a hidden directory that's a symlink to it vm.createSelectFork(""https://rpc.ankr.com/eth_goerli"", 8591866); should be like this i guess Has anyone run into issues when broadcasting multiple transactions and receiving (code: -32000, message: future transaction tries to replace pending, data: None) The script is very simple, it just loops through and distributes tokens to 4 addresses for (uint256 i = 0; i < 4; ++i) {    token.batchMint(distributionAddresses[i], 26);   } yeah had the same problem, workaround was running 1 transaction at a time :/ 😭 Does this happen reliably? This should work usually Which chain are you sending it? Yes, I've had it happen a number of times for me and another coworker.",463
1832,foundry-support.txt,"This is on goerli Can you please open an issue with a repro? is there a reason why vm.getCode looks in artifacts/contractName/contractName.json instead of artifacts/contractName.sol/contractName.json as generated by forge build i am getting a no such file or directory error Had this once. Adding --slow fixed it though Yes, I've experienced the same I could only send one tx per script Goerli as well Hopefully the —slow helps Wow it was difference in measurement units KiB vs KB…. That’s so sinister 🫠 Let us know if it works! Any way to run testcases in bitbucket pipeline? How can I scroll the stack as shown by the debugger Shift + J/K it's written at the bottom anyone know how to fix this...a big blocker for me currently Anyone have any clue how to debug when an event emission is not being registered, eg. using Ethers, when using a local RPC endpoint that points to anvil? Sometimes my server picks up the event, and sometimes not, there's no consistency I had some success setting --block-time 2 , but now the inconsistency is back is solidity scripting the right way to be interacting with contracts on testnet? if so, whats the best way to halt transactions until previous transaction has finished mining? Was discussed today :) https://t.me/foundry_support/35282 thanks, just saw it in the docs as well. are there more complex forge scripts, the examples in the docs are sparse use # Any idea how to use legacy tx i.",315
1833,foundry-support.txt,"Ethers rs programmatically ? How do I get past this error when running foundry using the docker image? /bin/sh: -c requires an argument It seems to have worked outside of a loop - not sure if making the calls within a loop will function differently I'm not in a loop, just a plain script contract that performs multiple calls 😔 Can I tell the debugger that a certain address is a certain contract? I want to run a transaction and see what is happening at a particular point in my source code The other way's I've figured out to do this aren't quite working this time There's an out of gas error that's present in the transaction I'm trying to debug, but if I copy the calldata that was sent to it, and invoke that in a forked script state, then I don't get this out of gas error Can I run cast run --debug tx and have it know that so and so address is using my source code? Ah I've reproduced it my old way... forgot forge likely uses a ton of gas as a default, just needed to constrain it But it would be great to be able to tell it that the source for an address is from one particular contract in my repo, less hoops forge deploy contract: will fail: above the EIP-170 contract size limit (33611 > 24576). EIP-170 is obsolete And I can't solve it by specifying --code-size-limit ""90000000000"" Does anyone know what to do? thank you Any way to pass cli args to forge script? Guys I know I've asked this question multiple times on this group but I'm quite sure there's something wrong with the watcher mode. Sometimes it triggers the recompilation of only the necessary files and sometimes (especially when I keep changing things during the recompilation) it just recompiles everything. My project has 200+ contracts. I can't lose one minute every time I want to test something. Yes, I'm only editing leaves of the AST, but I can't tell exactly what triggers the whole recompilation. I can even share a screen record (in private) if you want to see this thing happening.",445
1834,foundry-support.txt,"Is there any way to extract function all the function signatures from a solidity file? using foundry If you're fluent in bash you can definitely filter all the lines that start with function and extract the signature using cast gm guys, I'm deploying to gnosis, no custom settings... but apparently it did a very bad estimate for fees and it's been on the mempool for 20hs, when I try to redeploy it says AlreadyKnown. How to fix it? And what's a good setting to avoid having this issues in the future? Thanks a bit hacky but works: use forge up --all to upload all the selector to https://sig.eth.samczsun.com, it will console log them too;) forge inspect CONTRACT methods where CONTRACT is the contract you want to get the signatures of. Unfortunately this doesn't work for multiple contracts for a given file. You have to specify the contract. https://github.com/supernovahs/SignatureCollider Used forge inspect for this Hey, anyone else encountered that and has a solution? It was a mistake on my end but I forgot what it was Also, how did you find a 3 months old message? That’s impressive tried to find if someone mentioned an empty log before asking :) I am trying to simulate a transaction on polygon but getting the same as you described .... I can go through my commit messages and might be able to remember I’ll let you know wow really appreciate it 🙏 I can’t find the reason, but as far as I remember it was a mistake on my end and not an anvil bug Make sure you mine a block first and wait for the response etc. If all that is clear it might be something else than what I was experiencing mine a block first? so basically fork one block before and then execute the tx? You have to make sure that the tx was included So you either send an evm_mine or you enable auto mine OK, i'll check those. thanks for letting me know. auto mine is not the default btw? I think it is but it behaves weird. It takes a few moments until it mines So you cannot assume that after sendRawTransaction you can immediately do an eth_getLogs I use --no-mining and then manually call evm_mine It’s more predictable OK, will give it a try.",470
1835,foundry-support.txt,"thanks @koraykoska Has anyone had any problems with Anvil and RPC calls that return an array of structs? I have an array of structs and the first element of the array is correct but every element after that gets corrupted. Almost like a off by one error in the deserialization process after the first element. I was fetching the data via wagmi with Anvil as my chain. I first noticed it on the frontend that I had weird values. First element would have nice values like ""0, 10, 0, 50"" and second element would be like ""gigabajillion, 320381728402, 301e40 etc"". When I make the call via Cast, Cast returns an error saying the data is corrupt. I'm having issues verifying a contract on gnosis, I'm getting - data did not match any variant of untagged enum ResponseData have anyone experience this? Newly deploying contract, no constructor args Hey, we're trying to get block time to advance by a fair amount using an anvil forked mainnet. But it's not working as expected. Or it won't actually advance You also need to mine a block Mine block works for a few hours not for a week or two Is there a way to advance block for several days or weeks like if we could vm.warp(now + 604800), but as a cli command... I am seeing a lot of Text file busy (os error 26) when running forge build in CI (Github actions), any way I can debug what exactly is the source of this? CI is using foundry nightly via foundry-rs/foundry-toolchain@v1 Hi everyone I'm trying to follow this part of the doc but it seems I'm doing something wrong.... what is the right way to do this ? I want to call an external function with a specific payload and check what happens here If there any libs or tools I can use in my script runtime to convert a uint256 to a hex string for the purposes of console2.log? We have ❤️ed using Forge to develop the GoGoPool protocol, and wanted to share our repo here for ideas and inspiration. In particular we wrote our deploy scripts in Forge Script, and save off deployed addrs to a JSON file. Works great! Thank you for such great tooling.",475
1836,foundry-support.txt,"This works ! maybe shows and example in the doc will avoid ppl like me being stuck Oh, but that's not the doc showed, they told ""0x...."" for the param and it doesn't work I've opened issues about all this stuff Yep you do need to do that You only need the 4 byte signature not all the calldata Which ones? https://github.com/foundry-rs/foundry/issues/4722 https://github.com/foundry-rs/foundry/issues/4721 Facing a weird issue. It says out of gas, even though can’t see it in trace. What the reason might be? Yeah but how can I pass my whole calldata to the function ? Foundry Support With spaces It might be a jump that'snot captured in the trace Umm, Okay. ' sometimes it can be convenient (from my very junior pov...) to juste paste the raw calldata I need, and in this case the behaviour isn't clear. See my issues :) Open to supporting it, will do well it's already supported, there's just some glitches Could someone help me debug an issue Im having in tests. I build foundry from source and can do some debugging but have no idea how to interpret this stack trace export RUST_BACKTRACE=full && export RUST_BACKTRACE=1 && forge test -w -vvv --mc TestFrxEthEthCurveLpDualOracle --mt testGetPrices [⠃] Compiling... No files changed, compilation skipped The application panicked (crashed). Message: called `Result::unwrap()` on an `Err` value: ParseOverflow Location: evm/src/decode.rs:50 This is a bug.",348
1837,foundry-support.txt,"This is a bug, can you please open an issue? Yeh, and not sure it’s recommended / maintained Doesn't appear to be, plenty of TODOs left in the code. @gakonst any specific reason to not use Foundry for upgradeable contracts? Or its just not a focus/concern of the tooling? How can I install a specific commit/tag of a github repo? forge install -h I am wondering if this is related to our CI running multiple forge commands in parallel and forge having a hard time with some global cache or something you can also use git clone and git submodule add directly, no need to use forge install what is recommended? Any idea on how to debug this? I have a test case that is making foundry crash, I don't know if it's a foundry problem, a contract's code problem or what Unfortunately can't share the full code as this has been during an audit and contains client's code which I can't share, so any hint on how to debug or create a minimal poc for this? Hi there - doing a forge snapshot --tolerance 5 --check on github action, after forge build and I have this strange error cache/solidity-files-cache.json"": Permission denied (os error 13) -> seems like the cache file is not readable by github ? It was working fine before i updated (with versions from 2-3months ago) and locally it's readable from everyone. Anyone has seen this before ? 🙏 this is a github workspace permissions issue you have a repo for more info? typically its set by: git config --global --add safe.directory /github/workspace This sounds like a ulimit problem Yeah ulimit is usually the case but this shouldnt be happenign really sysctl -a | grep fs.file-max they may have concurrent jobs running Just to update: we found out it was Slither changing the permission to root so the forge command didn't work after, so we put slither last and it worked.",409
1838,foundry-support.txt,"has anyone built a forge doc gh action to serve to pages yet? Did you find a resolution? having the same issue as in foundry should be resilient to whatever the current ulimit is? you could run the test with RUST_LOG=trace forge test which should give a ton of logs that might help also would love this, if you find it lmk! maybe @PaulRBerg has seen this? +1, the deployment + upgrade itself is trivial, its more the checks that hardhat provide that’d be nice to replicate. i did not but scripts seem to work better than create so maybe try that direction Hi following up on this: would be great to be able to test the resistance of my contract to eth transfers and the like. Not sure if invariant testing will randomise properties like msg.value I have a test requirement for this, and this test has a 1/10 probability of success under different blocknumbers. I hope that if the vm reverts, increase the blocknumber and retest until the vm executes successfully. here is src code: https://github.com/WTFAcademy/WTF-CTF/blob/main/src/Capture_the_Ether/Lotteries/Predict_the_future/PredictTheFutureChallenge.t.sol#L19-L46 Is there any way to implement this loop Is there a way to make Anvil log the full JSON_RPC requests it’s receiving? I am trying to debug eth_getLogs.",292
1839,foundry-support.txt,"Thank you Usually it is easier to log in your HTTP client when it makes the POST Does anyone know why this is failing with Out-of-gas? Is this a foundry or EVM thing? function testSig(bytes32 hash, uint8 v, uint256 r, uint256 s) public view {  uint256 rds;   require(gasleft() > 0xaaaaaaaaaaaaaaa, ""Too little gas"");   assembly {    mstore(0x00, hash)   mstore(0x20, v)    mstore(0x40, r)   mstore(0x60, s)    pop(staticcall(gas(), 1, 0, 0x80, 0x20, 0x20))    rds := returndatasize()  }   require(gasleft() > 0xaaaaaaaaaaaaaaa, ""Too little gas"");  require(rds == 0x20, ""Returndatasize not 32 bytes"");  } What foundry template on github would you guys recommend for a quick start but robust one other than https://github.com/PaulRBerg/foundry-template? Is there any reason why trying to submit verification for Optimism or Arbitrum would fail? I keep getting a wall of text then an error saying it couldn't submit verification payload.",280
1840,foundry-support.txt,"we have one here, I'm biased but I think it's pretty good https://github.com/ScopeLift/foundry-template/ Good one indeed, may I ask for one feature request which is to add scripts to support util functions like createTestUsers hmm feel free to open an issue and we can discuss there, don't want to clog this chat, and forge-std does have a makeAddr method so I'm hesistant to add too much boilerplate that may not always be used one workaround that often works is flattening the contracts with forge flatten then verifying manually in the UI, unfortunately verification is a bit flaky and there is much more to do on the foundry side to improve it Sure my forge test doesn’t see my libraries if i have libraries=[] on the foundry.toml that doesn’t correspond to the right addresses on the local chain — is ther a way to specify the libraries change addresses on local tests vs the actual chain? (resolved, rewrote without libraries and using forge deploy script) i get invalid opcode having sent a tx from rust to anvil local chain, but it doesn’t show the error in the anvil console — is there any way i can view this? (resolved) Hi guys, I'm new to Foundry but I tried to find a solution to my problem without success.",270
1841,foundry-support.txt,"Instead of running ""forge test --root contracts"" I would like to specify root folder inside foundry.toml but I can't get it working even if I add root = ""contracts/"" in profile.default Im getting file not founderrors Why your contracts are contained in ""contracts"" ? are you using hardhat ? If yes I recommend to use this for having a seamless experience for both tools :) https://hardhat.org/hardhat-runner/docs/advanced/hardhat-and-foundry (otherwise you could always check after installing this how they modify the toml file to redirect it to contracts :) ) I'm not, the folder could be renamed anything else just forge init contracts, but it is part of a bigger project im making thats why i prefer to keep config file on the root of my project not root of contracts can you share a screen of your repo structure ? sure and something like ../contracts doesnt work ? usually this kind of file (the toml file) should be at the root of the project I'm not sure how this behave in this kind of configuration toml file is at the root of my project just not at the root of the forge project only root = ""contracts/"" gives me sth else than ""nothing to compile"" but then I get error[6275]: ParserError: Source ""forge-std/Test.sol"" not found: File not found. Searched the following locations: ""/Users/xxx/Documents/xxx/naas/contracts"". --> test/Counter.t.sol:4:1: | 4 | import ""forge-std/Test.sol""; ...: hey guys someone can help with my code ? Gas estimation errored with the following message (see below). The transaction execution will likely fail.",350
1842,foundry-support.txt,"Do you want to force sending? Returned error: {""jsonrpc"":""2.0"",""error"":""execution reverted: not sender"",""id"":1165684526518525} i got this error in remix IDE I used the UniswapV2FlashSwap.sol contract as an example, but I changed it to BSC and put an arbitration I don't know how to solve this is it linked to Foundry because it looks like you shouldn't ask here Oh sorry, I didn't know if anyone knows how to solve that, I also tried running forge remappings I don't know what the code is, but it depends on what it is, try to put it in a single folder and change the name from the main file, like, the file that is not the test one, but is being imported into the test file and click on compile for the remix to update so keep this parameters. once problem at a time :) did you read the remapping section of the doc ? where are your libs in this architecture ? its the select folder inside contracts/lib after rereading I didnt try >remappings.txt arf... Sory for my stupid messages so in the remapping section try something like this : ds-test/=contracts/lib/forge-std/lib/ds-test/src/ > remappings.txt fixed it I thought just running forge remappings was creating the remappings file Thanks a lot Fabien Exactly! ds-test/=lib/forge-std/lib/ds-test/src/ forge-std/=lib/forge-std/src/ A question... Since one of the recent foundryup's i've ran recently, the testing process is running quite slow without fuzzing or anything. It normally was requirig aobut 10-30 seconds to run, but lately it has been up closer to 200 seconds.",369
1843,foundry-support.txt,"The compile times are still fast on my new computer Anyone else seeing dramatically slowed testing? Or what could potentially beslowing things that much? does foundry have a way to interact with a deployed contract from an ABI? use case is I want to interact with https://arbiscan.io/address/0x42efe3e686808cca051a49bcde34c5cba2ebefc1 GlpAdapter.sol, and they don't have an interface file or public github, easiest would be to pull the ABI from there if possible What could be a reason that my local simulation passes but my on-chain simulation fails, assuming that state is not actively changing? They both supposedly run against a forked url state. Possibly something to do with tx.origin. There is no checks for timestamps or blocknumbers. It's actually this puzzle https://ethernaut.openzeppelin.com/level/0xb5858B8EDE0030e46C0Ac1aaAedea8Fb71EF423C where local simulation says I have correct answer but on-chain similation gives me error ""GatekeeperOne: invalid gateThree part three"" Ah I believe it's because my script is called by 0x00a329c0648769A73afAc7F9381E08FB43dBEA72 address which ends up being my tx.origin. I believe issue resolved after updating foundryup.",291
1844,foundry-support.txt,"The bug was as follows: Local simulation of foundry script was not correctly setting tx.origin whereas onchain simulation was, resulting in a diff Hey guys< Can anyone please send some bsctestnet faucet 0x50e5936622A9A02de9F3e812fF977a119D400798 to this address any amount will be sufficient Seeing discrepancies between the gas cost shown for calls in the trace (the [x] in brackets), and what you get by comparing gasleft before/after a call, is that expected/explained by something? or is it worth digging into I get this during my forge deploys to goerli, that I didn't get on my local goerli fork..: Error: (code: -32000, message: future transaction tries to replace pending, data: None) Try --slow I am receiving this error during a create operation on goerlo: (code: -32000, message: contract creation code storage out of gas, data: None) Hey guys, Did you see this error when deploy contract with Foundry Script? (code: -32000, message: future transaction tries to replace pending, data: None) I am trying depoy multiple contracts within a Script, like below: ``` function run() public { vm.startBroadcast(deployerPrivateKey); contractA = new ContractA(); contractB = new ContractB(); vm.stopBroadcast(); } ``` When I run the script to deploy contract on Georli with command below, it failed with above error : forge script script/Deploy.sol --fork-url https://eth-goerli.g.alchemy.com/v2/….. --broadcast --use 0.8.18 is there any cli option to supress all warnings in forge build? just found a solution with adding --slow parameter. Anyone run into issues with forge verify-contract just timing out? I was able to manually verify on etherscan but prefer the broken out version from the CLI Is there a way to measure the size of the state diff easily after a tx goes through ? also getting this - did you manage to solve? Huh.",436
1845,foundry-support.txt,"You clone and run build? yeah with cargo build -p anvil futures::executor::block_on says undeclared for ethers-providers-2.0.2/src/rpc/transports/ws/mod.rs but says it's 2.02 something to do with the legacy-ws dependency? no clue tbh Looking thx Try cargo clean? I just built master from fresh Foundry clone and it worked still same issue hmm cargo install —path ./anvil —bins —locked —force did work for me but cargo build —bins anvil didnt still getting it actually - even with the exact command hmm.. :/ ah rustup update You mighit be on old Rust Just realized its 100x easier to do this with Huff Use cast Send an anvil_unlockAccount instruction to the node using cast rpc this will allow you to transfer from a given account Can send an example if you need I think this can be combind with --from directly as well. Like $ cast send CONTRACT_ADDRESS ""funcSelector"" calldata --from NODE_ACCOUNT_ADDRESS --unlocked Hello! This is TonyFu from Winminer Shenzhen China. We offer high-quality mining hardware at competitive prices, perfect for anyone looking to get into Bitcoin mining or expand their existing operation. Our products are sourced from trusted manufacturers and come with a warranty for your peace of mind. If you're interested in buying from us, please see our price list below and feel free to reach out with any questions or inquiries.",298
1846,foundry-support.txt,"Any idea? it is OK, someone answered my question above Does the forge debugger work with fuzzing? Is testing sending transactions from a frontend using anvil to fork mainet a reasonable thing to do? Or is this not foundry's strong suit? There are different env file formats Try shdotenv https://stackoverflow.com/questions/19331497/set-environment-variables-from-file-of-key-value-pairs/67357762#67357762 thank you👍 Is there any way to cache an event log when testing and compare it later There's vm.recordLogs https://book.getfoundry.sh/cheatcodes/record-logs?highlight=recordlog#recordlogs Alternatively you can use vm.expectEmit() to check for individual emissions is https://github.com/foundry-rs/foundryup not public? Very strange , looks like visibility has changed , maybe some experimentation going on If a topic is an address how, does it encode to bytes32? I've tried this and casting to uint160 -> uint256 -> bytes32 and neither work how can i make cast use latest version of revm? im using the cast run debugger and it doesnt recognize the push0 opcode We're almost done with the revm 3 port That will solve it oh sweet Might be a bit of a dumb q but how do I get the deployer address in a script? is it msg.sender? btw in the meantime is there some way to make it ignore the unknown code and keep running like remix debugger? Need to deploy Chainlink mocks as part of my tests, but the compiler versions are incompatible. LinkToken for instance is Solidity v4. What's the best way to handle this? deployCode? Can someone direct me to where I work out the mapping for forked contracts. What I mean is in brownie I would save the contract addresses in the config, then import these into a contract that I would use when I forked. So it would reference the Mainnet address in my forked network and I could then test locally with the fork, if that makes sense? I would run ganache with the fork network I want to use. I would have a script and then test my contracts but the real Mainnet addresses are saved and referenced in my brownie-config.yaml file.",465
1847,foundry-support.txt,"In foundry, where do we do this? Is it needed? I've done testing following Nader dabits tutorials but now I'm wondering where I do this sort of thing I did the same with brownie for a poc of an exploit for anyswap, but if I were to remake this in foundry I'm slightly lost on the setup for this Look at this https://t.me/foundry_support/33956 how to created a nested json with vm.serializeJsons? serializeString does it 👍 is there a way to access dynamically linked libraries addresses from forge script? Has revm(foundry) updated to shapella? https://t.me/foundry_support/35592 Hi guys, I was reading here https://book.getfoundry.sh/tutorials/solidity-scripting and got confused here uint256 deployerPrivateKey = vm.envUint(""PRIVATE_KEY""); This loads in the private key from our .env file. Note: you must be careful when exposing private keys in a .env file and loading them into programs. This is only recommended for use with non-privileged deployers or for local / test setups. For production setups please review the various wallet options that Foundry supports. What is the recommended approach for a production environment with foundry? usually assuming the env is not pushed to git I wouldn't consider that a risk, this warning is because keeping the secret key stored on a hard drive is dangerous in case the drive is stolen/ accessed to? Hello everyone, I have a question, would appreciate any help. I have a function named register that takes a referrer as a parameter, and the msg.sender has to send 0.25 eth as msg.value to succesfully call the function. Here it is  function register(   address _referrer  ) public payable validRegistration(_referrer) {   User storage newUser = users[msg.sender];   newUser.referrer = _referrer;   newUser.totalReferrals = 0;   newUser.level = 1;    transferPayment(_referrer, msg.value);   updateReferralCount(_referrer);  } Now, I want to test this function in Foundry by calling it via an address, and sending the appropriate amount.",446
1848,foundry-support.txt,"So in my setup, I create some addresses like so =>  function setUp() public {   referralContract = new Referral();   alice = vm.addr(1);   bob = vm.addr(2);  } but whenever I try to call the function in the following manner, I get an error :  function test_register() public {   address referrer = referralContract.owner();   vm.prank(alice);   vm.deal(alice, 25 ether);   console.log(""alice"", alice.balance);   referralContract.register{value: 0.25 ether}(referrer);  } forge test reverts. Anyone has any idea where am I going wrong? Think in general it's very dangerous to assume any PK sitting in plaintext is secure. We did a deploy on Thursday and used a keystore with a freshly generated account. You replace --private-key with --keystore /path/to/keystore-file and paste the password Could be: - Contract is not ownable - prank should be called just before calling the referral contract, you might be pranking deal or console log Mmhh yeah I see the issue, I am amazed metamask doesn't allow export to keystore yet Thanks, for anyone wondering, I found the error. I basically didn't add a receive function, which was defined in Fuzz Testing page in the docs. My Bad. So, I added this to my test contract and it worked fine  // Needed so the test contract itself can receive ether  // when withdrawing  receive() external payable {} Hi everyone, I would like to ask you if there is a way how to export traces into a file? Like using stdoutput/stderr redirection? forge test -vvv | tee test.txt; less test.txt Off the wall idea, does anybody have any idea how they would write a forge test that asserts that the contract being tested does not have the ability to selfdestruct in any function Like could you do something like an invariant test that would test if address.code.length was greater than zero Trying to deploy on zkevm-testnet, --verify is having no effect (no attempted verification at all). I remember trying yesterday and verification failing, but now forge does not even attempt to verify and ends silently after running a simulation. Is there a known way to not even attempt verification even with the --verify flag on? Yep, I was thinking about that as well, but unfortunately this will need to structure the exported data.",497
1849,foundry-support.txt,"Use sudo 😅 😀 right LOL why you did apt install forge again? Anyway didn't install now try to do forge --help 🤨 That's still not foundry's forge... You need to figure out what you installed and uninstall it ok thanks , I've no idea actually, but anyway hopefully I will manage to do it. Thanks ok it works... actually thanks again! How can one use forge with a post-merge EVM version? Whenever I put something later than london into foundry.toml I get an error about it being an unknown evm version I am using forge version: forge 0.2.0 (04ce078 2023-04-17T00:04:57.209269000Z) Guys I'm struggling to update forge-std, and I found other instances of the same problem on the chat Forge update seems to do nothing, forge install foundry-rs/forge-std --no-commit gives me ""lib/forge-std"" already exists in the index, you can update it using forge update. forge remove foundry-rs/forge-std gives me `Error: fatal: not removing '/home/niccolo/ctfprotocol/lib/forge-std' recursively without -r` Foundry isn't on any package manager, install instructions on github not supported yet, see https://github.com/foundry-rs/foundry/issues/4356 forge dependencies are git submodules and the commands are just simple wrappers around the git submodule command.",308
1850,foundry-support.txt,"What does forge update return? It doesn't return anything Try deleting the lib folder and do a git submodule add forge-std that gave me fatal: repo URL: 'forge-std' must be absolute or begin with ./|../ so I used the git link to the repo and it downloaded the repo inside the root of the project, I tried moving it into the lib folder but it didn't download also ds-test, in the end I moved the lib folder from another project where it works and this seems to have solved the issue 2023-04-18T13:51:01.699804Z ERROR sharedbackend: Failed to send/recv `storage` err=GetStorage(0x7fa9385be102ac3eac297483dd6233d62b3e1496, 36, (code: -32043, message: Requested data is not available, data: None)) address=0x7fa9385be102ac3eac297483dd6233d62b3e1496 index=36 2023-04-18T13:51:01.823814Z ERROR sharedbackend: Failed to send/recv `basic` err=GetAccount(0x0000000000000000000000000000000000000000, (code: -32043, message: Requested data is not available, data: None)) address=0x0000000000000000000000000000000000000000 The application panicked (crashed). Message: called `Option::unwrap()` on a `None` value Location: /Users/runner/.cargo/registry/src/github.com-1ecc6299db9ec823/revm-2.3.1/src/evm_impl.rs:285 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry all my tests passed but getting this error how do i figure out where it’s coming from nvm, this was an RPC issue Foundry estimates gas for some of the successful revert tests at ridiculously high values, while others look normal. E.g.",438
1851,foundry-support.txt,"[PASS] test_transferLINKFrom_insufficient_LINK_reverts() (gas: 8797746687696090261) [PASS] test_queryVRF_insufficient_min_LINK_balance_reverts() (gas: 40225) Is that expected behaviour? Does foundry work with Quorum or Besu? I’ve never heard of these networks until today at work. Coworker mentioned that truffle is the primary tool for working with them. Should be fine for Anything EVM compatible Well naturally, no 😄 Pls open issue foundry is better than hardhat? Sounds like your RPC provider isn’t working yea No files changed, compilation skipped 2023-04-18T16:28:48.462532Z ERROR sharedbackend: Failed to send/recv basic err=GetAccount(0x0000000000000000000000000000000000000000, (code: -32000, message: missing trie node 7887fc47300c36f531168e38613b85a3a5d30ef0f9fa6f36cb6d67978630e8b9 (path ), data: None)) address=0x0000000000000000000000000000000000000000 The application panicked (crashed). Message: called Option::unwrap() on a None value Location: /home/runner/.cargo/registry/src/github.com-1ecc6299db9ec823/revm-2.3.1/src/evm_impl.rs:285 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets. missing trie node , What's wrong a little confusing RPC related, try different RPC. Not something we can fix unfortunately, usually it means the node you’re tlaking to isn’t up to the lbock youre forking from thanks Done. This also happens when you're requesting data that only an archive node would have, but the RPC points to a full node instead. https://ethereum.org/en/developers/docs/nodes-and-clients/archive-nodes/ Is it possible to console.log a Vm.Log record somehow? Thank you for the info!!! Very much appreciated Trying to make sense of how to decode an event.",493
1852,foundry-support.txt,"Is there a log function that would dump the entirety of a record to console? @msolomon4 https://github.com/foundry-rs/foundry/pull/4770 I would be more than happy to receive any feedback on this, can't wait to see it in production since it's my first contribution to a big project! awesome! I might be slow to take a look this week but mattsse may look sooner—feel free to take it out of draft whenever you're ready for review 🙂 Hey looking for someone to help verify a set of contracts deployed using foundry It uses a deployer script to create a bunch of additional contracts, trying to get foundry --verify to do the etherscan verification of the additional contracts. What's your difficulty? does forge script have a way to force the broadcasting of a transaction that will fail? Not verifying the additional contracts deployed by the root contract Missing constructor args perhaps? Is forge script expected to also pick up new deployments when broadcasting and verify the children contracts as well when running with --verify or will it only verify the contracts deployed directly? Doesn't seem to be mentioned in the docs. And if not, should this be a feature request? "" --verify If it finds a matching broadcast log, it tries to verify every contract found in the receipts."" Does ""every contract"" cover children contracts as well? How does specifying target contracts and selectors in 0.2.0 work? seems the documented functions like targetSelectors and targetContract are no longer implemented. undefined in use and not appearing when searching repo. for invariant testing It does. Wasn't expecting it, but it found child contracts and verified it too Thanks. Is there a way to control (or even know) the order of the contracts given to Etherscan? My contract code is consistently at the bottom of the list in the Etherscan contract page. I'd like the code I wrote to be at the top. Any way to do this? As @oxfoobar asked previously. Hey, can we simulate tx.origin with vm.prank? That's what it does though, does it not? Executes a tx as if from a specific account. Down the line, if the entry-point contract calls another contract, msg.sender will be set to the contract's address, but I expect tx.origin will still be the account from vm.prank. hmm, it does not on my testing.",489
1853,foundry-support.txt,"Care to elaborate? I use vm.startPrank with the borrwer wallet address and try to call contract function and in the contract function, it's checking tx.origin == borrowerAddress, and it's reverting here. function startPrank(address sender, address origin) external; https://book.getfoundry.sh/cheatcodes/start-prank oh, good to know. thanks .prank is the same, it has an alternative syntax as well. Does foundry include sth like cast etherscan-source but for blockscout (which i think should be mostly compatible?) hey guys where can i get some sepolia eth google sepolia faucet i did nothing worked someone them said sent but nothing yet guys, how to downgrade foundry?) E.g. I need another build of 0.2.0 aave hey guys, is there a way to organize tests in describe functions? I would like to have more setUps for a group of test functions maybe No, but you can use modifiers like this: https://twitter.com/PaulRBerg/status/1624763320539525121 Also, create a file for every function-under-test This way, the contract in that file acts as a quasi-describe block See the ""Best Practices"" docs in the Foundry Book written by chad @msolomon4 (+ frens) https://book.getfoundry.sh/tutorials/best-practices Speaking of best practices. Do you guys have any tips/ tricks for contract address management in fork tests? We have hard coded the addresses for our dependencies in the Solidity test files, but I wonder if it wouldn't be better to store them in a JSON file, and then use vm.parseJson to read them in Solidity @PaulRBerg hey Paul! Thank you sir! waiting for receipt takes a lot of time on forked anvil? Which transaction? what does “a lot of time” mean, vs what etc. a simple erc20 approval tx taking quite some time to confirm understand first time it can take some time to fetch state for fork, but subsequent ones are cached, shouldn’t take long right wondering if i am missing some config here or is it some ethers tx.wait weirdness against anvil I believe the Etherscan team will be shipping a fix for this in the next month or two Been pushing them on it I've been using brownie a a framework to organize scripts that query on-chain data in a cronjob.",500
1854,foundry-support.txt,"Is there any documentation for using foundry in this fashion? Looking to find something more actively maintained. If you're deploying a contract on mainnet through script broadcast, and you set the gas too low, to cancel it can you just ctrl+C or will that transaction still have been broadcast to the network and be pending? 🤣looks like it doesn't cancel it What am i supposed to enable so that its not recompiling everything every time Hello, I am trying to verify contracts on Aurora network using forge verify but it doesnt work. We used to have this entry in our foundry.toml: aurora = { key = ""${AURORA_ETHERSCAN_API_KEY}"", url = ""https://api.aurorascan.dev/api"" } and someone suggested that I should change the URL to: aurora = { key = ""${AURORA_ETHERSCAN_API_KEY}"", url = ""https://explorer.mainnet.aurora.dev/api"" } but I keep getting this error: 2023-04-20T08:00:30.879484Z ERROR forge::verify: Failed to submit verification args=""{\""contractaddress\"":\""0x54f015d..... Could anyone please help me to solve this? Hey all, got a question about create2 when executing in memory (forge without rpc-url) my create2 call works but when I execute against anvil it fails is there something I should do like deploying the create2 factory or something else ? are you running any asserts for the deterministic addresses? they might differ locally from what they will be on a live network because the deployments will be run through a factory there (0x4e59b44847b379578588920cA78FbF26c0B4956C) instead of a direct creation using the account running the deployment script. forge build --skip test But, if you're using via IR, see this: https://twitter.com/PaulRBerg/status/1610229563128152064 No assert just a call to create2 in assembly Spare time, what is that? Hey, I'm having a hard time debuging an issue with a static call. It reverts with ""EvmError: NotActivated"" but I cannot find any docs describing this error.",463
1855,foundry-support.txt,"Anyone knows what it means? Are there scenarios where a test is passed while running - - forge test — but in no circumstances would it pass on mainnet? Is there a way to specify the nonce to start with when running a script that sends multiple transactions. Like to overwrite/replace and drop a pending transaction? Yes because mainnet is a dynamic target and seen 15+ hard forks over its life that have changed EVM Though this is not in practice, as long as Forge follows the latest EVM and the developer is not doing anything really exotic is there a way I can have a call in a script that I am not broadcasting to the chain be from a particular address? .startBroadcast with who maybe Hi guys! Is it normal for fork_block_number in foundry.toml to be taken into account during simulation before executing a script? I spent several hours trying to figure out why a contract wasn't deployed yet (the block number was old af) when I wanted to run a script directly via my RPC. Shouldn't it only be taken into account when using --fork-url and not --rpc-url, right? I know you can load in the private key using uint256 key = vm.envUint(""PRIVATE_KEY""); then in vm.startBroadcast((key); Or you can not broadcast by excluding the --broadcast flag from the command... But not sure if that's what you mean? this does it, works when you do not want to broadcast but just simulate, too Like, would this work within a script, to start the first txn at the same nonce as a currently pending txn that is set with gas price too low? Hi everyone! I'm curious about the current state of fuzz tests + coverage in Foundry. Are all fuzz runs aggregated into a single coverage report? How many runs does forge coverage run by default? At least in my test suite, it seems like specifying runs has no effect on the time it takes to run coverage and the reported coverage result is maybe just a single fuzz run. Is that right? If it matters, I've been filtering down to a single test using -m. Hey all. Am setting up a deploy script to fork mainnet, deploy a contract and send some ERC20 tokens to an address.",454
1856,foundry-support.txt,"My understanding is the deal cheatcode doesn't persist a state change of the token contract (so that I could see the balance on metamask), but rather just mocks the balanceOf call? Is that correct / is there a preferred way to setup an persistant anvil environment with a forked state + tokens? Hello Guys, may I know if foundry support doing fuzzing or invariant test based on a onchain fork? I try to fork state in setup() but it eventually will quest the state for every round and run out the rpc limit, not sure why/ When I attempt to use vm.setNonce to be the nonce of a pending transaction, I get an error. The currently pending nonce is 6. I set the nonce to 6. The script fails to send out that transacation that is literally just send 1 wei of eth to myself. How would I get it to broadcast with a pending transaction nonce? Even doing it manually through MM isn't working, which is weird. Set it to go through my own Alchemy RPC so I could see what was happening. Anyone have any suggestions as to how to get this txn to cancel? Hey has anyone managed a workaround to use openzeppelin's defender admin client on foundry scripts? running cast send --from <address> --private-key $PrivateKey <same address> --value 0 ether --nonce 6 or --resend --rpc-url $rpc Results in an error saying ""contract source code not verified: <same address>"" Not including the --from <address> just gives an error saying gotta use --hd-path even though it's not a hardware wallet. screw it, used --resend and had it call an existing contract 😂 HD path refers to a HD wallet derivation path, not a hardware wallet. totally, but it explicitly says ""hardware wallet in the error"" - but I think that's just an issue of not using a --from address and just giving it --private-key is there a way to use stdstore.target() on private variables? Anyone else have issues with etherscan verification, getting the following error: Encountered an error verifying this contract: Response: `NOTOK` Details: `Unable to process the standard-input-json you uploaded` is there a way to have cast send a txn that will fail? eg.",472
1857,foundry-support.txt,"$ cast send 0xB971eF87ede563556b2ED4b1C0b0019111Dd85d2 ""exactInputSingle((address,address,uint24,address,uint256,uint256,uint256,uint160))"" ""(0x0ffC97987fE9d689c8EF1F20d12C5213a818Fb06,0xE6675c07212A555e814BF8E7E552bFA9c432E991,3000,0x08fa296ca8D0c9cb34aCE38ae9cF49b751dC8aeC,1682128001,100000000,0,0)"" --private-key KEY --rpc-url https://bsc-dataseed2.binance.org Error: (code: -32000, message: execution reverted, data: None) I would like this to be broadcast for debugging I reported an error when debugging this tx, what is the problem, I searched and found no solution anvil doesn’t show console.logs? is the answer that anvil doesn’t? Specify gas limit and it will Is there anyway to know if broadcast mode is activated during evm execution? For my tool i need to save some file if the user intend to broadcast but would rather not save if not, for optimization purpose I am refering to forge script ... --broadcast bump Hey guys if anyone here is interested on web3 sec here's a very cool group https://discord.gg/opensense Loads of foundry talks Hi, When running --debug on some contracts I get ""No source for srcmap index"" all the way through - this only appears to be on some tests and not others what generally is the cause of this? It seemed that forge clean and then forge build fixes the issue but I'm curious to what might have happened? anyone used this https://github.com/wighawag/forge-deploy? is there any cheat to find and replace a text in a Solidity string? I know I could use vm.ffi but I'd prefer not to, if possible *Late edit*: it looks like I could use Solady's LibString for this.",451
1858,foundry-support.txt,"https://github.com/Vectorized/solady/blob/2c7fa305e443b0e69abff24810dc814a9202f966/src/utils/LibString.sol#L354 Hey, if I want to fork the network, but I always want my transactions to be run against the most recent node on mainnet, is the fastest way to achieve this to usse an anvil_reset in between all my transactions to allow the block I'm forking from to be updated? Or is there some way of keeping the forked network in sync with mainnet? Hey @quangkeu95 this is very new, if you have any issue let me know the api might also changes as I work on it but keen to get feedback Just don't pass a block number and the fork cheat will fork from the latest block. From the docs: > If a block number is passed as an argument, the fork will begin on that block, otherwise it will begin on the latest block. https://book.getfoundry.sh/cheatcodes/create-select-fork#createselectfork I think what he meant is updating the forked block number to latest one realtime without reinitialising anvil Hey, but once the fork is running it will continue to use that block no? I want the fork to keep in sync with mainnet throughout its life so I can keep throwing transactions at it and see what it would do on mainnet right now Ty for your time btw Yes, this is correct Hi, I am working with external contracts and I am getting the error message ""[FAIL. Reason: EvmError: FatalExternalError]"".",335
1859,foundry-support.txt,"Is something wrong with the RPC fork/provider or is it contract/code related? pre-compiles maybe? hmm Hey - is there a way / what is the best way to link an external library to a contract in my test setup? Anyone encounter these block out of range errors when stopping/starting anvil? Is it possible to get forge build to compile just a single file? is there a way to replicate signer._signTypedData from ethers? i see the vm.sign cheatcode but i don't want it destructured into v/r/s You can just concat it back to the full sig any example code for this available? https://github.com/aavegotchi/aavegotchi-gbm-baazaar/blob/36798e5f043fb8cce788b09b690e5363190142da/contracts/test/TestHelpers.sol#L21 much appreciated Is it possible to pipe commands in ffi? I.e. using | as one of the inputs It doesn't seem to work, though it could be the case that I made some other mistake Similarly - has anyone managed to get ffi to work with sed? anyone faceed up this error, while running tests through foundry's actions worflow, during the forge test command Compiler run failed error[6275]: ParserError: Source ""src/HelloWorld.sol"" not found: File not found. Searched the following locations: ""/home/runner/work/testing-foundry/testing-foundry"". help appreciated, thanks. faced* Possibly due to this: https://github.com/foundry-rs/foundry/issues/3440 Add this to your remappings: src/=src/ Works locally without it, its just the gh actions workflow which fails. added up this to my workflow, to make sure src/= src/ is run before running tests, still no luck. - name: Generate remappings run: | forge remappings > remappings.txt echo 'src/=src/' >> remappings.txt forge remappings Am I doing something wrong? the failed workflow job for more context(if needed) https://github.com/abheektripathy/testing-foundry/actions/runs/4767769999/jobs/8476365587 Is there an easier method to mock the functionnality of a contract function than etching the whole address implementation with a mock? let's say I want to mock what a ERC20 transferFrom does for 1 test.",489
1860,foundry-support.txt,"I would have like to provide a mock for a single function for one address with some function arg type. nevermind I think I found how to do it Hey, is there any way currently to write a JSON based on the values from a solidity struct without having to serialize each individual value? The inverse of what you would do with abi.decode(vm.parseJson... Having the same issue. I wonder if there are any open issues tracking this issue. I forget if we track this somewhere but yeah that’d be nice. It’s not fundamental I think. How much time it takes for this stage? Haha release mode takes a few minutes from clean Rust compiler Hey guys, how to print the cost ethers when run test? “forge test --gas-report --gas-price 32” can’t work. Try --with-gas-price and price in wei (i.e. 32000000000) error: unexpected argument '--with-gas-price' found tip: a similar argument exists: '--gas-price' Sorry, it's for broadcasting, i thought it works the same for tests thank you , I didn’t found more config for gas report function. Is there a way to send raw signed tx in forge's solidity ? Hi, how can I deploy a contract and its constructor is like `constructor(EtherGame _etherGame)`(EtherGame is a contract)? use --constructor-args 0x1234…1234 dont know... did you find a way to do it? im interested too no, looking at the doc and ref, can't find anything Is it possible to get the current rpc url within a foundry script? Alternatively is there a cheatcode for sending a custom jsonrpc request to the current provider within a foundry script? This would allow easy integration with tenderly forks as they have custom jsonrpc methods for changing the state of a fork. I am deploying a contract with create2 but the addresses are different I think it is because I use libraries with using A for B in my contract. How can I deploy the libraries also with create2 because the explorer shows me that I deploy the lib with create and the contract with create2 createSelectFork / selectFork, no? and rpcUrls() I think in forge-std I am realizing that I no longer remember the entirety of foundry to do proper support…planning to do FoundryGPT for docs from this chat/public codebases/..",492
1861,foundry-support.txt,"sometime in the next few weeks, I did it with Vitalik’s blog in a couple hours last week and it was decent at producing responses that returns all the rpc configs. but i'm specifically looking for the current rpc url during runtime without having to define a custom env var. ah like the active RPC. i dont remember, if you dont see it in the docs we don’t have it and we could/should add it yes exactly and what do you think of adding another cheatcode for sending custom jsonrpc requests to the current active provider? I'm having this weird issue where the test fails even though events are emitted. If I comment out any three of the four expectEmit/emit pairs, the test passes. If I only comment out the last one, it passes. But with all four, it fails. Another similar test does work, but it's three SharesRevoked and one SharesAssigned instead. I've tested this contract on hh already, just porting the tests.",201
1862,foundry-support.txt,"What could be the issue here? gm sers, is it possible to use vm cheatcodes inside chisel? ok it works with vm.deal actually but did not work with other commands like vm.envAddress, very weird when using vm.envAddress in chisel i get ""environment variable not found"" but i am 100% sure it is here, i sourced the .env file right before launching chisel is theres a generic method to repro “eth_sign” within foundry’s testing framework? like vm.sign() but with all that extra crap 🙂 You gotta do the hash with the eth message prefix, we could add a helper if a big pain in Forge std I guess but it's ez Just append to the hash https://github.com/aavegotchi/aavegotchi-gbm-baazaar/blob/36798e5f043fb8cce788b09b690e5363190142da/contracts/test/TestHelpers.sol#L15 Ah i almost got it, i messed up with len(msg) (should have not added len(msg) basically), thanks! Did you ever figure this out? I just started seeing this error a few days ago when I use cast I get this error: `(code: 3, message: execution reverted, data: Some(String(""0x”)))` when I run this cast send --private-key $i $CONTRACT ""claimRank(uint256)"" 1 Ya your tx is failing For some reason related to that function import {Utils} from ""./utils/Utils.sol""; I don't have utils.sol file, where I can find it ???? Yes. Should be using cast send instead of cast call for payable or executable functions. Call is read only as I understand. Hi, I need my forge test to execute multiple transactions to avoid a reentrancy lock. Any idea how this can be done? Does someone know how to deploy contracts with create2 when they have a statement using Lib for type because the lib is deployed without the create2 opcode ? Hi I can fork TRON by foundry? Maybe wrap in a multisend Trying to run anvil in docker, intention is to have it running on a VPS, but currently I can not even get it to run it accessibly in docker on my local machine.",463
1863,foundry-support.txt,"If I call this in a terminal: anvil --block-time 60 --fork-url MY_RPC_URL --fork-block-number 17105628 and then: cast chain-id --rpc-url http://localhost:8545 everthing works fine. But creating a dockerfile like the following, running it locally and then using the cast command from above does not work: # Use the latest foundry image FROM ghcr.io/foundry-rs/foundry CMD [""anvil"", ""--block-time"", ""60"", ""--fork-url"", ""MY_RPC_URL"", ""--fork-block-number"", ""17105628""] EXPOSE 8545 with this: I get error sending request for url (http://localhost:8545/): connection closed before message completed any ideas? Edit: I have terminated the anvil instance from the terminal prior to doing this. Also I have verified in logs from Docker Desktop that anvil does indeed start within the container, listening to 127.0.0.1:8545 Have you mapped the docker container's internal port binding to your 8545 port? https://docs.docker.com/config/containers/container-networking/ docker run -dp 8545:8545 anvil-eth-fork is the call I use to start it and the build command just for full context: docker build -t anvil-eth-fork . You have to run anvil with host 0.0.0.0 anvil --host 0.0.0.0 tried that too, but it doesnt seem to do the job in my case 😔 the dockerfile from above has this line now: `CMD [""anvil"", ""--block-time"", ""60"", ""--fork-url"", ""`MY_RPC_URL"", \ ""--fork-block-number"", ""17105628"", ""--host"", ""0.0.0.0""]` hey, guys I need your help to run an example project with forge cast chain-id --rpc-url http://0.0.0.0:8545 And changed this too? not until now, but still no success throws a different error btw: error sending request for url (http://0.0.0.0:8545/): error trying to connect: tcp connect error: The requested address is not valid in its context.",468
1864,foundry-support.txt,"(os error 10049) ffs, i just needed to run foundryup really nice to meet you guys :) I think you could try binding 0.0.0.0 to 8545, this would expose everything though so check it fits your security model will consider it, appreciate both you and grim taking a look :) ㅗ dont know if this is useful, but sharing if you are in deployment and want to calculate the transaction fee base on gas limit https://www.estimate-gas.xyz/ I'm having an issue where the fuzzer is giving me revert counterexamples, but they don't seem to actually be valid when I check the exact same calls via Chisel. Any ideas what could be going wrong? It's literally a function with 2 uint256 inputs where 1 is fixed and the other variable, although the function is complex internally cast send signs and publishes a tx, while cast publish publishes a signed tx is there any way to do each of the following? (a) produce a raw unsigned tx (b) sign a raw unsigned tx, without publishing? I think cast wallet sign will let you sign Hi guys, is there a comfortable way to access private functions in foundry? I was thinking of basically doing a copy paste of the code changing the visibility of the private function and then using the code it generates to do vm.etch is there a more convenient way/ would this work? You can vm.load the storage slot value! Forge std has some tricks in it as well gm. I was wondering how is the msg.sender sending transactions being choosen during fuzzing? According to horsefact tutorial it is being fuzzed but there is no info on how.",344
1865,foundry-support.txt,"Is it chosing radomly among all addresses? In echidna there is a parameter to set a small subset of EOAs for the sender, but there is no such parameter in foundry.toml it seems also to fuzz msg.value is it still mandatory to use a handler contract? Thanks but the function is more complex than a getter, it accesses many slots and have a conditional logic, I could recreate that from the outside but accessing the return value of the function would be more convenient 🙂 I think this is the best way to do it now : ""To test an internal solidity function, create a child contract that inherits from the contract being tested, wrap the parent contract’s internal function with an external one, then test the external function in the child."" source : https://www.rareskills.io/post/solidity-test-internal-function + change private functions to be internal this is more principled than changing them to public or external imo Hi all - is there any guidance on the best way to deploy upgradable proxies with foundry? I dont see anything in the foundry book? Any advice 🙏 Here there is a library that we use for our UUPS contracts: https://github.com/0xPhaze/upgrade-scripts Does the --contracts options of forge coverage works? I need to specify only a set of file to make coverage. thanks I like this approach, in my case I have a contract already deployed and with the target private function in it, so I guess the only way would be to change the code of it and vm.etch it? this way the storage would remain the same but the function would become accessible (it's just to for a POC) I’ve set via_ir = true in the foundry.toml and can manage to compile & test my code but running forge coverage —via-ir —report lcov still spits out “Stack too deep. Try compiling with —via-ir”… any idea? :) is there anyway in foundry to see all the logs from all fuzzing steps? I only see a single one, this can be annoying for debugging. i;e in my fuzz test i have a console.log(x) , i want to see the whole 256 logs of x, not just one ah also had same error this morning and was wondering the same.",473
1866,foundry-support.txt,"maybe there is a way to increase stack limit in configuration i found this https://github.com/foundry-rs/foundry/issues/3357 unfortunately the situation is bad now ""The easiest solution is to update your code to avoid stack too deep issues"" :( Stack limit is defined on evm level, not just for solidity i know, but foundry is using its own modified version of evm already with cheatcodes, so this might be possible Is there a way in expectCall to define ""any uint"" in the expected parameters? this would probably be easier to do than trying somehow to adapt the coverage to be run also with optimizer set to true, which would necessitate a lot of headaches to be able to track the sourcemap from optimized bytecode. but i am saying this as a complete rust noob, I do not understand foundry internals, so I might be also completely wrong The weird thing is that the tests are passing, but forge coverage isn’t. So I’m guessing it’s something related to forge and not the EVM :) No its related to the code not compiling without optimizer turned on. You can try disabling the optimizer on foundry config and run forge build, it won't compile @macaking the root cause is explained here : with coverage compilation is done without optimizer because it is hard to track sourcemap from optimized bytecode, so my idea was that perhaps adding a way to increase (or remove all together) stack limit for coverage was an easier solution I am a rust noob as well, so no clue how hard it is to modify evm. Well, these stack too deep's helped me to write better code, so there's that :) ah cheers mate :) ah kinda sucks though. My function is just a setUp function that has many initializers… nothing inherently “bad code” imho If you're getting stack too deep try breaking your function in smaller funcs! hey 👋 Does anyone know if there’s a way to persist and restore anvil chain state on disk, similar to ganache’s —db flag? --ffi in test mode does not work as expected when trying to use echo to write files to disk? nothing is being written on disk, but the test passes I think this may be because of the coverage mechanism. If memory serves, it injects additional instructions into the code in order to track execution.",477
1867,foundry-support.txt,"So perhaps there are extra variables in there and that causes stack too deep? Hi, I just verified my contract using forge and got this confirmation: Start verifying contract `0xa4af8131d0e196919cad4b6975637d14eb563120` deployed on sepolia Submitting verification for [src/New.sol:New] ""0xA4aF8131D0E196919cad4b6975637D14Eb563120"". Submitted contract for verification:   Response: `OK`   GUID: `uenqlspes8jmsfdnqdu5txmd2tp6wgsrw2baznienspq3hncpg`   URL:   https://sepolia.etherscan.io/address/0xa4af8131d0e196919cad4b6975637d14eb563120 But i checked in that url to see my verified contract then i saw it was not verified, what is happeing? hey guys, is there any way to avoid forge coverage summary for the folder script/ ? tried --no-match-path passing script/ but it still appearing on the coverage summary anybody????? check with the etherscan api with the GUID you will have more info about your request https://docs.etherscan.io/api-endpoints/contracts#check-source-code-verification-submission-status You can add a mock test function inside scripts function testMock() external {} Oh, got it. An empty one like your example? Yeah. Just to trick forge to think its a test file Haha cool! Thanks for that! Hello, I was hoping to get a complete list of docker environment variables for anvil as mentioned in the anvil book? The link to the docker tutorial there is broken and the tutorial i found in the book is not mentioning the anvil docker environment variables. from the reference: Usage within Docker In order to run anvil as a service in Github Actions with the Docker container, where passing arguments to the entrypoint command is not possible, use the ANVIL_IP_ADDR environment variable to set the host's IP. ANVIL_IP_ADDR=0.0.0.0 is equivalent to providing the --host <ip> option.",455
1868,foundry-support.txt,"https://book.getfoundry.sh/reference/anvil/ but it doesn't mention the rest of the arguments there Hey, forge script is doing some weird things, am not able to get a response from a contract when invoked through forge script, though it works when i invoke through cast or web3py. Any idea whats happening ? I have raised a bug at https://github.com/foundry-rs/foundry/issues/4788 Can i have some context on why am getting a CreateContractLimit when trying to deploy a contract using web3py? Seems like there must be a better way to do this than to trick it 😂️ It seems to me like maybe only the IP address is an environment variable accessible?  #[clap(   long,   help = ""The host the server will listen on"",   value_name = ""IP_ADDR"",   env = ""ANVIL_IP_ADDR"",   help_heading = ""Server options""  )]  pub host: Option<IpAddr>, this is the only function with env in it. in anvil/src/cmd.rs Any file i create or delete, i am having to commit, how to get rid of commiting ? what do i need to do in the foundry.toml in order for the compiler to treat the warning as error ? Hey guys, I just tried to deploy a contract to mainnet with foundry. It bugged out, I've lost the eth and no contract. I've tested and deployed this contract on Anvil locally and Goerli. Any ideas what might have happened? forge 0.2.0 (dedc31e 2023-04-24T11:47:10.201945000Z) U can check the transaction history of ur deploy account to see what happend I've had a look on etherscan and there are no pending transactions. Scary bug £50 a try I can write up a full ticket on github, but as it just cost me money I thought I should report it straight away. No errors in tests. No errors deploying to other nets. Is it by any chance failing with ""[contract creation code storage out of gas]"" No. parse error: Invalid numeric literal at line 2, column 9 The application panicked (crashed). Message: failed printing to stdout: Broken pipe (os error 32) Location: library/std/src/io/stdio.rs:1008 This is a bug.",496
1869,foundry-support.txt,"Consider reporting it at https://github.com/foundry-rs/foundry Then what does it say on the tx? There is no tx It's like it never happened. Except the eth is missing. Uhh you know that's not possible right? That's kinda what I thought yeah. Check etherscan. It'll be there It just showed up. Ok, so transaction completed but the pipe broke. That's much better than I thought. what are the cases when evm_revert might fail on anvil? Hey folks i used a foundry script to deploy a contract with a deterministic address. It worked all fine on eth,poly,op,ftm but for some reason it creates a different contract on arbi and bsc. Im using the same salt and signer. Any idea how that happened or how i could fix that? i have been facing similar issue since yesterday. the message are different though. anyone knows what could be the issue? I have updated foundry but the issue keeps persisting. I had a quick look, and it appears that foundry is pulling in a yanked version of this lib: https://crates.io/crates/h2 0.3.17 was yanked. So it might be something to do with that? It's a http client/server lib, fits the bill as a possible culprit. Can I use the invariant test functionality to test per-function level state changes? E.g. I want the fuzzer to do some runs with some depth, mutating the state of some group of smart contracts in general. Then I want to fuzz one particular selector, and I want to be able to write assertions on the expected state change of that selector alone regardless of the mutated state that happened before the selector was called. Invariant tests as I've seen in the horsefacts weth blog post, and other references online, seem to only check things that are true globally for the entire set of contracts you test. That's useful, but I also want to check that each function as its being fuzzed, does exactly the thing I expect it to do, regardless of the globally mutated state from all the other fuzz calls during the invariant fuzz run Is there some coding pattern that will allow me to do this? I've experimented with writing asserts within the fuzzed function itself, but the invariant test suite ignores reverts, so presumably those asserts don't halt the fuzzer or tell me something went wrong.",495
1870,foundry-support.txt,"I also tried ghost variables, but it appears those change cumulatively across the entire run, and the invariant isn't assertable per fuzzed function call? Does anybody have any guidance on how to best achieve this testing goal? to integrate foundry into an exsiting hardhat project which guide should i use? the one in the foundry book or the one on hardhat website? a: https://book.getfoundry.sh/config/hardhat#use-foundry-in-an-existing-hardhat-project b: https://hardhat.org/hardhat-runner/docs/advanced/hardhat-and-foundry#adding-foundry-to-a-hardhat-project also what is the difference? hmm maybe ghost variables do work for this, I'm not sure, still trying. I have a hook that runs after and before the function records into different ghost variables the value you want to check, and then compares them within the invariant test, and that may be correct/working I created an issue for it : https://github.com/foundry-rs/foundry/issues/4816 I am seeing this as well, I think -vv not logging like it's supposed to alright this is weird. If I change something in the code, then do a console log in the test, it will print with forge test -vv but if I run the test twice, it won't console log the second time. Bizarre Try -vvv ? doesn't matter how many vs. happens with 4 the same as 2 I deployed the same contract with and without create2 but I can't verify it with create2 is there something I need to specify ? I am trying to run Slither on a Foundry project. I have realized that having the test folder makes Slither to fail. I tried avoiding the path by running slither . --filter-paths test but it doesn't solve the issue. I also tried to use a custom build command: forge build --build-info --force --skip test but Slither fails again. When I say Slither fails I means that it doesn't do the static analysis and prints a bunch of stack traces to the python code (no hint of what is causing the error).",444
1871,foundry-support.txt,"I want to add anvil in my rust project to make a fork of blockchain and make some operation with fork, how can i import anvil in rust project or how can i import foundry? I found foundry and anvil in crates, but its not true foundry. Hi guys! Is this a wrong cast syntax for abi decode? hi，sir，why ？ Just curious, do the rust bindings support vyper contracts? So when you run a script in foundry , it does the tx but reverts the changes such that when i query for the updated data it will show the pre-fork data or the pre-tx data, is this a configuration option on foundry or anvil ? to commit the tx. Is there a cli option, to persist the changes on the local fork ? I would like to ask if the address (contract). code obtained is the runtimecode or initcode, why is it different from remix's bytecode in the same contract Anyone have issues with verifying via-ir compiled contracts before? Having a hard time repro-ing with a minimal example, but I run into cases where some via-ir compiled contracts can't be verified, and making random changes results in being able to be verified e.g. changing the name of the file, or removing a few lines, or splitting the interfaces/libraries/contract code in different ways. It's really strange lol. If I don't use via-ir and instead just use the regular optimizer, there's no issue. I'm not sure whether it's a verifier issue, or something in foundry, or the compiler. Note I'm using tenderly for private verification with flattened files (it's for a private proj, setting up monitoring) hey guys, whos using nvim, what do u do with remappings? like is theres anyway to have them working like in vscode? I am using solidity lsp. Is the -C flag supposed to override the foundry.toml in forge build? It would be nice to use forge to only build specific files/folders. But currently the -C options is added to the src and test values from the config instead of replacing them. you have to set the src and test to some empty dir before that will work.",456
1872,foundry-support.txt,"I can make this change but curious if it is even wanted/needed sorry for that dumb following question : why this test pass ? postBalance should be slight less than preBalance + 1 ether cuz gas has been spended so it's not equal and it should fail, no ? (it's from the fuzzing testing doc) could I use custom string rather than with simple console.log? As I know there is no option to use it with logInt or logBool etc..Am I right? just use console.log it supports arguments and different types with overloading Has anyone ran into an issue where forge test will run properly, but forge coverage will fail with a very generic revert? Getting ERROR forge::runner: setUp failed reason=""EvmError: Revert"" contract=0x7fa9385be102ac3eac297483dd6233d62b3e1496 But only on running coverage, test passes as expected hey there, for some reason forge build is erroring with incompatible solidity version but it's failing for all lib contracts as well. could anyone help me here? not sure what's happening Did you forge install? yes current .toml [profile.default] src = ""src"" out = ""out"" libs = [""lib""] remappings = [""ds-test/=lib/forge-std/lib/ds-test/src/"", ""forge-std/=lib/forge-std/src/"", ""@openzeppelin/=lib/openzeppelin-contracts/"", ""@openzeppelin-upgradeable/=lib/openzeppelin-contracts-upgradeable/""] neither build or compile are working hey georgios, tried rebuilding the entire project from scratch: forge init forge install openzeppelin/openzeppelin-contracts OpenZeppelin/openzeppelin-contracts-upgradeable forge build same error hey georgios, just tried commenting out the entire file in test and it worked. Any reason why test would break it? How do you stop the OutOfGas error when the calls are succeeding? Hi, guys.",409
1873,foundry-support.txt,"How to make task factory for poll block litner in anvil, i init listner like this let anvil_provider = handle.http_provider(); let task_manager = handle.task_manager(); task_manager.spawn_block_poll_listener(anvil_provider, |block| print_block_number(block)); this is my task factory fn print_block_number(block: H256) -> impl Future<Output = ()> { println!(""New block received""); async move { println!(""New block received: {}"", block); } } Possibly one of your contacts has pragma for solidity earlier than 8.0 nope, try to console.log(""text"",anyBoolVariable); it gives error https://book.getfoundry.sh/reference/forge-std/console-log?highlight=console#console-logging Hi everyone main network hash: 0xf6c05902f94dbf93ca7d8b3f3ad379ed348e816075732af2ef4bfe8afc779ffd Corresponding block height 17135755 foundry fork main network Parameters --fork-block-number 17135754 In the fork's network running the same parameters as the main network, calling the seaport protocol, getting an error ([FAIL.",245
1874,foundry-support.txt,"Reason: InvalidSignature()] testMock() ( gas: 45257)) This is a problem I'm having and I don't understand why, can anyone give me an answer? Forge test command doesn’t run any test cases suddenly - was using command option —no-restart and now nothing works if I re run the command or just forge test how do I configure the remappings for these import { IERC20, SafeERC20 } from ""@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol""; import { OwnableUpgradeable } from ""@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol""; I tried @openzeppelin/contracts/=lib/openzeppelin/contracts/contracts @openzeppelin/contracts-upgradeable=lib/openzeppelin/contracts-upgradeable/contracts my lib folder has openzeppelin/contracts/contracts and openzeppelin/contracts-upgradeable/contracts nvm it was a typo in my remappings sorry Hey is there a way to change anvil's gas price *while* the node is running? Why gas is being spent by an EOA not Safe Thx bro ! Seems obvious now lol wceth, [Apr 27, 2023 at 21:47:48]: Foundry seems to have a bug because when I set the code for an address through VM. Etch, its call may have issues this is my code Don't do cross posting, I've already answered in the other chat Hello Foundry Team, First thank you very much for your work, I love your tools ! I'd like to ask you if you know project that test a library contract (not regular SC) with forge or if I can find some guidance somewhere ? If not just solid project using forge to get some inspiration and developed examples perfect. if no one is working on it, i can try to look into it this weekend none do there are no example, could you plz provide? I just need console.log (""I want this text here and show bool: "", boolVar); This will not work by default. In docs there are also no examples for bytes. I tried this: console.log(""%s is the bytes"", bytesVariable); or console.logBytes(""%s is the bytes"", bytesVariable); and too got error.",470
1875,foundry-support.txt,"Does anybody know how to use text + bool/bytesX ? how to re-run the same failed counterexample for invariants? having trouble getting cast to send txs using a ledger; anyone have a working example? command is cast send -r ""https://<RPC>"" -c <CHAIN_ID> -f ""0x<FROM_ADDR>"" -l --hd-path ""44'/60'/0'/0/0"" <TARGET> <CALLDATA> and getting code: -32000, message: unknown account is there a better way to deploy/cast instead of calling in cli or running an .sh script? Hello Team! thanks so much for Foundry! I have an issue I am hoping you might help with. I am currently running anvil as a background process on a docker containter. I have a forge script that I am using to try to fund several wallets which are not wallets configured by anvil. In the script I can do vm.deal and then can console out the balance but if I then run cast balance <wallet> from a command line the balance is zero. Can anyone explain to me what is going on? There is no other rpc setup so the only thing the script can be hitting is the anvil node. Disregard the above. I found a different way to do what I want to do. Has anyone ran into an issue where forge test will run properly, but forge coverage will fail with a very generic revert? Getting ERROR forge::runner: setUp failed reason=""EvmError: Revert"" contract=0x7fa9385be102ac3eac297483dd6233d62b3e1496 But only on running coverage, test passes as expected It'd be very appreciated if anyone could add logging support to forge coverage so I could see what is going on 🤔️ I was testing a contract by inherting it into the testing contract. Is this an anti-pattern? As the coverage reports show the tested functions as uncovered Has anyone else had troubles recently building foundry on mac m1? I'm getting the familiar libusb error, tho libusb is installed. I did recently have some issues with an old homebrew installation that came from an old backup. It was not arm.",461
1876,foundry-support.txt,"I uninstalled and reinstalled homebrew and reinstalled all my apps and tools, including libusb, but I now get ld: warning: ignoring file /opt/homebrew/Cellar/libusb/1.0.26/lib/libusb-1.0.dylib, building for macOS-x86_64 but attempting to link with file built for macOS-arm64 when trying to build from source, but i'm not sure where the architecture is getting mixed up. is foundry actually expecting an amd build of libusb? ld: symbol(s) not found for architecture x86_64   clang: error: linker command failed with exit code 1 (use -v to see invocation) this makes me think it does expect amd Huh - that’s odd. brew install libusb didn’t fix? nope unfortunately not, it was already installed i thought i might be able to work around it with the docker image, and i think i might be close, but getting an ssl error related to solc there unfortunately podman run --rm -v ""$PWD"":/home/test-contracts ghcr.io/foundry-rs/foundry:latest ""cd /home/test-contracts && forge create --private-key $PRIV_KEY Storage"" WARNING: image platform (linux/amd64) does not match the expected platform (linux/arm64) installing solc version ""0.8.19"" Failed to install solc 0.8.19: error sending request for url (https://binaries.soliditylang.org/linux-amd64/list.json): error trying to connect: invalid peer certificate contents: invalid peer certificate: UnknownIssuer Error: error sending request for url (https://binaries.soliditylang.org/linux-amd64/list.json): error trying to connect: invalid peer certificate contents: invalid peer certificate: UnknownIssuer Context: - Error #0: error trying to connect: invalid peer certificate contents: invalid peer certificate: UnknownIssuer - Error #1: invalid peer certificate contents: invalid peer certificate: UnknownIssuer ahh, https://github.com/foundry-rs/foundry/issues/3057 fwiw im not behind a proxy afaik but that's not related to not being able to build on m1. still not sure what i could do there.",467
1877,foundry-support.txt,"is there some way to force the build process to use an amd version of libusb? got it working! i ran rm /Users/blahblah/.cargo/bin/forge for forge and the rest, and then reinstalled via foundryup how can I get more detailed info on the failure? I am already using -vvvvv flag. But it’s still unclear where the code failed Index out of bound ? Can you check for that revert reason in your code? Or maybe you literally try to access an array out of its size rookie question, but I'm trying to run a test and the test continually cannot accesss my env variables. In the test all the variables are referenced by vm.env etc... I tried source .env so the variables are in the terminal, and also tried export for each variable in the .env file which then caused reverts in the test. I'm working with a cloned repo from a solid soure that I'm 99.99% is airtight so the error is on my end. I've been through the docs but so far now luck. Any insight would be appreciated, thanks! How come it can't provide a specific line number where the failure occured like in other languages? would be really helpful in debugging Would it be useful for the multicall contract to have a method that allows one to deploy multiple contracts in a single call? Then use this in forge-std/StdUtils.sol to create a new helper method that uses this? The motivation is that someone may want to deploy different types of contracts in one call? I could work on this if it makes sense. Not sure if the multicall people would find it useful? i want to create upgradable contract, there is a package named @openzeppelin/hardhat-upgrades for hardhat, what can i use in case of foundry? is it possible to deploy a contract in a script specifying the address of the external libraries? like hardhat await deploy(""TestContract"", { from: deployer, libraries: { TestLib: (await ethers.getContract(""TestLib"")).address } }); I know it's possible to add them to foundry.toml, but I would like to do it programmatically I need help here too. I am getting this error when deploying a contract in a script. It works when I create the contract in a test.",479
1878,foundry-support.txt,"the command I'm using forge script script/01_Deploy.s.sol:Deploy --rpc-url http://localhost:8545 --broadcast The application panicked (crashed). Message: called Option::unwrap() on a None value Location: /home/runner/work/foundry/foundry/cli/src/cmd/forge/script/executor.rs:48 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ BACKTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1: __libc_start_main<unknown> at /build/glibc-SzIz7B/glibc-2.31/csu/../csu/libc-start.c:308 Run with COLORBT_SHOW_HIDDEN=1 environment variable to disable frame filtering. Aborted (core dumped) I think it is related to the contract I'm deploying using external libraries Guys how can I log data about all the runs of the fuzzer? is it possible to do writeLine to foundry.toml? why don't u write the results to a file? string[] memory cmds = new string[](4); cmds[0] = ""echo""; cmds[1] = librariesInfo_; cmds[2] = "">>""; cmds[3] = ""../foundry.toml""; vm.ffi(cmds); Before being able to write the results to a file I need to right content, as of now it only shows the execution trace of the last executed fuzz run I'm forking mainnet and attempting to debug a transaction using cast, this specific contract has push0.",346
1879,foundry-support.txt,"Does foundry support this? it seems like push0 still isn't supported When deploying a contract using create2 from a foundry script, for the purpose of deploying to a known address, ie deploying a contract to the same address on multiple chains, eg:  function getAddress(   bytes memory bytecode,   uint _salt  ) public view returns (address) {   bytes32 hash = keccak256(    abi.encodePacked(bytes1(0xff), address(this), _salt, keccak256(bytecode))   );   // NOTE: cast last 20 bytes of hash to address   return address(uint160(uint(hash)));  } The above excerpt would be from a factory contract, I'm assuming the address(this) is just replaced by the EOA's address whose private key is used with startBroadcast, is that assumption correct? hi , can i install npm install @openzeppelin/cli in foundry project? For anyone who stumbles onto this, here's the issue addressing the question: https://github.com/foundry-rs/foundry/issues/4807 How would one call the anvil RPC methods inside tests (without forking), ie I want to use anvil_setCode to set the constant address deployer so contracts deployed in a non-forked env match contracts deployed in a forked env? how to use forge create --libraries with multiple libraries? I tried path:name:address path:name:address [path:name:address, path:name:address] ""path:name:address"" ""path:name:address"" https://book.getfoundry.sh/faq#how-do-i-use-consolelog I have the same issue, were you able to get this? you put the libraries into the config file and the command will read the config file in the repo inside foundry.toml you have libraries = [""..."", ""...""] flags that can take multiple values are all like this: --library value1 --library value2 ... or use config file yeah Will try the flags, don't want to use the config because I can't change it programmatically I can't believe you got 2 answers. I have never gotten an answer in here.",440
1880,foundry-support.txt,"congratulations ser Hahaha thank you both of you :) After setting ""FOUNDRY_FUZZ_RUNS"" to 10, I get this printout: proptest: Aborting shrinking after the PROPTEST_MAX_SHRINK_ITERS environment variable or ProptestConfig.max_shrink_iters iterations (set 32 to a large(r) value to shrink more; current configuration: 32 iterations) any ideas on what this is? How do I do a clean reset of the lib folder/forge dependencies, messed around with submodules and my forge install is broken is there any way to show the exact number for the code line which triggered the revert? Hey is there a way to fork the evm with the evm state and run scripts on that forked state using foundry cast but not actually deploy any smart contracts to mainnet? You can do that with forge script @gakonst got it so i would build a script sol file and I could deploy a contract on a fork of the evm and then send transactions to it? As in, this network would be a simulation of mainnet with all the data from mainnet and we could send a transaction to a live mainnet contract and see the output without the transaction actually being broadcasted to mainnet? If so, what config do we need to set in our script? anvil —fork-url <rpc_url> Then Forge script scripts/myscript.sol —rpc-url localhost:8545 —broadcast Will deploy to a local fork of whatever network your rpc url points to is there an option for anvil to do a “rolling fork”, as in the fork keeps up to date as upstream rpc sees new blocks? good morning when I try to do the command "" curl -L https://foundry.paradigm.xyz | bash "" I get the following: % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 0 0 0 0 0 0 0 0 --:--:-- 0:05:00 --:--:-- 0 curl: (28) SSL connection timeout I tried the command line with sudo, updated my curl and npm packages and still getting the same error :( Is the foundry tests gas usage wrong? I have this test which makes 300 tx on which each subsequent tx uses more gas than the previous one.",489
1881,foundry-support.txt,"On the test, the difference was approx 300-400 gas increase per tx, but I did the same on a testnet and the gas difference was 5k-12k gas increase on subsequent tx. What might be the reason? ^Using gasLeft() for recording gas values see warm vs cold accounts/storage... gas costs are calculated in one evm tx in a test rather than multiple tx live https://www.evm.codes/about#accesssets maybe too small? can you open an issue ""forge remove lib/*"" Ah so inside the test, the txs are not truly independent? So what's the best way to simulate a number of txs which will produce identical results as a live network (in terms of gas usage)? I have an internal lib that's not showing up in any of my coverage reports, but I'd like it to, any guidance here? Hi everyone! What’s the way to verify contract compiled via-ir? I checked the doc but I did not find anything and API calls are failing on etherscan. Doc: https://book.getfoundry.sh/reference/forge/forge-verify-contract It should work out of the box, maybe it's the optimization runs number, Etherscan API support it until a limit Guys how can configure multiple solidity compiler in my project? Hmm I though having set the correct optimization runs number but it’s perhaps that I’ll retry, thx Any way to do the equivalent of anvil_setCode from inside tests without having to deploy the constant address deployer for using CREATE2? No, AFAIK. But this sounds like a great candidate for a new helper function in Forge Std Thanks @PaulRBerg I'm trying to make it work with vm.etch but yes, agreed, will create an issue tests don't seem to make the call to the deterministic-deployer-proxy, which I suppose makes sense given that the anvil node doesn't have it deployed by default @PaulRBerg any thoughts on how to replicate the behaviour in a local test? I'm specifically trying to ensure a UUPS proxy's address is constant, which creates a challenge with etching the proxy address directly to the known address, as teh implementation doesn't recognize the forced address as teh initializer. I suppose I can modify the storage of the implementation directly, but that feels a bit too hacky.",477
1882,foundry-support.txt,"hi i can't understand how to use this: https://github.com/odyslam/foundry-upgrades in my project. I need some help. What's the right way to debug Huff contracts with Foundry? I've got a deploy script but can't get any of the debug functions to work on the Huff contract itself Really trying to avoid dealing with hevm / nix 😅 It seems that PUSH0 doesn't work yet in foundry, is there a hack to get it working? Stepping through my code using the foundry debugger brings me to the PUSH0 instruction which reverts and is displayed as UNDEFINED (0x5f) in the TUI Thanks so much. This is super helpful!! this https://github.com/sambacha/zen-foundry-template Why? Ser i can assist you with your nix apprehension is there a better way to deploy/cast instead of calling in cli or running an .sh script? Running it on javascript or python for example all of them are generally inadequate unless they track and keep some notion of chain state to track progress Got it, thanks! Why does Foundry's test function not work? I confirmed that the file path is completely correct. After my investigation, I found that it will not work when I deploy the contract on line 60. Annotate it and it will work normally which extension gives you “ftrace” and “funcSig” ? hi guys Solidity Visual Developer is it possible to use strings as inputs in fuzz tests? i fkn love it ^^ maybe try rename with .t.sol ? Something's wrong with the pattern you gave Nice. Will try it seems like each run it just inputs an empty string It should work afaik, maybe try with bytes32 and cast it to a string ? good idea! u sure im supposed to get non-empty string as inputs? (it’s my first test in foundry mby am missing smth) my pattern is this is what Valid for other test files in the same folder Is it a bug gm guys how do i send a pre-1559 call via cast? nvm lol, just add --legacy can anyone help me why it shows this error whenever i try to add another library i tried running forge install Openzeppelin/openzeppelin-contracts do —no—commit you can do forge install no-commit flag hey guys! I have been working on a new protocol that has a decent amount of math involved.",499
1883,foundry-support.txt,"We first created the code in python and have some test inputs we would like to run and then check how far off solidity is from the real values calculated in python. Is there an easy way for me to take inputs on a csv or some file and then send them through as a preset fuz test or should I just use hardhat and or a ts file? thanks for taking a look at this in advance! this should help you out if you haven’t seen it https://book.getfoundry.sh/forge/differential-ffi-testing Hi, question about deploying and verifying contracts -- for some reason when I run a script to deploy and verify a contract I keep getting Details: `Fail - Unable to verify. Unable to locate a contract with the name 'Contract.sol:Contract.0.8.17'... it was working before but for some reason it now includes the compiler version in the contract name and it doesn't verify it. Any clue what's going on here? Small update: this solution solves my issue https://github.com/foundry-rs/foundry/issues/3507#issuecomment-1465382107 Hmm I'm not sure if this is the same issue I'm having. I'm able to verify the contract just fine with the verify-contract command, the issue I'm having is that I want to deploy and verify with one command, and that's what's breaking. I'm running forge script Deploy.sol --verify --etherscan-api-key ${KEY} --broadcast the deploy works fine but the verification step breaks. Ah it was an answer to an issue I faced sorry (not related to yours) Getting “Can’t remove recursively without -r” how do i tell foundry to skip a contract from compilation forge build has a --skip flag that can be used to skip certain directories i'd just throw the contracts in script/ and skip it hmm, ill look around a bit more not sure how i feel about having to move files around, its mainly to do with certain deps that dont play well with forge that i dont really care about Sure theres a way to just specify certain files sg. if they're deps it could also be a setup issue, submodules can be weird at times Its literally because the deps have hardhat/console.sol lol hmm i think i've had some deps with hardhat/console.sol compile fine.",476
1884,foundry-support.txt,"unrelated: why would someone push code with hardhat/console.sol to prod Ask gmx Hate that codebase big oof Could anyone tell me why this test is failing? https://ethereum.stackexchange.com/questions/149686/why-my-test-is-failing-here How much memory can I allocate in a test? Running into a MemoryLimitOOG error. what's the preferred way to load environment variables in a test? Having a tough time, I've tried source .env, and they load in the terminal, but still not found in the test. I don't see any thing on forge coverage in the foundry book. Is there a way to configure that command to only run against certain contracts? Hello guys Is it just me or does invariant tests sometimes reset block.timespamp to 1? Mid way through a set of calls, in-between calling different functions Anyone getting this on forge update lib/forge-std? Unable to find refs/remotes/origin/v1.3.0 revision in submodule path 'lib/forge-std' I am seeing a lot of precompiles being used in fuzz/invariant tests thats breaking the tests. How do I handle them? Is this on fresh clone? It shouldn’t…@lucasmanuel_eth didn’t you have a process for this? Hm yeah we do call out to precompiles I believe in invariants, the solution is to use the targetContracts function from forge-std to scope down the invariant test No. an existing project/repo I am using targetContract() to scope it down to a single handler contract. its the msg.sender thats beeing fuzzed with precompiles.",337
1885,foundry-support.txt,"you could also just import the specific function from whta path? import ""forge-std/console2.sol""; console2.log(""foo""); no need to inherit check remappings hi anybody worked on on-chain oracle aggregator for dex like uniswap v2, v3? Why do hackers like to create sub-contracts in attack contracts?😿 Hi, I'm trying to install Foundry on Ubuntu 22.04 but still got this error, I searched but couldn't find similar error, I tried adding the permissions to the file but the problem persists (also with sudo). Someone would have any idea ? Hey all, I am trying to build foundry from sources (e15e33a) but got this at installing anvil error[E0063]: missing fields `withdrawals` and `withdrawals_root` in initializer of `ethers::types::Block<_>`  --> anvil/src/eth/backend/mem/mod.rs:1421:9  | 1421 |   EthersBlock {  |   ^^^^^^^^^^^ missing `withdrawals` and `withdrawals_root` I can build and execute forge binaries but they also fail when running invariants with Compiler run successful! The application panicked (crashed). Message: Unsupported EVM version Location: cli/src/utils.rs:93 Pretty sure something wrong with local deps but cannot figure out what.",278
1886,foundry-support.txt,"thanks! looks like I am good with invariant testing if exporting FOUNDRY_EVM_VERSION = london env var, all good! is it possible that for some reason its not a part of the CommonBase interface? Is there are way to ignore certain dirs, or exclude them when running forge coverage? I usually do this and look at the report through the browser: forge coverage --report lcov && genhtml lcov.info -o report --branch-coverage && open report/index.html Thanks @jonwalch I'm already using lcov and genhtml, I'd just prefer my scripts and mocks to not show up in the coverage report So far adding function testMock() public {} to the files tricks coverage into skipping them, but this isn't ideal how is RETH development going? I'm trying to install a tagged dependency like this: $ forge install OpenZeppelin/openzeppelin-contracts@91df66c Installing openzeppelin-contracts in "".../lib/openzeppelin-contracts"" (url: Some(""https://github.com/OpenZeppelin/openzeppelin-contracts""), tag: Some(""91df66c"")) Installed openzeppelin-contracts 91df66c But then in the .gitmodules: [submodule ""lib/openzeppelin-contracts""] path = lib/openzeppelin-contracts url = https://github.com/OpenZeppelin/openzeppelin-contracts there's no branch tag. Why is this? Same issue with full 91df66c4a9dfd0425ff923cbeb3a20155f1355ea I think this is a bug but I just ran foundryup and updated to the latest std release. Now when I try to run my previously working deployment scripts I get this error: error: the following required arguments were not provided: --mnemonics <MNEMONICS> Usage: forge script --mnemonics <MNEMONICS> --sig <SIG> --fork-url <URL> --verbosity... --etherscan-api-key <KEY> --chain-id <CHAIN_ID> --sender <ADDRESS> --ledger --mnemonic-indexes <INDEXES> <PATH> <ARGS>... But I am using a ledger to deploy with a mnemonic-indexes flag instead. If I pass a random value to --mnemonics the error goes away.",472
1887,foundry-support.txt,"Thinking it got made required on accident somewhere along the line did anyone ever run the evm in a serverless function? could it be possible? Hey! Is it possible to delete default remapping? I want to have only my custom openzeppelin remapping but the default openzeppelin-contracts/ one is always there making my IDE (webstorm) crazy when I want to auto import something Is it possible to simulate cold reads on a test in forge. during my setup everything becomes warm and gas simulations are not accurate Anyone have any idea why this random uint used to create a user is beating access control checks?  function testModifyingRolesAsNonAdminShouldFail(uint256 userInt) public {   address randomUser = address(uint160(468540023040117917654238950118803614772621961961));   vm.startPrank(randomUser);   vm.expectRevert();   wrappedRegistryProxyV1.grantRole(KEY_MANAGER_ROLE, randomUser);   vm.stopPrank();  } should revert but doesn't... So something interesting is that foundry appears to use known addresses, and evidently their Uint equivalents, as input values when fuzzing. The uint above generates the same address as makeAddr(""admin""). @gakonst @msolomon4 is this the case? yea, the fuzzer dictionary treats all values as bytes32, regardless of their solidity type Good to know, thank you ser is there a good way to recover a multi tx deployment within a script? i was hoping to retry the step but it says the nonce has changed Why do hackers like to create sub-contracts in attack contracts?😿 I use env variables, eg. VARIABLE=xyz forge script ...",349
1888,foundry-support.txt,"hi guys is it possible to change the bytecode at a certain contract address? using cheatcodes Hi guys i am new check vm.etch https://book.getfoundry.sh/cheatcodes/etch ty! another question ` // Check that they cannot blacklist each other vm.startPrank(address(1)); vm.expectRevert(); console.log(""Message Sender"", msg.sender, address(1)); vaultContract.blacklist(address(3)); ` ` Logs: Message Sender 0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38 0x0000000000000000000000000000000000000001 ` why is msg sender not being swapped out for address(1)? you may want to log msg.sender in your contract not in test mb yea i had some logic not working, thanks! Hi there, doc on writeJson says « Note that the JSON path must indicate an existing key, so it's not possible to add new keys this way. » So what are the other ways to add a key to an existing json file ? (without knowing it’s structure) Is there any way to set a timeout for how long a foundry script waits for a TX receipt? On some chains my script can hang forever because for whatever reason the RPC never sends a receipt. hi guys ` // Reward ourselves with some 100 tokens vm.deal(address(vaultContract.DEPOSIT_TOKEN()), 100 * 10 ** 18); // Assert that we must have 100 tokens assertEq( vaultContract.DEPOSIT_TOKEN().balanceOf(address(this)), 100 * 10 ** 18, ""vm.deal() did not reward"" ); ` any idea why this is not working? Not upping the token balance i will send screenshot instead 1s thats the code actually i missed adding the receiver address lol, but seems like when. iadd it another error occurs i mean it seems like it should be working, but it dont looks like 2nd param is not an address? It is It is the test contract’s address like address(this)? Yes I see, never tried to deal to test address so not sure if works.",449
1889,foundry-support.txt,"You could try to remove the vm and leave only deal( let me try - isnt it supposed to be the standard usecase of deal() tho? deal() works plainly, tho! I ussualy have actors like address bob = makeAddr('bob') and deal to them then prank Bob and send txes on its behalf vm.deal() is for dealing ether and deal() alone is for token ahhhh okay okay makes sense why is that tho? How to update dependencies? I am trying forge update lib/openzeppelin-contracts/ but getting: Error: fatal: Needed a single revision fatal: Unable to find current origin/v4.8.2 revision in submodule path 'lib/openzeppelin-contracts' Well in the usual test case scenario involving several actors you get a nice Bob label in traces so you always know who is who. In your case is ExecutionTest How do you encode a revert? vm.mockCall( address(baseRewardPool), abi.encodeWithSelector(baseRewardPool.getReward.selector, address(this), true), abi.encode(""revert"")); (doesn't work) you can do vm.expectRevert(abi.encodeWithSignature('CustomError(uint256,address)', 11, address(this))) Ah, I'm trying to set off a try/catch block like this try rewardPool.getReward(account, true) { } catch { return false; } @gniculae oh, I guess a mockCallRevert weird error[9582]: TypeError: Member ""mockCallRevert"" not found or not visible after argument-dependent lookup in contract Vm. hi guys how can i mine blocks within a foundry test you can setup up anvil and boradcast transactions locally using forge script, blocks will be mined automatically for tests you have vm.roll cheatcode does foundryup not have the latest vm.sol? nm, I was behind on the repo hi, is it a bad practice to call test functions from within other test functions? ` testDeposit() { } testStrategy() { testDeposit(); // … } testWithdrawals() { testStrategy(); // … } ` I use this pattern regularly for easy custom setUp(), not sure if its bad practice are there any good patterns for using forge from the FE to simulate txns? tutorials etc Is there a way to access memory of a function? hi. i am trying to understand how reentrancy mode works in foundry's invariant testing, when setting call_override to true .",499
1890,foundry-support.txt,"It seems there is an inconsistency between the comments and the code : https://github.com/foundry-rs/foundry/blob/e8074297c48eb4343965ca804ef551d10d7b8e72/evm/src/fuzz/invariant/call_override.rs#L33 comment says ""original_caller has a 80% chance of being the new_target."" but in the code i see ""let strategy = weighted(0.9, strategy).sboxed();"" I am not fluent in Rust but it seems correct comment should be 90% instead of 80% chance what is the default chain-id for the local foundry chain 31337 Hey guys does any body know how I can add foundry to an AWS lambda function's layer. I am working on automating the deployment of a smart contract based on a user action. Trying to verify a deployed contrct with forge verify-contract.. Getting this error for the compiler version error: Found argument 'v0.8.13+commit.abaa5c0e' which wasn't expected, or isn't valid in this context havent tried sorry, should be possible though, what’s the error? following this example template https://book.getfoundry.sh/forge/deploying but leaving out constructor args And it seems there are multiple conflictions in the verify-contract command from what I can see with the CLI @gakonst is there a way to emulate using the constant address deployer proxy in tests that foundry uses under the hood? Would etching the proxy's address and doing a raw call with a contract's init code achieve the same thing? Can one access the init code for the contract using foundry? type(C).creationCode re: your last q you can vm.prank always but pranking won't help me in this instance, unless i'm misunderstanding.",383
1891,foundry-support.txt,"I want to make sure the contracts deployed during tests are at the same address they're deployed to mainnet, using:   // we use the CONSTANT_ADDRESS_DEPLOYER as the deployer contract that iniates CREATE2, which is used by forge as default   bytes32 addressHash = keccak256(abi.encodePacked(bytes1(0xff), CONSTANT_ADDRESS_DEPLOYER, _salt, bytecodeHash));   // cast the last 20 bytes of the hash to an address   predicted = address(uint160(uint256(addressHash))); to do this, the CONSTANT_ADDRESS_DEPLOYER needs to be the contract responsible for deploying... or are you saying I can just vm.prank(CONSTANT_ADDRESS_DEPLOYER) and use new Contract{salt: _salt}(...args)? Yeah that’s wht I’m saying Thanks 🙏 That'll effect the msg.sender in the deployed contract's constructor, unless I'm mistaken. so if teh contract's constructor contains owner = msg.sender, then the CONSTANT_ADDRESS_DEPLOYER becomes the owner, whereas this behaviour is bypassed in the proxy because of delegatecall. Is there a way to console.log without consuming gas? Any fix? Also getting this ‘(Code: -32000, message: replacement transaction underpriced, data: None)’ quite often Is there any way to make forge not wait for a TX receipt after running a script? Not that I remember but we could I'm writing a forge script where there is a startBroadcast, followed by two separate contract deployments, then a stopBroadcast. Running it with --broadcast and --verify only seems to verify only the last contract to be deployed, despite both being included in the transaction traces. Any idea how to fix this? Just solved this ^ by deleting /out directory this makes it pretty difficult to debug something that's very dependent on gas context. I'll have to try the debugger for this, skipping through the source code... I have a an ever growing list of sec and test files.",406
1892,foundry-support.txt,"When I deploy a particular script, how can I make it so it only compiles relevant files rather than everything foundry crashing on an Unsupported EVM version is there a branch of forge-std that currently supports 0.8.19? I could be wrong, but I think the latest does support 0.8.17 - maybe try updating? (if you're running from CI, you might need to update submodules too if you're using forge-std, at least if I'm understanding the code correctly, which is far from guaranteed) worked for me by exporting FOUNDRY_EVM_VERSION=london ah, it's EVM version, not Solidity version, I wasn't paying attention yeah, interesting I only hit this if building from sources, when foundryup not needed so probably I am missing something on build did you export this in foundry.toml? Foundry Support no, in the .env file FOUNDRY_EVM_VERSION = london or you could just export FOUNDRY_EVM_VERSION=london may have something to do with the odd update.... this worked, thanks! yeah, could be, seen that too maybe I'll put this a different way, since I'm not so familiar with CI - if my team wants to work with Solidity 0.8.19, will the CI for forge-std always fail? I'm worried that it will, since in the current forge-std it uses 0.8.17 to benchmark —via-ir and uses if: always() I'm being told that this will cause a fail, so I guess the old q of if there's a branch that supports 0.8.19 is the real q here I don't see why to fail, if your contracts use Solidity 0.8.19 and forge-std lib use a lower version than compiling with 0.8.19 should work...",391
1893,foundry-support.txt,"could get your q wrong though there are lines in forge-std's CI that I'm worried will fail, but now realizing I might be making a mistake thinking that its CI gets triggered at all I am trying to deploy Aave v3's Pool.sol using Anvil and no matter what I do, I always run out of gas E Revert reason: EVM error OutOfGas E Solidity stack trace: E CREATE: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512 I have already tried `--disable-block-gas-limit --code-size-limit 999999"" any other ideas welcome Transaction: 0x178df463c688a9a54da8bd2de7e902cd47667f33b2beee3ad34717b29c25b3ad Contract created: 0xe7f1725e7734ce288f8367e1bb143e90bb3f0512 Gas used: 30000000 Error: ran out of gas The contract is large, the constructor only sets one variable, so I suspect this is something to do with the code size and anvil just a guess but maybe https://book.getfoundry.sh/reference/config/testing?#gas_limit could help? `--disable-block-gas-limit` should go around that, no? oh, yeah, that's for anvil error: the argument '--gas-limit <GAS_LIMIT>' cannot be used with '--disable-block-gas-limit' that's a foundry.toml config nm, got it wrong, looks like they cannot go together thank you let me try to poke it and see if I can find other hints Would a Solidity contract deployment fail if it refers to libraries that have a different address/not exist on a chain? What's the best way to provide dynamic input to a deploy script in foundry? I have a json file which have a couple of contracts deployed on different chains. So when running the deploy script, I want to access the corresponding contract address for the chain I'm trying to deploy to and give that as input params There's a couple of cheatcodes that allow you to read from env/JSON gm.",457
1894,foundry-support.txt,"Is it just me or when I deploy using forge create on a different chain sometimes it doesn't do a good fee estimation so it never goes through? Specifically on gnosis but happened to me on different chains too 🙁 And then, if I try to re-deploy I get ""AlreadyKnown"" so I'm kidna stuck Sometimes I also get (code: -32010, message: FeeTooLowToCompete, data: None) straight away... I'm using standar config here forge create --rpc-url https://rpc.gnosis.gateway.fm --interactive packages/contracts/src/OrderFactory.sol:OrderFactory Have the same problem with ""EvmError: NotActivated"" when try to call one of methods of external contract on BSC Mainnet. Other methods of the same contract are invoked without any issues. I've tried multiple providers but always got the error. Does anyone have any suggestions how to solve the issue? ideas to console.log scaled uint amounts as formatted decimals? for human readability in a similar way to ethers.utils.parseEther() What for? For better dev flow, sharing reports using console log output..etc it could be done with ffi but if enough people agrees to this one could contrib a cheatcode that does exactly this It's possible with some math...",259
1895,foundry-support.txt,"try this https://gist.github.com/NelsonGaldeman/a65f8105ebd7bc1ad2ce92b8f9c370a9 thanks, looking into it interesting, value/base.value%base would console.log(""%i.%i"", value/base, value%base) work? It's assuming base is 10**18 which might not be the case, you can add a param to set that up It does on hardhat, not sure on foundry but you can update it accordingly I think it should and could be a 1 liner is there a way to figure out why i'm getting a call exception from anvil? like at least show me some debug trace so i know why the tx is failing? In our case we moved back to HardHat cause we needed to call a function that changes the state using static call and apparently this is not possible right now using Foundry has anyone been able to export anvil txs to tenderly? how can you change state with a staticcall? is reth working yet? there are different levels of verbosity set by the option -vvvvv For anvil also? The transactions are being sent from an ethers script, not from forge Do your contracts recompile each time you do forge test? Did you find a solution? Nobody ever answered my messages My solution was turning off autosave and pray 😅 Also switched to neovim because it has slightly better autocompletion and linting compared to vs code and that helps to reduce the number of times I need to recompile But it would be amazing if a core dev could have a look at this It would literally save me hours I mean either I'm such a noob that I don't get how the AST is checked for recompile or there's something wrong Sorry about the rant but I literally have to take breaks of 2+ minutes every time it recompiles making me lose focus That's literally what everybody is doing here darling Nah I am fully aligned. its so annoying Clearing up the unrelated stuff - this was pretty funny tho Sorry I missed this.",425
1896,foundry-support.txt,"I would love an issue with steps to repro, otherwise it's hard for us to investigate I used to also suffer from this light version of ADHD, until I added a lite profile for local development: [profile.lite] optimizer = false via_ir = false You can then use smth like direnv to set $FOUNDRY_PROFILE to ""lite"" locally Oh shit, are you telling me all this is the optimizer's fault? That's the thing, it's really hard to reproduce. Especially because I'm not legally allowed to share the code I'm writing. Plus it's really inconsistent, it just happens randomly (or at least it seems like it). I'll try Paul's fix and I'll let you guys know! possibly There is no way to pass variables to a solidity script via terminal right? For example if I wrote and generalised script and wanted to use it with different inputs? So Anvil is nice and has eth_getProof, which seems to just forward along the RPC call if a fork was done. For queries of blocks after the fork, it errors out, and the stateRoot in the block data structure is empty. Is there anything I'm doing wrong, such as other settings I can use to allow things like eth_getProof to work? is there a cast command that can simulate a call / sendTx and prints a trace? i know of cast run, but it’s only for published tx Was curious if anyone knows why I'm getting EVMError: Revert from a PRECOMPILE::ecrecover. For some context, I'm testing a library I also never use ecrecover, so I'm a bit confused execute the tx against a fork? yup but from cast you can use cast run on a forked tx only published tx looking to provide calldata / params like a cast call/send but with a trace afaik neither have traces error[9574]: TypeError: Type bytes32[2] memory is not implicitly convertible to expected type bytes32[] memory.",408
1897,foundry-support.txt,"is there any way to get around this? i've tried some of the things i've seen in the chat here searching but none of it seems to work  bytes32[] memory proof = [  bytes32(   0xdc62a78f1acbc9613072ce1b6a6ee71ec75cd350bbbe25770972408d1e4dd293  ),  bytes32(   0xad057f3614192d23d41f54cdc0e83366c8d28ed3f1244de0c38a1616614e189a  )  ]; tried this to no avail, the input is bytes32[] memory proof for providing a merkle proof isn't it a solidity error? It clearly says that a static array cannot be converted to a dynamic array in memory? well regardless of the root, i'm just interested in the resolution since i'm unable to figure it out lol i can't explicitly say the length of the proof as its unknown and depends on the input size of the data which was included in the merkle tree Try to do the same with the storage dynamic one.",238
1898,foundry-support.txt,"Afaik, it should lack that error Push the elements individually  bytes32 e1 = bytes32(  0xdc62a78f1acbc9613072ce1b6a6ee71ec75cd350bbbe25770972408d1e4dd293  );  bytes32 e2 = bytes32(  0xad057f3614192d23d41f54cdc0e83366c8d28ed3f1244de0c38a1616614e189a  );  bytes32[] memory proof = [e1, e2]; sorry, excuse my slow brain :/ is this what you mean or how? it didn't work :/ or how do you mean? not really used to messing around w/ these so apologies either you do bytes32[2] memory proof = [e1, e2]; or bytes32[] memory proof; proof.push(e1); proof.push(e2); Man, remember when foundry tests were fast? 😂️️️️️️ Maybe my tests are just too complex...even without fuzzing or anything extra, even running on a mac studio desktop it takes a long long time > Man, remember when foundry tests were fast? so triggered 😄 What test caused this? Obviously shouldn’t be happening 🙂 Oh it's just a bunch of tests. It's just grown longer and longer as I write more tests. It's forked mainnet. But this hasn't been a suddenly thing.",312
1899,foundry-support.txt,"Though a recent jump from 150 seconds to >300 has been a recent development 🙁 Compiling also takes about 2 minutes (but I have my compiler settings cranked way up) Can foundry generate same coverage report as hardhat does? I am only able to generate lcov report, but I can't preview it line-by-line oh nice i see the answer, it helps in forge verify command, how to set the etherscan api key Either do --etherscan-api-key or set an environment var called ETHERSCAN_API_KEY with your key thanks np! what do i do if my terminal is too small to see all the traces of a test? Reduce the font? works! 😄 Hey guys, got another issue if u dont mind ` address Bob = address(1); vm.etch(Bob, address(this).code); ExecutionTest(Bob).setUp(); ExecutionTest(Bob).setVaultContract(vaultContract); console.log(address(ExecutionTest(address(Bob)).vaultContract())); ` for some reason, this does not work it errors out when i try to call vaultContract() on Bob so the code has not been copied successfully Try runtime bytecode Instead of code howd i access that?"" isnt .code returning runtime bytecode tho? thats what it showsi n the docs also https://docs.soliditylang.org/en/latest/cheatsheet.html#type-information i dont understand what is the argument im supposed to put in there instead of C? Contract name Circular reference to contract bytecode either via ""new"" or ""type(...).creationCode"" / ""type(...).runtimeCode"".solidity(7813) getting that when i do vm.etch(Bob, type(ExecutionTest).runtimeCode); Do you want to get the bytecode of the contract you are in? Why? yeap Because i want to have another contract make the same operations as i do, without having to duplicate the code. also am assuming it will be also “safe” as i have the assertions in place. Try making two other contracts that inherit from this one.",421
1900,foundry-support.txt,"They will have the same logic wait, why? You're trying to etch the bytecode to the first address, and it's precompiled for ecrecover try to make Bob's address greater than 10 https://t.me/foundry_support/36575 hello, trying to: forge create ./src/SimpleERC.sol:SimpleERC --rpc-url 'https://eth-goerli.g.alchemy.com/v2/'${ALCHEMY_ETH_GOERLI} --private-key ${PRIVATE_KEY} --force --constructor-args ""SimpleERC"" ""SERC"" with very simple contract: // SPDX-License-Identifier: UNLICENSED pragma solidity 0.8.18; import ""@openzeppelin/contracts/token/ERC20/ERC20.sol""; contract SimpleERC is ERC20 {  constructor() ERC20(""SimpleERC"", ""SERC"") {   _mint(msg.sender, 100 * 10 ** decimals());  } } and I am getting (code: -32000, message: gas required exceeds allowance (117094), data: None) what could be the reason? hey guys, in cast, how do i add negative integers as arguments` i.e. int256? when i try to add a negative integer such -1000, it tries to parse it as an argument: ``` error: Found argument '-1' which wasn't expected, or isn't valid in this context If you tried to supply `-1` as a value rather than a flag, use `-- -1` USAGE: cast send [OPTIONS] <TO> [ARGS] For more information try --help ``` example input: ``` cast send --from $LUCKY_USER 0x5777d92f208679db4b9778590fa3cab3ac9e2168 ""swap(address, bool, int256, uint160, bytes)(int256, int256)"" $LUCKY_USER false -10000 79227380255040869847366 """" ``` There are some contracts on ETH that have the same vulnerabilities like Hunred Finance‘s. How did hackers find these vulnerabilities contracts? They uses autotools same as peckshield autotools? is it possible to get the raw memory stack at a certain execution point in tests? 🙏 Does anyone know if there's a way to get a short signature from vm.sign() ? By default it returns v, r and s separately.",492
1901,foundry-support.txt,"I need to test an API that expects a signature with vs short signature fields. If vm.sign() doesn't support that, any other recommendations to get those? wdym by a “short” signature? vs combined This API here expects vs https://docs.openzeppelin.com/contracts/4.x/api/utils#ECDSA-tryRecover-bytes32-bytes32-bytes32- I have r and v and s but not sure how to get to vs I see that it does   bytes32 s = vs & bytes32(0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff);   uint8 v = uint8((uint256(vs) >> 255) + 27);   return tryRecover(hash, v, r, s); But not sure how to reverse that bytes.concat(v,s) ? i mean, is vs just v + s concatinated? if it is then i guess a complete example would be (assuming they are all returned w 32 byte padding) ` bytes.concat(bytes1(v), bytes32(s)) ` or if there’s no additional padding then just do this okay will try that, thanks! Actually, where does bytes come from? v is uint8 uint8 / bytes1 are implicitly convertiable what type is vs supposed to be? bytes ? or bytes32? bytes32 wait thats a bit weird, isnt s by itself 32 bytes long? I know but that's what recover() takes https://docs.openzeppelin.com/contracts/4.x/api/utils#ECDSA-recover-bytes32-bytes32-bytes32- ethers has a solution to that with splitSignature Need to read the source more to understand what's going on there, but here's what they do: https://github.com/ethers-io/ethers.js/blob/master/packages/bytes/src.ts/index.ts#L381 What is the default chain id on anvil if i don't specify any? I am unable to send a tx via metamask due to invalid chain id I have a an ever growing list of sec and test files. When I deploy a particular script, how can I make it so it only compiles relevant files rather than everything 31337 --target-contract contract_name The name of the contract you want to run.",462
1902,foundry-support.txt,"yea i mean they are just slicing an existing sig there Does anyone have any instructions on how to set max gas for a contract deployment using a forge script? I don't see any parameters like --gas-price or --priority-gas-price I think you can set them through env variables @gakonst @mattsse spam 👆 found --with-gas-price $gasPrice works, but don't see priority Sorry for the late response, had to take care of a bunch of things. So coming back to this.. I'm still not sure how to get to vs Do you know how to do it in solidity? Hey, is deal for ERC20 tokens balance still supported? It's still in the docs but I cannot find it anywhere in the code Didn't know deal() would work on ERC20. I'd just put up a mock ERC20 contract and transfer tokens a la  address bob = makeAddr(""bob"");  mock.transfer(bob, 10000); At least that's what I found in the book https://book.getfoundry.sh/cheatcodes/#cheatcodes-interface normally I'd use same ERC20 but wanted to test out deal this time but apparently it's no longer in the VM.sol contract why does console.log only let you log 4 things Does anyone know of a a good article about how to perform integration testing with foundry? I understand unit testing, that is clear, but I specifically want to run a series of tests that each relies on the previous having made persistent changes to a testnet chain like Sepolia etc. I can’t write to a file even after setting fs perms Ban Yep sorry Whars the repro? Can you open an issue in ethers rs? This is where we need to add these Running on mac osx, I have a make command that runs my forked environment tests. It's been working fine. I did a foundryup today & started getting an error: Error: cannot install provided ErrorHook, a hook has already been installed Location:  cli/src/handler.rs:70:13 make: *** [test_trace] Error 1 It still works correctly when i do a forge test ... But I hadn't made any other changes to the system.",453
1903,foundry-support.txt,"What is the make command? Using std json I’m getting “type bytes memory is not implcitly convertible to expected type string memory” @ string memory path=string.concat(root, “deployments.json”) They're commands I've been using since I started using foundry. So it's never thrown an error like this before until the most recent foundryup today. Here's a couple examples: When it gives the error, I can just copy pasta the command it shows is running with all the values pulled from environment & it runs fine. Like, run make test_trace --> error --> copy paste the command it shows is running --> tests run fine Like that Make sure you use “.key” not “key” folks, I'm having this problem for weeks where my gas snapshot differes from other people's and github ci's. I don't see any config being different and I don't have any additional files that are not in the repo. Any idea where I should look? I'm on macos. Btw it's only fuzz tests that have slightly off gas usage Is there a config on cmd to disable showing warnings at compiling? Tks this is extremely interesting, did you made progress on it? are you intending to pay for the gas yourself? guys hope you all are doing good i want to import .env file in toml like i dont want to expose keys, rpc url in toml file. how can i do that? just define .env file and put `ETH_RPC_URL=your_url or any other foundry var Is there a way to run a Foundry test against multiple chains at once? Or like sequentially but in one command? ok than how to call that eth rpc url during forking mainnet vm.createSelectFork(vm.envString(""ETH_RPC_URL"")); anvil --fork-url $RPC_MAINNET --fork-chain-id 137 --fork-block-number 17194050 like this? Put rpc_endpoints = { MAINNET = ""${MAINNET_RPC}"" } in foundry.toml and just use vm.createSelectFork(MAINNET); vm.createSelectFork(MAINNET); where to use this line? At the start of setUp so to fork do i need to create script No. Not just to test but i want it run in background @Sabnock just ran forge script to estimate deployment costs on Goerli.",480
1904,foundry-support.txt,"Tells me: Estimated amount required: 27.045753429697823241 ETH same deployment on ETH is estimated with 2.56 ETH are the gas costs on goerli really that high right now? Edit: apparently yes, according to owlracle.info Must be the pepe hype, lots of newbie devs trying to jump in can someone please tell me how i get rid of this frge-std in my changes cant install new dependecies cuz of it and its driving me nuts nothing would takie this crap off maybe try updating submodules? git submodule update --init --recursive Is it possible to run the debugger while fuzzing? small bug: forge test -vvv trace displays the wrong precompile name (it should show sha256, not keccak for [72], visible on line 457 of code) Sup with the --mnemonics option when running forge script with a ledger? Putting random values there makes it work, but its a required option Can someone please help me install Foundry on Windows, it seems so long. I really want to start using it for auditing. can you load foundry artifacts with ethers-js or they are a different format? uhm MemoryLimitOOG wtf is this guys? getting this whilst running tests you are allocating a ton of evm memory - normally this can’t happen on a real chain but we bump the gas limit super high such that we have to place a limit on the amount of evm memory.",301
1905,foundry-support.txt,"the fix is to adjust the maximum memory in your foundry toml or you have a bug in your code that continually allocates memory without stopping ooo ok! what proprety do i change in the foundry toml for that? unlikely because they were working perfectly before i made some changes, which shouldnt be doing it i forget what it’s called off the top of my head just search on book.getfoundry.sh for memory and click the config one it can see the traces just stopping mid strategy run randomly with this exception sweet, lemme look - thanks! or lookup this https://github.com/foundry-rs/foundry/blob/master/config/README.md#default-profile memory_limit = 33554432 ty ser what should i set it to? even trippeling that gives me the error then you probably have a bug imo is it possible that its related to gas limit ? MemoryOOG is running out of memory iirc i could be wrong tho make sure you’re on latest foundry version what does the number in brackets to the left of the function calls mean in the traces? confirmed MemoryLimitOOG is based on the configured memory_limit dunno what you mean exactly what OS running, wonder if your user is somehow limited and you could configure higher it’s not an OS thing it’s a REVM thing - the process isn’t getting killed with OOM, just revm is shutting down due to internal OOM if i understand correctly Macos it’s so wierd tho i keep upping it and it keeps failing as Brock says, it's time for a git-bisect :) whats a gi bisect? ahhh i mean i just did a restructure of the contracts and added a dependency on some other new contract but it shouldnt be related to it it’s failing in a completely random place in something that remained untouched Within the run itself. So interactions w an external contract is where it fails actually it seems that some bugs stop when i remove some console.logs could it be some limit for events storage? Figured out how to do it. Long-winded. But if anyone needs help installing Foundary on Windows. I can help.",441
1906,foundry-support.txt,"@brockelmore is there anything like clearing event logs after they emit? i was trying to debug some out of bounds err w a console log, seems like its what was causing the issue but now, i cant debug that out of bounds err 🥲️️️️️️ if you use console.log in a for loop or while loop, solidity doesn’t clear out memory for you you have to do it manually so if the for loop doesn’t touch memory besides the console.log call, you can just record the free memory pointer before the for loop and at the end of each iteration reset the free memory pointer back if that’s gibberish to you i don’t necessarily recommend doing that nope not in a for loop. It was really just logged once per test function i’m not unfamiliar with low-level memory ops, tho i dont quite understand how it relates to the emmited logs all works now tho 👍 another quick q if u dont mind - Trying to run the git workflow included when installing foundry, getting this error in git: i searched for Diamond-Foundry but did not find anything relatng to it, anywhere specific i should look for? it is some repo i git cloned, and then deleted. Is there some command to clear some git module-related cache or somethingl ike that? You can directly edit files in .git folder with a text editor if I understood the problem correctly Hey, I'm getting Failed to estimate gas for tx: ...",300
1907,foundry-support.txt,"I'm pretty sure this is a bug since I've seent people recently reporting this also and it's a pretty simple tx that should not run out of gas by any means Question is, any way to overocme this? --block-gas-limit is doing nothing Having a serious issue where scripts don’t deploy new contracts If I deployed something already, redeploying keeps the state /address It seems frankly impossible that this is even happening i think i had to call some command, i forgot thanks anyway tho btw guys i have a question on how gas works in forge tests - Do addresses get some huge number of ether in their balance in order to pay for gas? or are gas fees “Free”? how does it work exactly trying to test some gas prepaying logic here try git rm --cached path_to_submodule i think thats what i did 😄 Am i actually charged for gas when sending function calls? or is foundry making them “free” by default? if so how can i disable this behaviour temporarely (tests) Guys let's say i want to run test using forge test using my metamask account. FYI i have forked mainnet and done setup in metamask. Is it possible to run test using metamask account u can just prank it vm.prank(metamaskAccount) hi Brock, any idea on this? it seems really weird, balances do not change at all So I have two profiles that target two different source code bases, one for 0.7.6 no IR and mild optimization (profile.uniswap), one for 0.8.18 with IR and more optimization runs (profile.default). FOUNDRY_PROFILE=default forge build works as expected and builds the profile's source tree, but FOUNDRY_PROFILE=uniswap forge build fails with Stack too deep in the default source subtree. This is weird, it's not even supposed to be looking at that subtree? The profiles do point at different source directories. setting FOUNDRY_SRC as well doesn't help neither does enabling caching. yes its charged.",423
1908,foundry-support.txt,"the only thing that isn’t charged is the first call to the test function for some reason, this uniswap profile still insists on [⠰] Compiling 106 files with 0.8.18 even though all its contracts are 0.7.6 https://github.com/foundry-rs/foundry/blob/master/config/README.md Restructuring profiles according to this doc doesn't seem to do anything. I moved the defaults into the default profile and am using two separate profiles to customize the build, but it's the same thing. okay cool and another question why is the tx.gasprice is initiallized to 0? (im on an arbitrum fork if it helps) Also, seems like vm.txGasPrice() is not found this is what is shown in the docs it seems like an issue that i had before also - the function exists, but it’s not on the interface (was similar w deal() for erc20’s Hi, i’m starting to think this is incorrect: I am pranking Bob (after dealing his wallet 2 ETH), and executing this function call with 2 eth as gas. The function call itself keeps track of the gas used, and transfers it to Bob. According to the logs from it, it transferred bob 167k gas (which was the amount of gas used). Now, it means that the transaction costed approx 167k gas, and it was refunded to him. So his balance should be 2 eth now. But actually the balance is 2ETH + 167k gas. So the 167k gas was never charged from bob’s wallet It kinda makes sense if you think about it, you can prank without worrying about ETH balances and dealing, and the actual gas price changes constantly, you mostly care about gas costs in testing. then in the real world price * cost yields the actual fee.",386
1909,foundry-support.txt,"fair enough sitll gotta figure out why Bob is not being charged after setting it to 1 tho 🥲️️️️ i smell privilege So if Bob had 2e And then spent 0.1 in gas fees And then was reimbursed 0.1 in gas fees His balance should be 2.0 again That’s what it says in your screenshot under Actual Balance Why are you expecting Bob to have 2.1? no, thats his balance prior to executing he has 2.00..167 whilst it should be 2e Why does it say expected 2.00..167 then? It’s confusing i shall change the order then i guess but yea, expected is 2e, actual is 2.00..167e I imagine the second value in the assert statement is the expected yeap, 2e just changed the order but definitely i think that the gas is not beign charged here Hey Guys, where can I find a list of all network-names that foundry uses? Just to make sure we use the same wording/spelling for certain networks. Especially I am interested in the new zk networks (linea, zkSync Era mainnet and testnet, etc.) https://github.com/ethereum-lists/chains awesome, thank you so much anyone got any idea why this may be happening? clearly, Bob isn’t being charged any gas for this function call. Hey @miohtama, I am a little confused by this. Example: BSC Testnet (chainId 97) By foundry I am forced to use this name: ""bsc-testnet"" but this name cannot be found in this file here: https://github.com/ethereum-lists/chains/blob/master/_data/chains/eip155-97.json So there seems to be differences. Is there maybe another list in the foundry codebase somewhere? I couldnt find it so far... Hmmm maybe Foundry has its own non-standard database Good spot! yeah that's exactly what I am trying to find out...we want to make sure that the network names we use in our backend match with foundry but I struggle to find the list of network names that foundry uses.... Had the same issue. What I did was to fork the required network on anvil, create a mock script to deploy a mock contract and look at the logs.",486
1910,foundry-support.txt,"It will show correct name of network there There must be a better way though Is there a way to throttle Anvil fork requests I am getting this 100/second request limit reached - reduce calls per second or upgrade your account at quicknode.com Here is the full error that causes Anvil to panic stderr: thread 'main' panicked at 'Failed to get fork block number: JsonRpcClientError(SerdeJson { err: Error(""unknown field `code, expected one of id, jsonrpc, result, error, params, method`"", line: 1, column: 7), text: ""{\""code\"":-32007,\""message\"":\""100/second request limit reached - reduce calls per second or upgrade your account at quicknode.com\""}"" })', /home/runner/work/foundry/foundry/anvil/src/config.rs:816:30 @gakonst would you happen to have an answer to this? Where can we find the full list of network names that foundry uses? https://github.com/foundry-rs/forge-std/blob/cffb5628775fbf120bfc3c123149f6a6d99dc275/src/StdChains.sol#L182 ? Hey how to test exception cases in forge? like require(false, ""condition error""); in this case, how can we check condition erorr? no I dont think that's it. Cause here ""bsc-testnet"" is called ""bnb_smart_chain_testnet"" expectRevert()? thanks Opened here https://github.com/foundry-rs/foundry/issues/4895 any way to call function directly rather than call? Wdym? no worries. is there any way to look up labels? by address I mean, outside wrapping vm.label in my own function and duplicating in a test-local mapping of course. Yes! I made a vm.getLabel cheatcode and it got merged a couple of days ago ohhhh, nice @alberto_centonze, tysm. I went ahead with a wrapper, but that's a dirty hack.",425
1911,foundry-support.txt,"will check getLabel out! Don't know if it's already available in production but you should be able to use it if you install the nightly version of foundry and forge-std i foundryupped today, so it should be there Ok then make sure it's part of the forge-std interface @gakonst @brockelmore spam Hello guys! I have an interesting question regarding libraries. My idea is to have a SC and a possibility to inject different libraries to it, extending it's functionality. Now, it's possible to deploy a library separately using brownie or hardhat but I didn't find a way to do it with Forge/Solidity.",138
1912,foundry-support.txt,"MyLib lib = new MyLib() obviously doesn't work, any other ideas? Thanks in advance can someone please tell me where i can find the `txGasPrice()` function on the VM? its in the docs but not in the code is there a way to retrieve data in memory, like there is for storage (stdstore)? is `mload`ing in inline yul not good enough? Is there an example of using that in foundry? I haven't seen that before u use it like u do anywhere in Solidity https://docs.soliditylang.org/en/v0.8.17/yul.html ha, I suppose I've never seen it before thanks hould be this actually:https://docs.soliditylang.org/en/v0.8.17/assembly.html often referred to as “inline assembly” Also, is there a 'best practices' way to test if an if statement failed or completed? wdym exactly? other than testing the following code uint256 rewardsEarned = rewardPool.earned(account); if (rewardsEarned > 0) { IERC20 rewardToken = IERC20(rewardPool.rewardToken()); best practice to test that rewardsEarned > 0? is it only in memory? yes (I believe so) do u store this anywhere in storage? no well i dont think it will be easy to do this in memroy, not reccomended on my end (unless there’s smth i dont know of) but what i would do is, after the call, do another if statement checking the same .earned state, i guess yeah I mocked the earned call then I could just expectcall the rewardToken() call but it doesn't seem ideal well actually there’s no way to access that in memory becuase the call would have finished at that point, and the memory from the function call would be cleared i would suggest looking to see if u can check based on some storage change imo well I could set the mock call to return 0 or 1 or -1 hmm yeah its not in storage hi how do i update my forge std version? putting @1.5.5 says invalid tag. Invalid type for argument in function call. Invalid implicit conversion from contract SUITDeploy to contract SUITDeploy requested.",469
1913,foundry-support.txt,"Are the deploy scripts on script/ running somewhere different than the tests? gist of it https://gist.github.com/lucaslain/bccb0d76e803d512b357c335958c8c09 what's the best way to increase branch coverage for unnecessary conditional branch? for (j = 0; j < supportedCoinLength; j++) { if (supportedCoinAddresses[j] == coins[i]) { break; } } something like else case for above one. How do you trace a script? I'm trying to get better at debugging with foundry. Can someone help me understand this error?  [119029] NFTPrinterTest::testIsWithdrawFees()  ├─ [94821] NFTPrinter::printNFT{value: 10000000000000000}(NFTPrinterTest: [0x7FA9385bE102ac3EAc297483Dd6233D62b3e1496], https://example.com)  │ ├─ emit Transfer(from: 0x0000000000000000000000000000000000000000, to: NFTPrinterTest: [0x7FA9385bE102ac3EAc297483Dd6233D62b3e1496], tokenId: 0)  │ └─ ← 0  ├─ [9274] NFTPrinter::collect()  │ ├─ [45] NFTPrinterTest::fallback{value: 10000000000000000}()  │ │ └─ ← ""EvmError: Revert""  │ └─ ← ""EvmError: Revert""  └─ ← ""EvmError: Revert"" It's failing when calling this function but i can't seem to figure out why: ``` function collect() external { payable(owner()).transfer(address(this).balance); } ``` it looks like the error is on the receiving side, in the fallback function on NFTPrinterTest.",412
1914,foundry-support.txt,"so you should look at the fallback function in that contract and see where it might fail Getting an unknown version provided when running forge build on m1 macbook, using solc 0.8.19, I'm assuming this needs to be installed manually? Try foundryup’ing just in csae Is it possible to debug a transaction and map local source to remote bytecode? gm! guys, what's this string doing in the ./out/ bytecode? oooooh is it a library placeholder? I am using foundry artifacts to generate go bindings with abigen. I feel like I am doing something deeply wrong because the pipeline feels too fragile. It worked for single contract, but I use libraries, should I deploy & link them manually? What's the possible workaround? does foundry gas report take L2 gas calculation into account (i.e. calldata gas is priced differently from execution)? is there a way to tag tests so that they can easily be skipped? such as tests that require forking? is there a workaround to roll everything back to before the “Migrate to revm 3.0” task was created? There’s the no-match-test cli option for instance. Where you can filter them out based on names. So include ‘fork’ in test names and do --no-match-test fork you can foundryup -v nightly-xxxx pick from https://github.com/foundry-rs/foundry/tags is there a problem with Deploy scripts when trying to read the values from a test? is this a good practice? I’m deploying contracts using SUITDeploy and then store them in that contract. When running the tests, when I try to retrieve some of this stored values, I’m getting a EvmError: Revert. This used to work until `nightly-94777647f6ea5d34572a1b15c9b57e35b8c77b41`. Can this be related to the migration to revm 3.0 ? Hi everyone, does someone know how to show value of contract instead of giberrish. I have the contract code, the contract are also verified on the blockchain but when I try to execute my script, foundry give me errors in built code instead of readable one Is there a trick to interacting with fork assets in Foundry? I'm dealing 20 USDT to an account and then any USDT.",491
1915,foundry-support.txt,"operation is executed but execution also reverts with ""EvmError: Revert"". Like if I do an .approve, I see the Approve event emitted and then I get ""EvmError: Revert"". Same with transfer. emits are the last thing USDT functions do, so why the revert? Oh, I think I get it. The standard. ok. is it possible to get coverage for vyper with foundry? hey guys, is there any tutorial in how to use/deploy openzeppelin transparent proxies in foundry? Checked some projects, but still don't know how to deploy it correctly and test. Just a small barrier cuz I've never used it before. I liked the patrick collins video for hardhat, would like to know if is there something for foundry also. Not a tutorial, but we do that in this script: https://github.com/memester-xyz/competitions/blob/master/script/01_Deploy.s.sol Feel free to ask questions There are some tests for it too: https://github.com/memester-xyz/competitions/blob/master/test/LensCompetitionHub.t.sol#L61 hey @devanoneth thanks for that will check it out anyone know how to get the private varible in contract by using foundry address _token0 = vm.envAddress(""CONTRACT_ADDRESS""); this? such as these private variable is there any means? if is private you can access _rTotal inside this contract, no? I wanna know the rTotal value, but it is private you can write a getter function maybe, like function getRTotal() public returns (uint256) { return _rTotal; } is there a example？ yeah this function allows users to know the private _rTotal value through this getter is that what u looking for? maybe, where do I add this getter function inside this contract Yep, it's documented here: https://book.getfoundry.sh/cheatcodes/expect-emit You mean rewrite the contract? But if i rewrite it, How to use it? nothing is private :) you could use https://book.getfoundry.sh/cheatcodes/load?#description ah, so my blindspot here is fallback functions. thanks for the tip! https://docs.soliditylang.org/en/v0.8.19/contracts.html#fallback-function I’m sorry, didn’t realized u wanna get this from a deployed contract.",496
1916,foundry-support.txt,"George’s answer might do the trick ok, I will try it George's answer need know the slot , in a contract inheriting many contracts, defining the slot is difficult can I do expectEmit without ordering? what's the next best place to look for testing patterns after getting through https://book.getfoundry.sh/? I'm trying to write a test that checks if a balance updated after a withdraw function is called on a contract. I'm looking for a foundry equivalent to doing this in hardhat: expect(contract.collect()).changeEtherBalance(owner, 1000); After going through the cheatcode reference, I have something that kind of checks what I want: ``` function testIsWithdrawFees() public { vm.deal(address(nftPrinter), fee); vm.prank(owner); nftPrinter.collect(); assertEq(address(nftPrinter).balance, 0); assertEq(owner.balance, fee); } ``` where does foundryup download from? any particular reason it’d be really slow to download? (currently on 100mbps but seeing foundryup crawling) i'm currently getting an error when trying to deploy my contract: Details: `Fail - Unable to verify. Solidity Compilation Error: Source ""lib/openzeppelin-contracts-upgradeable/contracts/utils/ContextUpgradeable.sol"" not found: File not found. Searched the following locations: """".` the file definitely exists in that location but it looks like forge isn't even searching for it https://github.com/barakman/solidity-math-utils @gakonst spam ser ban the spammer admins will take a look at this github has had issues earlier today may be because of that This is from bancor , they do the same thing your doing pretty much unfortunately no, you should use APE framework I dont think so git submodule foreach --recursive git clean -ffdx sleep 1 git submodule foreach git reset --hard HEAD git submodule update --remote --rebase lib/ or just nuke the lib dir and reinstate submodules How to call functions and interact with already deployed contracts in tests? what's a good way to ensure that my contract deployment stays under the total cost of 1 ETH? hey, in forge coverage report, I saw these lines.",459
1917,foundry-support.txt,"BRDA:86,5,0,7 BRDA:86,5,1,17 What does last number mean here? is it number of execution? I'm not sure but this branch shows as uncovered even though both cases are covered. is it a bug? is there a way to persist state from an Anvil chain so that it can be paused/restarted? anvil_dumpState and anvil_loadState ooh, got it, thx a bunch @moodlezoup hmm, looking at this more - is there a way to have Anvil actually write block data to disk as opposed to needing to dump/load? so you'd be pointing it at a datadir, basically guys, whats the most efficient way to print an array on console? is there something like doing {:?} on rust but in foundry?? Hi all! Silly Chisel question: is there some kind of cheat code to declare global variable (ie havin t or a as global here, not the default locally scoped) and to have a storage dump? Only could find how to play with mem or stack so far:/ working on that (+ more) https://twitter.com/moodlezoup/status/1656143401182478336 but in the meantime I think you just have to loop over the array and print each element lmaoo im asking because i saw your tweet and was wondering if it existed and i was missing something soon (tm) Hi Foundry Wizards, is there a way to prank and manupilate the price of an oracle in Foundry test contract. THe contract I am testing gets the data from Chainlink import ""@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol""...contract is forked from live network Something like function setPrice(set test value here) How can I forge install the 0.8 branch of uniswap/v3-core? uniswap’s primary implementation is 0.7.6. I’m writing a project in 0.8 and would like to make use of the 0.8 implementation they have on the 0.8 branch of their github. how do i tell forge? forge install …@0.8 or some such thanks. just found it.",459
1918,foundry-support.txt,"posting for posterity forge install Uniswap/v3-core@0.8 @gakonst @brockelmore spam vm.mockCall to mock the response from calling the price method might be the easiest https://github.com/ethereum/solidity/releases/tag/v0.8.20 w3n support 😁 I'm running a Script using (https://github.com/foundry-rs/forge-std/blob/master/src/Script.sol) and I'm trying to understand how the nonce management is handled. I'm not specifying a nonce, but the nonce continues to be incremented each time I invoke it. Where is the nonce being queried? Is that being done somewhere within Foundry? Hi guys I'm trying to verify a contract using same optimizer runs value in toml and deployment command but still get a difference in bytecode after compilation & the deployed code Has anyone faced this while deploying with foundry ? the contract is using the version ^0.8.16 I am doing Polygon mainnet fork tests and sometimes getting {'code': -32000, 'message': 'intrinsic gas too high'} from Anvil. Any idea how to work around this? uhm, that should be fixed alreay try updating foundry Nope not the issue Setting gas price manually did the trick oh nice, great job hi all, when starting up anvil is it possible to specify a different location for where it stores the fork snapshots to disk? i wasn't able to see any settings for this in the docs but maybe it is possible via some environment variable or something? does anvil_reset revert all state changes and start from the provided fork block? —dump-state —load-state Is there anything that needs to be done for a network to be forkable in forge? I'm running vm.createSelectFork on a private remote network (that I can connect to and interact with like normal) and getting some weird errors ``` 2023-05-11T06:51:16.924008Z ERROR sharedbackend: Failed to send/recv `basic` err=GetAccount(0x519303025f4218df3d3cfec52faecfb590289779, (code: -32600, message: unable to fetch code, data: None)) address=0x519303025f4218df3d3cfec52faecfb590289779 The application panicked (crashed).",493
1919,foundry-support.txt,Message: called `Option::unwrap()` on a `None` value Location: /Users/runner/.cargo/registry/src/github.com-1ecc6299db9ec823/revm-2.3.1/src/evm_impl.rs:285 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ BACKTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1: __mh_execute_header<unknown> at <unknown source file>:<unknown line> ... ... Morer of the same backtraces ``` Not sure where the 0x519... address comes from either. Is this a know issue? If not I shall open an issue.,173
1920,foundry-support.txt,"Also, forking mainnet L1 works fine ^ So I'm thinking it's something network-specific that needs to be done before you can fork it how can i use forge fmt formatter over prettier in vscode? I've changed my settings like so, but running format document executes on prettier, not forge i have a really dumb ethers-rs question: how do I actually get addresses returned from contract calls to full expand instead of being written out like: 0x8c7b…d995 for ex figured it out, H160 requires ""{:#x}"" Hello there ! Do you know if using sol 0.8.20 while keeping evm_version to paris would work (as a temp solution) for deploying contracts on chains that do not support EIP-3855 yet ? Hey everyone, I am trying to access the revert reasons for tx simulation using anvil, what is the best way to do that? Here is an example in Python https://web3-ethereum-defi.readthedocs.io/api/core/_autosummary/eth_defi.revert_reason.fetch_transaction_revert_reason.html#eth_defi.revert_reason.fetch_transaction_revert_reason during a deployment script is there a way to wait for transactions to be mined, i feel like i'm getting an error because the next transaction is sent out without waiting for the previous one to mine how does each call in a script contract get passed to mempool, is it all one transaction or is each call a seperate transaction maybe that's the wrong way to think about it but basically i'm wondering if i have to do the equivalent of await ...wait() as you'd to in hardhat when doing stuff in a forge deployment script Great thanks, seems like there is a decode_revert_reason in error.rs in anvil that might be how, still not sure though for the underlying mechanism it's just eth_call JSON-RPC with the same parameters that were in the tx data payload Yh so here I want to do it locally with my forked state so I think I will have to do a bit differently, but It should just be: 1. Simulate tx against local state 2. Match on revert 3. Decode abi encoded revert string 4.",453
1921,foundry-support.txt,"Match on exact revert & deal with specific revert case accordingly Yeah I am use this function all the time like this I have also constructed another function that does Solidity stack traces for reverted txs https://web3-ethereum-defi.readthedocs.io/api/core/_autosummary/eth_defi.trace.print_symbolic_trace.html#eth_defi.trace.print_symbolic_trace if you need to figure out what's crashing I'm not yet privy to gitmodules. I keep running into this issue when I try to commit and am wondering if there's a standard way to get rid of it: Changes not staged for commit: (use ""git add <file>..."" to update what will be committed) (use ""git restore <file>..."" to discard changes in working directory) (commit or discard the untracked or modified content in submodules)   modified: lib/openzeppelin-contracts (modified content) Adding ignore = dirty to that submodule in .submodules worked. guess I'll be learning about submodules today : ) Do any of you know of an easy way I can fork a block with the entire state instead of relying on SharedBackend that would fetch the missing data? Forking a block with the entire state would require an archive node. It's not really possible to know what state you are going to need until the EVM requests it, which is what makes SharedBackend so powerful.",284
1922,foundry-support.txt,"Otherwise you may as well just run an archive node and hit it with eth_call Yes no completely understand why its super powerful in terms of normal simulation But in my case I have an archive node running Because I am simulating the chain at a given block & then simulating the mempool using historical mempool data I’m using to test mempool aware strategies, to simulate runtime execution But I am worried that if I don’t have the entire state loaded it will take to long to request the missing storage slot & because of that I won’t be able to mine the blocks in time which will destroy the accuracy of my sim how do I pass a bytes32[] to cast send? tried to use the string representation like so: ""[0xbf3423b85366bbc1613b3c4612e491e341d1be6c0b5121f531380acf075429b7, 0x6599d066bb77a443a3a1471cf9c3b886c8a17903931b1aea7e4c616e59edead0, 0xf318f06b46eb49c5089e3162f863edf7033032675802d90c2c9c895f09bca455]"" What context is the -hh flag run for hardhat project compatilibility? https://book.getfoundry.sh/projects/dependencies#hardhat-compatibility I see the situation @vanbeethoven_eth, and nice idea! Funny that we just open-sourced a simulator (https://github.com/EnsoFinance/transaction-simulator) and we have the idea to be able to load in a full archive node DB. We are planning to use reth for this, as it's also based on revm it should be easier. Then your simulator would have full access. For now, I'm not sure of a way to load a backend with entire state using the Foundry codebase.",404
1923,foundry-support.txt,"Maybe someone else is? Yh a bit of a tricky one haha, and I can’t even just redirect to archive node & eth_call because the state it depends on might have changed Acc no thats wrong, I guess I could just ipc -> request state & then would have it in anvil & could use over the course of the sim Yh we’re setting up our archive nodes with reth to Yeah also thought of using IPC as it needs state so it's quicker, but I think just building it on top of reth directly is probably best / fastest Wanna head to DMs? I'd be curious what you're building if you can share more, I also can 😄 Yes ser dming now You mean direct db access? Basically, yeah Hi, Is it possible to deploy a smart contract to a specific address? not really In a test or on a real network? In a test https://book.getfoundry.sh/cheatcodes/etch 🙏 Do the vm.deal is no longer supported for dealing erc20 for a fork mainnet ? What’s the recommended way to use a different rpc only for broadcast in a script? createSelectFork? yes remove the vm., since the ERC20 deal method is part of forge-std Hi new friend Hey, any idea of why console can't be found inside a Script? I even tried to inherit the test contract as you can see but it still doesn't compile Is there actually a signature for console.log that takes no arguments? A week ago, I started getting a new error around UNPREDICTABLE_GAS_LIMIT when I try and run any transactions that require GAS. I’m on the latest verion of anvil, cast etc… All of the reverts work, but as soon as I try and pass a legimiate value into a function that requires GAS, I get this error. Even when I pass an argument the problem is that console is not found, not the function signature Perhaps you’re missing the import then? Just realized what the problem was. I'm dumb my bad Hi all. How do I make a monorepo of foundry projects and link them together? Right now I am using remappings and symlinking from the lib folder but its breaky Found the answer....",463
1924,foundry-support.txt,"I was using allowed_paths instead of allow_paths :) Best bugs are bugs that are easy to fix between a keyboard and a chair 👍 is there a work around for me to be able to read from a public mapping in my contract into my test contract? I have a mapping of a uint to a struct and when I try to use the mapping to read properties off the struct I get ""argument not found after lookup"" but when I use a view function that returns the mapping value it works perfectly mapping(uint256 => Campaign) public campaigns; Does not allow me to read from the Campaign struct but function getCampaign(uint256 _id) external view returns (Campaign memory) {   return campaigns[_id];  } allows me to read off the struct essentially reading from the public mapping directly i.e. contract.campagns(id) does not work in my test contract but using a view function that returns the reading from the mapping i.e. contract.getCampaign(id) does return a struct How do I run a script in a test? Anyon knows how to solve this error?? error[9553]: TypeError: Invalid type for argument in function call. Invalid implicit conversion from contract IERC20 to contract IERC20 requested. Can you share your code so i have the following struct A { [...] IERC20 _token } also i do an import from OZ by import {IERC20} from ""openzeppelin-contracts/contracts/token/ERC20/IERC20.sol""; and then i pass it like this function foo(struct A) { someContract.someFunc(A._token) } and the someContract.someFunc is throwing the error tho it is defined like someFunc(IERC20 someToken) with the same interface from OZ maybe someContract.someFunc(A._token) oh yeah i have it like that hey there, is it possible to use a script like Deploy.s.sol to deploy contracts? Should it be safe to have multiple instance of Test? Like, say, for example, there's a Test contract and one of its storage variables is another contract, which has 3 more Test instances? Asking because after moving various test utilities into a separate contract and using them in this fashion I'm seeing extremely weird behaviour in one of the tests, where the function is supposed to revert and it does, but with expectRevert it says [FAIL. Reason: Call did not revert as expected]. This test used to pass before.",494
1925,foundry-support.txt,"Do anvil or cast have some sort of read only mode? I can deploy and read my contracts, but I can’t write to them from either my dapp or from cast? yes sir, you can check the guide under ""Solidity Scripting"" in the foundry gitbook It's a tutorial on how to use for deployments why function test_n(uint16 e) public { console.log(""e - "", e); } show only once ""e-"" xxxxx ? Does something like this exist for foundry? https://hardhat.org/hardhat-runner/docs/advanced/multiple-solidity-versions Appreciate it! https://github.com/PaulRBerg/foundry-multibuild maybe look into this repo Thanks for sending! this is for checking a project builds with multiple solc versions rather than allowing files in the repo to use different versions For hardhat, if you specify multiple versions in the config, it reads the pragma line in the files - see image https://t.me/foundry_support/9182 maybe this? or maybe https://t.me/foundry_support/28258 You can search in this tg group previous conversations about that topic thanks! the files are independent so auto_detect_solc should work. Trying it out now. Sorry i didn't find this before! Appreciate the help 🙂 there were literally a few people mentioning that sh was the only way! pretty neat, imports .env easily Yeah it's very cool the foundry says , EvmError NotActivated. What's wrong Help? Its just solc Wdym? How do I fix it? solc = ""0.x"" Do a foundryup as well just in case change solc version 0.8.0 I'm using prb math (which requires 0.8.19 or higher) 0.x was a placeholder... solc = ""0.8.19"" Paste this as is That’s what I did here foundry sees evmerror notactivated. Anyone knows? solc, not solc_version Or use auto_detect_solc = true i ran foundryup once, and stil had the error. ran foundryup again, and now it works with either ""solc_version"" or ""solc"".",458
1926,foundry-support.txt,"weird… anyways, thanks :) Hey guys, I am working on an ether rs provider for reading directly from the reth db without going through rpc So that I connect anvil to the reth db so that the queries for missing state in fork mode are way quicker & I saw that there was a todo in the ClientForkConfig to make it provider agnostic I’m going to try & make it generic over any provider & I wanted to know if anyone had already worked on that so I don’t waste time https://github.com/foundry-rs/foundry/blob/c1dbafd6faed950c8da31139a9aa786aa6cd3bf0/anvil/src/eth/backend/fork.rs heyy, is it possible to use forge inspect with a deployed contract? like inspect storage by passing the contract address? on hardhat there is something like getStorageAt is there a way to console.log numbers aligned to the right? that would speed the debugging you can use vm.load(address, slot) Is there any way to save a wallet on my local machine so that Forge does not ask me to provide a --private-key every time? The use case I need this for is cast wallet sign - I am debugging EIP-712 signatures and I would find it helpful to be able to skip the --private-key flag. Nope, I opened a feature request about this a while ago but nobody picked it up https://github.com/foundry-rs/forge-std/issues/91 Just putting this link here too for posterity even though I'm chatting directly with you 😁 https://github.com/foundry-rs/foundry/pull/1003 I’ll take a look at it Just released 🎉 https://twitter.com/moodlezoup/status/1657080575847550981 https://github.com/moodlezoup/forge-deep What happens with structs containing (nested) mappings? No support for mappings at the moment, I couldn't think of a good way to make that work Yeah, so i had to implement extra view functions that return variants of my structs where the mappings are stripped, just wondering if deep will ignore them in the definitions as well.",450
1927,foundry-support.txt,"Yeah maybe if StdStorage had a feature that would dump all non-zero key-value pairs of a mapping, you could do deep mapping equality currently it'll just throw if it encounters a mapping, but I should have it handle mappings more gracefully, thanks for the suggestion 🙏 Whats the best practice for managing abis? Pushing the full out folder doesn't make sense as it has timestamps so its always unnecessarily changing Was thinking to have an action or commit hook that grabs just the abi key from the out folder and puts that into a separate abi folder. EOA nonce changed unexpectedly I’m trying to do this on a local anvil fork - and it always says this after the 22nd transaction. It’s not a multichain deployment. Maybe something’s wrong with nonce management? I tried slow, resume - nothing works Huh this si interesting. Do you have a repro you can share? WDYM? Do you need to push the ABIs? Yes, but it’s a private one - we better DM? Yea, so frontend team can have easier access to it on changes etc If all you need is TS contract wrappers, last I checked typechain/ethers-v5 works with foundry artifacts Yea it works fine, it just clutters up the commits quite a bit because every time you build all the files in out change the wrappers won't change if the abi stays the same hey guys i have another ethers-rs question i have a rust hashmap where the keys are strings strings of hex addresses but as Strings how do i convert an H160 into a string I can use for that hashmap lookup? h160.to_string() doesnt seem to work My tests aren't console logging anything WDYM by the wrapper? The stuff in the out folder? the TypeScript wrapper for the contract Lmao using solady nice this PR should be close to getting merged, not seems it has stalled https://github.com/foundry-rs/foundry/pull/4710 https://github.com/foundry-rs/foundry/issues/4915 so implemented for this issue and tested manually but I wanna implement some test cases but what would be best practise for that cause I couldn't find much test cases in chisel Deploying contracts on sepolia &when it tries to verify the contracts on etherscan, it successfully verifies several of them, but fails to verify two of them. This is the error I get with those two: `Fail - Unable to verify.",501
1928,foundry-support.txt,"Compiled contract deployment bytecode does NOT match the transaction deployment bytecode.` Tried re-running it with --resume but it still failed to verify two. Why would the bytecode not match with the contract it just deployed? Any suggestions for why some contracts verify fine & some don't... not seeing any situations like that in the message history here Could it be that these two contracts that don't verify were using ^0.8.18 instead of just 0.8.18 like all the others were? I wouldn't think it would be compiled in a different version, since the foundry.toml is set to 0.8.18 how is anyone tolerating foundry codebase in vscode? my window dies everytime i make a change Hey guys :) Wanted to ask you one question: how can I automate the installation of libraries like openzeppelin etc using foundry? In hardhat I just install via yarn and that's it, is there a way or I need to run yarn also for this and use remappings? Thanks :) forge install openzeppelin Strange question I tried to deploy a contract on ETH but I didn't have enough eth for gas so foundry prompt me the error. I turned off everything and retried the day later with a lower gas and worked. While I was checking the tx on etherscan I saw that the contract got deployed 2 times in total: 1. while I was away, pc turned off etc 2. when I retried how is this possible? a sort of cache?😅 Yes, but let's say I clone a foundry project, I don't want to use forge install for each package. How can I automate like in yarn where just yarn and it installs everything Oh nice, it would actually be cool if foundry had a post compilation hook to run this automatically, WDYT ? I mean, personally I’m running a build script anyway to get all the flags I need, so it could be a line in there. 🤷‍♂️ Yeah probably easier to just add it like that, fair enough Prepare a .gitmodules file with all the necessary submodules and a simple forge install Oh ok ty :) Hi Why ""cast block finalized --rpc-url <RPC>"" works with Ethereum's Goerli but not Polygon's Mumbai? rpc issue, try another provider Sure? Or because Polygon don't have the ""finalized"" block thing? I've tried 2 Mumbai RPCs.",496
1929,foundry-support.txt,"Also the Mumbai RPC in the screenshot is using the same provider as the Goerli one that worked! yeah, maybe that's the reason Yep, proved fren: Polygon RPCs are working. I've replaced ""finalized"" to ""latest"" (I didn't even know latest was a thing in Foundry lol) Hey everyone, I’m working on implementing fork state querying directly from reth db locally to speed up simulation and I am a tad confused when it comes to the use of SharedBackend in anvil A part from upon startup when is SharedBackend being used to query state from the remote? Or for reset Anyone here use chugsplash? Anyone have some good examples of foundry repos that are upgradeable? @mattsse Because in the ClientFork implementation the fn seem to fetch state directly from the provider Not sending it to SharedBackend how do i enable forge to use solc 0.8.20 without typing forge build --use /opt/homebrew/bin/solc I'm trying to setup tests for a contract that selfdestruct s, but I'm still getting a non-zero code size. I'm guessing this is because the transaction hasn't ""completed"". How do I get the contract to destroy itself inside the test? Looks like it's not possible with current Foundry setup and cheat codes, but I found an alternate to vm.deal a wei to the contract and then check that the balance is zero after selfdestruct is called.",296
1930,foundry-support.txt,"we’re seeing previously passing tests in our repo that are now failing on latest foundry, and I think it’s related to the new expectEmit behavior (https://github.com/foundry-rs/foundry/pull/4920) I have a test that looks like vm.expectEmit(true, true, true, true); emit StoreSetField(table, key, 1, newSecondDataBytes); StoreCore.pushToField(table, key, 1, secondDataToPush); pushToField does a fair bit of work before emitting (including doing the necessary calls to get the data for the event emission itself) I think under the new expectEmit rules, this will no longer match (and thus fail tests) what’s the recommended way to test that this pushToField call will result in an event emission before returning? Doesn't it always just download the solc version you specify in your contract automatically? If it isn't already installed What changed on the new emit? https://github.com/foundry-rs/foundry/pull/4920 anyone facing a similar issue? https://github.com/foundry-rs/foundry/issues/4940 It should be available in svm as a binary https://github.com/roynalnaruto/svm-rs Hi guys, during a test how can I print an array together with their labels? I'm currently using emit log_array(array); but on the output I only see the addresses without their labels, if I do console.log(address[i]) instead I also see the label of the printed address It would be nice to print the array with labels without having to loop through its elements nah u gotta if that's the case I think this is something that could be considered to be added on a next version hey guys, gm. do you know why I'm getting these logs? First time it happens when I run the tests in a foundry project. [⠊] Compiling...",400
1931,foundry-support.txt,"Anyways, do u know if I can fix it somehow? try to run reinit https://twitter.com/PaulRBerg/status/1629425771457531905 Awesome, thank you @PaulRBerg What's the reasoning behind foundryup not including updates for chisel? Bump Any idea what would cause some contracts to correctly verify and others to not with the same script deploying all? Tried manually verifying with the bytecode, but interestingly, the abi from foundry isn’t the same as remix. Do the forge build --sizes use the base 10 kilobytes instead of base 2? I was just noticing that the bytecode size & the build sizes were the same, just with a decimal 😂️️️️️️ - just used to a kB == 1024 bytes it should, you prob just need to update foundryup since it’s a separate installation tool yea it shows number of bytes divided by 1000, not 1024 Ah let me try that i'm creating a custom Docker container for development that has Rust, Foundry (with Forge, Cast, and Anvil), and also Mud with Yarn and Node.js. i'm using this for reference https://github.com/foundry-rs/foundry/blob/master/Dockerfile but i got confused when i read here https://book.getfoundry.sh/getting-started/installation that Foundry includes Chisel too. but in that Foundry Dockerfile that i'm using as a reference, they *don't seem to generate and copy across any Chisel binaries here* https://github.com/foundry-rs/foundry/blob/master/Dockerfile#LL32C1-L32C1, Why is that the case? also, if i'm going to run it in a Docker container, i suspect i would need to expose some ports. so far i've found that i'll need * 8545 default port for Anvil (reminds me of Ganache) https://book.getfoundry.sh/reference/anvil/#supported-transport-layers. it also mentions to provide ANVIL_IP_ADDR=0.0.0.0 https://book.getfoundry.sh/reference/anvil/#usage-within-docker What other ports are used by Foundry (Forge, Cast, Anvil, Chisel) and Mud? Ah gotcha.",482
1932,foundry-support.txt,"For some reason I assumed kb was 1024 like the olden days haha Any idea what could be causing it to not verify my contracts? It says We haven't found any matching bytecode for the following contracts: 0x.... This may occur when resuming a verification, but the underlying source code or compiler version has changed. Even though it definitely didn't change while I was running the script or waiting for the transactions to complete... I am a relatively proficient developer of smart contracts using Foundry. I encountered a problem. I want to optimize the Gas consumption of my contracts. Whenever I modify the contracts, I want to record the entire Gas consumption of the triggered transactions. However, I don't know how to achieve this goal. Is there a way to know the whole TX gas used? Thanks a lot! Can anyone run this tx using a BASE rpc? 0x13b7fc147880cf3815c6ccb739f14fc53b388309f3bdae85c94e834aebf26e79 How to save prviate key in config, so that I don't need to input when forge create you can use forge testing with forks which gives you the gas snapshots for each test and with the -vvvv option, you get gas consumption for each internal function too. I had a question too. Bc the amount of gas you pay for l2 is mostly for covering the l1 fees for the sequencer which just posts txs as compressed calldata to the l1 costing 16 gas per byte posted, do you need to take the compressibility of your code into account for gas optimizations? For L2，I have not considered optimizing the Gas of contract deployment at present, because compared to a large number of calls and executions, the cost of deployment is not high For L2, I currently pay more attention to reducing the length of calldata to achieve the optimized effect, and it is effective after testing ""forge test""can only tell me the cost of the call of the internal function. I would like to know how much the method I want to test consumes as a separate transaction.",433
1933,foundry-support.txt,"In other words, would you please tell me in Foundry, what is the difference between the gas consumed by internal function calls and the gas consumed by the entire transaction? As a whole transaction, does it only add a built-in 21000 gas and calldata gas compared to the internal function call? not sure if I understand but forge gives you the overall tx gas consumption too. Alternatively, you can use chisel. You can use gasLeft() before and after your function call. Not always accurate because of warm storage Is there any known bug or limit in the depth/runs of invariant testing? If I go over a certain threshold in term of runs/depth forge just keeps running forever and never finishes the test. For example: I've been running forge with a value of 256 runs and 300 depth for around 12 hours and it never finishes, while 256 runs and 200 depth finishes in about 1 minute... Yeah... I've checked rust traces and seems like forge enters an infinite loop just after shrinking the input. Is this a known issue? Hi, can we use foundry to run a local forked blockchain? I have seen that I can run it for the duration of a test, but what I want is to permanentely run a forked local node which is callable from various local clients? Use anvil thanks, I will have a look into it! anvil --fork-url NODE_URL (you can use an archive from alchemy, infura..) Hey, I'm in the middle of an expensive and complex (~25 tx, 5 contract) deployment on mainnet, and forge script has started failing with nonce too low errors when using --resume. I think because receipts are not properly matched. Anyone seen this before? does anvil allow multiple parallel connections from multiple clients? Hardhat really sucks at this He6 Hello Bro What do you mean for connection? Calling rpc ? Not really a foundry issue but is there a way to disable warnings for particular files or folders? Say for ./lib? yes, we have a team of about 10 people who would like to test some contracts using rpc connection at the same time. Hardhat seems to be only allowing single connections simultanously. Does anvil support the get_proof rpc method? having this same issue.",467
1934,foundry-support.txt,"is this not the correct way to use chisel? I'm not sure, sometimes when verification fails I'll flatten the contracts with forge flatten and verify manually that way check this new config shrink_sequence = false, shrinking could take a while if you have great depth specified and many invariants, this will just fail fast https://github.com/foundry-rs/foundry/pull/4868 Fwiw I fixed this by manually getting transaction hashes and receipts from the network and adding them to the latest-deploy JSON file mhh I never had this issue, it should work with anvil When I try this transaction, which is on BASE, I get an error I've never gotten before when doing cast run - - backend: failed while inspecting: Transaction(GasPriceLessThanBasefee) This seems strange because the transaction, though reverted on chain, did get on chain, and used 20% of the gas allotted to it What could this mean? Is it just me? Can someone try to reproduce with a quick cast run? Yeah tried this and it still says the bytecode doesn’t match. Tried cloning into remix and doing it and the bytecode doesn’t match. Set up the compiler config to match and snagged abi as json but that abi was different than the forge abi. Just copy pasting and looking at them and etherscan didn’t like either version What could cause a compiled contract to not match its bytecode? It seems impossible. But it has happened on three contracts in forge this week now. I assume it’s user error but maybe not since it only has happened since the last time I updated and had other issues too is there any way to do random distribution sampling in foundry? Hello, I'm having an issue generating deterministic addresses in foundry. It seems that the compiler is attaching metadata although I have the bytecode_hash set to 'none' and cbor_metadata set to false in foundry.toml. I've also run with the flag -- FOUNDRY_BYTECODE_HASH=none and --FOUNDRY_CBOR_METADATA=false. Yet in the artifacts there is still the field ""ast"". Is there another setting I should be looking at? or perhaps another config I should change that takes precedence over what I've been using? Running foundry config reveals the config is correct as well Hello guys! Using ""forge test"" I'm not able to make calls to a library function that has calldata arguments.",493
1935,foundry-support.txt,"The library is deployed using ""deployCode"". If I change the args to use simple types everything works fine, but as as soon as a struct/array is used then I got a revert. This might be a bug so I created a ticket (#4943) Any ideas? Thanks! In the docs here https://book.getfoundry.sh/config/vscode#4-solc-version, it says to set solc = ""0.8.17"", but in the actual file that's generated with MUD v2 it already has a value of solc_version = 0.8.13 should those docs say solc_version instead? But for such a team, if you are testing contracts maybe an api layer to simulate transaction on top could be helpful Echoing this, why is —mnemonics now a required parameter? (when using a ledger) hi, how do i enforce a failing txn onchain when executing a script if you're using ethers, just pass in gasLimit and it should go through i know how to do it in ethers but how do i do it on a forge script? Also, why am i not seeing the actual function names but the raw function selecotrs…? i have variables of these addresses saved as a variable within the script but shows up as unknown within the debugger/traces are invariant tests not providing any traces, logs etc if their is a revert? plz any1 Is there a way to use mockCall with anvil? Can I setup a mock return value for a function of a contract deployed to local anvil? We are deploying our contracts by using foundry scripts which are called from within a bash script. Within these scripts, we often read values from config files such as contract addresses that are constructor parameters. It used to be that if the script wouldnt find a value in such a config file, it would just store this address in the variable: 0x0000000000000000000000000000000000000032 But now things have changed. Now the script fails. And it doesnt return an error code, it actually returns a code 0 (success) but still fails silently.",438
1936,foundry-support.txt,"It also adds a weirdly formatted error message, e.g.: b""\x0b\xc4E\x03\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0 \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0?No matching value or array found for key .mumbai.tokenMessenger\0"" {""logs"":[],""gas_used"":30853,""returns"":{}} Two questions to Foundry team: 1) Was this change intended? 2) Would it be possible to return a error code (anything but 0) instead if a script fails? That would simplify calling them from other environments and dealing with error cases a lot invariants tests dont print any logs how can i make sure which addresses are currently part of targetContracts Yes you can use vm.mockCall That doesn't change the state in anvil though. I've tried. Works for unit tests not anvil. is it possible to bound fuzzed values not to a range but a set of values? Well it wouldn't really be fuzzing in that case no? the fuzzing campaigns use dictionaries if i understand correctly and top of that use some randomness. I would like to remove the randomness and have it only select at random some of the preddefined values set is that possible? otherwise how do i pick a random value of say 10 possible values in a foundry test as input. I want every test run to be different. is it possible to seed some randomness? i guess some outside logic call via ffi would work? probably your test failed and it is in process of shrinking, you may want to RUST_LOG=forge=trace,foundry_evm=info,ethers=info forge test ... to check that Thank you for teaching me that every mistake is just a Learning experience.I almost lost my house after losing so much money. I have Learnt so much with you.",480
1937,foundry-support.txt,"Ever since I have been trading with you, l found myself evolving both with respect to my career as well as a person . I invested $300 and got in return $3000 after 2 days Thank you so much Sir, for this wonderful opportunity. Click to join the channel and participate for the promo💯💯 that prints a bunch of stuff but not my actual console log..anyway i forgot to apend vvv flag 🙈all good if i make an assertion that know will fail my invariant fails but doesnt show me the details of the run that failed. how do i get the sequnce of calls that lead to it? hm, not sure why that happens for you, always get the steps / calls when an invariant fails 🤔 how big of a depth / runs you use? default for now just testing foundry invariants I'd try lower to 1 run and couple of steps, like 10 and see the output on our project as the screenshot indicates it does one run but has zero calls wierdly any ideas / feedback? Is there a way to deploy a contract to a predefined address using founding for the purpose of testing? what is the best way to seed randomness into your test with foundry? best to call some outside script with ffi? Trying to create a deploy script following the documentation... but I get this: 2023-05-16T11:55:42.693966Z ERROR sharedbackend: Failed to send/recv `basic` err=GetAccount(0x1804c8ab1f12e6bbf3894d4083f33e07309d1f38, (code: -32001, message: 27971855 could not be found, data: None)) address=0x1804c8ab1f12e6bbf3894d4083f33e07309d1f38 Error: Failed to get account for 0x1804c8ab1f12e6bbf3894d4083f33e07309d1f38: 0x1804c8ab1f12e6bbf3894d4083f33e07309d1f38 As if it were trying to deploy using that address shown there which is not the one from the private key. Private key is correctly loaded up.",486
1938,foundry-support.txt,"is there a way to tell foundry invariant sequnces to only call some target selector under certain conditions to avoid reverts? otherwise reverts are quite high another question, when invariants fail, looking at the sequence of calls that lead to it failing i see this call Handler::failed() which im not sure what it refers to. Handler is the only targetContract. there is no failed() method on the Handler yep, use targetSelector(FuzzSelector({    addr: address(handler),    selectors: selectors   })); Something weird is happening in my environment when using assertEq, I wonder if someone else has faced an issue like: ""No matching declaration found after argument-dependent lookup."" For instance, following the example from the foundry book if I change the assertEq to 42,42, I get similar error too. is it better practice to use 'address(this)' or something like address(alice)? Also, is there a good way to mock the _burn function in ERC20 contracts? FYI you can now also selectively disable reverts in particular tests https://book.getfoundry.sh/reference/config/inline-test-config vague q; what is the use case _mock_transferFrom(address(this), address(poolWrappedDepositToken), amount); that's a sample line test harness, inherit your ERC-20 contract and call burn https://book.getfoundry.sh/tutorials/best-practices?highlight=harness#test-harnesses I use address(this) throughout in those situations thanks! vm.etch https://book.getfoundry.sh/cheatcodes/etch?highlight=etch#etch State is not preserved between invariant runs, see discussion here: https://github.com/foundry-rs/foundry/issues/3005 Also, see @msolomon4's recommended solution here: https://t.me/foundry_support/34044 thx for your answer ! managed to make it work after looking at how maple did it and stored the timestamp in storage and set it before every sequence action 👍 cool @msolomon4 is issue #3005 the one you referred to in the message above? Thanks! can you generate bindings just from the artifacts or will they always do compile not sure what you mean by this. I mean say i have one target contract with two functions a and b. I wand a and b to be called during the run. However i know that b will revert in many cases.",493
1939,foundry-support.txt,"Hence to avoid those reverts i would like it to be only called under certaint pre conditions (state that was built up until now in the sequence). Also ideally i would want a breakdown of not calls: 5000, reverts: 2228, but the breakdown on a function level. say if b only reverted then i know i have a problem and should not gain confidence through the invariant passing not sure if this inline config works though here i specify a depth of 50 but as the terminal output shows there are 5000 calls per run those 5000 are actually 100 * 50 oh thats total yeah right mb thx what we did for this was to wrap call in a try / catch block and check if the revert is a legit one (like adding an amount of 0 into the pool so validation fail) or an unchecked one (e.g. overflow). If an unexpected one just throw it and fail the test, not sure if that's the best practice but worked for the project here's a sample https://github.com/ajna-finance/ajna-core/blob/main/tests/forge/invariants/base/handlers/unbounded/UnboundedBasicPoolHandler.sol#L32 We dig a bit into the issue, and the nonces are all good when we use individual (even one line) startBroadcast & stopBroadcast. But when we use .broadcast - then we have these nonce errors. I am now running anvil in a docker container. I am connecting to 0.0.0.0 as per manual. Can connect to the anvil process in the container and on localhost. Now I put the container behind a nginx reverse proxy and SSL container. Now I cannot reach it anymore. Get a 502 bad gateway. If I switch the image by an helloworld http reply server it works fine so its not the general proy or SSL settings. Something in the nginx settings is causing anvil to not respond. Do you guys know of any settings which could be problematic? trying to transfer tokens from address(this) to another address, getting ""ERC20: insufficient allowance"". Seems like this should not happen. for me at least it makes no sense since address(this) is the token owner...",454
1940,foundry-support.txt,"Foundry runs the tests in parallel, doesn't it? I'm investigating why our CI runs take so long (>1 hour) even for relatively small fuzz runs (500), and it appears as if our fork tests are run in sequence by GitHub Does soemone have a good repo about how to do unit test using Chainlink price feed in local using foundry ? Getting this message when trying to install openzeppelin contracts: The target directory is a part of or on its own an already initialized git repository, and it requires clean working and staging areas, including no untracked files. Check the current git repository's status with git status. Then, you can track files with git add ... and then commit them with git commit, ignore them in the .gitignore file, or run this command again with the --no-commit flag. What is this and how to resolve this ? Please read the error message, it’s explained right there 😅 Can a script impersonate a user when deploying to anvil? looks like anvil_impersonateAccount is the way to go will vm.etch work w/ anvil? I executed vm.etch(address(9), mycontract.code) but cast 0x...9 ""version()(string)"" says there is no contract at 0x9 hey thanks for this will have a look that sounds interesting! Are there any particular patterns people use to group/structure tests in foundry? I put two examples here and wonder if there are others https://twitter.com/0x_r4bbit/status/1658717661205872641 hi i want to test the trace_call method as provided in ethers-providers crate against a anvil locally forked chain. however, i could not get the result. am i missing some settings while forking, or i need to fork an archive node? I find it useful to separate the prologue/deployment/setUp into a separate contract in my case. It's a multicontract deployment which includes configuration calls as well. I then inherit the ""deployment/config"" base in the test contracts for specific parts of the system. Perhaps there's a different way using scripts, but I like it this way. I use each contract as a describe block and each setup as a beforeEach. The rest I go method by method and add incrementally more coverage for it.",474
1941,foundry-support.txt,"Thanks everyone for your feedback! See how I apply @gakonst's contract-as-describe-block recommendation in PRBProxy: https://github.com/PaulRBerg/prb-proxy Treasure! Thank you! whats the best practice to add randomness in foundry? is ffi best way to do it? are there any examples? fuzzing should work no? i want to randomly pick a value from 10 possible values. dont think fuzzing and setting boundaries can make this happen? don't know the exact details of your usecase, but would putting the values in array, then fuzzing the index work? yes thanks. 🙂 FoundryRandom is also solid, using it Hey! I'm using foundry for some tests. I'm using w3.eth.set_gas_price_strategy(medium_gas_price_strategy) which requires blockchain to already have a block to base gas price on it. It will work perfect if my anvil blockchain isn't empty but if I just create it then it will fail. Is there any argument to fix that while starting the anvil blockchain? I tried by adding --fork-url <public_rpc> but it makes transactions to take a lot of time You can set the base fee via cli I think I already tried but it won't work let me try again Won't work because the gas_price_strategy im using uses avg_block_time avg_block_time = _get_avg_block_time(w3, sample_size=sample_size) which wont exist on an empy anvil blockchain as it checks the last block is there a way to secure anvil with an api key without having to wrap a reverse proxy around it? Seems slightly similar to my recent feature request: https://github.com/foundry-rs/foundry/issues/4839 I am using vm.readLine function test_correct_solution() public {   string memory proof = vm.readLine(""./circuits/proofs/p.proof"");   bytes memory proof_in_bytes = vm.parseBytes(proof);   ultraverifier.verify(proof_in_bytes,correct_input);  } But it says [FAIL.",417
1942,foundry-support.txt,"Reason: The path ""./circuits/proofs/p.proof"" is not allowed to be accessed for read operations.] What could be the reason? you need to set fs_permissions in foundry.toml https://book.getfoundry.sh/cheatcodes/fs?#examples up if anyone knows if there is a way to make anvil work from start with a time based gas_price_strategy (web3.py library) Hey i'm using foundry for some test can some help me when i install foundry in my project after this when i run the forge init the give me the bellow error forge init Initializing /home/malikzay/Desktop/Foundary project... Error: Author identity unknown *** Please tell me who you are. Run git config --global user.email ""you@example.com"" git config --global user.name ""Your Name"" to set your account's default identity. Omit --global to set the identity only in this repository. fatal: unable to auto-detect email address (got 'malikzay@malikzay-Latitude-E7270.(none)') if some one know about this please help me Use —no-commit At the end of the command thanks a lot i solve my problem At the end of the command No problem how should i sync the abi from out directory to frontend code which is in another repo hey guys ,anyone knows if all foundry cheatcodes written in solidity ? I have a doubt, it is possible to replace a create with create2 in a contract and still get the same addresses? I think not because the first uses the nonce and the second the salt, any idea? Nope, most of them are in Rust, and some fo them are wrapped in Solidity Hey 👋 In the below script, I attempt to deploy a contract C ""before"" I start broadcasting. Since C is an EOA, the setNum transaction returns with a success flag. I was surprised that the require still succeeds in this test, and the only way to find out that the deployment failed was to look at the simulated on-chain traces reporting that no event was issued. Is this the expected behavior? I would have expected the require to catch the error.",446
1943,foundry-support.txt,"contract C {  uint256 public num;  event SetNum(uint256 num);  function setNum(uint256 _num) public returns (uint256){   num = _num;   emit SetNum(_num);   return num;  } } contract Deploy is Script {  function run() external {   C c = new C();   vm.startBroadcast(    77814517325470205911140941194401928579557062014761831930645393041380819009408   );   require(c.setNum(1) == 1, ""setNum failed"");   vm.stopBroadcast();  } } This happened to me recently spent way too long debugging. Makes sense when you think about how simulations work though. So the ""simulation"" is simulating the script and not the transaction? It simulates each tx that’s inside øf a broadcast Ok, got it. Got confused with the previous step. So the simulator just collects all the transactions in the script and then executes them one by one. Do you think it makes sense to put an EXTCODESIZE before each function call, similar to what the solidity compiler does? In the simulation it'll show a positive codesize your best bet is to run on an anvil fork and have a postscript in cast or solidity run a check once the transaction is broadcast so something like: 1) write the script 2) ensure the simulation passes 3) deploy to anvil fork locally 4) do a post deploy check on anvil 5) if all good, deploy on whatever network you want That's basically our workflow I was thinking of a new option to check the EXTCODESIZE inside of the *Simulated On-chain Traces* step. your simulation will succeed even if you check the codesize.",368
1944,foundry-support.txt,"the simulation will deploy all contracts, but only those bounded by startBroadcast and stopBroadcast will actually deploy on the network Unless I am mistaking you - I think you need to check against an actual deployment if that is what you are concerned about, and the easiest/fastest way to do that, that I know of, is with a persistent anvil fork (happy to be proven wrong though) A good post-deploy check is definitely great 👍 A quick way might be to log the deployment addresses in the console, then grep, sed and pipe the output into an array or tmp file, then run a code size check using cast on the addresses vm.expectRevert(bytes(""error message"")); Should I list all my reverts and index it? I was thinking in just type it manually, like you can do on HH e.g => to.be.revertedWith(""Caller is not the owner""); on the DOCs they declare an error whenever the user is not owner, on the tests they just invoke it and compare Is there a way to embed a constant value from an environment variable? vm.envUint, envAddress eccc Tried that. works in tests or scripts but not in contract code? Works where vm is available This will work with a string / bytes argument as well. Yea there's no vm in your src/. This would require some kind of preprocessor. weird that you can only call console.log with up to 4 parameters funny it has Rust like syntax tho is there an in-line config or otherwise a way to only take into account the gas used by a particular function invocation in fuzzers? this way the gas costs would only be computed for invoking functions you are interested in testing without taking into account the setup. Did you end up doing this? Unfortunately no, it's up for grabs 😁 Ha, okay. Wondering if theres any tooling setup to manage Safe and proxies in foundry What did you end up using? Not really. For testing Safes this exists: https://github.com/colinnielsen/safe-tools For proxies, I find they are actually quite clean to use verbatim in foundry scripts. E.g.: https://github.com/memester-xyz/competitions/blob/2f2cc13ecd02594afe291876cbc61896b25d0801/script/01_Deploy.s.sol#L26 Yep saw that.",483
1945,foundry-support.txt,"looks like only way now is to build the transaction and upload via json to the transaction builder I signed the transaction in our gnosis safe and exported it into forge to run simulations on mainnet Specifically we forked mainnet on anvil then ran our tests But we ended up using gnosis UI to build the transactions So build tx manually in the UI and then run sims to ensure correctness? Exactly We've sent the txes so I can send you the cast commands we used if you want, just drop me a dm if you need Yea that'd be great. GM im trying to figure out a way to capture events inside my tests. im not trying to assert an event i want to get the data inside it any help would be greatly appreciated Anyone know if it's possible (with minimal effort) to run forge scripts from rust? I have a rust codebase that uses forge-generated bindings and I'd love to run the scripts to deploy contracts for my tests. Each test runs against a separate anvil process ... I suppose I could just run forge script against that process...? Any other ideas? Any command to check the coverage level of my tests? Forge coverage I tend to ovecomplicate things, was looking at the docks bc I though forge coverage would be to simple used to js, where you have to install a package for basically anything If you use VS code, this will help (shameless plug): https://mirror.xyz/devanon.eth/RrDvKPnlD-pmpuW7hQeR5wWdVjklrpOgPCOA-PJkWFU How are you verifying contracts on tenderly with forge codebase? is it possible to load local contract source code when doing cast run --debug? Is there a way to execute sequentially two scripts with forge script and use the environment variables that the previous scripts set? Im assuming there is because if not why would vm.setEnv exist since it doesn't write it to a file but save the env var temporarily. Through their ui in the past, i’ve imported scripts as dependencies into a main contract and individually called their run() methods Ah thanks. not able to find a way to do it via cli like they do with hardhat ty Thanks a lot. I will be def use it. Was actually looking for something like that Im also using this plugin I found to format solidity, for some reason prettier alone is not doing it.",492
1946,foundry-support.txt,"I also have the Solidity extension, by juan blanco but doesnt seam to help in formating at all. npm install --save-dev prettier prettier-plugin-solidity its not breaking the code or anything, but this bug is annoying me a bit its just visual, forge compiles and tests normally. Imports ware done correctly and remappings work. its prob something with prettier. Anyone had this problem b4 on VSCode? Foundry Support Hey guys, sorry if it's a dumb question, I just installed foundry for the first time, I'm trying to use console.log in a test and it's not displaying anything. I did build before running the test and here is the code I wrote It's written to import ""forge-std/src/console.sol""; in the docs but when I do that it doesn't compile (Failed to resolve file: ""/Users/mkdir/Documents/Workspace/my-projects/forge-test/lib/forge-std/src/src/console.sol"": No such file or directory (os error 2). Where it has twice the src path Not sure what I'm doing wrong Try using forge test -vvvv. Also, I believe the default test class will also have console imported. Also in general using console2 is considered better. Yeah it's working, thank you so much trying to install foundry getting There are multiple binaries with the name 'anvil' present in your 'PATH'. but i don't have anvil >where anvil shows nothing pls help.. also: foundryup: downloading latest forge, cast, anvil, and chisel ################################################################################################################## 100.0% tar: Error opening archive: Unrecognized archive format so we removed -vvm shortcuts ? I used this alot forge test -vvm testname and it's no longer valid. nvm, i hacked around and found out Hi Always through this error. What is problem? the single-letter “m” shorthand indeed Hey guys, Please have been trying to deploy and verify to celo alfarjores network using script but have been getting this error while running my script ""backend: failed while inspecting: PrevrandNotSet"". And if I try to use forge create in my terminal it get deployed successful but not verify and this happens to celo testnetwork alone.",461
1947,foundry-support.txt,"Any help? how to rollFork in arbitrum if block.number returns l1 block number while rollFork takes l2 block number i want to advance the fork by a few blocks hi did you figure out the way to fix this? i’m trying to deploy using script to a Arbitrum fork network and facing the same issue try usiing the —legacy flag You can use vm.recordLogs() invariant_CurrentEpochId_Ge_LatestLoanId_All_Ticks() (runs: 100, calls: 5000, reverts: 3977) is it possible to have a more granular breakdown of the invariant runs? as in calls / revert per function selector on the target contracts for example? Just had the “did not match any file(s) known to git” issue (mentioned several times here) when doing forge install on an existing project. Solved it by first switching into contracts directory, then it successfully installs the libraries we’re using. I think it looks at the wrong lib folder otherwise. it seems that in my invariant tests calls to the below failed() count as succesfull runs. There is no failed method on my Handler contract. Is this something foundry internal? Handler::failed() ├─ [0] VM::load(VM: [0x7109709ECfa91a80626fF3989D68f67F5b1DD12D], 0x6661696c65640000000000000000000000000000000000000000000000000000) │ └─ ← 0x0000000000000000000000000000000000000000000000000000000000000000 └─ ← false regarding this if you have fail on reverts set to false how does this supposed to make your invariant test fail if there are say overflows we only run with fail on reverts true https://github.com/ajna-finance/ajna-core/blob/main/foundry.toml#L30 i see. i guess alternatively if expected reverts are tolerated but one wants to be made aware of unexpected errors one can set a boolean on the handler if set to false if any unexpected error throws. On the invariant contract that boolean is checked as part of every invariant correct,.",463
1948,foundry-support.txt,"that's what we do here https://github.com/ajna-finance/ajna-core/blob/main/tests/forge/invariants/base/handlers/unbounded/BaseHandler.sol#L174 basically requiring to be a legit revert 👍 anyone knows anything about this? Good morning guys, unrelated question: what do you thing of the idea of learning C for a better understanding of Rust? While it's a good idea, I would recommend spending energy just learning Rust directly The argument was that learning C will make you a better programmer in general and also show you the WHY of most guard rails Rust creates. Hey guys I'm trying to integrate foundry into an already created rust project. Except when I execute forge init, it says that the target directory is a part of or on its own an already initialized git repository. Am I using foundry the wrong when by doing that ? There is command line argument to skip git init Try --help Dayum yeah, thank you so much Anybody know of a Typescript lib for using Anvil? Is it possible to do a for loop inside of a test? I tried it and seems like the test just skips to the end, it doesn't matter what is in the loop. I want to run tests for every token in a money market. I have the necessary data in a struct array to loop over in each test.",274
1949,foundry-support.txt,"Yes, should be possible, wdym it skips to the end? It skips the test that is using the for loop? Looks like it was just not set up properly so the array to loop over was empty R u trying to run hh tests via anvil ? Its easier to just write tests in .Sol and test against anvil node ( local or hosted ) 👋 Hi folks! Is there any plans to add a kind of cheatcode to enable testing for internal/private functions? i cannot specify evm version shanghai nope, i have some usecase unrelated ot tests (And unrelated to hardhat) https://youtu.be/ZAiSou0CJmE Please, does anyone encounter the foundry framework runs solc then the CPU is occupied 100% and the thread is killed😅 how to deal with it my machine is ubuntu and core intel 2 Hi, I write a program bu foundry but i want test it on older block How can do it? hi sers i’m trying to use an anvil fork w/ ethers, do i need to specify addresses im going to prank in advanced? (Like in ganache’s `unlocked_accounts` config option) because it seems like when i call the `anvil_impersonate` rpc endpoint and attempt to do `forkProvider.getSigner(someAddressToPrank)` on the ethers provider, it says `invalid account` in gaanche, it would say that when the account isn’t unlocked, so i’n wondering where/if i need to specify the accounts im going to prank in advanced --fork-block-number for forks Hey saw you contribute a bunch to foundry Any shot you know why they use the .request in the fork.rs in anvil Here As opposed to a direct call with out serializing I don't know, does it matter? Doesn’t seem to I’m just modifying it to be generic over Middleware & that request is annoying Adds unnecessary indirection so just wanted to make sure it wasn’t used for something I wasn’t seeing I have a question about this code. Why us the second _isValid() test on the test function not called? It looks like after the first revert the function stops (although I am using expectedRever). Is this the right behavioiur? Good question. I think it returns after a revert and exits. I think it should not, right? But it's actually what's happening.",492
1950,foundry-support.txt,"Try loggin something after it It only happens with Libraries, with Contracts under the same circumstances the behaviour is the one I expect. Thid code can be used as example for both cases. I think it is a bug console.log don't show anythinhg after the _isValid call In practice has anyone seen the need for something like RetryProvider but for IPC ? For less powerful machines? forge test --fork_url FORK_URL --fork-block-number BLOCK_NUMBER Its Ok? guys i am getting error error[7576]: DeclarationError: Undeclared identifier. Did you mean ""Vm""? --> test\GasLessTokenContract.t.sol:22:20: |22 |   receiver = vm.address(2); // this is local address of foundry that will be act as receiver address vm is inbuilt in foundry is vm keyword deprecated? hey just starting out here, wondering if i should start with foundry or hardhat? the only concern i have would say that i only have js background, so would foundry be hard to pick up? well no. if you know solidity. then it wont. is there any vs addon i need to install to make this error go away? what if you close and reopen the file It doesn't matter what experience you have with other languages (JS, or whatever) Solidity code test should be tested in Solidity whats the utility in getting a gas snapshot of your tests? as that isn't going to mirror actual usage. since new foundry version i can't really run tests inside the vm? it eats up all the memory and it won't actually finish the test due to like 30mb left in memory.. anyone else having this issue? Did you figure this out? What did you end up doing? did you figure this out? A bit hacky but I think you have it in the stacktrace so you can force a test to fail to see it Well it gives you an idea of how much gas the function consumes in that scenario. Not extremely useful but sometimes it helps. More useful when fuzzing because more info is available Plus I think it's required internally for foundry to be able to do gas profiling since it's based off the tests The stacktrace outputted in forge test -vvvv ? Not sure how I should be tracing inside of functions to see what computations are the most gas intensive. Yeah no my bad, you just get a per call snapshot The one in the squared brackets WOW.",499
1951,foundry-support.txt,"did not realize that was gas usage haha. thanks https://book.getfoundry.sh/config/vscode?highlight=vscode#integrating-with-vscode follow that and it should go away. but make sure you dont have more than project in a workspace or you may still get erorrs No, unfortunately. See these issues: - https://github.com/foundry-rs/foundry/issues/3005 - https://github.com/foundry-rs/foundry/issues/4951 did many people's tests break after the breaking changes on forge? If so what were your most common issues? I'm trying to figure out but I don't see where it's wrong. We seem to be using expectEmit expectRevert in the right ways what breaking changes? Can you be more specific? Dont think we've cut the breaking changes yet There is smth here: https://github.com/foundry-rs/foundry/blob/c331b5eeee1b4151ef7354a081667e2d770b37f5/CHANGELOG.md#pre-10 Also, @evalir's thread on Twitter: https://twitter.com/hievalir/status/1657083381983891462 vm.assume reverts when called in a non-fuzz test, doesn't it? Yeh ok Yep Paul is correct here actually—we’ve been introducing breaking changes as they’ve been coming. All changes so far have been documented in the Twitter thread, and we’ll be doing a few more very soon which we’ll talk about again over here as soon as they’re merged it's non deterministic it seems. When I try to run the whole suite alot of tests will break, but when I run them in isolation with --match-test then it passes. Can't seem to find a pattern on why they're failing. The number of failing + passing cases also varies with each run Hmmm are the tests that are breaking fuzz tests? not exclusively. Even non-fuzz tests are breaking too.",409
1952,foundry-support.txt,"If anyone wants a sample: https://github.com/reservoir-labs/amm-core/actions/runs/5037575224/jobs/9034509350 Interesting—will take a look soon and let you know I reviewed all cases of cheatcodes, expectEmit expectRevert, don't think we're using them wrongly same here some tests (expectEmit) are failing after I did foundryup today Btw all—remember that if you want/need your tooling to be stable, follow the instructions in the changelog: https://github.com/foundry-rs/foundry/blob/master/CHANGELOG.md Should help while we finish the breaking changes and iron out any rough edges! seems like pressing 'a to jump to a vm.breakpoint(""a"") in the debugger doesn't work im running cast run -d -r <tx> but looks like the arrow keybinds for moving are broken, also it gets stuck at push0 code is there a way to see initcode sizes? the gas report tells you i believe hey is anyone facing issues with deployment scripts on cosmos evm chains? i found this issue from last year - https://github.com/foundry-rs/foundry/issues/2934 and i'm facing the same thing when deploying on canto Can you try with --slow Are you getting the same error? is there a way to verify contracts deployed by factories inside a setup script contract? for example say i deploy a contract inside one of its functions i deploy these clones   // adding addresses directly into the helpers array to get around the stack limit   helpers[0] = governanceERC20Base.clone();   helpers[1] = marketMakerBase.clone();   helpers[2] = hatchAdmin; // hatchBase.clone();  and i emit the addresses as logs, so i can get the addresses in the setup script contract. how would i verify these contracts? anyway to cast send a tx without signature to hardhat, tenderly, etc? @gakonst spam Ye set --from hey mate, any chance that there are issues with the speed of mining blocks when using anvil? it seems like it would always get stuck on that (i’m using it with ethers) when i just send a txn and use ethers’ .wait() to get the receipt, i can see in the logs it’s sending a bunch of `eth_blockNumber` requests.",490
1953,foundry-support.txt,"When i try to evm_mine manually between sending the transaction and getting the receipt, it would get stuck on evm_mine for that long. Hey everyone, I am trying to use Permit2 (compiled with 0.8.17) in a contract using 0.8.19 Is there a way to compile some libraries with an older solc version? I have tries this, but it doesn't work: [profile.default] src = 'contracts' out = 'out' script = 'scripts' libs = ['lib', 'node_modules'] solc_version = ""0.8.19"" gas_reports = [""*""] optimizer = true optimizer_runs = 20_000 via_ir = true [profile.0_8_17] libs = ['lib-0_8_17'] solc_version = ""0.8.17"" optimizer = true optimizer_runs = 20_000 via_ir = true Are you using web3.js or some other library? Ethers I have not observed problems with automining RPC, but some other RPC issued with Anvil, though rarely What issues? Perhaps I’m missing the actual underlying problem Sometimes gets stuck Or block not found Anything specific or just randomly? Randomly Let me find the ticket It should be insta mining by default. But it takes a long time… Even when I don’t manually mine it would take like 20+ seconds for me to get the receipt That doesn't sound right. Please open an issue with a repro and we'll investigate. The thing is, I’m not sure if the issue is with ethers or with Anvil Yeah hence the repro request 👍 will check a few more things and make one up if none resolve 🙏 question regarding invariant tests. is the full body of the invariant test that is prefixed with “invariant” supposed to run inbetween each call to a target contract? if so, why do no logs print that are placed in this body inbetween those raget contract calls but just at the end? Hey guys I'm trying to use Uniswap V2 in a Forge script but I'm getting these errors. Not sure how to manage that many solidity version mismatch.",446
1954,foundry-support.txt,"Is there some sort of solutions around that ? My script is just trying to load the router for now pragma solidity ^0.8.13; import ""forge-std/Script.sol""; import ""forge-std/console2.sol""; import { Token } from ""../src/mocks/Token.sol""; import { UniswapV2Router02 } from ""../src/uniswap/v2/periphery/UniswapV2Router02.sol""; contract InitDevnet is Script { address UNISWAP_V2_ROUTER = 0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D; UniswapV2Router02 uniswap; function setUp() public { uniswap = UniswapV2Router02(UNISWAP_V2_ROUTER); } function run() public { vm.startBroadcast(); console.log(""Uniswap Router: "", address(uniswap)); console.log(uniswap); vm.stopBroadcast(); } } I think you just have to make sure you compile with 0.8.13 What do you mean ? Because right now I'm actually trying to compile using 0.6.6 and changing every other contracts to match this by modifying their pragma range (only a few contracts have this exact version constraint, other can have a range, but I still have to modify some lines ...) I think by specifying 0.8.13 I'm compiling with this solc verison Is it possible to write to a persistent Anvil node w/ Test.sol? Or is Script required I think you need script cause you always need to broadcast the tx Hey guys - is anyone else's commandline shortcuts not working? When i try ""forge test -m test_case"" it doesn't work but ""forge test --match-case test_case"" works and also I have to add ""--verbosity -vvv"" instead of ""-vvv"" Also forge -v doesn't work for me anymore. I wanted to do a fresh install of forge but I couldn't find out how to uninstall it in the docs? Does anyone know how to reset a forgotten password on Ubuntu on Windows? Feel free to DM no worries figured it out! Here https://github.com/foundry-rs/foundry/issues/4666 Anyone having trouble importing OpeZeppelin libraries.",482
1955,foundry-support.txt,"Really hard to run ""forge test"" when all the imports will not stop being underlined red Use remappings Are there any good writeups on using Anvil w/ Ethers.js? Edit: Try changing changing all contracts to be the newest. Will take some small debugging w/ Uniswap, e.g. changing an int24 to an int256 before making it a uint Hey, I have some problems with fuzzing. I'm running a test in isolation with 10_000 fuzz runs and there's not a single problem. But when I run the test with all the others there's always a zero address in a fuzzed struct that manages to pass even tho I have a bunch of assumptions on the struct. Could it be a bug related with foundry? Maybe with the fuzzing dictionary? These are the assumptions I have and I still manage to have 0x0s in the struct Thanks will look into that hey there, quick one, is there any ""equivalent"" test helper in foundry such as parseunits and formatunits from etherjs for units conversation (wei, gwei, ether, etc)? I'm looking for a more friendly way than doing ""<amount> * 1e18"" Would be nice if forge test reverted by default if a test is using up too much gas. Had an infinite loop 😅 and was wondering why forge test just hangs. Scanned through help to see that I can set gas limit, and that revealed issues. An easy solution would be setting the default gas limit to something very high to have tests revert rather than hang. can anybody help Does anyone have a (multichain) deployment system built on forge scripts that they proud of? Doing basic stuff like address saving to a file and automatic verification. can anyone help me please last line gives you a command Wdym? It supports all that by default via forge script! hey i am getting this error with foundry up any help? ""tar: Error opening archive: Unrecognized archive format foundryup: command failed: tar -xzC /Users/calebsirak/.foundry/bin"" Is this in latest foundryup? Try reinstalling yes i have reinstalled it many times currently on a mac m1 max Trying to build an agent based modelling framework in which the agents directly interact with the contracts.I Already use foundry for smart contract dev, thought it would be a good addition to the ecosystem.",494
1956,foundry-support.txt,"It's there any tutorial on modifying the foundry code base to achieve this? Ideally want it to be similar to the tests we write in solidity, write the agents in solidity define the main loop and run until end conditions are reached @gakonst I ended up just using the latest stable release thanks for the help! What I mean is that the best system I currently have for this is something like this forge script: contract DeployCounter is Script {  string ENV_FILE_PATH = "".env.deployments"";  bytes32 CREATE2_SALT = vm.envBytes32(""CREATE2_SALT"");  function run() external {   console.log(""Deploying Counter contract"");   vm.startBroadcast();   Counter counter = new Counter{salt: CREATE2_SALT}();   vm.stopBroadcast();   counter.increment(); // just to give a non-zero value   string memory addrVar = string.concat(    ""COUNTER_ADDRESS_"",    Strings.toString(block.chainid)   );   console.log(""COUNTER_ADDRESS: "", address(counter));  } } with two bash scripts, one for deployment: CHAIN_IDS=(1 5 100) for chain_id in $CHAIN_IDS; do  rpc_var=$(echo 'RPC_'""${chain_id}"")  rpc=$(echo $(eval echo ""\$$rpc_var""))  # TODO have env file name as parameter  echo ""deploying Counter on chain $chain_id""  forge script DeployCounter --rpc-url $rpc --broadcast --private-key $PRIVATE_KEY done and one for validation (needed because you often need to try many times after deployment b/c of flakyness): CHAIN_IDS=(1 5 100) source ../../.env.deployments forge build for chain_id in $CHAIN_IDS; do  CONSTRUCTOR_ARGS=$(cast abi-encode ""constructor(address)"" $DEPENDANT_CONTRACT)  echo ""CONSTUCTOR_ARGS: ${CONSTRUCTOR_ARGS}""  etherscan_key_var=$(echo 'ETHERSCAN_API_KEY_'""${chain_id}"")  etherscan_key=$(echo $(eval echo ""\$$etherscan_key_var""))  echo ""Verifying Counter $address on chain $chain_id""  forge verify-contract $address Counter $etherscan_key --chain ${chain_id} --watch --constructor-args $CONSTRUCTOR_ARGS --verifier etherscan --verifier-url ... done This is better than I've seen so far, and yet it still feels very clunky to me.",497
1957,foundry-support.txt,"If for you have arguments for a constructor contract that are dependant on another contract (e.g. like an address), the passing around of these args via env var file isn't great. The ""COUNTER_ADDRESS_"",Strings.toString(block.chainid) is a hack that shouldn't even be needed because of the CREATE2_SALT (they all have the same address), but there is no overwriting keys in env var file, only append. Overall I am just trying to see if anyone knows of anything better or other ideas to improve. Getting this as well using foundryup mac m2 bumping this @gakonst Also getting this error while trying to install using foundryup Err: tar: Error opening archive: Unrecognized archive format foundryup: command failed: tar -xzC /Users/oxpampam/.foundry/bin foundryup: downloading manpages ######################################################################### 100.0% tar: Error opening archive: Unrecognized archive format /Users/oxpampam/.foundry/bin/foundryup: line 272: /Users/oxpampam/.foundry/bin/forge: No such file or directory foundryup: command failed: /Users/oxpampam/.foundry/bin/forge --version foundryup: installed - foundryup: warning: There are multiple binaries with the name 'forge' present in your 'PATH'. This may be the result of installing 'forge' using another method, like Cargo or other package managers. You may need to run 'rm ' or move '/Users/oxpampam/.foundry/bin' in your 'PATH' to allow the newly installed version to take precedence! Any help? Thanks look up the most recent stable release @Ayo_of_klaytn do foundryup --version nightly-e15e33a07c0920189fc336391f538c3dad53da73 foundryup installed successfully Thanks @calebsirak 🫡 iirc you just need to verify the base contract when you deploy it.",419
1958,foundry-support.txt,"If your base contract is verified then the clones will automatically get verified That’s the thing, the base contract are being deployed inside the factory and the factory is what is being deployed by the script, so how do you deploy the bases? Oh I thought you were using minimal proxies to clone you can compile different version by doing so: https://github.com/hbarcelos/forge-multi-version/tree/master Note: I personally have issue to compile `lib/dependencies` in a dfferent version Yea this is clunky. Isn't forge script --verify working? Use latest stable Nightly broke somewhere gotcha, thanks the contract that im deploying is a PluginSetup contract using the new Aragon protocol. These setup contracts deploy plugins, helper contracts some of the plugins are minimal clones, some are UUPS. but when the PluginSetup is deployed then it deploys the base class for the Plugin. everytime the PluginSetup is called then it creates a new clone. but the issue is that base deployment. How do you verify that contract since it is deployed inisde a contract inside a script contract? has anyone had any luck integrating Foundry with the AWS KMS signer? https://github.com/foundry-rs/foundry/blob/638bd2e0040962731d220eb33d8b692ca99afaa5/cli/src/opts/wallet/mod.rs#L227-L235 so this should work forge script foo/bar.sol --aws true KMS_ID=12933-foo Hello, forge install openzeppelin/contracts-upgradeable prompts me for my github password, while forge install smartcontractkit/chainlink does not. Is this due to some config on my end or should something be updated on the openzeppelin/contracts-upgradeable side? fixed it. path needed to be updated to reflect the actual repo name: forge install openZeppelin/openzeppelin-contracts-upgradeable any1 also getting this suddenly?: Deserialization Error: expected value at line 1 column 1. Response: upstream connect error or disconnect/reset before headers.",422
1959,foundry-support.txt,"retried and the latest reset reason: connection failure can anvil listen on IPC? I'm wanting to experiment with IPC and would like to use anvil for my tests if possible Hi how we can test by foundry tools build ed contract I found a hack to make it work for now, since I use svm to manage my solc versions, I simply call chisel with the proper svm path like this: chisel --use ~/.svm/0.8.17/solc-0.8.17 Simply change the svm or solc path and it should work perfectly. Hey guys, I would like to use a mainnet fork with anvil, deploy a token and create an uniswap pool and then interact with the pool using my scripts. To interact with the pool I'll need the deployed token address. I thought about storing this in a json with a readFile cheatcode. Is this a good idea or are there better solutions for that use case ? Or maybe multiple .txt files, it seem easier to read and write from You cannot use cheatcodes with Anvil afaik Just deploy it programmatically and store the address in your script Are there any particular best practices or patterns wrt testing with foundry? Any particularly useful templates? Check the docs my friend, there's literally a section called best practices :) Hah, appreciate you. 😅 Epic Would it need to be AWS_KMS_KEY_ID instead of KMS_ID? Thanks for sharing, I was looking for this integration and didn't know it was built into Foundry. Yea the env var For aws sdk yes typo I recently ran foundryup and started encountering Message: failed to extract foundry config: foundry config error: Solc version 0.8.20 requires EVM version shanghai or higher. You can fix this by specifying evm_version = ""shanghai"" in your config file. Location: config/src/lib.rs:451 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry my foundry.toml still dictates solc = ""0.8.19"" so not sure whats wrong do you have an evm version specified? are any of your contracts specifying another solc version? happy to look into this with a repro Unfortunately, repo is not public yet.",473
1960,foundry-support.txt,"I'll try evm version to something older than shanghai and report back For now, downgrading back to old foundry works though thanks! this warning comes up if you’re trying to use shanghai as the evm version but aren’t setting 0.8.20 as compiler version. setting evm_version = “london” should work src = 'src' out = 'out' libs = ['lib'] ffi = true optimizer = true optimizer_runs = 20_000 solc = ""0.8.19"" evm_version = ""london"" with this as foundry.toml, it still returns same error forge script script/deploy_DeployProtocol.s.sol:DeployProtocol --rpc-url ${MAINNET_RPC} --private-key ${PRIV_KEY} --sig ""deployProtocol()"" -vvvv --broadcast --slow --verify --use 0.8.19 --evm-version london Passing this explicitly doesnt seem to help either right, does this only happen to you with forge script? No, forge build, forge test also error out with same message gotcha. I can’t seem to reproduce though—i also did foundryup. could you maybe whenever you have time file an issue along with a minimal repro so i can look into this? Thanks, i resolved it. a dependency i was using had set their solc version to 0.8.20. Changing that resolved the issue Ahh thanks—suspected something along the line was the case. Due to 0.8.20 bringing compatibility issues we decided to actively error when it’s being used in an unintended manner. While it seems cumbersome, we wanna avoid people deploying contracts with unsupported opcodes (PUSH0) on chains that don’t support it. That’s the reason we’re strict about this now We should absolutely fix the “this is a bug” part though, because it’s not :) Thanks. Totally understandable Has anyone faced an issue in forge script --verify where script successfully compiles and deploys a contract but etherscan somehow fails to compile the same contract.",422
1961,foundry-support.txt,"btw other contracts deployed in the same script verify just fine Submitted contract for verification: Response: `OK` GUID: `dfarfhge72shjsspkkwawkgyhf9usv9sxfzkwqkg3k12wdk4fl` URL:https://goerli.etherscan.io/address/0xa2887eb718af928016a19f151e5da8933da48f74 Contract verification status: Response: `NOTOK` Details: `Pending in queue` Contract verification status: Response: `NOTOK` Details: `Fail - Unable to verify. Solidity Compilation Error: Definition of base has to precede definition of derived contract` Contract failed to verify. Ah yikes etherscan api strikes back is there a way to not stop the script if one verification fails and chug on with the rest of the verifications? Nope we should just not fail verification but I see what you mean We'll be rewriting scripting soon So this will get better - in the meantime do you have a workaround? Can you open an issue with a repro on Github? That would make it easier to identify and fix properly sure Thanks. Make it minimal pls! can the desploy script be past the 24kb contract limit What is best practica as code repository; to have a monorepo with frontend and contracts, or two different repos? Hi every one how i can test a contract which is not created in foundry but i want to download the source code of contact and test by the foundry how i can? Is there any vm command (“vm.dropCache”) to clear the warm cache accesing the storage? I am measuring the realistic gas cost separate repo easier, u can run npm run ... or forge test, etc. at top level mono repo matches contract/UI versions, which is useful for rapidly chaning code. not as important down the line I am not sure how this would be feasible without using libraries / diamond contracts . Its a hard limit in the EVM (at least on mainnet). Tests let you by pass this , because its a simulated environments and it makes sense I'm having some trouble upgrading an implementation address on a proxy contract in a foundry script where the error trace is a bit opaque.",461
1962,foundry-support.txt,"how to reset fork after transaction receipt gotten? I found api.anvil_reset(Forking), but i can not import Forking type and dont know, how to do it That's really cool. How do you like the AwsChainProvider in general? Trying it later today , should be ok , will play back . Not using it as a library , so wont really be testing ergonomics , i just need it to work with Foundry On invariant handlers I usually do something like require(i < 200) or some crazy amount Because I've had that happen to me more times that I'd like to admit Looks like 0x5610480AB807BBDeDdEBC01a4936e276120DAFAc is delegatecalling to 0x26baA3e289552EE1C0863D444BdC0A3463C72b3C, i.e. proxy is hitting the fallback? Are you sure the correct sig is upgradeTo(address)? Maybe it's not implemented as a TUP but some other type of proxy? In which case your cast might be wrong If it's verified on etherscan just get the source code from there hi sers howd i install foundry on a docker container run this container https://github.com/foundry-rs/foundry/blob/master/Dockerfile https://book.getfoundry.sh/getting-started/installation#using-foundry-with-docker but it’s telling me to just use the provided docker image, and i want to (obv) install it on my own service’s image… howd i do that? ok so i added this to my docker file but anvil is not found still do i need to foundryup it as well? Anyone has encountered this error? InvalidFEOpcode oh I think the issue is that foundry does not support Arbitrum pre-compiles Hey, confirming facing the same issues today on forge 0.2.0 (59f026f 2023-05-24T00:03:36.014601205Z).",425
1963,foundry-support.txt,"Also it seems like the behavior explained here: https://book.getfoundry.sh/cheatcodes/expect-emit?highlight=expectEmit#description regarding the ability to ""skip"" event as long as the ordering is correct is not working anymore and if the very next event emitted does not match your expectEmit the test revert (even though the event is correctly emitted later in the call). Hey guys, I have several cases I want to test using the same test function through a for loop, is there a way to reset the state after each iters fo the for loop, I wonder if anyone has workaround to this? Yup, see vm.snapshot() and vm.revertTo() Solved! Thanks a lot seems to work fine . You can use it as a base ubuntu@ip-172-31-95-221:~/infrastructure$ docker pull ghcr.io/foundry-rs/foundry:latest latest: Pulling from foundry-rs/foundry ca7dd9ec2225: Pull complete 2de6490c5039: Pull complete 74616773a5d5: Pull complete 305d1fddba5c: Pull complete cab4bbc54f7a: Pull complete 12fc776e2eb2: Pull complete 37672f758dad: Pull complete Digest: sha256:094e306adc5677db2af5722cf89e182c739264c48d0e7874d27afa92b592f187 Status: Downloaded newer image for ghcr.io/foundry-rs/foundry:latest ghcr.io/foundry-rs/foundry:latest ubuntu@ip-172-31-95-221:~/infrastructure$ docker run -it ghcr.io/foundry-rs/foundry:latest /bin/sh / # which anvil /usr/local/bin/anvil interestingly, latest doesnt have chisel. probably an easy fix with the ci you dont need foundryup , what it is doing is downloading pre built binaries to your local. The docker image should have the additonal binaries and that image you just built should have anvil in it .",452
1964,foundry-support.txt,"Happy to help more in DMs so we dont clog the chat why does anvil try to fit 2 txs that don't fit in a 30e6 gas block instead of putting 1 tx on one block and the other on the next block? hey! Lemme shoot you a dm🙏 ack—looking into this today! While here was wondering how difficult would it be to have a similar behavior for excpetRevert ? Just bumped into this as well; the dependency which caused this error in our case is Solady, which has upgraded to Solc 0.8.20 By ""changing"" that, I suppose you mean downgrading to a previous release of that dependency which doesn't use Solc 0.8.20? Yes. We're not using Solady in production, but Foundry throws that EVM version error nonetheless. Also, I thought that third-party dependencies' Foundry configs are not taken into account when the compilation settings are resolved? Yes solady was the culprit for me as well. Had to downgrade it to an old commit We made a mistake here, sorry everyone. The Push0 thing we took a conservative stance on To avoid ppl shooting themselves ```` [⠢] Compiling... [⠰] Compiling 18 files with 0.6.12 [⠔] Solc 0.6.12 finished in 1.19s Error: Compiler run failed: Error: Internal compiler error (/Users/distiller/project/libsolidity/codegen/CompilerUtils.cpp:1441)💀️ ```` Just curious whether anyone has any exp deploying/operating diamonds w Foundry on zkSync - any particular challenges to be aware of? I'm having an issue getting the vm.assume() to work as expected. I have a very simple test: 1 function test_parseVM(bytes memory _vm) public { 2  vm.chainId(1); 3  vm.assume(_vm.length >= 5); 4  vm.assume(_vm.toUint8(0) == uint8(1)); 5  messages.parseVM(_vm); 6 } The test contract uses byteslib for bytes https://github.com/GNSPS/solidity-bytes-utils/blob/master/contracts/BytesLib.sol#L309 And line 5 of the above test is failing with toUint8_outOfBounds.",493
1965,foundry-support.txt,"That should be impossible if line 4 passes I'd expect, but it appears to be the case. Here is the relevant forge test -vvvv output: [11429] TestMessages::test_parseVM(0x0100000000) ├─ [0] VM::chainId(1)  │ └─ ← () ├─ [0] VM::assume(true)  │ └─ ← () ├─ [0] VM::assume(true)  │ └─ ← () ├─ [1715] ExportedMessages::parseVM(0x0100000000) [staticcall]  │ └─ ← ""toUint8_outOfBounds"" └─ ← ""toUint8_outOfBounds"" Test result: FAILED. 0 passed; 1 failed; finished in 19.02ms Failing tests: Encountered 1 failing test in forge-test/Messages.t.sol:TestMessages[FAIL. Reason: toUint8_outOfBounds Counterexample: calldata=0x6399dfaf000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000050100000000000000000000000000000000000000000000000000000000000000, args=[0x0100000000]] test_parseVM(bytes) (runs: 0, μ: 0, ~: 0) Additionally, I'm not sure of the best way to put the calldata and args into chisel so I can reproduce the _vm.toUint8(0) revert with ""toUint8_outOfBounds"". I'm definitely deploying a TUP ``` uint256 deployerPrivateKey = vm.envUint(""PRIVATE_KEY""); address feeCollectorAddress = vm.envAddress(""FEE_COLLECTOR_ADDRESS""); vm.startBroadcast(deployerPrivateKey); NFTPrinter nftPrinterImpl = new NFTPrinter(); TransparentUpgradeableProxy proxy = new TransparentUpgradeableProxy( address(nftPrinterImpl), address(this), abi.encodeWithSignature(""initialize(address)"", feeCollectorAddress) ); vm.stopBroadcast(); ``` it seems that the resulting TUP address is not being loaded in properly from my update script but I'm still unsure why. Fixed it. The address(this) was computing a different address than the public key associated with PRIVATE_KEY.",498
1966,foundry-support.txt,"After redeploying the proxy wth the admin set to a hard-configured public key `DEPLOYER_ADDRESS`, I can now interact with the proxy contract without hitting the fallback functions: ``` uint256 deployerPrivateKey = vm.envUint(""DEPLOYER_PRIVATE_KEY""); address deployerAddress = vm.envAddress(""DEPLOYER_ADDRESS""); address feeCollectorAddress = vm.envAddress(""FEE_COLLECTOR_ADDRESS""); vm.startBroadcast(deployerPrivateKey); NFTPrinter nftPrinterImpl = new NFTPrinter(); TransparentUpgradeableProxy proxy = new TransparentUpgradeableProxy( address(nftPrinterImpl), deployerAddress, abi.encodeWithSignature(""initialize(address)"", feeCollectorAddress) ); vm.stopBroadcast(); ``` //what is assertEq in foundry test A unit test assertion: https://book.getfoundry.sh/reference/forge-std/assertEq I'm having some problems calling a contract factory from a s.sol script. Are there any good resources to read on this? what's your problem? https://github.com/lifinance/contracts/blob/dev/scripts/deploy/facets/DeployReceiver.s.sol Here's an example from our Github in which we deploy a contract from a .s.sol script using a (already deployed) factory contract. Maybe this helps you Is there a way to broadcast txs using foundry and frame.sh? I have worked on a possibile check to forge that detects invocations of non-existent contracts https://github.com/foundry-rs/foundry/pull/5036. I believe that function calls to external accounts (EOAs) should at least not be decoded as if they are contract calls. I'm trying to determine what arguments the constructor was called with. Is there a way via foundry or cast to decode the ""Contract Creation Code"" bytecode shown on a block explorer? Alternatively, is there a cli way to view an internal storage var? Rust Send an example mockCall question: how can I mock a call multiple times with different results? e.g. in function test , it'll call tokenA.balanceOf(this) twice, can I mock these two calls with different results? It seems impossible in Foundry but trivial in other typescript libraries like smock.",449
1967,foundry-support.txt,"Joining here too Will join all foundry tgs hey people, last time i checked you couldn't start an anvil instance programmatically like in ganache, have things changed maybe recently? In which language? well i don't mind the language just a way to spawn an instance like ganache has Ganache.provider() Why foundry cant fork tron network? https://docs.rs/ethers/latest/ethers/core/utils/struct.Anvil.html Any updates on this issue? 🙏🙏 Just saw your message about using the Pre 1.0 nightly build to avoid breaking changes. All good, thanks https://github.com/foundry-rs/foundry/blob/master/CHANGELOG.md thanks! Hey there, calling vm.mockCall on an address that has been generated with makeAddr reverts. It is working well with an handmade address like address(0xcafebabe). Sounds like a bug, any idea? Thanks @admin Hello everyone! Suddenly such errors started to appear on almost every test I run. Regardless of RPCs. Tried many of those Can someone help with this please? Are you using a normal RPC node or an archive node? yeah seems like my getblock rpc is not archive. Can you please suggest any free archive rpc on eth? went over different rpc on chainlist and found out that this one works) https://rpc.ankr.com/eth Hey! my tests external calls are failing with [FAIL. Reason: EvmError: Revert] after using vm.rollFork any idea? (contract is deployed locally and im not forking to future) I'm having those import error for ages now, anybody else? It works perfectly tho, I'm running all the test but for some reason VScode still think the import are wrong Does anyone know if there are docs anywhere about using Foundry for Integration Testing? Imagine you want to run a bunch of units tests, but ordered, and you want each one to persist its changes against Sepolia or wherever, so later test steps can build on that.",417
1968,foundry-support.txt,"I think the VS code extension is borked as of late I am having weird import errors that crop up after a few minutes they go away when I reload the window they also go away when I downgrade the extension Create an anvil fork in a terminal, and use the localhost:8545 as the rpc for your tests You could broadcast these in a forge script too that would persist them like you describe For me too, they come and go. But everything works. I figured if you import without the remappings it makes the errors go away in some cases Why foundry cant fork tron network? Any one can help me for this ? I need a fork q contract in tron network. I think tron has a different algorithm to generate addresses, so maybe it's not fully evm compatible ? Tron uses their own TVM afaik Anyone knows what that mean ? No associated wallet for addresses: {0x3c44cdddb6a900fa2b585dd299e03d12fa4293bc}. Unlocked wallets: [0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266] When launching a script on an anvil mainnet fork Ahh no I get it, I launch the script with another private key but I try to prank with another public address. It's not possible to do that ? The Tron docs say ""TVM is basically compatible with EVM"", so its not 100% and the differences could explain why EVM tooling might not work My guess is there's an unhandled exception somewhere in the extension that is crashing the import path resolution You need to provide a private key for that wallet I think ""basically EVM compatible"" means you can deploy Solidity smart contracts on Tron, but I'm pretty sure the node infra is different You can't prank without providing the private key ? You can't prank in scripts Ah I mean broadcast then If you're broadcasting, you need to provide the private key of any accounts you want to unlock Okok I didn't know that thank you :D How can i increase ETH balance for testing in contract? I created this server for Foundry since there doesn't seem to be one that is focused on this topic.",463
1969,foundry-support.txt,"It's a place for people to ask for and give help on Foundry, feel free to join! Happy to give Foundry core contributors Admin rights as well - i'm just an amateur looking to make Foundry more accessible and as easy as possible to use for the community https://discord.gg/YGenZJM32G Hey team, I'm trying to update my foundry dependency. Getting a ton of compiler errors, for example: error[E0277]: `WriteJson1Call` doesn't implement `std::fmt::Display` --> /Users/kristian/.cargo/git/checkouts/foundry-f7cca724e93059b0/33f3fee/abi/src/bindings/hevm.rs:6262:72 | 6262 | Self::WriteJson1(element) => ::core::fmt::Display::fmt(element, f), | ------------------------- ^^^^^^^ `WriteJson1Call` cannot be formatted with the default formatter | | | required by a bound introduced by this call | = help: the trait `std::fmt::Display` is not implemented for `WriteJson1Call` = note: in format strings you may be able to use `{:?}` (or {:#?} for pretty-print) instead If anyone has an idea about this, that'd be very helpful 🙏 You prob trying to log something that doesnt have a Display trait meaning the compiler basically doesnt know how to put that information on the console for you, you have to tell it. https://lannonbr.com/blog/rust-display-impl/ check this one out Thanks for the comment @JoaoBatista99! It ended up being an ethers-contract issue. If you're upgrading anvil as a dependency from Github, you need to patch in the ethers-contract from the ethers-rs repo instead of the crates.io version. What's the best way to debug this message? I was using cast send to interact with a contract on anvil: (code: 3, message: execution reverted, data: Some(String(""0x2cfdc161""))) I'm assuming`0x2cfdc161` is a function selector? I have tried forge inspect on my contract, but it doesn't match any selectors. I have tried flattening my contract and using forge inspect on the flattened file, but you have to provide the contract name as forge inspect doen't check the entire file...",492
1970,foundry-support.txt,"Any suggestions? cast 4byte might help @SamuelDare thanks for your help, i tried cast 4byte and nothing happened - nothing was outputted to the terminal at all... Anyone know why await provider.waitForTransaction from ethers-js would not work with an anvil instance which has 10 second blocks (mining turned on) ? This use's eth_getTransactionReceipt under the hood which anvil supports ... so in theory it should work right https://openchain.xyz/signatures This one will help you testing on foundry I get this weird behavior While localGpb is normally set to bytes32, the next variable interprets the same value as uint256 Im trying to pass it to a function to verify is a given address is part of an list using merkle trees is using create3-factory a generalized standardized practice? or only for multiple chains? really weird, requiring a flag that I'm not even calling? why would I fork if I'm deploying to a mainnet your AVAX RPC URL param is not set it’s a bad error msg I think it's because --rpc-url is just an alias for --fork-url yeh i test this custom error contract the give me the following result but i don't know in this result what of this test someone explain this result but what is they purpose of foundry test which thing the test This is the solidity compiler, not Foundry. Just add an explicit cast to bytes32 for the first element of the array, and it will treat the array as bytes32[] instead of uint256[] IMO create2 should be used unless it's not possible to have the same address using this technique (like different constructor params). If using create3 you should ensure that you're not mixing up the salts for different contracts, as well as use the factory that enforces the deployer address check (or hashes it with salt) What do I need to do to make bytecode deterministic? I've already tried setting bytecode_hash to none and cbor_metadata to false You sir, are blessed. Thanks a lot, that solved my problem. That explains why it was working on remix when I passe via function is there a difference between solc and solc_version in foundry.toml? when i look at the config described here, the example snippet shows solc as specifying the compiler version: https://github.com/foundry-rs/foundry/tree/master/config#foundrytoml.",493
1971,foundry-support.txt,"but when i look at the documentation here: https://book.getfoundry.sh/reference/config/solidity-compiler#solc_version i only see solc_version and no mention of a solc key. if there is a difference, please let me know. otherwise, i would suggest we update the documentation to only reference either solc or solc_version to avoid confusion. hey there foundry people, I'm forking a chain locally and vm.pranking an address that is valid to make a call to a contract, but once I do it contract simply reverts call with ""EvmError: Revert"". Call goes through onchain normally without any issues. Despite using vm.prank, could the contract be identifying the caller as a non-EOA? Any idea on what could be happening? hi, does foundry support PUSH0 opcode? i tried to use foundry to run a contract that contains the PUSH0 opcode but it reverted when it reached the PUSH0 opcode Its a solidity .8.20 and use with cautious. CTRL + F here for more info IIRC , it can break your tests due to some limitations Hey getting an error in some cast scripts that previously worked ``` Error accessing local wallet. Did you set a private key, mnemonic or keystore? Run cast send --help or forge create --help and use the corresponding CLI flag to set your key via: --private-key, --mnemonic-path, --aws, --interactive, --trezor or --ledger. Alternatively, if you're using a local node with unlocked accounts, use the --unlocked flag and either set the ETH_FROM environment variable to the address of the unlocked account you want to use, or provide the --from flag with the address directly.",354
1972,foundry-support.txt,"``` Here's my script it impersonates an account on a local anvil fork, then runs a transaction I tried adding --unlocked to the cast send (following the error message advice when using —from) but doesn't appear to do anything As mentioned, this script worked great a month ago Can't find any docs on --unlocked in cast send either so assuming this is something new? EDIT: added a PR Figured it out - you need to put --unlocked AFTER --from so the correct command looks like this I think you need to add a private key using the --private-key flag, see here: https://book.getfoundry.sh/reference/cast/cast-send I don't have the PK this is a gnosis safe it's an rpc call to anvil that unlocks the account locally ah ok sorry i don't know then, i'm still learning 😅 Solution is above but thanks for helping out :) No worries man 🙂 I've just re-read your message and seen your solution, nice! Guys i've noticed that if i just spin up anvil and make up a cast send command, with no contracts deployed (literally just spun up anvil), the transaction looks (to me at least) like it succeeded.",251
1973,foundry-support.txt,"For example, if i run this immediately after running anvil: cast send 0x9965507d1a55bcc2695c58ba16fb37d819b0a4dc ""x()"" ""1"" ""1"" --private-key $privKey --value 10000000000000000 The output is: blockHash    0xecf4cb7a47b948ffe28ea2e58b196acf0c9d78429c9eb1f5ea1b5767c22092e3 blockNumber    9 contractAddress   cumulativeGasUsed  21064 effectiveGasPrice  3301209098 gasUsed     21064 logs     [] logsBloom    0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 root      status     1 transactionHash   0x4b7c8aa61ac676c33dd78a414b4f2b641e1a3bdfd73858f3f8e43bde19b9b5b5 transactionIndex  0 type      Is there anything in the output that tells me that this wasn't successful, in that there is no contract deployed at the addresss with a function called x()? Just trying to work this out so i don't get tricked later down the line and make a mistake thinking the tx was successful when it really did nothing...",452
1974,foundry-support.txt,"Hello everyone! Just noticed a weird bug, wrote a really simple test that just queried a bytes32 --> struct public mapping by ussing the getter (and observing the output via verbose logs), sometimes the getter correctly returns the correct value, and sometimes the output is as if the value was empty for that key (got this output just by executing the test two consecutive times, no fork, nothing weird here). However, the struct has been correctly populated, since internal functions calling the same struct are running smoothly, so the problem seems to be in the getter/logs.Did anyone experienced something like this one? Hi, I have a function iterating over an array of MockPool contracts, but occasionally it logs the 0 address. What could be causing this, given that I'd expect all entries to be nonzero MockPool addresses? contract MockPool {  uint256 public data = 5; } function test(MockPool[] memory poolsToAdd) public {  vm.assume(poolsToAdd.length > 10);  for (uint128 i; i<10;) {   console.log(address(poolsToAdd[i]);   unchecked {    ++i;   }  } } can we call get/post api like axios in foundry? Just noticed that if i run anvil and then in my script use vm.startBroadcast, I can pass in the private key for an account for startBroadcast instead of an address and all txs are run from the associated account? I'm guessing this is intended but afaik isn't documented in the docs?... Hi Guys as we know that if we want to verify any contract which is deployed through the foundry script then we use —broadcast —verify, but the contracts will not get flattened , so if we want to flatten those contracts before verifying it any one know how its work? Why do you want to flatten the contracts before verification? Foundry already handles imports during verification eliminating the need for manual flattening of files If you want to manually flatten you can use forge flatten <file_path> but the contracts will not be got flattened in the verification is there any way possible that we flatten the contracts during the verification , so when we see the verified contract it would be flattened. Then the easiest way that I could think of is to flatten the contracts first before deployment so that you can verify the flattened contracts That's like...",473
1975,foundry-support.txt,"reverse development Those who flatten their contracts is not a real dev anyway :) Hello did you find a solution for this? I am having hard time trying interacting with USDT on my Ethereum fork Anyone has experience with soft failure with ffi? It runs but doesn’t produce any result! In this case, nargo can only be run in circuits! everything after cd is an argument to the cd program, so ""&& ..."" won't be actually run as intended I don't know why it doesn't fail tho weirdly, it works if I manually run it at the root of the project hey guys , i'm testing with foundry and i'm calling the function initialize for the second time from proxy contract that already deployed , in my understanding when a function revert the call function returns (false) but in this case the call reverted and it returned true ??? how so any one can explain ? yes, but you're running it in a terminal which under the hood invokes something like sh -c ""${input}"" So I suppose I am in a pickle jajaja, nvm found a workaround cast run broken for arbitrum txs? almost all fail with Transaction(GasPriceLessThanBasefee) Hey can someone pleas help me with the expectRevert cheatcode? From the documentation: If the next call does not revert with the expected data message, then expectRevert will. So if the next call after expectRevert does not revert, I thought expectRevert will and fail the test, however, that's not what I'm seeing on my tests. Can someone explain? What's the format of constructor args file? I'm using --constructor-args args.js module.exports = [ ""0x745B851b853675837CCC804B1fd3637D61628E50"", ""0xcb8df590ee6f0d64e5889d6bc7411b8f939c86b0e19ae1606638fd0346d79697"" ]; But I get Failed to parse `args.js, expected value of type: address` For example, both of these test pass: I do ""vm.expectRevert(bytes('revert message'));"" with the revert message, and remember, if you are pranking an account, it wont come back to the default after interacting atleast once with the contract. So reverts actually keep using the same pranked address untill a state change. deal() is a foundry cheatcode.",500
1976,foundry-support.txt,"Maybe it doesn't play well with other helpers Thanks, it works as expected when the next call is not a cheat code. Good to know! Yes :( cast run -q for quick mode (where previous txs from the same block are omitted) works, but the results may differ from what has actually happened (as omitted txs could have changed the state) Yeah seems like a weird error since if those txs were included in the block they should've had gas price greater than base fee already Is there any natural source of entropy when running forge test or forge script? I'm looking for a pseudo-random value that is different each time the command is run can you use bash's $RANDOM? it generates a pseudorandom number each time I guess so but for that I need vm.ffi, right? guess it depends what you're doing, you can set the result as an env var and access it that way ENTROPY=$RANDOM; forge test then you can read the entropy env var Noob quastion guys, how to call a function passing value? mock.mint(gpaProof2, 8,{ value: 0.1 ether }); trying this way and it reverts asking for callable expression declaration It seems that the subcommand of wallet of cast cannot convert an existing private key to a keystore file. It can only create a keystore file from a fresh newly created wallet found it. this isn’t and has never been valid solidity We might be missing it - can you open an issue? I was thinking in JS hahahhahha, HH and on the frontend its done like that I legit laugh laud on this added haha what if we added more js syntax to solidity HELLO token contract address is the one in my local node why is this erroring Hello, I am using anvil to do some testing. In this case I have to use ethers to interact with the node, not the forge environment. However I would really like to see stack traces of my failing transactions. Is there any way to achieve that with ethers+anvil? Cheers any one please can explain ,, i use expectRevert in a call that do not revert ,.",442
1977,foundry-support.txt,"the test should fail but some how it's pass i don't get it ? how can I set msg.sender of cast call vm.prank(address); actually using cast call but i found it the -f flag I always give the wrong answers 💀💀💀 appreciate ur reply Hey everyone, I’m writing benchmarks for anvil fork modes different connection modes & I’m looking for a way to clear all cache Do any of you know which function I should call to clear it in between runs? Thanks in advance for the help Hey guys, how does forge submit transactions to a devnet ? Is it possible to frontrun it ? bumping this. can any of the big 🧠 help plz sers TLDR: I have Contract A being deployed inside a script. A is a factory, it deploys Contract B as a base in its constructor. how do i verify Contract B using the script? What do you mean by verify? You could check it’s ERC-165 interface id i mean verify on etherscan. when deploying in the script with the new keyword, foundry has access to the bytecode for that deployment so it can verify with forge script script/Deploy.s.sol:Deploy --rpc-url $RPC_URL --broadcast --verify -vvvv however the base contract dosnt have the same You could submit the solidity to etherscan manually anyone can replay your transaction on mainnet, unless you check chain id within your contracts Is it possible to run a hardhat task against an anvil instance for some reason, ds-test is randomly missing. when trying to reinstall, i get this: forge install ds-test --no-commit Error: Could not determine URL for dependency ""ds-test""! im in a subfolder of the toplevel git repo yea ofc i can but thats not solving the problem though is it Your question “how would i verify these contracts?” I got it working. Thanks! guys, where to find cheats object and cheats.load? Cannot find neither in Test, DSTest nor stdStorage https://book.getfoundry.sh/cheatcodes/load?highlight=slot#description Hi all, I am an happy user of foundry 🙂 and have a question, looked in the help and in the book but found nothing useful.",457
1978,foundry-support.txt,"Is there a way from forge build to obtain the runtime bytecode similar to what I can obtain with solc --bin-runtime? actual strategy is to look into the out folder and then crop the bytecode to the second 6080 or `6060` thank you 🙂 nvm, found vm.load in basic Test.sol im tracing a transaction using cast run —debug but it bricks up when it hits push0 code, is there a fix for this? if you look a bit closer, i asked ""how do i verify Contract B using the script?"" its obvious i can verify using etherscan but even then its not exactily the simplest thing to sinse it has been deployed inside another contract its ok to just say i dont know or not say anything It’s not simple to verify on etherscan? 🤔 actually it is not. have you ever verified a contract deployed inside another contract on etherscan? personally?🤔 https://sepolia.etherscan.io/address/0x84781c21586559758b03ed9490e293f56835484d#code just did it. could do it in a hardhat script too bruh that contract is the simplest contract possible, and so is the deploying contract. https://github.com/DAObox/liquid-protocol/blob/5d76edd5c1a2bdd552e298e0a19f1cf4e02e871f/script/Deploy.s.sol#L23 that contract deploys a MarketMaker https://github.com/DAObox/liquid-protocol/blob/5d76edd5c1a2bdd552e298e0a19f1cf4e02e871f/src/core/ContinuousDaoSetup.sol#LL37C19-L37C19 Im not asking about hardhat, this is foundry support. i wasnt even asking about verifying directly on etherscan.",385
1979,foundry-support.txt,"that being said if you verify that MarketMaker contract deployed in the setup contract, that is deployed from a foundry script, *directly on etherscan* then i will give you 1 ETH hi, is it possible to use foundry cast call to show the execution trace? like in cast run Hey, I have 2 contract Contract A has 50 ETH and when i send it to contract B Foundry show to me this log: contractB::fallback{value: 79228162564264337593543950335} I dont understand this high amount!! Any one can explain this? hello guys how can i use foundry with hardhat? is there a way to call the getter functions of public variables using cast? in my case it's something like ContractA public ca; so calling something like cast call <address> ""ca()"" should return the address of ca, but it isn't it's giving me this error - (code: -32603, message: Error: Transaction reverted without a reason string, data: Some(Object {""message"": String(""Error: Transaction reverted without a reason string""), ""data"": String(""0x"")})) I think your best bet is to save all the deployed contract:address pairs from your script (could save them to a JSON file, or simply write to console and parse from there). And then have an external script to do forge verify-contract. Heads up for the latest part: last time I checked it didn't pick up etherscan keys from foundry.toml, but this might've changed. Thanks 🙏 this is what I was thinking would be the case This is a somewhat fucked up way to do this. Not the best code out there, but gets the job done. https://github.com/synapsecns/synapse-contracts/blob/master/script/sh/verify-contract.sh No this is super helpful Ah, one other thing is that if you deploy a contract from a factory using non-empty arguments, you'd need to save them as well for later verification. At least I wasn't able to figure out how to verify these contracts without --constructor-args flag. Etherscan fails to deduce the constructor args for such contracts. And another thing is that the forge verify-contract didn't work with blockscout-based explorers last time I checked. Cool, all the contracts are proxies and don’t use constructor args.",489
1980,foundry-support.txt,"But this has been very helpful Thank you for teaching me that every mistake is just a Learning experience.I almost lost my house and my property after losing so much money for fake platform. I have Learnt so much with you. Ever since I have been trading with you, l found myself evolving both with respect to my career as well as a person . I invested $1,000 and got in return $11,000 after 2 days Thank you so much Sir, for this wonderful opportunity. Click to join the channel and participate for the promo,💯 trusted. 👇👇👇👇👇👇👇 telegram.me/joinchat/bVERo2H8r9Q1NWJk telegram.me/joinchat/bVERo2H8r9Q1NWJk telegram.me/joinchat/bVERo2H8r9Q1NWJk guys if you have a bytes array stored in a specific storage slot (that's more then 32bytes) , and you want to return it all without knowing it's size , how to do that since the sload opcode returns only 32bytes ? for example how solidity deal with that in a low level is it using a loop to returns all the array ? anyone can explain please ? If it’s anything like memory, then the first 32 bytes are a pointer to where the array starts. If u SloaD the value stored on these first 32 bytes, you will get the length of the array.",312
1981,foundry-support.txt,"From then on u can make an iteration on each item (I might be wrong, because I only work w memory when it comes to low level in Solidity, not storage) I just wondering how the mechanism to return the whole array is is through a loop ? or there's a Better way ? But maybe try going to Remix and making an example function which reads some dynamic variable from storage, run it, and then go into the debugger and see what the opcodes r doin That’s as much as I know, but u should give my above suggestion a try to see how it works under the hood yea i thick i have to debug it , i thought i could get a fast answer here 😀 Shouldn’t be too long to figure it out :) hey guys, is it possible to see the revert reason of a tx with cast and/or anvil ? I had a tx reverting but cast tx and cast receipt were just showing status 0, no reason provided. I had to connect to a local explorer to see the reason. I was wondering if it was possible directly in anvil has anyone seen this? I tried setting the following in my foundry.toml but it didnt help evm_version = 'shanghai' oh its happening when I import solady once solady is added this is happening, i found it in solady's foundry.toml foundryup and it should be resolved beautiful thank you that solved it If you're asking about the getters for public variables: having bytes32[] public array; in a contract is equivalent to having function array(uint256 index) external view returns (bytes32); In other words the autogenerated getter from a public array is a getter for a single element (so there's no low level involved). hey! is it possible to roll blocks in the forked chain using anvil? eg: i want to fork arbitrum, at block a block that happened 5 days ago, deploy some contracts and interact with it, then roll to current block and check states Can forge deploy upgradeable contract ? Getting the following error with forge coverage: $ forge coverage [⠒] Compiling...",434
1982,foundry-support.txt,"[⠆] Compiling 95 files with 0.8.16 [⠑] Solc 0.8.16 finished in 5.14s Error: Compiler run failed: Error: Compiler error (/solidity/libyul/backends/evm/AsmCodeGen.cpp:63):Stack too deep. Try compiling with --via-ir (cli) or the equivalent viaIR: true (standard JSON) while enabling the optimizer. Otherwise, try removing local variables. When compiling inline assembly: Variable headStart is 1 slot(s) too deep inside the stack. Stack too deep. Try compiling with --via-ir (cli) or the equivalent viaIR: true (standard JSON) while enabling the optimizer. Otherwise, try removing local variables. Yet, forge test and forge build work no problem. Looks like you have viaIR enabled in your foundry.toml so the build succeeds. But forge coverage runs with viaIR disabled so it throws stack-too-deep exception I don't think that's the case, because it doesn't fail on master branch with same foundry.toml file. And also I do not have viaIR enabled.",240
1983,foundry-support.txt,"https://github.com/foundry-rs/foundry/issues/3357 Unfortunately this does seem like a hard-to-resolve issue Thanks can anyone please give me BNB test fund to this address? 0x10751aD0FF50600F1fECdbE026c40AE0b9729C36 Hey Guys can anyone please let mme know what do i have to write in the foundry.tomml if i want to deploy and verify the contracts in mumbail testnet is this correct ? See how I manage multiple chains in my Foundry-based development template https://github.com/PaulRBerg/foundry-template/blob/67f789e443969f3c82c3f41af2221f435cfd148f/foundry.toml#L24-L55 https://lmgtfy.app/?q=bnb+faucet Thanks mate What is wrong here? Does the BSC endpoint you’re using actually work for forking with Foundry? im trying to use the debugger with cast run -d -r <rpcurl> <tx> but it breaks when i reach a push0 code, and in the trace log it just says transaction failed Didn't test it, the fork tests run on Mainent only It should unless there's a BSC precompile being called that we don't have anvil in fork mode is sometimes extremely slow to process a transaction - any tips on how to debug this? (also it cannot be interrupted ctrl-c/sigint while waiting, even though it continues to log rpc calls) which transaction? pls open issue You can try forking via ipc It’s not super stable yet tho https://github.com/SorellaLabs/fastfoundry any solution for this? It includes a contract creation using create Which repo? is there any way to see more verbose debugging info on what it's waiting on? RUST_LOG=ethers=trace okay got it working. had to install all the things again.",407
1984,foundry-support.txt,"dont know why it was not working though Is there a way to retry contract verification from a script, without re-deploying everything again? Running into verification issues after deployment, and I dont want to re-deploy my contracts each time while I'm trying to figure out what I can do to fix the verification I'm using this command: FOUNDRY_PROFILE=deploy forge script scripts/Deploy.sol:Deployer \  -vvvv \  --fork-url $1 \  --broadcast -vvvv \  --private-keys $PRIVATE_KEY \  --verify  If anybody happens to know the fix or error for the verification, after my deployment I'm getting: Transactions saved to: /Users/user/Documents/projects/myproject/apps/contracts/broadcast/Deploy.sol/80001/run-latest.json Error: EOF while parsing a value at line 1 column 0 Ok, I figured it out. verifier_url env var was set wrong. By setting RUST_LOG=ethers=trace I was able to get more debug information and figure out I had to find a better api endpoint Anyone know if thats a way to make cast call show the execution trace? Just like in cast run try export RUST_LOG=ethers=trace does anyone know how i can use another account on my ledger other than the first one? i get this error when setting the sender to my second account’s address Error: No associated wallet for addresses: {my second account’s address}. Unlocked wallets: [my first account’s address] §delete Hey folks, I apologize if this is already asked and answered somewhere. I looked and couldn't find quite what I was looking for. I am currently converting from some hardhat unit tests to use Foundry. Our code base is quite large, and we need to use Via-ir to get around some stack too deep issues. The problem I am running into is that it takes ~8-11 minutes to compile one file. For instance, as I update the test file I am working on, each new run takes 8-11 minutes because of the compile time. This is obviously not ideal, as test files require multiple iterations.",438
1985,foundry-support.txt,"I feel like I am likely missing something obvious here, but do you guys know of any way to get this down to a reasonable amount of time, or am I just sort of stuck due to our dependence on via-ir? via-ir was extremely slow for me as well, had to bite the bullet and restructure the code. there were other issues, however, not just the compile speed. Thanks, thats what I am afraid of as well. via-ir is bad even if it was instant u wont be able to debug the code properly Check out this comment as well: you won't be able to do forge coverage with via-IR enabled. https://github.com/foundry-rs/foundry/issues/3357#issuecomment-1297192171 Ok awesome, thanks guys. Im looking at removing it as a dependency now i have a problem with anvil. im forking from a historical block, sending transactions and then mining them with evm_mine. it works but its incredibly slow. it takes up to a minute to mine a block. what could i be doing wrong? could it be my historical rpc provider? I would assume if RPC is slow and Anvil needs to read a lot of state from the RPC provider, it is going to be slow. Have you tested how fast your provider is? i tried infura and quicknode, both seem to perform the same Thank you! This has been very helpful. Unless it is your local connection, it should be performant And also, we perform throttling based on infura’s compute units—you can increase them but you might eat into your RPC bandwidth faster I believe the flag is --cups And add a number above 330 https://book.getfoundry.sh/reference/anvil/?highlight=cups#evm-options EDIT: sorry, false alarm. Was not running vm.startBroadcast. --rpc-url is no longer working with forge script. Is this related to a known breaking change, or is it a bug? The scripts run against the local network, although I pass the --broadcast and the --rpc-url ""goerli"" flags forge 0.2.0 (1caa0fa 2023-05-30T00:11:10.062347000Z) Not a breaking change—this might be a bug. Could you file an issue? Will do, just trying to foundryup another version to validate my guess EDIT: sorry, false alarm.",501
1986,foundry-support.txt,"I was not running vm.startBroadcast. How can I get vm.assume to ensure a fuzz test value ""fits""? vm.assume(_vm.toUint8(0) == 1) messages.parseVM(_vm) // This code fails the check that _vm.toUint8(0) == 1 the first one passes and the second one that calls the same literal code fails Use bound not vm.assume https://twitter.com/PaulRBerg/status/1622558791685242880 _vm is bytes that the property / invariant tests comes up wtih How can I bound it to say index 0 is a valid uint8? That's more or less what I'm trying to do The bytes are a struct is the issue. the 0 index is only the first field of the struct SINCE WHEN DOES THIS EXIST? I litteraly built a whole protocol without ever knowing of the existence of this lmao Haha since forever Paul do you have all these protips Aggregated anywhere So is it just a modulo on top of the fuzzed value or is it more deeply integrated with the fuzzer? Use the source luke! https://github.com/foundry-rs/forge-std/blob/e8a047e3f40f13fa37af6fe14e6e06283d9a060e/src/StdUtils.sol#L63-L86 Twitter has - search for ""@PaulRBerg Foundry tip"" and ""@PaulRBerg Solidity tip"" Paul could write a killer foundry course with all those tips has anyone had trouble with frame and anvil? I find transaction getting stuck and anvil never processes it, but sometimes if I manage to quit frame and try to quit anvil, it processes right after frame exits and then exits itself.",366
1987,foundry-support.txt,"(before that anvil is stuck and doesn't respond to sigint) is there some way to make anvil rate limit connections coming in to it? How are you running the anvil binary? Docker? you can also use api.securerpc.com/v1 no api key needed and default limit is the equivalent to 1000 cups yes depending if said rpc calls are served from cached or not how far is this historical block? Some providers have limits on how far back they will fetch and prioritize the request according to those checks 200k blocks deep example: some rpc providers wont go back further than the block uniswap v2 was deployed Thats roughly a month? sometimes finding a block that is empty will help with retrieving times eg https://etherscan.io/block/15025259 Vs a MEV heavy block like this: https://etherscan.io/block/15025412 any idea on what I should do here? oh just specify solc_version on foundry.toml No just directly Does anyone have a nvim LSP config they can share that incorporates forge fmt Am using the HH LSP server with formatter = 'forge' but having no joy when running the format command Am using null-ls Trying to use anvil —block-time 12 in combination with ethers’ provider.on(""pending"", …) to play with some mempool stuff in foundry. Seems like the pending tx subscription only fires _after_ the TX is included in a block, which beats the purpose.",303
1988,foundry-support.txt,"Is this expected behavior, or am I missing something? Hello, is it possible to get a stack trace of a failing transaction from anvil? I am testing some JS code so using forge is not an option Yes I have Python code here https://web3-ethereum-defi.readthedocs.io/api/core/_autosummary/eth_defi.trace.assert_transaction_success_with_explanation.html#eth_defi.trace.assert_transaction_success_with_explanation - but probably similar JavaScript library already exists Another question, is it possible to mock contract calls using anvil only? Like vm.mockCall in forge? Hi Everyone, is it possible to install it on windows? https://book.getfoundry.sh/getting-started/installation#prerequisites build from source ok, thx Lunarvim pre-installs one by default that is really nice pending - A sample next block built by the client on top of unsafe and containing the set of transactions usually taken from local mempool Using `pending`, while allowed, is not advised, as it may lead to internally inconsistent results. Use of latest is safe and will not lead to inconsistent results. Depending on the backing RPC networks caching system, the usage of pending may lead to inconsistencies as a result of an overly aggressive cache system. This may cause downstream errors/invalid states. I believe we’re talking about two different things. provider.on(“pending”, (txHash) => {}) fires when new pending transactions are picked up in the mempool, it’s not related to pending/latest blocks then the semantics are incorrectly used Hmm, no idea why ethers chose to name it that way. But anyway, any clue why anvil pending transactions (while running with —block-time enabled) don’t get picked up? Need a repo to reproduce BlockSpecifier / Block Tags gm. I have an issue where I am reading JSON and serializing it into solidity, but my script is reverting and foundry is not telling me why. My guess is that it’s not able to serialize arrays (address[] and uint256) from the JSON object. Anyone knows what it might be? the error is just a default revert: Error: Failed to deploy script: Execution reverted: EvmError: Revert (gas: 402818) really weird, my contract has 2 params Today, I found an existing regression in forge if using solc 0.8.20 & shanghai: init code size errors are only logged and not treated as failures.",497
1989,foundry-support.txt,"A fix is incoming but please if you upgrade, check your logs carefully or keep paris for the moment https://github.com/foundry-rs/foundry/issues/5088 ah lovely will check out thx I ended up feeding it manually through —constructor-args to forge create. Only way I could make it work Good morning, I'm having issues passing merkle proof to my contract For testing I manually set is inside of the contract, and coerced the array to bytes32 What kind of issues? but doing the same on the front end wont work Its not accepting the format I'm sending basically I have this function to check is you are part of the tree that returns a bool, and takes leaf proof Yes, I’m familiar, never had any issues w/ frontend, should be pretty straightforward. What’s the error you’re getting? it returns false, even tho I'm in the list Thats how I'm generating the proof this will then be passes to the check function, return tru if you are part of any of the 3 lists Why are you returning (true)? That’s supposed to be a tuple? thats just ugly code, this function is to check if you are part of any of the 3 lists on foundry I hardcoded a couple of proofs worked, but on remix/from frontend its not accepting for some reason You can simply return the condition alone, which would evaluate to either true or false, but the point I’m making is that return (blah) is supposed to be tuple syntax, and it should be return blah instead. It’s possible that it doesn’t decode properly on the FE side. Yeah sure, but the problem is not there Thanks for the advise tho. So on remix I solved by just adding double quotes instead of single What makes it even more weird is that passing exactly the same value, copy past from remix, gives me 2 different returns Sama address, same contract, same network it looks like your Json struct is not alphabetical, see https://book.getfoundry.sh/cheatcodes/parse-json#decoding-json-objects-into-solidity-structs Thanks will give it a try I need to deploy a mock that uses a different, much older version of Solidity, but is in the same folder tree as the rest of the contracts. forge create compiles everything but gives me this Error: Compiler version has to be set in `foundry.toml`.",492
1990,foundry-support.txt,"If the project was not deployed with foundry, specify the version through `--compiler-version` flag. How do I make it happy? If I set a single compiler version in foundry.toml compilation fails. --use isn't helpful either, for the same reason. Yeah don't lock your compiler version Let it auto detect And it'll compile them all with the right version It does compile everything, no issue there. But forge create fails with this error. (I don't have the version specified anywhere initially, other than in the pragmas) Please use forge script And if you want open an issue about the Forge create bug so we don't forget it I think I know what it is - relates to us using 2 different functions to recompile, one which isn't aware of all the compilers Was just looking at it, ty. Which is why build works but create doesn't here Okay, will open an issue as well a bit later. Cheers. I feel stupid, but I got it to work 😄 I was using a provider instead of signer, thats why it was returning false In my defence, view functions usually dont use msg.sender Start verifying contract ... deployed on sepolia Error: expected value at line 1 column 1 Any ideas? I tried manually with a flattened source, that fails as well. But I verified the same contract successfully on BSC and Arbitrum. (testnets) (and multiple other contracts on Sepolia as well using the same commands) This was from forge create. forge verify-contract submits a query, but nothing happens. Hello, I'm using NX in a monorepo and every time I install a new dependency using yarn a test crashes [FAIL. Reason: Expected an emit, but no logs were emitted afterward. You might have mismatched events or not enough events were emitted.] test_redeem_emits_event() (gas: 275028) Does anyone have any ideas? Verified using Tenderly, it told verification was successful, but the explorer still isn't showing anything. Extremely baffled.",417
1991,foundry-support.txt,"""Log != expected log"" on L477 you are telling forge you expect a Redeem event to be emitted, but on L482 in the setApprovalForAll call you can see there's no Redeem event make sure to call expectEmit immediately before the call where the event should be emitted For some reason when I run locally the tests pass I can't reproduce what happens in the CI it looks like Etherescan arrives at a different hash for some reason ¯\_(ツ)_/¯ If I remove the {ipfs} tag and everything that follows from the bytecode versions from Foundry and from Etherescan it's a perfect match. Any ideas how to work around that? ok, nvm any good guides/resources for patterns on handling forge scripts across networks? particularly wrt things like WETH w different constant addresses also, partially related, any good resources for patterns for saving per-network build artifacts at deployment time ? I saw somewhere a way to create new key/address in test file by passing a string, any example of that? Tenderly hasnt been showing me etherscan verified contracts for like the past month lol I have to do what every sane person does and publicly admit that the issue this time was _probably_ almost solely with me. I say “probably” because 1) I was using a copy pasted forge create command/shell script which I didn’t fully edit, and it contained a reference to a non-existent shell-script—local variable for the Etherscan key. 2) but also neither forge create nor forge verify-contract said anything. I’m pretty sure the spawned shell for forge create didn’t have that variable declared (although will double check), but also with forge verify-contract I was providing arguments verbatim, no variables, and that somehow wouldn’t work either. As soon as I fixed the variable reference in the forge create script, everything worked on the first try. Was a long day. Also once again, folks, avoid copy pasting even your own stuff. 😅 did u manage to verify direcrly on Tenderly using foundry? btw, is there a way to have a random input chosen in tests from a selection of inputs? i.e, a tokenIn input which should be one of 10 pre-selected tokens I actually elected to do it manually on Tenderly cause by that point I was really frustrated. Tenderly said everything was dandy, but the contract never verified on Etherscan.",500
1992,foundry-support.txt,"There was a discussion earlier. You could supply a value from the command line or you could use FoundryRandom. Hello all! I don't know if this has been asked before, but I couldn't find the right answer yet. Here it goes: Why does CREATE2 (using the new Contract{salt: versionSalt}() instruction) cost so much gas? According to the CREATE2 EIP (https://eips.ethereum.org/EIPS/eip-1014) it should cost just a bit more than CREATE. I see Foundry is using a factory (0x4e59b44847b379578588920cA78FbF26c0B4956C) for that, but I don't really get why. Is it possible to deploy using CREATE2 without such factory? Thank you in advance, Hello! Can Anvil run with a websocket connection? hi, is there a video about foundry installation on windows ? Folks, I see this error: ""Chain anvil-hardhat not supported"" when deploying a contract on Anvil. Is there a way let `forge' know that I intend to deploy only on Anvil and not anvil-hardhat? /report Use Git bash or WSL instead of Command prompt to run foundryup Once it is successful then you can use the command prompt. windows powershell will work too Thanks for adding on I didn't use that so not sure about that :) yes!, just use ws://localhost:8545 i didn't make myself clear 🙈 I mean using a wss as fork-url parameter (Alchemy wss connection), I couldn't make it work so far Nevermind. I just figured I can start anvil with a chain-id parameter and use the same on foundry.",362
1993,foundry-support.txt,"Anyone? @gakonst lots of spam these days 😅 We need a spam bot ser Can someone tell me what's the expected contract arguments format? I've tried a million ways and there is no single example in the docs! forge create --rpc-url https://rpc.gnosischain.com --interactive --constructor-args 0x745B851b853675837CCC804B1fd3637D61628E50,0x685c1c7f82e639070302d551c15cce1bf20228d8eb212f2013d91cf77827e744 packages/contracts/src/Whitelist.sol:Whitelist What's wrong? function parseRecoverChainId(bytes memory encodedRecoverChainId) public pure returns (RecoverChainId memory rci) {  uint index = 0;   rci.module = encodedRecoverChainId.toBytes32(index);   index += 32;   rci.action = encodedRecoverChainId.toUint8(index);  index += 1;   require(rci.action == 5, ""invalid RecoverChainId""); I'm trying to write tests for this but I'm struggling to get a working vm.assume() that ensures action at index 32 is 5. The test starts off like this: vm.assume(data.length >= 67);   // @dev 32 is the index of the `action` struct attribute  vm.assume(data.toUint8(32) == 5);   RecoverChainId memory id = parseRecoverChainId(data); forge test -vvvv shows the second vm.assume() returning true, but then the test fails with invalid RecoverChainId. What am I doing wrong here? It is like the data passes the assume function and then fails. Hard to tell, using console.log should give you some hints where the data is malformed. In any case for complex fuzzing like this you'd be better constructing data yourself in this case. Like in this case set needed action at index 32, and use fuzzed inputs for the remaining bytes. And don't assume data length as well, craft it in a way where this check passes every time.",450
1994,foundry-support.txt,"Otherwise you'd be running into ""too many fuzz inputs rejected"" issue Can you give me a bit more context on the best way to do that? I've been struggling trying to figure out how to do this but will do it a ton once I've got a valid approach. Hey there ! Is there a way to use the deployedCode cheatcode with a contract that uses immutable var ? Thanks ! https://github.com/PaulRBerg/prb-math/blob/c7f76a7179afecefc0df3819e9bc4d2f8a20230c/test/ud60x18/UD60x18.t.sol#L46 parameterize the input struct, using above for example below https://github.com/PaulRBerg/prb-math/blob/c7f76a7179afecefc0df3819e9bc4d2f8a20230c/test/ud60x18/math/avg/avg.t.sol#L61 I'll add bit Bot If you don't care about data edge cases (like all zeroes and stuff), you could do something like this: https://gist.github.com/ChiTimesChi/b4cb0c6b7eaa4ad3268210a8b614f91d And have fuzz tests like function testX(Random memory random) Alternatively, in this particular case you could use something like testX(bytes[500] memory fuzzedInput, uint256 length) and then bound length to be between 67 and 500, slice data from fuzzedInput and use for the test I'll try to make that work.",330
1995,foundry-support.txt,"Thanks! trying this again -- good patterns for handling scripts across networks that need different params + saving per-network build artifacts at deployment time ? vm.writeJSON is one way, keying by block.chainId so read a json for the per-network input values & write to another json for the outputs? ideally i could also get the --show-standard-json-input from the script as well? there are no known best practices for this; I've opened an issue in the Foundry Book https://github.com/foundry-rs/book/issues/872 You might be interested in taking a look at what @hexonaut did in dss-test: https://github.com/makerdao/dss-test/blob/0afd5512c4fd7ea6507a4831b238244681a1ef29/script/input/5/integration.json yea @wminshew this is the pattern we (scopelift) also use, basically: - readInput method takes a file name and reads in script/input/<block.chainid>/<filename>.json - the filename is intended to be the same in all chain subfolders, you'll see that chain IDs 1 and 5 both have integration.json - you can either make that file name an input to your script, or hardcode it, and then the scipt will automatically load the correct JSON file based on the chain ID, which changes based on the RPC URL you're using here is maker's readInput: https://github.com/makerdao/dss-test/blob/9d7557817af849273ec1d952cc953b212f19025f/src/ScriptTools.sol#L39-L47 and another version here, which should do pretty much the same thing: https://book.getfoundry.sh/tutorials/best-practices#scripts thanks @PaulRBerg @msolomon4 super helpful Spaces, not commas, in case you're still looking. Lack of examples is appalling indeed. So I'm trying to set up a test that works on three forks (Sepolia, Arbitrum, and BSC), and I would switch between the forks. There are multiple contracts predeployed and I deploy no new ones in this test. Sepolia and Arbitrum, given the current test implementation progress, run fine, but BSC fails with [FAIL. Reason: Contract 0x... does not exist and is not marked as persistent, see `vm.makePersistent()`].",496
1996,foundry-support.txt,"The contract does exist, and it already existed at the block height I'm forking from. If I mark the contract as persistent, it simply tells me the contract doesn't exist. I will defo PR some examples to the docs is the build-info output of script the same as show-standard-json-input from verify-contract? even so ig i still have to manually move it to a folder so the ideal flow would allow me to access the full standard json input from inside the solidity script? not a huge deal if i just have to sort it afterwards for now ig Could there be an issue of... because foundry persists accounts declared outside forking contexts by default, it somehow idk misinterprets what I want when I switch forks? Like it thinks an account that is persistent overrides whatever accounts may exist on the forked chains? So if I've defined a constant that refers to a contract in one of the forks, it cannot find the contract because it's already a persisted acc? This only happens with BSC though. Hello! Was wondering if anyone was using any solutions for a preprocessor (or if there was any support within foundry, couldn’t find any)? Basically we’re deploying two contracts and we want to use the first contract’s address as a constant variable within the second contract, but want to just replace it manually for gas-savings (instead of use it as an argument to the constructor). I've seen people have issues with endpoints, but switching to quicknode, for instance, results in the same error. Would appreciate any pointers how to debug this bs. 😅 no tricks to get around differing immutable params messing up CREATE2 addresses across networks right? (well short of just using CREATE w same deployer/nonce) if you're using your own factory you can store the constructor params in factory storage and have the new contract read from that storage, then clear it for a refund. create3 is also an option 🙏 there's none I'm aware of, forge fmt uses solang to parse the solidity so if you write your own you could use that, though it's probably easier to just write a bash script with sed.",436
1997,foundry-support.txt,"but using constructor args or just precomputing and hardcoding manually might be easier depending on your use case envsubst :) I'm not sure I understand the issue, can you clarify or provide steps to reproduce? forge create --rpc-url https://api.avax-test.network/ext/bc/C/rpc stuck right after compilation, forge cast performs cast all fine is there anything I should pay attention to? does foundry intermediates txs in any fashion? I'm having issues pushing txs with foundry did a self 0 tx and tx went through but now its stuck at contract verification, tried several rpcs is there some blanket goto create3 deployment across networks (like create2)? it should use the same default create2 deployer, since create3 works by doing a create2 of a proxy followed by a create with your bytecode: https://github.com/mds1/solidity-sandbox/blob/main/test/3_create3.t.sol ic.. reading thru the eip now & the solmate/0xseq examples, thanks for the test link no problem, fwiw solady also has a create3 implementation and it’s getting audits now-ish, not sure if create3 was in scope just to make sure i'm grok'ing this, i need to deploy a factory of my own via CREATE2 that has an auth'd method to deploy new contracts using CREATE3 (if it weren't auth'd anyone could submit random code w the same salt i've used on another network and ""ruin"" that deployment) If anyone is searching for a solution to this error, adding the --slow tag solved it for me What files should I consider ignoring while pushing any foundry project? As I see there are lots of JSON files being generated. Yeah, will attempt to reduce to a minimal example. is there a way to show calldata on tx tracing in tests. instead of showing fn name and decoded params https://github.com/iconofsin/foundry-bsc-contract-not-found Here's a minimal example. It reverts in one test without any further diag, and it says contract doesn't exist in the other. If I remove the other two forks, it simply reverts in both cases. To reiterate, the contract is already deployed on the testnet, I’m not deploying it as part of the test setup. Aaand I just ran the same script using cli, w --fork-url...",491
1998,foundry-support.txt,"but removing the fork creation and switching in the test itself, and it worked... So it must be something with Foundry's built-in forking mechanism, right? Or am I not using it correctly? Mkay, I removed blockHeight for BSC fork and it... worked. Does that qualify as a bug? Or would that be something endpoint provider related where they don't let you access state beyond a certain past scope? yep that is correct! aside from require(msg.sender == owner) style auth, other tricks include: - require the first 20 bytes of the salt match the msg.sender, as done in the containsCaller modifier here: https://etherscan.io/address/0x0000000000FFe8B47B3e2130213B802212439497#code - have your factory hash the salt you give it with msg.sender and use that as the salt for create2/3 which maybe gets back to my og q which is are there already any ~global CREATE3 factories that use one of these msg.sender tricks that i can use to deploy or do i need to make my own? hm yea you'll prob need to make your own then if you go with create3, I've been planning to write one but haven't gotten around to it yet gotcha, thank you. Appreciate the time & knowledge 🙏 hey, i'm having trouble using the debug_traceTransaction rpc method when i provide something like params: [<txhash>, {}], anvil complains with {""jsonrpc"":""2.0"",""id"":0,""error"":{""code"":-32603,""message"":""Fork Error: JsonRpcClientError(JsonRpcError(JsonRpcError { code: -32602, message: \""invalid 2nd argument: options object was missing 'tracer' element\"", data: None }))""}} when i provide a tracer, i get: {""jsonrpc"":""2.0"",""id"":0,""error"":{""code"":-32602,""message"":""non-default tracer not supported yet""}} this even happens for the default tracer. params: [<txhash>, {""tracer"": ""structLogs""}] i'm forking off of alchemy btw, maybe it's just bubbling up the error from alchemy (which only supports callTracer and prestate tracer) Ah yikes. It’s a good Q.",476
1999,foundry-support.txt,"Can you try running the same debug_X call on a non-forked node with a diff tx? Non forked, like anvil or the upstream node? anvil w/o the -f i mean just get tx not found basically - {""jsonrpc"":""2.0"",""id"":0,""result"":{""failed"":false,""gas"":""0x0"",""returnValue"":""0x"",""structLogs"":[]}} don't have any txs mined locally btw it's anvil nightly - 0.1.0 (cc5637a 2023-06-02T00:09:47.202180837Z) Ya send one or two 😅 haha ok, this will be fun to test something yea returns some structLogs as i would expect That seems to be the case then? yea i'm guessing so btw i think hh does not rely on upstream debug_tt, it replays all txns in block up to the requested tx and only uses state-getting RPC methods you can also probably achieve the same thing but a bit faster by requesting debug_tt from upstream with {""tracer"": ""prestateTracer""} how do i forge install without committing in a subfolder without a gitmodules? % forge install openzeppelin/openzeppelin-contracts-upgradeable --no-commit Installing openzeppelin-contracts-upgradeable in ""<...>/src/contracts/lib/openzeppelin-contracts-upgradeable"" (url: Some(""https://github.com/openzeppelin/openzeppelin-contracts-upgradeable""), tag: None) Error: fatal: pathspec '.gitmodules' did not match any files You can use --no-git also running into this. Any idea how to fix? What’s teh repro? ^? Just calling an Arbitrum pre compile will trigger this, I’m guessing because the bytecode has a special opcode which revm rejects Or the precompile doesnt exist ? it's returned on the 0xFE opcode AFAICT: https://github.com/bluealloy/revm/blob/e0ec1cc93228508f6eafba2cba5e08f64c0c5454/crates/interpreter/src/instructions.rs#L145 Is there a good way to do an e2e test using Anvil instances? eg start a mainnet fork, deposit to Optimism bridge, see the tx posted on op mainnet in another instance? Something along those lines.",492
2000,foundry-support.txt,"If you are speaking about cross chain testing you can use exp-table’s pigeon repo. It helps you simulate crosschain txns https://github.com/exp-table/pigeon Sticking with the Optimism example, seems like you could maybe add a custom helper for the Optimism bridge Foundry doesn't support zkSync testing? still? https://github.com/matter-labs/foundry-zksync/ I dont think we’ll upstream the zkSync-related changes..ultimately it’s non-Ethereum-related code that we cannot have the maintainenance burden of I am trying to do a simple 1inch swap using Forge test with a mainnet fork. I am not sure if this is a bug, but Foundry is somehow calling a non-existent contract with the address 0x3030303030303030303030313330353132366561. When I tried to reproduce the transaction with Tenderly (screenshot with blue text), it was successful and I cannot find 0x3030303030303030303030313330353132366561 on the trace. I am wondering why Foundry is calling a non-existent contract. Do you have any ideas? also when I turned the RUST_LOG, the non-existence contract 0x303 is added once the test revert resolved! did forge install dapphub/ds-test —no-commit —no-git via-ir is really slow, any idea how to fix or refactor it so thats not the case hi all, cannot seem to install solarray: any ideas/fixes? thank you https://www.youtube.com/watch?v=BDtbTCuJoOM expectRevert doesnt seem to work for me without an error string specified. it fails on revert, and doesn’t fail if it doesnt revert? hi guys - i’m trying to verify this contract that was deployed using a factory through forge verify-contract, i emitted an event that includes the constructor arguments, retreived the data from the log, decoded as bytes, and used that as the constructor args - however im still being told by the console that it is invalid.",426
2001,foundry-support.txt,"Any idea on what i might be doing wrong? I want to determine the storage slot index of a variable in a deployed contract, is it possible to do so using Foundry magic? I mean, I could experiment with vm.load to see which of the slots gives me the value but is there a better way? which value exactly? look at how they implement deal() for erc20’s maybe that could help An address, the value is known beforehand. hmm well i guess an iteration over the storage slots is ur go to Cool, ty. 👌️️ Here's the repro: https://github.com/foundry-rs/foundry/issues/5104 hi sermam, may I ask if there is in depth docx with regards on cast like if possible to load the private key from a file not pasting it on the terminal for security concern set a env variable .env etc. or make a script that echo off or use ledger so I need to create foundry project to used env right? I don't have ledger 😅 you can also use a Makefile and silent the task some example back when I was using Makefile https://github.com/Abracadabra-money/abracadabra-money-contracts/blob/a80ef2b52f1123b86a777a9e8fa5b13e8cfe02b8/Makefile ok, guess I need to research things how to do that thanks for the resource .SILENT: deploy-simulation deploy deploy-resume _parse-deployment this is how you do it and then the load .env at the beggining but now we are using hardhat task and just show * and replace with whatever at runtime https://github.com/Abracadabra-money/abracadabra-money-contracts/blob/main/tasks/core/forgeDeploy.js thanks, I have no issue deploying sc as we are using hardhat-deploy and hardhat-foundry its much easier, but want to learn how to used purely on cast like everything is on terminal I see, yeah I had the same issue myself hi, gm. can i repost for the morning crew? has anyone seen this when trying to install a dependency? thank you thanks btw for the resource, I guess I need to learn more about terminal commands etc..",467
2002,foundry-support.txt,"maybe use a $PK variable won't show it on the terminal? hmmm inside foundry project? or any directory? not quite sure yet I'm confused about what you're trying to do so cast can be called in any directory right?, so if I want to like open terminal and used cast it will work without any foundry project so for example I want to send tx using purely on terminal, I can just call cast send but because it requires privatekey to expose on terminal there is a security issue for me at least, so I want to just load somefile like env which is I dont know to do it yet hahahaha yes it's independant from the foundry project sorry if my question is not clear you can probably set a PK var in your shell profile and use it there when needed and I _think_ it won't show it have you looked into ETH_KEYSTORE it can load from a keystore it seems not yet is that on docx? saw this here https://book.getfoundry.sh/reference/cast/cast-send 🤷‍♂️ keep me posted if you have any success with it ok, thanks mate! hmmm Im running on this issue `Message: failed to extract foundry config: foundry config error: invalid number at line 1 column 12 Location: config/src/lib.rs:436 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets. ` running cast send --private-key $PK $TOKEN ""approve(address,uint256)"" $APPROVAL 100000000000000000000 --rpc-url $RPC I made it works, but it is possible like encode the method that showing on etherscan? wdym make the method name display signature like 0x095ea7b3 not the readable method name on etherscan I saw some tx before that it only showing the signature for example 0x095ea7b3 You can use solidity developper extension on vscode you can get directly the selector of the function thanks mate, but seems even using the signature hash, on etherscan it showing the method name of the function plz any1? Storage-layout Hi , I am getting this error. It seems that the site is unreachable or something else. Any clue to resolve the issue? Please.",501
2003,foundry-support.txt,"I have gone through the foundry book and previous chat in this group , I did not get any clue. What's that? forge inspect <contract> storage-layout --pretty oooh, nice, ty, @craigson hi guys, i am using foundry to simulate mainnet for compound v3, but seems like its not working as expected, after roll new block, every state is still the same checking native balance is not change although this address made alot of transactions plz sers or is there a way to have a contract deployed through a factory verified in a forge script maybe Foundry Support all forge contracts are deployed via a factory i mean through my own factory i.e if i do ``myVaultFactory.deployVault()`` can i have the vault deployed within it verified automatically by forge? because i cant seem to be able to verify it manually afterwards idk why any reason you can’t run forge verify? i emit an event with the constructor args, attempt to verify it, but it still wont work it was telling me constructor args r wrong lemme show u just one sec lemme get the address, new mac so some stuff r lost forge test --match-path test/HelloWorld.t.sol [⠆] Compiling... No files changed, compilation skipped No tests match the provided pattern: match-path: test/HelloWorld.t.sol I have the following setup: Contract file: HelloWorld.sol located in the ""../src"" directory with the pragma solidity version set to ^0.8.17. Test file: HelloWorld_test.sol located in the ""test"" directory with the pragma solidity version also set to ^0.8.17. I am using the forge-std/Test.sol package for testing. When I run the command forge test --match-path test/HelloWorld_test.sol, the compilation is being skipped, and the tests are not recognized. I have already double-checked the file paths, file names, and ensured that the package is correctly installed. I have also consulted the Forge framework's documentation, but I couldn't find a resolution to this issue. it wont take it in and these are the constructor args: .",432
2004,foundry-support.txt,"so i emit them right away forge verify-contract *[]* src/vault/Vault.sol:Vault --watch --verifier-url https://api.arbiscan.io/api --etherscan-api-key $ARBISCAN_API_KEY --constructor-args thats the command im using with the huge bytes constructor args ofc i even went to the creation code and copied it from the end... still invalid constructor args is what im getting. how can i downgrade to some previous version? that's how ive always been verifiying my contracts and it always worked up until now. you can use foundryup -v to install specific version hello there is there any other url for installing foundryup? raw . githubusercontent . com is down by some service providers for some reason curl -L https://foundry.paradigm.xyz | bash this one redirects to raw . githubusercontent . com releases page has nightly versions so is that fine to download or is there any stable version? got started with latest releases. it seems to work but please inform if i should care about something else Only if we had a decentralised file storage and distribution network 🙃 Try match-path ./test/… Like ./test, not test is there any way around this? https://arbiscan.io/address/0x000000000000000000000000000000000000006c#code The Arbgas precompile uses it If it's a precompile it's not on chain there is no way to ""get around"" an invalid opcode Something like this https://book.getfoundry.sh/cheatcodes/mock-call or this https://book.getfoundry.sh/cheatcodes/etch could be of help, if applied to address(0x6c) How can I save data to a file using foundry script? Is it possible? Yes! We do it as part of our deploy here https://github.com/multisig-labs/gogopool/blob/main/script/EnvironmentConfig.s.sol I need a local network (=anvil) for testing a few scripts that deploy contracts etc. We use a customized CREATE3Factory to deploy our contracts that usually sits at the same address on all networks. Therefore the scripts rely on this address.",454
2005,foundry-support.txt,"After starting anvil, is there any command that would allow me to copy the bytecode of the CREATE3Factory to a certain address? Or do I need to deploy it (and accept that it will be at a different address)? anyone have any working examples of using viem's impersonateAccount for mainnet forking testing? see: https://viem.sh/docs/actions/test/impersonateAccount.html I am using this technique to save data to a file. What permissions do I need to set? https://github.com/multisig-labs/gogopool/blob/main/script/EnvironmentConfig.s.sol#L18 hey i have written a smart contract for batchPayment. i want to find the gas required for doing 1, 5, 50, transactions using this contract. how i can achive this with foundry ? fellow rustafarians , has anyone seen the latest Bogdan's (lets get rusty) vid , says the rust foundation is having domestic issues , does this mean rust is on the path to collapse ? What u thinks ? A bit off topic for this group I would say anyone got any tips for this one? well true , just foundry is in rust , if dev in that lang stops or ceases , then dev of foundry will also suffer right ? Idts There’s indeed some Rust drama I think it’s been a bit overblown well Crablang fork discord comm has like >1K members , maybe rust dev wont stop , maybe.. doubt but tbd the video's clickbait and nobody is actually developing crablang https://github.com/crablang yes I know I mean it's just a fork that's synced to master its has abt 300K commits man , how can it be just a sync ? I get this error when trying to use https://github.com/multisig-labs/gogopool/blob/main/script/EnvironmentConfig.s.sol#L18 this method. I know it's just a permissions thing, but I don't understand the scripting stack well enough to know what permissions need to be changed. The error: Error: The path ""/Users/nxt3d/projects/SubnameWrapper/deployed/savedAddresses.json"" is not allowed to be accessed for write operations. just look at rust-lang/rust, it's the same.",471
2006,foundry-support.txt,"Let's stop talking about it here as it's way offtopic Compiling with —via-ir seems to stop my tests warping forward in time with vm.warp - is this known/expected? You need to modify this setting: https://book.getfoundry.sh/cheatcodes/fs?search=fs_permissions For some reason this is not mentioned https://book.getfoundry.sh/config/ or https://book.getfoundry.sh/reference/config/ as far as I an see hey i have written a smart contract for batchPayment. i want to find the gas required for doing 1, 5, 50, transactions using this contract. how i can achive this with foundry ? hey guys, I'm using foundry to test a withdraw external function. The contract has balance and the owner is the real owner, is there anything wrong with this: payable(owner()).transfer(address(this).balance) ? getting this error: ─ [7535] Sam::withdraw() │ ├─ [45] SamTest::fallback{value: 200000000000000000}() │ │ └─ ← ""EvmError: Revert"" │ └─ ← ""EvmError: Revert"" └─ ← ""EvmError: Revert"" it works fine dealing with the contract deployed, but not on tests =/ tried to use (bool success, ) = payable(owner).call{value: balance}(""""), but returns false. Can someone help me on that? Tried to let the function public also. Default owner of that contract on tests should be your test contract itself and .call won't work without a payable fallback/receive on it on tests I've tried to startPrank(contract.owner()) is this what are you saying? get back to the original code on contract, like payable(owner()).transfer(address(this).balance); created this gist to exemplify what I'm doing: https://gist.github.com/lucasfernandes/36107658b445e27e7665a711ec20b623 Yeah looks like the owner is still the test contract, not an eoa Transfer the ownership to an eoa, prank that address and try withdraw got you, will try it! thanks 😃 that's a bit weird, cuz the owner is the contract test. Isn't it ready to receive ether somehow from the target contract? I did it in other contracts but with usdc, usdt, before...",499
2007,foundry-support.txt,"Your test contract most likely doesn't have a receive() function to be able to accept Ether I dont wanna receive ether, I want to send the contract ethers to the owner. Do I need a receive function for this case? contract will have ether once people mint the nfts, so after that the owner should be able to withdraw it. Its working on goerli, but not via foundry tests. ah maybe the test contract you mean? it did the trick @ChiTimesChi thanks! You're welcome. But would advise to use deploy -> transfer ownership to EOA pattern in the tests in general :) Thanks for the tips! Hey y'all, I'm trying to hack on a local testnet script using Frame.sh wallet, but frame keeps prompting me to sign a tx for mainnet. I'm using --chain-id 137 flag but Frame doesn't seem to recognize my intent here. Am I missing something, or is this unsupported? Hi, could use some help: I deployed a contract to goerli using forge create but it failed to verify on etherscan and I can't figure out why. The first version had optimizer = true, constantOptimizer = false so I thought it might be too complex of a configuration for etherscan. I deployed again just with optimizer = true, runs = 1_000_000, everything else default (solc = 0.8.19) but it still fails to verify. This was deployed after running foundryup today. Edit: after reverting to a foundry commit from January the verify worked. I wanted to try verifying just with the solc json compiler input, but I wasn't sure how to generate that from forge for a single contract within a big project. Running forge build --build-info generates a huge buildinfo file... hi, how does one deal some ERC 20 tokens using vm.deal(token,address,amount) on ERC20's which are proxy contracts? seems ot be failing some test of min vm.deal is for dealing Eth, use deal for Erc20s Hi, I am looking for a way to set compiler options per contract, like with overrides in Hardhats config. The main problem is that some contracts can only be compiled viaIR and others can not be compiled viaIR. This makes for a very frustrating testing loop, where we need to rename some contracts for the compiler to ignore them.",485
2008,foundry-support.txt,"I am comfortable enough with Rust to prepare a PR, but will need some guidance on how to solve this problem. yea yea i use deal. not the vm.deal, my bad anyway i have another question when tests pass, if i display logs/traces - which run is the one being displayed? the last one? Is there a way to see more detailed error than EvmError? Hi, I have several scripts that I want to execute in sequence using anvil local fork to test it. Is there a way to accomplish this, cause I notice that the scripts can't get the result from the previous scripts. Or what might be a better practice for this? Can’t u just execute the functions from the other scripts within one script? Our use case would be deploying a base contract. And later on we might need to deploy new module contracts which requires base contract address as configuration. So we would like to execute them in sequence to mock the actual deployment process. Well: 1) are these deployments actually complex? Why not do them in one script 2) I am pretty sure u can just inherit the other scripts and use their functions Or maybe even make one contract or few with the functions u need for deployment, and then just inherit that in all of ur scripts Thank you for the response, do you have an existing reference for this? Cause I haven't seen others implement with this fashion. These are some of the workarounds I found. It's doable but rather complex for some small projects. https://github.com/foundry-rs/foundry/issues/3911 i mean, just a reguler solidity contract inhertiance. i do in tests usually I am implementing it, and also open to other suggestions. Thank you for the answer. 👍 hey guys quick question - how can i get a function's signature hash in a Script? been using cast sig, but want to get the value from within the script maybe function.selector? yeap, ``functionName.selector`` should indeed return the selector of the function :D tyty ser.",421
2009,foundry-support.txt,"or may i say, toda raba ;) My tests are failing because im on a fork, and chainlink vrf isn't calling my fulfillRandomWords() Do I need to create some Mock VRF stuff of my own? Or is there a better way to solve this? if you don't want to deploy on a testnet then I would choose a mock I wanna deploy on testnet later. But isn’t there a way to solve this for local forks? without needing to make mocks I don't know another way There’s no other way You can use anvil_impersonateAccount or vm.prank with the VRFCoordinator address and call your contracts fulfillRandomWords() Btw, is there a way to store the gas reports in a file? Or do I have to just take a bunch of screenshots of my terminal? You can pipe output on a command line? 🙃 (I don't know real answer) Yeah, that's what I'm doing already. Just wondering if there was a better way you could do snapshot too yep for fuzz tests, if all pass, it’s the last successful run that’s shown not currently, this usually means it was a solidity autogenerated check that failed (like not receiving expected return data or calling an address with no code) how did you fix this? this gives me stdStorage find(StdStorage): Slot(s) not found. ok only for proxy contract ERC20 this is a known issue right nvm if i use the implementation contract behind the proxy it works thanks, hopefully helps someone else 😂😂 ban hi, has anyone had issues where running forge snapshot —check locally passes but in CI fails? Can’t figure out what the issue could be but it’s happening in a few different repos actually it stopped erroring but the balance is not changing, maybe i'm using the wrong with_key value? Some seed changing across builds Maybe set via env var? Hey everyone How do I add a specific version of a repo to my modules? For example : forge install openzeppelin/openzeppelin-contracts@2.5.0 it's that but the version is the git tag or ref, so v2.5.0 yeah i figured that out as soon as I typed it lmaoo thanks tho! I have another question now Compiler run failed: Error: Source ""lib/openzeppelin-contracts/contracts/contracts/token/ERC20/ERC20.sol"" not found: File not found.",500
2010,foundry-support.txt,"import ""openzeppelin-contracts/contracts/token/ERC20/ERC20.sol""; ^--------------------------------------------------------------^ Error: Source ""lib/openzeppelin-contracts/contracts/contracts/token/ERC20/ERC20.sol"" not found: File not found. import ""openzeppelin-contracts/contracts/token/ERC20/ERC20.sol""; Why is it duplicating the contracts directory here? These are my modules : [submodule ""lib/v2-core""] path = lib/v2-core url = https://github.com/Uniswap/v2-core [submodule ""lib/solidity-lib""] path = lib/solidity-lib url = https://github.com/Uniswap/solidity-lib [submodule ""lib/openzeppelin-contracts""] path = lib/openzeppelin-contracts url = https://github.com/Openzeppelin/openzeppelin-contracts Think I just figured this one out too Did anything change with REVM and deployment? When I use the deploy scripts in my tests, after doing mainnet forking the deployer contract disappears. nightly-94777647f6ea5d34572a1b15c9b57e35b8c77b41 Latest version that it worked ^ Can you do multiple solc compilers in foundry? I'm trying to use a lib that's <0.8.0 and the rest of my contracts are >0.8.0 So Foundry is throwing an error Do I rewrite the library so that it's compatible with solc > 0.8 or is there another way It seems when you are forking uniswap the easiest way it to just deploy the core vs periphery from different projects Solved with vm.makePersistent! you can't have contracts/libraries inherit/use each other if they have incompatible pragmas, but independent contracts with different pragmas is supported hey guys - how can i verify a contract that was compiled with --via-ir? it seems to cause problems Hey everyone, I was wondering if anyone has experience deploying a UUPS contract with a deterministic address using a CREATE2 factory. But I cant initialize the implementation. I built a minimal script to showcase the issue (testing on a mainchain fork) and this is the output from console For the factory contract, im using https://github.com/pcaversaccio/create2deployer, but tried with other factories with the same result.",488
2011,foundry-support.txt,"For non-proxied immutable contracts, it seems to work fine. It also works for non factory created UUPS proxies, but not both Would appreciate any pointers if anyone has done something similar! missed the output in last message hello Executor environment config:  --gas-price <GAS_PRICE>   The gas price  --with-gas-price <PRICE>   Gas price for legacy transactions, or max fee per gas for EIP1559 transactions   [env: ETH_GAS_PRICE=] anybody can explain me what's difference between two option? I spent a couple of hours to find when '—gas-price' option should present even I read foundry github code but i couldn't figure out with my stupidity Hi, any good articles to deploy multiple contracts (.sol) files to one address in Anvil testnet? https://github.com/foundry-rs/foundry/issues/5110 any workaround for this issue? Try clearing your out folder new ContractName{salt: salt}(address(implementation), abi.encodeCall(initFunctionSelector, (args)) yeah i’ve already cleaned the out directory, but it’s still not working verification still worked 2-3 days ago though, before running foundryup today Hmm I haven’t seen this issue myself. I’m on v0.2.0 as well Try specifying the —chain-id when running the command already did. Nvm i gonna keep track to the github issue Hey guys anyone here strong with chainlink functions? gm! I was wondering where I could find the status of coverage for invariant tests in foundry 👀 Could abigen! to generate bindings to return the storage slot of state variables? *be expanded slot and data type/mapping/etc whoops this is foundry not ethers im having trouble with a deploy script, been using the script for months and never seen this. verification kept failing so i checked the broadcast file and a uint256 constructor arg is getting passed in like this when it should just be ""777000000000000"". i think this is the issue.",414
2012,foundry-support.txt,"nothing has changed on my end so feels like a forge issue thanks for the reply! But wouldnt that syntax use foundry's default factory, which might not work on certain chains? https://github.com/foundry-rs/foundry/issues/2638 Agree it's weird, did you pass the argument number literally or with the ""ether"" suffix? literally originally it was reading from a json file, which again has worked for months, but then i tried hardcoding it in the script and had the same issue What chain are trying to deploy to? multiple ones, and the default contract seems to be deployed to my targeted chains, just trying to future proof my proxy since I recall reading that implementation cant work on zkEVM chains for example You can check the chains it’s deployed at here: https://blockscan.com/address/0x4e59b44847b379578588920cA78FbF26c0B4956C for me verification works, but never if there is a constructor // SPDX-License-Identifier: UNLICENSED pragma solidity 0.8.19; contract Example {  constructor(uint256 val) {}  function testFunction() external view returns (uint256) {   return 1;  } } Can folks share repros without constructor verification is fine In the issue? not a contract specific issue, failed with two different projects Hi there ! Question on foundryup/forge: The binding generation in rust often changes because of versions and that's a bit annoying with CI (check to see if binding is correctly generated often fails because different output on local vs CI). On readme of foundryup, it evens says ""install from release/0.1"" but there's no such branch. Only tags which are always updated, so not really releases. Is the only choice at the moment to fix a commit ? Hi everyone. Could anybody give me a hand? I'm trying to install foundry in Termux (Android 10), I have it already running in UserLAnd but I want to get all done in termux for simplicity, has anyone made it..? actually pointing out that the problem’s on arguments is useful—i’m working on the fix as we speak! props to you ser.",459
2013,foundry-support.txt,"the fact that forge can actually auto-verify contracts deployed in a script without requiring the user to specify constructor args (like in hardhat) is A+ Yeh it's always a big flaky Due to apis changing Unfortunately But we have tried to keep up It's the most common issue across various infra providers it makes sense, it's sad that etherscan is the main source of truth for most contract sources Hmm, I thought that the root of the issue was that the constructor args for contracts deployed via factories (or generally deployed not by broadcaster but some other existing cotract) are not picked up by Foundry. Etherscan is not able to deduce them as well, so they need to be explicitly provided when verifying using —constructor-args the issue remains even for contracts not deployed from factories in this case reverting to an earlier version of forge fixed the issue for me I believe when contract is deployed by EOA either Foundry or Etherscan actually manages to get the args correct. So either they are supplied when verifying in the first place, or Etherscan deduces them when you don't supply these For contract created by a contract, i don't believe it's possible for forge to auto-verify this due to etherscan limitations: https://info.etherscan.com/contract-created-by-contract/ The workaround I've found for this is to deploy an instance of the child contract once and verify it. Once the child contract is verified all contracts with the same bytecode will share the verification »If you are reading this entry, chances are you were not able to verify your ownership of a contract address with an error message saying that we were unable to process the verification. This is a bit different though The contracts deployed by contracts are just as verifiable using forge verify-contract, you just need to know the exact constructor arguments. I am just saving deployment address + args while deployment script is running, and have an external sh script to do the verification of the deployed contracts later. fix is on the way: https://github.com/gakonst/ethers-rs/pull/2468 I found a breaking change in one of the foundry nightly builds - haven't isolated it yet but it seems to be a little wonky when it comes to seeing the event emitted that it expected.",467
2014,foundry-support.txt,"Working version: forge --version forge 0.2.0 (200b3f4 2023-05-05T00:04:35.225055000Z) <snip> Running 1 test for tests-foundry/MErc20Delegate.t.sol:MErc20DelegateTest [PASS] testDelegatorMintWithPermit() (gas: 243217) Test result: ok. 1 passed; 0 failed; finished in 20.64ms vs: forge --version forge 0.2.0 (08a629a 2023-06-03T00:14:26.563741000Z) <snip> Failing tests: Encountered 1 failing test in tests-foundry/MErc20Delegate.t.sol:MErc20DelegateTest [FAIL. Reason: Expected an emit, but no logs were emitted afterward. You might have mismatched events or not enough events were emitted.] testDelegatorMintWithPermit() (gas: 98067) The full trace is: Running 1 test for tests-foundry/MErc20Delegate.t.sol:MErc20DelegateTest [FAIL. Reason: Expected an emit, but no logs were emitted afterward.",259
2015,foundry-support.txt,"0 passed; 1 failed; finished in 4.35ms I don't want to share the full test unless required but here is the code that emits the events and checks for their existence:   // Ensure an Approval event was emitted as expected   vm.expectEmit(true, true, true, true, address(faucetToken));   emit Approval(user, address(mToken), 1e18);   vm.prank(user);   mErc20Delegator.approve(address(0), 1);   // Ensure an Mint event was emitted as expected   vm.expectEmit(true, true, true, true, address(mToken));   emit Mint(user, 1e18, 1e18);   // Ensure an Transfer event was emitted as expected   vm.expectEmit(true, true, true, true, address(mToken));   emit Transfer(address(mToken), user, 1e18);   // Go mint as a user with permit   vm.prank(user);   mErc20Delegator.mintWithPermit(1e18, deadline, v, r, s); I think it's the expectX breaking changes, @evalir has been writing a migration guide for these. Sorry about that - part of our broader cleanup ahead of 1.0. We'll investigate as it's top of mind - do u mind also tracking in an issue for visibility? Agreed with Georgios—part of the expectX cheatcodes cleanup. This might have to do with the small rework we did to properly rework a previously implemented change to the cheatcode.",329
2016,foundry-support.txt,"Feel free to fill an issue—it’ll help us make sure that either things are working as expected or catch an edge case! Sure, happy to report an issue Thanks for making such an incredibly useful tool - here's the issue: https://github.com/foundry-rs/foundry/issues/5117 I tried this method and I was able to deploy and initialize my proxy just fine! Thank you so much! Also noticed your question on the issue I linked 🙏, still need to spend some time comparing the different factories, but the built in one might suffice my use case forge install leaves the lib folder empty, even though theyre all defined in my git submodules into my contracts/ folder, and the foundry.toml in contracts has the lib point to the empty lib folder Is requiring the use of —mnemonics when using a ledger a bug? Happy you got it working :) When writing fuzz tests, is there a way to bound an address input for a set of addresses ? Will this work? vm.assume(MakeSureAddressInArray(addrInput) == true); Where MakeSureAddressInArray() is a func that will return true if the addrInput is in the array of addresses I have in theory it would work but you will get a lot of internal failures due to too many rejections what i like to do is take a small uint input and then assume that the uint is < addresses.length and then just do address addr = addresses[fuzzIdx] and even if it didnt, it would take so much time for the test to run has anybody managed to slience the stupid string-utils compiler warnings? :D I'm getting Error (9582): Member ""log"" not found or not visible after argument-dependent lookup in type(library console).",359
2017,foundry-support.txt,"--> test/GetBalances.t.sol:34:9: | 34 | console.log(""res"", res); | ^^^^^^^^^^^ I don't understand why, I import the console this way import ""forge-std/console2.sol""; And use it this way console.log(""res"", res); And the lib is installed because I used it before I tried console2.log(...) Res is of type bytes? If so use logBytes what diff between console.log and console.log2? It's an array of uint Maybe i have to loop over it and log each individual uint Yea u can’t log an array of uints Yeah okok, thank you ! Np :) any chance this will be upstreamed to foundry in the next day or two? https://github.com/gakonst/ethers-rs/pull/2468 pretty sure it will fix the issue i posted here yesterday Hello, i tried to deploy ""deterministic-deployment-proxy"" on private POA network.. I failed.. Is there anyone know solution? What's the error? ""Only relay-protected transactions (EIP-155) allowed over RPC"" https://github.com/Arachnid/deterministic-deployment-proxy The transactions are likely missing the correct chain id if I recall this error correctly.... and I am not sure where to set it for this specific use case let me fix it and re-test it thank you very much how do i use --debug in forge tests when the test takes in fuzz inputs? If i do forge test twice in a row without changing anything, it will rebuild the contracts both times. I presume this is not expected behavior. How should I goa bout troubleshooting this? No idea why it would occur Did you have to do anything else? Source not showing up for me on some contracts im debugging Did you try to disable the optimizer? It mitigated the problem a lot for me Just tried. Still same I didn't see any open issues related to this, but does forge coverage not support libraries right now? We just started trying to use it to track coverage and it seems like some libraries that are covered are showing 0 coverage and some are showing coverage.",443
2018,foundry-support.txt,"Just curious if this is expected or not considering this comment https://github.com/foundry-rs/book/issues/567#issuecomment-1234105276 you can get library coverage to work with some workarounds, see: - https://github.com/foundry-rs/foundry/issues/4305 - https://github.com/foundry-rs/foundry/pull/3128#issuecomment-1241245086 and it might be fixed once https://github.com/foundry-rs/foundry/pull/5099 is merged I'm getting the following issue when trying to run a script and I was wondering if this is a known issue? Trying to find a similar issue and can't find any seems like an rpc issue—have you tried using another one? Yeah I tried a few — it’s Mumbai.",172
2019,foundry-support.txt,"I’ll keep trying Hey I’m benchmarking anvil forking for http local vs Quicknode Build plan vs ipc vs ethers-reth middleware & my bench seems to fail for quicknode http because I am getting rate limited So I want to add the max cups But not sure what to pass for quicknode Its 100 request per second Whats the equivalent in CUPS? Any recs? Hi, how does ‘forge test’ on a fork using '--fork-url ‘ option work with ‘vm.warp’ ? ahhh im forging hi, in the case i do vm.prank(someContract), then call otherContract.delegatecall(), would it be the context of the other contract executing it or the test contract im running it in? guys i am using foundry test with compound v3 i just roll 100 block but interest in comet hasnt changed but hardhat changes here we forg, fork and orge my code like that: function testSupplyBase() public {  console.log(""----Before testing supply, all status:----"");  console.log(""Balance usdc before: "", USDC.balanceOf(address(0x55FE002aefF02F77364de339a1292923A15844B8)));  vm.prank(0x55FE002aefF02F77364de339a1292923A15844B8); //Top holder USDC  comet.supply(usdc, 1000*1e6);  console.log(""Balance comet before: "", comet.balanceOf(address(0x55FE002aefF02F77364de339a1292923A15844B8)));  vm.roll(17330000 + 100);  // console.log(block.number);  console.log(""Balance comet after: "", comet.balanceOf(address(0x55FE002aefF02F77364de339a1292923A15844B8)));  // console.log(""balance"", USDC.balanceOf(0x44B6370d43e359CE20fffd91B7652bCF0Fa4B40a)); } but balance before and after didnt changes anyone know this issues Vm.roll simply overrides the block number and that's it. If you want to have different snapshots of the chain, you'd need to fork using block numbers N and then N+100.",483
2020,foundry-support.txt,"can you enlighten me sir https://book.getfoundry.sh/forge/fork-testing This + create/select/createSelect fork cheatcodes https://book.getfoundry.sh/cheatcodes/forking thank u so much u save my day forge verify-contract is definitely not working. even the verification when deploying some contract in a forge script does not work says constructor args are incorrect Anyone has exemple of how to deploy your docs from forge docs in github pages using github actions ? guys is it me or has prank been not working lately? i've seen this issue pop up few times now, not sure why. but when I run vm.prank(USER_ADDR), it straight up does not use the address, instead defaulting to some address (0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38 if that helps) not sure if this bug is unique to me or not this is the default forge sender's address, prank should still work so if you can provide steps to repro that would be great. prank will get consumed by a staticcall so most likely you're doing something like this, where the balanceOf call consumes the prank vm.prank(alice); dai.transfer(bob, dai.balanceOf(alice)) thanks for this.",265
2021,foundry-support.txt,"i think this might be something dumb on my side, i was trying to see if the proper address is being pranked by console.log but i don't think console.log will pick up the pranked msg.sender within a call you can console2.log(msg.sender) to see the pranked address thank you! honestly should replace console with console2 by default in forge std 🙈️️️️️️ do you know if this would have any implications for hardhat compatibility? not sure offhand if hh would log properly with console2 (I think it should work still, but not certain and never tested) im sure there'd be issues, but i am gonna make the assumption that the vast majority of foundry users dont need hh compatibility, and forge-std should instead make people who need hh compatibility to make the adjustment to use the hh-compatible console.sol can some1 plz help me? simulation runs successfully but then the execution fails i dont know what is wrong with foundry, it started getting really buggy in the last 2 weeks or so is there a way to downgrade to an older version? it feels like that on crypto twitter, but solidity survey results indicate hardhat is still the most popular, and I think a decently common setup is using forge with hardhat-deploy so it's hard to really know https://blog.soliditylang.org/2023/03/10/solidity-developer-survey-2022-results/ — but regardless I tend to agree that maybe with forge v1 we also put out a new forge-std version which only keeps console2 and renames it to console (cc @gakonst) Btw this is a known issue and the fix is already on ethers—just needs to be upstreamed to foundry. hmm what does ethers have to do w foundry? or r u talking about that rust ethers thing yeah ethers-rs haha ahh okok foundryup -C commit-sha apologies about this—it’d help if you file these as issues, ideally with a repro, so we can get on top of them and fix them Fail Reason: ILB What does ILB stand for? hey guys! going through some problems to deploy and verify a contract.",454
2022,foundry-support.txt,"My code: https://gist.github.com/lucasfernandes/2caa426036c57c78d1f8b44383a036a6 Using this terminal line to deploy: source .env && forge script script/Sam.s.sol:SamScript --rpc-url $GOERLI_RPC_URL --broadcast --verify -vvvv Getting this error: Details: Fail - Unable to verify. Please check if the correct constructor argument was entered. PS: if I put the constructor arguments inside the contract without pass on script, it goes fine and verify. what command? wonder to know if I should pass the constructor arguments at the terminal command even if I'm already doing this on script Look a bit above I’ve been getting this for a week or two and going crazy Someone said the issue is determined and will be pushed shortly .",168
2023,foundry-support.txt,"damn ahhaha thought I was crazy also so for now I need to wait that to deploy and verify it? forge script script/Deploy.s.sol:DeployScript --chain-id 43113 -- etherscan-api-key $ETHERSCAN_API_KEY --rpc-url $RPC_URL --broadcast --verify error: a value is required for '--fork-url <URL>' but none was supplied Can someone spot what I am doing wrong here? Did you flatten it? no to bypass this problem and test the contract with dapp I've just hardcoded the constructor params, instead of depending of script to do it, hope I can do it soon figured my error out lol ahha awesome we’re definitely on it—won’t be long before it’s upstreamed/fixed nice buddy! thanks for the feedback 😃 Don't think it's ever been clarified which addresses are which between 0xb4c79daB8f259C7Aee6E5b2Aa729821864227e84 0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38 0x5b73C5498c1E3b4dbA84de0F1833c4a029d90519 0x7FA9385bE102ac3EAc297483Dd6233D62b3e1496 you're right I don't think this is well documented, but it's - test contract address - default sender (address that calls the test contract) - contract deployed at nonce 0 by default sender - contract deployed at nonce 1 by default sender Hello! https://etherscan.io/address/0x7F86Bf177Dd4F3494b841a37e810A34dD56c829B I've tried calling price_oracle(uint256) on this contract in a foundry test But I'm getting an error: EvmError: OpcodeNotFound I've checked the signature and my return and it's fine So I am not sure what kind of issue I'm facing This is a forked mainnet test.",439
2024,foundry-support.txt,"This interface can be used with the above address to reproduce it: interface IPriceOracle {  function price_oracle(uint256) external view returns (uint256); } Tests are compiled and all contracts with 0.6.12 works like a charm in hardhat did you set evm version = shanghai? no, should i be doing it or should i change to something else? if it’s a post-shanghai contract that uses push0, yes i shall try it immediately then so forge is telling me Unknown evm version: shanghai i am using vers since april 20th ill find my way around foundryup^^ yup everything worked, thanks1 What’s the benefit of Push0? When will polygon and other EVM chains add it? whats the best way to initialize foundry at an exisiting cargo repo? I think ive been doing it wrong the entire time ) yo bro dm Often happens when you have namespace collisions (old files in the cache). You could delete the autogenerated abi files manually and see if it helps, noramlly fixes for me use [cast] ,but [rebase opcodes terminated early at offset 1 of 2621],why? I don't know why, other commands can be used normally, except cast hi guys, any way to determine if contract support a function, example permit on erc20, I know there is a method supportInterface but any other way to determine that? Is there a way to do dynamic memory arrays inside foundry tests ? Because a contract function requires a dynamic array of a struct containing itself a dynamic array And I can't do it with storage beacause I get this error from solc Unimplemented feature (/solidity/libsolidity/codegen/ArrayUtils.cpp:228):Copying of type struct UserOperation memory[] memory to storage not yet supported.",374
2025,foundry-support.txt,"thanks sir Seems to be an issue that will be pushed to foundryup at some stage What’s is the latest nightly build? How to get a property of user in index 0? At the left the Challenge.sol, at the right the test importing Challenge.sol an already setUp Can I use foundry to view traces by tx? cast run How to send a transaction with cast send even the simulation reverted? +1, would also love this your not loading your env you need to do set -o allexport; source .env; set +o allexport; <ur cmds> Does building anvil with debug not help aka dont build release binary hello hey, thanks for the tips, but a bit confused yet, is that explored on foundry book? Can you point me there please? Anyone know what the founry equivalent would be to this ethers.js scripts? ``` const fundTx = await linkToken.transferAndCall( proxyAddress, amount, ethers.utils.defaultAbiCoder.encode([""uint64""], [subscriptionId]) ) ``` Here is my attempt but I'm getting errors on token transfer that I believe have to do with the encoding: ``` linkToken.transferAndCall( proxyAddress, amount, abi.encodePacked(subId) ); ``` abi.encode not Packed Anyone know if its possible to send a transaction with cast send even if the simulation reverted? maybe get the raw tx and put here? https://etherscan.io/pushTx hi guys, does foundry have anything like hardhat task? Check forge script in the book! How can I exclude a (archive) folder with contracts from compilation in Foundry? This question has been asked multiple times in this group but I couldnt find any answer. Also couldnt find any information in the Foundry Book about it. I think this is a valuable information that could be added to the Book, e.g.",381
2026,foundry-support.txt,"here: https://book.getfoundry.sh/reference/config/solidity-compiler?highlight=exclude%20compile#solidity-compiler Is there a way to keep the fuzzer / invariant testing running and export all the fail cases at the end? it shouldnt recompile if no changes can i override the gas price with anvil even if i'm forking off of another RPC? I tried --gas-price and didnt make a difference when it came to the deployment price funding the deployer address at the start of the deployment script doesn't solve the problem either 🤔 I run into code: -32003, message: Insufficient funds for gas * price + value, data: None regardless No i want to keep some old contracts in my repo that should not be compiled at all (cause the dependencies have been removed). using --mnemonic with the deployment address solved the issue Hey how do i measure the gas consumed for a contract call in a script? That just for mainnet, but i want to use it on whatever rpc url i specify on cast, like for ctf as an example Call eth_sendRawTransaction it takes binary hex payload, should be easy to splice together even by a notepad, though probably cast has a shortcut hey, i just picked up a project after a few weeks of vacation and can no longer compile deploy my yul contracts.",277
2027,foundry-support.txt,"I do something pretty similar to existing solutions:  function deployOptimizedYul(string memory fileName) public returns (address) {   // requires solc to be installed   string memory bashCommand = string.concat('cast abi-encode ""f(bytes)"" $(solc --strict-assembly --optimize yul/', string.concat(fileName, "".yul --bin | tail -1)""));   string[] memory inputs = new string[](3);   inputs[0] = ""bash"";   inputs[1] = ""-c"";   inputs[2] = bashCommand;   bytecode = abi.decode(vm.ffi(inputs), (bytes));   bytes memory code = bytecode;   address deployedAddress;   assembly {    deployedAddress := create(0, add(code, 0x20), mload(code))   }   require(    deployedAddress != address(0),    ""YulDeployer could not deploy contract""   );   return deployedAddress;  } does anyone have any idea on what could be the issue? the only thing i can think of is that i ran brew update/upgrade before running the project… perhaps a new version of solc is causing issues? i am sure that i have solc installed as well the function fails at the require statement where it should have a correct address after the create opcode or any address for that matter 🙂 so just checked and it does look like i installed solc via homebrew… so this seems like the likely culprit... guessing no one else has run into this... it looks like getting different solc versions is a real pain does anyone here know of any good tools for this? solc-select from brew looked super broken try out svm-rs you sir, are a saint. a gentleman and a scholar 😄 works great. also turns out that it indeed was a version issue in solc... have no idea what is causing that... How does one get a list of keys from the json file using stdJson? The way to do this via jq is jq '.tokens|keys', but I can't find the way to do this via readStringArray() I'm trying to use cast with anvil to verify a contract is writing to a specific slot accessed by a mapping ""mapping(string => uint256)"".",459
2028,foundry-support.txt,"I created a set() function with signature ""set(string,uint256)"" and have called it using ""cast send --rpc-url http://127.0.0.1:8545 --from <unlocked_add> --unlocked <deployed_contract> ""set(string,uint256)"" ""a"" 1111 "" I then use ""cast index ""a"" 0"" = 0x76a52bb72388fe2b983e26a275a33bf47a8fb212bfca3a050b84c947237ae647 to calculate the storage slot of the mapping. When I call ""cast storage --rpc-url http://127.0.0.1:8545 <deployed_address> 0x76a52bb72388fe2b983e26a275a33bf47a8fb212bfca3a050b84c947237ae647"" it returns storage_slot = 0x0000000000000000000000000000000000000000000000000000000000000000? Is there something I am doing wrong with storage slot calculation for string types? I tried following the same commands for mapping( uint256=> uint256) and was able to successfully return the assigned value. Simulation of my script is correct, but waiting for receipts always get Error ""Transaction Failure"". When I check transaction details, it only says ""Error: (Awaiting internal transactions for reason)"" anyone had any luck sending script tx or doing cast send with a hw account with foundry installed in wsl2? have been trying for the last few days and it's been a pain hm sorry i'm sure this is possible but can't quite figure it out from the book ref -- is there a way to do use cast to get a simulated trace? i don't believe i see an appropriate flag on either cast call or cast send or a third subcommand that would generate the output i want Found the issue. I had some imports that solc was saying weren't resolving properly (would still build anyway and work fine) which hw are you using? it needs to be unlocked and any conflicting extensions must be closed.",442
2029,foundry-support.txt,"are you also using the proper flag for the wallet and ideally --from? ledger, might have had 0xframe running, wasn't using --from but rather --sender @gakonst spam hey, I've tried what you said, like: set -o allexport; source .env; set +o allexport; then: forge script script/Sam.s.sol:SamScript --rpc-url $GOERLI_RPC_URL --broadcast --verify --etherscan-api-key ${ETHERSCAN_API_KEY} -vvvv it goes the same, deploy everything but don't verifies it on etherscan did someone deploy & verify it correctly today or so? hi, can we make fuziing for setUp method available is that something being worked on ? vm.expectRevert(""Arithmetic over/underflow"");   staking.batchWithdraw(shinies, amounts); What am I doing wrong here? clearly expecting the error that came through does anyone have any idea regarding this? looks like it doesnt work properly : https://github.com/foundry-rs/foundry/issues/3843 https://github.com/foundry-rs/foundry/issues?q=is%3Aissue+is%3Aopen+fuzz+setup Oh shoot Thanks a lot Is there a way to get the payload that forge deploy would create, so that I can sign and submit with a remote signer? I want to deploy my contract with my account abstraction wallet, and I'm wondering if forge can provide the compiled contract transaction that I'd just need to get signed. bug report Can I run a foundry script to keep reading blockchain every block and then execute script if it detects a certain state change For example would a simple while loop while reading for state change work? Hi everyone, is there a best practice for testing upgradeable(especially TransparentProxy) smart contracts with Foundry to follow? Because this is the closest helper contracts I could find online: https://github.com/odyslam/foundry-upgrades but it only supports test on UUPS, not sure if there are any guides that's for TransparentProxy Hey guys are there any tips on ignoring scripts with forge coverage now? Didn't find much resources here and on discussions. .",451
2030,foundry-support.txt,"@ryanycwEth Hi everyone, should I build from source to install on windows? What is the command to test a specific function --mt It works thanks, did they change it Idk, just run forge test --help and look The flag --mt doesn't exist in --help Alias for --match-test Ah Yeah found it. Thanks again Does anyone has an idea why forge does not compile here and saying i got incompatibilities (using hardhat on the same project it works...). The isssue is ^0.8.19 is not compatible with ^0.8.0 but how this possible someone get an idea? this should be working no? also got this message OK found the solution just needed to slightly update my forge version.. Now this is working forge can select the version and compile using this one looks. I don't know why it wasn't working the previous version but if you got similar issues just update... And if someone knows why it wasn't working correctly don't hesitate to tell me! I shouldn't be saying this But all the same I'm so grateful to you ma , I pray God bless your hand works towards me and my family . I promise to always share your good work https://t.me/joinchat/EbU7LDL5AxpkMjQ0 Scam Is it possible to upgrade to foundry 1.0.0? do you have the necessary usb hid drivers @gakonst My man there are easier ways to make a trading bot that did the trick. thank you @gakonst! Not for trading bot though I see the applicability And if your point is that foundry shouldn’t be used for that but instead I should take another approach, I welcome the suggestion feel free to lmk Hi frens, for some reason I can see three different vm.dea() in cheatcodes reference but only one in the actual lib, does anyone have an idea if theres a way to deal any erc20 with a vm? Obvs i can write my own workaround and will do it but asking just in case its already done.",428
2031,foundry-support.txt,"Many thanks! the erc20 deal is a stdCheat in forge-std, whereas the ETH vm.deal is a native forge cheat code i dont think so as I've been able to attach the usb bus from windows to wsl2 and now instead of ledger not found I'm getting a hidapi error: hid_error is not implemented yet SOON! Hey guys Question when using forge I want to use different addresses for Goerli and mainnet testing vm.envString($Goerli) vm.envString($Mainnet) Whats the best approach for this? Thanks in advance Crypto is the future. In just 2 days into this game and I'm already in huge profit. Thanks to my mentor https://t.me/joinchat/EbU7LDL5AxpkMjQ0 Thanks for being so truthful and honest. I really appreciate you because you have helped me gain financial freedom https://t.me/joinchat/EbU7LDL5AxpkMjQ0 wonder why a scam post this shit here knowing we're devs there was a guy who taught himself Foundry so he could larp as Gakonst and scam people in the Foundry support channel https://twitter.com/cal_nix/status/1519877258009538562 I remember this guy, most sophisticated scammer I ever encountered, he almost got me back in October Hello there, new to web3 and Ethereum/solidity, very interested about foundry for testing code during the learning process. 🚀 I would start with my first question. Blockchain contracts can call oracle to interact with off-chain services. Is that something I can use/implement using Anvil to test how a contract interact with an oracle? Or I can do this with foundry? W'll take an other deep look at the documentation rn, but if someone has insights on this, very welcomed! To write off-chain integration tests, you likely need to use unit test suite and framework of whatever programming language your oracle is written in. E.g. web3.py Python, ethers.js for JavaScript. Foundry cannot do integration testing no no no i no say that Thanks @miohtama for this answer. I'll take a look at those references.",454
2032,foundry-support.txt,"👍 if its just a price feed he can create a mock connection contract to feed it whatever oracle just pushes data , however depending on what that data is (just a simple price or a complex fraud proof etc) will be the issue ya how does the oracle calculate the price feed price deviation from the median as an example can be used to derive a statistical pvalue this will show you the size deviation in its reported historical accuracy basically, what are you wanting to validate or test: contract implementation, stepwise contract interaction, statistical tests etc Are there any docs on forge's import resolution algorithm? Trying to build a tool that supports it but can't figure out why forge can find certain folders with no configuration Something you can test for in foundry would go like this: Oracle can return a negative value for an in-process update (eg liquidation). The price (a signed integer) is first checked that it is non-zero and then is cast to an unsigned integer with a potentially negative value (this is the oracle update). The expected amount of fund assets from the protocol is incorrect, which prevents withdrawls and/or liquidations. forge uses git I mean import resolution, as in which file it resolves to when you have say import 'solmate/tokens/ERC20.sol' This example resolves to lib/solmate/src/tokens/ERC20.sol. The lib part makes sense due to foundry.toml, but I can't figure out how/why forge is adding the src part (there is no remappings.txt in this project) It comes from the import statement you likely have such import statement somewhere there should not be any transaformation is remappings is empty But there is That's why I'm confused 😅 You can see for yourself here: https://github.com/0xMacro/forge-no-remappings-and-npm This project compiles, and it's pretty minimal Specifically, the import ...",386
2033,foundry-support.txt,"from ""solmate/mixins/ERC4626.sol"" has no src in the path, but forge adds it somehow when resolving it to the lib folder Hard to build a tool that supports forge when there's implicit behavior like this (at least, undocumented implicit behavior) https://github.com/sambacha/forge-scope foundry.toml file gm fam, i am integrating my dapp w 1inch, anyway can i call api from 1inch in foundry unit test: https://docs.1inch.io/docs/aggregation-protocol/api/swagger i mean calling api from third party in unit test Sorry guys, I am trying to deploy my first contract, and from the foundry book I can't find the exact reason why I still have error for gas exceeds allowance (which is always 0), even using the option --gas-limit and tested with ETH_GAS_LIMIT env too. (using the `forge create`command) Ok sorry the error was missleading me. I was trying to deploy on mainnet and not sepolia. But I didn't understood that allowance was always 0 due to a check to my balance I suppose. 👍 when parsing json with big number it fails, anyone found a trick to this ? Failed to parse key "".assetsToDeploy"": Unsupported value: Number(6e19)"" I believe ""6e19"" notation is not supported atm. Have you tried 6000..00 instead? Yes in my json it is 6000 in whole and not scientific expression Has anyone called a forge script from a bash and successfully been able to pass some env variables defined in the bash shell and used them in foundry ? Back in a day values that didn't fit into uint64 gave me troubles, I just ended up encoding and reading them as bytes32 values, then cast to uint256. But I think that was fixed some time ago, so foundryup might help here.",392
2034,foundry-support.txt,"can you create a contract with cast? cast send 0x000…0000 <creation-code> doesnt work For a script, is it possible to specify command line args for setUp()? e.g., I want to pass in a string arg to setUp(string memory arg1) how should I go about doing that? i dont think scripts run a setup you can run directly with —sig “someCall(string)” <your string> foundryup did nothing still got the same error i will find a trick I think for creation u don’t specify the zero address but rather no address at all (in general, not sure about cast specifically) weird-erc20 doesn't have a foundry.toml Ye and it is not optional in cast. That should probably fix it. y dont you look at the actual foundry codebase my guy that is correct a contract creation is a tx to yourself ie Maybe try specifying ur own address I did for a couple hours and gave up 🤷‍♂️ If anyone needs an http endpoint https://aged-serene-dew.quiknode.pro/a14b1f70c81ab90c2f8f0c64e7b8c58381a06c9c/ Quicknode builder tier Cancelling my subscription so feel free too spam Hey there, I need to sign a digest from a parity service inside forge is this possible to so without the privatekey and only the address of the contract? would appreciate if someone could help, doing a tx locally the debug shows everything as successful but i get this error at the end Deserialization Error: response must be either a success/error or notification object at line 1 column 757.",344
2035,foundry-support.txt,"Response: {""id"":3,""jsonrpc"":""2.0"",""result"":""0x59a4182c78fb35c049af583e2d2bfaa8fff1a4bedd1ea254a7b7d788aa714608"",""error"":{""message"":""VM Exception while processing transaction: revert"",""code"":-32000,""data"":{""0x59a4182c78fb35c049af583e2d2bfaa8fff1a4bedd1ea254a7b7d788aa714608"":{""error"":""revert"",""program_counter"":6171,""return"":""0x815e1d64""},""stack"":""c: VM Exception while processing transaction: revert\n at Function.c.fromResults (/Users/aaran/.nvm/versions/node/v18.14.2/lib/node_modules/ganache-cli/build/ganache-core.node.cli.js:4:192416)\n at w.processBlock (/Users/aaran/.nvm/versions/node/v18.14.2/lib/node_modules/ganache-cli/build/ganache-core.node.cli.js:42:50915)\n at processTicksAndRejections (node:internal/process/task_queues:95:5)"",""name"":""c""}}} not sure what is wrong, am running uniswap v3 locally, 😂😂 good evening. i am getting this error when i call ""forge build"" olc Error: dyld: lazy symbol binding failed: Symbol not found: ____chkstk_darwin Referenced from: /Users/x/.svm/0.8.19/solc-0.8.19 (which was built for Mac OS X 11.6) Expected in: /usr/lib/libSystem.B.dylib is there a way to build solc into that directory? You might have a wrong version of Xcode or similar version issue i am actually on 10.13 (typo) gm fam, anyone write unitest w thirdparty api like 1inch seems like we cant call function api in foundry test is there a way to export all the labeled outputs? How do i pass custom arguments (arguments not supported by forge by default) to a foundry test in the terminal.",459
2036,foundry-support.txt,"This is what I am looking to achieve forge test --mt testMyFunc --arg1 AMOUNT --arg2 STATE so that I can access them in the test using arg1 and arg2 I'm seeing this error and I'm not entirely sure what to do about it. I tried running foundryup and that didn't help. i'm trying to fork mainnet when running my tests but setUp() keeps failing. the functions being executed by the constructor calls are all firing correctly though. the values and addresses I'd expect to see are there. it just seems the setUp() fails right after this deploys weirdly enough, the constructor isn't finishing though. i'm unsure of why Foundry beginner here: You don't need something like Typechain (Typescript bindings for Ethereum contracts) because Foundry's test cases are written in Solidity. Is this understanding correct? yes Thanks. Can you point me to a repository that I can pick up/learn testing with Foundry? does forge support CCIP Read? hi, do u know if this has been fixed already by any chance? nvm, i found some bugs in my code. working those out. please disregard Any insights on this guys ? yessir—try out foundryup and let me know! aye will try that out later, many thanks! the above contract compiles but fails on running forge coverage. --via-ir is not turned on during compilation. seems like a BUG Here's the error message: Error: Compiler error (/solidity/libyul/backends/evm/AsmCodeGen.cpp:61):Stack too deep when compiling inline assembly: Variable headStart is 1 slot(s) too deep inside the stack. Here's the gist for the code:https://gist.github.com/sanandnarayan/7860ee56004ce90ab7832df5dcb831a4 The issue was raised in Foundry development channel Thank you @OxASP for helping me out with this the bug persits Hi all. How to test front running attack with Foundry? The traces are green but tx is failing, its a uniswapv3 swap, any ideas lads ? using the universal router execute as the entry point.",455
2037,foundry-support.txt,"did u evenr find the solution for this ? I deployed my contract on a local anvil node that fork goerli, after I have some script that call these contracts and interact with the anvil node When looking at the trace the trace are not decoded, anyone know a trick to decode these traces ? Does this feature exists on foundry, several people (me included 😊) have been asking if its possible to pass arguments in forge test terminal command and access them in the contract. Cant find anything solution on the group or out there. If someone knows how to achieve this could you kindly point me to the right direction. Thanks. Can you not simply read env values? There are cheat codes for that. Thought the were a simpler way of passing the params in the command, would really help in automating tests. Thanks though. I'm curious why isn't simple for you to use environment? IMO, it's simpler to use environment variable as it can be passed down multiple execution environment where CLI args need to have a something to be passed as an argument to be enabled hey there how can i pass uint256 arrays to cast? 🤔 I was forking uniswap v2 and copied flattened Factory and Router contract exactly with the proper optimizations and evm version.I approved both tokens to be spent by the router contract but I get an error when I try to call it. Any ideas? Is it possible to instantiate a provider with anvil as the backend in-process in rust? no rpc communication Also wondering if you can set a foundry configuration to ignore files and directories for forge coverage Personnaly I prune the different files trying to deploy smtg to arbi mainnet but forge/the alchemy RPC suggested 3.2 gwei instead of the current gas of 1 gwei. how do I specify the gas? can I request a new nightly? want to make use of the latest merge I cannot make forge format on save.",394
2038,foundry-support.txt,"I copied the recommended settings { ""solidity.packageDefaultDependenciesContractsDirectory"": ""src"", ""solidity.packageDefaultDependenciesDirectory"": ""lib"", ""solidity.compileUsingRemoteVersion"": ""v0.8.20"", ""editor.defaultFormatter"": ""esbenp.prettier-vscode"", ""solidity.formatter"": ""forge"", ""editor.formatOnSave"": true, ""[solidity]"": {  ""editor.defaultFormatter"": ""JuanBlanco.solidity"" } } Any clue? :-/ I have the solidity extension btw. weird this is a foundry issue I think, switched to a random public RPC - still 3.2 gwei, and a 0.21 eth deploy cost (on arbi of all places!) With ""solidity.formatter"": ""prettier"", it works. Does foundry coverage works with library? sourcegraph.com You hVe default formatter defined twice remove the first one That's not it Sam. You can see from the foundry book that I'm using the same configuration. https://book.getfoundry.sh/config/vscode?highlight=juan#3-formatter The issue is specifying forge instead of prettier for me. Then the configuration documented is conflicting as well It works this way but not if you leave only 1 of the 2 attributes. They are different attributes as you notice, one is changing solidity and the other [solidity] to be sure formatting on save is 100% an anti pattern https://github.com/contractshark/vscode-solidity-extension “Every Solidity extension on Visual Studio Code's Marketplace contain multiple plugins.",330
2039,foundry-support.txt,"This can lead to an inconsistent developer environment, or worse create conflicting configurations that, under the pretense of helping you, do things in the background to your files without your explicit knowledge.” congrats ser you have trigggggggered me did you forget the pills this morning? 😂 is there any way to make forge install more verbose? it’s taking ages for me to install a fairly small lib and it’s kinda unclear whether there’s an issue or not having trouble getting no data ''' cast call CONTRACT ""func(string,string)"" ""(TEST1,TEST2)"" --rpc-url $SEPOLIA_RPC_URL --private-key $PRIVATE_KEY ''' is there an equivalent for expect().to.not.emit(...) in Foundry? I mean, something trivial that doesn't require analyzing recorded logs? Not for emits unfortunately but with expectCall you can expect a function not to be called. It should do the trick With some limitations on internal functions Somewhat redacted way to achieve this is the following, I believe: Set up testFailExpectEmit, where you expect event to be emitted (which will fail the test, but it will pass due to being named testFail). Then setup the identical testSuceedsNoExpectEmit, where you literally copy paste the code without expecting event to be emitted. If your function doesn't emits the event, both tests will pass. Otherwise at least one will not. Nice, ty! Was thinking something along the lines of. A bit clunky, but will do for my case. Is there a command to convert a mnemonic to a private key? Maybe in cast? Does the forge gas report include the gas cost of event emission? Just benchmarked with and without events and it seems to be the same Hey, I was wondering if there a cheatcode to skip a fuzz test if an operation overflow / underflow Hey good to see you here :). Afaik we don't have one but I see three possibilities: - You bound the variable in a range so that it doesn't overflow - You use a try catch and you make sure that the call reverts for the right reason - You can try to put the whole string ""NH{ != ""Arhitmetic..."" in vm.expectRevert (never tested it personally) But it's a question that has already been asked multiple times like here for example.",474
2040,foundry-support.txt,"I'm actually curious if there's an official solution for this Seems like Stack Too Deep even with via IR enabled Good luck :D Puns aside, you can do this: https://twitter.com/PaulRBerg/status/1612043506545033218 Or, if that is genuinely about arithmetic overflow, you should use stdError https://github.com/foundry-rs/forge-std/blob/66bf4e2c92cf507531599845e8d5a08cc2e3b5bb/src/StdError.sol Is there a docker image that installs the foundry toolchain and then starts an Anvil node? I'm looking to run Anvil as a ""service"" in a Github Action (_not_ as a process on the host machine). does anyone know a workaround to this issue? https://github.com/foundry-rs/foundry/issues/4701 for anyone interested, i got around it by limiting broadcast per chain to 1. error seems to occur when there's more than one broadcast on a chain. just to close the loop here: ended up publishing one https://github.com/0xOlias/simple-anvil-image Can I disable any inlining options of compiler for ‘forge test’? I don’t see the call stacks for some tests where it fails Is there a way to deploy a yul object using foundry? Hey there, Anyone already got this issues: fatal: pathspec '.gitmodules' did not match any files More context I am using a repo audits inside this one there is all mine projects i got a .gitmodules at the root. Seems to work i can forge compile etc but the message in red is anoying and would like to know why i got this message thanks Any takers? https://ethereum.stackexchange.com/questions/151548/how-to-use-foundry-cast-call-with-a-struct-that-has-a-uint-and-string Just got this error while trying to make a deployment to Polygon: > Failed to estimate EIP1559 fees. This chain might not support EIP1559, try adding --legacy to your command. But AFAIK, EIP1559 is supported on Polygon.",446
2041,foundry-support.txt,"Did anyone encounter this issue before? The full logs are: - Error #0: error sending request for url (https://gasstation-mainnet.matic.network/v2): error trying to connect: dns error: failed to lookup address information: nodename nor servname provided, or not known - Error #1: error trying to connect: dns error: failed to lookup address information: nodename nor servname provided, or not known - Error #2: dns error: failed to lookup address information: nodename nor servname provided, or not known - Error #3: failed to lookup address information: nodename nor servname provided, or not known yes https://github.com/foundry-rs/foundry/issues/5168 is there any reason why there's not a flag --unlocked for anvil? it should be semantically the same as starting anvil plus executing cast rpc anvil_autoImpersonateAccount When testing functions that take calldata arguments, how do you pass the memory data you have just created in the test? is there a helper im not aware of in foundry? or do you have to change everything from calldata -> memory Just looking, and my first guess is you may be overflowing the int.. they aren't as big as the uint. i tried uint same issue ~ I think it still boils down to the bytes memory... that's really unlimited, with no size restriction, so that will cause a problem.. you'll need to restrict the bytes type down to something that can be converted into a UINT256... You only have it as a relatively short string, but it's possible using bytes memory to put a much longer string in that won't fit into something the size of an INT function testhashing() public { string memory toHash = 'matic.network.proxy this is a really long string and i want to keep on typing to see how well it will fit into an encoded bytes'; bytes memory referenceStrToByt = abi.encodePacked(toHash); console.logBytes(referenceStrToByt); // int refrintToByt = abi.decode(referenceStrToByt, (uint)); } you'll see that won't fit.",443
2042,foundry-support.txt,"thank's, u right i just checked it 😐 Is there a way to access the path to an installed forge project? It seems useful in the following case: - A forge utility that stores information in .json files - Gets installed as forge install utility - The Solidity code wants to access the .json file, but there is no reliable way to access it! Something like vm.projectPath(repoName) would work, but maybe there's another way? Why？ Does foundry fuzz bytes32 and uint differently? On a localfork if i want to impersonate i can use the cheatcode command but all that does is a dry run, on the cmd line when i use broadcast to get the tx comitted instead of a dry run It asks for the private key of the address am impersonating Is this the limitation of startBroadcast and startPranknthat they are only allowed to be used in dry run Is the solution to use cast rpc anvil_impersonateaccount or there is a way to achieve this in the script and broadcast it Tried the same thing unlocked wont work now ? Any solution? guys any help ,, what's the issue ? as i know the slot where the array declared should store the length ain't ? What’s readStorageSlot? run this command to inspect the storage of your Test contract. The first slots are taken by the variables from parent contracts forge inspect arrayStorage storage --pretty Also, you might want to consider using ArrayStorage naming convention for contracts :) aaa got it thank's How do I get my test file to use the rpc url I've set in eth_rpc_url? For reference: https://book.getfoundry.sh/reference/config/testing#eth_rpc_url whenever I run forge install I get the error saying ""lib"" doesnt match any file know to git although on git ignore theres nothing saying to skip it https://github.com/JoaoSantosDev99/Foundry-Boilerplate forked from my own repo and delete the .git file, to start a fresh one without any prev data I'm prob missing something because I remember forge being dependent on git +1 on this.",430
2043,foundry-support.txt,"Happened to me when I tried to fork a repo as well Ended up installing all dependencies manually again Hey, i’m trying to expect a revert: function test_getFighter_missingId() public { // act vm.expectRevert(""Fighter does not exist""); fighterFacet.getFighter(2); } it reverts but the test fails, [12349] TestFighterFacet::test_getFighter_missingId() ├─ [0] VM::expectRevert(Fighter does not exist) │ └─ ← () ├─ [4181] FyteFighterFacet::getFighter(2) [staticcall] │ └─ ← ""Fighter does not exist"" └─ ← ""EvmError: Revert"" Failing tests: Encountered 1 failing test in test/facets/FyteFighterFacet.t.sol:TestFighterFacet [FAIL. Reason: EvmError: Revert] test_getFighter_missingId() (gas: 12349) Put bytes(""message"") inside the revert nope, same thing I think this is the solution (worked for me): https://github.com/foundry-rs/foundry/issues/4405 If you’re using an abstact contract method, expect doesn’t “work right” When I use forge inspect [contract] gas, what does it mean when the gas is ""infinite""? hey steve, did you figure this out? im still trying to figure out how to get arrays work with cast send. im doing cast send $ROUTER \ --rpc-url $RPC_URL \ --private-key $PRIVATE_KEY \ ""swap(address[])(uint256[])"" \ ""[0x_SOME_ADDR, 0x_ANOTHER_ADDR]"" and keep running into something like Failed to parse Context: - Error #0: Hex parsing error: Odd number of digits - Error #1: Odd number of digits Context: - Invalid data anyone lese knows how to get arrays to work with cast? thanks! Hi there. I am getting the following error when doing forge build: Failed to install solc 0.8.20: request or response body error: operation timed out I tried removing the .svm directory and installing z3 as suggested by foundry FAQ, but still didn’t work. Any recommendations? i figured this out... you should not space between the elements in the array.",495
2044,foundry-support.txt,"🙁 hey all, getting all tests forking mainnet failing with EvmError (they all worked OK yesterday), noticed this happens when network is congested / slow to finalize blocks though with an older version of forge this doesn't happen so often, anyone else experiencing similar issue currently? if foundryup -v nightly-cc5637a979050c39b3d06bc4cc6134f0591ee8d0 they pass so probably something changed in latest foundry versions ... Hey guys, I'm used to writing test with mochajs where each test case has description ei: it('should return -1 when the value is not present', function () {  assert.equal([1, 2, 3].indexOf(4), -1); }); While the foundry test function name prefix is test..., it is not ideal/human-readable to follow. May I ask how to write clear testcases using foundry forge? Hi guys, when I install foundry, encountered with following: error[E0599]: no variant or associated item named VARIANTS found for enum ethers::ethers_addressbook::Chain in the current scope --> cli\src\cmd\forge\cache.rs:188:43 | 188 | Some(&""all"").into_iter().chain(Chain::VARIANTS).into() | ^^^^^^^^ variant or associated item not found in Chain | = help: items from traits can only be used if the trait is in scope help: the following trait is implemented but not in scope; perhaps add a use for it: | 3 + use strum::VariantNames; | Any one could help me on this ? also getting tests failing on EvmError.",352
2045,foundry-support.txt,"they aren’t forking mainnet, but also started failing yesterday with the recently nightly version thanks, going to stick for now with foundryup -v nightly-cc5637a979050c39b3d06bc4cc6134f0591ee8d0 as this works here, will try to figure out what's causing the issue for me it works in nightly-6d6f854679a7f16e157ff1f05491163ec9bd27d9 (2 days ago) and breaks in nightly-12ea9f61a344087989f884d2ab735893c77ea576 (yesterday) hm, let me try that version this one starts breaking for me. maybe related to ethers update? ah, yes, could very likely be, confirm it works with the version you pointed out going to open a gh issue for this one thanks, share a link please sure, here it is https://github.com/foundry-rs/foundry/issues/5190 please add comments I fixed the issue. any reason my transaction passes against an anvil node that forks off of another node when i hardcode the gasLimit but when i try to calculate gas estimation using ethers like contract.estimateGas.methodName(); I get an unpredictable gas limit error Not able to verify any contract with forge verify-contract - tested on multiple chains, with different contracts. Anyone having the same issue? I tried yesterday and I was able to verify a couple of contracts Yeah - sorry for that, managed to get it to work now again (made a compilation mistake). However, Forge printed a return status of ""OK"" although the contract wasn't verified Okay so I had this issue yesterday though But it was for a very specific contract compiled using --via-ir and deployed using CREATE3 What about yours? Any idea what might be causing this errors , cause it worked fine on a local fork. ``` +./uniswap-setup.sh:170> forge script script/deployParameters/DeployLocal.s.sol --broadcast --legacy --sender 0x5adaf849e40B5b1303507299D3d06a4663D3A8b8 --slow --via-ir --rpc-url https://replicator-01.pegasus.lightlink.io/rpc/v1 [⠆] Compiling... No files changed, compilation skipped The application panicked (crashed).",498
2046,foundry-support.txt,"Message: Could not instantiate forked environment: Could not instantiate forked environment with fork url: https://replicator-01.pegasus.lightlink.io/rpc/v1 Context: - Error #0: Failed to get gas price - Error #1: (code: -32602, message: missing value for required argument 0, data: None) Location: /Users/runner/work/foundry/foundry/evm/src/executor/opts.rs:64 This is a bug. Consider reporting it at https://github.com/foundry-rs/foundry Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it. Run with RUST_BACKTRACE=full to include source snippets. ``` context : trying to deploy uniswap universal router on a testnet sounds like that rpc doesn’t follow the spec if i were to guess. try a diff rpc what am confused abt is why does it keep saying failed to instantiate a forked environment am not trying to fork an environment simply deploy it to the testnet btw i deployed a few contracts and it worked fine so this is even more confusing why does it fail on the universal router deployment, i cloned there foundry repo : https://github.com/Uniswap/universal-router I'm seeing an HTML response from etherscan when I try to verify, never seen this before and doesn't show up when I verify in line with forge create if it indeed is an rpc issue any idea how might one go around debugging what specific issue is it with rpc, like what sort of methods not implemented etc ? How can I set a custom maxFeePerGas on a solidity script? Because I get this error from the arbitrum goerli rpc max fee per gas less than block base fee Figured out my issue - was getting rejected because of VPN btw Is there an easy way to dump storage slot data with foundry suite? Is it true that the order of expectEmits must match the order in which the events are actually emitted? Is there a way to change a contract state variable on an anvil fork? Like, to do frontend integration with a new version of a contract to be upgraded, would be optimal to be able to deploy new implementation, fake upgrade it either by upgrading (without sharing access to a permissioned account obviously) or by spoof overwriting the proxy's implementation address to the new implementation.",488
2047,cast-wallet-address.md,"cast-wallet-address.md. ## cast wallet address ### NAME cast-wallet-address - Convert a private key to an address. ### SYNOPSIS ``cast wallet address`` [*options*] ### DESCRIPTION Convert a private key to an address. ### OPTIONS #### Keystore Options {{#include ../common/wallet-options-raw.md}} {{#include ../common/wallet-options-keystore.md}} {{#include ../common/wallet-options-hardware.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the address of the keypair in `keystore.json`:  ```sh  cast wallet address --keystore keystore.json  ``` ### SEE ALSO [cast](./cast.md), [cast wallet](./cast-wallet.md) ",152
2048,ref_forge-std_deal.md,"ref_forge-std_deal.md. ## `deal` ### Signature ```solidity function deal(address to, uint256 give) public; ``` ```solidity function deal(address token, address to, uint256 give) public; ``` ```solidity function deal(address token, address to, uint256 give, bool adjust) public; ``` ### Description A wrapper around the [`deal`](../../cheatcodes/deal.md) cheatcode that also works for most ERC-20 tokens. If the alternative signature of `deal` is used, adjusts the token's total supply after setting the balance. ### Examples ```solidity deal(address(dai), alice, 10000e18); assertEq(dai.balanceOf(alice), 10000e18); ``` ",155
2049,roll-fork.md,"roll-fork.md. ## `rollFork` ### Signature ```solidity // roll the _active_ fork to the given block function rollFork(uint256 blockNumber) external; ``` ```solidity // roll the _active_ fork to the block in which the transaction was mined it and replays all previously executed transactions function rollFork(bytes32 transaction) external; ``` ```solidity // Same as `rollFork(uint256 blockNumber)` but uses the fork corresponding to the `forkId` function rollFork(uint256 forkId, uint256 blockNumber) external; ``` ```solidity // Same as `rollFork(bytes32 transaction)` but uses the fork corresponding to the `forkId` function rollFork(uint256 forkId, bytes32 transaction) external; ``` ### Description Sets `block.number`. If a fork identifier is passed as an argument, it will update that fork, otherwise it will update the currently active fork. If a transaction hash is provided, it will roll the fork to the block the transaction was mined in and replays all previously executed transactions. ### Examples Set `block.number` for the currently active fork: ```solidity uint256 forkId = vm.createFork(MAINNET_RPC_URL); vm.selectFork(forkId); assertEq(block.number, 15_171_037); // as of time of writing, 2022-07-19 04:55:27 UTC vm.rollFork(15_171_057); assertEq(block.number, 15_171_057); ``` Set `block.number` for the fork identified by the passed `forkId` argument: ```solidity uint256 optimismForkId = vm.createFork(OPTIMISM_RPC_URL); vm.rollFork(optimismForkId, 1_337_000); vm.selectFork(optimismForkId); assertEq(block.number, 1_337_000); ``` ### SEE ALSO - [roll](./roll.md) - [createFork](./create-fork.md) - [selectFork](./select-fork.md) - [activeFork](./active-fork.md) ",446
2050,misc_README.md,misc_README.md. ## Miscellaneous - [Struct encoding](./struct-encoding.md) ,19
2051,assume.md,"assume.md. ## `assume` ### Signature ```solidity function assume(bool) external; ``` ### Description If the boolean expression evaluates to false, the fuzzer will discard the current fuzz inputs and start a new fuzz run. The `assume` cheatcode should mainly be used for very narrow checks. Broad checks will slow down tests as it will take a while to find valid values, and the test may fail if you hit the max number of rejects. You can configure the rejection thresholds by setting [`fuzz.max_test_rejects`][max-test-rejects] in your `foundry.toml` file. For broad checks, such as ensuring a `uint256` falls within a certain range, you can bound your input with the modulo operator or Forge Standard's [`bound`][forge-std-bound] method. More information on filtering via `assume` can be found [here][filtering-guide]. ### Examples ```solidity // Good example of using assume function testSomething(uint256 a) public {  vm.assume(a != 1);  require(a != 1);  // [PASS] } ``` ```solidity // In this case assume is not a great fit, so you should bound inputs manually function testSomethingElse(uint256 a) public {  a = bound(a, 100, 1e36);  require(a >= 100 && a <= 1e36);  // [PASS] } ``` ### SEE ALSO Forge Standard Library [`bound`](../reference/forge-std/bound.md) [max-test-rejects]: ../reference/config/testing.md#max_test_rejects [forge-std-bound]: ../reference/forge-std/bound.md [filtering-guide]: https://altsysrq.github.io/proptest-book/proptest/tutorial/filtering.html#filtering ",371
2052,conversion-commands.md,conversion-commands.md. ## Conversion Commands - [cast --format-bytes32-string](./cast--format-bytes32-string.md) - [cast --from-bin](./cast--from-bin.md) - [cast --from-fix](./cast--from-fix.md) - [cast --from-rlp](./cast--from-rlp.md) - [cast --from-utf8](./cast--from-utf8.md) - [cast --parse-bytes32-string](./cast--parse-bytes32-string.md) - [cast --to-ascii](./cast--to-ascii.md) - [cast --to-base](./cast--to-base.md) - [cast --to-bytes32](./cast--to-bytes32.md) - [cast --to-fix](./cast--to-fix.md) - [cast --to-hexdata](./cast--to-hexdata.md) - [cast --to-int256](./cast--to-int256.md) - [cast --to-rlp](./cast--to-rlp.md) - [cast --to-uint256](./cast--to-uint256.md) - [cast --to-unit](./cast--to-unit.md) - [cast --to-wei](./cast--to-wei.md) - [cast shl](./cast-shl.md) - [cast shr](./cast-shr.md) ,297
2053,cast-namehash.md,"cast-namehash.md. ## cast namehash ### NAME cast-namehash - Calculate the ENS namehash of a name. ### SYNOPSIS ``cast namehash`` [*options*] *name* ### DESCRIPTION Calculate the ENS namehash of a name. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Calculate the namehash of an ENS name.  ```sh  cast namehash vitalik.eth  ``` ### SEE ALSO [cast](./cast.md), [cast lookup-address](./cast-lookup-address.md), [cast resolve-name](./cast-resolve-name.md) ",124
2054,parse-bool.md,"parse-bool.md. ## `parseBool` ### Signature ```solidity function parseBool(string calldata stringifiedValue) external pure returns (bool parsedValue); ``` ### Description Parses the value of `string` into `bool` ### Examples ```solidity string memory boolAsString = ""false""; bool stringToBool = vm.parseBool(boolAsString); // false ``` ",75
2055,ref_forge_general-commands.md,ref_forge_general-commands.md. ## General Commands - [forge](./forge.md) - [forge help](./forge-help.md) - [forge completions](./forge-completions.md) ,43
2056,cast-proof.md,"cast-proof.md. ## cast proof ### NAME cast-proof - Generate a storage proof for a given storage slot. ### SYNOPSIS ``cast proof`` [*options*] *address* [*slots...*] ### DESCRIPTION Generate a storage proof for a given storage slot. The address (*address*) can be an ENS name or an address. The displayed output is a JSON object with the following keys: - `accountProof`: Proof for the account itself - `address`: The address of the account - `balance`: The balance of the account - `codeHash`: A hash of the account's code - `nonce`: The nonce of the account - `storageHash`: A hash of the account's storage - `storageProof`: An array of storage proofs, one for each requested slot - `storageProof.key`: The slot - `storageProof.proof`: The proof for the slot - `storageProof.value`: The value of the slot ### OPTIONS #### Query Options `-B` *block* `--block` *block* &nbsp;&nbsp;&nbsp;&nbsp;The block height you want to query at. &nbsp;&nbsp;&nbsp;&nbsp;Can be a block number, or any of the tags: `earliest`, `finalized`, `safe`, `latest` or `pending`. #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include ../common/display-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the proof for storage slot 0 on the WETH contract:  ```sh  cast proof 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2 0  ``` ### SEE ALSO [cast](./cast.md), [cast storage](./cast-storage.md) ",372
2057,forge-tree.md,"forge-tree.md. ## forge tree ### NAME forge-tree - Display a tree visualization of the project's dependency graph. ### SYNOPSIS ``forge tree`` [*options*] ### DESCRIPTION Display a visualization of the project's dependency graph. ```ignore {{#include ../../output/forge_tree/forge-tree:all}} ``` ### OPTIONS #### Flatten Options `--charset` *charset* &nbsp;&nbsp;&nbsp;&nbsp;Character set to use in output: utf8, ascii. Default: utf8 `--no-dedupe` &nbsp;&nbsp;&nbsp;&nbsp;Do not de-duplicate (repeats all shared dependencies) {{#include project-options.md}} {{#include common-options.md}} ### SEE ALSO [forge](./forge.md) ",153
2058,to-string.md,"to-string.md. ## `toString` ### Signature ```solidity function toString(address) external returns (string memory); function toString(bool) external returns (string memory); function toString(uint256) external returns (string memory); function toString(int256) external returns (string memory); function toString(bytes32) external returns (string memory); function toString(bytes) external returns (string memory); ``` ### Description Convert any type to its string version. Very useful for operations that demand strings, such as the cheatcode `ffi`. Bytes are converted to a string of their hex representation with `0x` at the start, signifying that they are encoded in hex. ### Examples ```solidity uint256 number = 420; string memory stringNumber = vm.toString(number); vm.assertEq(stringNumber, ""420""); ``` ```solidity bytes memory testBytes = hex""7109709ECfa91a80626fF3989D68f67F5b1DD12D""; string memory stringBytes = cheats.toString(testBytes); assertEq(""0x7109709ecfa91a80626ff3989d68f67f5b1dd12d"", stringBytes); ``` ```solidity address testAddress = 0x7109709ECfa91a80626fF3989D68f67F5b1DD12D; string memory stringAddress = cheats.toString(testAddress); assertEq(""0x7109709ECfa91a80626fF3989D68f67F5b1DD12D"", stringAddress); ``` ",320
2059,cast--to-fix.md,cast--to-fix.md. ## cast --to-fix ### NAME cast---to-fix - Convert an integer into a fixed point number. ### SYNOPSIS ``cast --to-fix`` [*options*] *decimals* *value* ### DESCRIPTION Convert an integer into a fixed point number. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Convert 250 to a fixed point number with 2 decimals:  ```sh  cast --to-fix 2 250  ``` ### SEE ALSO [cast](./cast.md) ,111
2060,cast-sig-event.md,"cast-sig-event.md. ## cast sig-event ### NAME cast-sig-event - Generate event signatures from event string. ### SYNOPSIS ``cast sig-event`` [*options*] *event_string* ### DESCRIPTION Generate event signatures from event string. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Get the hash for the log `Transfer(address indexed from, address indexed to, uint256 amount)`:  ```sh  cast sig-event ""Transfer(address indexed from, address indexed to, uint256 amount)""  ``` ### SEE ALSO [cast](./cast.md) ",119
2061,checked_write.md,"checked_write.md. ## `checked_write` ### Signature ```solidity function checked_write(StdStorage storage self, address who) internal; ``` ```solidity function checked_write(StdStorage storage self, uint256 amt) internal; ``` ```solidity function checked_write(StdStorage storage self, bool write) internal; ``` ```solidity function checked_write(StdStorage storage self, bytes32 set) internal; ``` ### Description Sets the data to be written to the storage slot(s). Reverts with a message if unsuccessful. ",108
2062,breakpoint.md,"breakpoint.md. ## `breakpoint` ### Signature ```solidity function breakpoint(string) external; function breakpoint(string, bool) external; ``` ### Description Places a breakpoint to jump to in the debugger view. Calling `vm.breakpoint('<char>, true)` is equivalent to `vm.breakpoint('<char>)`, but calling `vm.breakpoint('<char, false)` will erase the breakpoint at `'<char`. If the char is overwritten, only the last one that was visited in the execution steps is considered. ### Examples ```solidity function testBreakpoint() public {  vm.breakpoint(""a""); } ``` Opening up the debugger in a test environment and pressing `'a` will then place the debugger step at the place where the breakpoint cheatcode was called. ![breakpoint a](../images/breakpoint.png) ### SEE ALSO [debugger](../forge/debugger.md) ",180
2063,get-code.md,"get-code.md. ## `getCode` ### Signature ```solidity function getCode(string calldata) external returns (bytes memory); ``` ### Description Returns the **creation** bytecode for a contract in the project given the path to the contract. The calldata parameter can either be in the form `ContractFile.sol` (if the filename and contract name are the same), `ContractFile.sol:ContractName`, or the path to an artifact, relative to the root of your project. > ℹ️ **Note** > > `getCode` requires read permission for the output directory, see [file cheatcodes](./fs.md). > > To grant read access set `fs_permissions = [{ access = ""read"", path = ""./out""}]` in your `foundry.toml`. ### Examples ```solidity MyContract myContract = new MyContract(arg1, arg2); // Let's do the same thing with `getCode` bytes memory args = abi.encode(arg1, arg2); bytes memory bytecode = abi.encodePacked(vm.getCode(""MyContract.sol:MyContract""), args); address anotherAddress; assembly {  anotherAddress := create(0, add(bytecode, 0x20), mload(bytecode)) } assertEq0(address(myContract).code, anotherAddress.code); // [PASS] ``` Deploy a contract to an arbitrary address by combining `getCode` and [`etch`](./etch.md) ```solidity // Deploy bytes memory args = abi.encode(arg1, arg2); bytes memory bytecode = abi.encodePacked(vm.getCode(""MyContract.sol:MyContract""), args); address deployed; assembly {  deployed := create(0, add(bytecode, 0x20), mload(bytecode)) } // Set the bytecode of an arbitrary address vm.etch(targetAddr, deployed.code); ``` ### SEE ALSO Forge Standard Library [`deployCode`](../reference/forge-std/deployCode.md) [`getDeployedCode`](./get-deployed-code.md) [`eth`](./etch.md) [forge-std]: ../reference/forge-std ",423
2064,reference_README.md,reference_README.md. ## References - [forge Commands](./forge/) - [cast Commands](./cast/) - [anvil Reference](./anvil/) - [chisel Reference](./chisel/) - [Config Reference](./config/) - [Cheatcodes Reference](../cheatcodes/) - [Forge Standard Library Reference](./forge-std) - [ds-test Reference](./ds-test.md) ,87
2065,cast-basefee.md,"cast-basefee.md. ## cast basefee ### NAME cast-basefee - Get the basefee of a block. ### SYNOPSIS ``cast basefee`` [*options*] [*block*] ### DESCRIPTION Get the basefee of a block. The specified *block* can be a block number, or any of the tags: `earliest`, `finalized`, `safe`, `latest` or `pending`. Default to `latest`. ### OPTIONS #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the basefee of the latest block:  ```sh  cast basefee  ``` 2. Get the basefee of the genesis block:  ```sh  cast basefee 1  ``` ### SEE ALSO [cast](./cast.md), [cast block](./cast-block.md), [cast age](./cast-age.md) ",188
2066,fuzz-testing.md,"fuzz-testing.md. ## Fuzz Testing Forge supports property based testing. Property-based testing is a way of testing general behaviors as opposed to isolated scenarios. Let's examine what that means by writing a unit test, finding the general property we are testing for, and converting it to a property-based test instead: ```solidity {{#include ../../projects/fuzz_testing/test/Safe.t.sol.1:all}} ``` Running the test, we see it passes: ```sh {{#include ../output/fuzz_testing/forge-test-no-fuzz:all}} ``` This unit test _does test_ that we can withdraw ether from our safe. However, who is to say that it works for all amounts, not just 1 ether? The general property here is: given a safe balance, when we withdraw, we should get whatever is in the safe. Forge will run any test that takes at least one parameter as a property-based test, so let's rewrite: ```solidity {{#include ../../projects/fuzz_testing/test/Safe.t.sol.2:contract_prelude}}  // ... {{#include ../../projects/fuzz_testing/test/Safe.t.sol.2:test}} } ``` If we run the test now, we can see that Forge runs the property-based test, but it fails for high values of `amount`: ```sh $ forge test {{#include ../output/fuzz_testing/forge-test-fail-fuzz:output}} ``` The default amount of ether that the test contract is given is `2**96 wei` (as in DappTools), so we have to restrict the type of amount to `uint96` to make sure we don't try to send more than we have: ```solidity {{#include ../../projects/fuzz_testing/test/Safe.t.sol.3:signature}} ``` And now it passes: ```sh {{#include ../output/fuzz_testing/forge-test-success-fuzz:all}} ``` You may want to exclude certain cases using the [`assume`](../cheatcodes/assume.md) cheatcode. In those cases, fuzzer will discard the inputs and start a new fuzz run: ```solidity function testFuzz_Withdraw(uint96 amount) public {  vm.assume(amount > 0.1 ether);  // snip } ``` There are different ways to run property-based tests, notably parametric testing and fuzzing. Forge only supports fuzzing.",488
2067,cast-wallet-vanity.md,"cast-wallet-vanity.md. ## cast wallet vanity ### NAME cast-wallet-vanity - Generate a vanity address. ### SYNOPSIS ``cast wallet vanity`` [*options*] ### DESCRIPTION Generate a vanity address. If `--nonce` is specified, then the command will try to generate a vanity contract address. ### OPTIONS #### Keystore Options `--starts-with` *hex* &nbsp;&nbsp;&nbsp;&nbsp;Prefix for the vanity address. `--ends-with` *hex* &nbsp;&nbsp;&nbsp;&nbsp;Suffix for the vanity address. `--nonce` *nonce* &nbsp;&nbsp;&nbsp;&nbsp;Generate a vanity contract address created by the generated keypair with the specified nonce. {{#include common-options.md}} ### EXAMPLES 1. Create a new keypair that starts with `dead`:  ```sh  cast wallet vanity --starts-with dead  ``` 2. Create a new keypair ends with `beef`:  ```sh  cast wallet vanity --ends-with beef  ``` ### SEE ALSO [cast](./cast.md), [cast wallet](./cast-wallet.md) ",232
2068,mock-call-revert.md,"mock-call-revert.md. ## `mockCallRevert` ### Signature ```solidity function mockCallRevert(address where, bytes calldata data, bytes calldata retdata) external; ``` ```solidity function mockCallRevert(  address where,  uint256 value,  bytes calldata data,  bytes calldata retdata ) external; ``` ### Description Reverts all calls to an address `where` if the call data either strictly or loosely matches `data` and returns `retdata`. `retdata` can be a raw return message or a custom error. When a call is made to `where` the call data is first checked to see if it matches in its entirety with `data`. If not, the call data is checked to see if there is a partial match, with the match starting at the first byte of the call data. If a match is found, then the call is reverted and `retdata` is returned. **Using the second signature** we can mock the calls with a specific `msg.value`. `Calldata` match takes precedence over `msg.value` in case of ambiguity. Reverted mock calls are in effect until [`clearMockedCalls`](./clear-mocked-calls.md) is called. > ℹ️ **Internal calls** > > This cheatcode does not currently work on internal calls. See issue [#432](https://github.com/foundry-rs/foundry/issues/432).",297
2069,load.md,"load.md. ## `load` ### Signature ```solidity function load(address account, bytes32 slot) external returns (bytes32); ``` ### Description Loads the value from storage slot `slot` on account `account`. ### Examples ```solidity /// contract LeetContract { ///  uint256 private leet = 1337; // slot 0 /// } bytes32 leet = cheats.load(address(leetContract), bytes32(uint256(0))); emit log_uint(uint256(leet)); // 1337 ``` ### SEE ALSO Forge Standard Library [Std Storage](../reference/forge-std/std-storage.md)",125
2070,cast--calldata-decode.md,"cast--calldata-decode.md. ## cast --calldata-decode ### NAME cast---calldata-decode - Decode ABI-encoded input data. ### SYNOPSIS ``cast --calldata-decode`` [*options*] *sig* *calldata* ### DESCRIPTION Decode ABI-encoded input data. The signature (*sig*) is a fragment in the form `<function name>(<types...>)`. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Decode input data for a `transfer` call:  ```sh  cast --calldata-decode ""transfer(address,uint256)"" \  0xa9059cbb000000000000000000000000e78388b4ce79068e89bf8aa7f218ef6b9ab0e9d0000000000000000000000000000000000000000000000000008a8e4b1a3d8000  ``` ### SEE ALSO [cast](./cast.md), [cast --abi-decode](./cast--abi-decode.md) ",220
2071,cast-shl.md,"cast-shl.md. ## cast shl ### NAME cast-shl - Perform a left shifting operation. ### SYNOPSIS ``cast shl`` [*options*] *value* *shift* ### DESCRIPTION Perform a left shifting operation. ### OPTIONS {{#include ../common/base-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Perform a 3 position left bit shift of the number 61  ```sh  cast shl --base-in 10 61 3  ``` > Note: The --base-in parameter is not enforced but will be needed if the input is ambiguous. ### SEE ALSO [cast](./cast.md), [cast shr](./cast-shr.md) ",141
2072,invariant-testing.md,"invariant-testing.md. # Invariant Testing ## Overview Invariant testing allows for a set of invariant expressions to be tested against randomized sequences of pre-defined function calls from pre-defined contracts. After each function call is performed, all defined invariants are asserted. Invariant testing is a powerful tool to expose incorrect logic in protocols. Due to the fact that function call sequences are randomized and have fuzzed inputs, invariant testing can expose false assumptions and incorrect logic in edge cases and highly complex protocol states. Invariant testing campaigns have two dimensions, `runs` and `depth`: - `runs`: Number of times that a sequence of function calls is generated and run. - `depth`: Number of function calls made in a given `run`. All defined invariants are asserted after each function call is made. If a function call reverts, the `depth` counter still increments. These and other invariant configuration aspects are explained [`here`](#configuring-invariant-test-execution). Similar to how standard tests are run in Foundry by prefixing a function name with `test`, invariant tests are denoted by prefixing the function name with `invariant` (e.g., `function invariant_A()`). ### Configuring invariant test execution Invariant tests execution is governed by parameters that can be controlled by users via Forge configuration primitives. Configs can be applied globally or on a per-test basis. For details on this topic please refer to 📚 [`Global config`](../reference/config/testing.md) and 📚 [`In-line config`](../reference/config/inline-test-config.md). ## Defining Invariants Invariants are conditions expressions that should always hold true over the course of a fuzzing campaign. A good invariant testing suite should have as many invariants as possible, and can have different testing suites for different protocol states. Examples of invariants are: - *""The xy=k formula always holds""* for Uniswap - *""The sum of all user balances is equal to the total supply""* for an ERC-20 token.",408
2073,invariant-testing.md,"There are different ways to assert invariants, as outlined in the table below: <table> <tr><th>Type</th><th>Explanation</th><th>Example</th></tr> <tr> <td>Direct assertions</td> <td>Query a protocol smart contract and assert values are as expected.</td> <td> ```solidity assertGe(  token.totalAssets(),  token.totalSupply() ) ``` </td> </tr> <tr> <td>Ghost variable assertions</td> <td>Query a protocol smart contract and compare it against a value that has been persisted in the test environment (ghost variable).</td> <td> ```solidity assertEq(  token.totalSupply(),  sumBalanceOf ) ``` </td> </tr> <tr> <td>Deoptimizing (Naive implementation assertions)</td> <td>Query a protocol smart contract and compare it against a naive and typically highly gas-inefficient implementation of the same desired logic.</td> <td> ```solidity assertEq(  pool.outstandingInterest(),  test.naiveInterest() ) ``` </td> </tr> </table> ### Conditional Invariants Invariants must hold over the course of a given fuzzing campaign, but that doesn't mean they must hold true in every situation. There is the possibility for certain invariants to be introduced/removed in a given scenario (e.g., during a liquidation). It is not recommended to introduce conditional logic into invariant assertions because they have the possibility of introducing false positives because of an incorrect code path. For example: ```solidity function invariant_example() external {  if (protocolCondition) return;  assertEq(val1, val2); } ``` In this situation, if `protocolCondition == true`, the invariant is not asserted at all. Sometimes this can be desired behavior, but it can cause issues if the `protocolCondition` is true for the whole fuzzing campaign unexpectedly, or there is a logic error in the condition itself. For this reason its better to try and define an alternative invariant for that condition as well, for example: ```solidity function invariant_example() external {  if (protocolCondition) {   assertLe(val1, val2);   return;  };  assertEq(val1, val2); } ``` Another approach to handle different invariants across protocol states is to utilize dedicated invariant testing contracts for different scenarios.",499
2074,invariant-testing.md,"These scenarios can be bootstrapped using the `setUp` function, but it is more powerful to leverage *invariant targets* to govern the fuzzer to behave in a way that will only yield certain results (e.g., avoid liquidations). ## Invariant Targets **Target Contracts**: The set of contracts that will be called over the course of a given invariant test fuzzing campaign. This set of contracts defaults to all contracts that were deployed in the `setUp` function, but can be customized to allow for more advanced invariant testing. **Target Senders**: The invariant test fuzzer picks values for `msg.sender` at random when performing fuzz campaigns to simulate multiple actors in a system by default. If desired, the set of senders can be customized in the `setUp` function. **Target Selectors**: The set of function selectors that are used by the fuzzer for invariant testing. These can be used to use a subset of functions within a given target contract. **Target Artifacts**: The desired ABI to be used for a given contract. These can be used for proxy contract configurations. **Target Artifact Selectors**: The desired subset of function selectors to be used within a given ABI to be used for a given contract. These can be used for proxy contract configurations. Priorities for the invariant fuzzer in the cases of target clashes are: `targetSelectors | targetArtifactSelectors > excludeContracts | excludeArtifacts > targetContracts | targetArtifacts` ### Function Call Probability Distribution Functions from these contracts will be called at random with fuzzed inputs. The probability of a function being called is broken down by contract and then by function. For example: ```text targetContract1: 50% ├─ function1: 50% (25%) └─ function2: 50% (25%) targetContract2: 50% ├─ function1: 25% (12.5%) ├─ function2: 25% (12.5%) ├─ function3: 25% (12.5%) └─ function4: 25% (12.5%) ``` This is something to be mindful of when designing target contracts, as target contracts with less functions will have each function called more often due to this probability distribution.",457
2075,invariant-testing.md,### Invariant Test Helper Functions Invariant test helper functions are included in [`forge-std`](https://github.com/foundry-rs/forge-std/blob/master/src/StdInvariant.sol) to allow for configurable invariant test setup. The helper functions are outlined below: | Function | Description | |-|-| | `excludeContract(address newExcludedContract_)` | Adds a given address to the `_excludedContracts` array. This set of contracts is explicitly excluded from the target contracts.| | `excludeSender(address newExcludedSender_)` | Adds a given address to the `_excludedSenders` array. This set of addresses is explicitly excluded from the target senders. | | `excludeArtifact(string memory newExcludedArtifact_)` | Adds a given string to the `_excludedArtifacts` array. This set of strings is explicitly excluded from the target artifacts. | | `targetArtifact(string memory newTargetedArtifact_)` | Adds a given string to the `_targetedArtifacts` array. This set of strings is used for the target artifacts. | | `targetArtifactSelector(FuzzSelector memory newTargetedArtifactSelector_)` | Adds a given `FuzzSelector` to the to `_targetedArtifactSelectors` array. This set of `FuzzSelector`s is used for the target artifact selectors. | | `targetContract(address newTargetedContract_)` | Adds a given address to the to `_targetedContracts` array. This set of addresses is used for the target contracts. This array overwrites the set of contracts that was deployed during the `setUp`. | | `targetSelector(FuzzSelector memory newTargetedSelector_)` | Adds a given `FuzzSelector` to the to `_targetedSelectors` array. This set of `FuzzSelector`s is used for the target contract selectors. | | `targetSender(address newTargetedSender_)` | Adds a given address to the to `_targetedSenders` array. This set of addresses is used for the target senders. | ### Target Contract Setup Target contracts can be set up using the following three methods: 1. Contracts that are manually added to the `targetContracts` array are added to the set of target contracts. 2. Contracts that are deployed in the `setUp` function are automatically added to the set of target contracts (only works if no contracts have been manually added using option 1). 3.,496
2076,invariant-testing.md,"Contracts that are deployed in the `setUp` can be **removed** from the target contracts if they are added to the `excludeContracts` array. ## Open Testing The default configuration for target contracts is set to all contracts that are deployed during the setup. For smaller modules and more arithmetic contracts, this works well. For example: ```solidity contract ExampleContract1 {  uint256 public val1;  uint256 public val2;  uint256 public val3;  function addToA(uint256 amount) external {   val1 += amount;   val3 += amount;  }  function addToB(uint256 amount) external {   val2 += amount;   val3 += amount;  } } ``` This contract could be deployed and tested using the default target contract pattern: ```solidity contract InvariantExample1 is Test {  ExampleContract1 foo;  function setUp() external {   foo = new ExampleContract1();  }  function invariant_A() external {   assertEq(foo.val1() + foo.val2(), foo.val3());  }  function invariant_B() external {   assertGe(foo.val1() + foo.val2(), foo.val1());  } } ``` This setup will call `foo.addToA()` and `foo.addToB()` with a 50%-50% probability distribution with fuzzed inputs. Inevitably, the inputs will start to cause overflows and the function calls will start reverting. Since the default configuration in invariant testing is `fail_on_revert = false`, this will not cause the tests to fail. The invariants will hold throughout the rest of the fuzzing campaign and the result is that the test will pass. The output will look something like this: ```text [PASS] invariant_A() (runs: 50, calls: 10000, reverts: 5533) [PASS] invariant_B() (runs: 50, calls: 10000, reverts: 5533) ``` ## Handler-Based Testing For more complex and integrated protocols, more sophisticated target contract usage is required to achieve the desired results.",427
2077,invariant-testing.md,"To illustrate how Handlers can be leveraged, the following contract will be used (an ERC-4626 based contract that accepts deposits of another ERC-20 token): ```solidity // SPDX-License-Identifier: UNLICENSED pragma solidity ^0.8.17; interface IERC20Like {  function balanceOf(address owner_) external view returns (uint256 balance_);  function transferFrom(   address owner_,   address recipient_,   uint256 amount_  ) external returns (bool success_); } contract Basic4626Deposit {  /**********************************************************************************************/  /*** Storage                    ***/  /**********************************************************************************************/  address public immutable asset;  string public name;  string public symbol;  uint8 public immutable decimals;  uint256 public totalSupply;  mapping(address => uint256) public balanceOf;  /**********************************************************************************************/  /*** Constructor                   ***/  /**********************************************************************************************/  constructor(address asset_, string memory name_, string memory symbol_, uint8 decimals_) {   asset = asset_;   name  = name_;   symbol = symbol_;   decimals = decimals_;  }  /**********************************************************************************************/  /*** External Functions                  ***/  /**********************************************************************************************/  function deposit(uint256 assets_, address receiver_) external returns (uint256 shares_) {   shares_ = convertToShares(assets_);   require(receiver_ != address(0), ""ZERO_RECEIVER"");   require(shares_ != uint256(0), ""ZERO_SHARES"");   require(assets_ != uint256(0), ""ZERO_ASSETS"");   totalSupply += shares_;   // Cannot overflow because totalSupply would first overflow in the statement above.   unchecked { balanceOf[receiver_] += shares_; }   require(    IERC20Like(asset).transferFrom(msg.sender, address(this), assets_),    ""TRANSFER_FROM""   );  }  function transfer(address recipient_, uint256 amount_) external returns (bool success_) {   balanceOf[msg.sender] -= amount_;   // Cannot overflow because minting prevents overflow of totalSupply,   // and sum of user balances == totalSupply.   unchecked { balanceOf[recipient_] += amount_; }   return true;  }  /**********************************************************************************************/  /*** Public View Functions                 ***/  /**********************************************************************************************/  function convertToShares(uint256 assets_) public view returns (uint256 shares_) {   uint256 supply_ = totalSupply; // Cache to stack.",491
2078,invariant-testing.md,"  shares_ = supply_ == 0 ? assets_ : (assets_ * supply_) / totalAssets();  }  function totalAssets() public view returns (uint256 assets_) {   assets_ = IERC20Like(asset).balanceOf(address(this));  } } ``` ### Handler Functions This contract's `deposit` function requires that the caller has a non-zero balance of the ERC-20 `asset`. In the Open invariant testing approach, `deposit()` and `transfer()` would be called with a 50-50% distribution, but they would revert on every call. This would cause the invariant tests to ""pass"", but in reality no state was manipulated in the desired contract at all. This is where target contracts can be leveraged. When a contract requires some additional logic in order to function properly, it can be added in a dedicated contract called a `Handler`. ```solidity function deposit(uint256 assets) public virtual {  asset.mint(address(this), assets);  asset.approve(address(token), assets);  uint256 shares = token.deposit(assets, address(this)); } ``` This contract will provide the necessary setup before a function call is made in order to ensure it is successful. Building on this concept, Handlers can be used to develop more sophisticated invariant tests. With Open invariant testing, the tests run as shown in the diagram below, with random sequences of function calls being made to the protocol contracts directly with fuzzed parameters. This will cause reverts for more complex systems as outlined above. ![Blank diagram](https://user-images.githubusercontent.com/44272939/214752968-5f0e7653-d52e-43e6-b453-cac935f5d97d.svg) By manually adding all Handler contracts to the `targetContracts` array, all function calls made to protocol contracts can be made in a way that is governed by the Handler to ensure successful calls. This is outlined in the diagram below. ![Invariant Diagrams - Page 2](https://user-images.githubusercontent.com/44272939/216420091-8a5c2bcc-d586-458f-be1e-a9ea0ef5961f.svg) With this layer between the fuzzer and the protocol, more powerful testing can be achieved. ### Handler Ghost Variables Within Handlers, ""ghost variables"" can be tracked across multiple function calls to add additional information for invariant tests.",490
2079,invariant-testing.md,"A good example of this is summing all of the `shares` that each LP owns after depositing into the ERC-4626 token as shown above, and using that in the invariant (`totalSupply == sumBalanceOf`). ```solidity function deposit(uint256 assets) public virtual {  asset.mint(address(this), assets);  asset.approve(address(token), assets);  uint256 shares = token.deposit(assets, address(this));  sumBalanceOf += shares; } ``` ### Function-Level Assertions Another benefit is the ability to perform assertions on function calls as they are happening. An example is asserting the ERC-20 balance of the LP has decremented by `assets` during the `deposit` function call, as well as their LP token balance incrementing by `shares`. In this way, handler functions are similar to fuzz tests because they can take in fuzzed inputs, perform state changes, and assert before/after state. ```solidity function deposit(uint256 assets) public virtual {  asset.mint(address(this), assets);  asset.approve(address(token), assets);  uint256 beforeBalance = asset.balanceOf(address(this));  uint256 shares = token.deposit(assets, address(this));  assertEq(asset.balanceOf(address(this)), beforeBalance - assets);  sumBalanceOf += shares; } ``` ### Bounded/Unbounded Functions In addition, with Handlers, input parameters can be bounded to reasonable expected values such that `fail_on_revert` in `foundry.toml` can be set to `true`. This can be accomplished using the `bound()` helper function from `forge-std`. This ensures that every function call that is being made by the fuzzer must be successful against the protocol in order to get tests to pass. This is very useful for visibility and confidence that the protocol is being tested in the desired way.",377
2080,invariant-testing.md,"```solidity function deposit(uint256 assets) external {  assets = bound(assets, 0, 1e30);  asset.mint(address(this), assets);  asset.approve(address(token), assets);  uint256 beforeBalance = asset.balanceOf(address(this));  uint256 shares = token.deposit(assets, address(this));  assertEq(asset.balanceOf(address(this)), beforeBalance - assets);  sumBalanceOf += shares; } ``` This can also be accomplished by inheriting non-bounded functions from dedicated ""unbounded"" Handler contracts that can be used for `fail_on_revert = false` testing. This type of testing is also useful since it can expose issues in assumptions made with `bound` function usage. ```solidity // Unbounded function deposit(uint256 assets) public virtual {  asset.mint(address(this), assets);  asset.approve(address(token), assets);  uint256 beforeBalance = asset.balanceOf(address(this));  uint256 shares = token.deposit(assets, address(this));  assertEq(asset.balanceOf(address(this)), beforeBalance - assets);  sumBalanceOf += shares; } ``` ```solidity // Bounded function deposit(uint256 assets) external {  assets = bound(assets, 0, 1e30);  super.deposit(assets); } ``` ### Actor Management In the function calls above, it can be seen that `address(this)` is the sole depositor in the ERC-4626 contract, which is not a realistic representation of its intended use. By leveraging the `prank` cheatcodes in `forge-std`, each Handler can manage a set of actors and use them to perform the same function call from different `msg.sender` addresses. This can be accomplished using the following modifier: ```solidity address[] public actors; address internal currentActor; modifier useActor(uint256 actorIndexSeed) {  currentActor = actors[bound(actorIndexSeed, 0, actors.length - 1)];  vm.startPrank(currentActor);  _;  vm.stopPrank(); } ``` Using multiple actors allows for more granular ghost variable usage as well.",437
2081,cast-balance.md,"cast-balance.md. ## cast balance ### NAME cast-balance - Get the balance of an account in wei. ### SYNOPSIS ``cast balance`` [*options*] *who* ### DESCRIPTION Get the balance of an account. The argument *who* can be an ENS name or an address. ### OPTIONS #### Query Options `-B` *block* `--block` *block* &nbsp;&nbsp;&nbsp;&nbsp;The block height you want to query at. &nbsp;&nbsp;&nbsp;&nbsp;Can be a block number, or any of the tags: `earliest`, `finalized`, `safe`, `latest` or `pending`. `-e` *ether* `--ether` *ether* &nbsp;&nbsp;&nbsp;&nbsp; If this flag is used then balance will be shown in ether #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the balance of beer.eth  ```sh  cast balance beer.eth  ``` ### SEE ALSO [cast](./cast.md), [cast nonce](./cast-nonce.md) ",234
2082,gas-snapshots.md,"gas-snapshots.md. ## Gas Snapshots Forge can generate gas snapshots for all your test functions. This can be useful to get a general feel for how much gas your contract will consume, or to compare gas usage before and after various optimizations. To generate the gas snapshot, run [`forge snapshot`](../reference/forge/forge-snapshot.md). This will generate a file called `.gas-snapshot` by default with all your tests and their respective gas usage. ```ignore $ forge snapshot $ cat .gas-snapshot ERC20Test:testApprove() (gas: 31162) ERC20Test:testBurn() (gas: 59875) ERC20Test:testFailTransferFromInsufficientAllowance() (gas: 81034) ERC20Test:testFailTransferFromInsufficientBalance() (gas: 81662) ERC20Test:testFailTransferInsufficientBalance() (gas: 52882) ERC20Test:testInfiniteApproveTransferFrom() (gas: 90167) ERC20Test:testMetadata() (gas: 14606) ERC20Test:testMint() (gas: 53830) ERC20Test:testTransfer() (gas: 60473) ERC20Test:testTransferFrom() (gas: 84152) ``` ### Filtering If you would like to specify a different output file, run `forge snapshot --snap <FILE_NAME>`. You can also sort the results by gas usage. Use the `--asc` option to sort the results in ascending order and `--desc` to sort the results in descending order. Finally, you can also specify a min/max gas threshold for all your tests. To only include results above a threshold, you can use the `--min <VALUE>` option. In the same way, to only include results under a threshold, you can use the `--max <VALUE>` option. Keep in mind that the changes will be made in the snapshot file, and not in the snapshot being displayed on your screen. You can also use it in combination with the filters for `forge test`, such as `forge snapshot --match-path contracts/test/ERC721.t.sol` to generate a gas snapshot relevant to this test contract. ### Comparing gas usage If you would like to compare the current snapshot file with your latest changes, you can use the `--diff` or `--check` options. `--diff` will compare against the snapshot and display changes from the snapshot.",499
2083,gas-snapshots.md,"It can also optionally take a file name (`--diff <FILE_NAME>`), with the default being `.gas-snapshot`. For example: ```ignore $ forge snapshot --diff .gas-snapshot2 Running 10 tests for src/test/ERC20.t.sol:ERC20Test [PASS] testApprove() (gas: 31162) [PASS] testBurn() (gas: 59875) [PASS] testFailTransferFromInsufficientAllowance() (gas: 81034) [PASS] testFailTransferFromInsufficientBalance() (gas: 81662) [PASS] testFailTransferInsufficientBalance() (gas: 52882) [PASS] testInfiniteApproveTransferFrom() (gas: 90167) [PASS] testMetadata() (gas: 14606) [PASS] testMint() (gas: 53830) [PASS] testTransfer() (gas: 60473) [PASS] testTransferFrom() (gas: 84152) Test result: ok. 10 passed; 0 failed; finished in 2.86ms testBurn() (gas: 0 (0.000%)) testFailTransferFromInsufficientAllowance() (gas: 0 (0.000%)) testFailTransferFromInsufficientBalance() (gas: 0 (0.000%)) testFailTransferInsufficientBalance() (gas: 0 (0.000%)) testInfiniteApproveTransferFrom() (gas: 0 (0.000%)) testMetadata() (gas: 0 (0.000%)) testMint() (gas: 0 (0.000%)) testTransfer() (gas: 0 (0.000%)) testTransferFrom() (gas: 0 (0.000%)) testApprove() (gas: -8 (-0.000%)) Overall gas change: -8 (-0.000%) ``` `--check` will compare a snapshot with an existing snapshot file and display all the differences, if any. You can change the file to compare against by providing a different file name: `--check <FILE_NAME>`.",449
2084,serialize-json.md,"serialize-json.md. ## `serializeJson` ### Signature ```solidity function serializeBool(string calldata objectKey, string calldata valueKey, bool value)  external  returns (string memory json); function serializeUint(string calldata objectKey, string calldata valueKey, uint256 value)  external  returns (string memory json); function serializeInt(string calldata objectKey, string calldata valueKey, int256 value)  external  returns (string memory json); function serializeAddress(string calldata objectKey, string calldata valueKey, address value)  external  returns (string memory json); function serializeBytes32(string calldata objectKey, string calldata valueKey, bytes32 value)  external  returns (string memory json); function serializeString(string calldata objectKey, string calldata valueKey, string calldata value)  external  returns (string memory json); function serializeBytes(string calldata objectKey, string calldata valueKey, bytes calldata value)  external  returns (string memory json); function serializeBool(string calldata objectKey, string calldata valueKey, bool[] calldata values)  external  returns (string memory json); function serializeUint(string calldata objectKey, string calldata valueKey, uint256[] calldata values)  external  returns (string memory json); function serializeInt(string calldata objectKey, string calldata valueKey, int256[] calldata values)  external  returns (string memory json); function serializeAddress(string calldata objectKey, string calldata valueKey, address[] calldata values)  external  returns (string memory json); function serializeBytes32(string calldata objectKey, string calldata valueKey, bytes32[] calldata values)  external  returns (string memory json); function serializeString(string calldata objectKey, string calldata valueKey, string[] calldata values)  external  returns (string memory json); function serializeBytes(string calldata objectKey, string calldata valueKey, bytes[] calldata values)  external  returns (string memory json); ``` ### Description Serializes values as a stringified JSON object. ### How it works The idea is that the user serializes the values of the JSON file and finally writes that object to a file. The user needs to pass: - A key for the _object_ to which the value should be serialized to.",488
2085,block-commands.md,block-commands.md. ## Block Commands - [cast find-block](./cast-find-block.md) - [cast gas-price](./cast-gas-price.md) - [cast block-number](./cast-block-number.md) - [cast basefee](./cast-basefee.md) - [cast block](./cast-block.md) - [cast age](./cast-age.md) ,78
2086,cast.md,cast.md. ## cast ### NAME cast - Perform Ethereum RPC calls from the comfort of your command line. ### SYNOPSIS `cast` [*options*] *command* [*args*] `cast` [*options*] `--version` `cast` [*options*] `--help` ### DESCRIPTION This program is a set of tools to interact with Ethereum and perform conversions. ### COMMANDS #### General Commands [cast help](./cast-help.md) &nbsp;&nbsp;&nbsp;&nbsp;Display help information about Cast. [cast completions](./cast-completions.md) &nbsp;&nbsp;&nbsp;&nbsp;Generate shell autocompletions for Cast. #### Chain Commands [cast chain-id](./cast-chain-id.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the Ethereum chain ID. [cast chain](./cast-chain.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the symbolic name of the current chain. [cast client](./cast-client.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the current client version. #### Transaction Commands [cast publish](./cast-publish.md) &nbsp;&nbsp;&nbsp;&nbsp;Publish a raw transaction to the network. [cast receipt](./cast-receipt.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the transaction receipt for a transaction. [cast send](./cast-send.md) &nbsp;&nbsp;&nbsp;&nbsp;Sign and publish a transaction. [cast call](./cast-call.md) &nbsp;&nbsp;&nbsp;&nbsp;Perform a call on an account without publishing a transaction. [cast rpc](./cast-rpc.md) &nbsp;&nbsp;&nbsp;&nbsp; Perform a raw JSON-RPC request [aliases: rp] [cast tx](./cast-tx.md) &nbsp;&nbsp;&nbsp;&nbsp;Get information about a transaction. [cast run](./cast-run.md) &nbsp;&nbsp;&nbsp;&nbsp;Runs a published transaction in a local environment and prints the trace. [cast estimate](./cast-estimate.md) &nbsp;&nbsp;&nbsp;&nbsp;Estimate the gas cost of a transaction. [cast access-list](./cast-access-list.md) &nbsp;&nbsp;&nbsp;&nbsp;Create an access list for a transaction.,469
2087,cast.md,"#### Block Commands [cast find-block](./cast-find-block.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the block number closest to the provided timestamp. [cast gas-price](./cast-gas-price.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the current gas price. [cast block-number](./cast-block-number.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the latest block number. [cast basefee](./cast-basefee.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the basefee of a block. [cast block](./cast-block.md) &nbsp;&nbsp;&nbsp;&nbsp;Get information about a block. [cast age](./cast-age.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the timestamp of a block. #### Account Commands [cast balance](./cast-balance.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the balance of an account in wei. [cast storage](./cast-storage.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the raw value of a contract's storage slot. [cast proof](./cast-proof.md) &nbsp;&nbsp;&nbsp;&nbsp;Generate a storage proof for a given storage slot. [cast nonce](./cast-nonce.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the nonce for an account. [cast code](./cast-code.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the bytecode of a contract. #### ENS Commands [cast lookup-address](./cast-lookup-address.md) &nbsp;&nbsp;&nbsp;&nbsp;Perform an ENS reverse lookup. [cast resolve-name](./cast-resolve-name.md) &nbsp;&nbsp;&nbsp;&nbsp;Perform an ENS lookup. [cast namehash](./cast-namehash.md) &nbsp;&nbsp;&nbsp;&nbsp;Calculate the ENS namehash of a name. #### Etherscan Commands [cast etherscan-source](./cast-etherscan-source.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the source code of a contract from Etherscan. #### ABI Commands [cast abi-encode](./cast-abi-encode.md) &nbsp;&nbsp;&nbsp;&nbsp;ABI encode the given function arguments, excluding the selector.",469
2088,cast.md,[cast 4byte](./cast-4byte.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the function signatures for the given selector from <https://sig.eth.samczsun.com>. [cast 4byte-decode](./cast-4byte-decode.md) &nbsp;&nbsp;&nbsp;&nbsp;Decode ABI-encoded calldata using <https://sig.eth.samczsun.com>. [cast 4byte-event](./cast-4byte-event.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the event signature for a given topic 0 from <https://sig.eth.samczsun.com>. [cast calldata](./cast-calldata.md) &nbsp;&nbsp;&nbsp;&nbsp;ABI-encode a function with arguments. [cast pretty-calldata](./cast-pretty-calldata.md) &nbsp;&nbsp;&nbsp;&nbsp;Pretty print calldata. [cast --abi-decode](./cast--abi-decode.md) &nbsp;&nbsp;&nbsp;&nbsp;Decode ABI-encoded input or output data. [cast --calldata-decode](./cast--calldata-decode.md) &nbsp;&nbsp;&nbsp;&nbsp;Decode ABI-encoded input data. [cast upload-signature](./cast-upload-signature.md) &nbsp;&nbsp;&nbsp;&nbsp;Upload the given signatures to https://sig.eth.samczsun.com. #### Conversion Commands [cast --format-bytes32-string](./cast--format-bytes32-string.md) &nbsp;&nbsp;&nbsp;&nbsp;Formats a string into bytes32 encoding. [cast --from-bin](./cast--from-bin.md) &nbsp;&nbsp;&nbsp;&nbsp;Convert binary data into hex data. [cast --from-fix](./cast--from-fix.md) &nbsp;&nbsp;&nbsp;&nbsp;Convert a fixed point number into an integer. [cast --from-utf8](./cast--from-utf8.md) &nbsp;&nbsp;&nbsp;&nbsp;Convert UTF8 to hex. [cast --parse-bytes32-string](./cast--parse-bytes32-string.md) &nbsp;&nbsp;&nbsp;&nbsp;Parses a string from bytes32 encoding. [cast --to-ascii](./cast--to-ascii.md) &nbsp;&nbsp;&nbsp;&nbsp;Convert hex data to an ASCII string.,485
2089,cast.md,"[cast --to-base](./cast--to-base.md) &nbsp;&nbsp;&nbsp;&nbsp;Convert a number of one base to another. [cast --to-bytes32](./cast--to-bytes32.md) &nbsp;&nbsp;&nbsp;&nbsp;Right-pads hex data to 32 bytes. [cast --to-fix](./cast--to-fix.md) &nbsp;&nbsp;&nbsp;&nbsp;Convert an integer into a fixed point number. [cast --to-hexdata](./cast--to-hexdata.md) &nbsp;&nbsp;&nbsp;&nbsp;Normalize the input to lowercase, 0x-prefixed hex. [cast --to-int256](./cast--to-int256.md) &nbsp;&nbsp;&nbsp;&nbsp;Convert a number to a hex-encoded int256. [cast --to-uint256](./cast--to-uint256.md) &nbsp;&nbsp;&nbsp;&nbsp;Convert a number to a hex-encoded uint256. [cast --to-unit](./cast--to-unit.md) &nbsp;&nbsp;&nbsp;&nbsp;Convert an ETH amount into another unit (ether, gwei, wei). [cast --to-wei](./cast--to-wei.md) &nbsp;&nbsp;&nbsp;&nbsp;Convert an ETH amount to wei. [cast shl](./cast-shl.md) &nbsp;&nbsp;&nbsp;&nbsp;Perform a left shifting operation. [cast shr](./cast-shr.md) &nbsp;&nbsp;&nbsp;&nbsp;Perform a right shifting operation. #### Utility Commands [cast sig](./cast-sig.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the selector for a function. [cast sig-event](./cast-sig-event.md) &nbsp;&nbsp;&nbsp;&nbsp;Generate event signatures from event string. [cast keccak](./cast-keccak.md) &nbsp;&nbsp;&nbsp;&nbsp;Hash arbitrary data using keccak-256. [cast compute-address](./cast-compute-address.md) &nbsp;&nbsp;&nbsp;&nbsp;Compute the contract address from a given nonce and deployer address.",447
2090,cast.md,[cast create2](./cast-create2.md) &nbsp;&nbsp;&nbsp;&nbsp; Generate a deterministic contract address using CREATE2 [cast interface](./cast-interface.md) &nbsp;&nbsp;&nbsp;&nbsp;Generate a Solidity interface from a given ABI. [cast index](./cast-index.md) &nbsp;&nbsp;&nbsp;&nbsp;Compute the storage slot for an entry in a mapping. [cast --concat-hex](./cast--concat-hex.md) &nbsp;&nbsp;&nbsp;&nbsp;Concatenate hex strings. [cast --max-int](./cast--max-int.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the maximum i256 value. [cast --min-int](./cast--min-int.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the minimum i256 value. [cast --max-uint](./cast--max-uint.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the maximum u256 value. [cast --to-checksum-address](./cast--to-checksum-address.md) &nbsp;&nbsp;&nbsp;&nbsp;Convert an address to a checksummed format (EIP-55). #### Wallet Commands [cast wallet](./cast-wallet.md) &nbsp;&nbsp;&nbsp;&nbsp;Wallet management utilities. [cast wallet new](./cast-wallet-new.md) &nbsp;&nbsp;&nbsp;&nbsp;Create a new random keypair. [cast wallet address](./cast-wallet-address.md) &nbsp;&nbsp;&nbsp;&nbsp;Convert a private key to an address. [cast wallet sign](./cast-wallet-sign.md) &nbsp;&nbsp;&nbsp;&nbsp;Sign a message. [cast wallet vanity](./cast-wallet-vanity.md) &nbsp;&nbsp;&nbsp;&nbsp;Generate a vanity address. [cast wallet verify](./cast-wallet-verify.md) &nbsp;&nbsp;&nbsp;&nbsp;Verify the signature of a message. ### OPTIONS #### Special Options `-V` `--version` &nbsp;&nbsp;&nbsp;&nbsp;Print version info and exit. {{#include common-options.md}} ### EXAMPLES 1.,447
2091,ens-commands.md,ens-commands.md. ## ENS Commands - [cast lookup-address](./cast-lookup-address.md) - [cast resolve-name](./cast-resolve-name.md) - [cast namehash](./cast-namehash.md) ,48
2092,delta.md,"delta.md. ## `delta` ### Signature ```solidity function delta(uint256 a, uint256 b) internal pure returns (uint256) ``` ```solidity function delta(int256 a, int256 b) internal pure returns (uint256) ``` ### Description Returns the difference between two numbers in absolute value. ### Example ```solidity uint256 four = stdMath.delta(-1, 3); ``` ",83
2093,tx-value-option.md,"tx-value-option.md. `--value` *value* &nbsp;&nbsp;&nbsp;&nbsp;Ether to send in the transaction. &nbsp;&nbsp;&nbsp;&nbsp;Either specified as an integer (wei), or as a string with a unit, for example: &nbsp;&nbsp;&nbsp;&nbsp;- `1ether` &nbsp;&nbsp;&nbsp;&nbsp;- `10gwei` &nbsp;&nbsp;&nbsp;&nbsp;- `0.01ether` ",99
2094,ref_forge_README.md,ref_forge_README.md. ## forge Commands - [General Commands](./general-commands.md) - [Project Commands](./project-commands.md) - [Build Commands](./build-commands.md) - [Test Commands](./test-commands.md) - [Deploy Commands](./deploy-commands.md) - [Utility Commands](./utility-commands.md) ,77
2095,differential-ffi-testing.md,"differential-ffi-testing.md. ## Differential Testing Forge can be used for differential testing and differential fuzzing. You can even test against non-EVM executables using the `ffi` [cheatcode](../cheatcodes/ffi.md). ### Background [Differential testing](https://en.wikipedia.org/wiki/Differential_testing) cross references multiple implementations of the same function by comparing each one's output. Imagine we have a function specification `F(X)`, and two implementations of that specification: `f1(X)` and `f2(X)`. We expect `f1(x) == f2(x)` for all x that exist in an appropriate input space. If `f1(x) != f2(x)`, we know that at least one function is incorrectly implementing `F(X)`. This process of testing for equality and identifying discrepancies is the core of differential testing. Differential fuzzing is an extension of differential testing. Differential fuzzing programatically generates many values of `x` to find discrepancies and edge cases that manually chosen inputs might not reveal. > Note: the `==` operator in this case can be a custom definition of equality. For example, if testing floating point implementations, you might use approximate equality with a certain tolerance. Some real life uses of this type of testing include: - Comparing upgraded implementations to their predecessors - Testing code against known reference implementations - Confirming compatibility with third party tools and dependencies Below are some examples of how Forge is used for differential testing. ### Primer: The `ffi` cheatcode [`ffi`](../cheatcodes/ffi.md) allows you to execute an arbitrary shell command and capture the output. Here's a mock example: ```solidity import ""forge-std/Test.sol""; contract TestContract is Test {  function testMyFFI () public {   string[] memory cmds = new string[](2);   cmds[0] = ""cat"";   cmds[1] = ""address.txt""; // assume contains abi-encoded address.   bytes memory result = vm.ffi(cmds);   address loadedAddress = abi.decode(result, (address));   // Do something with the address   // ...  } } ``` An address has previously been written to `address.txt`, and we read it in using the FFI cheatcode. This data can now be used throughout your test contract.",474
2096,differential-ffi-testing.md,"### Example: Differential Testing Merkle Tree Implementations [Merkle Trees](https://en.wikipedia.org/wiki/Merkle_tree) are a cryptographic commitment scheme frequently used in blockchain applications. Their popularity has led to a number of different implementations of Merkle Tree generators, provers, and verifiers. Merkle roots and proofs are often generated using a language like JavaScript or Python, while proof verification usually occurs on-chain in Solidity. [Murky](https://github.com/dmfxyz/murky) is a complete implementation of Merkle roots, proofs, and verification in Solidity. Its test suite includes differential tests against OpenZeppelin's Merkle proof library, as well as root generation tests against a reference JavaScript implementation. These tests are powered by Foundry's fuzzing and `ffi` capabilities.",164
2097,differential-ffi-testing.md,"#### Differential fuzzing against a reference TypeScript implementation Using the `ffi` cheatcode, Murky tests its own Merkle root implementation against a TypeScript implementation using data provided by Forge's fuzzer: ```solidity function testMerkleRootMatchesJSImplementationFuzzed(bytes32[] memory leaves) public {  vm.assume(leaves.length > 1);  bytes memory packed = abi.encodePacked(leaves);  string[] memory runJsInputs = new string[](8);  // Build ffi command string  runJsInputs[0] = 'npm';  runJsInputs[1] = '--prefix';  runJsInputs[2] = 'differential_testing/scripts/';  runJsInputs[3] = '--silent';  runJsInputs[4] = 'run';  runJsInputs[5] = 'generate-root-cli';  runJsInputs[6] = leaves.length.toString();  runJsInputs[7] = packed.toHexString();  // Run command and capture output  bytes memory jsResult = vm.ffi(runJsInputs);  bytes32 jsGeneratedRoot = abi.decode(jsResult, (bytes32));  // Calculate root using Murky  bytes32 murkyGeneratedRoot = m.getRoot(leaves);  assertEq(murkyGeneratedRoot, jsGeneratedRoot); } ``` > Note: see [`Strings2.sol`](https://github.com/dmfxyz/murky/blob/main/differential_testing/test/utils/Strings2.sol) in the Murky Repo for the library that enables `(bytes memory).toHexString()` Forge runs `npm --prefix differential_testing/scripts/ --silent run generate-root-cli {numLeaves} {hexEncodedLeaves}`. This calculates the Merkle root for the input data using the reference JavaScript implementation. The script prints the root to stdout, and that printout is captured as `bytes` in the return value of `vm.ffi()`. The test then calculates the root using the Solidity implementation. Finally, the test asserts that the both roots are exactly equal. If they are not equal, the test fails. #### Differential fuzzing against OpenZeppelin's Merkle Proof Library You may want to use differential testing against another Solidity implementation. In that case, `ffi` is not needed. Instead, the reference implementation is imported directly into the test. ```solidity import ""openzeppelin-contracts/contracts/utils/cryptography/MerkleProof.sol""; //...",497
2098,differential-ffi-testing.md,"function testCompatabilityOpenZeppelinProver(bytes32[] memory _data, uint256 node) public {  vm.assume(_data.length > 1);  vm.assume(node < _data.length);  bytes32 root = m.getRoot(_data);  bytes32[] memory proof = m.getProof(_data, node);  bytes32 valueToProve = _data[node];  bool murkyVerified = m.verifyProof(root, proof, valueToProve);  bool ozVerified = MerkleProof.verify(proof, root, valueToProve);  assertTrue(murkyVerified == ozVerified); } ``` #### Differential testing against a known edge case Differential tests are not always fuzzed -- they are also useful for testing known edge cases. In the case of the Murky codebase, the initial implementation of the `log2ceil` function did not work for certain arrays whose lengths were close to a power of 2 (like 129). As a safety check, a test is always run against an array of this length and compared to the TypeScript implementation. You can see the full test [here](https://github.com/dmfxyz/murky/blob/main/differential_testing/test/DifferentialTests.t.sol#L21). #### Standardized Testing against reference data FFI is also useful for injecting reproducible, standardized data into the testing environment. In the Murky library, this is used as a benchmark for gas snapshotting (see [forge snapshot](./gas-snapshots.md)).",307
2099,differential-ffi-testing.md,"```solidity bytes32[100] data; uint256[8] leaves = [4, 8, 15, 16, 23, 42, 69, 88]; function setUp() public {  string[] memory inputs = new string[](2);  inputs[0] = ""cat"";  inputs[1] = ""src/test/standard_data/StandardInput.txt"";  bytes memory result = vm.ffi(inputs);  data = abi.decode(result, (bytes32[100]));  m = new Merkle(); } function testMerkleGenerateProofStandard() public view {  bytes32[] memory _data = _getData();  for (uint i = 0; i < leaves.length; ++i) {   m.getProof(_data, leaves[i]);  } } ``` `src/test/standard_data/StandardInput.txt` is a text file that contains an encoded `bytes32[100]` array. It's generated outside of the test and can be used in any language's Web3 SDK. It looks something like: ```ignore 0xf910ccaa307836354233316666386231414464306335333243453944383735313..423532 ``` The standardized testing contract reads in the file using `ffi`. It decodes the data into an array and then, in this example, generates proofs for 8 different leaves. Because the data is constant and standard, we can meaningfully measure gas and performance improvements using this test. > Of course, one could just hardcode the array into the test! But that makes it much harder to do consistent testing across contracts, implementations, etc. ### Example: Differential Testing Gradual Dutch Auctions The reference implementation for Paradigm's [Gradual Dutch Auction](https://www.paradigm.xyz/2022/04/gda) mechanism contains a number of differential, fuzzed tests. It is an excellent repository to further explore differential testing using `ffi`.",403
2100,cast-client.md,cast-client.md. ## cast client ### NAME cast-client - Get the current client version. ### SYNOPSIS ``cast client`` [*options*] ### DESCRIPTION Get the current client version. ### OPTIONS #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the current client version:  ```sh  cast client  ``` ### SEE ALSO [cast](./cast.md) ,91
2101,cast-4byte-event.md,"cast-4byte-event.md. ## cast 4byte-event ### NAME cast-4byte-event - Get the event signature for a given topic 0 from <https://sig.eth.samczsun.com>. ### SYNOPSIS ``cast 4byte-event`` [*options*] *topic_0* ### DESCRIPTION Get the event signature for a given topic 0 from <https://sig.eth.samczsun.com>. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Get the event signature for a topic 0 of `0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef`:  ```sh  cast 4byte-event 0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef  ``` ### SEE ALSO [cast](./cast.md), [cast 4byte](./cast-4byte.md), [cast 4byte-decode](./cast-4byte-decode.md) ",242
2102,std-storage.md,"std-storage.md. ## Std Storage Std Storage is a library that makes manipulating storage easy. To use Std Storage, add the following line to your test contract: ```solidity using stdStorage for StdStorage; ``` Then, access Std Storage via the `stdstore` instance. ### Functions Query functions: - [`target`](./target.md): Set the address of the target contract - [`sig`](./sig.md): Set the 4-byte selector of the function to static call - [`with_key`](./with_key.md): Pass an argument to the function (can be used multiple times) - [`depth`](./depth.md): Set the position of the value in the `tuple` (e.g. inside a `struct`) Terminator functions: - [`find`](./find.md): Return the slot number - [`checked_write`](./checked_write.md): Set the data to be written to the storage slot(s) - [`read_<type>`](./read.md): Read the value from the storage slot as `<type>` ### Example `playerToCharacter` tracks info about players' characters. ```solidity // MetaRPG.sol struct Character {  string name;  uint256 level; } mapping (address => Character) public playerToCharacter; ``` Let's say we want to set the level of our character to 120. ```solidity // MetaRPG.t.sol stdstore  .target(address(metaRpg))  .sig(""playerToCharacter(address)"")  .with_key(address(this))  .depth(1)  .checked_write(120); ``` ### Limitations - Accessing packed slots is not supported ### Known issues - Slot(s) may not be found if the `tuple` contains types shorter than 32 bytes",352
2103,active-fork.md,"active-fork.md. ## `activeFork` ### Signature ```solidity function activeFork() external returns (uint256); ``` ### Description Returns the identifier for the currently active fork. Reverts if no fork is currently active. ### Examples Get the currently active fork id: ```solidity uint256 mainnetForkId = vm.createFork(MAINNET_RPC_URL); uint256 optimismForkId = vm.createFork(OPTIMISM_RPC_URL); assert(mainnetForkId != optimismForkId); vm.selectFork(mainnetForkId); assertEq(vm.activeFork(), mainnetForkId); vm.selectFork(optimismForkId); assertEq(vm.activeFork(), optimismForkId); ``` ### SEE ALSO - [createFork](./create-fork.md) - [selectFork](./select-fork.md) ",183
2104,solidity-scripting.md,"solidity-scripting.md. ## Solidity Scripting ### Introduction Solidity scripting is a way to declaratively deploy contracts using Solidity, instead of using the more limiting and less user friendly [`forge create`](../reference/forge/forge-create.md). Solidity scripts are like the scripts you write when working with tools like Hardhat; what makes Solidity scripting different is that they are written in Solidity instead of JavaScript, and they are run on the fast Foundry EVM backend, which provides dry-run capabilities. ### High Level Overview `forge script` does not work in a sync manner. First, it collects all transactions from the script, and only then does it broadcast them all. It can essentially be split into 4 phases: 1. Local Simulation - The contract script is run in a local evm. If a rpc/fork url has been provided, it will execute the script in that context. Any **external call** (not static, not internal) from a `vm.broadcast` and/or `vm.startBroadcast` will be appended to a list. 2. Onchain Simulation - Optional. If a rpc/fork url has been provided, then it will sequentially execute all the collected transactions from the previous phase here. 3. Broadcasting - Optional. If the `--broadcast` flag is provided and the previous phases have succeeded, it will broadcast the transactions collected at step `1`. and simulated at step `2`. 4. Verification - Optional. If the `--verify` flag is provided, there's an API key, and the previous phases have succeeded it will attempt to verify the contract. (eg. etherscan). Given this flow, it's important to be aware that transactions whose behaviour can be influenced by external state/actors might have a different result than what was simulated on step `2`. Eg. frontrunning. ### Set Up Let’s try to deploy the NFT contract made in the solmate tutorial with solidity scripting.",400
2105,solidity-scripting.md,"First of all, we would need to create a new Foundry project via: ```sh forge init solidity-scripting ``` Since the NFT contract from the solmate tutorial inherits both `solmate` and `OpenZeppelin` contracts, we’ll have to install them as dependencies by running: ```sh # Enter the project cd solidity-scripting # Install Solmate and OpenZeppelin contracts as dependencies forge install transmissions11/solmate Openzeppelin/openzeppelin-contracts ``` Next, we have to delete the `Counter.sol` file in the `src` folder and create another file called `NFT.sol`. You can do this by running: ```sh rm src/Counter.sol test/Counter.t.sol && touch src/NFT.sol && ls src ``` ![set up commands](../images/solidity-scripting/set-up-commands.png) Once that’s done, you should open up your preferred code editor and copy the code below into the `NFT.sol` file.",198
2106,solidity-scripting.md,"```solidity // SPDX-License-Identifier: UNLICENSED pragma solidity >=0.8.10; import ""solmate/tokens/ERC721.sol""; import ""openzeppelin-contracts/contracts/utils/Strings.sol""; import ""openzeppelin-contracts/contracts/access/Ownable.sol""; error MintPriceNotPaid(); error MaxSupply(); error NonExistentTokenURI(); error WithdrawTransfer(); contract NFT is ERC721, Ownable {  using Strings for uint256;  string public baseURI;  uint256 public currentTokenId;  uint256 public constant TOTAL_SUPPLY = 10_000;  uint256 public constant MINT_PRICE = 0.08 ether;  constructor(   string memory _name,   string memory _symbol,   string memory _baseURI  ) ERC721(_name, _symbol) {   baseURI = _baseURI;  }  function mintTo(address recipient) public payable returns (uint256) {   if (msg.value != MINT_PRICE) {    revert MintPriceNotPaid();   }   uint256 newTokenId = ++currentTokenId;   if (newTokenId > TOTAL_SUPPLY) {    revert MaxSupply();   }   _safeMint(recipient, newTokenId);   return newTokenId;  }  function tokenURI(uint256 tokenId)   public   view   virtual   override   returns (string memory)  {   if (ownerOf(tokenId) == address(0)) {    revert NonExistentTokenURI();   }   return    bytes(baseURI).length > 0     ? string(abi.encodePacked(baseURI, tokenId.toString()))     : """";  }  function withdrawPayments(address payable payee) external onlyOwner {   uint256 balance = address(this).balance;   (bool transferTx, ) = payee.call{value: balance}("""");   if (!transferTx) {    revert WithdrawTransfer();   }  } } ``` Now, let’s try compiling our contract to make sure everything is in order. ```sh forge build ``` If your output looks like this, the contracts successfully compiled.",436
2107,solidity-scripting.md,"![compile successful](../images/solidity-scripting/compile-successful.png) ### Deploying our contract We’re going to deploy the `NFT` contract to the Goerli testnet, but to do this we’ll need to configure Foundry a bit, by setting things like a Goerli RPC URL, the private key of an account that’s funded with Goerli Eth, and an Etherscan key for the verification of the NFT contract. > 💡 Note: You can get some Goerli testnet ETH [here](https://faucet.paradigm.xyz/) . #### Environment Configuration Once you have all that create a `.env` file and add the variables. Foundry automatically loads in a `.env` file present in your project directory. The .env file should follow this format: ```sh GOERLI_RPC_URL= PRIVATE_KEY= ETHERSCAN_API_KEY= ``` We now need to edit the `foundry.toml` file. There should already be one in the root of the project. Add the following lines to the end of the file: ```toml [rpc_endpoints] goerli = ""${GOERLI_RPC_URL}"" [etherscan] goerli = { key = ""${ETHERSCAN_API_KEY}"" } ``` This creates a [RPC alias](../cheatcodes/rpc.md) for Goerli and loads the Etherscan API key. #### Writing the Script Next, we have to create a folder and name it `script` and create a file in it called `NFT.s.sol`. This is where we will create the deployment script itself. The contents of `NFT.s.sol` should look like this: ```solidity // SPDX-License-Identifier: UNLICENSED pragma solidity ^0.8.13; import ""forge-std/Script.sol""; import ""../src/NFT.sol""; contract MyScript is Script {  function run() external {   uint256 deployerPrivateKey = vm.envUint(""PRIVATE_KEY"");   vm.startBroadcast(deployerPrivateKey);   NFT nft = new NFT(""NFT_tutorial"", ""TUT"", ""baseUri"");   vm.stopBroadcast();  } } ``` Now let’s read through the code and figure out what it actually means and does.",467
2108,solidity-scripting.md,"```solidity // SPDX-License-Identifier: UNLICENSED pragma solidity ^0.8.13; ``` Remember even if it’s a script it still works like a smart contract, but is never deployed, so just like any other smart contract written in Solidity the `pragma version` has to be specified. ```solidity import ""forge-std/Script.sol""; import ""../src/NFT.sol""; ``` Just like we may import Forge Std to get testing utilities when writing tests, Forge Std also provides some scripting utilities that we import here. The next line just imports the `NFT` contract. ```solidity contract MyScript is Script { ``` We create a contract called `MyScript` and it inherits `Script` from Forge Std. ```solidity function run() external { ``` By default, scripts are executed by calling the function named `run`, our entrypoint. ```solidity uint256 deployerPrivateKey = vm.envUint(""PRIVATE_KEY""); ``` This loads in the private key from our `.env` file. **Note:** you must be careful when exposing private keys in a `.env` file and loading them into programs. This is only recommended for use with non-privileged deployers or for local / test setups. For production setups please review the various [wallet options](../reference/forge/forge-script.md#wallet-options---raw) that Foundry supports. ```solidity vm.startBroadcast(deployerPrivateKey); ``` This is a special cheatcode that records calls and contract creations made by our main script contract. We pass the `deployerPrivateKey` in order to instruct it to use that key for signing the transactions. Later, we will broadcast these transactions to deploy our NFT contract. ```solidity NFT nft = new NFT(""NFT_tutorial"", ""TUT"", ""baseUri""); ``` Here we just create our NFT contract. Because we called `vm.startBroadcast()` before this line, the contract creation will be recorded by Forge, and as mentioned previously, we can broadcast the transaction to deploy the contract on-chain. The broadcast transaction logs will be stored in the `broadcast` directory by default. You can change the logs location by setting [`broadcast`](../reference/config/project.md#broadcast) in your `foundry.toml` file. Now that you’re up to speed about what the script smart contract does, let’s run it.",484
2109,get-label.md,"get-label.md. ## `getLabel` ### Signature ```solidity function getLabel(address) external returns (string memory); ``` ### Description Retrieves the label for an address if it was previously labeled. If not, it returns the address prefixed with `unlabeled:`. ",56
2110,cast-wallet.md,"cast-wallet.md. ## cast wallet ### NAME cast-wallet - Wallet management utilities. ### SYNOPSIS `cast wallet` [*options*] *command* [*args*] `cast wallet` [*options*] `--version` `cast wallet` [*options*] `--help` ### DESCRIPTION This program is a set of tools to use, create and manage wallets. ### COMMANDS [cast wallet new](./cast-wallet-new.md) &nbsp;&nbsp;&nbsp;&nbsp;Create a new random keypair. [cast wallet address](./cast-wallet-address.md) &nbsp;&nbsp;&nbsp;&nbsp;Convert a private key to an address. [cast wallet sign](./cast-wallet-sign.md) &nbsp;&nbsp;&nbsp;&nbsp;Sign a message. [cast wallet vanity](./cast-wallet-vanity.md) &nbsp;&nbsp;&nbsp;&nbsp;Generate a vanity address. [cast wallet verify](./cast-wallet-verify.md) &nbsp;&nbsp;&nbsp;&nbsp;Verify the signature of a message. ### OPTIONS #### Special Options `-V` `--version` &nbsp;&nbsp;&nbsp;&nbsp;Print version info and exit. {{#include common-options.md}} ",253
2111,base-options.md,"base-options.md. #### Base Options `--base-in` *base* &nbsp;&nbsp;&nbsp;&nbsp;The base of the input number. Available options: &nbsp;&nbsp;&nbsp;&nbsp;10, d, dec, decimal &nbsp;&nbsp;&nbsp;&nbsp;16, h, hex, hexadecimal `--base-out` *base* &nbsp;&nbsp;&nbsp;&nbsp;The desired base of the output. Available options: &nbsp;&nbsp;&nbsp;&nbsp;2, b, bin, binary &nbsp;&nbsp;&nbsp;&nbsp;8, o, oct, octal &nbsp;&nbsp;&nbsp;&nbsp;10, d, dec, decimal &nbsp;&nbsp;&nbsp;&nbsp;16, h, hex, hexadecimal ",159
2112,expect-revert.md,"expect-revert.md. ## `expectRevert` ### Signature ```solidity function expectRevert() external; ``` ```solidity function expectRevert(bytes4 message) external; ``` ```solidity function expectRevert(bytes calldata message) external; ``` ### Description If the **next call** does not revert with the expected data `message`, then `expectRevert` will. After calling `expectRevert`, calls to other cheatcodes before the reverting call are ignored. This means, for example, we can call [`prank`](./prank.md) immediately before the reverting call. There are 3 signatures: - **Without parameters**: Asserts that the next call reverts, regardless of the message. - **With `bytes4`**: Asserts that the next call reverts with the specified 4 bytes. - **With `bytes`**: Asserts that the next call reverts with the specified bytes. > ⚠️ **Gotcha: Usage with low-level calls** > > Normally, a call that succeeds returns a status of `true` (along with any return data) and a call that reverts returns `false`. > > The Solidity compiler will insert checks that ensures that the call succeeded, and revert if it did not. > > The `expectRevert` cheatcode works by inverting this, so the next call after this cheatcode returns `true` if it reverts, and `false` otherwise. > > The implication here is that to use this cheatcode with low-level calls, you must manually assert on the call's status since Solidity is not doing it for you. > > For example: > > ```solidity > function testLowLevelCallRevert() public { >  vm.expectRevert(bytes(""error message"")); >  (bool status, ) = address(myContract).call(myCalldata); >  assertTrue(status, ""expectRevert: call did not revert""); > } > ``` ### Examples To use `expectRevert` with a `string`, pass it as a string literal. ```solidity vm.expectRevert(""error message""); ``` To use `expectRevert` with a custom [error type][error-type] without parameters, use its selector.",462
2113,cast-shr.md,"cast-shr.md. ## cast shr ### NAME cast-shr - Perform a right shifting operation. ### SYNOPSIS ``cast shr`` [*options*] *value* *shift* ### DESCRIPTION Perform a left shifting operation. ### OPTIONS {{#include ../common/base-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Perform a single right bit shift of 0x12  ```sh  cast shr --base-in 16 0x12 1  ``` > Note: The --base-in parameter is not enforced but will be needed if the input is ambiguous. ### SEE ALSO [cast](./cast.md), [cast shl](./cast-shl.md) ",141
2114,cast-wallet-verify.md,"cast-wallet-verify.md. ## cast wallet verify ### NAME cast-wallet-verify - Verify the signature of a message. ### SYNOPSIS ``cast wallet verify`` [*options*] `--address` *address* *message* *signature* ### DESCRIPTION Verify the signature of a message. ### OPTIONS #### Signature Options `-a` *address* `--address` *address* &nbsp;&nbsp;&nbsp;&nbsp;The address of the message signer. {{#include common-options.md}} ### SEE ALSO [cast](./cast.md), [cast wallet](./cast-wallet.md) ",122
2115,forge-coverage.md,"forge-coverage.md. ## forge coverage ### NAME forge-coverage - Displays which parts of your code are covered by tests. ### SYNOPSIS `forge coverage` [*options*] ### DESCRIPTION Displays which parts of your code are covered by tests. ### Options #### Report Options `--report` allows you to specify the report type to use for coverage. This flag can be used multiple times. It has three different options and is set to `summary` by default. `summary` &nbsp;&nbsp;&nbsp;&nbsp;Outputs a chart showing what percentage of your code is covered by tests. `lcov` &nbsp;&nbsp;&nbsp;&nbsp;Creates a lcov.info file containing your coverage data in the root of your project's directory. `debug` &nbsp;&nbsp;&nbsp;&nbsp;Outputs lines describing the location of uncovered code. {{#include common-options.md}} ### EXAMPLES 1. View summarized coverage:  ```sh forge coverage ``` 2. Create lcov file with coverage data:  ```sh forge coverage --report lcov ``` 3. Output uncovered code locations: ```sh forge coverage --report debug ``` ### SEE ALSO [forge](./forge.md), [forge test](./forge-test.md) ",252
2116,forge-config.md,"forge-config.md. ## forge config ### NAME forge-config - Display the current config. ### SYNOPSIS ``forge config`` [*options*] ### DESCRIPTION Display the current config. This command can be used to create a new basic `foundry.toml` or to see what values are currently set, taking environment variables and the global configuration file into account. The command supports almost all flags of the other commands in Forge to allow overriding values in the displayed configuration. ### OPTIONS #### Config Options `--basic` &nbsp;&nbsp;&nbsp;&nbsp;Prints a basic configuration file. `--fix` &nbsp;&nbsp;&nbsp;&nbsp;Attempts to fix any configuration warnings. {{#include common-options.md}} ### EXAMPLES 1. Create a new basic config:  ```sh  forge config > foundry.toml  ``` 2. Enable FFI in `foundry.toml`:  ```sh  forge config --ffi > foundry.toml  ``` ### SEE ALSO [forge](./forge.md) ",208
2117,deployCode.md,"deployCode.md. ## `deployCode` ### Signature ```solidity function deployCode(string memory what) public returns (address); ``` ```solidity function deployCode(string memory what, bytes memory args) public returns (address); ``` ```solidity function deployCode(string memory what, uint256 val) public returns (address); ``` ```solidity function deployCode(string memory what, bytes memory args, uint256 val) public returns (address); ``` ### Description Deploys a contract by fetching the contract bytecode from the artifacts directory. The calldata parameter can either be in the form `ContractFile.sol` (if the filename and contract name are the same), `ContractFile.sol:ContractName`, or the path to an artifact, relative to the root of your project. Values can also be passed by using the `val` parameter. This is necessary if you need to send ETH on the constructor. ### Examples ```solidity address deployment = deployCode(""MyContract.sol"", abi.encode(arg1, arg2)); ``` ",207
2118,project-layout.md,"project-layout.md. ## Project Layout Forge is flexible on how you structure your project. By default, the structure is: ```ignore {{#include ../output/hello_foundry/tree-with-files:output}} ``` - You can configure Foundry's behavior using `foundry.toml`. - Remappings are specified in `remappings.txt`. - The default directory for contracts is `src/`. - The default directory for tests is `test/`, where any contract with a function that starts with `test` is considered to be a test. - Dependencies are stored as git submodules in `lib/`. You can configure where Forge looks for both dependencies and contracts using the `--lib-paths` and `--contracts` flags respectively. Alternatively you can configure it in `foundry.toml`. Combined with remappings, this gives you the flexibility needed to support the project structure of other toolchains such as Hardhat and Truffle. For automatic Hardhat support you can also pass the `--hh` flag, which sets the following flags: `--lib-paths node_modules --contracts contracts`. ",223
2119,get-deployed-code.md,"get-deployed-code.md. ## `getDeployedCode` ### Signature ```solidity function getDeployedCode(string calldata) external returns (bytes memory); ``` ### Description This cheatcode works similar to [`getCode`](./get-code.md) but only returns the **deployed** bytecode (aka runtime bytecode) for a contract in the project given the path to the contract. The main use case for this cheat code is as a shortcut to deploy stateless contracts to arbitrary addresses. The calldata parameter can either be in the form `ContractFile.sol` (if the filename and contract name are the same) , `ContractFile.sol:ContractName`, or the path to an artifact, relative to the root of your project. > ℹ️ **Note** > > `getDeployedCode` requires read permission for the output directory, see [file cheatcodes](./fs.md). > > To grant read access set `fs_permissions = [{ access = ""read"", path = ""./out""}]` in your `foundry.toml`. ### Examples Deploy a stateless contract at an arbitrary address using `getDeployedCode` and [`etch`](./etch.md). ```solidity // A stateless contract that we want deployed at a specific address contract Override {  event Payload(address sender, address target, bytes data);  function emitPayload(   address target, bytes calldata message  ) external payable returns (uint256) {   emit Payload(msg.sender, target, message);   return 0;  } } // get the **deployedBytecode** bytes memory code = vm.getDeployedCode(""Override.sol:Override""); // set the code of an arbitrary address address overrideAddress = address(64); vm.etch(overrideAddress, code); assertEq(overrideAddress.code, code); ``` ### SEE ALSO Forge Standard Library [`getCode`](./get-code.md) [`etch`](./etch.md) [forge-std]: ../reference/forge-std ",404
2120,environment.md,environment.md. ## Environment - [`warp`](./warp.md) - [`roll`](./roll.md) - [`fee`](./fee.md) - [`difficulty`](./difficulty.md) - [`prevrandao`](./prevrandao.md) - [`chainId`](./chain-id.md) - [`store`](./store.md) - [`load`](./load.md) - [`etch`](./etch.md) - [`deal`](./deal.md) - [`prank`](./prank.md) - [`startPrank`](./start-prank.md) - [`stopPrank`](./stop-prank.md) - [`record`](./record.md) - [`accesses`](./accesses.md) - [`recordLogs`](./record-logs.md) - [`getRecordedLogs`](./get-recorded-logs.md) - [`setNonce`](./set-nonce.md) - [`getNonce`](./get-nonce.md) - [`mockCall`](./mock-call.md) - [`mockCallRevert`](./mock-call-revert.md) - [`clearMockedCalls`](./clear-mocked-calls.md) - [`coinbase`](./coinbase.md) - [`broadcast`](./broadcast.md) - [`startBroadcast`](./start-broadcast.md) - [`stopBroadcast`](./stop-broadcast.md) - [`pauseGasMetering`](./pause-gas-metering.md) - [`resumeGasMetering`](./resume-gas-metering.md),302
2121,forge-remove.md,"forge-remove.md. ## forge remove ### NAME forge-remove - Remove one or multiple dependencies. ### SYNOPSIS ``forge remove`` [*options*] [*deps...*] ### DESCRIPTION Remove one or multiple dependencies. Dependencies can be a raw URL (`https://foo.com/dep`), the path to a GitHub repository (`owner/repo`) or the path to the dependency in the project tree. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Remove a dependency by path:  ```sh  forge remove lib/solmate  ``` 2. Remove a dependency by GitHub repository name:  ```sh  forge remove dapphub/solmate  ``` ### SEE ALSO [forge](./forge.md), [forge install](./forge-install.md), [forge update](./forge-update.md) ",166
2122,cast--to-rlp.md,"cast--to-rlp.md. ## cast --to-rlp ### NAME cast---to-rlp - Encodes hex data to RLP. ### SYNOPSIS ``cast --to-rlp`` *array* ### DESCRIPTION RLP encodes a hex string or a JSON array of hex strings. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Encoding RLP data:  ```sh  cast --to-rlp '[""0xaa"",""0xbb"",""cc""]'   cast --to-rlp f0a9   ``` ",118
2123,overview.md,"overview.md. ## Config Overview Foundry's configuration system allows you to configure its tools. ### Profiles Configuration can be arbitrarily namespaced into profiles. The default profile is named `default`, and all other profiles inherit values from this profile. Profiles are defined in the `profile` map. To add a profile named `local`, you would add: ```toml [profile.local] ``` You can select the profile to use by setting the `FOUNDRY_PROFILE` environment variable. ### Global configuration You can create a `foundry.toml` file in `~/.foundry` folder to configure Foundry globally. ### Environment variables Configuration can be overriden with `FOUNDRY_` and `DAPP_` prefixed environment variables. Exceptions are: - `FOUNDRY_FFI`, `DAPP_FFI` ### Configuration format Configuration files are written in the [TOML format](https://toml.io), with simple key-value pairs inside of sections. This page describes each configuration key in detail. To see the default values, either refer to the specific key in this document, or see the [default config](/static/config.default.toml). ### Configuration keys This section documents all configuration keys. All configuration keys must live under a profile, such as `default`. ",264
2124,multi-wallet-options-hardware.md,multi-wallet-options-hardware.md. #### Wallet Options - Hardware Wallet `-t` `--trezor` &nbsp;&nbsp;&nbsp;&nbsp;Use a Trezor hardware wallet. `-l` `--ledger` &nbsp;&nbsp;&nbsp;&nbsp;Use a Ledger hardware wallet. `--hd-paths` *paths* &nbsp;&nbsp;&nbsp;&nbsp;The derivation paths to use with hardware wallets.,89
2125,broadcast.md,"broadcast.md. ## `broadcast` ### Signature ```solidity function broadcast() external; ``` ```solidity function broadcast(address who) external; ``` ```solidity function broadcast(uint256 privateKey) external; ``` ### Description Using the address that calls the test contract or the address / private key provided as the sender, has the next call (at this call depth only and excluding cheatcode calls) create a transaction that can later be signed and sent onchain. ### Examples ```solidity function deploy() public {  cheats.broadcast(ACCOUNT_A);  Test test = new Test();  // this won't generate tx to sign  uint256 b = test.t(4);  // this will  cheats.broadcast(ACCOUNT_B);  test.t(2);  // this also will, using a private key from your environment variables  cheats.broadcast(vm.envUint(""PRIVATE_KEY""));  test.t(3); } ``` ### SEE ALSO - [startBroadcast](./start-broadcast.md) - [stopBroadcast](./stop-broadcast.md) ",209
2126,cast-tx.md,"cast-tx.md. ## cast tx ### NAME cast-tx - Get information about a transaction. ### SYNOPSIS ``cast tx`` [*options*] *tx_hash* [*field*] ### DESCRIPTION Get information about a transaction. If *field* is specified, then only the given field of the transaction is displayed. ### OPTIONS #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include ../common/display-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Get information about a transaction:  ```sh  cast tx $TX_HASH  ``` 2. Get the sender of a transaction:  ```sh  cast tx $TX_HASH from  ``` ### SEE ALSO [cast](./cast.md), [cast receipt](./cast-receipt.md) ",163
2127,forge_README.md,"forge_README.md. ## Overview of Forge Forge is a command-line tool that ships with Foundry. Forge tests, builds, and deploys your smart contracts. ",34
2128,ref_forge_common-options.md,ref_forge_common-options.md. #### Common Options `-h` `--help` &nbsp;&nbsp;&nbsp;&nbsp;Prints help information. ,32
2129,common-options.md,common-options.md. #### Common Options `-h` `--help` &nbsp;&nbsp;&nbsp;&nbsp;Prints help information. ,29
2130,watch-options.md,"watch-options.md. #### Watch Options `-w` [*path...*] `--watch` [*path...*] &nbsp;&nbsp;&nbsp;&nbsp;Watch specific file(s) or folder(s). &nbsp;&nbsp;&nbsp;&nbsp;By default, the project's source directory is watched. `-d` *delay* `--delay` *delay* &nbsp;&nbsp;&nbsp;&nbsp;File update debounce delay. &nbsp;&nbsp;&nbsp;&nbsp;During the delay, incoming change events are accumulated and only once the delay has passed, is an action taken. &nbsp;&nbsp;&nbsp;&nbsp;Note that this does not mean a command will be started: if `--no-restart` is given and a command is already running, the outcome of the action will be to do nothing. &nbsp;&nbsp;&nbsp;&nbsp;Defaults to 50ms. Parses as decimal seconds by default, but using an integer with the `ms` suffix may be more convenient. &nbsp;&nbsp;&nbsp;&nbsp;When using `--poll` mode, you'll want a larger duration, or risk overloading disk I/O. `--no-restart` &nbsp;&nbsp;&nbsp;&nbsp;Do not restart the command while it's running. `--run-all` &nbsp;&nbsp;&nbsp;&nbsp;Explicitly re-run the command on all files when a change is made. ",292
2131,depth.md,"depth.md. ## `depth` ### Signature ```solidity function depth(StdStorage storage self, uint256 _depth) internal returns (StdStorage storage); ``` ### Description Sets the position of the value in the `tuple` (e.g. inside a `struct`). Default value: `uint256(0)` ",65
2132,cast--to-uint256.md,cast--to-uint256.md. ## cast --to-uint256 ### NAME cast---to-uint256 - Convert a number to a hex-encoded uint256. ### SYNOPSIS ``cast --to-uint256`` [*options*] *value* ### DESCRIPTION Convert a number to a hex-encoded uint256. ### OPTIONS {{#include common-options.md}} ### SEE ALSO [cast](./cast.md) ,84
2133,abs.md,abs.md. ## `abs` ### Signature ```solidity function abs(int256 a) internal pure returns (uint256) ``` ### Description Returns the absolute value of a number. ### Example ```solidity uint256 ten = stdMath.abs(-10); ``` ,53
2134,create-fork.md,"create-fork.md. ## `createFork` ### Signature ```solidity // Creates a new fork with the given endpoint and the _latest_ block and returns the identifier of the fork function createFork(string calldata urlOrAlias) external returns (uint256) ``` ```solidity // Creates a new fork with the given endpoint and block and returns the identifier of the fork function createFork(string calldata urlOrAlias, uint256 block) external returns (uint256); ``` ```solidity // Creates a new fork with the given endpoint and at the block the given transaction was mined in, and replays all transaction mined in the block before the transaction function createFork(string calldata urlOrAlias, bytes32 transaction) external returns (uint256); ``` ### Description Creates a new fork from the given endpoint and returns the identifier of the fork. If a block number is passed as an argument, the fork will begin on that block, otherwise it will begin on the _latest_ block. If a transaction hash is provided, it will roll the fork to the block the transaction was mined in and replays all previously executed transactions. ### Examples Create a new mainnet fork with the latest block number: ```solidity uint256 forkId = vm.createFork(MAINNET_RPC_URL); vm.selectFork(forkId); assertEq(block.number, 15_171_037); // as of time of writing, 2022-07-19 04:55:27 UTC ``` Create a new mainnet fork with a given block number: ```solidity uint256 forkId = vm.createFork(MAINNET_RPC_URL, 1_337_000); vm.selectFork(forkId); assertEq(block.number, 1_337_000); ``` ### SEE ALSO - [activeFork](./active-fork.md) - [selectFork](./select-fork.md) - [createSelectFork](./create-select-fork.md) ",405
2135,console-log.md,"console-log.md. ## Console Logging - Similar to Hardhat's console functions. - You can use it in calls and transactions. It works with view functions, but not in pure ones. - It always works, regardless of the call or transaction failing or being successful. - To use it you need to import forge-std/src/console.sol. - You can call console.log with up to 4 parameters in any order of following types:  - `uint`  - `string`  - `bool`  - `address` - There's also the single parameter API for the types above, and additionally bytes, bytes1... up to bytes32:  - `console.logInt(int i)`  - `console.logUint(uint i)`  - `console.logString(string memory s)`  - `console.logBool(bool b)`  - `console.logAddress(address a)`  - `console.logBytes(bytes memory b)`  - `console.logBytes1(bytes1 b)`  - `console.logBytes2(bytes2 b)`  - ...  - `console.logBytes32(bytes32 b)` - console.log implements the same formatting options that can be found in Hardhat's console.log.  - Example: `console.log(""Changing owner from %s to %s"", currentOwner, newOwner)` - console.log is implemented in standard Solidity and it is compatible Anvil and Hardhat Networks. - console.log calls can run in other networks, like mainnet, kovan, ropsten, etc. They do nothing in those networks, but do spend a minimal amount of gas. ### `console.log(format[,...args])` The `console.log()` method prints a formatted string using the first argument as a printf-like format string which can contain zero or more format specifiers. Each specifier is replaced with the converted value from the corresponding argument. Supported specifiers are: - `%s`: String will be used to convert all values to a human-readable string. `uint256`, `int256` and `bytes` values are converted to their `0x` hex encoded values. - `%d`: Number will be used to convert all values to a human-readable string. This is identical to `%s`. - `%i`: Works the same way as `%d`. - `%e`: The exponential representation of a number. For `uint256` and `int256` types. - `%x`: The hexadecimal representation of a number.",497
2136,gas-tracking.md,"gas-tracking.md. ## Gas Tracking Forge can help you estimate how much gas your contract will consume. Currently, Forge ships with two different tools for this job, but they may be merged in the future: - [**Gas reports**](./gas-reports.md): Gas reports give you an overview of how much Forge thinks the individual functions in your contracts will consume in gas. - [**Gas snapshots**](./gas-snapshots.md): Gas snapshots give you an overview of how much each test consumes in gas. Gas reports and gas snapshots differ in some ways: - Gas reports use tracing to figure out gas costs for individual contract calls.  This gives more granular insight, at the cost of speed. - Gas snapshots have more built-in tools, such as diffs and exporting the results to a file.  Snapshots are not as granular as gas reports, but they are faster to generate. ",184
2137,chain-id.md,chain-id.md. ## `chainId` ### Signature ```solidity function chainId(uint256) external; ``` ### Description Sets `block.chainid`. ### Examples ```solidity vm.chainId(31337); emit log_uint(block.chainid); // 31337 ``` ,56
2138,record.md,"record.md. ## `record` ### Signature ```solidity function record() external; ``` ### Description Tell the VM to start recording all storage reads and writes. To access the reads and writes, use [`accesses`](./accesses.md). > ℹ️ **Note** > > Every write also counts as an additional read. ### Examples ```solidity /// contract NumsContract { ///  uint256 public num1 = 100; // slot 0 ///  uint256 public num2 = 200; // slot 1 /// } vm.record(); numsContract.num2(); (bytes32[] memory reads, bytes32[] memory writes) = vm.accesses( address(numsContract) ); emit log_uint(uint256(reads[0])); // 1 ``` ### SEE ALSO Forge Standard Library [Std Storage](../reference/forge-std/std-storage.md)",175
2139,gas-reports.md,"gas-reports.md. ## Gas Reports Forge can produce gas reports for your contracts. You can configure which contracts output gas reports via the `gas_reports` field in `foundry.toml`. To produce reports for specific contracts: ```toml gas_reports = [""MyContract"", ""MyContractFactory""] ``` To produce reports for all contracts: ```toml gas_reports = [""*""] ``` To generate gas reports, run `forge test --gas-report`. You can also use it in combination with other subcommands, such as `forge test --match-test testBurn --gas-report`, to generate only a gas report relevant to this test.",129
2140,cheatcodes.md,"cheatcodes.md. ## Cheatcodes Most of the time, simply testing your smart contracts outputs isn't enough. To manipulate the state of the blockchain, as well as test for specific reverts and events, Foundry is shipped with a set of cheatcodes. Cheatcodes allow you to change the block number, your identity, and more. They are invoked by calling specific functions on a specially designated address: `0x7109709ECfa91a80626fF3989D68f67F5b1DD12D`. You can access cheatcodes easily via the `vm` instance available in Forge Standard Library's `Test` contract. Forge Standard Library is explained in greater detail in the following [section](./forge-std.md). Let's write a test for a smart contract that is only callable by its owner. ```solidity {{#include ../../projects/cheatcodes/test/OwnerUpOnly.t.sol:prelude}} {{#include ../../projects/cheatcodes/test/OwnerUpOnly.t.sol:contract}} {{#include ../../projects/cheatcodes/test/OwnerUpOnly.t.sol:contract_prelude}} {{#include ../../projects/cheatcodes/test/OwnerUpOnly.t.sol:simple_test}} } ``` If we run `forge test` now, we will see that the test passes, since `OwnerUpOnlyTest` is the owner of `OwnerUpOnly`. ```ignore $ forge test {{#include ../output/cheatcodes/forge-test-simple:output}} ``` Let's make sure that someone who is definitely not the owner can't increment the count: ```solidity {{#include ../../projects/cheatcodes/test/OwnerUpOnly.t.sol:contract_prelude}}  // ... {{#include ../../projects/cheatcodes/test/OwnerUpOnly.t.sol:test_fail}} } ``` If we run `forge test` now, we will see that all the test pass. ```ignore $ forge test {{#include ../output/cheatcodes/forge-test-cheatcodes:output}} ``` The test passed because the `prank` cheatcode changed our identity to the zero address for the next call (`upOnly.increment()`). The test case passed since we used the `testFail` prefix, however, using `testFail` is considered an anti-pattern since it does not tell us anything about *why* `upOnly.increment()` reverted.",490
2141,cheatcodes.md,"If we run the tests again with traces turned on, we can see that we reverted with the correct error message. ```ignore $ forge test -vvvv --match-test testFail_IncrementAsNotOwner {{#include ../output/cheatcodes/forge-test-cheatcodes-tracing:output}} ``` To be sure in the future, let's make sure that we reverted because we are not the owner using the `expectRevert` cheatcode: ```solidity {{#include ../../projects/cheatcodes/test/OwnerUpOnly.t.sol:contract_prelude}}  // ... {{#include ../../projects/cheatcodes/test/OwnerUpOnly.t.sol:test_expectrevert}} } ``` If we run `forge test` one last time, we see that the test still passes, but this time we are sure that it will always fail if we revert for any other reason. ```ignore $ forge test {{#include ../output/cheatcodes/forge-test-cheatcodes-expectrevert:output}} ``` Another cheatcode that is perhaps not so intuitive is the `expectEmit` function. Before looking at `expectEmit`, we need to understand what an event is. Events are inheritable members of contracts. When you emit an event, the arguments are stored on the blockchain. The `indexed` attribute can be added to a maximum of three parameters of an event to form a data structure known as a ""topic."" Topics allow users to search for events on the blockchain. ```solidity {{#include ../../projects/cheatcodes/test/EmitContract.t.sol:all}} ``` When we call `vm.expectEmit(true, true, false, true);`, we want to check the 1st and 2nd `indexed` topic for the next event. The expected `Transfer` event in `test_ExpectEmit()` means we are expecting that `from` is `address(this)`, and `to` is `address(1337)`. This is compared against the event emitted from `emitter.t()`. In other words, we are checking that the first topic from `emitter.t()` is equal to `address(this)`. The 3rd argument in `expectEmit` is set to `false` because there is no need to check the third topic in the `Transfer` event, since there are only two. It does not matter even if we set to `true`.",495
2142,cast--format-bytes32-string.md,"cast--format-bytes32-string.md. ## cast --format-bytes32-string ### NAME cast---format-bytes32-string - Formats a string into bytes32 encoding. ### SYNOPSIS ``cast --format-bytes32-string`` [*options*] *string* ### DESCRIPTION Formats a string into bytes32 encoding. Note that this command is for formatting a [Solidity string literal](https://docs.soliditylang.org/en/v0.8.16/types.html#string-literals-and-types) into `bytes32` only. If you're looking to pad a byte string, use [--to-bytes32](./cast--to-bytes32.md) instead. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Turn string ""hello"" into bytes32 hex:  ```sh  cast --format-bytes32-string ""hello""  ``` ### SEE ALSO [cast](./cast.md) ",189
2143,assertApproxEqAbs.md,"assertApproxEqAbs.md. ## `assertApproxEqAbs` ### Signature ```solidity function assertApproxEqAbs(uint256 a, uint256 b, uint256 maxDelta) internal virtual; ``` ```solidity function assertApproxEqAbs(uint256 a, uint256 b, uint256 maxDelta, string memory err) internal virtual; ``` ### Description Asserts `a` is approximately equal to `b` with delta in absolute value. ### Examples ```solidity function testFail () external {  uint256 a = 100;  uint256 b = 200;  assertApproxEqAbs(a, b, 90); } ``` ```ignore [PASS] testFail() (gas: 23169) Logs: Error: a ~= b not satisfied [uint]  Expected: 200  Actual: 100 Max Delta: 90  Delta: 100 ``` ",184
2144,creating-a-new-project.md,"creating-a-new-project.md. ## Creating a New Project To start a new project with Foundry, use [`forge init`](../reference/forge/forge-init.md): ```sh {{#include ../output/hello_foundry/forge-init:command}} ``` This creates a new directory `hello_foundry` from the default template. This also initializes a new `git` repository. If you want to create a new project using a different template, you would pass the `--template` flag, like so: ```sh $ forge init --template https://github.com/foundry-rs/forge-template hello_template ``` For now, let's check what the default template looks like: ```sh $ cd hello_foundry {{#include ../output/hello_foundry/tree:all}} ``` The default template comes with one dependency installed: Forge Standard Library. This is the preferred testing library used for Foundry projects. Additionally, the template also comes with an empty starter contract and a simple test. Let's build the project: ```sh {{#include ../output/hello_foundry/forge-build:all}} ``` And run the tests: ```sh {{#include ../output/hello_foundry/forge-test:all}} ``` You'll notice that two new directories have popped up: `out` and `cache`. The `out` directory contains your contract artifact, such as the ABI, while the `cache` is used by `forge` to only recompile what is necessary. ",300
2145,evm-options.md,"evm-options.md. #### EVM Options `-f` *url* `--rpc-url` *url* `--fork-url` *url* &nbsp;&nbsp;&nbsp;&nbsp;Fetch state over a remote endpoint instead of starting from an empty state. &nbsp;&nbsp;&nbsp;&nbsp;If you want to fetch state from a specific block number, see `--fork-block-number`. `--fork-block-number` *block* &nbsp;&nbsp;&nbsp;&nbsp;Fetch state from a specific block number over a remote endpoint. See `--fork-url`. `--fork-retry-backoff <BACKOFF>` &nbsp;&nbsp;&nbsp;&nbsp; Initial retry backoff on encountering errors. `--no-storage-caching` &nbsp;&nbsp;&nbsp;&nbsp;Explicitly disables the use of RPC caching. &nbsp;&nbsp;&nbsp;&nbsp;All storage slots are read entirely from the endpoint. See `--fork-url`. `-v` `--verbosity` &nbsp;&nbsp;&nbsp;&nbsp;Verbosity of the EVM. &nbsp;&nbsp;&nbsp;&nbsp;Pass multiple times to increase the verbosity (e.g. `-v`, `-vv`, `-vvv`). &nbsp;&nbsp;&nbsp;&nbsp;Verbosity levels: &nbsp;&nbsp;&nbsp;&nbsp;- 2: Print logs for all tests &nbsp;&nbsp;&nbsp;&nbsp;- 3: Print execution traces for failing tests &nbsp;&nbsp;&nbsp;&nbsp;- 4: Print execution traces for all tests, and setup traces for failing tests &nbsp;&nbsp;&nbsp;&nbsp;- 5: Print execution and setup traces for all tests `--sender` *address* &nbsp;&nbsp;&nbsp;&nbsp;The address which will be executing tests `--initial-balance` *balance* &nbsp;&nbsp;&nbsp;&nbsp;The initial balance of deployed contracts `--ffi` &nbsp;&nbsp;&nbsp;&nbsp;Enables the [FFI cheatcode][ffi-cheatcode] [ffi-cheatcode]: ../../cheatcodes/ffi.md ",430
2146,addr.md,addr.md. ## `addr` ### Signature ```solidity function addr(uint256 privateKey) external returns (address); ``` ### Description Computes the address for a given private key. ### Examples ```solidity address alice = vm.addr(1); emit log_address(alice); // 0x7e5f4552091a69125d5dfcb7b8c2659029395bdf ``` ,84
2147,cast-help.md,cast-help.md. ## cast help ### NAME cast-help - Get help for a Cast command ### SYNOPSIS ``cast help`` [*subcommand*] ### DESCRIPTION Prints a help message for the given command. ### EXAMPLES 1. Get help for a command:  ```sh  cast help call  ``` 2. Help is also available with the `--help` flag:  ```sh  cast call --help  ``` ### SEE ALSO [cast](./cast.md) ,98
2148,parse-int.md,"parse-int.md. ## `parseInt` ### Signature ```solidity function parseInt(string calldata stringifiedValue) external pure returns (int256 parsedValue); ``` ### Description Parses the value of `string` into `int256` ### Examples ```solidity string memory intAsString = ""-12345""; int256 stringToInt = vm.parseInt(intAsString); // -12345 ``` ",76
2149,ref_cast_README.md,ref_cast_README.md. ## cast Commands - [General Commands](./general-commands.md) - [Chain Commands](./chain-commands.md) - [Transaction Commands](./transaction-commands.md) - [Block Commands](./block-commands.md) - [Account Commands](./account-commands.md) - [ENS Commands](./ens-commands.md) - [Etherscan Commands](./etherscan-commands.md) - [ABI Commands](./abi-commands.md) - [Conversion Commands](./conversion-commands.md) - [Utility Commands](./utility-commands.md) - [Wallet Commands](./wallet-commands.md) ,135
2150,assertFalse.md,"assertFalse.md. ## `assertFalse` ### Signature ```solidity function assertFalse(bool data) internal virtual; ``` ```solidity function assertFalse(bool data, string memory err) internal virtual; ``` ### Description Asserts the `condition` is false. ### Examples ```solidity bool failure = contract.fun(); assertFalse(failure); ```",64
2151,utilities.md,utilities.md. ## Utilities - [`addr`](./addr.md) - [`sign`](./sign.md) - [`label`](./label.md) - [`getLabel`](./get-label.md) - [`deriveKey`](./derive-key.md) - [`rememberKey`](./remember-key.md) - [`toString`](./to-string.md) - [`breakpoint`](./breakpoint.md) ,79
2152,cast-etherscan-source.md,"cast-etherscan-source.md. ## cast etherscan-source ### NAME cast-etherscan-source - Get the source code of a contract from Etherscan. ### SYNOPSIS ``cast etherscan-source`` [*options*] *address* ### DESCRIPTION Get the source code of a contract from Etherscan. The destination (*to*) can be an ENS name or an address. ### OPTIONS #### Output Options `-d` *directory* &nbsp;&nbsp;&nbsp;&nbsp;The output directory to expand the source tree into. &nbsp;&nbsp;&nbsp;&nbsp;If not provided, the source will be outputted to stdout. {{#include ../common/etherscan-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the source code of the WETH contract:  ```sh  cast etherscan-source 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2  ``` 2. Expand the source code of the WETH contract into a directory named `weth`  ```sh  cast etherscan-source -d weth 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2  ``` ### SEE ALSO [cast](./cast.md) ",279
2153,std-logs.md,"std-logs.md. ## Std Logs Std Logs expand upon the logging events from the [`DSTest`](../ds-test.md#logging) library. ### Events ```solidity event log_array(uint256[] val); event log_array(int256[] val); event log_named_array(string key, uint256[] val); event log_named_array(string key, int256[] val); ``` ### Usage This section provides usage examples. #### log\_array ```solidity event log_array(<type>[] val); ``` Where `<type>` can be `int256`, `uint256`, `address`. ##### Example ```solidity // Assuming storage // uint256[] data = [10, 20, 30, 40, 50]; emit log_array(data); ``` #### log\_named\_array ```solidity event log_named_array(string key, <type>[] val); ``` Where `<type>` can be `int256`, `uint256`, `address`. ##### Example ```solidity // Assuming storage // uint256[] data = [10, 20, 30, 40, 50]; emit log_named_array(""Data"", data); ``` ",232
2154,cast-abi-encode.md,"cast-abi-encode.md. ## cast abi-encode ### NAME cast-abi-encode - ABI encode the given function arguments, excluding the selector. ### SYNOPSIS ``cast abi-encode`` [*options*] *sig* [*args...*] ### DESCRIPTION ABI encode the given function, excluding the selector. The signature (*sig*) is a fragment in the form `<function name>(<types...>)`. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. ABI-encode the arguments for a call to `someFunc(address,uint256)`:  ```sh  cast abi-encode ""someFunc(address,uint256)"" 0x... 1  ``` 2. For encoding a type with components (as a tuple, or custom struct):  ```sh  cast abi-encode ""someFunc((string,uint256))"" ""(myString,1)""  ``` ### SEE ALSO [cast](./cast.md), [cast calldata](./cast-calldata.md) ",204
2155,cast-4byte.md,"cast-4byte.md. ## cast 4byte ### NAME cast-4byte - Get the function signatures for the given selector from <https://sig.eth.samczsun.com>. ### SYNOPSIS ``cast 4byte`` [*options*] *sig* ### DESCRIPTION Get the function signatures for the given selector from <https://sig.eth.samczsun.com>. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Get the function signature for the selector `0x8cc5ce99`:  ```sh  cast 4byte 0x8cc5ce99  ``` ### SEE ALSO [cast](./cast.md), [cast 4byte-decode](./cast-4byte-decode.md), [cast 4byte-event](./cast-4byte-event.md) ",166
2156,test-commands.md,test-commands.md. ## Test Commands - [forge test](./forge-test.md) - [forge snapshot](./forge-snapshot.md) ,30
2157,zeroVarError.md,zeroVarError.md. ## `zeroVarError` ### Signature ```solidity stdError.zeroVarError ``` ### Description The internal Solidity error when trying to call a function via a function pointer that has not been initialized.,45
2158,env-uint.md,"env-uint.md. ## `envUint` ### Signature ```solidity function envUint(string calldata key) external returns (uint256 value); ``` ```solidity function envUint(string calldata key, string calldata delimiter) external returns (uint256[] memory values); ``` ### Description Read an environment variable as `uint256` or `uint256[]`. ### Tips - If the value starts with `0x`, it will be interpreted as a hex value, otherwise, it will be treated as a decimal number. - For arrays, you can specify the delimiter used to seperate the values with the `delimiter` parameter. ### Examples #### Single Value With environment variable `UINT_VALUE=115792089237316195423570985008687907853269984665640564039457584007913129639935`, ```solidity string memory key = ""UINT_VALUE""; uint256 expected = type(uint256).max; uint256 output = cheats.envUint(key); assert(output == expected); ``` #### Array With environment variable `UINT_VALUES=0,0x0000000000000000000000000000000000000000000000000000000000000000`, ```solidity string memory key = ""UINT_VALUES""; string memory delimiter = "",""; uint256[2] memory expected = [type(uint256).min, type(uint256).min]; uint256[] memory output = cheats.envUint(key, delimiter); assert(keccak256(abi.encodePacked((output))) == keccak256(abi.encodePacked((expected)))); ``` ",317
2159,installation.md,"installation.md. ## Installation If you face any issues while installing, check out the [FAQ](../faq.md). ### Precompiled binaries Precompiled binaries are available from the [GitHub releases page](https://github.com/foundry-rs/foundry/releases). These are better managed by using [Foundryup](#using-foundryup). ### Using Foundryup Foundryup is the Foundry toolchain installer. You can find more about it [here](https://github.com/foundry-rs/foundry/blob/master/foundryup/README.md). Open your terminal and run the following command: ```sh curl -L https://foundry.paradigm.xyz | bash ``` This will install Foundryup, then simply follow the instructions on-screen, which will make the `foundryup` command available in your CLI. Running `foundryup` by itself will install the latest (nightly) [precompiled binaries](#precompiled-binaries): `forge`, `cast`, `anvil`, and `chisel`. See `foundryup --help` for more options, like installing from a specific version or commit. > ℹ️ **Note** > > If you're on Windows, you will need to install and use [Git BASH](https://gitforwindows.org/) or [WSL](https://learn.microsoft.com/en-us/windows/wsl/install), > as your terminal, since Foundryup currently does not support Powershell or Cmd. ### Building from source #### Prerequisites You will need the [Rust](https://rust-lang.org) compiler and Cargo, the Rust package manager. The easiest way to install both is with [`rustup.rs`](https://rustup.rs/). On Windows, you will also need a recent version of [Visual Studio](https://visualstudio.microsoft.com/downloads/), installed with the ""Desktop Development With C++"" Workloads option.",392
2160,cast-rpc.md,"cast-rpc.md. ## cast rpc ### NAME cast-rpc - Perform a raw JSON-RPC request ### SYNOPSIS ``cast rpc`` [*options*] *METHOD* [*PARAMS...*] ### DESCRIPTION Perform a simple JSON-RPC POST request for the given method and with the params ### OPTIONS #### Query Options `-r` *url* `--rpc-url` *url* &nbsp;&nbsp;&nbsp;&nbsp;The URL of the provider `-w` `--raw` &nbsp;&nbsp;&nbsp;&nbsp;Pass the ""params"" as is &nbsp;&nbsp;&nbsp;&nbsp; If --raw is passed the first PARAM will be taken as the value of ""params"". If no params are given, stdin will be used. For example: &nbsp;&nbsp;&nbsp;&nbsp; rpc eth_getBlockByNumber '[""0x123"", false]' --raw &nbsp;&nbsp;&nbsp;&nbsp; => {""method"": ""eth_getBlockByNumber"", ""params"": [""0x123"", false] ... } ### EXAMPLES 1. Get latest `eth_getBlockByNumber` on localhost:  ```sh  cast rpc eth_getBlockByNumber ""latest"" ""false""  ``` 2. Get `eth_getTransactionByHash` on localhost:  ```sh  cast rpc eth_getTransactionByHash 0x2642e960d3150244e298d52b5b0f024782253e6d0b2c9a01dd4858f7b4665a3f  ```  3. Get latest `eth_getBlockByNumber` on etherum mainnet:  ```sh cast rpc --rpc-url https://mainnet.infura.io/v3/ eth_getBlockByNumber ""latest"" ""false"" ``` ",371
2161,forge-verify-check.md,"forge-verify-check.md. ## forge verify-check ### NAME forge-verify-check - Check verification status on a chosen verification provider. ### SYNOPSIS ``forge verify-check`` [*options*] *id* [*etherscan_key*] The *id* is the verification identifier. For Etherscan & Bloxroute - it is the submission GUID, for Sourcify - it's the contract address. ### DESCRIPTION Check verification status on a chosen verification provider. For Etherscan, you must provide an Etherscan API key, either by passing it as an argument or setting `ETHERSCAN_API_KEY` ### OPTIONS #### Verify Contract Options {{#include ../common/verifier-options.md}} `--chain-id` *chain_id* &nbsp;&nbsp;&nbsp;&nbsp;The chain ID the contract is deployed to (either a number or a chain name). &nbsp;&nbsp;&nbsp;&nbsp;Default: mainnet {{#include ../common/retry-options.md}} {{#include common-options.md}} ### SEE ALSO [forge](./forge.md), [forge create](./forge-create.md), [forge verify-contract](./forge-verify-contract.md) ",240
2162,rpc-url-option.md,"rpc-url-option.md. `--rpc-url` *url* &nbsp;&nbsp;&nbsp;&nbsp;The RPC endpoint. Accepts a URL or an existing alias in the [rpc_endpoints] table, like `mainnet`. &nbsp;&nbsp;&nbsp;&nbsp;Environment: `ETH_RPC_URL` `--flashbots` &nbsp;&nbsp;&nbsp;&nbsp;Use the Flashbots RPC URL (https://rpc.flashbots.net) ",93
2163,faq.md,"faq.md. ## FAQ This is a collection of common questions and answers. If you do not find your question listed here, hop in the [Telegram support channel][tg-support] and let us help you! ### `libusb` Error When Running `forge`/`cast` If you are using the binaries as released, you may see the following error on MacOS: ```sh dyld: Library not loaded: /usr/local/opt/libusb/lib/libusb-1.0.0.dylib ``` In order to fix this, you must install the `libusb` library: ```sh brew install libusb ``` ### Out of Date `GLIBC` Error: If you run into an error resembling the following after using `foundryup`: ```sh forge: /lib/x86_64-linux-gnu/libc.so.6: version 'GLIBC_2.29' not found (required by forge) ``` There are 2 workarounds: 1. [Building from source](./getting-started/installation.md#building-from-source) 2. [Using Docker](./getting-started/installation.md#using-foundry-with-docker) ### Help! I can't see my logs Forge does not display logs by default. If you want to see logs from Hardhat's `console.log` or from DSTest-style `log_*` events, you need to run [`forge test`][forge-test] with verbosity 2 (`-vv`). If you want to see other events your contracts emit, you need to run with traces enabled. To do that, set the verbosity to 3 (`-vvv`) to see traces for failing tests, or 4 (`-vvvv`) to see traces for all tests. ### My tests are failing and I don't know why To gain better insight into why your tests are failing, try using traces. To enable traces, you need to increase the verbosity on [forge test][forge-test] to at least 3 (`-vvv`) but you can go as high as 5 (`-vvvvv`) for even more traces. You can learn more about traces in our [Understanding Traces][traces] chapter. ### How do I use `console.log`? To use Hardhat's `console.log` you must add it to your project by copying the file over from [here][console-log].",483
2164,faq.md,"Alternatively, you can use [Forge Std][forge-std] which comes bundled with `console.log`. To use `console.log` from Forge Std, you have to import it: ```solidity import ""forge-std/console.sol""; ``` ### How do I run specific tests? If you want to run only a few tests, you can use `--match-test` to filter test functions, `--match-contract` to filter test contracts, and `--match-path` to filter test files on [`forge test`][forge-test]. ### How do I use a specific Solidity compiler? Forge will try to auto-detect what Solidity compiler works for your project. To use a specific Solidity compiler, you can set [`solc`][config-solc] in your [config file][config], or pass `--use solc:<version>` to a Forge command that supports it (e.g. [`forge build`][forge-build] or [`forge test`][forge-test]). Paths to a solc binary are also accepted. To use a specific local solc binary, you can set `solc = ""<path to solc>""` in your config file, or pass `--use ""<path to solc>""`. The solc version/path can also be set via the env variable `FOUNDRY_SOLC=<version/path>`, but the cli arg `--use` has priority. For example, if you have a project that supports all 0.7.x Solidity versions, but you want to compile with solc 0.7.0, you could use `forge build --use solc:0.7.0`. ### How do I fork from a live network? To fork from a live network, pass `--fork-url <URL>` to [`forge test`][forge-test]. You can also fork from a specific block using `--fork-block-number <BLOCK>`, which adds determinism to your test, and allows Forge to cache the chain data for that block. For example, to fork from Ethereum mainnet at block 10,000,000 you could use: `forge test --fork-url $MAINNET_RPC_URL --fork-block-number 10000000`. ### How do I add my own assertions? You can add your own assertions by creating your own base test contract and having that inherit from the test framework of your choice.",489
2165,faq.md,"For example, if you use DSTest, you could create a base test contract like this: ```solidity contract TestBase is DSTest {  function myCustomAssertion(uint a, uint b) {  if (a != b) {   emit log_string(""a and b did not match"");   fail();  }  } } ``` You would then inherit from `TestBase` in your test contracts. ```solidity contract MyContractTest is TestBase {  function testSomething() {   // ...  } } ``` Similarly, if you use [Forge Std][forge-std], you can create a base test contract that inherits from `Test`. For a good example of a base test contract that has helper methods and custom assertions, see [Solmate's `DSTestPlus`][dstestplus]. ### How do I use Forge offline? Forge will sometimes check for newer Solidity versions that fit your project. To use Forge offline, use the `--offline` flag. ### I'm getting Solc errors [solc-bin](https://binaries.soliditylang.org/) doesn't offer static builds for apple silicon. Foundry relies on [svm](https://github.com/roynalnaruto/svm-rs) to install native builds for apple silicon. All solc versions are installed under `~/.svm/`. If you encounter solc related errors, such as `SolcError: ...` please to nuke `~/.svm/` and try again, this will trigger a fresh install and usually resolves the issue. If you're on apple silicon, please ensure the [`z3` theorem prover](https://github.com/Z3Prover/z3) is installed: `brew install z3` > **Note**: native apple silicon builds are only available from `0.8.5` upwards. If you need older versions, you must enable apple silicon rosetta to run them. ### Forge fails in JavaScript monorepos (`pnpm`) Managers like `pnpm` use symlinks to manage `node_modules` folders. A common layout may look like: ```text ├── contracts │ ├── contracts │ ├── foundry.toml │ ├── lib │ ├── node_modules │ ├── package.json ├── node_modules │ ├── ...",463
2166,faq.md,"├── package.json ├── pnpm-lock.yaml ├── pnpm-workspace.yaml ``` Where the Foundry workspace is in `./contracts`, but packages in `./contracts/node_modules` are symlinked to `./node_modules`. When running `forge build` in `./contracts/node_modules`, this can lead to an error like: ```console error[6275]: ParserError: Source ""node_modules/@openzeppelin/contracts/utils/cryptography/draft-EIP712.sol"" not found: File outside of allowed directories. The following are allowed: ""<repo>/contracts"", ""<repo>/contracts/contracts"", ""<repo>/contracts/lib"". --> node_modules/@openzeppelin/contracts/token/ERC20/extensions/draft-ERC20Permit.sol:8:1: | 8 | import ""../../../utils/cryptography/draft-EIP712.sol""; ``` This error happens when `solc` was able to resolve symlinked files, but they're outside the Foundry workspace (`./contracts`). Adding `node_modules` to `allow_paths` in `foundry.toml` grants solc access to that directory, and it will be able to read it: ```toml # This translates to `solc --allow-paths ../node_modules` allow_paths = [""../node_modules""] ``` Note that the path is relative to the Foundry workspace. See also [solc allowed-paths](https://docs.soliditylang.org/en/latest/path-resolution.html#allowed-paths) ### I'm getting `Permission denied (os error 13)` If you see an error like ```console Failed to create artifact parent folder ""/.../MyProject/out/IsolationModeMagic.sol"": Permission denied (os error 13) ``` Then there's likely a folder permission issue. Ensure `user` has write access in the project root's folder. It has been [reported](https://github.com/foundry-rs/foundry/issues/3268) that on linux, canonicalizing paths can result in weird paths (`/_1/...`). This can be resolved by nuking the entire project folder and initializing again. ### Connection refused when run `forge build` .",440
2167,indexOOBError.md,"indexOOBError.md. ## `indexOOBError` ### Signature ```solidity stdError.indexOOBError ``` ### Description The internal Solidity error when trying to access an element of an array that is out of bounds. Will not work for empty arrays in external contracts. For those, use `expectRevert` without any arguments.",70
2168,forge-doc.md,"forge-doc.md. ## forge doc ### NAME forge-doc - Generate documentation for Solidity source files. ### SYNOPSIS ``forge doc`` [*options*] ### DESCRIPTION Generates and builds an mdbook from Solidity source files. ### OPTIONS `--root` *path* &nbsp;&nbsp;&nbsp;&nbsp;The project's root path. By default, this is the root directory of the current git repository, or the current working directory. `--out` *path* &nbsp;&nbsp;&nbsp;&nbsp;The output path for the generated mdbook. By default, it is the `docs/` in project root. `--build` &nbsp;&nbsp;&nbsp;&nbsp;Build the `mdbook` from generated files. `--serve` &nbsp;&nbsp;&nbsp;&nbsp;Serve the documentation locally. `--hostname` *hostname* &nbsp;&nbsp;&nbsp;&nbsp;Hostname for serving documentation. Requires `--serve`. `--port` *port* &nbsp;&nbsp;&nbsp;&nbsp;Port for serving documentation. Requires `--serve`. {{#include common-options.md}} ### EXAMPLES 1. Generate documentation.  ```sh  forge doc  ``` 2. Generate and build documentation with specified output directory.  ```sh  forge doc --build --out ./documentation  ``` 3. Generate and serve documentation locally on port 4000.  ```sh  forge doc --serve --port 4000  ``` ### SEE ALSO [Doc config](../config/doc-generator.md) ",314
2169,forge-install.md,"forge-install.md. ## forge install ### NAME forge-install - Install one or more dependencies. ### SYNOPSIS ``forge install`` [*options*] [*deps...*] ### DESCRIPTION Install one or more dependencies. Dependencies are installed as git submodules. If you do not want this behavior, pass `--no-git`. If no arguments are provided, then existing dependencies are installed. Dependencies can be a raw URL (`https://foo.com/dep`), an SSH URL (`git@github.com:owner/repo`), or the path to a GitHub repository (`owner/repo`). Additionally, a ref can be added to the dependency path to install a specific version of a dependency. A ref can be: - A branch: `owner/repo@master` - A tag: `owner/repo@v1.2.3` - A commit: `owner/repo@8e8128` The ref defaults to `master`. You can also choose the name of the folder the dependency will be in. By default, the folder name is the name of the repository. If you want to change the name of the folder, prepend `<folder>=` to the dependency. ### OPTIONS #### Project Options `--root` *path* &nbsp;&nbsp;&nbsp;&nbsp;The project's root path. By default, this is the root directory of the current git repository, or the current working directory. #### VCS Options `--no-commit` &nbsp;&nbsp;&nbsp;&nbsp;Do not create a commit. `--no-git` &nbsp;&nbsp;&nbsp;&nbsp;Install without adding the dependency as a submodule. #### Display Options `-q` `--quiet` &nbsp;&nbsp;&nbsp;&nbsp;Do not print any messages. {{#include common-options.md}} ### EXAMPLES 1. Install a dependency:  ```sh  forge install transmissions11/solmate  ``` 2. Install a specific version of a dependency:  ```sh  forge install transmissions11/solmate@v7  ``` 3. Install multiple dependencies:  ```sh  forge install transmissions11/solmate@v7 OpenZeppelin/openzeppelin-contracts  ``` 4. Install a dependency without creating a submodule:  ```sh  forge install --no-git transmissions11/solmate  ``` 5.",475
2170,cast--max-uint.md,"cast--max-uint.md. ## cast --max-uint ### NAME cast---max-uint - Get the maximum uint256 value. ### SYNOPSIS ``cast --max-uint`` ### DESCRIPTION Get the maximum uint256 value. ### OPTIONS {{#include common-options.md}} ### SEE ALSO [cast](./cast.md), [cast --max-int](./cast--max-int.md) ",80
2171,multi-wallet-options-remote.md,multi-wallet-options-remote.md. #### Wallet Options - Remote `-a` *addresses* `--froms` *addresses* &nbsp;&nbsp;&nbsp;&nbsp;Sign the transaction with the specified accounts on the RPC. &nbsp;&nbsp;&nbsp;&nbsp;Environment: `ETH_FROM`,62
2172,target.md,"target.md. ## `target` ### Signature ```solidity function target(StdStorage storage self, address _target) internal returns (StdStorage storage); ``` ### Description Sets the address of the contract. Default value: `address(0)`",49
2173,wallet-commands.md,wallet-commands.md. ## Wallet Commands - [cast wallet](./cast-wallet.md) - [cast wallet address](./cast-wallet-address.md) - [cast wallet new](./cast-wallet-new.md) - [cast wallet sign](./cast-wallet-sign.md) - [cast wallet vanity](./cast-wallet-vanity.md) - [cast wallet verify](./cast-wallet-verify.md) ,87
2174,forge-cache.md,forge-cache.md. ## `forge cache` ### NAME forge-cache - Manage the Foundry cache. ### SYNOPSIS `forge cache` [*options*] *command* [*args*] `forge cache` [*options*] `--version` `forge cache` [*options*] `--help` ### DESCRIPTION This program is a set of tools to manage the Foundry cache. ### COMMANDS [forge cache clean](./forge-cache-clean.md) &nbsp;&nbsp;&nbsp;&nbsp;Cleans cached data from ``~/.foundry``. [forge cache ls](./forge-cache-ls.md) &nbsp;&nbsp;&nbsp;&nbsp;Shows cached data from ``~/.foundry``. ### OPTIONS #### Special Options `-V` `--version` &nbsp;&nbsp;&nbsp;&nbsp;Print version info and exit. {{#include common-options.md}},179
2175,cast-chain-id.md,"cast-chain-id.md. ## cast chain-id ### NAME cast-chain-id - Get the Ethereum chain ID. ### SYNOPSIS ``cast chain-id`` [*options*] ### DESCRIPTION Get the Ethereum [chain ID][chain-id] from the RPC endpoint we are connected to. ### OPTIONS #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the chain ID when talking to `$RPC`:  ```sh  cast chain-id --rpc-url $RPC  ``` 2. Get the chain ID when `$ETH_RPC_URL` is set:  ```sh  cast chain-id  ``` ### SEE ALSO [cast](./cast.md), [cast chain](./cast-chain.md) [chain-id]: https://chainlist.org/ ",162
2176,forge-debug.md,"forge-debug.md. ## forge debug ### NAME forge-debug - Debug a single smart contract as a script. ### SYNOPSIS ``forge debug`` [*options*] *path* [*args...*] ### DESCRIPTION Debugs a single smart contract located in the source file (*path*) as a script. If multiple contracts are in the specified source file, you must pass `--target-contract` to specify what contract you want to run. #### Calls After the script is deployed to the internal EVM a call is made to a function with the signature `setUp()`, if present. By default, the script is assumed to be contained in a function with the signature `run()`. If you wish to run a different function, pass `--sig <SIGNATURE>`. The signature can be a fragment (`<function name>(<types>)`), or raw calldata. If you pass a fragment, and the function has parameters, you can add the call parameters to the end of the command (*args*). #### Forking It is possible to run the script in a forked environment by passing `--fork-url <URL>`. When the script is running in a forked environment, you can access all the state of the forked chain as you would if you had deployed the script. [Cheatcodes][cheatcodes] are still available. You can also specify a block number to fork from by passing `--fork-block-number <BLOCK>`. When forking from a specific block, the chain data is cached to `~/.foundry/cache`. If you do not want to cache the chain data, pass `--no-storage-caching`. #### Debugging It is possible to run the script in an interactive debugger. To start the debugger, pass `--debug`. More information on the debugger can be found in the [debugger chapter][debugger]. ### OPTIONS #### Debug Options `--target-contract` *contract_name* &nbsp;&nbsp;&nbsp;&nbsp;The name of the contract you want to run `-s` *signature* `--sig` *signature* &nbsp;&nbsp;&nbsp;&nbsp;The signature of the function you want to call in the contract, or raw calldata. Default: `run()` `--debug` &nbsp;&nbsp;&nbsp;&nbsp;Open the script in the [debugger][debugger].",481
2177,deal.md,"deal.md. ## `deal` ### Signature ```solidity function deal(address who, uint256 newBalance) external; ``` ```solidity function deal(address token, address to, uint256 give) external; ``` ```solidity function deal(address token, address to, uint256 give, bool adjust) external; ``` ### Description Sets the balance of an address `who` to `newBalance`. If the alternative signature of `deal` is used, then we can additionaly specify ERC20 token address, as well as an option to update `totalSupply`. ### Examples ```solidity address alice = address(1); vm.deal(alice, 1 ether); log_uint256(alice.balance); // 1000000000000000000 ``` ```solidity address alice = address(1); deal(address(DAI), alice, 1 ether); // import StdUtils.sol first log_uint256(address(DAI).balanceOf(alice); // 1000000000000000000 ``` ### SEE ALSO Forge Standard Library [`deal`](../reference/forge-std/deal.md), [`hoax`](../reference/forge-std/hoax.md), [`startHoax`](../reference/forge-std/startHoax.md) ",252
2178,cast--min-int.md,"cast--min-int.md. ## cast --min-int ### NAME cast---min-int - Get the minimum i256 value. ### SYNOPSIS ``cast --min-int`` ### DESCRIPTION Get the minimum i256 value. ### OPTIONS {{#include common-options.md}} ### SEE ALSO [cast](./cast.md), [cast --max-int](./cast--max-int.md) ",76
2179,cast-age.md,"cast-age.md. ## cast age ### NAME cast-age - Get the timestamp of a block. ### SYNOPSIS ``cast age`` [*options*] [*block*] ### DESCRIPTION Get the timestamp of a block. The specified *block* can be a block number, or any of the tags: `earliest`, `finalized`, `safe`, `latest` or `pending`. Default to `latest`. ### OPTIONS #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the timestamp of the latest block:  ```sh  cast age  ``` 2. Get the timestamp of the genesis block:  ```sh  cast age 1  ``` ### SEE ALSO [cast](./cast.md), [cast block](./cast-block.md), [cast basefee](./cast-basefee.md) ",180
2180,forge-test.md,"forge-test.md. ## forge test ### NAME forge-test - Run the project's tests. ### SYNOPSIS ``forge test`` [*options*] ### DESCRIPTION Run the project's tests. #### Forking It is possible to run the tests in a forked environment by passing `--fork-url <URL>`. When the tests are running in a forked environment, you can access all the state of the forked chain as you would if you had deployed the contracts. [Cheatcodes][cheatcodes] are still available. You can also specify a block number to fork from by passing `--fork-block-number <BLOCK>`. When forking from a specific block, the chain data is cached to `~/.foundry/cache`. If you do not want to cache the chain data, pass `--no-storage-caching`. Traces that cannot be decoded by local contracts when running in a forked environment (e.g. calls to contracts that live on mainnet, like tokens) can optionally be decoded using Etherscan. To use Etherscan for trace decoding, set `ETHERSCAN_API_KEY` or pass `--etherscan-api-key <KEY>`. #### Debugging It is possible to run a test in an interactive debugger. To start the debugger, pass `--debug <TEST>`. If multiple tests match the specified pattern, you must use other test filters in order to reduce the matching number of tests to exactly 1. If the test is a unit test, it is immediately opened in the debugger. If the test is a fuzz test, the fuzz test is run and the debugger is opened on the first failing scenario. If there are no failing scenarios for the fuzz test, the debugger is opened on the last scenario. More information on the debugger can be found in the [debugger chapter][debugger]. #### Gas reports You can generate a gas report by passing `--gas-report`. More information on gas reports can be found in the [gas reports chapter][gas-reports]. #### List It is possible to list the tests without running them. You can pass `--json` to make it easier for outside extensions to parse structured content.",439
2181,accesses.md,"accesses.md. ## `accesses` ### Signature ```solidity function accesses( address ) external returns ( bytes32[] memory reads, bytes32[] memory writes ); ``` ### Description Gets all storage slots that have been read (`reads`) or written to (`writes`) on an address. Note that [`record`](./record.md) must be called first. > ℹ️ **Note** > > Every write also counts as an additional read. ### Examples ```solidity /// contract NumsContract { ///  uint256 public num1 = 100; // slot 0 ///  uint256 public num2 = 200; // slot 1 /// } vm.record(); numsContract.num2(); (bytes32[] memory reads, bytes32[] memory writes) = vm.accesses( address(numsContract) ); emit log_uint(uint256(reads[0])); // 1 ``` ",179
2182,make-persistent.md,"make-persistent.md. ## `makePersistent` ### Signature ```solidity function makePersistent(address account) external; function makePersistent(address account0, address account1) external; function makePersistent(address account0, address account1, address account2) external; function makePersistent(address[] calldata accounts) external; ``` ### Description Each fork ([`createFork`](./create-fork.md)) has its own independent storage, which is also replaced when another fork is selected ([`selectFork`](./select-fork.md)). By default, only the test contract account and the caller are persistent across forks, which means that changes to the state of the test contract (variables) are preserved when different forks are selected. This way data can be shared by storing it in the contract's variables. However, with this cheatcode, it is possible to mark the specified accounts as persistent, which means that their state is available regardless of which fork is currently active. ### Examples Mark a new contract as persistent ```solidity contract SimpleStorageContract {  string public value;  function set(uint256 _value) public {   value = _value;  } } function testMarkPersistent() public {  // by default the `sender` and the contract itself are persistent  assert(cheats.isPersistent(msg.sender));  assert(cheats.isPersistent(address(this)));  // select a specific fork  cheats.selectFork(mainnetFork);   // create a new contract that's stored in the `mainnetFork` storage  SimpleStorageContract simple = new SimpleStorageContract();   // `simple` is not marked as persistent  assert(!cheats.isPersistent(address(simple)));   // contract can be used  uint256 expectedValue = 99;  simple.set(expectedValue);  assertEq(simple.value(), expectedValue);   // mark as persistent  cheats.makePersistent(address(simple));   // select a different fork  cheats.selectFork(optimismFork);   // ensure contract is still persistent  assert(cheats.isPersistent(address(simple)));   // value is set as expected  assertEq(simple.value(), expectedValue); } ``` ### SEE ALSO - [isPersistent](./is-persistent.md) - [revokePersistent](./revoke-persistent.md) - [createFork](./create-fork.md) - [selectFork](./select-fork.md) ",491
2183,cast-estimate.md,"cast-estimate.md. ## cast estimate ### NAME cast-estimate - Estimate the gas cost of a transaction. ### SYNOPSIS ``cast estimate`` [*options*] *to* *sig* [*args...*] ### DESCRIPTION Estimate the gas cost of a transaction. The destination (*to*) can be an ENS name or an address. {{#include sig-description.md}} ### OPTIONS #### Transaction Options {{#include ../common/tx-value-option.md}} {{#include ../common/rpc-options.md}} {{#include ../common/etherscan-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Estimate the gas cost of calling `deposit()` on the WETH contract:  ```sh  cast estimate 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2 \  --value 0.1ether ""deposit()""  ``` ### SEE ALSO [cast](./cast.md), [cast send](./cast-send.md), [cast publish](./cast-publish.md), [cast receipt](./cast-receipt.md) ",230
2184,env-bytes32.md,"env-bytes32.md. ## `envBytes32` ### Signature ```solidity function envBytes32(string calldata key) external returns (bytes32 value); ``` ```solidity function envBytes32(string calldata key, string calldata delimiter) external returns (bytes32[] memory values); ``` ### Description Read an environment variable as `bytes32` or `address[]`. ### Tips - For arrays, you can specify the delimiter used to seperate the values with the `delimiter` parameter. ### Examples #### Single Value With environment variable `BYTES32_VALUE=0x00`, ```solidity string memory key = ""BYTES32_VALUE""; bytes32 expected = bytes32(0x0000000000000000000000000000000000000000000000000000000000000000); bytes32 output = cheats.envBytes32(key); assert(output == expected); ``` #### Array With environment variable `BYTES32_VALUES=0x7109709ECfa91a80626fF3989D68f67F5b1DD12D,0x00`, ```solidity string memory key = ""BYTES32_VALUES""; string memory delimiter = "",""; bytes32[2] memory expected = [  bytes32(0x7109709ECfa91a80626fF3989D68f67F5b1DD12D000000000000000000000000),  bytes32(0x0000000000000000000000000000000000000000000000000000000000000000) ]; bytes32[] memory output = cheats.envBytes32(key, delimiter); assert(keccak256(abi.encodePacked((output))) == keccak256(abi.encodePacked((expected)))); ``` ",356
2185,allow-cheatcodes.md,"allow-cheatcodes.md. ## `allowCheatcodes` ### Signature ```solidity function allowCheatcodes(address) external; ``` ### Description In forking mode, explicitly grant the given address cheatcode access. By default, the test contract, and its deployer are allowed to access cheatcodes. In addition to that, cheat code access is granted if the contract was deployed by an address that already has cheatcode access. This will prevent cheatcode access from accounts already deployed on the forked network. > ℹ️ **Note** > > This is only useful for more complex test setups in forking mode. ",127
2186,label.md,"label.md. ## `label` ### Signature ```solidity function label(address addr, string calldata label) external; ``` ### Description Sets a label `label` for `addr` in test traces. If an address is labelled, the label will show up in test traces instead of the address. ",61
2187,retry-options.md,retry-options.md. `--delay` *delay* &nbsp;&nbsp;&nbsp;&nbsp;Optional timeout to apply in between attempts in seconds. Defaults to 3. `--retries` *retries* &nbsp;&nbsp;&nbsp;&nbsp;Number of attempts for retrying. Defaults to 15. ,66
2188,ref_forge_utility-commands.md,ref_forge_utility-commands.md. ## Utility Commands - [forge debug](./forge-debug.md) - [forge bind](./forge-bind.md) - [forge cache](./forge-cache.md) - [forge cache clean](./forge-cache-clean.md) - [forge cache ls](./forge-cache-ls.md) - [forge script](./forge-script.md) - [forge upload-selectors](./forge-upload-selectors.md) - [forge doc](./forge-doc.md) ,102
2189,abi-commands.md,abi-commands.md. ## ABI Commands - [cast abi-encode](./cast-abi-encode.md) - [cast 4byte](./cast-4byte.md) - [cast 4byte-decode](./cast-4byte-decode.md) - [cast 4byte-event](./cast-4byte-event.md) - [cast calldata](./cast-calldata.md) - [cast pretty-calldata](./cast-pretty-calldata.md) - [cast --abi-decode](./cast--abi-decode.md) - [cast --calldata-decode](./cast--calldata-decode.md) - [cast upload-signature](./cast-upload-signature.md),146
2190,cast--to-checksum-address.md,cast--to-checksum-address.md. ## cast --to-checksum-address ### NAME cast---to-checksum-address - Convert an addresss to a checksummed format ([EIP-55][eip55]). ### SYNOPSIS ``cast --to-checksum-address`` *address* ### DESCRIPTION Convert an addresss to a checksummed format ([EIP-55][eip55]). ### OPTIONS {{#include common-options.md}} ### SEE ALSO [cast](./cast.md) [eip55]: https://github.com/ethereum/EIPs/blob/master/EIPS/eip-55.md ,121
2191,forge.md,"forge.md. ## forge ### NAME forge - Build, test, fuzz, debug and deploy Solidity contracts. ### SYNOPSIS `forge` [*options*] *command* [*args*] `forge` [*options*] `--version` `forge` [*options*] `--help` ### DESCRIPTION This program is a set of tools to build, test, fuzz, debug and deploy Solidity smart contracts. ### COMMANDS #### General Commands [forge help](./forge-help.md) &nbsp;&nbsp;&nbsp;&nbsp;Display help information about Forge. [forge completions](./forge-completions.md) &nbsp;&nbsp;&nbsp;&nbsp;Generate shell autocompletions for Forge. #### Project Commands [forge init](./forge-init.md) &nbsp;&nbsp;&nbsp;&nbsp;Create a new Forge project. [forge install](./forge-install.md) &nbsp;&nbsp;&nbsp;&nbsp;Install one or multiple dependencies. [forge update](./forge-update.md) &nbsp;&nbsp;&nbsp;&nbsp;Update one or multiple dependencies. [forge remove](./forge-remove.md) &nbsp;&nbsp;&nbsp;&nbsp;Remove one or multiple dependencies. [forge config](./forge-config.md) &nbsp;&nbsp;&nbsp;&nbsp;Display the current config. [forge remappings](./forge-remappings.md) &nbsp;&nbsp;&nbsp;&nbsp;Get the automatically inferred remappings for this project. [forge tree](./forge-tree.md) &nbsp;&nbsp;&nbsp;&nbsp;Display a tree visualization of the project's dependency graph. [forge geiger](./forge-geiger.md) &nbsp;&nbsp;&nbsp;&nbsp;Detects usage of unsafe cheat codes in a foundry project and its dependencies. #### Build Commands [forge build](./forge-build.md) &nbsp;&nbsp;&nbsp;&nbsp;Build the project's smart contracts. [forge clean](./forge-clean.md) &nbsp;&nbsp;&nbsp;&nbsp;Remove the build artifacts and cache directories. [forge inspect](./forge-inspect.md) &nbsp;&nbsp;&nbsp;&nbsp;Get specialized information about a smart contract. #### Test Commands [forge test](./forge-test.md) &nbsp;&nbsp;&nbsp;&nbsp;Run the project's tests. [forge snapshot](./forge-snapshot.md) &nbsp;&nbsp;&nbsp;&nbsp;Create a snapshot of each test's gas usage.",501
2192,forge.md,"#### Deploy Commands [forge create](./forge-create.md) &nbsp;&nbsp;&nbsp;&nbsp;Deploy a smart contract. [forge verify-contract](./forge-verify-contract.md) &nbsp;&nbsp;&nbsp;&nbsp;Verify smart contracts on Etherscan. [forge verify-check](./forge-verify-check.md) &nbsp;&nbsp;&nbsp;&nbsp;Check verification status on Etherscan. [forge flatten](./forge-flatten.md) &nbsp;&nbsp;&nbsp;&nbsp;Flatten a source file and all of its imports into one file. #### Utility Commands [forge debug](./forge-debug.md) &nbsp;&nbsp;&nbsp;&nbsp;Debug a single smart contract as a script. [forge bind](./forge-bind.md) &nbsp;&nbsp;&nbsp;&nbsp;Generate Rust bindings for smart contracts. [forge cache](./forge-cache.md) &nbsp;&nbsp;&nbsp;&nbsp;Manage the Foundry cache. [forge cache clean](./forge-cache-clean.md) &nbsp;&nbsp;&nbsp;&nbsp;Cleans cached data from ``~/.foundry``. [forge cache ls](./forge-cache-ls.md) &nbsp;&nbsp;&nbsp;&nbsp;Shows cached data from ``~/.foundry``. [forge script](./forge-script.md) &nbsp;&nbsp;&nbsp;&nbsp;Run a smart contract as a script, building transactions that can be sent onchain. [forge upload-selectors](./forge-upload-selectors.md) &nbsp;&nbsp;&nbsp;&nbsp;Uploads abi of given contract to https://sig.eth.samczsun.com function selector database. [forge doc](./forge-doc.md) &nbsp;&nbsp;&nbsp;&nbsp;Generate documentation for Solidity source files. ### OPTIONS #### Special Options `-V` `--version` &nbsp;&nbsp;&nbsp;&nbsp;Print version info and exit. {{#include common-options.md}} ### FILES `~/.foundry/` &nbsp;&nbsp;&nbsp;&nbsp;Default location for Foundry's ""home"" directory where it stores various files. `~/.foundry/bin/` &nbsp;&nbsp;&nbsp;&nbsp;Binaries installed using `foundryup` will be located here. `~/.foundry/cache/` &nbsp;&nbsp;&nbsp;&nbsp;Forge's cache directory, where it stores cached block data and more.",494
2193,popError.md,popError.md. ## `popError` ### Signature ```solidity stdError.popError ``` ### Description The internal Solidity error when trying to pop an element off of an empty array.,38
2194,multi-wallet-options-raw.md,multi-wallet-options-raw.md. #### Wallet Options - Raw `-i` `--interactives` *num* &nbsp;&nbsp;&nbsp;&nbsp;Open an interactive prompt to enter your private key. Takes a value for the number of keys to enter. &nbsp;&nbsp;&nbsp;&nbsp;Default: 0 `--mnemonic-indexes` *indexes* &nbsp;&nbsp;&nbsp;&nbsp;Use the private key from the given mnemonic index. Used with --mnemonic-path. &nbsp;&nbsp;&nbsp;&nbsp;Default: 0 `--mnemonic-paths` *paths* &nbsp;&nbsp;&nbsp;&nbsp;Use the mnemonic file at the specified path(s). `--private-key` *raw_private_key* &nbsp;&nbsp;&nbsp;&nbsp;Use the provided private key. `--private-keys` *raw_private_keys* &nbsp;&nbsp;&nbsp;&nbsp;Use the provided private keys.,196
2195,std-assertions.md,std-assertions.md. ## Std Assertions - [`fail`](./fail.md) - [`assertFalse`](./assertFalse.md) - [`assertEq`](./assertEq.md) - [`assertApproxEqAbs`](./assertApproxEqAbs.md) - [`assertApproxEqRel`](./assertApproxEqRel.md),67
2196,working-on-an-existing-project.md,"working-on-an-existing-project.md. ## Working on an Existing Project If you download an existing project that uses Foundry, it is really easy to get going. First, get the project from somewhere. In this example, we will clone the `femplate` repository from GitHub: ```sh $ git clone https://github.com/abigger87/femplate $ cd femplate $ forge install ``` We run [`forge install`](../reference/forge/forge-install.md) to install the submodule dependencies that are in the project. To build, use [`forge build`](../reference/forge/forge-build.md): ```sh {{#include ../output/femplate/forge-build:all}} ``` And to test, use [`forge test`](../reference/forge/forge-test.md): ```sh {{#include ../output/femplate/forge-test:all}} ``` ",173
2197,cast-send.md,"cast-send.md. ## cast send ### NAME cast-send - Sign and publish a transaction. ### SYNOPSIS ``cast send`` [*options*] *to* [*sig*] [*args...*] ### DESCRIPTION Sign and publish a transaction. The destination (*to*) can be an ENS name or an address. {{#include sig-description.md}} ### OPTIONS {{#include ../common/transaction-options.md}} `--resend` &nbsp;&nbsp;&nbsp;&nbsp;Reuse the latest nonce of the sending account. `--create` *code* [*sig* *args...*] &nbsp;&nbsp;&nbsp;&nbsp;Deploy a contract by specifying raw bytecode, in place of specifying a *to* address. #### Receipt Options `--async` `--cast-async` &nbsp;&nbsp;&nbsp;&nbsp;Do not wait for the transaction receipt if it does not exist yet. &nbsp;&nbsp;&nbsp;&nbsp;Environment: `CAST_ASYNC` `-c` *confirmations* `--confirmations` *confirmations* &nbsp;&nbsp;&nbsp;&nbsp;Wait a number of confirmations before exiting. Default: `1`. {{#include ../common/wallet-options.md}} {{#include ../common/rpc-options.md}} {{#include ../common/etherscan-options.md}} {{#include ../common/display-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Send some ether to Vitalik using your Ledger:  ```sh  cast send --ledger vitalik.eth --value 0.1ether  ``` 2. Call `deposit(address token, uint256 amount)` on a contract:  ```sh  cast send --ledger 0x... ""deposit(address,uint256)"" 0x... 1  ``` 3. Call a function that expects a `struct`:  ```solidity  contract Test {   struct MyStruct {    address addr;    uint256 amount;   }   function myfunction(MyStruct memory t) public pure {}  }  ```  Structs are encoded as tuples (see [struct encoding](../../misc/struct-encoding.md))  ```sh  cast send 0x...",448
2198,forge-remappings.md,"forge-remappings.md. ## forge remappings ### NAME forge-remappings - Get the automatically inferred remappings for the project. ### SYNOPSIS ``forge remappings`` [*options*] ### DESCRIPTION Get the automatically inferred remappings for the project. ### OPTIONS #### Project Options `--root` *path* &nbsp;&nbsp;&nbsp;&nbsp;The project's root path. By default, this is the root directory of the current git repository, or the current working directory. `--lib-path` *path* &nbsp;&nbsp;&nbsp;&nbsp;The path to the library folder. {{#include common-options.md}} ### EXAMPLES 1. Create a `remappings.txt` file from the inferred remappings:  ```sh  forge remappings > remappings.txt  ``` ### SEE ALSO [forge](./forge.md) ",173
2199,compute-create-address.md,"compute-create-address.md. ## `computeCreateAddress` ### Signature ```solidity function computeCreateAddress(address deployer, uint256 nonce) internal pure returns (address) ``` ### Description Compute the address a contract will be deployed at for a given deployer address and nonce. Useful to precalculate the address a contract **will** be deployed at. ### Example ```solidity address governanceAddress = computeCreateAddress(0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266, 1); // this contract requires a governance contract which hasn't been deployed yet Contract contract = new Contract(governanceAddress); // now we deploy it Governance governance = new Governance(contract); // assuming `contract` has a `governance()` accessor assertEq(governanceAddress, address(governance)); // [PASS] ``` ",178
2200,stop-prank.md,"stop-prank.md. ## `stopPrank` ### Signature ```solidity function stopPrank() external; ``` ### Description Stops an active prank started by [`startPrank`](./start-prank.md), resetting `msg.sender` and `tx.origin` to the values before `startPrank` was called. ",66
2201,memOverflowError.md,memOverflowError.md. ## `memOverflowError` ### Signature ```solidity stdError.memOverflowError ``` ### Description The internal Solidity error when trying to allocate a dynamic memory array with more than 2^64-1 items.,48
2202,with_key.md,"with_key.md. ## `with_key` ### Signature ```solidity function with_key(StdStorage storage self, address who) internal returns (StdStorage storage); ``` ```solidity function with_key(StdStorage storage self, uint256 amt) internal returns (StdStorage storage); ``` ```solidity function with_key(StdStorage storage self, bytes32 key) internal returns (StdStorage storage); ``` ### Description Passes an argument to the function. Can be used multiple times to pass multiple arguments. The order matters. ### Examples ```solidity uint256 slot = stdstore  .target(addr)  .sig(""fun(uint256,address)"")  .with_key(1)  .with_key(address(this))  .find(); ``` ",151
2203,cast_README.md,"cast_README.md. ## Overview of Cast Cast is Foundry's command-line tool for performing Ethereum RPC calls. You can make smart contract calls, send transactions, or retrieve any type of chain data - all from your command-line! ### How to use Cast To use Cast, run the [`cast`](../reference/cast/cast.md) command followed by a subcommand: ```bash $ cast <subcommand> ``` #### Examples Let's use `cast` to retrieve the total supply of the DAI token: ```bash {{#include ../output/cast/cast-call:all}} ``` `cast` also provides many convenient subcommands, such as for decoding calldata: ```bash {{#include ../output/cast/cast-4byte-decode:all}} ``` You can also use `cast` to send arbitrary messages. Here's an example of sending a message between two Anvil accounts. ```bash $ cast send --private-key <Your Private Key> 0x3c44cdddb6a900fa2b585dd299e03d12fa4293bc $(cast --from-utf8 ""hello world"") --rpc-url http://127.0.0.1:8545/ ``` <br> > 📚 **Reference** > > See the [`cast` Reference](../reference/cast/) for a complete overview of all the available subcommands. ",286
2204,project-commands.md,project-commands.md. ## Project Commands - [forge init](./forge-init.md) - [forge install](./forge-install.md) - [forge update](./forge-update.md) - [forge remove](./forge-remove.md) - [forge config](./forge-config.md) - [forge remappings](./forge-remappings.md) - [forge tree](./forge-tree.md) - [forge geiger](./forge-geiger.md) ,95
2205,fuzzer.md,fuzzer.md. ## Fuzzer - [`assume`](./assume.md) ,16
2206,start-prank.md,"start-prank.md. ## `startPrank` ### Signature ```solidity function startPrank(address) external; ``` ```solidity function startPrank(address sender, address origin) external; ``` ### Description Sets `msg.sender` **for all subsequent calls** until [`stopPrank`](./stop-prank.md) is called. If the alternative signature of `startPrank` is used, then `tx.origin` is set as well for all subsequent calls. ### SEE ALSO Forge Standard Library [`startHoax`](../reference/forge-std/startHoax.md), [`changePrank`](../reference/forge-std/change-prank.md) ",135
2207,skip.md,"skip.md. ## `skip` ### Signature ```solidity function skip(uint256 time) public; ``` ### Description Skips forward `block.timestamp` by the specified number of seconds. ### Examples ```solidity assertEq(block.timestamp, 0); skip(3600); assertEq(block.timestamp, 3600); ``` ",66
2208,cast-run.md,"cast-run.md. ## cast run ### NAME cast-run - Runs a published transaction in a local environment and prints the trace. ### SYNOPSIS ``cast run`` [*options*] `--rpc-url` *url* *tx_hash* ### DESCRIPTION Runs a published transaction in a local environment and prints the trace. By default, all transactions in the block prior to the transaction you want to replay are also replayed. If you want a quicker result, you can use `--quick`, however, results may differ from the live execution. You can also open the transaction in a debugger by passing `--debug`. ### OPTIONS #### Run Options `--label` *label* &nbsp;&nbsp;&nbsp;&nbsp;Labels an address in the trace. &nbsp;&nbsp;&nbsp;&nbsp;The format is `<address>:<label>`. Can be passed multiple times. `-q` `--quick` &nbsp;&nbsp;&nbsp;&nbsp;Executes the transaction only with the state from the previous block. &nbsp;&nbsp;&nbsp;&nbsp;May result in different results than the live execution! `-v` `--verbose` &nbsp;&nbsp;&nbsp;&nbsp;Addresses are fully displayed instead of being truncated. `-d` `--debug` &nbsp;&nbsp;&nbsp;&nbsp;Open the script in the [debugger][debugger]. #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### EXAMPLES 1. Replay a transaction (a simple transfer):  ```sh  cast run 0xd15e0237413d7b824b784e1bbc3926e52f4726e5e5af30418803b8b327b4f8ca  ``` 2. Replay a transaction, applied on top of the state of the previous block:  ```sh  cast run --quick \  0xd15e0237413d7b824b784e1bbc3926e52f4726e5e5af30418803b8b327b4f8ca  ``` 3.",435
2209,cast-interface.md,"cast-interface.md. ## cast interface ### NAME cast-interface - Generate a Solidity interface from a given ABI. ### SYNOPSIS ``cast interface`` [*options*] *address_or_path* ### DESCRIPTION Generates a Solidity interface from a given ABI. The argument (*address_or_path*) can either be the path to a file containing an ABI, or an address. If an address is provided, then the interface is generated from the ABI of the account, which is fetched from Etherscan. > ℹ️ **Note** > > This command does not currently support ABI encoder v2. ### OPTIONS #### Interface Options `-n` *name* `--name` *name* &nbsp;&nbsp;&nbsp;&nbsp;The name to use for the generated interface. The default name is `Interface`. `-o` *path* &nbsp;&nbsp;&nbsp;&nbsp;The path to the output file. If not specified, the interface will be output to stdout. `-p` *version* `--pragma` *version* &nbsp;&nbsp;&nbsp;&nbsp;The Solidity pragma version to use in the interface. Default: `^0.8.10`. {{#include ../common/etherscan-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Generate an interface from a file:  ```sh  cast interface ./path/to/abi.json  ``` 2. Generate an interface using Etherscan:  ```sh  cast interface -o IWETH.sol 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2  ``` 3. Generate and name an interface from a file:  ```sh  cast interface -n LilENS ./path/to/abi.json  ``` ### SEE ALSO [cast](./cast.md), [cast proof](./cast-proof.md) ",388
2210,ref_config_README.md,ref_config_README.md. ## Config Reference - [Overview](./overview.md) - [Project](./project.md) - [Solidity Compiler](./solidity-compiler.md) - [Testing](./testing.md) - [In-line test configuration](./inline-test-config.md) - [Formatter](./formatter.md) - [Documentation Generator](./doc-generator.md) - [Etherscan](./etherscan.md) ,90
2211,wallet-options-hardware.md,wallet-options-hardware.md. #### Wallet Options - Hardware Wallet `-t` `--trezor` &nbsp;&nbsp;&nbsp;&nbsp;Use a Trezor hardware wallet. `-l` `--ledger` &nbsp;&nbsp;&nbsp;&nbsp;Use a Ledger hardware wallet. ,61
2212,test-options.md,"test-options.md. #### Test Options `-m` *regex* `--match` *regex* &nbsp;&nbsp;&nbsp;&nbsp;Only run test functions matching the specified regex pattern. &nbsp;&nbsp;&nbsp;&nbsp;**Deprecated: See `--match-test`.** `--match-test` *regex* &nbsp;&nbsp;&nbsp;&nbsp;Only run test functions matching the specified regex pattern. `--no-match-test` *regex* &nbsp;&nbsp;&nbsp;&nbsp;Only run test functions that do not match the specified regex pattern. `--match-contract` *regex* &nbsp;&nbsp;&nbsp;&nbsp;Only run tests in contracts matching the specified regex pattern. `--no-match-contract` *regex* &nbsp;&nbsp;&nbsp;&nbsp;Only run tests in contracts that do not match the specified regex pattern. `--match-path` *glob* &nbsp;&nbsp;&nbsp;&nbsp;Only run tests in source files matching the specified glob pattern. `--no-match-path` *glob* &nbsp;&nbsp;&nbsp;&nbsp;Only run tests in source files that do not match the specified glob pattern. `--debug` *regex* &nbsp;&nbsp;&nbsp;&nbsp;Run a test in the debugger. &nbsp;&nbsp;&nbsp;&nbsp;The argument passed to this flag is the name of the test function you want to run, and it works the same as `--match-test`. &nbsp;&nbsp;&nbsp;&nbsp;If more than one test matches your specified criteria, you must add additional filters until only one test is found (see `--match-contract` and `--match-path`). &nbsp;&nbsp;&nbsp;&nbsp;The matching test will be opened in the debugger regardless of the outcome of the test. &nbsp;&nbsp;&nbsp;&nbsp;If the matching test is a fuzz test, then it will open the debugger on the first failure case. If the fuzz test does not fail, it will open the debugger on the last fuzz case. &nbsp;&nbsp;&nbsp;&nbsp;For more fine-grained control of which fuzz case is run, see [`forge debug`](./forge-debug.md). `--gas-report` &nbsp;&nbsp;&nbsp;&nbsp;Print a gas report. `--allow-failure` &nbsp;&nbsp;&nbsp;&nbsp;Exit with code 0 even if a test fails.",497
2213,ds-test.md,"ds-test.md. ## DSTest Reference Dappsys Test (DSTest for short) provides basic logging and assertion functionality. It is included in the Forge Standard Library. To get access to the functions, import `forge-std/Test.sol` and inherit from `Test` in your test contract: ```solidity import ""forge-std/Test.sol""; contract ContractTest is Test {  // ... tests ... } ``` ### Logging This is a complete overview of all the available logging events. For detailed descriptions and example usage, see below. ```solidity event log     (string); event logs     (bytes); event log_address   (address); event log_bytes32   (bytes32); event log_int    (int); event log_uint    (uint); event log_bytes    (bytes); event log_string    (string); event log_named_address  (string key, address val); event log_named_bytes32  (string key, bytes32 val); event log_named_decimal_int (string key, int val, uint decimals); event log_named_decimal_uint (string key, uint val, uint decimals); event log_named_int   (string key, int val); event log_named_uint   (string key, uint val); event log_named_bytes  (string key, bytes val); event log_named_string  (string key, string val); ``` ### Logging events This section documents all events for logging and provides usage examples.",288
2214,ds-test.md,"#### `log` ```solidity event log(string); ``` ##### Example ```solidity emit log(""here""); // here ``` <br> --- #### logs ```solidity event logs(bytes); ``` ##### Example ```solidity emit logs(bytes(""abcd"")); // 0x6162636400000000000000000000000000000000000000000000000000000000 ``` <br> --- #### log\_\<type\> ```solidity event log_<type>(<type>); ``` Where `<type>` can be `address`, `bytes32`, `int`, `uint`, `bytes`, `string` ##### Example ```solidity uint256 amount = 1 ether; emit log_uint(amount); // 1000000000000000000 ``` <br> --- #### log\_named\_\<type\> ```solidity event log_named_<type>(string key, <type> val); ``` Where `<type>` can be `address`, `bytes32`, `int`, `uint`, `bytes`, `string` ##### Example ```solidity uint256 amount = 1 ether; emit log_named_uint(""Amount"", amount); // amount: 1000000000000000000 ``` <br> --- #### log\_named\_decimal\_\<type\> ```solidity event log_named_decimal_<type>(string key, <type> val, uint decimals); ``` Where `<type>` can be `int`, `uint` ##### Example ```solidity uint256 amount = 1 ether; emit log_named_decimal_uint(""Amount"", amount, 18); // amount: 1.000000000000000000 ``` ### Asserting This is a complete overview of all the available assertion functions. For detailed descriptions and example usage, see below.",357
2215,ds-test.md,"#### `assertTrue` ```solidity function assertTrue(bool condition) internal; ``` Asserts the `condition` is true. ##### Example ```solidity bool success = contract.fun(); assertTrue(success); ``` <br> --- #### `assertEq` ```solidity function assertEq(<type> a, <type> b) internal; ``` Where `<type>` can be `address`, `bytes32`, `int`, `uint` Asserts `a` is equal to `b`. ##### Example ```solidity uint256 a = 1 ether; uint256 b = 1e18 wei; assertEq(a, b); ``` <br> --- #### `assertEqDecimal` ```solidity function assertEqDecimal(<type> a, <type> b, uint decimals) internal; ``` Where `<type>` can be `int`, `uint` Asserts `a` is equal to `b`. ##### Example ```solidity uint256 a = 1 ether; uint256 b = 1e18 wei; assertEqDecimal(a, b, 18); ``` <br> --- #### `assertEq32` ```solidity function assertEq32(bytes32 a, bytes32 b) internal; ``` Asserts `a` is equal to `b`. ##### Example ```solidity assertEq(bytes32(""abcd""), 0x6162636400000000000000000000000000000000000000000000000000000000); ``` <br> --- #### `assertEq0` ```solidity function assertEq0(bytes a, bytes b) internal; ``` Asserts `a` is equal to `b`. ##### Example ```solidity string memory name1 = ""Alice""; string memory name2 = ""Bob""; assertEq0(bytes(name1), bytes(name2)); // [FAIL] ``` <br> --- #### `assertGt` ```solidity function assertGt(<type> a, <type> b) internal; ``` Where `<type>` can be `int`, `uint` Asserts `a` is greater than `b`.",422
2216,ds-test.md,"##### Example ```solidity uint256 a = 2 ether; uint256 b = 1e18 wei; assertGt(a, b); ``` <br> --- #### `assertGtDecimal` ```solidity function assertGtDecimal(<type> a, <type> b, uint decimals) internal; ``` Where `<type>` can be `int`, `uint` Asserts `a` is greater than `b`. ##### Example ```solidity uint256 a = 2 ether; uint256 b = 1e18 wei; assertGtDecimal(a, b, 18); ``` <br> --- #### `assertGe` ```solidity function assertGe(<type> a, <type> b) internal; ``` Where `<type>` can be `int`, `uint` Asserts `a` is greater than or equal to `b`. ##### Example ```solidity uint256 a = 1 ether; uint256 b = 1e18 wei; assertGe(a, b); ``` <br> --- #### `assertGeDecimal` ```solidity function assertGeDecimal(<type> a, <type> b, uint decimals) internal; ``` Where `<type>` can be `int`, `uint` Asserts `a` is greater than or equal to `b`. ##### Example ```solidity uint256 a = 1 ether; uint256 b = 1e18 wei; assertGeDecimal(a, b, 18); ``` <br> --- #### `assertLt` ```solidity function assertLt(<type> a, <type> b) internal; ``` Where `<type>` can be `int`, `uint` Asserts `a` is lesser than `b`. ##### Example ```solidity uint256 a = 1 ether; uint256 b = 2e18 wei; assertLt(a, b); ``` <br> --- #### `assertLtDecimal` ```solidity function assertLtDecimal(<type> a, <type> b, uint decimals) internal; ``` Where `<type>` can be `int`, `uint` Asserts `a` is lesser than `b`.",438
2217,advanced-testing.md,"advanced-testing.md. ## Advanced Testing Forge comes with a number of advanced testing methods: - [Fuzz Testing](./fuzz-testing.md) - [Invariant Testing](./invariant-testing.md) - [Differential Testing](./differential-ffi-testing.md) In the future, Forge will also support these: - [Symbolic Execution](#) - [Mutation Testing](#) Each chapter dives into what problem the testing methods solve, and how to apply them to your own project. ",101
2218,forge-help.md,forge-help.md. ## forge help ### NAME forge-help - Get help for a Forge command ### SYNOPSIS ``forge help`` [*subcommand*] ### DESCRIPTION Prints a help message for the given command. ### EXAMPLES 1. Get help for a command:  ```sh  forge help build  ``` 2. Help is also available with the `--help` flag:  ```sh  forge build --help  ``` ### SEE ALSO [forge](./forge.md) ,98
2219,cast-wallet-new.md,"cast-wallet-new.md. ## cast wallet new ### NAME cast-wallet-new - Create a new random keypair. ### SYNOPSIS ``cast wallet new`` [*options*] [*path*] ### DESCRIPTION Create a new random keypair. If *path* is specified, then the new keypair will be written to a JSON keystore encrypted with a password. (*path* should be an existing directory.) ### OPTIONS #### Keystore Options `-p` `--password` &nbsp;&nbsp;&nbsp;&nbsp;Triggers a hidden password prompt for the JSON keystore. &nbsp;&nbsp;&nbsp;&nbsp;**Deprecated: prompting for a hidden password is now the default.** `--unsafe-password` *password* &nbsp;&nbsp;&nbsp;&nbsp;Password for the JSON keystore in cleartext. &nbsp;&nbsp;&nbsp;&nbsp;This is **unsafe** to use and we recommend using `--password` instead. &nbsp;&nbsp;&nbsp;&nbsp;Environment: `CAST_PASSWORD` {{#include common-options.md}} ### EXAMPLES 1. Create a new keypair without saving it to a keystore:  ```sh  cast wallet new  ``` 2. Create a new keypair and save it in the `keystore` directory:  ```sh  cast wallet new keystore  ``` ### SEE ALSO [cast](./cast.md), [cast wallet](./cast-wallet.md) ",295
2220,solmate-nft.md,"solmate-nft.md. ## Creating an NFT with Solmate This tutorial will walk you through creating an OpenSea compatible NFT with Foundry and [Solmate](https://github.com/transmissions11/solmate/blob/main/src/tokens/ERC721.sol). A full implementation of this tutorial can be found [here](https://github.com/FredCoen/nft-tutorial). ##### This tutorial is for illustrative purposes only and provided on an as-is basis. The tutorial is not audited nor fully tested. No code in this tutorial should be used in a production environment. ### Create project and install dependencies Start by setting up a Foundry project following the steps outlined in the [Getting started section](../getting-started/installation.html). We will also install Solmate for their ERC721 implementation, as well as some OpenZeppelin utility libraries. Install the dependencies by running the following commands from the root of your project: ```bash forge install transmissions11/solmate Openzeppelin/openzeppelin-contracts ``` These dependencies will be added as git submodules to your project. If you have followed the instructions correctly your project should be structured like this: ![Project structure](../images/nft-tutorial/nft-tutorial-project-structure.png) ### Implement a basic NFT We are then going to rename the boilerplate contract in `src/Contract.sol` to `src/NFT.sol` and replace the code: ```solidity // SPDX-License-Identifier: UNLICENSED pragma solidity 0.8.10; import ""solmate/tokens/ERC721.sol""; import ""openzeppelin-contracts/contracts/utils/Strings.sol""; contract NFT is ERC721 {  uint256 public currentTokenId;  constructor(   string memory _name,   string memory _symbol  ) ERC721(_name, _symbol) {}  function mintTo(address recipient) public payable returns (uint256) {   uint256 newItemId = ++currentTokenId;   _safeMint(recipient, newItemId);   return newItemId;  }  function tokenURI(uint256 id) public view virtual override returns (string memory) {   return Strings.toString(id);  } } ``` Let's take a look at this very basic implementation of an NFT. We start by importing two contracts from our git submodules. We import solmate's gas optimized implementation of the ERC721 standard which our NFT contract will inherit from.",496
2221,solmate-nft.md,"Our constructor takes the `_name` and `_symbol` arguments for our NFT and passes them on to the constructor of the parent ERC721 implementation. Lastly we implement the `mintTo` function which allows anyone to mint an NFT. This function increments the `currentTokenId` and makes use of the `_safeMint` function of our parent contract. ### Compile & deploy with forge To compile the NFT contract run `forge build`. You might experience a build failure due to wrong mapping: ```text Error: Compiler run failed error[6275]: ParserError: Source ""lib/openzeppelin-contracts/contracts/contracts/utils/Strings.sol"" not found: File not found. Searched the following locations: ""/PATH/TO/REPO"". --> src/NFT.sol:5:1: | 5 | import ""openzeppelin-contracts/contracts/utils/Strings.sol""; | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ``` this can be fixed by setting up the correct remapping. Create a file `remappings.txt` in your project and add the line ```text openzeppelin-contracts/=lib/openzeppelin-contracts/ ``` (You can find out more on remappings in [the dependencies documentation](../projects/dependencies.md). By default the compiler output will be in the `out` directory. To deploy our compiled contract with Forge we have to set environment variables for the RPC endpoint and the private key we want to use to deploy. Set your environment variables by running: ```bash export RPC_URL=<Your RPC endpoint> export PRIVATE_KEY=<Your wallets private key> ``` Once set, you can deploy your NFT with Forge by running the below command while adding the relevant constructor arguments to the NFT contract: ```bash forge create NFT --rpc-url=$RPC_URL --private-key=$PRIVATE_KEY --constructor-args <name> <symbol> ``` If successfully deployed, you will see the deploying wallet's address, the contract's address as well as the transaction hash printed to your terminal. ### Minting NFTs from your contract Calling functions on your NFT contract is made simple with Cast, Foundry's command-line tool for interacting with smart contracts, sending transactions, and getting chain data. Let's have a look at how we can use it to mint NFTs from our NFT contract.",484
2222,solmate-nft.md,"Given that you already set your RPC and private key env variables during deployment, mint an NFT from your contract by running: ```bash cast send --rpc-url=$RPC_URL <contractAddress> ""mintTo(address)"" <arg> --private-key=$PRIVATE_KEY ``` Well done! You just minted your first NFT from your contract. You can sanity check the owner of the NFT with `currentTokenId` equal to **1** by running the below `cast call` command. The address you provided above should be returned as the owner. ```bash cast call --rpc-url=$RPC_URL --private-key=$PRIVATE_KEY <contractAddress> ""ownerOf(uint256)"" 1 ``` ### Extending our NFT contract functionality and testing Let's extend our NFT by adding metadata to represent the content of our NFTs, as well as set a minting price, a maximum supply and the possibility to withdraw the collected proceeds from minting.",194
2223,solmate-nft.md,"To follow along you can replace your current NFT contract with the code snippet below: ```solidity // SPDX-License-Identifier: UNLICENSED pragma solidity >=0.8.10; import ""solmate/tokens/ERC721.sol""; import ""openzeppelin-contracts/contracts/utils/Strings.sol""; import ""openzeppelin-contracts/contracts/access/Ownable.sol""; error MintPriceNotPaid(); error MaxSupply(); error NonExistentTokenURI(); error WithdrawTransfer(); contract NFT is ERC721, Ownable {  using Strings for uint256;  string public baseURI;  uint256 public currentTokenId;  uint256 public constant TOTAL_SUPPLY = 10_000;  uint256 public constant MINT_PRICE = 0.08 ether;  constructor(   string memory _name,   string memory _symbol,   string memory _baseURI  ) ERC721(_name, _symbol) {   baseURI = _baseURI;  }  function mintTo(address recipient) public payable returns (uint256) {   if (msg.value != MINT_PRICE) {    revert MintPriceNotPaid();   }   uint256 newTokenId = ++currentTokenId;   if (newTokenId > TOTAL_SUPPLY) {    revert MaxSupply();   }   _safeMint(recipient, newTokenId);   return newTokenId;  }  function tokenURI(uint256 tokenId)   public   view   virtual   override   returns (string memory)  {   if (ownerOf(tokenId) == address(0)) {    revert NonExistentTokenURI();   }   return    bytes(baseURI).length > 0     ? string(abi.encodePacked(baseURI, tokenId.toString()))     : """";  }  function withdrawPayments(address payable payee) external onlyOwner {   uint256 balance = address(this).balance;   (bool transferTx, ) = payee.call{value: balance}("""");   if (!transferTx) {    revert WithdrawTransfer();   }  } } ``` Among other things, we have added metadata that can be queried from any front-end application like OpenSea, by calling the `tokenURI` method on our NFT contract.",455
2224,solmate-nft.md,"> **Note**: If you want to provide a real URL to the constructor at deployment, and host the metadata of this NFT contract please follow the steps outlined [here](https://docs.opensea.io/docs/part-3-adding-metadata-and-payments-to-your-contract#intro-to-nft-metadata). Let's test some of this added functionality to make sure it works as intended. Foundry offers an extremely fast EVM native testing framework through Forge. Within your test folder rename the current `Contract.t.sol` test file to `NFT.t.sol`. This file will contain all tests regarding the NFT's `mintTo` method.",131
2225,solmate-nft.md,"As you can see, Forge offers a number of [cheatcodes](../cheatcodes/) to manipulate state to accommodate your testing scenario. For example, our `testFailMaxSupplyReached` test checks that an attempt to mint fails when the max supply of NFT is reached. Thus, the `currentTokenId` of the NFT contract needs to be set to the max supply by using the store cheatcode which allows you to write data to your contracts storage slots. The storage slots you wish to write to can easily be found using the [`forge-std`](https://github.com/foundry-rs/forge-std/) helper library. You can run the test with the following command: ```bash forge test ``` If you want to put your Forge skills to practice, write tests for the remaining methods of our NFT contract. Feel free to PR them to [nft-tutorial](https://github.com/FredCoen/nft-tutorial), where you will find the full implementation of this tutorial. ### Gas reports for your function calls Foundry provides comprehensive gas reports about your contracts. For every function called within your tests, it returns the minimum, average, median and max gas cost. To print the gas report simply run: ```bash forge test --gas-report ``` This comes in handy when looking at various gas optimizations within your contracts. Let's have a look at the gas savings we made by substituting OpenZeppelin with Solmate for our ERC721 implementation. You can find the NFT implementation using both libraries [here](https://github.com/FredCoen/nft-tutorial). Below are the resulting gas reports when running `forge test --gas-report` on that repository. As you can see, our implementation using Solmate saves around 500 gas on a successful mint (the max gas cost of the `mintTo` function calls). ![Gas report solmate NFT](../images/nft-tutorial/gas-report-solmate-nft.png) ![Gas report OZ NFT](../images/nft-tutorial/gas-report-oz-nft.png) That's it, I hope this will give you a good practical basis of how to get started with foundry. We think there is no better way to deeply understand solidity than writing your tests in solidity. You will also experience less context switching between javascript and solidity.",479
2226,cast-calldata.md,"cast-calldata.md. ## cast calldata ### NAME cast-calldata - ABI-encode a function with arguments. ### SYNOPSIS ``cast calldata`` [*options*] *sig* [*args...*] ### DESCRIPTION ABI-encode a function with arguments. The signature (*sig*) is a fragment in the form `<function name>(<types...>)`. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. ABI-encode the arguments for a call to `someFunc(address,uint256)`:  ```sh  cast calldata ""someFunc(address,uint256)"" 0x... 1  ``` ### SEE ALSO [cast](./cast.md), [cast abi-encode](./cast-abi-encode.md) ",152
2227,cast-call.md,"cast-call.md. ## cast call ### NAME cast-call - Perform a call on an account without publishing a transaction. ### SYNOPSIS ``cast call`` [*options*] *to* *sig* [*args...*] ### DESCRIPTION Perform a call on an account without publishing a transaction. The destination (*to*) can be an ENS name or an address. {{#include sig-description.md}} ### OPTIONS #### Query Options `-B` *block* `--block` *block* &nbsp;&nbsp;&nbsp;&nbsp;The block height you want to query at. &nbsp;&nbsp;&nbsp;&nbsp;Can be a block number, or any of the tags: `earliest`, `finalized`, `safe`, `latest` or `pending`. {{#include ../common/wallet-options.md}} {{#include ../common/rpc-options.md}} {{#include ../common/etherscan-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Call `balanceOf(address)` on the WETH contract:  ```sh  cast call 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2 \  ""balanceOf(address)(uint256)"" 0x...  ``` 2. Call `tokenURI(uint256)(string)` on the Tubby Cats NFT contract:  ```sh  export CONTRACT=0xca7ca7bcc765f77339be2d648ba53ce9c8a262bd  export TOKEN_ID=19938  cast call $CONTRACT ""tokenURI(uint256)(string)"" $TOKEN_ID ``` 3. Call ``getAmountsOut(uint,address[])`` on the Uniswap v2 router contract:  ```sh cast call 0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D \  ""getAmountsOut(uint,address[])"" 1 ""[0x6b...0f,0xc0...c2]""  ``` ### SEE ALSO [cast](./cast.md), [cast send](./cast-send.md), [cast publish](./cast-publish.md), [cast receipt](./cast-receipt.md) ",467
2228,etherscan.md,"etherscan.md. ## Etherscan Configuration related to Etherscan, such as API keys. This configuration is used in various places by Forge. The `[etherscan]` section is a mapping of keys to Etherscan configuration tables. The Etherscan configuration tables hold the following keys: - `key` (string) (**required**): The Etherscan API key for the given network. The value of this property can also point to an environment variable. - `chain`: The chain name or ID of the chain this Etherscan configuration is for. - `url`: The Etherscan API URL. If the key of the configuration is a chain name, then `chain` is not required, otherwise it is. `url` can be used to explicitly set the Etherscan API URL for chains not natively supported by name. Using TOML inline table syntax, all of these are valid: ```toml [etherscan] mainnet = { key = ""${ETHERSCAN_MAINNET_KEY}"" } mainnet2 = { key = ""ABCDEFG"", chain = ""mainnet"" } optimism = { key = ""1234567"" } unknown_chain = { key = ""ABCDEFG"", url = ""<etherscan api url for this chain>"" } ``` ",262
2229,clear-mocked-calls.md,clear-mocked-calls.md. ## `clearMockedCalls` ### Signature ```solidity function clearMockedCalls() external; ``` ### Description Clears all [mocked calls](./mock-call.md). ,43
2230,traces.md,"traces.md. ## Understanding Traces Forge can produce traces either for failing tests (`-vvv`) or all tests (`-vvvv`). Traces follow the same general format: ```ignore [<Gas Usage>] <Contract>::<Function>(<Parameters>)  ├─ [<Gas Usage>] <Contract>::<Function>(<Parameters>)  │ └─ ← <Return Value>  └─ ← <Return Value> ``` Each trace can have many more subtraces, each denoting a call to a contract and a return value. If your terminal supports color, the traces will also come with a variety of colors: - **Green**: For calls that do not revert - **Red**: For reverting calls - **Blue**: For calls to cheat codes - **Cyan**: For emitted logs - **Yellow**: For contract deployments The gas usage (marked in square brackets) is for the entirety of the function call. You may notice, however, that sometimes the gas usage of one trace does not exactly match the gas usage of all its subtraces: ```ignore [24661] OwnerUpOnlyTest::testIncrementAsOwner()  ├─ [2262] OwnerUpOnly::count()  │ └─ ← 0  ├─ [20398] OwnerUpOnly::increment()  │ └─ ← ()  ├─ [262] OwnerUpOnly::count()  │ └─ ← 1  └─ ← () ``` The gas unaccounted for is due to some extra operations happening between calls, such as arithmetic and store reads/writes. Forge will try to decode as many signatures and values as possible, but sometimes this is not possible. In these cases, the traces will appear like so: ```ignore [<Gas Usage>] <Address>::<Calldata>  └─ ← <Return Data> ``` ",380
2231,change-prank.md,change-prank.md. ## `changePrank` ### Signature ```solidity function changePrank(address who) internal; ``` ### Description Stops the active prank with `stopPrank` and passes address to `startPrank`. Useful for starting a global prank in the `setUp` function and deactivating it in certain tests.,68
2232,percentDelta.md,"percentDelta.md. ## `percentDelta` ### Signature ```solidity function percentDelta(uint256 a, uint256 b) internal pure returns (uint256) ``` ```solidity function percentDelta(int256 a, int256 b) internal pure returns (uint256) ``` ### Description Returns the difference between two numbers in percentage, where `1e18` is 100%. More precisely, `percentDelta(a, b)` computes `abs((a-b) / b) * 1e18`. ### Example ```solidity uint256 percent150 = stdMath.percentDelta(uint256(125), 50); uint256 percent60 = stdMath.percentDelta(uint256(50), 125); ``` ",143
2233,cast-storage.md,"cast-storage.md. ## cast storage ### NAME cast-storage - Get the raw value of a contract's storage slot. ### SYNOPSIS ``cast storage`` [*options*] *address* *slot* ### DESCRIPTION Get the raw value of a contract's storage slot. (Slot locations greater than 18446744073709551615 (u64::MAX) should be given as hex. Use `cast index` to compute mapping slots.) The address (*address*) can be an ENS name or an address. ### OPTIONS #### Query Options `-B` *block* `--block` *block* &nbsp;&nbsp;&nbsp;&nbsp;The block height you want to query at. &nbsp;&nbsp;&nbsp;&nbsp;Can be a block number, or any of the tags: `earliest`, `finalized`, `safe`, `latest` or `pending`. #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the value of slot 0 on the WETH contract.  ```sh  cast storage 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2 0  ``` ### SEE ALSO [cast](./cast.md), [cast proof](./cast-proof.md) ",277
2234,expect-call.md,"expect-call.md. ## `expectCall` ```solidity function expectCall(address where, bytes calldata data) external; ``` ```solidity function expectCall(address where, bytes calldata data, uint64 count) external; ``` ```solidity function expectCall(  address where,  uint256 value,  bytes calldata data ) external; ``` ```solidity function expectCall(  address where,  uint256 value,  bytes calldata data,  uint64 count ) external; ``` ### Description Expects that a call to a specified address `where`, where the call data either strictly or loosely matches `data`. The cheatcode can be called in two ways: - If no `count` parameter is specified, the call will be expected to be made at least the amount of times the cheatcode was called. For the same calldata, you cannot call the cheatcode with no `count` and then pass in a `count` parameter. - If `count` is specified, the call will be expected to be made strictly `count` times. For the same calldata, the `count` value cannot be overwritten with another cheatcode call, nor it can be increment by calling the cheatcode without a `count` parameter. `count` can also be set to 0 to assert that a call is not made. When a call is made to `where` the call data is first checked to see if it matches in its entirety with `data`. If not, the call data is checked to see if there is a partial match, with the match starting at the first byte of the call data. **Using the second signature** we can also check if the call was made with the expected `msg.value`. If the test terminates without the call being made, the test fails. > ℹ️ **Internal calls** > > This cheatcode does not currently work on internal calls. See issue [#432](https://github.com/foundry-rs/foundry/issues/432).",408
2235,cast--to-ascii.md,"cast--to-ascii.md. ## cast --to-ascii ### NAME cast---to-ascii - Convert hex data to an ASCII string. ### SYNOPSIS ``cast --to-ascii`` [*options*] *text* ### DESCRIPTION Convert hex data to an ASCII string. ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Convert hex data to an ASCII string:  ```sh  cast --to-ascii ""0x68656c6c6f""  ``` ### SEE ALSO [cast](./cast.md) ",112
2236,derive-key.md,"derive-key.md. ## `deriveKey` ### Signature ```solidity function deriveKey( string calldata mnemonic, uint32 index ) external returns (uint256); ``` ```solidity function deriveKey( string calldata mnemonic, string calldata path, uint32 index ) external returns (uint256); ``` ### Description Derive a private key from a given mnemonic or mnemonic file path. The first signature derives at the derivation path `m/44'/60'/0'/0/{index}`. The second signature allows you to specify the derivation path as the second parameter. ### Examples Derive the private key from the test mnemonic at path `m/44'/60'/0'/0/0`: ```solidity string memory mnemonic = ""test test test test test test test test test test test junk""; uint256 privateKey = vm.deriveKey(mnemonic, 0); ``` Derive the private key from the test mnemonic at path `m/44'/60'/0'/1/0`: ```solidity string memory mnemonic = ""test test test test test test test test test test test junk""; uint256 privateKey = vm.deriveKey(mnemonic, ""m/44'/60'/0'/1/"", 0); ``` ### SEE ALSO - [rememberKey](./remember-key.md) Forge Standard Library: - [deriveRememberKey](../reference/forge-std/derive-remember-key.md) ",285
2237,encodeStorageError.md,encodeStorageError.md. ## `encodeStorageError` ### Signature ```solidity stdError.encodeStorageError ``` ### Description The internal Solidity error when trying to access data in storage that is corrupted. Data cannot be corrupted unless assembly had been used.,50
2238,core-build-options.md,"core-build-options.md. #### Cache Options `--force` &nbsp;&nbsp;&nbsp;&nbsp;Clear the cache and artifacts folder and recompile. #### Linker Options `--libraries` *libraries* &nbsp;&nbsp;&nbsp;&nbsp;Set pre-linked libraries. &nbsp;&nbsp;&nbsp;&nbsp;The parameter must be in the format `<remapped path to lib>:<library name>:<address>`, e.g. `src/Contract.sol:Library:0x...`. &nbsp;&nbsp;&nbsp;&nbsp;Can also be set in your configuration file as `libraries = [""<path>:<lib name>:<address>""]`. {{#include compiler-options.md}} {{#include project-options.md}} `-o` *path* `--out` *path* &nbsp;&nbsp;&nbsp;&nbsp;The project's artifacts directory. `--silent` &nbsp;&nbsp;&nbsp;&nbsp;Suppress all output. ",196
2239,etherscan-commands.md,etherscan-commands.md. ## Etherscan Commands - [cast etherscan-source](./cast-etherscan-source.md) ,29
2240,forking-mainnet-with-cast-anvil.md,"forking-mainnet-with-cast-anvil.md. ## Forking Mainnet with Cast and Anvil ### Introduction By combining [Anvil][anvil] and [Cast][cast], you can fork and test by interacting with contracts on a real network. The goal of this tutorial is to show you how to transfer Dai tokens from someone who holds Dai to an account created by Anvil. ### Set Up Let's start by forking mainnet. ```sh anvil --fork-url https://mainnet.infura.io/v3/$INFURA_KEY ``` You will see 10 accounts are created with their public and private keys. We will work with `0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266` (Let's call this user Alice). ### Transferring Dai Go to Etherscan and search for holders of Dai tokens ([here](https://etherscan.io/token/0x6b175474e89094c44da98b954eedeac495271d0f#balances)). Let's pick a random account. In this example we will be using `0xad0135af20fa82e106607257143d0060a7eb5cbf`.",256
2241,bound.md,"bound.md. ## `bound` ### Signature ```solidity function bound(uint256 x, uint256 min, uint256 max) public returns (uint256 result); ``` ### Description A mathematical function for wrapping inputs of fuzz tests into a certain range. You can use it instead of the `assume` cheatcode to get better performance in some cases. Read more [here](../../cheatcodes/assume.md). ### Examples ```solidity input = bound(input, 99, 101); ``` Returns `99` for input `0`. <br> Returns `100` for input `1`. <br> Returns `101` for input `2`. <br> Returns `99` for input `3`. <br> And so on.",152
2242,multi-wallet-options-keystore.md,multi-wallet-options-keystore.md. #### Wallet Options - Keystore `--keystores` *paths* &nbsp;&nbsp;&nbsp;&nbsp;Use the keystores in the given folders or files. &nbsp;&nbsp;&nbsp;&nbsp;Environment: `ETH_KEYSTORE` `--password` *passwords* &nbsp;&nbsp;&nbsp;&nbsp;The keystore passwords. Used with `--keystore`.,89
2243,assertions.md,assertions.md. ## Assertions - [`expectRevert`](./expect-revert.md) - [`expectEmit`](./expect-emit.md) - [`expectCall`](./expect-call.md) ,41
2244,forge-snapshot.md,"forge-snapshot.md. ## forge snapshot ### NAME forge-snapshot - Create a snapshot of each test's gas usage. ### SYNOPSIS ``forge snapshot`` [*options*] ### DESCRIPTION Create a snapshot of each test's gas usage. The results are written to a file named `.gas-snapshot`. You can change the name of the file by passing `--snap <PATH>`. Fuzz tests are included by default in the snapshot. They use a static seed to achieve deterministic results. Snapshots can be compared with `--diff` and `--check`. The first flag will output a diff, and the second will output a diff *and* exit with code 1 if the snapshots do not match. ### OPTIONS #### Snapshot Options `--asc` Sort results by gas used (ascending). `--desc` &nbsp;&nbsp;&nbsp;&nbsp;Sort results by gas used (descending). `--min` *min_gas* &nbsp;&nbsp;&nbsp;&nbsp;Only include tests that used more gas that the given amount. `--max` *max_gas* &nbsp;&nbsp;&nbsp;&nbsp;Only include tests that used less gas that the given amount. `--diff` *path* &nbsp;&nbsp;&nbsp;&nbsp;Output a diff against a pre-existing snapshot. &nbsp;&nbsp;&nbsp;&nbsp;By default the comparison is done with `.gas-snapshot`. `--check` *path* &nbsp;&nbsp;&nbsp;&nbsp;Compare against a pre-existing snapshot, exiting with code 1 if they do not match. &nbsp;&nbsp;&nbsp;&nbsp;Outputs a diff if the snapshots do not match. &nbsp;&nbsp;&nbsp;&nbsp;By default the comparison is done with `.gas-snapshot`. `--snap` *path* &nbsp;&nbsp;&nbsp;&nbsp;Output file for the snapshot. Default: `.gas-snapshot`. {{#include test-options.md}} {{#include evm-options.md}} {{#include executor-options.md}} {{#include core-build-options.md}} {{#include ../common/display-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Create a snapshot:  ```sh  forge snapshot  ``` 2. Generate a diff:  ```sh  forge snapshot --diff  ``` 3.",472
2245,forge-completions.md,forge-completions.md. ## forge completions ### NAME forge-completions - Generate shell completions script ### SYNOPSIS ``forge completions`` *shell* ### DESCRIPTION Generates a shell completions script for the given shell. Supported shells are: - bash - elvish - fish - powershell - zsh ### OPTIONS {{#include common-options.md}} ### EXAMPLES 1. Generate shell completions script for zsh:  ```sh  forge completions zsh > $HOME/.oh-my-zsh/completions/_forge  ``` ### SEE ALSO [forge](./forge.md) ,123
2246,forge-geiger.md,"forge-geiger.md. ## forge geiger ### NAME forge-geiger - Detects usage of unsafe cheat codes in a foundry project and its dependencies. ### SYNOPSIS ``forge geiger`` [*options*] [*path*] ### DESCRIPTION Detects usage of unsafe cheat codes in a foundry project and its dependencies. ### OPTIONS `--root` *path* &nbsp;&nbsp;&nbsp;&nbsp;The project's root path. By default, this is the root directory of the current git repository, or the current working directory. `--check`  &nbsp;&nbsp;&nbsp;&nbsp;Run in 'check' mode. Exits with 0 if no unsafe cheat codes were found. Exits with 1 if unsafe cheat codes are detected. `--full` &nbsp;&nbsp;&nbsp;&nbsp;Print a full report of all files even if no unsafe functions are found. {{#include common-options.md}} ### SEE ALSO [forge](./forge.md) ",203
2247,prevrandao.md,"prevrandao.md. ## `prevrandao` ### Signature ```solidity function prevrandao(bytes32) external; ``` ### Description Sets `block.prevrandao`. If used with an EVM version previous to the Paris hard fork, it will revert. In that case, use [`vm.difficulty`][prevrandao] instead. ### Examples ```solidity vm.prevrandao(bytes32(uint256(42))); emit log_uint(block.prevrandao); // 42 ``` [prevrandao]: ./difficulty.md",106
2248,forge-cache-clean.md,"forge-cache-clean.md. ## `forge cache clean` ### NAME forge-cache-clean - Cleans cached data from `~/.foundry`. ### SYNOPSIS `forge cache clean` [*options*] [*--*] [*chains..*] ### DESCRIPTION Removes files in the `~/.foundry/cache` folder which is used to cache Etherscan verification status and block data. ### OPTIONS `-b` `--blocks` &nbsp;&nbsp;&nbsp;&nbsp;One or more block numbers separated by comma with no spaces `--etherscan` &nbsp;&nbsp;&nbsp;&nbsp;A boolean flag that specifies to only remove the block explorer portion of the cache {{#include common-options.md}} ### EXAMPLES 1. Remove the entire cache (also, `forge cache clean` is an alias for this)  ```sh forge cache clean all ``` 2. Remove the entire block explorer cache  ```sh forge cache clean all --etherscan ``` 3. Remove cache data for a specific chain, by name  ```sh forge cache clean rinkeby ``` 4. Remove cache data for a specific block number on a specific chain. Does not work if `chain` is `all`  ```sh forge cache clean rinkeby -b 150000 ``` 5. Remove block explorer cache data for a specific chain. Does not work if `--blocks` are specified.  ```sh forge cache clean rinkeby --etherscan ``` 6. Specify multiple chains  ```sh forge cache clean rinkeby mainnet ``` 7. Specify multiple blocks ```sh forge cache clean rinkeby --blocks 530000,9000000,9200000 ``` ### SEE ALSO [forge](./forge.md), [forge cache](./forge-cache.md) ",364
2249,forge-upload-selectors.md,forge-upload-selectors.md. ## forge upload-selectors ### NAME forge-upload-selectors - Uploads abi of given contract to https://sig.eth.samczsun.com function selector database. ### SYNOPSIS ``forge upload-selectors`` [*options*] *contract* ### DESCRIPTION Uploads abi of given contract to https://sig.eth.samczsun.com function selector database. ### OPTIONS {{#include project-options.md}} {{#include common-options.md}} ### EXAMPLES 1. Upload ABI to selector database  ```sh  forge upload-selectors LinearVestingVault  ```,115
2250,assertionError.md,assertionError.md. ## `assertionError` ### Signature ```solidity stdError.assertionError ``` ### Description The internal Solidity error when an `assert` fails.,36
2251,stop-broadcast.md,stop-broadcast.md. ## `stopBroadcast` ### Signature ```solidity function stopBroadcast() external; ``` ### Description Stops collecting transactions for later on-chain broadcasting. ### Examples ```solidity function deployNoArgs() public {  // broadcast the next call  cheats.broadcast();  Test test1 = new Test();  // broadcast all calls between this line and `stopBroadcast`  cheats.startBroadcast();  Test test2 = new Test();  cheats.stopBroadcast(); } ```,96
2252,inline-test-config.md,"inline-test-config.md. ## In-line test configuration Foundry users are enabled to specify overall test configurations, using a combination of ENV variables and config statements in the `foundry.toml`. Checkout the [`Testing reference`][Testing Reference] for a detailed description. Despite this may work in the general case, some tests may need finer control over their configuration. For such reason Forge provides a way to specify per-test configs for invariant and fuzz testing scenarios. Users can in-line test config statements directly in Solidity comments. This would affect the behavior of the `forge test` command for a specific test instance, as illustrated in the example below. ```solidity contract MyTest is Test { /// forge-config: default.fuzz.runs = 100 /// forge-config: ci.fuzz.runs = 500 function test_SimpleFuzzTest(uint256 x) public {  // --- snip --- } } ``` What we are asking here is to run our fuzzer `100` and `500` times for the `default` and `ci` profiles respectively. The interesting fact is that this would override any fuzz `runs` setup existing at a global level. All other configs would be inherited from the global context, making this acting as a fallback for all possible configurations. ### Block comments In-line test configurations can also be expressed in block comments, as illustrated in the example. ```solidity contract MyTest is Test { /** * forge-config: default.fuzz.runs = 1024 * forge-config: default.fuzz.max-test-rejects = 500 */ function test_SimpleFuzzTest(uint256 x) public {  // --- snip --- } } ``` ### In-line fuzz configs Users can specify the configs described in the table. Each statement must have a prefix of the form `forge-config: ${PROFILE}.fuzz.` | Parameter | Type | Description | |-|-|-| |`runs`|integer|The amount of fuzz runs to perform for this specific test case. [`Reference`][testing].| |`max-test-rejects`|integer|The maximum number of combined inputs that may be rejected before the test as a whole aborts.",441
2253,cast-find-block.md,cast-find-block.md. ## cast find-block ### NAME cast-find-block - Get the block number closest to the provided timestamp. ### SYNOPSIS ``cast find-block`` [*options*] *timestamp* ### DESCRIPTION Get the block number closest to the provided timestamp. ### OPTIONS #### RPC Options {{#include ../common/rpc-url-option.md}} {{#include common-options.md}} ### EXAMPLES 1. Get the block number closest to New Years 2021  ```sh  cast find-block 1609459200  ``` ### SEE ALSO [cast](./cast.md) ,117
2254,deploying.md,"deploying.md. ## Deploying Forge can deploy smart contracts to a given network with the [`forge create`](../reference/forge/forge-create.md) command. Forge can deploy only one contract at a time. To deploy a contract, you must provide a RPC URL (env: `ETH_RPC_URL`) and the private key of the account that will deploy the contract. To deploy `MyContract` to a network: ```sh $ forge create --rpc-url <your_rpc_url> --private-key <your_private_key> src/MyContract.sol:MyContract compiling... success. Deployer: 0xa735b3c25f... Deployed to: 0x4054415432... Transaction hash: 0x6b4e0ff93a... ``` Solidity files may contain multiple contracts. `:MyContract` above specifies which contract to deploy from the `src/MyContract.sol` file. Use the `--constructor-args` flag to pass arguments to the constructor: ```solidity // SPDX-License-Identifier: UNLICENSED pragma solidity ^0.8.0; import {ERC20} from ""solmate/tokens/ERC20.sol""; contract MyToken is ERC20 {  constructor(   string memory name,   string memory symbol,   uint8 decimals,   uint256 initialSupply  ) ERC20(name, symbol, decimals) {   _mint(msg.sender, initialSupply);  } } ``` Additionally, we can tell Forge to verify our contract on Etherscan, Sourcify or Blockscout, if the network is supported, by passing `--verify`. ```sh $ forge create --rpc-url <your_rpc_url> \  --constructor-args ""ForgeUSD"" ""FUSD"" 18 1000000000000000000000 \  --private-key <your_private_key> \  --etherscan-api-key <your_etherscan_api_key> \  --verify \  src/MyToken.sol:MyToken ``` ## Verifying a pre-existing contract It is recommended to use the `--verify` flag with `forge create` to automatically verify the contract on explorer after a deployment. Note that for Etherscan [`ETHERSCAN_API_KEY`](../reference/config/etherscan.md#etherscan_api_key) must be set. If you are verifying an already deployed contract, read on.",486
2255,deploying.md,"You can verify a contract on Etherscan, Sourcify or Blockscout with the [`forge verify-contract`](../reference/forge/forge-verify-contract.md) command. You must provide: - the contract address - the contract name or the path to the contract `<path>:<contractname>` - your Etherscan API key (env: `ETHERSCAN_API_KEY`) (if verifying on Etherscan). Moreover, you may need to provide: - the constructor arguments in the ABI-encoded format, if there are any - [compiler version](https://etherscan.io/solcversions) used for build, with 8 hex digits from the commit version prefix (the commit will usually not be a nightly build). It is auto-detected if not specified. - the number of optimizations, if the Solidity optimizer was activated. It is auto-detected if not specified. - the [chain ID](https://evm-chainlist.netlify.app/), if the contract is not on Ethereum Mainnet Let's say you want to verify `MyToken` (see above). You set the [number of optimizations](../reference/config/solidity-compiler.md#optimizer_runs) to 1 million, compiled it with v0.8.10, and deployed it, as shown above, to the Sepolia testnet (chain ID: 11155111). Note that `--num-of-optimizations` will default to 0 if not set on verification, while it defaults to 200 if not set on deployment, so make sure you pass `--num-of-optimizations 200` if you left the default compilation settings.",339
2256,deploying.md,"Here's how to verify it: ```bash forge verify-contract \  --chain-id 11155111 \  --num-of-optimizations 1000000 \  --watch \  --constructor-args $(cast abi-encode ""constructor(string,string,uint256,uint256)"" ""ForgeUSD"" ""FUSD"" 18 1000000000000000000000) \  --etherscan-api-key <your_etherscan_api_key> \  --compiler-version v0.8.10+commit.fc410830 \  <the_contract_address> \  src/MyToken.sol:MyToken Submitted contract for verification:     Response: `OK`     GUID: `a6yrbjp5prvakia6bqp5qdacczyfhkyi5j1r6qbds1js41ak1a`     url: https://sepolia.etherscan.io//address/0x6a54…3a4c#code ``` It is recommended to use the [`--watch`](../reference/forge/forge-verify-contract.md#verify-contract-options) flag along with `verify-contract` command in order to poll for the verification result. If the `--watch` flag was not supplied, you can check the verification status with the [`forge verify-check`](../reference/forge/forge-verify-check.md) command: ```bash $ forge verify-check --chain-id 11155111 <GUID> <your_etherscan_api_key> Contract successfully verified. ``` <br> > 💡 **Tip** > > Use Cast's [`abi-encode`](../reference/cast/cast-abi-encode.md) to ABI-encode arguments. > > In this example, we ran `cast abi-encode ""constructor(string,string,uint8,uint256)"" ""ForgeUSD"" ""FUSD"" 18 1000000000000000000000` to ABI-encode the arguments. <br> ### Troubleshooting ##### `Invalid character 'x' at position 1` Make sure the private key string does not begin with `0x`. ##### `EIP-1559 not activated` EIP-1559 is not supported or not activated on the RPC server. Pass the `--legacy` flag to use legacy transactions instead of the EIP-1559 ones. If you do development in a local environment, you can use Hardhat instead of Ganache.",499
2257,first-steps.md,"first-steps.md. ## First Steps with Foundry This section provides an overview of the `forge` command line tool. We demonstrate how to create a new project, compile, and test it. To start a new project with Foundry, use [`forge init`](../reference/forge/forge-init.md): ```sh {{#include ../output/hello_foundry/forge-init:command}} ``` Let's check out what `forge` generated for us: ```sh $ cd hello_foundry {{#include ../output/hello_foundry/tree:all}} ``` We can build the project with [`forge build`](../reference/forge/forge-build.md): ```sh {{#include ../output/hello_foundry/forge-build:all}} ``` And run the tests with [`forge test`](../reference/forge/forge-test.md): ```sh {{#include ../output/hello_foundry/forge-test:all}} ``` <br> > 💡 **Tip** > > You can always print help for any subcommand (or their subcommands) by adding `--help` at the end. ",224
2258,tests.md,"tests.md. ## Tests Forge can run your tests with the [`forge test`](../reference/forge/forge-test.md) command. All tests are written in Solidity. Forge will look for the tests anywhere in your source directory. Any contract with a function that starts with `test` is considered to be a test. Usually, tests will be placed in `test/` by convention and end with `.t.sol`. Here's an example of running `forge test` in a freshly created project, that only has the default test: ```sh {{#include ../output/hello_foundry/forge-test:all}} ``` You can also run specific tests by passing a filter: ```sh {{#include ../output/test_filters/forge-test-match-contract-and-test:all}} ``` This will run the tests in the `ComplicatedContractTest` test contract with `testDeposit` in the name. Inverse versions of these flags also exist (`--no-match-contract` and `--no-match-test`). You can run tests in filenames that match a glob pattern with `--match-path`. ```sh {{#include ../output/test_filters/forge-test-match-path:all}} ``` The inverse of the `--match-path` flag is `--no-match-path`. ### Logs and traces The default behavior for `forge test` is to only display a summary of passing and failing tests. You can control this behavior by increasing the verbosity (using the `-v` flag). Each level of verbosity adds more information: - **Level 2 (`-vv`)**: Logs emitted during tests are also displayed. That includes assertion errors from tests, showing information such as expected vs actual. - **Level 3 (`-vvv`)**: Stack traces for failing tests are also displayed. - **Level 4 (`-vvvv`)**: Stack traces for all tests are displayed, and setup traces for failing tests are displayed. - **Level 5 (`-vvvvv`)**: Stack traces and setup traces are always displayed. ### Watch mode Forge can re-run your tests when you make changes to your files using `forge test --watch`. By default, only changed test files are re-run. If you want to re-run all tests on a change, you can use `forge test --watch --run-all`. ",470
2259,wallet-options-raw.md,wallet-options-raw.md. #### WALLET OPTIONS - RAW: `-i` `--interactive <NUM>` &nbsp;&nbsp;&nbsp;&nbsp; Open an interactive prompt to enter your private key. Takes a value for the number of keys to enter. &nbsp;&nbsp;&nbsp;&nbsp; Defaults to `0`. `--mnemonic-derivation-path <PATHS>` &nbsp;&nbsp;&nbsp;&nbsp; The wallet derivation path. Works with both `--mnemonic-path` and hardware wallets. `--mnemonic-indexes <INDEXES>` &nbsp;&nbsp;&nbsp;&nbsp; Use the private key from the given mnemonic index. Used with --mnemonic-paths. &nbsp;&nbsp;&nbsp;&nbsp; Defaults to `0`. `--mnemonic-passphrase <PASSPHRASE>` &nbsp;&nbsp;&nbsp;&nbsp; Use a BIP39 passphrases for the mnemonic. `--mnemonic <PATHS>` &nbsp;&nbsp;&nbsp;&nbsp; Use the mnemonic phrases or mnemonic files at the specified paths. `--private-key <RAW_PRIVATE_KEY>` &nbsp;&nbsp;&nbsp;&nbsp; Use the provided private key. `--private-keys <RAW_PRIVATE_KEYS>` &nbsp;&nbsp;&nbsp;&nbsp; Use the provided private keys. ,267
2260,cast-index.md,"cast-index.md. ## cast index ### NAME cast-index - Compute the storage slot location for an entry in a mapping. ### SYNOPSIS ``cast index`` *key_type* *key* *slot* ### DESCRIPTION Compute the storage slot location for an entry in a mapping. Use `cast storage` to get the value. ### OPTIONS {{#include common-options.md}} ### EXAMPLES ```solidity // World.sol mapping (address => uint256) public mapping1; mapping (string => string) public mapping2; ``` 1. Compute the storage slot of an entry (`hello`) in a mapping of type `mapping(string => string)`, located at slot 1:  ```sh  >> cast index string ""hello"" 1  0x3556fc8e3c702d4479a1ab7928dd05d87508462a12f53307b5407c969223d1f8  >> cast storage [address] 0x3556fc8e3c702d4479a1ab7928dd05d87508462a12f53307b5407c969223d1f8  world  ``` ### SEE ALSO [cast](./cast.md) ",252
2261,parse-json.md,"parse-json.md. ## `parseJson` ### Signature ```solidity // Return the value(s) that correspond to 'key' vm.parseJson(string memory json, string memory key) // Return the entire json file vm.parseJson(string memory json); ``` ### Description These cheatcodes are used to parse JSON files in the form of strings. Usually, it's coupled with `vm.readFile()` which returns an entire file in the form of a string. You can use `stdJson` from `forge-std`, as a helper library for better UX. The cheatcode accepts either a `key` to search for a specific value in the JSON, or no key to return the entire JSON. It returns the value as an abi-encoded `bytes` array. That means that you will have to `abi.decode()` to the appropriate type for it to function properly, else it will `revert`. ### JSONpath Key `parseJson` uses a syntax called JSONpath to form arbitrary keys for arbitrary json files. The same syntax (or rather a dialect) is used by the tool [`jq`](https://stedolan.github.io/jq/). To read more about the syntax, you can visit the [README](https://crates.io/crates/jsonpath-rust) of the rust library that we use under the hood to implement the feature. That way you can be certain that you are using the correct dialect of jsonPath. ### JSON Encoding Rules We use the terms `number`, `string`, `object`, `array`, `boolean` as they are defined in the [JSON spec](https://www.w3schools.com/js/js_json_datatypes.asp). **Encoding Rules** - Numbers >= 0 are encoded as `uint256` - Negative numbers are encoded as `int256` - A string that can be decoded into a type of `H160` and starts with `0x` is encoded as an `address`.",390
2262,parse-json.md,"In other words, if it can be decoded into an address, it's probably an address - A string that starts with `0x` is encoded as `bytes32` if it has a length of `66` or else to `bytes` - A string that is neither an `address`, a `bytes32` or `bytes`, is encoded as a `string` - An array is encoded as a dynamic array of the type of its first element - An object (`{}`) is encoded as a `tuple` ### Type Coercion As described above, parseJSON needs to deduce the type of JSON value and that has some inherent limitations. For that reason, there is a sub-family of `parseJson*` cheatcodes that coerce the type of the returned value. For example `vm.parseJsonUint(json, key)` will coerce the value to a `uint256`. That means that it can parse all the following values and return them as a `uint256`. That includes a number as type `number`, a stringified number as a `string` and of course it's hex representation. ```json { ""hexUint"": ""0x12C980"", ""stringUint"": ""115792089237316195423570985008687907853269984665640564039457584007913129639935"", ""numberUint"": 115792089237316195423570985008687907853269984665640564039457584007913129639935 } ``` Similarly, there are cheatcodes for all types (including `bytes` and `bytes32`) and their arrays (`vm.parseJsonUintArray`). ### Decoding JSON objects into Solidity structs JSON objects are encoded as tuples, and can be decoded via tuples or structs. That means that you can define a `struct` in Solidity and it will decode the entire JSON object into that `struct`. For example: The following JSON ```json { ""a"": 43, ""b"": ""sigma"" } ``` will be decoded into: ```solidity struct Json {  uint256 a;  string b; } ``` As the values are returned as an abi-encoded tuple, the exact name of the attributes of the struct don't need to match the names of the keys in the JSON. The above json file could also be decoded as: ```solidity struct Json {  uint256 apple;  string pineapple; } ``` What matters is the alphabetical order.",497
2263,parse-json.md,"As the JSON object is an unordered data structure but the tuple is an ordered one, we had to somehow give order to the JSON. The easiest way was to order the keys by alphabetical order. That means that in order to decode the JSON object correctly, you will need to define attributes of the struct with **types** that correspond to the values of the alphabetical order of the keys of the JSON. - The struct is interpreted serially. That means that the tuple's first item will be decoded based on the first item of the struct definition (no alphabetical order). - The JSON will parsed alphabetically, not serially. Thus, the first (in alphabetical order) value of the JSON, will be abi-encoded and then tried to be abi-decoded, based on the type of the first attribute of the `struct`. The above JSON would not be able to be decoded with the struct below: ```solidity struct Json {  uint256 b;  uint256 a; } ``` The reason is that it would try to decode the string `""sigma""` as a uint. To be exact, it would be decoded, but it would result to a wrong number, since it would interpret the bytes incorrectly. ### Decoding JSON Objects, a tip If your JSON object has `hex numbers`, they will be encoded as bytes. The way to decode them as `uint` for better UX, is to define two `struct`, one intermediary with the definition of these values as `bytes` and then a final `struct` that will be consumed by the user. 1. Decode the JSON into the intermediary `struct` 2. Convert the intermediary struct to the final one, by converting the `bytes` to `uint`. We have a helper function in `forge-std` to do this 3. Give the final `struct` to the user for consumption ### How to use StdJson 1. Import the library `import ""../StdJson.sol"";` 2. Define its usage with `string`: `using stdJson for string;` 3. If you want to parse simple values (numbers, address, etc.) use the helper functions 4. If you want to parse entire JSON objects: 1. Define the `struct` in Solidity. Make sure to follow the alphabetical order -- it's hard to debug 2.",474
2264,select-fork.md,"select-fork.md. ## `selectFork` ### Signature ```solidity function selectFork(uint256 forkId) external; ``` ### Description Takes a fork identifier created by `createFork` and sets the corresponding forked state as active. ### Examples Select a previously created fork: ```solidity uint256 forkId = vm.createFork(MAINNET_RPC_URL); vm.selectFork(forkId); assertEq(vm.activeFork(), forkId); ``` ### SEE ALSO - [createFork](./create-fork.md) - [activeFork](./active-fork.md) ",124
2265,cast-wallet-sign.md,"cast-wallet-sign.md. ## cast wallet sign ### NAME cast-wallet-sign - Sign a message. ### SYNOPSIS ``cast wallet sign`` [*options*] *message* ### DESCRIPTION Sign a message. ### OPTIONS {{#include ../common/wallet-options-raw.md}} {{#include ../common/wallet-options-keystore.md}} {{#include ../common/wallet-options-hardware.md}} {{#include common-options.md}} ### EXAMPLES 1. Sign a message using a keystore:  ```sh  cast wallet sign --keystore keystore.json --interactive ""hello""  ``` 2. Sign a message using a raw private key:  ```sh  cast wallet sign --private-key $PRIV_KEY ""hello""  ``` ### SEE ALSO [cast](./cast.md), [cast wallet](./cast-wallet.md) ",174
2266,chisel_README.md,"chisel_README.md. ## Overview of Chisel Chisel is an advanced Solidity REPL shipped with Foundry. It can be used to quickly test the behavior of Solidity snippets on a local or forked network. Chisel is part of the Foundry suite and is installed alongside `forge`, `cast`, and `anvil`. If you haven't installed Foundry yet, see [Foundry installation](../getting-started/installation.md). > Note: If you have an older version of Foundry installed, you'll need to re-install `foundryup` in order for Chisel to be downloaded. ### How to use Chisel To use Chisel, simply type `chisel`. From there, start writing Solidity code! Chisel will offer verbose feedback on each input. Chisel can be used both within and outside of a foundry project. If the binary is executed in a Foundry project root, Chisel will inherit the project's configuration options. To see available commands, type `!help` within the REPL. > 📚 **Reference** > > See the [`chisel` Reference](../reference/chisel/) for in depth information on Chisel and its capabilities. ",247
2267,env-or.md,"env-or.md. ## `envOr` ### Signature ```solidity function envOr(string calldata key, bool defaultValue) external returns (bool value); function envOr(string calldata key, uint256 defaultValue) external returns (uint256 value); function envOr(string calldata key, int256 defaultValue) external returns (int256 value); function envOr(string calldata key, address defaultValue) external returns (address value); function envOr(string calldata key, bytes32 defaultValue) external returns (bytes32 value); function envOr(string calldata key, string calldata defaultValue) external returns (string memory value); function envOr(string calldata key, bytes calldata defaultValue) external returns (bytes memory value); ``` ```solidity function envOr(string calldata key, string calldata delimiter, bool[] calldata defaultValue) external returns (bool[] memory value); function envOr(string calldata key, string calldata delimiter, uint256[] calldata defaultValue) external returns (uint256[] memory value); function envOr(string calldata key, string calldata delimiter, int256[] calldata defaultValue) external returns (int256[] memory value); function envOr(string calldata key, string calldata delimiter, address[] calldata defaultValue) external returns (address[] memory value); function envOr(string calldata key, string calldata delimiter, bytes32[] calldata defaultValue) external returns (bytes32[] memory value); function envOr(string calldata key, string calldata delimiter, string[] calldata defaultValue) external returns (string[] memory value); function envOr(string calldata key, string calldata delimiter, bytes[] calldata defaultValue) external returns (bytes[] memory value); ``` ### Description A non-failing way to read an environment variable of any type: if the requested environment key does not exist, `envOr()` will return a default value instead of reverting (works with arrays too). The returned type is determined by the type of `defaultValue` parameter passed. ### Tips - Use `envOr(key, defaultValue)` to read a single value - Use `envOr(key, delimiter, defaultValue[])` to read an array with delimiter - The parsing of the environment variable will be done according to the type of `defaultValue` (e.g.",460
2268,vscode.md,"vscode.md. ## Integrating with VSCode You can get Solidity support for Visual Studio Code by installing the [VSCode Solidity extension](https://github.com/juanfranblanco/vscode-solidity). To make the extension play nicely with Foundry, you may have to tweak a couple of things. ### 1. Remappings You may want to place your remappings in `remappings.txt`. If they are already in `foundry.toml`, copy them over and use `remappings.txt` instead. If you just use the autogenerated remappings that Foundry provides, run `forge remappings > remappings.txt`. ### 2. Dependencies You may have to add the following to your `.vscode/settings.json` for the extension to find your dependencies: ```json { ""solidity.packageDefaultDependenciesContractsDirectory"": ""src"", ""solidity.packageDefaultDependenciesDirectory"": ""lib"" } ``` Where `src` is the source code directory and `lib` is your dependency directory. ### 3. Formatter To enable the built-in formatter that comes with Foundry to automatically format your code on save, you can add the following settings to your `.vscode/settings.json`: ```json { ""editor.formatOnSave"": true, ""[solidity]"": {  ""editor.defaultFormatter"": ""JuanBlanco.solidity"" }, ""solidity.formatter"": ""forge"", } ``` To configure the formatter settings, refer to the [Formatter](../reference/config/formatter.md) reference. ### 4. Solc Version Finally, it is recommended to specify a Solidity compiler version: ```json ""solidity.compileUsingRemoteVersion"": ""v0.8.17"" ``` To get Foundry in line with the chosen version, add the following to your `default` profile in `foundry.toml`. ```toml solc = ""0.8.17"" ``` ",389
2269,rpc-options.md,rpc-options.md. #### RPC Options {{#include rpc-url-option.md}} `--flashbots` &nbsp;&nbsp;&nbsp;&nbsp;Use the Flashbots RPC URL (<https://rpc.flashbots.net>). ,44
2270,forking.md,forking.md. ## Forking - [`createFork`](./create-fork.md) - [`selectFork`](./select-fork.md) - [`createSelectFork`](./create-select-fork.md) - [`activeFork`](./active-fork.md) - [`rollFork`](./roll-fork.md) - [`makePersistent`](./make-persistent.md) - [`revokePersistent`](./revoke-persistent.md) - [`isPersistent`](./is-persistent.md) - [`allowCheatcodes`](./allow-cheatcodes.md) - [`transact`](./transact.md) ,129
2271,etherscan-options.md,"etherscan-options.md. #### Etherscan Options `--chain` *chain_name* &nbsp;&nbsp;&nbsp;&nbsp;The Etherscan chain. `--etherscan-api-key` *key* &nbsp;&nbsp;&nbsp;&nbsp;Etherscan API key, or the key of an [Etherscan configuration table](../config/etherscan.md#etherscan). &nbsp;&nbsp;&nbsp;&nbsp;Environment: `ETHERSCAN_API_KEY` ",102
2272,SUMMARY.md,SUMMARY.md.,4
